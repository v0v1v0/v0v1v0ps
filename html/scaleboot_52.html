<div class="container">

<table style="width: 100%;"><tr>
<td>sbconf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bootstrap Confidence Intervals</h2>

<h3>Description</h3>

<p>A confidence interval for a scalar parameter is obtained by inverting
the approximately unbiased p-value. This function is very slow,
and it is currently experimental.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sbconf(x, ...)

## Default S3 method:
sbconf(x,sa, probs=c(0.05,0.95), model="poly.2",
       k=2,s=1,sp=-1, cluster=NULL,...)

## S3 method for class 'sbconf'
sbconf(x, probs=x$probs,model=x$model,
       k=x$k,s=x$s,sp=x$sp, nofit=FALSE, ...)

## S3 method for class 'sbconf'
plot(x,model=x$model,k=x$k,s=x$s,sp=x$sp,
     models = attr(x$fits,"models"), log.xy = "",
     xlab="test statistic",ylab=NULL, type.plot = c("p","l","b"),
     yval=c("aic","zvalue","pvalue"), sd=2,add=FALSE, col=1:6,
     pch=NULL,lty=1:5,lwd=par("lwd"), mk.col=col[1],
     mk.lwd=lwd[1], mk.lty=lty[1], ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an object used to select a method. For <code>sbconf.default</code>,
<code>x</code> is a list vector of size <code>length{sa}</code> 
with each element being a vector of bootstrap replicates of a
statistic or a list vector of a scalar component.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sa</code></td>
<td>
<p>vector of scales in sigma squared (<code class="reqn">\sigma^2</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>
<p>a vector of probabilities at which p-values are inverted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a character to specify a model for an AU p-value. This
should be included in <code>sboptions("models")</code>, for which
model fitting is made internally.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>a numeric to specify an order of AU p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p><code class="reqn">\sigma_0^2</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sp</code></td>
<td>
<p><code class="reqn">\sigma_p^2</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p><span class="pkg">parallel</span> cluster object which may be generated by
function <code>makeCluster</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nofit</code></td>
<td>
<p>logical. No further calls to <code>sbfit</code> are made.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>models</code></td>
<td>
<p>AIC values are plotted for these models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log.xy</code></td>
<td>
<p>character string to be passed to <code>plot.default</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>a label for the x axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>a label for the y axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type.plot</code></td>
<td>
<p>a character to be passed to <code>plot.default</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yval</code></td>
<td>
<p>determines y-axis. "aic" for AIC values of models, "zvalue"
for AU corrected z-values, and "pvalue" for AU corrected p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd</code></td>
<td>
<p>If positive, draws curves +-sd*standard error for z-values
and p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add</code></td>
<td>
<p>logical. Should not the frame be drawn?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>vector of colors of plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch</code></td>
<td>
<p>vector of pch's of plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lty</code></td>
<td>
<p>vector of lty's of plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd</code></td>
<td>
<p>numeric of lwd of plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mk.col</code></td>
<td>
<p>color for crosses drawn at <code>probs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mk.lwd</code></td>
<td>
<p>lwd for crosses drawn at <code>probs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mk.lty</code></td>
<td>
<p>lty for crosses drawn at <code>probs</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Let <code>x[[i]]</code> be a vector of bootstrap replicates for a statistic
with scale <code>sa[i]</code>. For a threshold value <code>y</code>, the bootstrap
probability is
<code>bp[i]=sum(x[[i]]&lt;y)/length(x[[i]])</code>. <code>sbconf</code> computes
<code>bp</code> for several <code>y</code> values, and finds a value <code>y</code> at
which the AU p-value, given by <code>sbfit</code>, equals a probability value
specified in <code>probs</code>.  In this manner, AU p-values are inverted to obtain
bootstrap confidence intervals.
</p>
<p>See the examples below for details.
</p>


<h3>Value</h3>

<p><code>sbconf</code> method returns an object of class <code>"sbconf"</code>.
</p>
<p>The <code>print</code> method for an object of class <code>"sbconf"</code> prints
the confidence intervals.
</p>


<h3>Author(s)</h3>

<p>Hidetoshi Shimodaira</p>


<h3>See Also</h3>

<p><code>scaleboot</code>.</p>


<h3>Examples</h3>

<pre><code class="language-R">## An example to calculate confidence intervals
## The test statistic is that for "t4" in data(mam15)

data(mam15) # load mam15.mt
sa &lt;- 10^seq(-2,2,length=13) # parameter for multiscale bootstrap

## Definition of a test statistic of interest.
## "myfun" returns the maximum difference of log-likelihood value
## for a tree named a.
myfun &lt;- function(x,w,a) maxdif(wsumrow(x,w))[[a]]
maxdif &lt;- function(x) {
  i1 &lt;- which.max(x)  # the largest element
  x &lt;- -x + x[i1]
  x[i1] &lt;- -min(x[-i1])  # the second largest value
  x
}
wsumrow &lt;- function(x,w) {
  apply(w*x,2,sum)*nrow(x)/sum(w)
}

## Not run: 
## a quick example with nb=1000 (fairely fast in 2017)
## Compute multiscale bootstrap replicates
nb &lt;- 1000 # nb = 10000 is better but slower
# the following line takes some time (less than 1 minute in 2017)
sim &lt;- scaleboot(mam15.mt,nb,sa,myfun,"t4",count=FALSE,onlyboot=TRUE)

## show 90
## each tail is also interpreted as 95
(conf1 &lt;- sbconf(sim$stat,sim$sa,model="sing.3",k=1)) # with k=1
(conf2 &lt;- sbconf(conf1,model="sing.3",k=2)) # with k=2
(conf3 &lt;- sbconf(conf2,model="sing.3",k=3)) # with k=3

## plot diagnostics for computing the confidence limits
plot(conf3) # AIC values for models v.s. test statistic value
plot(conf3,yval="zval",type="l") # corrected "k.3" z-value

## End(Not run)


## Not run: 
## a longer example with nb=10000 (it was slow in 2010)
## In the following, we used 40 cpu's.
nb &lt;- 10000

library(parallel)
cl &lt;- makeCluster(40)
clusterExport(cl,c("maxdif","wsumrow"))

## Compute multiscale bootstrap replicates
## (It took 80 secs using 40 cpu's)
sim &lt;- scaleboot(mam15.mt,nb,sa,myfun,"t4",count=FALSE,
                 cluster=cl,onlyboot=TRUE)

## Modify option "probs0" to a fine grid with 400 points
## default: 0.001 0.010 0.100 0.900 0.990 0.999
## NOTE: This modification is useful only when cl != NULL,
##   in which case calls to sbfit for the grid points
##   are made in parallel, although iterations seen later
##   are made sequentially.
sboptions("probs0",pnorm(seq(qnorm(0.001),qnorm(0.999),length=400)))

## Calculate bootstrap confidence intervals using "k.1" p-value.
## (It took 70 secs using 40 cpu's)
## First, sbfit is applied to bp's determined by option "probs0"
## Then, additional fitting is made only twice for iteration.
## p[1]=0.05 iter=1 t=4.342723 e=0.0003473446 r=0.0301812
## p[2]=0.95 iter=1 t=42.76558 e=0.002572495 r=0.1896809
conf1 &lt;- sbconf(sim$stat,sim$sa,model="sing.3",k=1,cluster=cl)

## The confidence interval with "k.1" is printed as
##     0.05      0.95 
## 4.342723 42.765582 
conf1 

## Calculate bootstrap confidence intervals
##                        using "k.2" and "k.3" p-values.
## (It took only 10 secs)
## p[1]=0.05 iter=1 t=-2.974480 e=0.003729190 r=0.04725755
## p[2]=0.95 iter=1 t=39.51767 e=0.001030929 r=0.06141937
##      0.05      0.95 
## -2.974480 39.517671 
conf2 &lt;- sbconf(conf1,model="sing.3",k=2)
conf2
## p[1]=0.05 iter=1 t=-3.810157 e=0.01068678 r=0.08793868
## p[2]=0.95 iter=1 t=39.32669 e=0.001711107 r=0.09464663
##      0.05      0.95 
## -3.810157 39.326686 
conf3 &lt;- sbconf(conf2,model="sing.3",k=3)
conf3

## plot diagnostics
plot(conf3) # AIC values for models v.s. test statistic value
plot(conf3,yval="zval",type="l") # corrected "k.3" z-value

stopCluster(cl)

## End(Not run)

</code></pre>


</div>