<div class="container">

<table style="width: 100%;"><tr>
<td>johnsonshap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Johnson-Shapley indices</h2>

<h3>Description</h3>

<p><code>johnsonshap</code> computes the Johnson-Shapley indices for correlated input 
relative importance. These indices allocate a share of the output variance to 
each input based on the relative weight allocation system, 
in the case of dependent or correlated inputs.
</p>


<h3>Usage</h3>

<pre><code class="language-R">johnsonshap(model = NULL, X1, N, nboot = 0, conf = 0.95)
## S3 method for class 'johnsonshap'
print(x, ...)
## S3 method for class 'johnsonshap'
plot(x, ylim = c(0,1), ...)
## S3 method for class 'johnsonshap'
ggplot(data,  mapping = aes(), ylim = c(0, 1), ..., 
                environment = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a function, or a model with a <code>predict</code> method,
defining the model to analyze.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X1</code></td>
<td>
<p>a data frame (or object coercible by <code>as.data.frame</code>)
containing a design of experiments (model input variables).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>an integer giving the size of each replicated design for
the Sobol' indices computations via the sobolrep() fct.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboot</code></td>
<td>
<p>the number of bootstrap replicates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf</code></td>
<td>
<p>the confidence level of the bootstrap confidence intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the object returned by <code>johnsonshap</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the object returned by <code>johnsonshap</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>the y-coordinate limits of the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapping</code></td>
<td>
<p>Default list of aesthetic mappings to use for plot. If not 
specified, must be supplied in each layer added to the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>environment</code></td>
<td>
<p>[Deprecated] Used prior to tidy evaluation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to be passed to methods, such as graphical
parameters (see <code>par</code>).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>X1 is not used to run the model but just to perform the SVD; the model is run 
on a specific   design which is internally generated.
</p>
<p>By using bootstrap, values in the columns 'bias' and 'std. error' are 
arbitrarily put at 0 because of impossible computations; values in columns 
'original', 'min c.i.' and 'max c.i.' are correctly computed.
</p>


<h3>Value</h3>

<p><code>johnsonshap</code> returns a list of class <code>"johnsonshap"</code>, containing 
all the input arguments detailed before, plus the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a matrix containing the design of experiments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sobrepZ</code></td>
<td>
<p>the Sobol' indices of the transformed inputs (independent)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Wstar</code></td>
<td>
<p>the standardized weight matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>johnsonshap</code></td>
<td>
<p>a data frame containing the estimations of the 
Johnson-Shapley indices, bias and confidence intervals.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Bertrand Iooss
</p>


<h3>References</h3>

<p>B. Iooss and L. Clouvel, <em>Une methode d'approximation des effets 
de Shapley en grande dimension</em>, 54emes  Journees de Statistique, 
Bruxelles, Belgique, July 3-7, 2023
</p>


<h3>See Also</h3>

<p><code>johnson, shapleysobol_knn</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(ggplot2)
library(boot)

#####################################################
# Test case: the non-monotonic Sobol g-function (with independent inputs)
n &lt;- 1000
X &lt;- data.frame(matrix(runif(8 * n), nrow = n))
x &lt;- johnsonshap(model = sobol.fun, X1 = X, N = n)
print(x)
plot(x)
ggplot(x)


#############################################
# 3D analytical toy functions described in Iooss &amp; Clouvel (2023)

library(mvtnorm)

Xall &lt;- function(n) mvtnorm::rmvnorm(n,mu,Covmat)
# 2 correlated inputs
Cov3d2 &lt;- function(rho){ # correl (X1,X2)
  Cormat &lt;- matrix(c(1,rho,0,rho,1,0,0,0,1),3,3)
  return( ( sig %*% t(sig) ) * Cormat)
}
mu3d &lt;- c(1,0,0) ; sig3d &lt;- c(0.25,1,1)
d &lt;- 3 ; mu &lt;- mu3d ; sig &lt;- sig3d ; Covm &lt;- Cov3d2
Xvec &lt;- c("X1","X2","X3")

n &lt;- 1e4    # initial sample size
N &lt;- 1e4    # cost to estimate indices 
rho &lt;- 0.9  # correlation coef for dependent inputs' case

################
# Linear model + a strong 2nd order interaction

toy3d &lt;- function(x) return(x[,1]*(1+x[,1]*(cos(x[,2]+x[,3])^2))) 
# interaction X2X3
toy &lt;- toy3d 

# Independent case

Covmat &lt;- Covm(0)
X &lt;- as.data.frame(Xall(n))
Y &lt;- toy(X)
joh &lt;- johnson(X, Y, nboot=100)
print(joh)
johshap &lt;- johnsonshap(model = toy, X1 = X, N = N, nboot=100)
print(johshap)
ggplot(johshap)

# Dependent case

Covmat &lt;- Covm(rho)
Xdep &lt;- as.data.frame(Xall(n))
Ydep &lt;- toy(Xdep)
joh &lt;- johnson(Xdep, Ydep, nboot=0)
print(joh)
johshap &lt;- johnsonshap(model = toy, X1 = Xdep, N = N, nboot=100)
print(johshap)
ggplot(johshap)

################
# Strongly non-inear model + a strong 2nd order interaction

toy3dNL &lt;- function(x) return(sin(x[,1]*pi/2)*(1+x[,1]*(cos(x[,2]+x[,3])^2))) 
# non linearity in X1
toy &lt;- toy3dNL

# Independent case

Covmat &lt;- Covm(0)
X &lt;- as.data.frame(Xall(n))
Y &lt;- toy(X)
joh &lt;- johnson(X, Y, nboot=100)
print(joh)
johshap &lt;- johnsonshap(model = toy, X1 = X, N = N, nboot=100)
print(johshap)
ggplot(johshap)

# Dependent case

Covmat &lt;- Covm(rho)
Xdep &lt;- as.data.frame(Xall(n))
Ydep &lt;- toy(Xdep)
joh &lt;- johnson(Xdep, Ydep, nboot=0)
print(joh)
johshap &lt;- johnsonshap(model = NULL, X1 = Xdep, N = N, nboot=100)
y &lt;- toy(johshap$X)
tell(johshap, y)
print(johshap)
ggplot(johshap)


</code></pre>


</div>