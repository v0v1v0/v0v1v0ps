<div class="container">

<table style="width: 100%;"><tr>
<td>merge_clin</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Merge Clinical Data into SomaScan</h2>

<h3>Description</h3>

<p>Occasionally, additional clinical data is obtained <em>after</em> samples
have been submitted to SomaLogic, or even after 'SomaScan'
results have been delivered.
This requires the new clinical variables, i.e. non-proteomic, data to be
merged with 'SomaScan' data into a "new" ADAT prior to analysis.
<code>merge_clin()</code> easily merges such clinical variables into an
existing <code>soma_adat</code> object and is a simple wrapper around <code>dplyr::left_join()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">merge_clin(x, clin_data, by = NULL, by_class = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>soma_adat</code> object (with intact attributes),
typically created using <code>read_adat()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clin_data</code></td>
<td>
<p>One of 2 options:
</p>

<ul>
<li>
<p> a data frame containing clinical variables to merge into <code>x</code>, or
</p>
</li>
<li>
<p> a path to a file, typically a <code style="white-space: pre;">⁠*.csv⁠</code>,
containing clinical variables to merge into <code>x</code>.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>A character vector of variables to join by.
See <code>dplyr::left_join()</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by_class</code></td>
<td>
<p>If <code>clin_data</code> is a file path, a named character vector
of the variable and its class. This ensures the "by-key" is compatible
for the join. For example, <code>c(SampleId = "character")</code>.
See <code>read.table()</code> for details about its <code>colClasses</code> argument, and
also the examples below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters passed to <code>dplyr::left_join()</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This functionality also exists as a command-line tool (R script) contained
in <code>merge_clin.R</code> that lives in the <code>cli/merge</code> system file directory.
Please see:
</p>

<ul>
<li> <p><code>dir(system.file("cli/merge", package = "SomaDataIO"), full.names = TRUE)</code>
</p>
</li>
<li> <p><code>vignette("cli-merge-tool", package = "SomaDataIO")</code>
</p>
</li>
</ul>
<h3>Value</h3>

<p>A <code>soma_adat</code> with new clinical variables merged.
</p>


<h3>Author(s)</h3>

<p>Stu Field
</p>


<h3>See Also</h3>

<p><code>dplyr::left_join()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># retrieve clinical data
clin_file &lt;- system.file("cli/merge", "meta.csv",
                         package = "SomaDataIO",
                         mustWork = TRUE)
clin_file

# view clinical data to be merged:
# 1) `group`
# 2) `newvar`
clin_df &lt;- read.csv(clin_file, colClasses = c(SampleId = "character"))
clin_df

# create mini-adat
apts &lt;- withr::with_seed(123, sample(getAnalytes(example_data), 2L))
adat &lt;- head(example_data, 9L) |&gt;   # 9 x 2
  dplyr::select(SampleId, all_of(apts))

# merge clinical variables
merged &lt;- merge_clin(adat, clin_df, by = "SampleId")
merged

# Alternative syntax:
#   1) pass file path
#   2) merge on different variable names
#   3) convert join type on-the-fly
clin_file2 &lt;- system.file("cli/merge", "meta2.csv",
                          package = "SomaDataIO",
                          mustWork = TRUE)

id_type &lt;- typeof(adat$SampleId)
merged2 &lt;- merge_clin(adat, clin_file2,                # file path
                      by = c(SampleId = "ClinKey"),    # join on 2 variables
                      by_class = c(ClinKey = id_type)) # match types
merged2
</code></pre>


</div>