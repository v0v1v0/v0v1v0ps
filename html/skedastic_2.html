<div class="container">

<table style="width: 100%;"><tr>
<td>anlvm.fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Auxiliary Nonlinear Variance Model</h2>

<h3>Description</h3>

<p>Fits an Auxiliary Nonlinear Variance Model (ANLVM) to estimate the error
variances of a heteroskedastic linear regression model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">anlvm.fit(
  mainlm,
  g,
  M = NULL,
  cluster = FALSE,
  varselect = c("none", "hettest", "cv.linear", "cv.cluster", "qgcv.linear",
    "qgcv.cluster"),
  nclust = c("elbow.swd", "elbow.mwd", "elbow.both"),
  clustering = NULL,
  param.init = function(q) stats::runif(n = q, min = -5, max = 5),
  maxgridrows = 20L,
  nconvstop = 3L,
  zerosallowed = FALSE,
  maxitql = 100L,
  tolql = 1e-08,
  nestedql = FALSE,
  reduce2homosked = TRUE,
  cvoption = c("testsetols", "partitionres"),
  nfolds = 5L,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mainlm</code></td>
<td>
<p>Either an object of <code>class</code> <code>"lm"</code>
(e.g., generated by <code>lm</code>), or
a list of two objects: a response vector and a design matrix. The objects
are assumed to be in that order, unless they are given the names
<code>"X"</code>  and <code>"y"</code> to distinguish them. The design matrix passed
in a list must begin with a column of ones if an intercept is to be
included in the linear model. The design matrix passed in a list should
not contain factors, as all columns are treated 'as is'. For tests that
use ordinary least squares residuals, one can also pass a vector of
residuals in the list, which should either be the third object or be
named <code>"e"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>g</code></td>
<td>
<p>A numeric-valued function of one variable, or a character denoting
the name of such a function. <code>"sq"</code> is allowed as a way of denoting
<code>function(x) x ^ 2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>An <code class="reqn">n\times n</code> annihilator matrix. If <code>NULL</code>
(the default), this will be calculated from the <code>mainlm</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>A logical; should the design matrix X be replaced with an
<code class="reqn">n\times n_c</code> matrix of ones and zeroes, with a single one in each
row, indicating assignments of the <code class="reqn">n</code> observations to <code class="reqn">n_c</code>
clusters using an agglomerative hierarchical clustering algorithm. In
this case, the dimensionality of <code class="reqn">\gamma</code> is <code class="reqn">n_c</code> and not
<code class="reqn">p</code>. Defaults to <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varselect</code></td>
<td>
<p>Either a character indicating how variable selection should
be conducted, or an integer vector giving indices of columns of the
predictor matrix (<code>model.matrix</code> of <code>mainlm</code>)
to select. The vector must include <code>1L</code> for the intercept to be
selected. If a character, it must be one of the following:
</p>

<ul>
<li> <p><code>"none"</code>: No variable selection is conducted;
</p>
</li>
<li> <p><code>"hettest"</code>: Variable selection is conducted by applying a
heteroskedasticity test with each feature in turn serving as the
‘deflator’ variable
</p>
</li>
<li> <p><code>"cv.linear"</code>: Variable selection is conducted by best subset
selection on the auxiliary linear variance model (linear specification),
using squared-error loss computed under <code class="reqn">K</code>-fold cross-validation
</p>
</li>
<li> <p><code>"cv.cluster"</code>: Variable selection is conducted by best subset
selection on the auxiliary linear variance model (clustering
specification), using squared-error loss computed under <code class="reqn">K</code>-fold
cross-validation
</p>
</li>
<li> <p><code>"qgcv.linear"</code>: Variable selection is conducted by best subset
selection on the auxiliary linear variance model (linear specification),
using squared-error loss computed under quasi-generalised
cross-validation
</p>
</li>
<li> <p><code>"qgcv.cluster"</code>: Variable selection is conducted by best subset
selection on the auxiliary linear variance model (clustering
specification), using squared-error loss computed under
quasi-generalised cross-validation
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nclust</code></td>
<td>
<p>A character indicating which elbow method to use to select
the number of clusters (ignored if <code>cluster</code> is <code>FALSE</code>).
Alternatively, an integer specifying the number of clusters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clustering</code></td>
<td>
<p>A list object of class <code>"doclust"</code>. If set to
<code>NULL</code> (the default), such an object is generated (ignored if
<code>cluster</code> is <code>FALSE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param.init</code></td>
<td>
<p>Specifies the initial values of the parameter vector to
use in the Gauss-Newton fitting algorithm. This can either be a function
for generating the initial values from a probability distribution, a
list containing named objects corresponding to the arguments of
<code>seq</code> (specifying a sequence of scalar values that
will be passed to <code>expand.grid</code>), or a numeric vector
specifying a single initial parameter vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxgridrows</code></td>
<td>
<p>An integer indicating the maximum number of initial
values of the parameter vector to try, in case of <code>param.init</code>
being a function or a list used to generate a grid. Defaults to
<code>20L</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nconvstop</code></td>
<td>
<p>An integer indicating how many times the quasi-likelihood
estimation algorithm should converge before the grid search across
different initial parameter values is truncated. Defaults to <code>3L</code>.
If <code>nconvstop &gt;= maxgridrows</code>, no early stopping rule will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zerosallowed</code></td>
<td>
<p>A logical indicating whether 0 values are acceptable
in the initial values of the parameter vector. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxitql</code></td>
<td>
<p>An integer specifying the maximum number of iterations to
run in the Gauss-Newton algorithm for quasi-likelihood estimation.
Defaults to <code>100L</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolql</code></td>
<td>
<p>A double specifying the convergence criterion for the
Gauss-Newton algorithm; defaults to <code>1e-8</code>. The criterion is applied
to the <code>L_2</code> norm of the difference between parameter vectors in
successive iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nestedql</code></td>
<td>
<p>A logical indicating whether to use the nested updating step
suggested in Seber and Wild (2003). Defaults to
<code>FALSE</code> due to the large computation time required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reduce2homosked</code></td>
<td>
<p>A logical indicating whether the homoskedastic
error variance estimator <code class="reqn">e'e/(n-p)</code> should be used if the
variable selection procedure does not select any variables. Defaults to
<code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cvoption</code></td>
<td>
<p>A character, either <code>"testsetols"</code> or
<code>"partitionres"</code>, indicating how to obtain the observed response
values for each test fold when performing <code class="reqn">K</code>-fold cross-validation
on an ALVM. The default technique, <code>"testsetols"</code>, entails fitting
a linear regression model to the test fold of observations from the
original response vector <code class="reqn">y</code> and predictor matrix <code class="reqn">X</code>. The
squared residuals from this regression are the observed
responses that are predicted from the trained model to compute the
cross-validated squared error loss function. Under the other technique,
<code>"partitionres"</code>, the squared residuals from the full
linear regression model are partitioned into training and test folds and
the squared residuals in the test fold are the observed responses that
are predicted for computation of the cross-validated loss.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfolds</code></td>
<td>
<p>An integer specifying the number of folds <code class="reqn">K</code> to use for
cross-validation, if the <code class="reqn">\lambda</code> and/or <code class="reqn">n_c</code> hyperparameters
are to be tuned using cross-validation. Defaults to <code>5L</code>. One must
ensure that each test fold contains at least <code class="reqn">p+1</code> observations if
the <code>"testsetols"</code> technique is used with cross-validation, so that
there are enough degrees of freedom to fit a linear model to the test
fold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments that can be passed to (non-exported) helper
functions, namely:
</p>

<ul>
<li> <p><code>greedy</code>, a logical passed to the functions implementing best subset
selection, indicating whether or not to use a greedy search rather than
exhaustive search for the best subset. Defaults to <code>FALSE</code>, but
coerced to <code>TRUE</code> unconditionally if <code class="reqn">p&gt;9</code>.
</p>
</li>
<li> <p><code>distmetric</code>, a character specifying the distance metric to use in
computing distance for the clustering algorithm. Corresponds to the
<code>method</code> argument of <code>dist</code> and defaults to
<code>"euclidean"</code>
</p>
</li>
<li> <p><code>linkage</code>, a character specifying the linkage rule to use in
agglomerative hierarchical clustering. Corresponds to the <code>method</code>
argument of <code>hclust</code> and defaults to
<code>"complete"</code>
</p>
</li>
<li> <p><code>alpha</code>, a double specifying the significance level threshold to use
when applying heteroskedasticity test for the purpose of feature
selection in an ALVM; defaults to <code>0.1</code>
</p>
</li>
<li> <p><code>testname</code>, a character corresponding to the name of a function that
performs a heteroskedasticity test. The function must either be one that
takes a <code>deflator</code> argument or <code>breusch_pagan</code>. Defaults
to <code>evans_king</code>
</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The ANLVM model equation is
</p>
<p style="text-align: center;"><code class="reqn">e_i^2=\displaystyle\sum_{k=1}^{n} g(X_{k\cdot}'\gamma) m_{ik}^2+u_i</code>
</p>
<p>,
where <code class="reqn">e_i</code> is the <code class="reqn">i</code>th Ordinary Least Squares residual,
<code class="reqn">X_{k\cdot}</code> is a vector corresponding to the <code class="reqn">k</code>th row of the
<code class="reqn">n\times p</code> design matrix <code class="reqn">X</code>, <code class="reqn">m_{ik}^2</code> is the
<code class="reqn">(i,k)</code>th element of the annihilator matrix <code class="reqn">M=I-X(X'X)^{-1}X'</code>,
<code class="reqn">u_i</code> is a random error term, <code class="reqn">\gamma</code> is a <code class="reqn">p</code>-vector of
unknown parameters, and <code class="reqn">g(\cdot)</code> is a continuous, differentiable
function that need not be linear in <code class="reqn">\gamma</code>, but must be expressible
as a function of the linear predictor <code class="reqn">X_{k\cdot}'\gamma</code>.
This method has been developed as part of the author's doctoral research
project.
</p>
<p>The parameter vector <code class="reqn">\gamma</code> is estimated using the maximum
quasi-likelihood method as described in section 2.3 of
Seber and Wild (2003). The optimisation problem is
solved numerically using a Gauss-Newton algorithm.
</p>
<p>For further discussion of feature selection and the methods for choosing the
number of clusters to use with the clustering version of the model, see
<code>alvm.fit</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>"anlvm.fit"</code>, containing the following:
</p>

<ul>
<li> <p><code>coef.est</code>, a vector of parameter estimates, <code class="reqn">\hat{\gamma}</code>
</p>
</li>
<li> <p><code>var.est</code>, a vector of estimates <code class="reqn">\hat{\omega}</code> of the error
variances for all observations
</p>
</li>
<li> <p><code>method</code>, either <code>"cluster"</code> or <code>"functionalform"</code>,
depending on whether <code>cluster</code> was set to <code>TRUE</code>
</p>
</li>
<li> <p><code>ols</code>, the <code>lm</code> object corresponding to the original linear
regression model
</p>
</li>
<li> <p><code>fitinfo</code>, a list containing three named objects, <code>g</code> (the
heteroskedastic function), <code>Msq</code> (the elementwise-square of the
annihilator matrix <code class="reqn">M</code>), <code>Z</code> (the design matrix used in the
ANLVM, after feature selection if applicable), and <code>clustering</code>
(a list object with results of the clustering procedure, if applicable).
</p>
</li>
<li> <p><code>selectinfo</code>, a list containing two named objects,
<code>varselect</code> (the value of the eponymous argument), and
<code>selectedcols</code> (a numeric vector with column indices of <code class="reqn">X</code>
that were selected, with <code>1</code> denoting the intercept column)
</p>
</li>
<li> <p><code>qlinfo</code>, a list containing nine named objects: <code>converged</code>
(a logical, indicating whether the Gauss-Newton algorithm converged
for at least one initial value of the parameter vector),
<code>iterations</code> (the number of Gauss-Newton iterations used to
obtain the parameter estimates returned), <code>Smin</code> (the minimum
achieved value of the objective function used in the Gauss-Newton
routine), and six arguments passed to the function (<code>nested</code>,
<code>param.init</code>, <code>maxgridrows</code>, <code>nconvstop</code>,
<code>maxitql</code>, and <code>tolql</code>)
</p>
</li>
</ul>
<h3>References</h3>

<p>Seber GAF, Wild CJ (2003).
<em>Nonlinear Regression</em>.
Wiley, Hoboken, NJ.
</p>


<h3>See Also</h3>

<p><code>alvm.fit</code>, <code>avm.ci</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">mtcars_lm &lt;- lm(mpg ~ wt + qsec + am, data = mtcars)
myanlvm &lt;- anlvm.fit(mtcars_lm, g = function(x) x ^ 2,
 varselect = "qgcv.linear")

</code></pre>


</div>