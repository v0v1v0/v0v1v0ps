<div class="container">

<table style="width: 100%;"><tr>
<td>websocket</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Websocket for 'sketch' applications</h2>

<h3>Description</h3>

<p>This combines the *-Server family of functions in 'httpuv'
with the transpilation functionality provided by 'sketch'.
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>app</code></dt>
<dd>
<p>A list of functions that define the application.</p>
</dd>
<dt><code>server</code></dt>
<dd>
<p>A server handle to be used by 'stopServer'.</p>
</dd>
<dt><code>log</code></dt>
<dd>
<p>A character vector that keep tracks of all the commands
sent to the browser session.</p>
</dd>
<dt><code>ws</code></dt>
<dd>
<p>A WebSocket channel to handle the communication between
the R session and the browser session.</p>
</dd>
<dt><code>in_handler</code></dt>
<dd>
<p>A function to handle instructions sent by the
browser session.</p>
</dd>
<dt><code>out_handler</code></dt>
<dd>
<p>A function to handle instruction sent to the
browser session.</p>
</dd>
<dt><code>env</code></dt>
<dd>
<p>An environment to store variables temporarily.</p>
</dd>
<dt><code>port</code></dt>
<dd>
<p>An integer; the TCP port number.</p>
</dd>
<dt><code>message</code></dt>
<dd>
<p>TRUE or FALSE; whether to display a prompt when
a server is started and when it is stopped.</p>
</dd>
<dt><code>connected</code></dt>
<dd>
<p>TRUE or FALSE; whether a connection has been established.
One should ways start the WebSocket server before visiting the web page
that connects to the server.</p>
</dd>
<dt><code>started</code></dt>
<dd>
<p>TRUE or FALSE; whether a server has been started. Use
the <code>startServer</code> method to start a server.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-websocket-startServer"><code>websocket$startServer()</code></a>
</p>
</li>
<li> <p><a href="#method-websocket-stopServer"><code>websocket$stopServer()</code></a>
</p>
</li>
<li> <p><a href="#method-websocket-listServers"><code>websocket$listServers()</code></a>
</p>
</li>
<li> <p><a href="#method-websocket-stopAllServers"><code>websocket$stopAllServers()</code></a>
</p>
</li>
<li> <p><a href="#method-websocket-sketch_mode"><code>websocket$sketch_mode()</code></a>
</p>
</li>
<li> <p><a href="#method-websocket-new_app"><code>websocket$new_app()</code></a>
</p>
</li>
<li> <p><a href="#method-websocket-new"><code>websocket$new()</code></a>
</p>
</li>
<li> <p><a href="#method-websocket-clone"><code>websocket$clone()</code></a>
</p>
</li>
</ul>
<hr>
<a id="method-websocket-startServer"></a>



<h4>Method <code>startServer()</code>
</h4>

<p>Start a WebSocket server
</p>


<h5>Usage</h5>

<div class="r"><pre>websocket$startServer()</pre></div>


<hr>
<a id="method-websocket-stopServer"></a>



<h4>Method <code>stopServer()</code>
</h4>

<p>Stop a WebSocket server
</p>


<h5>Usage</h5>

<div class="r"><pre>websocket$stopServer()</pre></div>


<hr>
<a id="method-websocket-listServers"></a>



<h4>Method <code>listServers()</code>
</h4>

<p>List all running WebSocket servers
</p>


<h5>Usage</h5>

<div class="r"><pre>websocket$listServers()</pre></div>


<hr>
<a id="method-websocket-stopAllServers"></a>



<h4>Method <code>stopAllServers()</code>
</h4>

<p>Stop all running WebSocket servers
</p>


<h5>Usage</h5>

<div class="r"><pre>websocket$stopAllServers()</pre></div>


<hr>
<a id="method-websocket-sketch_mode"></a>



<h4>Method <code>sketch_mode()</code>
</h4>

<p>Enter sketch mode, in which all commands go through
the transpiler before reaching the browser session.
</p>


<h5>Usage</h5>

<div class="r"><pre>websocket$sketch_mode()</pre></div>


<hr>
<a id="method-websocket-new_app"></a>



<h4>Method <code>new_app()</code>
</h4>

<p>Create a blank HTML page with interactive access.
This function is designed for newcomers.
</p>


<h5>Usage</h5>

<div class="r"><pre>websocket$new_app(
  preamble = list(library = c(), script = c(), data = c()),
  ...
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>preamble</code></dt>
<dd>
<p>(Optional) A named list; the preamble to include.
Use the name 'lib' for arguments to <code>load_library</code>, 'script'
for arguments to <code>load_script</code> and 'data' for arguments to
<code>load_data</code>. Note that the "dom" and "websocket" modules are
required and loaded by default.</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Extra parameters to pass to source_r.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>The (invisible) temporary file path to the app.
</p>


<hr>
<a id="method-websocket-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Initialise a WebSocket connection
</p>


<h5>Usage</h5>

<div class="r"><pre>websocket$new(in_handler, out_handler, message = TRUE, port = 9454)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>in_handler</code></dt>
<dd>
<p>A function to handle incoming message, default to
be print which only displays the message without
any processing.</p>
</dd>
<dt><code>out_handler</code></dt>
<dd>
<p>A function to handle outgoing message, default to
be compile_exprs which transpiles R commands into JavaScript
commands.</p>
</dd>
<dt><code>message</code></dt>
<dd>
<p>TRUE or FALSE; whether to display a prompt when
a server is started and when it is stopped.</p>
</dd>
<dt><code>port</code></dt>
<dd>
<p>An integer; the TCP port number.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>A 'websocket' object.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# Launch a WebSocket server
ws &lt;- websocket$new()
ws$startServer()
ws$listServers()    # Check that a server is running

# Launch a 'sketch' application with WebSocket functionality
file &lt;- system.file("test_files/test_websocket.R", package = "sketch")
source_r(file, debug = TRUE)   # Launch the default browser

# Enter sketch mode to send commands to the application
ws$sketch_mode()
# Within sketch mode
print("1234")
x &lt;- 10
print(x + 1)
q()

# Back to normal mode, inspect the log and stop the server
ws$log
ws$stopServer()
ws$listServers()    # Confirm no server is running
}
</pre>
</div>


<hr>
<a id="method-websocket-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>websocket$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>Examples</h3>

<pre><code class="language-R">
## ------------------------------------------------
## Method `websocket$new`
## ------------------------------------------------

## Not run: 
# Launch a WebSocket server
ws &lt;- websocket$new()
ws$startServer()
ws$listServers()    # Check that a server is running

# Launch a 'sketch' application with WebSocket functionality
file &lt;- system.file("test_files/test_websocket.R", package = "sketch")
source_r(file, debug = TRUE)   # Launch the default browser

# Enter sketch mode to send commands to the application
ws$sketch_mode()
# Within sketch mode
print("1234")
x &lt;- 10
print(x + 1)
q()

# Back to normal mode, inspect the log and stop the server
ws$log
ws$stopServer()
ws$listServers()    # Confirm no server is running

## End(Not run)
</code></pre>


</div>