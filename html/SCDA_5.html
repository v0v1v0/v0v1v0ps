<div class="container">

<table style="width: 100%;"><tr>
<td>SCSR_Estim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate spatially-clustered spatial regression models</h2>

<h3>Description</h3>

<p>Estimates spatially-clustered spatial regression (SCSR) models, such as the spatially-clustered linear regression model (SCLM),
the spatially-clustered spatial autoregressive model (SCSAR), the spatially-clustered spatial durbin model (SCSEM),
and the spatially-clustered linear regression model with spatially-lagged exogenous covariates and response variable (SCSLX).
Estimation is performed via cluster-wise maximum likelihood as presented in &lt;https://arxiv.org/abs/2407.15874&gt;.
</p>


<h3>Usage</h3>

<pre><code class="language-R">SCSR_Estim(
  Formula,
  Data_sf,
  listW,
  G = 2,
  Phi = 1,
  Type = c("SCLM", "SCSAR", "SCSEM", "SCSLX"),
  CenterVars = FALSE,
  ScaleVars = FALSE,
  Maxitr = 100,
  RelTol = 10^-6,
  AbsTol = 10^-5,
  Verbose = TRUE,
  Seed = 123456789
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Formula</code></td>
<td>
<p>a symbolic description of the regression model to be fit. The details of model specification are given for <code>lm(...)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Data_sf</code></td>
<td>
<p>A <code>data.frame</code> object of class <code>sf</code> with n rows (each one corresponding to a location/polygon) and a user-defined number of columns.
The data frame must contain the response variable and all the covariates to be used in the model. Also, it must include the <code>geometry</code> feature for spatial modelling and representation.
Typically, <code>sf</code> <code>data.frame</code> are built using the <code>st_as_sf(...)</code> command from the <code>sf</code> package (see its documentation for details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>listW</code></td>
<td>
<p><code>listw</code> object. It contains the spatial weights for the spatial autoregressive component.
Typically, listW is built using the <code>nb2listw(...)</code> command from the <code>spdep</code> package (see its documentation for details).
We suggest to adopt one of matrix styles suggested in the <code>spdep</code> package, such as <code>W</code> (row-standardized) or <code>B</code> (binary).
We also suggest to adopt a <code>zero.policy = TRUE</code> option to allow the computation of groups/clusters with isolated units. In this regard, we recall that if <code>zero.policy = FALSE</code> and <code>Type = "SCSAR"</code> causes <code>SCSR_Estim(...)</code> to terminate with an error.
See package <code>spatialreg</code> for details on the <code>zero.policy</code> input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>G</code></td>
<td>
<p>Integer value. Number of clusters to be considered. When 'G=1', the pooled regression (no clusterwise) is estimated. Default is 'G = 2'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Phi</code></td>
<td>
<p>Non-negative (&gt;=0) real value. Spatial penalty parameter. Default is 'Phi = 1'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Type</code></td>
<td>
<p>Character. Declares which model specification has to be estimated. Admitted strings are:
</p>

<ul>
<li>
<p><code>"SCLM"</code> for linear regression model without spatial effects (LM);
</p>
</li>
<li>
<p><code>"SCSAR"</code> for spatial autoregressive (SAR) model;
</p>
</li>
<li>
<p><code>"SCSEM"</code> for linear regression model with spatial autoregressive error term or spatial Durbin model (SEM);
</p>
</li>
<li>
<p><code>"SCSLX"</code> for linear regression model with spatially-lagged response variable and covariates (SLX);
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CenterVars</code></td>
<td>
<p><code>Logical</code> value (<code>TRUE</code> or <code>FALSE</code>) stating whether the response variable and the covariates have to be centered around the mean in the iterative algorithm to update memberships and group-wise parameters.
Centering is only use in the iterative procedure, while final estimates provided to the user are computed original (i.e., non-centered) variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ScaleVars</code></td>
<td>
<p><code>Logical</code> value (<code>TRUE</code> or <code>FALSE</code>) stating whether the response variable and the covariates have to be scaled with respect to their standard deviation in the iterative algorithm to update memberships and group-wise parameters.
Scaling is only used in the iterative procedure, while final estimates provided to the user are computed original (i.e., non-scaled) variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Maxitr</code></td>
<td>
<p>Integer value. Maximum number of iterations for the iterative algorithm. Convergence criterion is fixed to  <code class="reqn">\varepsilon</code> = 10^(-5).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RelTol</code></td>
<td>
<p>Tolerance for the relative improvement in the log-likelihood (exit criterion) from iteration k to k+1. Default is <code class="reqn">\varepsilon_{Rel}</code> = 10^-6</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AbsTol</code></td>
<td>
<p>Tolerance for the absolute improvement in the log-likelihood (exit criterion) from iteration k to k+1. Default is <code class="reqn">\varepsilon_{Abs}</code> = 10^-5</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Verbose</code></td>
<td>
<p><code>Logical</code> value (<code>TRUE</code> or <code>FALSE</code>). Toggle warnings and messages. If <code>verbose = TRUE</code> (default) the function
prints on the screen some messages describing the progress of the tasks. If <code>verbose = FALSE</code> any message about the progression is suppressed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Seed</code></td>
<td>
<p>Integer value. Define the random number generator (RNG) state for random number generation in R.
Deafult is <code>seed = 123456789</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The package <code>SCSR</code> computes the spatially-clustered spatial regression models based on the <code>spatialreg</code> package (see &lt;https://cran.r-project.org/web/packages/spatialreg/index.html&gt;).
SCSAR model is estimated using the function <code>lagsarlm</code>; SCSEM model is estimated using the function <code>errorsarlm</code>; SCSLX model is estimated using the function <code>lmSLX</code>.
SCLM model is estimated using the <code>lm</code> function from package <code>stats</code>.
Thus, estimated SCSAR, SCSEM and SCSLX models belong to class <code>Sarlm</code>, while estimated SCLM belongs to class <code>lm</code>.
We kindly refer to the package <code>spatialreg</code> for any detail regarding computational aspects (e.g., optimization).
Also, we refer to the package <code>spdep</code> for computational details on the spatial weighting matrix via <code>listw2mat(...)</code>, <code>nb2listw(...)</code> and <code>nb2mat(...)</code> from the <code>spdep</code> package.
For computional details on the spatially-clustered models, we kindly refer to Cerqueti, R., Maranzano, P. &amp; Mattera, R. "Spatially-clustered spatial autoregressive models with application to agricultural market concentration in Europe". arXiv preprints (&lt;doi:10.48550/arXiv.2407.15874&gt;)
</p>


<h3>Value</h3>

<p>A list object containing the following outputs:
</p>

<ul>
<li>
<p>ClusterFitModels: G-dimensional list containing the estimated clustered regression models of class <code>lm</code> or <code>Sarlm</code>
</p>
</li>
<li>
<p>Beta: (G x p) matrix of cluster-wise or pooled regression coefficients
</p>
</li>
<li>
<p>Sig: G-dimensional vector of cluster-wise standard deviations
</p>
</li>
<li>
<p>VCov: (p x p x G) array of cluster-wise variance-covariance matrices of coefficients
</p>
</li>
<li>
<p>W_g: G-dimensional list containing for the g-th cluster with cardinality n_g a (n_g x n_g) spatial weighting matrix
</p>
</li>
<li>
<p>listW_g: G-dimensional list containing for the g-th cluster the weights list
</p>
</li>
<li>
<p>Group: (n x 1) vector of group assignment
</p>
</li>
<li>
<p>sBeta: (n x p) matrix of location-wise regression coefficients
</p>
</li>
<li>
<p>sSig: (n x 1) vector of location-wise standard deviations
</p>
</li>
<li>
<p>MLE: Estimated maximum log-likelihood
</p>
</li>
<li>
<p>Iter: The number of iteration needed to satisfy the convergence criterion and end up the clustering iterative loop
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">data(Data_RC_PM_RM_JABES2024, package="SCDA")
SCSAR &lt;- SCSR_Estim(Formula = "Gini_SO ~ GDPPC_PPS2020 + Share_AgroEmp",
                    Data_sf = Data2020, G=3, listW=listW, Type="SCSAR", Phi = 0.50)
SCLM &lt;- SCSR_Estim(Formula = "Gini_SO ~ GDPPC_PPS2020 + Share_AgroEmp",
                   Data_sf = Data2020, G=3, listW=listW, Type="SCLM", Phi = 0.50)


</code></pre>


</div>