<div class="container">

<table style="width: 100%;"><tr>
<td>db_locks</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Sets, queries and removes locks for database tables</h2>

<h3>Description</h3>

<p>This set of function adds a simple locking system to database tables.
</p>

<ul>
<li> <p><code>lock_table()</code> adds a record in the schema.locks table with the current time and R-session process id.
</p>
</li>
<li> <p><code>unlock_table()</code> removes records in the schema.locks table with the target table and the R-session process id.
</p>
</li>
</ul>
<p>When locking a table, the function will check for existing locks on the table and produce an error a lock is held
by a process which no longer exists.
In this case, the lock needs to be removed manually by removing the record from the lock table.
In addition, the error implies that a table may have partial updates that needs to be manually rolled back.
</p>


<h3>Usage</h3>

<pre><code class="language-R">lock_table(conn, db_table, schema = NULL)

unlock_table(conn, db_table, schema = NULL, pid = Sys.getpid())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>conn</code></td>
<td>
<p>(<code>DBIConnection(1)</code>)<br>
Connection object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>db_table</code></td>
<td>
<p>(<code>character(1)</code>)<br>
A specification of "schema.table" to modify lock for.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>schema</code></td>
<td>
<p>(<code>character(1)</code>)<br>
The schema where the "locks" table should be created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pid</code></td>
<td>
<p>(<code>numeric(1)</code>)<br>
The process id to remove the lock for.</p>
</td>
</tr>
</table>
<h3>Value</h3>


<ul>
<li> <p><code>lock_table()</code> returns the <code>TRUE</code> (<code>FALSE</code>) if the lock was (un)successfully added.
If a lock exists for a non-active process, an error is thrown.
</p>
</li>
<li> <p><code>unlock_table()</code> returns <code>NULL</code> (called for side effects).
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
  conn &lt;- DBI::dbConnect(RSQLite::SQLite())

  lock_table(conn, "test_table") # TRUE

  unlock_table(conn, "test_table")

  DBI::dbDisconnect(conn)

</code></pre>


</div>