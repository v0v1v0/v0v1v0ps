<div class="container">

<table style="width: 100%;"><tr>
<td>hatMat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Hat Matrix of a Smoother</h2>

<h3>Description</h3>

<p>Compute the hat matrix or smoother matrix, of ‘any’ (linear) smoother,
smoothing splines, by default.
</p>


<h3>Usage</h3>

<pre><code class="language-R">hatMat(x, trace= FALSE,
       pred.sm = function(x, y, ...)
                 predict(smooth.spline(x, y, ...), x = x)$y,
       ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>numeric vector or matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>logical indicating if the whole hat matrix, or only its
trace, i.e. the sum of the diagonal values should be computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred.sm</code></td>
<td>
<p>a function of at least two arguments <code>(x,y)</code>
which returns fitted values, i.e. <code class="reqn">\hat{y}</code>, of length
compatible to <code>x</code> (and <code>y</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optionally further arguments to the smoother function
<code>pred.sm</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The hat matrix <code class="reqn">H</code> (if <code>trace = FALSE</code> as per default) or
a number, <code class="reqn">tr(H)</code>, the <em>trace</em> of <code class="reqn">H</code>, i.e.,
<code class="reqn">\sum_i H_{ii}</code>.
</p>
<p>Note that <code>dim(H) == c(n, n)</code> where <code>n &lt;- length(x)</code> also in
the case where some x values are duplicated (aka <em>ties</em>).
</p>


<h3>Author(s)</h3>

<p>Martin Maechler <a href="mailto:maechler@stat.math.ethz.ch">maechler@stat.math.ethz.ch</a></p>


<h3>References</h3>

<p>Hastie and Tibshirani (1990).
<em>Generalized Additive Models</em>.
Chapman &amp; Hall.
</p>


<h3>See Also</h3>

<p><code>smooth.spline</code>, etc.
Note the demo, <code>demo("hatmat-ex")</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(stats) # for smooth.spline() or loess()

x1 &lt;- c(1:4, 7:12)
H1 &lt;- hatMat(x1, spar = 0.5) # default : smooth.spline()

matplot(x1, H1, type = "l", main = "columns of smoother hat matrix")

## Example 'pred.sm' arguments for hatMat() :
pspl &lt;-  function(x,y,...) predict(smooth.spline(x,y, ...), x = x)$y
pksm &lt;-  function(x,y,...) ksmooth(sort(x),y, "normal", x.points=x, ...)$y
## Rather than ksmooth():
if(require("lokern"))
  pksm2 &lt;- function(x,y,...) glkerns(x,y, x.out=x, ...)$est




## Explaining 'trace = TRUE'
all.equal(sum(diag((hatMat(c(1:4, 7:12), df = 4)))),
                    hatMat(c(1:4, 7:12), df = 4, trace = TRUE), tol = 1e-12)

## ksmooth() :
Hk &lt;- hatMat(x1, pr = pksm, bandwidth = 2)
cat(sprintf("df = %.2f\n", sum(diag(Hk))))
image(Hk)
Matrix::printSpMatrix(as(round(Hk, 2), "sparseMatrix"))

##---&gt;  see demo("hatmat-ex")  for more (and larger) examples

</code></pre>


</div>