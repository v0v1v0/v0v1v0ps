<div class="container">

<table style="width: 100%;"><tr>
<td>7. Genetic covariances computation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Pairwise Genetic Covariance</h2>

<h3>Description</h3>

<p>Calculation of genetic and environmental (unstructured) covariances matrices from pairwise models of variables with the same experimental design
</p>


<h3>Usage</h3>

<pre><code class="language-R">getGenCov(y, X = NULL, Z = NULL, K = NULL, trn = NULL,
          EVD = NULL, ID_geno, ID_trait, scale = TRUE,
          pairwise = TRUE, verbose = TRUE, ...)
          
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>(numeric matrix) Response variable vector. It can be a matrix with each column representing a different response variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>(numeric matrix) Design matrix for fixed effects. When <code>X=NULL</code> a vector of ones is constructed only for the intercept (default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>(numeric matrix) Design matrix for random effects. When <code>Z=NULL</code> an identity matrix is considered (default) thus <b>G</b> = <b>K</b>; otherwise <b>G</b> = <b>Z K Z'</b> is used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>(numeric matrix) Kinship relationship matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trn</code></td>
<td>
<p>(integer vector) Which elements from vector <code>y</code> are to be used for training. When <code>trn = NULL</code>, non-NA entries in vector <code>y</code> will be used as training set</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EVD</code></td>
<td>
<p>(list) Eigenvectors and eigenvalues from eigenvalue decomposition (EVD) of <b>G</b> corresponding to training data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ID_geno</code></td>
<td>
<p>(character/integer) Vector with either names or indices mapping entries of the vector <code>y</code> to rows/columns of matrix <code>G</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ID_trait</code></td>
<td>
<p>(character/integer) Vector with either names or indices mapping entries of the vector <code>y</code> to different traits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code> to scale each column of <code>y</code> by their corresponding standard deviations so the resulting variables will have unit variance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pairwise</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code> to calculate pairwise genetic covariances for all columns in <code>y</code>. When <code>pairwise = FALSE</code> (default) covariances of the first column in <code>y</code> with the remaining columns (2,...,<code>ncol(y)</code>) are calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code> to whether show progress</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed to the function 'fitBLUP'</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Assumes that both <b>y</b><sub>1</sub> and
<b>y</b><sub>2</sub> follow the basic linear mixed model that relates phenotypes with genetic values of the form
</p>
<div style="text-align:center">
<b>y</b><sub>1</sub> = <b>X b</b><sub>1</sub> + <b>Z g</b><sub>1</sub> + <b>e</b><sub>1</sub>
</div>
<div style="text-align:center">
<b>y</b><sub>2</sub> = <b>X b</b><sub>2</sub> + <b>Z g</b><sub>2</sub> + <b>e</b><sub>2</sub>
</div>
<p>where
<b>b</b><sub>1</sub> and 
<b>b</b><sub>2</sub> are the specific fixed effects,
<b>g</b><sub>1</sub> and 
<b>g</b><sub>2</sub> are the specific genetic effects of the genotypes,
<b>e</b><sub>1</sub> and 
<b>e</b><sub>2</sub> are the vectors of specific environmental residuals, and
<b>X</b> and <b>Z</b> are common design matrices for the fixed and genetic effects, respectively. Genetic effects are assumed to follow a Normal distribution as
<b>g</b><sub>1</sub> ~ N(<b>0</b>,σ<sup>2</sup><sub>u1</sub><b>K</b>) and 
<b>g</b><sub>2</sub> ~ N(<b>0</b>,σ<sup>2</sup><sub>u2</sub><b>K</b>), and environmental terms are assumed
<b>e</b><sub>1</sub> ~ N(<b>0</b>,σ<sup>2</sup><sub>e1</sub><b>I</b>) and
<b>e</b><sub>2</sub> ~ N(<b>0</b>,σ<sup>2</sup><sub>e2</sub><b>I</b>).
</p>
<p>The genetic covariance 
σ<sup>2</sup><sub>u1,u2</sub>
is estimated from the formula for the variance for the sum of two variables as 
</p>
<div style="text-align:center">σ<sup>2</sup><sub>u1,u2</sub> = 1/2(σ<sup>2</sup><sub>u3</sub> - σ<sup>2</sup><sub>u1</sub> - σ<sup>2</sup><sub>u2</sub>)</div>
<p>where σ<sup>2</sup><sub>u3</sub>
is the genetic variance of the variable 
<b>y</b><sub>3</sub> = <b>y</b><sub>1</sub> + <b>y</b><sub>2</sub> that also follows the same model as for 
<b>y</b><sub>1</sub> and
<b>y</b><sub>2</sub>.
</p>
<p>Likewise, the environmental covariance 
σ<sup>2</sup><sub>e1,e2</sub>
is estimated as 
</p>
<div style="text-align:center">σ<sup>2</sup><sub>e1,e2</sub> = 1/2(σ<sup>2</sup><sub>e3</sub> - σ<sup>2</sup><sub>e1</sub> - σ<sup>2</sup><sub>e2</sub>)</div>
<p>where σ<sup>2</sup><sub>e3</sub>
is the error variance of the variable 
<b>y</b><sub>3</sub>.
</p>
<p>Solutions are found using the function 'fitBLUP' (see <code>help(fitBLUP)</code>) to sequentialy fit mixed models for all the variables <b>y</b><sub>1</sub>, <b>y</b><sub>2</sub> and
<b>y</b><sub>3</sub>.
</p>


<h3>Value</h3>

<p>Returns a list object that contains the elements:
</p>

<ul>
<li> <p><code>varU</code>: (vector) genetic variances.
</p>
</li>
<li> <p><code>varE</code>: (vector) error variances.
</p>
</li>
<li> <p><code>covU</code>: (vector) genetic covariances between response variable 1 and the rest.
</p>
</li>
<li> <p><code>covE</code>: (vector) environmental covariances between response variable 1 and the rest.
</p>
</li>
</ul>
<p>When <code>pairwise = TRUE</code>, <code>varU</code> and <code>varE</code> are matrices containing all variances (diagonal) and pairwise covariances (off diagonal)
</p>


<h3>Examples</h3>

<pre><code class="language-R">  require(SFSI)
  data(wheatHTP)
  
  index = which(Y$trial %in% 1:10)    # Use only a subset of data
  Y = Y[index,]
  M = scale(M[index,])/sqrt(ncol(M))  # Subset and scale markers
  G = tcrossprod(M)                   # Genomic relationship matrix
  Y0 = scale(as.matrix(Y[,4:7]))      # Response variable
  
  ID_geno = as.vector(row(Y0))
  ID_trait = as.vector(col(Y0))
  y = as.vector(Y0)
  
  # Pairwise covariance for all columns in y
  fm = getGenCov(y=y, K=G, ID_geno=ID_geno, ID_trait=ID_trait)
  fm$varU           # Genetic variances
  fm$varE           # Residual variances
  fm$varU+fm$varE   # Phenotypic covariance
  var(Y0)           # Sample phenotypic covariance
  
  # Covariances between the first and the rest: y[,1] and y[,2:4]
  fm = getGenCov(y=y, K=G, ID_geno=ID_geno, ID_trait=ID_trait, pairwise=FALSE)
  fm$covU           # Genetic covariance between y[,1] and y[,2:4]
  
  # Containing some missing values:
  # The model is estimated from common training data
  YNA = Y0
  YNA[Y$trial %in% 1:2, 1] = NA
  YNA[Y$trial %in% 2:3, 3] = NA
  y = as.vector(YNA)
  
  fm = getGenCov(y=y, K=G, ID_geno=ID_geno, ID_trait=ID_trait)
  fm$varU 
  fm$varE
  
</code></pre>


</div>