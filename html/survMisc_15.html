<div class="container">

<table style="width: 100%;"><tr>
<td>comp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>compare survival curves</h2>

<h3>Description</h3>

<p>compare survival curves
</p>


<h3>Usage</h3>

<pre><code class="language-R">comp(x, ...)

## S3 method for class 'ten'
comp(x, ..., p = 1, q = 1, scores = seq.int(attr(x, "ncg")), reCalc = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>tne</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments (not implemented).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p><code class="reqn">p</code> for Fleming-Harrington test</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p><code class="reqn">q</code> for Fleming-Harrington test</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scores</code></td>
<td>
<p>scores for tests for trend</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reCalc</code></td>
<td>
<p>Recalcuate the values?
<br>
If <code>reCalc=FALSE</code> (the default) and the <code>ten</code> object already has
the calculated values stored as an <code>attribute</code>,
the value of the <code>attribute</code> is returned directly.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <b>log-rank</b> tests are formed from the following elements,
with values for each time where there is at least one event:
</p>

<ul>
<li> <p><code class="reqn">W_i</code>, the weights, given below.
</p>
</li>
<li> <p><code class="reqn">e_i</code>, the number of events (per time).
</p>
</li>
<li> <p><code class="reqn">\hat{e_i}</code>, the number of <em>predicted</em> events,
given by <code>predict</code>.
</p>
</li>
<li> <p><code class="reqn">COV_i</code>, the covariance matrix for time <code class="reqn">i</code>,
given by <code>COV</code>.
</p>
</li>
</ul>
<p>It is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">Q_i = \sum{W_i (e_i - \hat{e}_i)}^T
             \sum{W_i \hat{COV_i} W_i^{-1}}
             \sum{W_i (e_i - \hat{e}_i)}</code>
</p>

<p>If there are <code class="reqn">K</code> groups, then <code class="reqn">K-1</code> are selected (arbitrary).
<br>
Likewise the corresponding variance-covariance matrix is reduced to the
appropriate <code class="reqn">K-1 \times K-1</code> dimensions.
<br><code class="reqn">Q</code> is distributed as chi-square with <code class="reqn">K-1</code> degrees of freedom.
<br><br>
For <code class="reqn">2</code> covariate groups, we can use:
</p>

<ul>
<li> <p><code class="reqn">e_i</code> the number of events (per time).
</p>
</li>
<li> <p><code class="reqn">n_i</code> the number at risk overall.
</p>
</li>
<li> <p><code class="reqn">e1_i</code> the number of events in group <code class="reqn">1</code>.
</p>
</li>
<li> <p><code class="reqn">n1_i</code> the number at risk in group <code class="reqn">1</code>.
</p>
</li>
</ul>
<p>Then:
</p>
<p style="text-align: center;"><code class="reqn">Q = \frac{\sum{W_i [e1_i - n1_i (\frac{e_i}{n_i})]} }{
                \sqrt{\sum{W_i^2 \frac{n1_i}{n_i}
                           (1 - \frac{n1_i}{n_i})
                           (\frac{n_i - e_i}{n_i - 1}) e_i }}}</code>
</p>

<p>Below, for the Fleming-Harrington weights, 
<code class="reqn">\hat{S}(t)</code> is the Kaplan-Meier (product-limit) estimator.
<br>
Note that both <code class="reqn">p</code> and <code class="reqn">q</code> need to be <code class="reqn">\geq 0</code>.
<br><br>
The weights are given as follows:
</p>

<table>
<tr>
<td style="text-align: center;">
 <code class="reqn">1</code> </td>
<td style="text-align: left;"> log-rank </td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: center;">
 <code class="reqn">n_i</code> </td>
<td style="text-align: left;"> Gehan-Breslow generalized Wilcoxon </td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: center;">
 <code class="reqn">\sqrt{n_i}</code> </td>
<td style="text-align: left;"> Tarone-Ware </td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: center;">
 <code class="reqn">S1_i</code> </td>
<td style="text-align: left;"> Peto-Peto's modified survival estimate </td>
<td style="text-align: left;">
                   <code class="reqn">\bar{S}(t)=\prod{1 - \frac{e_i}{n_i + 1}}</code> </td>
</tr>
<tr>
<td style="text-align: center;">
 <code class="reqn">S2_i</code> </td>
<td style="text-align: left;"> modified Peto-Peto (by Andersen) </td>
<td style="text-align: left;">
                    <code class="reqn">\tilde{S}(t)=\bar{S} - \frac{n_i}{n_i + 1}</code> </td>
</tr>
<tr>
<td style="text-align: center;">
 <code class="reqn">FH_i</code> </td>
<td style="text-align: left;"> Fleming-Harrington </td>
<td style="text-align: left;">
                  The weight at <code class="reqn">t_0 = 1</code> and thereafter is:
                   <code class="reqn">\hat{S}(t_{i-1})^p [1-\hat{S}(t_{i-1})^q]</code>
</td>
</tr>
</table>
<p>The <b>supremum (Renyi)</b> family of tests are designed
to detect differences in survival curves which <em>cross</em>.
<br>
That is, an early difference in survival in favor of one group
is balanced by a later reversal.
<br>
The same weights as above are used.
<br>
They are calculated by finding
</p>
<p style="text-align: center;"><code class="reqn">Z(t_i) = \sum_{t_k \leq t_i} W(t_k)[e1_k - n1_k\frac{e_k}{n_k}], \quad i=1,2,...,k</code>
</p>

<p>(which is similar to the numerator used to find <code class="reqn">Q</code>
in the log-rank test for 2 groups above).
<br>
and it's variance:
</p>
<p style="text-align: center;"><code class="reqn">\sigma^2(\tau) = \sum_{t_k \leq \tau} W(t_k)^2 \frac{n1_k n2_k (n_k-e_k) e_k}{n_k^2 (n_k-1)} </code>
</p>

<p>where <code class="reqn">\tau</code> is the largest <code class="reqn">t</code>
where both groups have at least one subject at risk.
<br><br>
Then calculate:
</p>
<p style="text-align: center;"><code class="reqn"> Q = \frac{ \sup{|Z(t)|}}{\sigma(\tau)}, \quad t&lt;\tau </code>
</p>

<p>When the null hypothesis is true,
the distribution of <code class="reqn">Q</code> is approximately
</p>
<p style="text-align: center;"><code class="reqn">Q \sim \sup{|B(x)|, \quad 0 \leq x \leq 1}</code>
</p>

<p>And for a standard Brownian motion (Wiener) process:
</p>
<p style="text-align: center;"><code class="reqn">Pr[\sup|B(t)|&gt;x] = 1 - \frac{4}{\pi}
                          \sum_{k=0}^{\infty}
                          \frac{(- 1)^k}{2k + 1} \exp{\frac{-\pi^2(2k + 1)^2}{8x^2}}</code>
</p>

<p><b>Tests for trend</b> are designed to detect ordered differences in survival curves.
<br>
That is, for at least one group:
</p>
<p style="text-align: center;"><code class="reqn">S_1(t) \geq S_2(t) \geq ... \geq S_K(t) \quad t \leq \tau</code>
</p>

<p>where <code class="reqn">\tau</code> is the largest <code class="reqn">t</code> where all groups have at least one subject at risk.
The null hypothesis is that
</p>
<p style="text-align: center;"><code class="reqn">S_1(t) = S_2(t) = ... = S_K(t) \quad t \leq \tau</code>
</p>

<p>Scores used to construct the test are typically <code class="reqn">s = 1,2,...,K</code>,
but may be given as a vector representing a numeric characteristic of the group.
<br>
They are calculated by finding:
</p>
<p style="text-align: center;"><code class="reqn"> Z_j(t_i) = \sum_{t_i \leq \tau} W(t_i)[e_{ji} - n_{ji} \frac{e_i}{n_i}], 
                   \quad j=1,2,...,K</code>
</p>

<p>The test statistic is:
</p>
<p style="text-align: center;"><code class="reqn">Z = \frac{ \sum_{j=1}^K s_jZ_j(\tau)}{\sqrt{\sum_{j=1}^K \sum_{g=1}^K s_js_g \sigma_{jg}}} </code>
</p>

<p>where <code class="reqn">\sigma</code> is the the appropriate element in the
variance-covariance matrix (see <code>COV</code>).
<br>
If ordering is present, the statistic <code class="reqn">Z</code> will be greater than the 
upper <code class="reqn">\alpha</code>-th
percentile of a standard normal distribution.
</p>


<h3>Value</h3>

<p>The <code>tne</code> object is given
additional <code>attributes</code>.
<br>
The following are always added:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>lrt</code></td>
<td>
<p>The <b>l</b>og-<b>r</b>ank family of <b>t</b>ests</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lrw</code></td>
<td>
<p>The <b>l</b>og-<b>r</b>ank <b>w</b>eights (used in calculating the tests).</p>
</td>
</tr>
</table>
<p>An additional item depends on the number of covariate groups.
<br>
If this is <code class="reqn">=2</code>:
</p>
<table><tr style="vertical-align: top;">
<td><code>sup</code></td>
<td>
<p>The <b>sup</b>remum or Renyi family of tests</p>
</td>
</tr></table>
<p>and if this is <code class="reqn">&gt;2</code>:
</p>
<table><tr style="vertical-align: top;">
<td><code>tft</code></td>
<td>
<p>Tests for trend. This is given as a <code>list</code>, 
with the statistics and the scores used.</p>
</td>
</tr></table>
<h3>Note</h3>

<p>Regarding the Fleming-Harrington weights: 
</p>

<ul>
<li> <p><code class="reqn">p = q = 0</code> gives the log-rank test, i.e. <code class="reqn">W=1</code>
</p>
</li>
<li> <p><code class="reqn">p=1, q=0</code> gives a version of the Mann-Whitney-Wilcoxon test
(tests if populations distributions are identical)
</p>
</li>
<li> <p><code class="reqn">p=0, q&gt;0</code> gives more weight to differences later on
</p>
</li>
<li> <p><code class="reqn">p&gt;0, q=0</code> gives more weight to differences early on
</p>
</li>
</ul>
<p>The example using <code>alloauto</code> data illustrates this.
Here the log-rank statistic
has a p-value of  around 0.5
as the late advantage of allogenic transplants
is offset by the high early mortality. However using
Fleming-Harrington weights of <code class="reqn">p=0, q=0.5</code>,
emphasising differences later in time, gives a p-value of 0.04.
<br>
Stratified models (<code>stratTen</code>) are <em>not</em> yet supported.
</p>


<h3>References</h3>

<p>Gehan A.
A Generalized Wilcoxon Test for Comparing Arbitrarily
Singly-Censored Samples.
Biometrika 1965 Jun. 52(1/2):203–23.
‘<span class="samp">⁠http://www.jstor.org/stable/2333825⁠</span>’ JSTOR
</p>
<p>Tarone RE, Ware J 1977
On Distribution-Free Tests for Equality of Survival Distributions.
<em>Biometrika</em>;<b>64</b>(1):156–60.
‘<span class="samp">⁠http://www.jstor.org/stable/2335790⁠</span>’ JSTOR
</p>
<p>Peto R, Peto J 1972
Asymptotically Efficient Rank Invariant Test Procedures.
<em>J Royal Statistical Society</em> <b>135</b>(2):186–207.
‘<span class="samp">⁠http://www.jstor.org/stable/2344317⁠</span>’ JSTOR
</p>
<p>Fleming TR, Harrington DP, O'Sullivan M 1987
Supremum Versions of the Log-Rank and Generalized Wilcoxon Statistics.
<em>J  American Statistical Association</em> <b>82</b>(397):312–20.
‘<span class="samp">⁠http://www.jstor.org/stable/2289169⁠</span>’ JSTOR
</p>
<p>Billingsly P 1999
<em>Convergence of Probability Measures.</em>
New York: John Wiley &amp; Sons.
‘<span class="samp">⁠http://dx.doi.org/10.1002/9780470316962⁠</span>’ Wiley (paywall)
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Two covariate groups
data("leukemia", package="survival")
f1 &lt;- survfit(Surv(time, status) ~ x, data=leukemia)
comp(ten(f1))
## K&amp;M 2nd ed. Example 7.2, Table 7.2, pp 209--210.
data("kidney", package="KMsurv")
t1 &lt;- ten(Surv(time=time, event=delta) ~ type, data=kidney)
comp(t1, p=c(0, 1, 1, 0.5, 0.5), q=c(1, 0, 1, 0.5, 2))
## see the weights used
attributes(t1)$lrw
## supremum (Renyi) test; two-sided; two covariate groups
## K&amp;M 2nd ed. Example 7.9, pp 223--226.
data("gastric", package="survMisc")
g1 &lt;- ten(Surv(time, event) ~ group, data=gastric)
comp(g1)
## Three covariate groups
## K&amp;M 2nd ed. Example 7.4, pp 212-214.
data("bmt", package="KMsurv")
b1 &lt;- ten(Surv(time=t2, event=d3) ~ group, data=bmt)
comp(b1, p=c(1, 0, 1), q=c(0, 1, 1))
## Tests for trend
## K&amp;M 2nd ed. Example 7.6, pp 217-218.
data("larynx", package="KMsurv")
l1 &lt;- ten(Surv(time, delta) ~ stage, data=larynx)
comp(l1)
attr(l1, "tft")
### see effect of F-H test
data("alloauto", package="KMsurv")
a1 &lt;- ten(Surv(time, delta) ~ type, data=alloauto)
comp(a1, p=c(0, 1), q=c(1, 1))

</code></pre>


</div>