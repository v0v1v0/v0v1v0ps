<div class="container">

<table style="width: 100%;"><tr>
<td>svy2relmer</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Linear mixed models with correlated random effects
</h2>

<h3>Description</h3>

<p>Fits linear mixed models by maximising the profile pairwise composite
likelihood. Allows for correlated random effects, eg, for genetic
relatedness (QTL) models
</p>


<h3>Usage</h3>

<pre><code class="language-R">svy2relmer(formula, design, sterr=TRUE, return.devfun=FALSE, relmat=NULL,
 all.pairs=FALSE, subtract.margins=FALSE )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>

<p>Model formula as in the <code>lme4</code> package, or with terms like
<code>(1|id)</code> for correlated random effects together with the
<code>relmat</code> argument.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>design</code></td>
<td>

<p>A survey design object produced by <code>survey::svydesign</code>. The
pairwise weights will be computed from this design, which must have
separate probabilities or weights for each stage of sampling.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sterr</code></td>
<td>

<p>Estimate standard errors for fixed effects? Set to <code>FALSE</code> for
greater speed when using resampling to get standard errors.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.devfun</code></td>
<td>
<p>If <code>TRUE</code>, return the deviance function as a
component of the object. This will increase the memory use
substantially, but allows for bootstrapping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>relmat</code></td>
<td>
<p> Specifies a list of relatedness matrices that corresponds to one or
more random-effect groupings (eg <code>(1|id)</code> in the <code>formula</code>
together with <code>relmat=list(id=Phi)</code> implies a covariance matrix
of <code>Phi</code> for the random effects before scaling). See Details and
the vignettes.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all.pairs</code></td>
<td>
<p>Use all pairs rather than just correlated pairs?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subtract.margins</code></td>
<td>
<p>If <code>TRUE</code> and <code>all.pairs=TRUE</code>,
compute with all pairs by the faster algorithm involving subtraction
from the marginal likelihood</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is very similar to <code>svy2lme</code> and only the
differences are described here.
</p>
<p>Formula parsing and starting values use code based on the
<code>lme4qtl</code> package.
</p>
<p>In <code>svy2lme</code> and <code>lme4::lmer</code>, the model is based on
independent standard Normal random effects that are transformed to
give random coefficients that might be correlated within observation
but are either identical or independent between observations. In
this function, the basic random effects in a term are multiplied by a square
root of the <code>relmat</code> matrix for that term, giving basic random
effects whose covariance between observations proportional to the
<code>relmat</code> matrix. For example, in a quantitative trait locus
model in genetics, the matrix would be a genetic relatedness matrix.
</p>
<p>The  <code>relmat</code> matrices must have dimnames for matching to the
id variable. It is permissible for the  <code>relmat</code> matrices to
be larger than necessary – eg, containing related units that are
not in the sample – since the dimnames will be used to select the
relevant submatrix. 
</p>
<p>There can be only one random-effect term for each <code>relmat</code> term. If
you need more, make a copy of the term with a different
name.   
</p>
<p>The <code>return.devfun=TRUE</code> option is useful if you want to
examine objects that aren't returned as part of the output. For
example, <code>get("ij", environment(object$devfun))</code> is the set of
pairs used in computation. 
</p>


<h3>Value</h3>

<p><code>svy2relmer</code> returns an object with <code>print</code>, <code>coef</code>, and
<code>vcov</code> methods.
</p>


<h3>Author(s)</h3>

<p>Thomas Lumley
</p>


<h3>References</h3>

<p>Ziyatdinov, A., Vázquez-Santiago, M., Brunel, H. et al. lme4qtl: linear mixed models with flexible covariance structure for genetic studies of related individuals. BMC Bioinformatics 19, 68 (2018). <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-018-2057-x">https://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-018-2057-x</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(milk_subset)
herd_des&lt;- svydesign(id = ~herd + id, prob = ~one + one2, data = milk_subset)

svy2lme(sdMilk ~ lact + log(dim) + (1|herd), design=herd_des, method="general")

svy2relmer(sdMilk ~ lact + log(dim) + (1|id) + (1|herd), design=herd_des,
    relmat = list(id = A_gen))


</code></pre>


</div>