<div class="container">

<table style="width: 100%;"><tr>
<td>sm.variogram</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Confidence intervals and tests based on smoothing an empirical variogram.
</h2>

<h3>Description</h3>

<p>This function constructs an empirical variogram, using the robust form
of construction based on square-root absolute value differences of the
data.  Flexible regression is used to assess a variety of questions about
the structure of the data used to construct the variogram, including 
independence, isotropy and stationarity.  Confidence bands for the underlying
variogram, and reference bands for the independence, isotropy and stationarity
models, can also be constructed under the assumption that the errors in the 
data are approximately normally distributed.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sm.variogram(x, y, h, df.se = "automatic", max.dist = NA, n.zero.dist = 1,
             original.scale = TRUE, varmat = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>a vector or two-column matrix of spatial location values.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>

<p>a vector of responses observed at the spatial locations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>

<p>a smoothing parameter to be used on the distance scale.  A normal kernel
function is used and <code>h</code> is its standard deviation.  However, if
this argument is omitted <code>h</code> will be selected by an approximate
degrees of freedom criterion, controlled by the <code>df</code> parameter.
See <code>sm.options</code> for details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df.se</code></td>
<td>

<p>the degrees of freedom used when smoothing the empirical variogram to estimate
standard errors.  The default value of "automatic" selects the degrees of
smoothing described in the Bowman and Crujeiras (2013) reference below.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.dist</code></td>
<td>

<p>this can be used to constrain the distances used in constructing the variogram.
The default is to use all distances.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.zero.dist</code></td>
<td>

<p>an integer value which sets the lower limit on the number of pairs of data points with distance zero (in other words the number of pairs whose positions are identical) to trigger a separate variogram bin for zero distance.  Repeat observations at the same location can be informative about the variance of  the underlying process. The default for <code>n.zero.dist</code> is 1, which will create a zero bin for any identical pairs.  However, with small numbers of identical pairs the estimated variance associated with the zero bin may be large, so a higher setting of the <code>n.zero.dist</code> argument can be used to amalgamate the zero distances into the adjacent variogram bin.
</p>
<p>This parameter has no effect when <code>model = "isotropic"</code> or <code>model = "stationary"</code> as the number of bins generated by the multiple dimensions becomes large in these cases, and so zero distances are not allocated a special bin.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>original.scale</code></td>
<td>

<p>a logical value which determines whether the plots are constructed on the
original variogram scale (the default) or on the square-root absolute value scale
on which the calculations are performed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varmat</code></td>
<td>

<p>a logical value which determines whether the variance matrix of the estimated
variogram is returned.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>other optional parameters are passed to the <code>sm.options</code>
function, through a mechanism which limits their effect only to this
call of the function.
</p>
<p>An important parameter here is <code>model</code> which, for
<code>sm.variogram</code>, can be set to <code>"none"</code>, <code>"independent"</code>,
<code>"isotropic"</code> or <code>"stationary"</code>.  The latter two cases are appropriate only for 2-d data.
</p>
<p>Other relevant parameters are 
<code>add</code>,
<code>eval.points</code>, 
<code>ngrid</code>, 
<code>se</code>, 
<code>xlab</code>, 
<code>ylab</code>, 
<code>xlim</code>, 
<code>ylim</code>, 
<code>lty</code>;
see the documentation of  <code>sm.options</code> for their
description.  See the details section below for a discussion of
the <code>display</code> and <code>se</code> parameters in this setting.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The reference below describes the statistical methods used in the function.
</p>
<p>Note that, apart from the simple case of the independence model, the calculations
required are extensive and so the function can be slow.
</p>
<p>The <code>display</code> argument has a special meaning for
this function.  Its default value is <code>"binned"</code>, which plots the
binned version of the empirical variogram.  As usual, the value <code>"none"</code>
will suppress the graphical display.  Any other value will lead to a plot 
of the individual differences between all observations.  This will lead
to a very large number of plotted points, unless the dataset is small.
</p>


<h3>Value</h3>

<p>A list with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td>
<code>sqrtdiff</code>, <code>distance</code>
</td>
<td>
<p>the raw differences and distances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>sqrtdiff.mean</code>, <code>distance.mean</code>
</td>
<td>
<p>the binned differences and distances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>the frequencies of the bins</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate</code></td>
<td>
<p>the values of the estimate at the evaluation points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eval.points</code></td>
<td>
<p>the evaluation points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>the value of the smoothing parameter used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ibin</code></td>
<td>
<p>an indicator of the bin in which the distance between
each pair of observations was placed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ipair</code></td>
<td>
<p>the indices of the original observations used to construct each pair</p>
</td>
</tr>
</table>
<p>When <code>model = "isotropic"</code> or <code>model = "stationary"</code> the following components may also be returned, depending on the arguments passed in ... or the settings in <code>sm.options</code>:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>the p-value of the test</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>the standard errors of the binned values (if the argument <code>se</code> was set to <code>TRUE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.band</code></td>
<td>
<p>when an independence model is examined, this gives the standard error of the difference between the smooth estimate and the mean of all the data points, if a reference band has been requested</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>V</code></td>
<td>
<p>the variance matrix of the binned variogram.  When <code>model</code> is set to <code>"isotropic"</code> or <code>"stationary"</code>, the variance matrix is computed under those assumptions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdiff</code></td>
<td>
<p>the standardised difference between the estimate of the variogram and the reference model, evaluated at <code>eval.points</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>levels</code></td>
<td>
<p>the levels of standardised difference at which contours are drawn in the case of <code>model = "isotropy"</code>.</p>
</td>
</tr>
</table>
<h3>Side Effects</h3>

<p>a plot on the current graphical device is produced, unless the option <code>display = "none"</code> is set.  
</p>


<h3>References</h3>

<p>Diblasi, A. and Bowman, A.W. (2001).
On the use of the variogram for checking independence in a Gaussian spatial process.
<em>Biometrics</em>, 57, 211-218.
</p>
<p>Bowman, A.W. and Crujeiras, R.M. (2013).
Inference for variograms.
<em>Computational Statistics and Data Analysis</em>, 66, 19-31.
</p>


<h3>See Also</h3>

<p><code>sm.regression</code>, <code>sm.options</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
with(coalash, {
   Position &lt;- cbind(East, North)
   sm.options(list(df = 6, se = TRUE))

   par(mfrow=c(2,2))
   sm.variogram(Position, Percent, original.scale = FALSE, se = FALSE)
   sm.variogram(Position, Percent, original.scale = FALSE)
   sm.variogram(Position, Percent, original.scale = FALSE, model = "independent")
   sm.variogram(East,     Percent, original.scale = FALSE, model = "independent")
   par(mfrow=c(1,1))
})

# Comparison of Co in March and September
   
with(mosses, {
	
   nbins &lt;- 12
   vgm.m &lt;- sm.variogram(loc.m, Co.m, nbins = nbins, original.scale = TRUE,
                        ylim = c(0, 1.5))
   vgm.s &lt;- sm.variogram(loc.s, Co.s, nbins = nbins, original.scale = TRUE,
                        add = TRUE, col.points = "blue")
                        
   trns &lt;- function(x) (x / 0.977741)^4
   del &lt;- 1000
   plot(vgm.m$distance.mean, trns(vgm.m$sqrtdiff.mean), type = "b",
         ylim = c(0, 1.5), xlab = "Distance", ylab = "Semi-variogram")
   points(vgm.s$distance.mean - del, trns(vgm.s$sqrtdiff.mean), type = "b",
         col = "blue", pch = 2, lty = 2)

   plot(vgm.m$distance.mean, trns(vgm.m$sqrtdiff.mean), type = "b",
         ylim = c(0, 1.5), xlab = "Distance", ylab = "Semi-variogram")
   points(vgm.s$distance.mean - del, trns(vgm.s$sqrtdiff.mean), type = "b",
         col = "blue", pch = 2, lty = 2)
   segments(vgm.m$distance.mean, trns(vgm.m$sqrtdiff.mean - 2 * vgm.m$se),
         vgm.m$distance.mean, trns(vgm.m$sqrtdiff.mean + 2 * vgm.m$se))
   segments(vgm.s$distance.mean - del, trns(vgm.s$sqrtdiff.mean - 2 * vgm.s$se),
         vgm.s$distance.mean - del, trns(vgm.s$sqrtdiff.mean + 2 * vgm.s$se),
         col = "blue", lty = 2)

   mn &lt;- (vgm.m$sqrtdiff.mean + vgm.s$sqrtdiff.mean) / 2
   se &lt;- sqrt(vgm.m$se^2 + vgm.s$se^2)
   plot(vgm.m$distance.mean, trns(vgm.m$sqrtdiff.mean), type = "n",
        ylim = c(0, 1.5), xlab = "Distance", ylab = "Semi-variogram")
   polygon(c(vgm.m$distance.mean, rev(vgm.m$distance.mean)),
        c(trns(mn - se), rev(trns(mn + se))),
        border = NA, col = "lightblue")  
   points(vgm.m$distance.mean, trns(vgm.m$sqrtdiff.mean))
   points(vgm.s$distance.mean, trns(vgm.s$sqrtdiff.mean), col = "blue", pch = 2)

   vgm1 &lt;- sm.variogram(loc.m, Co.m, nbins = nbins, varmat = TRUE, 
                        display = "none")
   vgm2 &lt;- sm.variogram(loc.s, Co.s, nbins = nbins, varmat = TRUE,
                        display = "none")

   nbin  &lt;- length(vgm1$distance.mean)
   vdiff &lt;- vgm1$sqrtdiff.mean - vgm2$sqrtdiff.mean
   tstat &lt;- c(vdiff %*% solve(vgm1$V + vgm2$V) %*% vdiff)
   pval  &lt;- 1 - pchisq(tstat, nbin)
   print(pval)
})

# Assessing isotropy for Hg in March

with(mosses, {
   sm.variogram(loc.m, Hg.m, model = "isotropic")
})

# Assessing stationarity for Hg in September

with(mosses, {
   vgm.sty &lt;- sm.variogram(loc.s, Hg.s, model = "stationary")
   i &lt;- 1
   image(vgm.sty$eval.points[[1]], vgm.sty$eval.points[[2]], vgm.sty$estimate[ , , i],
         col = topo.colors(20))
   contour(vgm.sty$eval.points[[1]], vgm.sty$eval.points[[2]], vgm.sty$sdiff[ , , i],
         col = "red", add = TRUE)
})


## End(Not run)
</code></pre>


</div>