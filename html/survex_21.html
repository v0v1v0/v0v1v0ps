<div class="container">

<table style="width: 100%;"><tr>
<td>model_parts</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Dataset Level Variable Importance for Survival Models</h2>

<h3>Description</h3>

<p>This function calculates variable importance as a change in the loss function after the variable values permutations.
</p>


<h3>Usage</h3>

<pre><code class="language-R">model_parts(explainer, ...)

## S3 method for class 'surv_explainer'
model_parts(
  explainer,
  loss_function = survex::loss_brier_score,
  ...,
  type = "difference",
  output_type = "survival",
  N = 1000
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Arguments passed on to <code>surv_feature_importance</code>, <code>surv_integrated_feature_importance</code>
</p>

<dl>
<dt><code>B</code></dt>
<dd>
<p>numeric, number of permutations to be calculated</p>
</dd>
<dt><code>variables</code></dt>
<dd>
<p>a character vector, names of variables to be included in the calculation</p>
</dd>
<dt><code>variable_groups</code></dt>
<dd>
<p>a list of character vectors of names of explanatory variables. For each vector, a single variable-importance measure is computed for the joint effect of the variables which names are provided in the vector. By default, variable_groups = NULL, in which case variable-importance measures are computed separately for all variables indicated in the variables argument</p>
</dd>
<dt><code>label</code></dt>
<dd>
<p>label of the model, if provides overrides x$label</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loss_function</code></td>
<td>
<p>a function that will be used to assess variable importance, by default <code>loss_brier_score</code> for survival models. The function can be supplied manually but has to have these named parameters (<code>y_true</code>, <code>risk</code>, <code>surv</code>, <code>times</code>), where <code>y_true</code> represents the <code>survival::Surv</code> object with observed times and statuses, <code>risk</code> is the risk score calculated by the model, and <code>surv</code> is the survival function for each observation evaluated at <code>times</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>a character vector, if <code>"raw"</code> the results are losses after the permutation, if <code>"ratio"</code> the results are in the form <code>loss/loss_full_model</code> and if <code>"difference"</code> the results are of the form <code>loss - loss_full_model</code>. Defaults to <code>"difference"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_type</code></td>
<td>
<p>either <code>"survival"</code> or <code>"risk"</code> the type of survival model output that should be used for explanations. If <code>"survival"</code> the explanations are based on the survival function. Otherwise the scalar risk predictions are used by the <code>DALEX::model_profile</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>number of observations that should be sampled for calculation of variable importance. If <code>NULL</code> then variable importance will be calculated on the whole dataset.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><em>Note</em>: This function can be run within <code>progressr::with_progress()</code> to display a progress bar, as the execution can take long, especially on large datasets.
</p>


<h3>Value</h3>

<p>An object of class <code>c("model_parts_survival", "surv_feature_importance")</code>. It's a list with the explanations in the <code>result</code> element.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
rsf_ranger &lt;- ranger::ranger(Surv(time, status) ~ .,
  data = veteran,
  respect.unordered.factors = TRUE,
  num.trees = 100,
  mtry = 3,
  max.depth = 5
)

cph_exp &lt;- explain(cph)

rsf_ranger_exp &lt;- explain(rsf_ranger,
  data = veteran[, -c(3, 4)],
  y = Surv(veteran$time, veteran$status)
)

cph_model_parts_brier &lt;- model_parts(cph_exp)
print(head(cph_model_parts_brier$result))
plot(cph_model_parts_brier)


rsf_ranger_model_parts &lt;- model_parts(rsf_ranger_exp)
print(head(rsf_ranger_model_parts$result))
plot(cph_model_parts_brier, rsf_ranger_model_parts)

</code></pre>


</div>