<div class="container">

<table style="width: 100%;"><tr>
<td>design</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Work with design documents</h2>

<h3>Description</h3>

<p>Work with design documents
</p>


<h3>Usage</h3>

<pre><code class="language-R">design_create(
  cushion,
  dbname,
  design,
  fxnname,
  key = "null",
  value = "doc",
  as = "list",
  ...
)

design_create_(cushion, dbname, design, fxnname, fxn, as = "list", ...)

design_delete(cushion, dbname, design, as = "list", ...)

design_get(cushion, dbname, design, as = "list", ...)

design_head(cushion, dbname, design, ...)

design_info(cushion, dbname, design, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>cushion</code></td>
<td>
<p>A <code>Cushion</code> object. Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dbname</code></td>
<td>
<p>(character) Database name. required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>design</code></td>
<td>
<p>(character) Design document name. this is the design name
without <code style="white-space: pre;">⁠_design/⁠</code>, which is prepended internally. required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fxnname</code></td>
<td>
<p>(character) A function name. required for <code>view_put</code>
and <code>view_put_</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key, value</code></td>
<td>
<p>(character) a key and value, see Examples and Details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Curl args passed on to <code>HttpClient</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fxn</code></td>
<td>
<p>(character) a javascript function. required for <code>view_put_</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>design_create</code> is a slightly easier interface to creating
design documents; it just asks for a function name, the key and a
value, then we create the function for you internally. TO have more
flexibility use <code>view_put_</code> (with underscore on the end) to write the
function yourself.
</p>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

file &lt;- system.file("examples/omdb.json", package = "sofa")
strs &lt;- readLines(file)

## create a database
if ("omdb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="omdb"))
}
db_create(x, dbname='omdb')

## add the documents
invisible(db_bulk_create(x, "omdb", strs))

# Create a view, the easy way, but less flexible
design_create(x, dbname='omdb', design='view1', fxnname="foobar1")
design_create(x, dbname='omdb', design='view2', fxnname="foobar2",
  value="doc.Country")
design_create(x, dbname='omdb', design='view5', fxnname="foobar3",
  value="[doc.Country,doc.imdbRating]")

# the harder way, write your own function, but more flexible
design_create_(x, dbname='omdb', design='view22',
  fxnname = "stuffthings", fxn = "function(doc){emit(null,doc.Country)}")

# Delete a view
design_delete(x, dbname='omdb', design='view1')

# Get info on a design document
## HEAD request, returns just response headers
design_head(x, dbname='omdb', design='view2')
design_head(x, dbname='omdb', design='view5')
## GET request, returns information about the design document
design_info(x, dbname='omdb', design='view2')
design_info(x, dbname='omdb', design='view5')

# Get a design document (GET request)
design_get(x, dbname='omdb', design='view2')
design_get(x, dbname='omdb', design='view5')

# Search using a view
res &lt;- design_search(x, dbname='omdb', design='view2', view='foobar2')
head(
  do.call(
    "rbind.data.frame",
    lapply(res$rows, function(x) Filter(length, x))
  )
)

res &lt;- design_search(x, dbname='omdb', design='view5', view='foobar3')
head(
  structure(do.call(
    "rbind.data.frame",
    lapply(res$rows, function(x) x$value)
  ), .Names = c('Country', 'imdbRating'))
)

## End(Not run)
</code></pre>


</div>