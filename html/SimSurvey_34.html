<div class="container">

<table style="width: 100%;"><tr>
<td>sim_nlf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Define a non-linear relationship</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a>
</p>
<p>Closure to be used in <code>sim_distribution</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim_nlf(
  formula = ~alpha - ((depth - mu)^2)/(2 * sigma^2),
  coeff = list(alpha = 0, mu = 200, sigma = 70)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Formula describing parametric relationships between data and coefficients.
The data used in <code>sim_distribution</code> are grid coordinates expanded
across ages and years (i.e., includes columns <code>"x", "y", "depth", "cell",
                "division", "strat", "age", "year"</code>). Values of the coefficients must be
included in argument <code>coeff</code> as a named list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coeff</code></td>
<td>
<p>Named list of coefficient values used in <code>formula</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a function for use inside <code>sim_distribution</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Make a grid and replicate data for 5 ages and 5 years
## (This is similar to what happens inside sim_distribution)
grid &lt;- make_grid(shelf_width = 10)
grid_xy &lt;- data.frame(grid)
i &lt;- rep(seq(nrow(grid_xy)), times = 5)
a &lt;- rep(1:5, each = nrow(grid_xy))
grid_xy &lt;- grid_xy[i, ]
grid_xy$age &lt;- a
i &lt;- rep(seq(nrow(grid_xy)), times = 5)
y &lt;- rep(1:5, each = nrow(grid_xy))
grid_xy &lt;- grid_xy[i, ]
grid_xy$year &lt;- y

## Now using sim_nlf, produce a function to apply to the expanded grid_xy data
## For this firs example, the depth effect is parabolic and the vertex is deeper by age
## (i.e., to impose ontogenetic deepening)
nlf &lt;- sim_nlf(formula = ~ alpha - ((depth - mu + beta * age) ^ 2) / (2 * sigma ^ 2),
               coeff = list(alpha = 0, mu = 200, sigma = 70, beta = -70))
grid_xy$depth_effect &lt;- nlf(grid_xy)

library(plotly)
grid_xy %&gt;%
  filter(year == 1) %&gt;%
  plot_ly(x = ~depth, y = ~depth_effect, split = ~age) %&gt;%
  add_lines()

</code></pre>


</div>