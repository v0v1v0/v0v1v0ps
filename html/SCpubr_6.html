<div class="container">

<table style="width: 100%;"><tr>
<td>do_CellularStatesPlot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cellular States plot.</h2>

<h3>Description</h3>

<p>This plot aims to show the relationships between distinct enrichment scores. If 3 variables are provided, the relationship is between the Y axis and the dual X axis.
If 4 variables are provided, each corner of the plot represents how enriched the cells are in that given list. How to interpret this? In a 3-variable plot, the Y axis
just means one variable. The higher the cells are in the Y axis the more enriched they are in that given variable. The X axis is a dual parameter one. Cells falling
into each extreme of the axis are highly enriched for either x1 or x2, while cells falling in between are not enriched for any of the two. In a 4-variable plot, each corner
shows the enrichment for one of the 4 given features. Cells will tend to locate in either of the four corners, but there will be cases of cells locating mid-way between two
given corners (enriched in both features) or in the middle of the plot (not enriched for any).
</p>


<h3>Usage</h3>

<pre><code class="language-R">do_CellularStatesPlot(
  sample,
  input_gene_list,
  x1,
  y1,
  x2 = NULL,
  y2 = NULL,
  group.by = NULL,
  colors.use = NULL,
  legend.position = "bottom",
  legend.icon.size = 4,
  legend.ncol = NULL,
  legend.nrow = NULL,
  legend.byrow = FALSE,
  plot.title = NULL,
  plot.subtitle = NULL,
  plot.caption = NULL,
  font.size = 14,
  font.type = "sans",
  xlab = NULL,
  ylab = NULL,
  axis.ticks = TRUE,
  axis.text = TRUE,
  verbose = FALSE,
  enforce_symmetry = FALSE,
  plot_marginal_distributions = FALSE,
  marginal.type = "density",
  marginal.size = 5,
  marginal.group = TRUE,
  plot_cell_borders = TRUE,
  plot_enrichment_scores = FALSE,
  border.size = 2,
  border.color = "black",
  pt.size = 2,
  raster = FALSE,
  raster.dpi = 1024,
  plot_features = FALSE,
  features = NULL,
  use_viridis = TRUE,
  viridis.palette = "G",
  viridis.direction = 1,
  sequential.palette = "YlGnBu",
  sequential.direction = -1,
  nbin = 24,
  ctrl = 100,
  number.breaks = 5,
  plot.title.face = "bold",
  plot.subtitle.face = "plain",
  plot.caption.face = "italic",
  axis.title.face = "bold",
  axis.text.face = "plain",
  legend.title.face = "bold",
  legend.text.face = "plain"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sample</code></td>
<td>
<p><strong><code>Seurat</code></strong> | A Seurat object, generated by CreateSeuratObject.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_gene_list</code></td>
<td>
<p><strong><code>named_list</code></strong> | Named list of lists of genes to be used as input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x1</code></td>
<td>
<p><strong><code>character</code></strong> | A name of a list from input_gene_list. First feature in the X axis. Will go on the right side of the X axis if y2 is not provided and top-right quadrant if provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y1</code></td>
<td>
<p><strong><code>character</code></strong> | A name of a list from input_gene_list. First feature on the Y axis. Will become the Y axis if y2 is not provided and bottom-right quadrant if provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x2</code></td>
<td>
<p><strong><code>character</code></strong> | A name of a list from input_gene_list. Second feature on the X axis. Will go on the left side of the X axis if y2 is not provided and top-left quadrant if provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y2</code></td>
<td>
<p><strong><code>character</code></strong> | A name of a list from input_gene_list. Second feature on the Y axis. Will become the bottom-left quadrant if provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group.by</code></td>
<td>
<p><strong><code>character</code></strong> | Metadata variable to group the output by. Has to be a character of factor column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colors.use</code></td>
<td>
<p><strong><code>named_vector</code></strong> | Named vector of valid color representations (either name of HEX codes) with as many named colors as unique values of group.by. If group.by is not provided, defaults to the unique values of Idents. If not provided, a color scale will be set by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend.position</code></td>
<td>
<p><strong><code>character</code></strong> | Position of the legend in the plot. One of:
</p>

<ul>
<li> <p><em><code>top</code></em>: Top of the figure.
</p>
</li>
<li> <p><em><code>bottom</code></em>: Bottom of the figure.
</p>
</li>
<li> <p><em><code>left</code></em>: Left of the figure.
</p>
</li>
<li> <p><em><code>right</code></em>: Right of the figure.
</p>
</li>
<li> <p><em><code>none</code></em>: No legend is displayed.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend.icon.size</code></td>
<td>
<p><strong><code>numeric</code></strong> | Size of the icons in legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend.ncol</code></td>
<td>
<p><strong><code>numeric</code></strong> | Number of columns in the legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend.nrow</code></td>
<td>
<p><strong><code>numeric</code></strong> | Number of rows in the legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend.byrow</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether the legend is filled by row or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.title, plot.subtitle, plot.caption</code></td>
<td>
<p><strong><code>character</code></strong> | Title, subtitle or caption to use in the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>font.size</code></td>
<td>
<p><strong><code>numeric</code></strong> | Overall font size of the plot. All plot elements will have a size relationship with this font size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>font.type</code></td>
<td>
<p><strong><code>character</code></strong> | Base font family for the plot. One of:
</p>

<ul>
<li> <p><em><code>mono</code></em>: Mono spaced font.
</p>
</li>
<li> <p><em><code>serif</code></em>: Serif font family.
</p>
</li>
<li> <p><em><code>sans</code></em>: Default font family.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab, ylab</code></td>
<td>
<p><strong><code>character</code></strong> | Titles for the X and Y axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axis.ticks</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to show axis ticks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axis.text</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to show axis text.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to show extra comments, warnings,etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enforce_symmetry</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to enforce the plot to follow a symmetry (3 variables, the X axis has 0 as center, 4 variables, all axis have the same range and the plot is squared).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_marginal_distributions</code></td>
<td>
<p><strong><code>logical</code></strong> |  Whether to plot marginal distributions on the figure or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marginal.type</code></td>
<td>
<p><strong><code>character</code></strong> | One of:
</p>

<ul>
<li> <p><em><code>density</code></em>: Compute density plots on the margins.
</p>
</li>
<li> <p><em><code>histogram</code></em>: Compute histograms on the margins.
</p>
</li>
<li> <p><em><code>boxplot</code></em>: Compute boxplot on the margins.
</p>
</li>
<li> <p><em><code>violin</code></em>: Compute violin plots on the margins.
</p>
</li>
<li> <p><em><code>densigram</code></em>: Compute densigram plots on the margins.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marginal.size</code></td>
<td>
<p><strong><code>numeric</code></strong> | Size ratio between the main and marginal plots. A value of 5 means that the main plot is 5 times bigger than the marginal plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marginal.group</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to group the marginal distribution by group.by or current identities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_cell_borders</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to plot border around cells.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_enrichment_scores</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to report enrichment scores for the input lists as plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>border.size</code></td>
<td>
<p><strong><code>numeric</code></strong> | Width of the border of the cells.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>border.color</code></td>
<td>
<p><strong><code>character</code></strong> | Color for the border of the heatmap body.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pt.size</code></td>
<td>
<p><strong><code>numeric</code></strong> | Size of the dots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raster</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to raster the resulting plot. This is recommendable if plotting a lot of cells.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raster.dpi</code></td>
<td>
<p><strong><code>numeric</code></strong> | Pixel resolution for rasterized plots. Defaults to 1024. Only activates on Seurat versions higher or equal than 4.1.0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_features</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to also report any other feature onto the primary plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>features</code></td>
<td>
<p><strong><code>character</code></strong> | Additional features to plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_viridis</code></td>
<td>
<p><strong><code>logical</code></strong> | Whether to use viridis color scales.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>viridis.palette</code></td>
<td>
<p><strong><code>character</code></strong> | A capital letter from A to H or the scale name as in scale_fill_viridis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>viridis.direction</code></td>
<td>
<p><strong><code>numeric</code></strong> | Either 1 or -1. Controls how the gradient of viridis scale is formed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sequential.palette</code></td>
<td>
<p><strong><code>character</code></strong> | Type of sequential color palette to use. Out of the sequential palettes defined in <strong><code>brewer.pal</code></strong>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sequential.direction</code></td>
<td>
<p><strong><code>numeric</code></strong> | Direction of the sequential color scale. Either 1 or -1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbin</code></td>
<td>
<p><strong><code>numeric</code></strong> | Number of bins to use in AddModuleScore.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ctrl</code></td>
<td>
<p><strong><code>numeric</code></strong> | Number of genes in the control set to use in AddModuleScore.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number.breaks</code></td>
<td>
<p><strong><code>numeric</code></strong> | Controls the number of breaks in continuous color scales of ggplot2-based plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.title.face, plot.subtitle.face, plot.caption.face, axis.title.face, axis.text.face, legend.title.face, legend.text.face</code></td>
<td>
<p><strong><code>character</code></strong> | Controls the style of the font for the corresponding theme element.  One of:
</p>

<ul>
<li> <p><em><code>plain</code></em>: For normal text.
</p>
</li>
<li> <p><em><code>italic</code></em>: For text in itallic.
</p>
</li>
<li> <p><em><code>bold</code></em>: For text in bold.
</p>
</li>
<li> <p><em><code>bold.italic</code></em>: For text both in itallic and bold.
</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This plots are based on the following publications:
</p>

<ul>
<li>
<p> Neftel, C. <em>et al</em>. An Integrative Model of Cellular States, Plasticity, and Genetics for Glioblastoma. Cell 178, 835-849.e21 (2019). <a href="https://doi.org/10.1016/j.cell.2019.06.024">doi:10.1016/j.cell.2019.06.024</a>
</p>
</li>
<li>
<p> Tirosh, I., Venteicher, A., Hebert, C. <em>et al</em>. Single-cell RNA-seq supports a developmental hierarchy in human oligodendroglioma. Nature 539, 309–313 (2016). <a href="https://doi.org/10.1038/nature20123">doi:10.1038/nature20123</a>
</p>
</li>
</ul>
<h3>Value</h3>

<p>A ggplot2 object containing a butterfly plot.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
  # Check Suggests.
  value &lt;- SCpubr:::check_suggests(function_name = "do_CellularStatesPlot", passive = TRUE)

  if (isTRUE(value)){
    # Consult the full documentation in https://enblacar.github.io/SCpubr-book/

    # Define your Seurat object.
    sample &lt;- readRDS(system.file("extdata/seurat_dataset_example.rds", package = "SCpubr"))

    # Define some gene sets to query. It has to be a named list.
    gene_set &lt;- list("A" = rownames(sample)[1:10],
                     "B" = rownames(sample)[11:20],
                     "C" = rownames(sample)[21:30],
                     "D" = rownames(sample)[31:40])

    # Using two variables: A scatter plot X vs Y.
    p &lt;- SCpubr::do_CellularStatesPlot(sample = sample,
                                       input_gene_list = gene_set,
                                       x1 = "A",
                                       y1 = "B",
                                       nbin = 1,
                                       ctrl = 10)
    p


    # Using three variables. Figure from: https://www.nature.com/articles/nature20123.
    p &lt;- SCpubr::do_CellularStatesPlot(sample = sample,
                                       input_gene_list = gene_set,
                                       x1 = "A",
                                       y1 = "B",
                                       x2 = "C",
                                       nbin = 1,
                                       ctrl = 10)
    p


    # Using four variables. Figure from: https://pubmed.ncbi.nlm.nih.gov/31327527/
    p &lt;- SCpubr::do_CellularStatesPlot(sample = sample,
                                       input_gene_list = gene_set,
                                       x1 = "A",
                                       y1 = "C",
                                       x2 = "B",
                                       y2 = "D",
                                       nbin = 1,
                                       ctrl = 10)
    p
  } else if (base::isFALSE(value)){
    message("This function can not be used without its suggested packages.")
    message("Check out which ones are needed using `SCpubr::state_dependencies()`.")
  }


</code></pre>


</div>