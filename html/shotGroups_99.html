<div class="container">

<table style="width: 100%;"><tr>
<td>mvnEll</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multivariate normal offset ellipse probabilities</h2>

<h3>Description</h3>

<p>Probability of an offset ellipsoid for a correlated multivariate normal distribution. Offset circle probabilities are a special case.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pmvnEll(r=1, sigma = diag(2), mu, e, x0, lower.tail = TRUE,
        method_cdf = c('integrate', 'saddlepoint'))
        
qmvnEll(p,   sigma = diag(2), mu, e, x0, lower.tail = TRUE,
        loUp=NULL, method_cdf = c('integrate', 'saddlepoint'))

rmvnEll(n,   sigma = diag(2), mu, e, x0,
        method = c('eigen', 'chol', 'cdf'), loUp=NULL,
        method_cdf = c('integrate', 'saddlepoint'))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>vector of radii for the offset ellipse defined by <code>e</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>vector of probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>number of observations. If <code>length(n) &gt; 1</code>, the length is taken to be the number required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>true positive definite covariance matrix of multivariate normal distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>true center of multivariate normal distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>positive definite matrix characterizing the offset ellipse defined by (x-x0)' e (x-x0) &lt; r^2. If the ellipse defined by <code>e</code> has semi-axis lengths equal to the square root of the eigenvalues of a matrix S, and is oriented along the eigenvectors of S, then e = S^-1. By default a circle.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x0</code></td>
<td>
<p>center of the offset ellipse.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>string indicating which method to use for generating random deviates. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loUp</code></td>
<td>
<p>search interval for numerical root finding. Either a vector with the lower and upper interval boundary, a list of such vectors, or an (n x 2)-matrix. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower.tail</code></td>
<td>
<p>logical. If <code>TRUE</code> (default), probabilities are <code class="reqn">P[X \le x]</code> otherwise, <code class="reqn">P[X &gt; x]</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method_cdf</code></td>
<td>
<p>string indicating which method to use for calculating the sum of non-central chi^2 variables. See details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>pmvnEll</code> is implemented by first transforming the integration region to the unit disc/sphere, then decorrelating the normal distribution through rotation. Finally, the quadratic form (sum of non-central chi^2 variables) is calculated depending on <code>method_cdf</code>. For <code>method_cdf='integrate'</code>, numerical integration using <code>farebrother</code> is chosen, for <code>method_cdf='saddlepoint'</code>, Kuonen's (1999) saddlepoint approximation. Note that the equation for the cumulant generating function K has a missing zeta in the numerator of the second term in Kuonen (1999), see Imhof (1961) instead. Lower tail probabilities are calculated as '1 - upper tail probability', so loss of accuracy is likely when the upper tail probability is very small (&lt;1e-9).
</p>
<p><code>qmvnEll</code> is implemented through numerical root finding of <code>pmvnEll</code>. If no search interval for <code>uniroot</code> is provided, the quantiles of an approximating non-central chi^2 distribution are used to determine the search intervals.
</p>
<p><code>rmvnEll</code> with <code>method='eigen'</code> or with <code>method='chol'</code> simulates 2D normal deviates based on <code>sigma</code> and <code>mu</code>, and then determines the radius around <code>x0</code>. <code>rmvnEll</code> with <code>method='cdf'</code> is much slower as it performs numerical root finding of <code>pmvnEll</code> given simulated quantiles from a uniform random variable in (0,1). If no search interval for <code>uniroot</code> is provided, the quantiles of an approximating non-central chi^2 distribution are used to determine the search intervals.
</p>
<p>See <code>Hoyt</code> for the distribution of radial error around the true center of correlated bivariate normal variables with unequal variances. See <code>Rice</code> for the distribution of radial error around an offset center for uncorrelated bivariate normal variables with equal variances. See <code>Rayleigh</code> for the distribution of radial error around the true center of uncorrelated bivariate normal variables with equal variances.
</p>


<h3>Value</h3>

<p><code>pmvnEll</code> integrates the multivariate normal distribution over an arbitrary ellipsoid and thus gives the cumulative distribution function. <code>qmvnEll</code> gives the quantile function, <code>rmvnEll</code> generates random deviates.
</p>
<p>The functions are vectorized in <code>r</code> and <code>p</code> but not in the remaining parameters.
</p>


<h3>References</h3>

<p>DiDonato, A. R., &amp; Jarnagin, M. P. (1961a). Integration of the general bivariate Gaussian
distribution over an offset circle. Mathematics of Computation, 15 (76), 375-382.
</p>
<p>DiDonato, A. R., &amp; Jarnagin, M. P. (1961b). Integration of the general bivariate Gaussian distribution over an offset ellipse (NWL TR 1710). Dahlgren, VA: U.S. Naval Weapons Laboratory.
</p>
<p>Duchesne, P., &amp; Lafaye de Micheaux, P. (2010). Computing the distribution of quadratic forms:
Further comparisons between the Liu-Tang-Zhang approximation and exact methods.
Computational Statistics and Data Analysis, 54, 858-862.
</p>
<p>Imhof, J. P. (1961). Computing the distribution of quadratic forms in normal variables. Biometrika, 48, 419-426.
</p>
<p>Kuonen D. (1999). Saddlepoint Approximations for Distributions of Quadratic Forms in Normal Variables. Biometrika, 86, 929-935.
</p>


<h3>See Also</h3>

<p><code>Hoyt</code>,
<code>farebrother</code>,
<code>uniroot</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># define a bivariate normal distribution
mu    &lt;- c(2, -1)                        # true mean
sigma &lt;- cbind(c(10, 6), c(6, 10))       # covariance matrix

# define circular integration region
ctr &lt;- c(1, 0)                           # center
e1  &lt;- diag(2)                           # circle
r   &lt;- 2                                 # radius
pmvnEll(r,   sigma=sigma, mu=mu, e=e1, x0=ctr) # probability
qmvnEll(0.5, sigma=sigma, mu=mu, e=e1, x0=ctr) # quantile
rmvnEll(5,   sigma=sigma, mu=mu, e=e1, x0=ctr) # random numbers

# define elliptical integration region
S  &lt;- cbind(c(3.5, -0.3), c(-0.3, 1.7))
e2 &lt;- solve(S)
pmvnEll(r,   sigma=sigma, mu=mu, e=e2, x0=ctr) # probability
qmvnEll(0.5, sigma=sigma, mu=mu, e=e2, x0=ctr) # quantile
rmvnEll(5,   sigma=sigma, mu=mu, e=e2, x0=ctr) # random numbers

# plot all regions
evSig &lt;- eigen(sigma)$values
evS   &lt;- eigen(S)$values
xLims &lt;- range(c( mu[1]+c(-1, 1)*sqrt(evSig[1]),
                 ctr[1]+c(-r, r)*sqrt(evS[1])))
yLims &lt;- range(c( mu[2]+c(-1.25, 1.25)*sqrt(evSig[1]),
                 ctr[2]+c(-r, r)*sqrt(evS[1])))

plot(xLims, yLims, type="n", asp=1)
points(mu[1],  mu[2],  pch=16, cex=2, col="black")
points(ctr[1], ctr[2], pch=15, cex=2, col="blue")
drawEllipse(mu, sigma, r=0.75, fg="black")
drawEllipse(mu, sigma, r=1,    fg="black")
drawEllipse(mu, sigma, r=1.25, fg="black")
drawEllipse(mu, sigma, r=1.5,  fg="black")
drawEllipse(ctr, e1, r=r, fg="blue")
drawEllipse(ctr, S,  r=r, fg="red")
legend(x="bottomright", legend=c("normal iso-densities",
       "integration circle", "integration ellipse"),
       lty=1, col=c("black", "blue", "red"))
</code></pre>


</div>