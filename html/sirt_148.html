<div class="container">

<table style="width: 100%;"><tr>
<td>rm.facets</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Rater Facets Models with Item/Rater Intercepts and Slopes
</h2>

<h3>Description</h3>

<p>This function estimates the unidimensional rater facets model (Lincare, 1994)
and an extension to slopes (see Details; Robitzsch &amp; Steinfeld, 2018). The estimation
is conducted by an EM algorithm employing marginal
maximum likelihood.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rm.facets(dat, pid=NULL, rater=NULL, Qmatrix=NULL, theta.k=seq(-9, 9, len=30),
    est.b.rater=TRUE, est.a.item=FALSE, est.a.rater=FALSE, rater_item_int=FALSE,
    est.mean=FALSE, tau.item.fixed=NULL, a.item.fixed=NULL, b.rater.fixed=NULL,
    a.rater.fixed=NULL, b.rater.center=2, a.rater.center=2, a.item.center=2, a_lower=.05,
    a_upper=10, reference_rater=NULL, max.b.increment=1, numdiff.parm=0.00001,
    maxdevchange=0.1, globconv=0.001, maxiter=1000, msteps=4, mstepconv=0.001,
    PEM=FALSE, PEM_itermax=maxiter)

## S3 method for class 'rm.facets'
summary(object, file=NULL, ...)

## S3 method for class 'rm.facets'
anova(object,...)

## S3 method for class 'rm.facets'
logLik(object,...)

## S3 method for class 'rm.facets'
IRT.irfprob(object,...)

## S3 method for class 'rm.facets'
IRT.factor.scores(object, type="EAP", ...)

## S3 method for class 'rm.facets'
IRT.likelihood(object,...)

## S3 method for class 'rm.facets'
IRT.posterior(object,...)

## S3 method for class 'rm.facets'
IRT.modelfit(object,...)

## S3 method for class 'IRT.modelfit.rm.facets'
summary(object, ...)

## function for processing data
rm_proc_data( dat, pid, rater, rater_item_int=FALSE, reference_rater=NULL )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>

<p>Original data frame. Ratings on variables must be in rows,
i.e. every row corresponds to a person-rater combination.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pid</code></td>
<td>

<p>Person identifier.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rater</code></td>
<td>

<p>Rater identifier
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Qmatrix</code></td>
<td>

<p>An optional Q-matrix. If this matrix is not provided,
then by default the ordinary scoring of categories
(from 0 to the maximum score of <code class="reqn">K</code>) is used.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta.k</code></td>
<td>

<p>A grid of theta values for the ability distribution.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est.b.rater</code></td>
<td>

<p>Should the rater severities <code class="reqn">b_r</code> be estimated?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est.a.item</code></td>
<td>

<p>Should the item slopes <code class="reqn">a_i</code> be estimated?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est.a.rater</code></td>
<td>

<p>Should the rater slopes <code class="reqn">a_r</code> be estimated?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rater_item_int</code></td>
<td>
<p>Logical indicating whether rater-item-interactions
should be modeled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est.mean</code></td>
<td>
<p>Optional logical indicating whether the mean of the
trait distribution should be estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau.item.fixed</code></td>
<td>
<p>Matrix with fixed <code class="reqn">\tau</code> parameters. Non-fixed
parameters must be declared by <code>NA</code> values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a.item.fixed</code></td>
<td>
<p>Vector with fixed item discriminations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b.rater.fixed</code></td>
<td>
<p>Vector with fixed rater intercept parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a.rater.fixed</code></td>
<td>
<p>Vector with fixed rater discrimination parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b.rater.center</code></td>
<td>
<p>Centering method for rater intercept parameters. The
value <code>0</code> corresponds to no centering, the values <code>1</code> and
<code>2</code> to different methods to ensure that they sum to zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a.rater.center</code></td>
<td>
<p>Centering method for rater discrimination parameters. The
value <code>0</code> corresponds to no centering, the values <code>1</code> and
<code>2</code> to different methods to ensure that their product equals one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a.item.center</code></td>
<td>
<p>Centering method for item discrimination parameters. The
value <code>0</code> corresponds to no centering, the values <code>1</code> and
<code>2</code> to different methods to ensure that their product equals one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a_lower</code></td>
<td>
<p>Lower bound for <code class="reqn">a</code> parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a_upper</code></td>
<td>
<p>Upper bound for <code class="reqn">a</code> parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reference_rater</code></td>
<td>
<p>Identifier for rater as a reference rater for which
a fixed rater mean of 0 and a fixed rater slope of 1 is assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.b.increment</code></td>
<td>

<p>Maximum increment of item parameters during estimation
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numdiff.parm</code></td>
<td>

<p>Numerical differentiation step width
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxdevchange</code></td>
<td>

<p>Maximum relative deviance change as a convergence criterion
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>globconv</code></td>
<td>

<p>Maximum parameter change
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>

<p>Maximum number of iterations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>msteps</code></td>
<td>

<p>Maximum number of iterations during an M step
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mstepconv</code></td>
<td>

<p>Convergence criterion in an M step
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PEM</code></td>
<td>
<p>Logical indicating whether the P-EM acceleration should be
applied (Berlinet &amp; Roland, 2012).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PEM_itermax</code></td>
<td>
<p>Number of iterations in which the P-EM method should be
applied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>

<p>Object of class <code>rm.facets</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>Optional file name in which summary should be written.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Factor score estimation method. Factor score types
<code>"EAP"</code>, <code>"MLE"</code> and <code>"WLE"</code> are supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Further arguments to be passed
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function models ratings <code class="reqn">X_{pri}</code>
for person <code class="reqn">p</code>, rater <code class="reqn">r</code> and item <code class="reqn">i</code>
and category <code class="reqn">k</code> (see also Robitzsch &amp; Steinfeld, 2018; Uto &amp; Ueno, 2010; Wu, 2017)
</p>
<p style="text-align: center;"><code class="reqn">P( X_{pri}=k | \theta_p ) \propto
    \exp( a_i a_r q_{ik} \theta_p - q_{ik} b_r -   \tau_{ik} ) \quad,
    \quad \theta_p \sim N( 0, \sigma^2 )</code>
</p>

<p>By default, the scores in the <code class="reqn">Q</code> matrix are
<code class="reqn">q_{ik}=k</code>. Item slopes <code class="reqn">a_i</code> and rater slopes
<code class="reqn">a_r</code> are standardized such that their product equals
one, i.e. <code class="reqn"> \prod_i a_i=\prod_r a_r=1</code>.
</p>


<h3>Value</h3>

<p>A list with following entries:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>deviance</code></td>
<td>
<p>Deviance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ic</code></td>
<td>
<p>Information criteria and number of parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>item</code></td>
<td>
<p>Data frame with item parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rater</code></td>
<td>
<p>Data frame with rater parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>person</code></td>
<td>
<p>Data frame with person parameters: EAP and corresponding
standard errors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EAP.rel</code></td>
<td>
<p>EAP reliability</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>Mean of the trait distribution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>Standard deviation of the trait distribution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta.k</code></td>
<td>
<p>Grid of theta values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi.k</code></td>
<td>
<p>Fitted distribution at <code>theta.k</code> values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau.item</code></td>
<td>
<p>Item parameters <code class="reqn">\tau_{ik}</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.tau.item</code></td>
<td>
<p>Standard error of item parameters <code class="reqn">\tau_{ik}</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a.item</code></td>
<td>
<p>Item slopes <code class="reqn">a_i</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.a.item</code></td>
<td>
<p>Standard error of item slopes <code class="reqn">a_i</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta.item</code></td>
<td>
<p>Delta item parameter. See
<code>pcm.conversion</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b.rater</code></td>
<td>
<p>Rater severity parameter <code class="reqn">b_r</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.b.rater</code></td>
<td>
<p>Standard error of rater severity parameter <code class="reqn">b_r</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a.rater</code></td>
<td>
<p>Rater slope parameter <code class="reqn">a_r</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.a.rater</code></td>
<td>
<p>Standard error of rater slope parameter <code class="reqn">a_r</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f.yi.qk</code></td>
<td>
<p>Individual likelihood</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f.qk.yi</code></td>
<td>
<p>Individual posterior distribution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>
<p>Item probabilities at grid <code>theta.k</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.ik</code></td>
<td>
<p>Expected counts</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxK</code></td>
<td>
<p>Maximum number of categories</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>procdata</code></td>
<td>
<p>Processed data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>Number of iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ipars.dat2</code></td>
<td>
<p>Item parameters for expanded dataset <code>dat2</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further values</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>If the trait standard deviation <code>sigma</code> strongly
differs from 1, then a user should investigate the sensitivity
of results using different theta integration points <code>theta.k</code>.
</p>


<h3>References</h3>

<p>Berlinet, A. F., &amp; Roland, C. (2012).
Acceleration of the EM algorithm: P-EM versus epsilon algorithm.
<em>Computational Statistics &amp; Data Analysis, 56</em>(12), 4122-4137.
</p>
<p>Linacre, J. M. (1994). <em>Many-Facet Rasch Measurement</em>.
Chicago: MESA Press.
</p>
<p>Robitzsch, A., &amp; Steinfeld, J. (2018). Item response models for human ratings: Overview,
estimation methods, and implementation in R.
<em>Psychological Test and Assessment Modeling, 60</em>(1), 101-139.
</p>
<p>Uto, M., &amp; Ueno, M. (2016). Item response theory for peer assessment.
<em>IEEE Transactions on Learning Technologies, 9</em>(2), 157-170.
</p>
<p>Wu, M. (2017). Some IRT-based analyses for interpreting rater effects.
<em>Psychological Test and Assessment Modeling, 59</em>(4), 453-470.
</p>


<h3>See Also</h3>

<p>See also the <span class="pkg">TAM</span> package for the estimation
of more complicated facet models.
</p>
<p>See <code>rm.sdt</code> for estimating a hierarchical rater model.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#############################################################################
# EXAMPLE 1: Partial Credit Model and Generalized partial credit model
#                   5 items and 1 rater
#############################################################################
data(data.ratings1)
dat &lt;- data.ratings1

# select rater db01
dat &lt;- dat[ paste(dat$rater)=="db01", ]

#****  Model 1: Partial Credit Model
mod1 &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], pid=dat$idstud )

#****  Model 2: Generalized Partial Credit Model
mod2 &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ],  pid=dat$idstud, est.a.item=TRUE)

summary(mod1)
summary(mod2)

## Not run: 
#############################################################################
# EXAMPLE 2: Facets Model: 5 items, 7 raters
#############################################################################

data(data.ratings1)
dat &lt;- data.ratings1

#****  Model 1: Partial Credit Model: no rater effects
mod1 &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], rater=dat$rater,
             pid=dat$idstud, est.b.rater=FALSE )

#****  Model 2: Partial Credit Model: intercept rater effects
mod2 &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], rater=dat$rater, pid=dat$idstud)

# extract individual likelihood
lmod1 &lt;- IRT.likelihood(mod1)
str(lmod1)
# likelihood value
logLik(mod1)
# extract item response functions
pmod1 &lt;- IRT.irfprob(mod1)
str(pmod1)
# model comparison
anova(mod1,mod2)
# absolute and relative model fit
smod1 &lt;- IRT.modelfit(mod1)
summary(smod1)
smod2 &lt;- IRT.modelfit(mod2)
summary(smod2)
IRT.compareModels( smod1, smod2 )
# extract factor scores (EAP is the default)
IRT.factor.scores(mod2)
# extract WLEs
IRT.factor.scores(mod2, type="WLE")

#****  Model 2a: compare results with TAM package
#   Results should be similar to Model 2
library(TAM)
mod2a &lt;- TAM::tam.mml.mfr( resp=dat[, paste0( "k",1:5) ],
             facets=dat[, "rater", drop=FALSE],
             pid=dat$pid, formulaA=~ item*step + rater )

#****  Model 2b: Partial Credit Model: some fixed parameters
# fix rater parameters for raters 1, 4 and 5
b.rater.fixed &lt;- rep(NA,7)
b.rater.fixed[ c(1,4,5) ] &lt;- c(1,-.8,0)  # fixed parameters
# fix item parameters of first and second item
tau.item.fixed &lt;- round( mod2$tau.item, 1 )    # use parameters from mod2
tau.item.fixed[ 3:5, ] &lt;- NA    # free item parameters of items 3, 4 and 5
mod2b &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], rater=dat$rater,
             b.rater.fixed=b.rater.fixed, tau.item.fixed=tau.item.fixed,
             est.mean=TRUE, pid=dat$idstud)
summary(mod2b)

#****  Model 3: estimated rater slopes
mod3 &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], rater=dat$rater,
            est.a.rater=TRUE)

#****  Model 4: estimated item slopes
mod4 &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], rater=dat$rater,
             pid=dat$idstud, est.a.item=TRUE)

#****  Model 5: estimated rater and item slopes
mod5 &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], rater=dat$rater,
             pid=dat$idstud, est.a.rater=TRUE, est.a.item=TRUE)
summary(mod1)
summary(mod2)
summary(mod2a)
summary(mod3)
summary(mod4)
summary(mod5)

#****  Model 5a: Some fixed parameters in Model 5
# fix rater b parameters for raters 1, 4 and 5
b.rater.fixed &lt;- rep(NA,7)
b.rater.fixed[ c(1,4,5) ] &lt;- c(1,-.8,0)
# fix rater a parameters for first four raters
a.rater.fixed &lt;- rep(NA,7)
a.rater.fixed[ c(1,2,3,4) ] &lt;- c(1.1,0.9,.85,1)
# fix item b parameters of first item
tau.item.fixed &lt;- matrix( NA, nrow=5, ncol=3 )
tau.item.fixed[ 1, ] &lt;- c(-2,-1.5, 1 )
# fix item a parameters
a.item.fixed &lt;- rep(NA,5)
a.item.fixed[ 1:4 ] &lt;- 1
# estimate model
mod5a &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], rater=dat$rater,
             pid=dat$idstud, est.a.rater=TRUE, est.a.item=TRUE,
             tau.item.fixed=tau.item.fixed, b.rater.fixed=b.rater.fixed,
             a.rater.fixed=a.rater.fixed, a.item.fixed=a.item.fixed,
             est.mean=TRUE)
summary(mod5a)

#****  Model 6: Estimate rater model with reference rater 'db03'
mod6 &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], rater=dat$rater, est.a.item=TRUE,
             est.a.rater=TRUE, pid=dat$idstud, reference_rater="db03" )
summary(mod6)

#**** Model 7: Modelling rater-item-interactions
mod7 &lt;- sirt::rm.facets( dat[, paste0( "k",1:5) ], rater=dat$rater, est.a.item=FALSE,
             est.a.rater=TRUE, pid=dat$idstud, reference_rater="db03",
             rater_item_int=TRUE)
summary(mod7)

## End(Not run)
</code></pre>


</div>