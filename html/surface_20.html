<div class="container">

<table style="width: 100%;"><tr>
<td>surfaceForward</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Adding Regimes to a Hansen Model
</h2>

<h3>Description</h3>

<p>Carries out the forward phase of SURFACE's stepwise AIC routine, adding regime shifts to a Hansen model. <code>addRegime</code> performs one step of this analysis, and is called repeatedly by <code>surfaceForward</code>. At each step, the delta-AICc of each possible shift placement (i.e. branch) is calculated, and an updated Hansen model is returned with one shift added. This process is iterated until the model stops improving beyond a threshold delta-AICc
</p>


<h3>Usage</h3>

<pre><code class="language-R">surfaceForward(otree, odata, starting_list=NULL, starting_shifts=NULL, 
exclude=0,  aic_threshold=0, max_steps=NULL, save_steps=FALSE, 
filename="temp_out_list.R", verbose=FALSE, plotaic=FALSE, 
error_skip=FALSE, sample_shifts=FALSE, sample_threshold=2)
addRegime(otree, odata, oldshifts, oldaic, oldfit, alloldaic=NULL, 
exclude=NULL, aic_threshold=0, verbose=FALSE, plotaic=FALSE, 
error_skip=FALSE, sample_shifts=FALSE, sample_threshold=2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>otree</code></td>
<td>

<p>Phylogenetic tree in <code>ouchtree</code> format
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>odata</code></td>
<td>

<p>Data frame with rownames corresponding to <code>otree@labels</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>starting_list</code></td>
<td>

<p>An optional list which may containing either a partially completed analysis (which can be built upon instead of starting over), or a custom starting model created with <code>startingModel</code>, which may include some pre-specified shifts 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>starting_shifts</code></td>
<td>

<p>An optional named character vector of shifts that are required to be in the Hansen model, which will be passed to <code>startingModel</code> when the initial model is built 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude</code></td>
<td>

<p>Optionally, the proportion of the worst models (AICc scores for each shift point) to exclude in the current round (defaults to zero; values greater than 0.5 are not recommended)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aic_threshold</code></td>
<td>

<p>Change in AICc needed to accept a candidate model as a sufficient improvement over the previous iteration of SURFACE. Defaults to zero, meaning any improvement in the AICc will be accepted; more stringent thresholds are specified using *negative* values of <code>aic_threshold</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_steps</code></td>
<td>

<p>Maximum number of regimes to allow to be added (assuming the model improvement continues to exceed <code>aic_threshold</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_steps</code></td>
<td>

<p>A logical indicating whether to save the current iteration of the model at each step (overwriting previous iterations) to a file <code>filename</code> (defaults to <code>FALSE</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>

<p>Name of the file to save progress to at each step, if <code>savesteps=TRUE</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>A logical indicating whether to print progress (defaults to <code>FALSE</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotaic</code></td>
<td>

<p>A logical indicating whether to plot AICc values of candidate models at each step (defaults to <code>FALSE</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error_skip</code></td>
<td>

<p>A logical indicating whether to skip over any candidate model that produces an error message (this is rare, but can cause an entire analysis to abort; defaults to <code>FALSE</code>) 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_shifts</code></td>
<td>

<p>A logical indicating whether to sample from among the best models at each step (those within <code>sample_threshold</code> of the best AICc), rather than always selecting the best candidate model (defaults to <code>FALSE</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_threshold</code></td>
<td>

<p>Number of AICc units within which to sample among candidate models that are close to as good as the best model at each step (defaults to 2, but only used if <code>sample_shifts=TRUE</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oldshifts</code></td>
<td>

<p>Any shifts present in the previous iteration of the Hansen model
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oldaic</code></td>
<td>

<p>AICc value for the Hansen model from the previous iteration
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oldfit</code></td>
<td>

<p>Previous fitted Hansen model
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alloldaic</code></td>
<td>

<p>AICc values for each tested shift point in the previous iteration
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Can be time-consuming, as many likelihood searches are carried out at each iteration. Depending on the number of traits and taxa and the number of regimes that are fitted, <code>surfaceForward</code> can take anywhere from minutes to many hours (only tree sizes up to 128 taxa have been tested). Options to manage computation time include adding regimes one at a time with <code>addRegime</code> or using <code>max_steps</code> to perform the analysis several iterations at a time
</p>


<h3>Value</h3>

<p><code>addRegime</code> returns a list describing one iteration of the forward phase of the SURFACE analysis; <code>surfaceForward</code> returns a list of such lists consisting of each step of the stepwise process
</p>
<table>
<tr style="vertical-align: top;">
<td><code>fit </code></td>
<td>
<p>The fitted Hansen model selected for improving the AICc most over the previous iteration; consists of a single <code>hansentree</code> object if the number of traits <code>m = 1</code>, or a list of <code>hansentree</code> objects if <code>m &gt; 1</code> </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all_aic </code></td>
<td>
<p>The AICc for each model tested during the iteration (numbered by branch)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aic </code></td>
<td>
<p>The AICc of the current Hansen model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savedshifts </code></td>
<td>
<p>The shifts present in the current Hansen model; represented as a named character vector of regime shifts (lower-case letters), with names indicating branches containing shifts</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_regimes </code></td>
<td>
<p>A two-element vector of the number of regime shifts and the number of distinct regimes in the current model</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Travis Ingram
</p>


<h3>References</h3>

<p>Butler, M.A. &amp; King, A.A. (2004) Phylogenetic comparative analysis: a modeling approach for adaptive evolution. American Naturalist 164: 683-695.
</p>
<p>Ingram, T. &amp; Mahler, D.L. (2013) SURFACE: detecting convergent evolution from comparative data by fitting Ornstein-Uhlenbeck models with stepwise AIC. Methods in Ecology and Evolution 4: 416-425. 
</p>
<p>Mahler, D.L., Ingram, T., Revell, L.J. &amp; Losos, J.B. (2013) Exceptional convergence on the macroevolutionary landscape in island lizard radiations. Science 341: 292-295.
</p>


<h3>See Also</h3>

<p><code>surfaceBackward</code>, <code>surfaceSimulate</code>, <code>surfaceTreePlot</code>, <code>surfaceSummary</code>, <code>convertTreeData</code>, <code>startingModel</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">	## Not run: 
data(surfaceDemo)
tree&lt;-surfaceDemo$tree
dat&lt;-surfaceDemo$sim$dat
olist&lt;-convertTreeData(tree,dat)
otree&lt;-olist[[1]]; odata&lt;-olist[[2]]
fwd&lt;-surfaceForward(otree, odata, aic_threshold = 0, exclude = 0)
	
## End(Not run)
</code></pre>


</div>