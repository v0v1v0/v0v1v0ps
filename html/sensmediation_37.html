<div class="container">

<table style="width: 100%;"><tr>
<td>sensmediation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate natural direct and indirect effects based on parametric regression models and perform sensitivity analysis</h2>

<h3>Description</h3>

<p>Function to estimate the natural direct and indirect effects based on parametric regression models. Standard errors for the effects are calculated using the delta method.
The function also gives sensitivity analysis results for unobserved confounding. Implements methods introduced in Lindmark, de Luna and Eriksson (2018).
</p>


<h3>Usage</h3>

<pre><code class="language-R">sensmediation(
  med.model,
  out.model,
  exp.model = NULL,
  exp.name = NULL,
  med.name = NULL,
  type = "my",
  Rho = 0,
  progress = TRUE,
  conf.level = 0.95,
  covariates = NULL,
  alt.decomposition = FALSE,
  control.value = 0,
  exp.value = 1,
  covariance = NULL,
  med.full = NULL,
  out.full = NULL,
  all.interactions = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>med.model</code></td>
<td>
<p>Fitted <code>glm</code> model object representing the mediator model at the basis of the estimation (see Details for more information).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out.model</code></td>
<td>
<p>Fitted <code>glm</code> model object representing the outcome model at the basis of the estimation (see Details for more information).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp.model</code></td>
<td>
<p>Fitted <code>glm</code> model object representing the exposure model. Should be provided if <code>type="zm"</code> or <code>type="zy"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp.name</code></td>
<td>
<p>A character string indicating the name of the exposure variable used in the models. Needs to match the name of the exposure found in the output from the fitted glm-models (this is especially important to check for exposures of class <code>factor</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>med.name</code></td>
<td>
<p>A character string indicating the name of the mediator used in the models. Needs to match the name of the mediator found in the output from the outcome glm-model (this is especially important to check for mediators of class <code>factor</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>the type of confounding for which the sensitivity analysis is to be performed. <code>type="my"</code>, the default, corresponds to unobserved mediator-outcome confounding, <code>type="zm"</code> to exposure-mediator confounding and <code>type="zy"</code> to exposure-outcome confounding.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rho</code></td>
<td>
<p>The sensitivity parameter vector. If <code>type="my"</code> the correlation between the error terms in the mediator and outcome models. If <code>type="zm"</code> the correlation between the error terms in the exposure and mediator models. If <code>type="zy"</code> the correlation between the error terms in the exposure and outcome models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>Logical, indicating whether or not the progress (i.e. the <code>proc.time</code> for each <code>Rho</code>) of the optimization will be output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>the confidence level to be used for confidence intervals and uncertainty intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>if conditional effects are to be estimated the named list of covariate values (see Details). Covariates not specified are marginalized over.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alt.decomposition</code></td>
<td>
<p>logical indicating whether or not alternative definitions of the direct and indirect effects should be used (see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control.value</code></td>
<td>
<p>value of the exposure variable used as the control (unexposed) condition, default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp.value</code></td>
<td>
<p>value of the exposure variable used as the exposure condition, default is 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariance, med.full, out.full, all.interactions</code></td>
<td>
<p>arguments used in previous versions of the package that are now deprecated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to be passed on to the <code>maxLik</code> function. Can be used to set the <code>method</code> and <code>control</code> arguments of the <code>maxLik</code> function (see <code>coefs.sensmed</code>).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To obtain the ML estimates of the regression parameters used to calculate mediation effects and perform sensitivity analysis
<code>sensmediation</code> calls <code>coefs.sensmed</code>. The maximization of the log-likelihood is performed using
<code>maxLik</code>, the default is to use the Newton-Raphson method and an analytic gradient and Hessian.
</p>
<p>The mediator and outcome models (and exposure model for <code>type = "zm"</code> or <code>"zy"</code>) should be fitted using <code>glm</code> and can be of two types, probit models (<code>family = binomial(link = 'probit')</code>)
for binary mediators or outcomes (exposures) and linear regression models (<code>family = gaussian</code>) for
continuous mediators or outcomes (exposures). Note that the exposure can either be binary or continuous, categorical exposures with more than two levels are not currently supported. The outcome model may contain exposure-mediator, exposure-covariate,
mediator-covariate and exposure-mediator-covariate interactions. The mediator model may contain exposure-covariate interactions.
All models may also contain interactions between covariates. Note, however that interactions may not be included in a model without
also including the main effects of the interacting variables. That is, interactions should be specified either as <code>X1*X2</code> or
<code>X1 + X2 + X1:X2</code>, not as <code>X1:X2</code> alone.
</p>
<p>To obtain results conditional on specific covariate values, these values should be provided through the <code>covariates</code> argument as a named list (see Examples).
The effects will be averaged over covariates not specified in the list.
</p>
<p>The total effect can be decomposed into a direct and indirect effect in different ways. Let z be the exposure value and z* the control (unexposed) value.
The default is to give the decomposition into the "pure direct effect" <code>E(Y(z,M(z*)))-E(Y(z*,M(z*)))</code> (here denoted NDE) and the "total indirect effect"
<code>E(Y(z,M(z)))-E(Y(z,M(z*)))</code> (denoted NIE). Setting <code>alt.decomposition=TRUE</code>
instead gives the decomposition into the "total direct effect" <code>E(Y(z,M(z)))-E(Y(z*,M(z)))</code> (here denoted NDE*) and "pure indirect effect"
<code>E(Y(z*,M(z)))-E(Y(z*,M(z*)))</code> (denoted NIE*).
</p>
<p>Standard errors for the effects are calculated using the delta method. Confidence intervals (CI) for (and p-values for tests of) the natural direct and indirect effects for each value of the
sensitivity parameter are constructed based on a normal approximation. Uncertainty intervals (UI) are constructed as the union of all CIs over the sensitivity parameter
vector.
</p>


<h3>Value</h3>

<p><code>sensmediation</code> returns an object of class <code>"effectsMed"</code>.
</p>
<p>The function <code>summary</code> (<code>summary.effectsMed</code>) gives a summary of the results in the form of a table with the estimated
effects and results of the sensitivity analysis. The function <code>plot</code> (<code>plot.effectsMed</code>) plots the estimated natural
indirect or direct effects with confidence intervals over the range of the sensitivity parameter.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>The matched call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rho</code></td>
<td>
<p>The sensitivity parameter vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>character, the type of confounding the sensitivity analysis is performed for.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coefs.sensmed</code></td>
<td>
<p>a list with the output from <code>coefs.sensmed</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NIE</code></td>
<td>
<p>matrix with the estimated NIEs (or NIE*s if <code>alt.decomposition=TRUE</code>) over the range of the sensitivity parameter <code>Rho</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NDE</code></td>
<td>
<p>matrix with the estimated NDEs (or NDE*s if <code>alt.decomposition=TRUE</code>) over the range of the sensitivity parameter <code>Rho</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std.errs</code></td>
<td>
<p>list with the standard errors of the NIE (NIE*), NDE (NDE*) and total effect over the range of the sensitivity parameter <code>Rho</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI</code></td>
<td>
<p>a list with the confidence intervals of the NIE (NIE*), NDE (NDE*) and total effect over the range of the sensitivity parameter <code>Rho</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>UI</code></td>
<td>
<p>matrix with the uncertainty intervals for the NIE (NIE*) and NDE (NDE*) over the range of the sensitivity parameter <code>Rho</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>numeric, the confidence level used for confidence intervals and uncertainty intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>list of the covariate values that the effects are conditioned on.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp.name</code></td>
<td>
<p>character vector containing the name of the exposure variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>med.name</code></td>
<td>
<p>character vector containing the name of the mediator variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp.value</code></td>
<td>
<p>value of the exposure variable used as the exposure condition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control.value</code></td>
<td>
<p>value of the exposure variable used as the control (unexposed) condition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alt.decomposition</code></td>
<td>
<p>logical, indicating whether the alternative definitions of the direct and indirect effects have been used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>med.model</code></td>
<td>
<p>the mediator model input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out.model</code></td>
<td>
<p>the outcome model input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betas</code></td>
<td>
<p>list of the estimated mediator model parameters over <code>Rho</code>, with
</p>

<ul>
<li> <p><code>beta0</code> Intercept
</p>
</li>
<li> <p><code>beta1</code> Exposure
</p>
</li>
<li> <p><code>beta2</code> Covariates
</p>
</li>
<li> <p><code>beta3</code> Exposure-covariate interactions
</p>
</li>
</ul>
<p>Components that are not included in the input mediator model are set to 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thetas</code></td>
<td>
<p>list of the estimated outcome model parameters over <code>Rho</code>, with
</p>

<ul>
<li> <p><code>theta0</code> Intercept
</p>
</li>
<li> <p><code>theta1</code> Exposure
</p>
</li>
<li> <p><code>theta2</code> Mediator
</p>
</li>
<li> <p><code>theta3</code> Exposure-mediator interaction
</p>
</li>
<li> <p><code>theta4</code> Covariates
</p>
</li>
<li> <p><code>theta5</code> Exposure-covariate interactions
</p>
</li>
<li> <p><code>theta6</code> Mediator-covariate interactions
</p>
</li>
<li> <p><code>theta7</code> Exposure-mediator-covariate interactions
</p>
</li>
</ul>
<p>Components that are not included in the input outcome model are set to 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>part.deriv</code></td>
<td>
<p>List with the partial derivatives of the NDE (Lambda), NIE (Gamma) and TE (Eta) wrt the mediator and outcome model parameters for each value of <code>Rho</code>. See <code>partdevs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma.thetabeta</code></td>
<td>
<p>a list with the joint covariance matrix of the outcome and mediator model parameters for each value of <code>Rho</code>. Note that the covariance matrix is constructed for all estimated parameters listed in <code>betas</code> and <code>thetas</code> but that components not included in the input mediator and outcome models are set to 0.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Anita Lindmark
</p>


<h3>References</h3>

<p>Lindmark, A., de Luna, X., Eriksson, M. (2018) Sensitivity Analysis for Unobserved Confounding of Direct and Indirect Effects Using Uncertainty Intervals, <em>Statistics in Medicine</em>, <b>37(10)</b>, pp 1744–1762, doi:10.1002/sim.7620.
</p>
<p>Lindmark A (2022). Sensitivity analysis for unobserved confounding in causal mediation analysis allowing for effect modification, censoring and truncation. <em>Statistical Methods &amp; Applications</em>, <b>31</b>, pp 785–814, doi:10.1007/s10260-021-00611-4.
</p>


<h3>See Also</h3>

<p><code>more.effects</code> which can be used to calculate additional direct and indirect effects with sensitivity analysis using the same sensitivity parameter without running the optimization again.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Example with data from Riksstroke (the Swedish stroke register)

data(RSdata)

# Probit mediator and outcome models:
m.model &lt;- glm(lowered.consc ~ AF + age.cat + sex, data = RSdata,
   family = binomial(link = 'probit'))
o.model &lt;- glm(cf.3mo ~ AF + lowered.consc + age.cat + sex, data = RSdata,
   family = binomial(link = 'probit'))

# Estimation of NIE, NDE and sensitivity analyses to mediator-outcome confounding:
# (note that the name of the exposure is "AF1" to match the name in coef(out.model))
sensmed &lt;- sensmediation(m.model, o.model, exp.name = "AF1", med.name = "lowered.consc",
   Rho = c(0, 0.1))
summary(sensmed)
plot(sensmed)
plot(sensmed, effect = "direct")

## Not run: 
# Conditional effects and sensitivity analysis to mediator-outcome confounding using
# more.effects():
sensmed.cond &lt;- more.effects(sensmed.object = sensmed,
   covariates = list(sex = 1, age.cat = "70-79"))
summary(sensmed.cond)

## End(Not run)

## Not run: 
## Sensitivity analysis to exposure-mediator confounding:
  e.model &lt;- glm(AF ~ age.cat + sex, data = RSdata,
     family = binomial(link = 'probit'))

  sensmed.zm &lt;- sensmediation(med.model = m.model, out.model = o.model,
     exp.model = e.model, type = "zm", Rho = seq(0, 0.5, 0.1), exp.name = "AF1",
     med.name = "lowered.consc")

  summary(sensmed.zm)

## End(Not run)

## Not run: 
# Additional effects using more.effects:
# Results with conf.level = 0.99:
sensmed.zm.99 &lt;- more.effects(sensmed.object = sensmed.zm, conf.level = 0.99)
summary(sensmed.zm.99)

## End(Not run)

## Not run: 
# Examples with simulated data, continuous exposure:

require(mvtnorm)

n &lt;- 1000
set.seed(102677)

x &lt;- rnorm(n)
z &lt;- -0.5 + 0.1*x + rnorm(n)
R &lt;- 0.5
Sigma &lt;- cbind(c(1,R), c(R,1))
epsilon &lt;- rmvnorm(n, sigma = Sigma)
m &lt;- -1.2 + 0.8*z + 0.13*x + epsilon[,1]
y &lt;- -1 + 0.05*z + 3*m + 0.5*x + epsilon[,2]

# Models:
z.model &lt;- glm(z ~ x)
m.model2 &lt;- glm(m ~ z + x)
y.model &lt;- glm(y ~ z + m + x)

## Estimation of NIE, NDE. Note that the exposure condition is 2
## so effects are calculated for a 2 unit increase of the exposure:
eff.contz &lt;- sensmediation(med.model = m.model2, out.model = y.model,
           exp.name = "z", med.name = "m", control.value = 0, exp.value = 2)
summary(eff.contz)

## End(Not run)

</code></pre>


</div>