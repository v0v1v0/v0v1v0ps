<div class="container">

<table style="width: 100%;"><tr>
<td>mcmc.3pno.testlet</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
3PNO Testlet Model
</h2>

<h3>Description</h3>

<p>This function estimates the 3PNO testlet model (Wang, Bradlow &amp; Wainer, 2002, 2007)
by Markov Chain Monte Carlo methods (Glas, 2012).
</p>


<h3>Usage</h3>

<pre><code class="language-R">mcmc.3pno.testlet(dat, testlets=rep(NA, ncol(dat)),
   weights=NULL, est.slope=TRUE, est.guess=TRUE, guess.prior=NULL,
   testlet.variance.prior=c(1, 0.2), burnin=500, iter=1000,
   N.sampvalues=1000, progress.iter=50, save.theta=FALSE, save.gamma.testlet=FALSE )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>

<p>Data frame with dichotomous item responses for <code class="reqn">N</code> persons and <code class="reqn">I</code> items
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testlets</code></td>
<td>

<p>An integer or character vector which indicates the allocation of items to
testlets. Same entries corresponds to same testlets.
If an entry is <code>NA</code>, then this item does not belong to any testlet.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>

<p>An optional vector with student sample weights
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est.slope</code></td>
<td>

<p>Should item slopes be estimated? The default is <code>TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est.guess</code></td>
<td>

<p>Should guessing parameters be estimated? The default is <code>TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>guess.prior</code></td>
<td>

<p>A vector of length two or a matrix with <code class="reqn">I</code> items and two columns
which defines the beta prior distribution of guessing
parameters. The default is a non-informative prior, i.e. the Beta(1,1)
distribution.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testlet.variance.prior</code></td>
<td>

<p>A vector of length two which defines the (joint) prior for testlet variances
assuming an inverse chi-squared distribution.
The first entry is the effective sample size of the prior while the second
entry defines the prior variance of the testlet. The default of <code>c(1,.2)</code>
means that the prior sample size is 1 and the prior testlet variance is .2.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burnin</code></td>
<td>

<p>Number of burnin iterations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>

<p>Number of iterations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N.sampvalues</code></td>
<td>

<p>Maximum number of sampled values to save
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress.iter</code></td>
<td>

<p>Display progress every <code>progress.iter</code>-th iteration. If no progress
display is wanted, then choose <code>progress.iter</code> larger than <code>iter</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.theta</code></td>
<td>

<p>Logical indicating whether theta values should be saved
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.gamma.testlet</code></td>
<td>

<p>Logical indicating whether gamma values should be saved
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The testlet response model for person <code class="reqn">p</code> at item <code class="reqn">i</code>
is defined as
</p>
<p style="text-align: center;"><code class="reqn"> P(X_{pi}=1 )=c_i + ( 1 - c_i )
        \Phi ( a_i \theta_p + \gamma_{p,t(i)} + b_i    ) \quad, \quad
    \theta_p \sim N ( 0,1 ), \gamma_{p,t(i)} \sim N( 0, \sigma^2_t ) </code>
</p>

<p>In case of <code>est.slope=FALSE</code>, all item slopes <code class="reqn">a_i</code> are set to 1. Then
a variance <code class="reqn">\sigma^2</code> of the <code class="reqn">\theta_p</code> distribution is estimated
which is called the Rasch testlet model in the literature (Wang &amp; Wilson, 2005).
</p>
<p>In case of <code>est.guess=FALSE</code>, all guessing parameters <code class="reqn">c_i</code> are
set to 0.
</p>
<p>After fitting the testlet model, marginal item parameters are calculated (integrating
out testlet effects <code class="reqn">\gamma_{p,t(i)}</code>) according the defining response equation
</p>
<p style="text-align: center;"><code class="reqn"> P(X_{pi}=1 )=c_i + ( 1 - c_i )
        \Phi ( a_i^\ast \theta_p + b_i^\ast    ) </code>
</p>



<h3>Value</h3>

<p>A list of class <code>mcmc.sirt</code> with following entries:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>mcmcobj</code></td>
<td>
<p>Object of class <code>mcmc.list</code> containing item parameters
(<code>b_marg</code> and <code>a_marg</code> denote marginal item parameters)
and person parameters (if requested)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>summary.mcmcobj</code></td>
<td>
<p>Summary of the <code>mcmcobj</code> object. In this
summary the Rhat statistic and the mode estimate MAP is included.
The variable <code>PercSEratio</code> indicates the proportion of the Monte Carlo
standard error in relation to the total standard deviation of the
posterior distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ic</code></td>
<td>
<p>Information criteria (DIC)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burnin</code></td>
<td>
<p>Number of burnin iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>Total number of iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta.chain</code></td>
<td>
<p>Sampled values of <code class="reqn">\theta_p</code> parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviance.chain</code></td>
<td>
<p>Sampled values of deviance values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EAP.rel</code></td>
<td>
<p>EAP reliability</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>person</code></td>
<td>
<p>Data frame with EAP person parameter estimates for
<code class="reqn">\theta_p</code> and their corresponding posterior standard
deviations and for all testlet effects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>
<p>Used data frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Used student weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further values</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Glas, C. A. W. (2012). <em>Estimating and testing the extended testlet model.</em>
LSAC Research Report Series, RR 12-03.
</p>
<p>Wainer, H., Bradlow, E. T., &amp; Wang, X. (2007).
<em>Testlet response theory and its applications</em>.
Cambridge: Cambridge University Press.
</p>
<p>Wang, W.-C., &amp; Wilson, M. (2005). The Rasch testlet model.
<em>Applied Psychological Measurement, 29</em>, 126-149.
</p>
<p>Wang, X., Bradlow, E. T., &amp; Wainer, H. (2002). A general Bayesian model
for testlets: Theory and applications.
<em>Applied Psychological Measurement, 26</em>, 109-128.
</p>


<h3>See Also</h3>

<p>S3 methods: <code>summary.mcmc.sirt</code>, <code>plot.mcmc.sirt</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#############################################################################
# EXAMPLE 1: Dataset Reading
#############################################################################
data(data.read)
dat &lt;- data.read
I &lt;- ncol(dat)

# set burnin and total number of iterations here (CHANGE THIS!)
burnin &lt;- 200
iter &lt;- 500

#***
# Model 1: 1PNO model
mod1 &lt;- sirt::mcmc.3pno.testlet( dat,  est.slope=FALSE, est.guess=FALSE,
            burnin=burnin, iter=iter )
summary(mod1)
plot(mod1,ask=TRUE) # plot MCMC chains in coda style
plot(mod1,ask=TRUE, layout=2) # plot MCMC output in different layout

#***
# Model 2: 3PNO model with Beta(5,17) prior for guessing parameters
mod2 &lt;- sirt::mcmc.3pno.testlet( dat,  guess.prior=c(5,17),
               burnin=burnin, iter=iter )
summary(mod2)

#***
# Model 3: Rasch (1PNO) testlet model
testlets &lt;- substring( colnames(dat), 1, 1 )
mod3 &lt;- sirt::mcmc.3pno.testlet( dat,  testlets=testlets,  est.slope=FALSE,
           est.guess=FALSE, burnin=burnin, iter=iter )
summary(mod3)

#***
# Model 4: 3PNO testlet model with (almost) fixed guessing parameters .25
mod4 &lt;- sirt::mcmc.3pno.testlet( dat,  guess.prior=1000*c(25,75), testlets=testlets,
              burnin=burnin, iter=iter )
summary(mod4)
plot(mod4, ask=TRUE, layout=2)

#############################################################################
# EXAMPLE 2: Simulated data according to the Rasch testlet model
#############################################################################
set.seed(678)

N &lt;- 3000   # number of persons
I &lt;- 4      # number of items per testlet
TT &lt;- 3     # number of testlets

ITT &lt;- I*TT
b &lt;- round( stats::rnorm( ITT, mean=0, sd=1 ), 2 )
sd0 &lt;- 1 # sd trait
sdt &lt;- seq( 0, 2, len=TT ) # sd testlets

# simulate theta
theta &lt;- stats::rnorm( N, sd=sd0 )
# simulate testlets
ut &lt;- matrix(0,nrow=N, ncol=TT )
for (tt in 1:TT){
    ut[,tt] &lt;- stats::rnorm( N, sd=sdt[tt] )
}
ut &lt;- ut[, rep(1:TT,each=I) ]
# calculate response probability
prob &lt;- matrix( stats::pnorm( theta + ut + matrix( b, nrow=N, ncol=ITT,
            byrow=TRUE ) ), N, ITT)
Y &lt;- (matrix( stats::runif(N*ITT), N, ITT) &lt; prob )*1
colMeans(Y)

# define testlets
testlets &lt;- rep(1:TT, each=I )

burnin &lt;- 300
iter &lt;- 1000

#***
# Model 1: 1PNO model (without testlet structure)
mod1 &lt;- sirt::mcmc.3pno.testlet( dat=Y,  est.slope=FALSE, est.guess=FALSE,
            burnin=burnin, iter=iter, testlets=testlets )
summary(mod1)

summ1 &lt;- mod1$summary.mcmcobj
# compare item parameters
cbind( b, summ1[ grep("b", summ1$parameter ), "Mean" ] )
# Testlet standard deviations
cbind( sdt, summ1[ grep("sigma\.testlet", summ1$parameter ), "Mean" ] )

#***
# Model 2: 1PNO model (without testlet structure)
mod2 &lt;- sirt::mcmc.3pno.testlet( dat=Y,  est.slope=TRUE, est.guess=FALSE,
           burnin=burnin, iter=iter, testlets=testlets )
summary(mod2)

summ2 &lt;- mod2$summary.mcmcobj
# compare item parameters
cbind( b, summ2[ grep("b\[", summ2$parameter ), "Mean" ] )
# item discriminations
cbind( sd0, summ2[ grep("a\[", summ2$parameter ), "Mean" ] )
# Testlet standard deviations
cbind( sdt, summ2[ grep("sigma\.testlet", summ2$parameter ), "Mean" ] )

#############################################################################
# EXAMPLE 3: Simulated data according to the 2PNO testlet model
#############################################################################
set.seed(678)

N &lt;- 3000    # number of persons
I &lt;- 3      # number of items per testlet
TT &lt;- 5    # number of testlets

ITT &lt;- I*TT
b &lt;- round( stats::rnorm( ITT, mean=0, sd=1 ), 2 )
a &lt;- round( stats::runif( ITT, 0.5, 2 ),2)
sdt &lt;- seq( 0, 2, len=TT ) # sd testlets
sd0 &lt;- 1

# simulate theta
theta &lt;- stats::rnorm( N, sd=sd0 )
# simulate testlets
ut &lt;- matrix(0,nrow=N, ncol=TT )
for (tt in 1:TT){
   ut[,tt] &lt;- stats::rnorm( N, sd=sdt[tt] )
}
ut &lt;- ut[, rep(1:TT,each=I) ]
# calculate response probability
bM &lt;- matrix( b, nrow=N, ncol=ITT, byrow=TRUE )
aM &lt;- matrix( a, nrow=N, ncol=ITT, byrow=TRUE )
prob &lt;- matrix( stats::pnorm( aM*theta + ut + bM ), N, ITT)
Y &lt;- (matrix( stats::runif(N*ITT), N, ITT) &lt; prob )*1
colMeans(Y)

# define testlets
testlets &lt;- rep(1:TT, each=I )

burnin &lt;- 500
iter &lt;- 1500

#***
# Model 1: 2PNO model
mod1 &lt;- sirt::mcmc.3pno.testlet( dat=Y,  est.slope=TRUE, est.guess=FALSE,
             burnin=burnin, iter=iter, testlets=testlets )
summary(mod1)

summ1 &lt;- mod1$summary.mcmcobj
# compare item parameters
cbind( b, summ1[ grep("b\[", summ1$parameter ), "Mean" ] )
# item discriminations
cbind( a, summ1[ grep("a\[", summ1$parameter ), "Mean" ] )
# Testlet standard deviations
cbind( sdt, summ1[ grep("sigma\.testlet", summ1$parameter ), "Mean" ] )

## End(Not run)
</code></pre>


</div>