<div class="container">

<table style="width: 100%;"><tr>
<td>safeLogrankTest</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Safe Logrank Test</h2>

<h3>Description</h3>

<p>A safe test to test whether there is a difference between two survival curves. This function
builds on the Mantel-Cox version of the logrank test.
</p>


<h3>Usage</h3>

<pre><code class="language-R">safeLogrankTest(
  formula,
  designObj = NULL,
  ciValue = NULL,
  data = NULL,
  survTime = NULL,
  group = NULL,
  pilot = FALSE,
  exact = TRUE,
  computeZ = TRUE,
  ...
)

safeLogrankTestStat(
  z,
  nEvents,
  designObj,
  ciValue = NULL,
  dataNull = 1,
  sigma = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a formula expression as for other survival models, of the form Surv(time, status) ~ groupingVariable,
see <code>Surv</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>designObj</code></td>
<td>
<p>a safe logrank design obtained from <code>designSafeLogrank</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ciValue</code></td>
<td>
<p>numeric, represents the ciValue-level of the confidence sequence. Default ciValue=NULL, and
ciValue = 1 - alpha, where alpha is taken from the design object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame in which to interpret the variables occurring in survTime and group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>survTime</code></td>
<td>
<p>an optional survival time object of class 'Surv' created with <code>Surv</code>, or
a name of a column in the data set of class 'Surv'. Does not need specifying if a formula is provided, therefore
set to <code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>an optional factor, a grouping variable. Currently, only two levels allowed. Does not need specifying
if a formula is provided, therefore set to <code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pilot</code></td>
<td>
<p>a logical indicating whether a pilot study is run. If <code>TRUE</code>, it is assumed that the number of
samples is exactly as planned. The default null h0=1 is used, alpha=0.05, and alternative="twoSided" is used.
To change these default values, please use <code>designSafeLogrank</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exact</code></td>
<td>
<p>a logical indicating whether the exact safe logrank test needs to be performed based on
the hypergeometric likelihood. Default is <code>TRUE</code>, if <code>FALSE</code> then the safe z-test (for Gaussian data)
applied to the logrank z-statistic is used instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>computeZ</code></td>
<td>
<p>logical. If <code>TRUE</code> computes the logrank z-statistic.
Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments to be passed to or from methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>numeric representing the observed logrank z statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nEvents</code></td>
<td>
<p>numeric &gt; 0, observed number of events.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataNull</code></td>
<td>
<p>numeric &gt; 0, the null hypothesis corresponding to the z statistics.
By default dataNull = 1 representing equality of the hazard ratio.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>numeric &gt; 0, scaling in the data.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns an object of class 'safeTest'. An object of class 'safeTest' is a list containing at least the
following components:
</p>

<dl>
<dt>statistic</dt>
<dd>
<p>the value of the summary, i.e., z-statistic or the e-value.</p>
</dd>
<dt>nEvents</dt>
<dd>
<p>The number of observed events.</p>
</dd>
<dt>eValue</dt>
<dd>
<p>the e-value of the safe test.</p>
</dd>
<dt>confSeq</dt>
<dd>
<p>An anytime-valid confidence sequence.</p>
</dd>
<dt>estimate</dt>
<dd>
<p>To be implemented: An estimate of the hazard ratio.</p>
</dd>
<dt>testType</dt>
<dd>
<p>"logrank".</p>
</dd>
<dt>dataName</dt>
<dd>
<p>a character string giving the name(s) of the data.</p>
</dd>
<dt>designObj</dt>
<dd>
<p>an object of class "safeDesign" obtained from <code>designSafeLogrank</code>.</p>
</dd>
<dt>sumStats</dt>
<dd>
<p>a list containing.the time of events, the progression of the risk sets and events.</p>
</dd>
<dt>call</dt>
<dd>
<p>the expression with which this function is called.</p>
</dd>
</dl>
<h3>Functions</h3>


<ul><li> <p><code>safeLogrankTestStat()</code>: Safe Logrank Test based on Summary Statistic Z
All provided data (i.e., z-scores) are assumed to be centred on a hazard ratio = 1, thus, log(hr) = 0 ,
and the proper (e.g., hypergeometric) scaling is applied to the data, so sigma = 1. The null hypothesis
in the design object pertains to the population and is allowed to differ from log(theta) = 0.
</p>
</li></ul>
<h3>Examples</h3>

<pre><code class="language-R"># Example taken from survival::survdiff

designObj &lt;- designSafeLogrank(hrMin=1/2)

ovData &lt;- survival::ovarian
ovData$survTime &lt;- survival::Surv(ovData$futime, ovData$fustat)

safeLogrankTest(formula=survTime~ rx, data=ovData, designObj=designObj)

safeLogrankTest(survTime=survTime, group=rx, data=ovData, designObj=designObj)

# Examples taken from coin::logrank_test
## Example data (Callaert, 2003, Tab. 1)
#'
callaert &lt;- data.frame(
  time = c(1, 1, 5, 6, 6, 6, 6, 2, 2, 2, 3, 4, 4, 5, 5),
  group = factor(rep(0:1, c(7, 8)))
)

designObj &lt;- designSafeLogrank(hrMin=1/2)

safeLogrankTest(survival::Surv(callaert$time)~callaert$group,
                designObj = designObj)

safeLogrankTest(survTime=survival::Surv(callaert$time),
                group=callaert$group, designObj = designObj)

result &lt;- safeLogrankTest(survTime=survival::Surv(callaert$time),
                group=callaert$group, designObj = designObj)

result

##  Sequentially
# Greater
eValueGreater &lt;- exp(cumsum(result$sumStats$logEValueGreater))
# Less
eValueLess &lt;- exp(cumsum(result$sumStats$logEValueLess))

# twoSided
eValueTwoSided &lt;- 1/2*eValueGreater+1/2*eValueLess

eValueTwoSided
result$eValue

###### Example switching between safe exact and safe Gaussian logrank test

designObj &lt;- designSafeLogrank(0.8, alternative="less")

dat &lt;- safestats::generateSurvData(300, 300, 2, 0.0065, 0.0065*0.8, seed=1)
survTime &lt;- survival::Surv(dat$time, dat$status)

resultE &lt;- safeLogrankTest(survTime ~ dat$group,
                           designObj = designObj)

resultG &lt;- safeLogrankTest(survTime ~ dat$group,
                           designObj = designObj, exact=FALSE)

resultE
resultG

###### Example switching between safe exact and safe Gaussian logrank test other side

designObj &lt;- designSafeLogrank(1/0.8, alternative="greater")

resultE &lt;- safeLogrankTest(survTime ~ dat$group,
                           designObj = designObj)

resultG &lt;- safeLogrankTest(survTime ~ dat$group,
                           designObj = designObj, exact=FALSE)

if (log(resultE$eValue) &gt;= 0 &amp;&amp; log(resultG$eValue) &gt;= 0 )
  stop("one-sided wrong")

</code></pre>


</div>