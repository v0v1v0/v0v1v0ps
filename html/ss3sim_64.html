<div class="container">

<table style="width: 100%;"><tr>
<td>run_ss3sim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Master function to run SS3 simulations</h2>

<h3>Description</h3>

<p>This is the main high-level wrapper function for running <span class="pkg">ss3sim</span>
simulations. This function first deals with parsing a scenario ID into case
arguments, reads the appropriate case files, and then passes these arguments
on to <code>ss3sim_base</code> to run a simulation. Alternatively, you might
choose to run <code>ss3sim_base</code> directly and skip the case-file
setup.
</p>


<h3>Usage</h3>

<pre><code class="language-R">run_ss3sim(iterations, scenarios, case_folder, om_dir, em_dir,
  case_files = list(F = "F", D = c("index", "lcomp", "agecomp")),
  user_recdevs = NULL, parallel = FALSE, parallel_iterations = FALSE,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>iterations</code></td>
<td>
<p>Which iterations to run. A numeric vector. For example
<code>1:100</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scenarios</code></td>
<td>
<p>Which scenarios to run. A vector of character objects. For
example <code>c("D0-F0-cod", "D1-F1-cod")</code>. Also, see
<code>expand_scenarios</code> for a shortcut to specifying the scenarios.
See <code>get_caseargs</code> and the vignette for details on specifying
the scenarios.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>case_folder</code></td>
<td>
<p>The folder containing the plain-text case files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>om_dir</code></td>
<td>
<p>The folder containing the SS3 operating model
configuration files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>em_dir</code></td>
<td>
<p>The folder containing the SS3 estimation model
configuration files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>case_files</code></td>
<td>
<p>A named list that relates the case IDs to the files to
return. <b>The default list specifies only the required fishing
mortality and data scenarios. To specify other cases you will need to
extend this named list</b>. This argument is passed to
<code>get_caseargs</code>. See that function for details and examples of
how to specify this. The introduction vignette also explains how to specify
the case files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>user_recdevs</code></td>
<td>
<p>An optional matrix of recruitment deviations to replace
the recruitment deviations built into the package. The columns represent
run iterations and the rows represent years. <code>user_recdevs</code> can be a
matrix of 0s for deterministic model checking. For traditional stochastic
simulations these would be independent and normally distributed deviations
with a standard deviation equal to the desired sigma R. Note that these
recruitment deviations will be used verbatim (after exponentiation).
<code>user_recdevs</code> will *not* be multiplied by sigma R and they will *not*
be log-normal bias corrected. If <code>user_recdevs</code> are specified as
anything besides <code>NULL</code> the package will issue a warning about this.
Biased recruitment deviations can lead to biased model results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>A logical argument that controls whether the scenarios are
run in parallel. You will need to register multiple cores first with a
package such as <span class="pkg">doParallel</span> and have the <span class="pkg">foreach</span> package
installed. See the example below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel_iterations</code></td>
<td>
<p>Logical. By default <code>parallel = TRUE</code> will
run scenarios in parallel. If you set <code>parallel = TRUE</code> and
<code>parallel_iterations = TRUE</code> then the iterations will be run in
parallel. This would be useful if you were only running one scenario
but you wanted to run it faster.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Anything else to pass to <code>ss3sim_base</code>. This could
include <code>bias_adjust</code>. Also, you can pass
additional options to the <code>SS3</code> command through the argument
<code>admb_options</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The operating model folder should contain: <code>forecast.ss</code>,
<code>yourmodel.ctl</code>, <code>yourmodel.dat</code>, <code>ss.par</code>, and
<code>starter.ss</code>. The files should be the versions that are returned from an
SS run as <code>.ss_new</code> files. This is important because it creates
consistent formatting which many of the functions in this package depend on.
Rename the <code>.ss_new</code> files as listed above (and in all lowercase). The
estimation model folder should contain all the same files listed above except
the <code>ss.par</code> and <code>yourmodel.dat</code> files, which are unnecessary but
can be included if desired. See the vignette for details on modifying an
existing <code>SS3</code> model to run with <span class="pkg">ss3sim</span>. Alternatively, you might
consider modifying one of the built-in model configurations.
</p>


<h3>Value</h3>

<p>The output will appear in whatever your current <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> working directory
is. There will be folders named after your scenarios. They will
look like this:
</p>

<ul>
<li> <p><code>D0-F0-cod/1/om</code>
</p>
</li>
<li> <p><code>D0-F0-cod/1/em</code>
</p>
</li>
<li> <p><code>D0-F0-cod/2/om</code>
</p>
</li>
<li>
<p> ...
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Sean C. Anderson
</p>


<h3>See Also</h3>

<p><code>ss3sim_base</code>, <code>run_ss3model</code>,
<code>get_caseargs</code>,
<code>expand_scenarios</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"> ## Not run: 
# Create a temporary folder for the output and set the working directory:
temp_path &lt;- file.path(tempdir(), "ss3sim-example")
dir.create(temp_path, showWarnings = FALSE)
wd &lt;- getwd()
setwd(temp_path)
on.exit(setwd(wd), add = TRUE)

# Find the data in the ss3sim package:
d &lt;- system.file("extdata", package = "ss3sim")
om &lt;- file.path(d, "models", "cod-om")
em &lt;- file.path(d, "models", "cod-em")
case_folder &lt;- file.path(d, "eg-cases")
#
 # Without bias adjustment:
 run_ss3sim(iterations = 1, scenarios = "D0-F0-cod",
 case_folder = case_folder, om_dir = om, em_dir = em)
 unlink("D0-F0-cod", recursive = TRUE) # clean up

# An example specifying the case files:
run_ss3sim(iterations = 1, scenarios = "D0-F0-E0-cod",
  case_folder = case_folder, om_dir = om, em_dir = em,
  case_files = list(F = "F", D = c("index", "lcomp",
      "agecomp"), E = "E"))
unlink("D0-F0-E0-cod", recursive = TRUE) # clean up

# If try to use bias adjustment, a warning will be triggered and the run will
# proceed WITHOUT using bias adjustment (and may result in error.)
# run_ss3sim(iterations = 1, scenarios = "D1-F0-cod",
#   case_folder = case_folder, om_dir = om, em_dir = em,
#   bias_adjust = TRUE)

# A run with deterministic process error for model checking:
recdevs_det &lt;- matrix(0, nrow = 101, ncol = 2)
run_ss3sim(iterations = 1:2, scenarios = "D0-E100-F0-cod",
  case_folder = case_folder,
  case_files = list(F = "F", D = c("index", "lcomp", "agecomp"), E = "E"),
  om_dir = om, em_dir = em,
  bias_adjust = FALSE, user_recdevs = recdevs_det)
unlink("D0-E100-F0-cod", recursive = TRUE)

# # An example of a run using parallel processing across 2 cores:
# require(doParallel)
# registerDoParallel(cores = 2)
# require(foreach)
# getDoParWorkers() # check how many cores are registered
#
# # parallel scenarios:
# run_ss3sim(iterations = 1, scenarios = c("D0-F0-cod",
#     "D1-F0-cod"), case_folder = case_folder,
#   om_dir = om, em_dir = em, parallel = TRUE)
# unlink("D0-F0-cod", recursive = TRUE)
# unlink("D1-F0-cod", recursive = TRUE)
#
# # parallel iterations:
# run_ss3sim(iterations = 1:2, scenarios = "D0-F0-cod",
#   case_folder = case_folder, om_dir = om, em_dir = em,
#   parallel = TRUE, parallel_iterations = TRUE)
# unlink("D0-F0-cod", recursive = TRUE)

## End(Not run)
</code></pre>


</div>