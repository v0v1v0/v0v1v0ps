<div class="container">

<table style="width: 100%;"><tr>
<td>get_ns_spline</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Faster Pointwise Function than ns</h2>

<h3>Description</h3>

<p>Creates a function which can evaluate a natural cubic spline like
<code>ns</code>.
</p>
<p>The result may differ between different BLAS and LAPACK
implementations as the QR decomposition is not unique. However, the column space
of the returned matrix will always be the same regardless of the BLAS and LAPACK
implementation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">get_ns_spline(knots, intercept = TRUE, do_log = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>sorted numeric vector with boundary and interior knots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>logical for whether to include an intercept.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do_log</code></td>
<td>
<p>logical for whether to evaluate the spline at <code>log(x)</code>
or <code>x</code>.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R"># compare with splines
library(splines)
library(SimSurvNMarker)
xs &lt;- seq(1, 5, length.out = 10L)
bks &lt;- c(1, 5)
iks &lt;- 2:4

# we get the same
if(require(Matrix)){
  r1 &lt;- unclass(ns(xs, knots = iks, Boundary.knots = bks, intercept = TRUE))
  r2 &lt;- get_ns_spline(knots = sort(c(iks, bks)), intercept = TRUE,
                      do_log = FALSE)(xs)

  cat("Rank is correct:      ", rankMatrix(cbind(r1, r2)) == NCOL(r1), "\n")

  r1 &lt;- unclass(ns(log(xs), knots = log(iks), Boundary.knots = log(bks),
                   intercept = TRUE))
  r2 &lt;- get_ns_spline(knots = log(sort(c(iks, bks))), intercept = TRUE,
                      do_log = TRUE)(xs)
  cat("Rank is correct (log):", rankMatrix(cbind(r1, r2)) == NCOL(r1), "\n")
}

# the latter is faster
system.time(
  replicate(100,
            ns(xs, knots = iks, Boundary.knots = bks, intercept = TRUE)))
system.time(
  replicate(100,
            get_ns_spline(knots = sort(c(iks, bks)), intercept = TRUE,
                          do_log = FALSE)(xs)))
func &lt;- get_ns_spline(knots = sort(c(iks, bks)), intercept = TRUE,
                      do_log = FALSE)
system.time(replicate(100, func(xs)))

</code></pre>


</div>