<div class="container">

<table style="width: 100%;"><tr>
<td>A7_optimShd</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Shadows calculation for a set of distances between elements of a PV grid connected plant.
</h2>

<h3>Description</h3>

<p>The optimum distance between trackers or static structures of a PV
grid connected plant depends on two main factors: the ground
requirement ratio (defined as the ratio of the total ground area to
the generator PV array area), and the productivity of the system
including shadow losses. Therefore, the optimum separation may be the
one which achieves the highest productivity with the lowest ground
requirement ratio. 
</p>
<p>However, this definition is not complete since the terrain
characteristics and the costs of wiring or civil works could alter the
decision. This function is a help for choosing this distance: it
computes the productivity for a set of combinations of distances
between the elements of the plant.
</p>


<h3>Usage</h3>

<pre><code class="language-R">optimShd(lat,
         modeTrk = 'fixed',
         modeRad = 'prom',
         dataRad,
         sample = 'hour',
         keep.night = TRUE,
         sunGeometry = 'michalsky',
         betaLim = 90, beta = abs(lat)-10, alfa = 0,
         iS = 2, alb = 0.2, HCPV = FALSE,
         module = list(),
         generator = list(),
         inverter = list(),
         effSys = list(),
         modeShd = '',
         struct = list(),
         distances = data.frame(),
         res = 2,
         prog = TRUE)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>numeric, latitude (degrees) of the point of the Earth where calculations are needed. It is positive for locations above the Equator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modeTrk</code></td>
<td>
<p>character, to be chosen from <code>'fixed'</code>, <code>'two'</code> or <code>'horiz'</code>. When <code>modeTrk = 'fixed'</code> the surface is fixed (inclination and azimuth angles are constant). The performance of a two-axis tracker is calculated with <code>modeTrk = 'two'</code>, and <code>modeTrk = 'horiz'</code> is the option for an horizontal N-S tracker. Its default value is <code>modeTrk = 'fixed'</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modeRad, dataRad</code></td>
<td>
<p>Information about the source data of the
global irradiation. See <code>calcG0</code> for details. For this
function the option <code>modeRad = 'bdI'</code> is not supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample</code></td>
<td>
<p><code>character</code>, containing one of ‘"sec"’, ‘"min"’,
‘"hour"’.  This can optionally be preceded by a (positive or
negative) integer and a space, or followed by ‘"s"’ (used by
<code>seq.POSIXt</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.night</code></td>
<td>
<p><code>logical</code> When it is TRUE (default) the
time series includes the night.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sunGeometry</code></td>
<td>
<p><code>character</code>, method for the sun geometry
calculations. See <code>calcSol</code>, <code>fSolD</code> and <code>fSolI</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaLim, beta, alfa, iS, alb, HCPV</code></td>
<td>
<p>See <code>calcGef</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>module</code></td>
<td>
<p>list of numeric values with information about the PV module, </p>

<dl>
<dt><code>Vocn</code></dt>
<dd>
<p>open-circuit voltage of the module at Standard
Test Conditions (default value 57.6 volts.)</p>
</dd>
<dt><code>Iscn</code></dt>
<dd>
<p>short circuit current of the module at Standard
Test Conditions (default value 4.7 amperes.)</p>
</dd>
<dt><code>Vmn</code></dt>
<dd>
<p>maximum power point voltage of the module at
Standard Test Conditions (default value 46.08 amperes.)</p>
</dd>
<dt><code>Imn</code></dt>
<dd>
<p>Maximum power current of the module at Standard
Test Conditions (default value 4.35 amperes.)</p>
</dd>
<dt><code>Ncs</code></dt>
<dd>
<p>number of cells in series inside the module
(default value 96)</p>
</dd>
<dt><code>Ncp</code></dt>
<dd>
<p>number of cells in parallel inside the module (default value 1)</p>
</dd>
<dt><code>CoefVT</code></dt>
<dd>
<p>coefficient of decrement of voltage of each
cell with the temperature (default value 0.0023 volts per celsius degree)</p>
</dd>
<dt><code>TONC</code></dt>
<dd>
<p>nominal operational  cell temperature, celsius
degree (default value 47).</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>generator</code></td>
<td>
<p>list of numeric values with information about the generator, </p>

<dl>
<dt><code>Nms</code></dt>
<dd>
<p>number of modules in series (default value 12)</p>
</dd>
<dt><code>Nmp</code></dt>
<dd>
<p>number of modules in parallel (default value 11)</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inverter</code></td>
<td>
<p>list of numeric values with information about the DC/AC inverter, </p>

<dl>
<dt><code>Ki</code></dt>
<dd>
<p>vector of three values, coefficients of the
efficiency curve of the inverter (default c(0.01, 0.025, 0.05)),
or a matrix of nine values (3x3) if there is dependence with the
voltage (see references).</p>
</dd>
<dt><code>Pinv</code></dt>
<dd>
<p>nominal inverter power (W) (default value 25000
watts.)</p>
</dd>
<dt><code>Vmin, Vmax</code></dt>
<dd>
<p> minimum and maximum voltages of the MPP
range of the inverter (default values 420 and 750 volts)</p>
</dd>
<dt><code>Gumb</code></dt>
<dd>
<p> minimum irradiance for the inverter to start
(W/m²) (default value 20 W/m²)</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effSys</code></td>
<td>
<p>list of numeric values with information about the system losses, </p>

<dl>
<dt><code>ModQual</code></dt>
<dd>
<p>average tolerance of the set of modules (%), default value is 3</p>
</dd>
<dt><code>ModDisp</code></dt>
<dd>
<p> module parameter disperssion losses (%), default value is 2</p>
</dd>
<dt><code>OhmDC</code></dt>
<dd>
<p> Joule losses due to the DC wiring (%), default value is 1.5</p>
</dd>
<dt><code>OhmAC</code></dt>
<dd>
<p>Joule losses due to the AC wiring (%), default value is 1.5</p>
</dd>
<dt><code>MPP</code></dt>
<dd>
<p> average error of the MPP algorithm of the inverter (%), default value is 1</p>
</dd>
<dt><code>TrafoMT</code></dt>
<dd>
<p>losses due to the MT transformer (%), default value is 1</p>
</dd>
<dt><code>Disp</code></dt>
<dd>
<p> losses due to stops of the system (%), default value is 0.5</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modeShd</code></td>
<td>
<p>character, defines the type of shadow calculation. In
this version of the package the effect of the shadow is calculated
as a proportional reduction of the circumsolar diffuse and direct
irradiances. This type of approach is selected with
<code>modeShd = 'area'</code>. In future versions other approaches which
relate the geometric shadow and the electrical connections of the PV
generator will be available. If <code>modeTrk = 'horiz'</code> it is
possible to calculate the effect of backtracking with
<code>modeShd = 'bt'</code>. If <code>modeShd = c('area','bt')</code> the
backtracking method will be carried out and therefore no shadows
will appear. Finally, for two-axis trackers it is possible to select
<code>modeShd = 'prom'</code> in order to calculate the effect of shadows on
an average tracker (see <code>fSombra6</code>).
The result will include three variables (Gef0, Def0 and Bef0) with the
irradiance/irradiation without shadows as a reference.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>struct</code></td>
<td>
<p><code>list</code>. When <code>modeTrk = 'fixed'</code> or
<code>modeTrk = 'horiz'</code> only a component named <code>L</code>, which is the
height (meters) of the tracker, is needed. For two-axis trackers
(<code>modeTrk = 'two'</code>), an additional component named <code>W</code>, the
width of the tracker, is required. Moreover, two components named
<code>Nrow</code> and <code>Ncol</code> are included under this list. These
components define, respectively, the number of rows and columns of
the whole setof trackers in the PV plant.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distances</code></td>
<td>
<p><code>list</code>, whose three components are vectors of
length 2: </p>
 <dl>
<dt><code>Lew</code></dt>
<dd>
<p> (only when
<code>modeTrk = 'horiz'</code> or <code>modeTrk = 'two'</code>), minimum and maximum
distance (meters) between horizontal NS and two-axis trackers along
the East-West direction.</p>
</dd>  <dt><code>Lns</code></dt>
<dd>
<p> (only when
<code>modeTrk = 'two'</code>), minimum and maximum distance (meters) between
two-axis trackers along the North-South direction.</p>
</dd>
<dt><code>D</code></dt>
<dd>
<p>(only when <code>modeTrk = 'fixed'</code>), minimum and
maximum distance (meters) between fixed surfaces.</p>
</dd>  </dl>
<p> These
distances, in meters, are defined between the axis of the trackers.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res</code></td>
<td>
<p>numeric; <code>optimShd</code> constructs a sequence from the
minimum to the maximum value of <code>distances</code>, with <code>res</code> as
the increment, in meters, of the sequence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prog</code></td>
<td>
<p>logical,
show a progress bar; default value is TRUE</p>
</td>
</tr>
</table>
<h3>Details</h3>

 <p><code>optimShd</code> calculates the energy produced for every
combination of distances as defined by <code>distances</code> and
<code>res</code>. The result of this function is a <code>Shade-class</code>
object.  A method of <code>shadeplot</code> for this class is defined
(<code>shadeplot-methods</code>), and it shows the graphical relation
between the productivity and the distance between trackers or fixed
surfaces.  </p>


<h3>Value</h3>

<p>A <code>Shade</code> object.</p>


<h3>Author(s)</h3>

<p>Oscar Perpiñán Lamigueiro</p>


<h3>References</h3>


<ul>
<li>
<p> Perpiñán, O.: Grandes Centrales Fotovoltaicas: producción, seguimiento y ciclo de vida. PhD Thesis, UNED, 2008. <a href="http://e-spacio.uned.es/fez/eserv/tesisuned:IngInd-Operpinan/GrandesCentrales.pdf">http://e-spacio.uned.es/fez/eserv/tesisuned:IngInd-Operpinan/GrandesCentrales.pdf</a>.
</p>
</li>
<li>
<p> Perpiñán, O, Energía Solar Fotovoltaica, 2015.
(<a href="https://oscarperpinan.github.io/esf/">https://oscarperpinan.github.io/esf/</a>)
</p>
</li>
<li>
<p> Perpiñán, O. (2012), "solaR: Solar Radiation and Photovoltaic
Systems with R", Journal of Statistical Software, 50(9), 1-32,
doi: <a href="https://doi.org/10.18637/jss.v050.i09">10.18637/jss.v050.i09</a>
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>prodGCPV</code>,
<code>calcShd</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(lattice)
library(latticeExtra)

lat = 37.2;
G0dm = c(2766, 3491, 4494, 5912, 6989, 7742, 7919, 7027, 5369, 3562, 2814,
2179)
Ta = c(10, 14.1, 15.6, 17.2, 19.3, 21.2, 28.4, 29.9, 24.3, 18.2, 17.2, 15.2)
prom = list(G0dm = G0dm, Ta = Ta)

###Two-axis trackers
struct2x = list(W = 23.11, L = 9.8, Nrow = 2, Ncol = 3)
dist2x = list(Lew = c(30, 45),Lns = c(20, 40))

ShdM2x &lt;- optimShd(lat = lat, dataRad = prom, modeTrk = 'two',
                   modeShd = c('area','prom'),
                   distances = dist2x, struct = struct2x,
                   res = 5)

shadeplot(ShdM2x)

pLew = xyplot(Yf~GRR,data = ShdM2x,groups = factor(Lew),type = c('l','g'),
    main = 'Productivity for each Lew value')
pLew+glayer(panel.text(x[1], y[1], group.value))

pLns = xyplot(Yf~GRR,data = ShdM2x,groups = factor(Lns),type = c('l','g'),
    main = 'Productivity for each Lns value')
pLns+glayer(panel.text(x[1], y[1], group.value))

## 1-axis tracker with Backtracking
structHoriz = list(L = 4.83);
distHoriz = list(Lew = structHoriz$L * c(2,5));


Shd12HorizBT &lt;- optimShd(lat = lat, dataRad = prom,
        modeTrk = 'horiz',
        betaLim = 60,
        distances = distHoriz, res = 2,
        struct = structHoriz,
        modeShd = 'bt')

shadeplot(Shd12HorizBT)

xyplot(diff(Yf)~GRR[-1],data = Shd12HorizBT,type = c('l','g'))

###Fixed system
structFixed = list(L = 5);
distFixed = list(D = structFixed$L*c(1,3));
Shd12Fixed &lt;- optimShd(lat = lat, dataRad = prom,
        modeTrk = 'fixed',
        distances = distFixed, res = 2,
        struct = structFixed,
        modeShd = 'area')
shadeplot(Shd12Fixed)
</code></pre>


</div>