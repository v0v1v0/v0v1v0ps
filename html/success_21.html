<div class="container">

<table style="width: 100%;"><tr>
<td>funnel_plot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Risk-adjusted funnel plot</h2>

<h3>Description</h3>

<p>This function allows to construct a risk-adjusted funnel plot
for comparing survival proportion between units, see Spiegelhalter (2005).
</p>


<h3>Usage</h3>

<pre><code class="language-R">funnel_plot(data, ctime, p0, glmmod, followup, predlim = c(0.95, 0.99),
  assist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>data.frame</code> with rows representing subjects and the
following named columns: </p>

<dl>
<dt>
<code>entrytime</code>:</dt>
<dd>
<p>time of entry into study (numeric);</p>
</dd>
<dt>
<code>survtime</code>:</dt>
<dd>
<p>time from entry until event (numeric);</p>
</dd>
<dt>
<code>censorid</code>:</dt>
<dd>
<p>censoring indicator (0 = right censored, 1 = observed),
(integer);</p>
</dd>
<dt>
<code>unit</code>:</dt>
<dd>
<p>integer or character indicating which unit
(f.e. hospital) the observation belongs to.</p>
</dd>
</dl>
<p> and optionally additional covariates used for risk-adjustment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ctime</code></td>
<td>
<p>Construction time at which the funnel plot
should be determined. Maximum possible time used when not specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p0</code></td>
<td>
<p>The baseline failure probability at <code>entrytime + followup</code> for individuals.
If not specified, average failure proportion over whole data is used instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glmmod</code></td>
<td>
<p>A generalized linear regression model as produced by
the function <code>glm()</code>. Recommended: <br><code>glm(as.formula("(survtime &lt;= followup) &amp; (censorid == 1) ~ covariates"), data = data)</code>. <br>
Alternatively, a list with the following elements:
</p>

<dl>
<dt>
<code>formula</code>:</dt>
<dd>
<p>a <code>formula()</code> in the form <code>~ covariates</code>;</p>
</dd>
<dt>
<code>coefficients</code>:</dt>
<dd>
<p>a named vector specifying risk adjustment coefficients
for covariates. Names must be the same as in <code>formula</code> and colnames of <code>data</code>.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>followup</code></td>
<td>
<p>The followup time for every individual. At what time
after subject entry do we consider the outcome?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predlim</code></td>
<td>
<p>A vector of confidence levels for the prediction limits of interest. Default is c(0.95, 0.99).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assist</code></td>
<td>
<p>(optional): Output of the function <code>parameter_assist()</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class "funnelplot" containing:
</p>

<ul>
<li> <p><code>data</code>: A <code>data.frame</code> containing:
</p>

<dl>
<dt>
<code>unit</code>:</dt>
<dd>
<p>unit number/name;</p>
</dd>
<dt>
<code>observed</code>:</dt>
<dd>
<p>observed number of failures at unit;</p>
</dd>
<dt>
<code>expected</code>:</dt>
<dd>
<p>expected (risk-adjusted) number of failures at unit;</p>
</dd>
<dt><code>numtotal</code></dt>
<dd>
<p>total number of individuals considered at this unit;</p>
</dd>
<dt>
<code>p</code>:</dt>
<dd>
<p>(risk-adjusted) proportion of failure at unit;</p>
</dd>
<dt>
<code>predlimels</code>:</dt>
<dd>
<p>worse/in-control/better performance than expected at
specified confidence levels.</p>
</dd>
</dl>
</li>
<li> <p><code>call</code>: the call used to obtain output
</p>
</li>
<li> <p><code>plotdata</code>: data used for plotting confidence intervals
</p>
</li>
<li> <p><code>predlim</code>: specified confidence level(s)
</p>
</li>
<li> <p><code>p0</code>: (Estimated) baseline failure probability
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Daniel Gomon
</p>


<h3>References</h3>

<p>Spiegelhalter D. J. (2005). Funnel plots for comparing
institutional performance. Statistics in medicine, 24(8), 1185-1202.
<a href="https://doi.org/10.1002/sim.1970">doi:10.1002/sim.1970</a>
</p>


<h3>See Also</h3>

<p><code>plot.funnelplot</code>, <code>summary.funnelplot</code>
</p>
<p>Other quality control charts: 
<code>bk_cusum()</code>,
<code>cgr_cusum()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#Determine a risk-adjustment model using a generalized linear model.
#Outcome (survival in first 100 days) is regressed on the available covariates:
exprfitfunnel &lt;- as.formula("(survtime &lt;= 100) &amp; (censorid == 1)~ age + sex + BMI")
glmmodfun &lt;- glm(exprfitfunnel, data = surgerydat, family = binomial(link = "logit"))
#Determine the necessary values to produce a funnel plot
funnel &lt;- funnel_plot(data = surgerydat, ctime = 3*365, glmmod = glmmodfun, followup = 100)
#Produce a funnel plot!
plot(funnel)
## Not run: 
require(plotly)
#Create an interactive plot!
ggplotly(plot(funnel))

## End(Not run)
</code></pre>


</div>