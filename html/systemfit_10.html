<div class="container">

<table style="width: 100%;"><tr>
<td>estfun.systemfit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Extract Gradients of the Objective Function at each Observation</h2>

<h3>Description</h3>

<p>Extract the gradients of the objective function 
with respect to the coefficients 
evaluated at each observation 
(‘Empirical Estimating Function’, 
see <code>estfun</code>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'systemfit'
estfun( x, residFit = TRUE, ... )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an object of class <code>systemfit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residFit</code></td>
<td>
<p>logical. 
If <code>FALSE</code>, the residuals are calculated based on observed regressors.
If <code>TRUE</code>, the residuals are calculated based on fitted regressors.
This argument is ignored if no instrumental variable are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments (currently ignored).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Matrix of gradients of the objective function
with respect to the coefficients
evaluated at each observation.
</p>


<h3>Warnings</h3>

<p>The <span class="pkg">sandwich</span> package must be loaded before this method
can be used.
</p>
<p>In specific estimations with the 3SLS method,
not all columns of the matrix returned by the <code>estfun</code> method
sum up to zero,
which indicates that an inappropriate estimating function is returned.
This can be either with argument <code>residFit</code> set to <code>TRUE</code> 
or with this argument set to <code>FALSE</code>
or even in both cases.
This problem depends on the formula used for the 3SLS estimation
and seems to be related to unbalanced systems and
systems where different instruments are used in different equations.
</p>


<h3>Author(s)</h3>

<p>Arne Henningsen
</p>


<h3>See Also</h3>

<p><code>estfun</code>, <code>systemfit</code>.</p>


<h3>Examples</h3>

<pre><code class="language-R">data( "Kmenta" )
eqDemand &lt;- consump ~ price + income
eqSupply &lt;- consump ~ price + farmPrice + trend
system &lt;- list( demand = eqDemand, supply = eqSupply )
inst &lt;- ~ income + farmPrice + trend

## OLS estimation
fitols &lt;- systemfit( system, "OLS", data = Kmenta )

## obtain the estimation function
library( "sandwich" )
estfun( fitols )

## this is only true for OLS models
all.equal( estfun( fitols ),
   unlist( residuals( fitols ) ) * model.matrix( fitols ) )

# each column should sum up to (approximately) zero
colSums( estfun( fitols ) )


## 2SLS estimation
fit2sls &lt;- systemfit( system, "2SLS", inst = inst, data = Kmenta )

## obtain the estimation function
estfun( fit2sls )

## this is only true for 2SLS models
all.equal( estfun( fit2sls ),
   drop( rep( Kmenta$consump, 2 ) -  model.matrix( fit2sls, which = "xHat" ) %*% 
   coef( fit2sls ) ) * model.matrix( fit2sls, which = "xHat" ) )
all.equal( estfun( fit2sls, residFit = FALSE ),
   unlist( residuals( fit2sls ) ) * model.matrix( fit2sls, which = "xHat" ) )

# each column should sum up to (approximately) zero
colSums( estfun( fit2sls ) )
colSums( estfun( fit2sls, residFit = FALSE ) )


## iterated SUR estimation
fitsur &lt;- systemfit( system, "SUR", data = Kmenta, maxit = 100 )

## obtain the estimation function
estfun( fitsur )

## this should be true for SUR and WLS models
all.equal( estfun( fitsur ),
   unlist( residuals( fitsur ) ) * 
   ( ( solve( fitsur$residCovEst ) %x% diag( nrow( Kmenta ) ) ) %*% 
      model.matrix( fitsur ) ), check.attributes = FALSE )

# each column should sum up to (approximately) zero
colSums( estfun( fitsur ) )


## 3SLS estimation
fit3sls &lt;- systemfit( system, "3SLS", inst = inst, data = Kmenta )

## obtain the estimation function
estfun( fit3sls )
estfun( fit3sls, residFit = FALSE )

## this should be true for 3SLS and W2SLS models
all.equal( estfun( fit3sls ),
   drop( rep( Kmenta$consump, 2 ) -  
   model.matrix( fit2sls, which = "xHat" ) %*% coef( fit3sls ) ) * 
   ( ( solve( fit3sls$residCovEst ) %x% diag( nrow( Kmenta ) ) ) %*% 
      model.matrix( fit3sls, which = "xHat" ) ), check.attributes = FALSE )
all.equal( estfun( fit3sls, residFit = FALSE ),
   unlist( residuals( fit3sls ) ) * 
   ( ( solve( fit3sls$residCovEst ) %x% diag( nrow( Kmenta ) ) ) %*% 
      model.matrix( fit3sls, which = "xHat" ) ), check.attributes = FALSE )

# each column should sum up to (approximately) zero
colSums( estfun( fit3sls ) )
colSums( estfun( fit3sls, residFit = FALSE ) )
</code></pre>


</div>