<div class="container">

<table style="width: 100%;"><tr>
<td>buildReference</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function for building a Symphony reference starting from expression matrix</h2>

<h3>Description</h3>

<p>Function for building a Symphony reference starting from expression matrix
</p>


<h3>Usage</h3>

<pre><code class="language-R">buildReference(
  exp_ref,
  metadata_ref,
  vars = NULL,
  K = 100,
  verbose = FALSE,
  do_umap = TRUE,
  do_normalize = TRUE,
  vargenes_method = "vst",
  vargenes_groups = NULL,
  topn = 2000,
  tau = 0,
  theta = 2,
  save_uwot_path = NULL,
  d = 20,
  additional_genes = NULL,
  umap_min_dist = 0.1,
  seed = 111
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>exp_ref</code></td>
<td>
<p>Reference gene expression (genes by cells)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metadata_ref</code></td>
<td>
<p>Reference cell metadata (cells by attributes)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>Reference variables to Harmonize over e.g. c('donor', 'technology')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>Number of soft cluster centroids in model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Verbose output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do_umap</code></td>
<td>
<p>Perform UMAP visualization on harmonized reference embedding</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do_normalize</code></td>
<td>
<p>Perform log(CP10K+1) normalization</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vargenes_method</code></td>
<td>
<p>Variable gene selection method (either 'vst' or 'mvp')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vargenes_groups</code></td>
<td>
<p>Name of metadata column specifying groups for variable gene selection. If not NULL, calculate topn variable genes in each group separately, then pool</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>topn</code></td>
<td>
<p>Number of variable genes to subset by</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>Tau parameter for Harmony step</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>Theta parameter(s) for Harmony step</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_uwot_path</code></td>
<td>
<p>Absolute path to save the uwot model (used if do_umap is TRUE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Number of PC dimensions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>additional_genes</code></td>
<td>
<p>Any custom genes (e.g. marker genes) to include in addition to variable genes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>umap_min_dist</code></td>
<td>
<p>umap parameter (see uwot documentation for details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Random seed</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Symphony reference object. Integrated embedding is stored in the $Z_corr slot. Other slots include
cell-level metadata ($meta_data), variable genes means and standard deviations ($vargenes),
loadings from PCA ($loadings), original PCA embedding ($Z_orig), reference compression terms ($cache),
betas from Harmony integration ($betas), cosine normalized soft cluster centroids ($centroids),
centroids in PC space ($centroids_pc), and optional umap coordinates ($umap$embedding).
</p>


</div>