<div class="container">

<table style="width: 100%;"><tr>
<td>rankTrial</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Ranking and Selection, and Head-to-Head Comparison of Individual and Pooled Treatment Arms</h2>

<h3>Description</h3>

<p><code>rankTrial</code> assesses the probability of correctly selecting the winning most efficacious (individual and/or pooled) treatment arm, and assesses power to detect relative treatment efficacy in head-to-head comparisons of (individual and/or pooled) treatment arms.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rankTrial(censFile, idxHighestVE, headHead = NULL, poolHead = NULL,
  lowerVE, stage1, stage2, alpha, saveDir = NULL, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>censFile</code></td>
<td>
<p>if <code>saveDir = NULL</code>, a list returned by <code>censTrial</code>; otherwise a name (character string) of an <code>.RData</code> file created by <code>censTrial</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>idxHighestVE</code></td>
<td>
<p>an integer value identifying the treatment (vaccine) arm with the true highest VE(0–<code>stage2</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>headHead</code></td>
<td>
<p>a matrix (<code>ncol = 2</code>) of treatment arm indices for head-to-head comparisons, where the treatment with higher efficacy is listed first in each row</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>poolHead</code></td>
<td>
<p>a matrix (<code>ncol</code> equals 3 or 4) of treatment arm indices for pooled-arm comparisons, where the pooled treatment with higher efficacy pooled over the first two columns is compared with the (pooled) treatment defined by columns 3 and onward. Ranking and selection of pooled arms is performed separately for each row of <code>poolHead</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lowerVE</code></td>
<td>
<p>a numeric value defining a ‘winning’ treatment arm as one with sufficient evidence for rejecting the null hypothesis H0: VE(0–<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVE</code> x 100% (typically set equal to 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage1</code></td>
<td>
<p>the final week of stage 1 in a two-stage trial</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage2</code></td>
<td>
<p>the final week of stage 2 in a two-stage trial, i.e., the maximum follow-up time</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used for testing a null hypothesis H0: VE(0–<code>stage1</code>) <code class="reqn">\le</code> <code class="reqn">b</code> x 100% against an alternative hypothesis H1: VE(0–<code>stage1</code>) <code class="reqn">&gt;</code> <code class="reqn">b</code> x 100%</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveDir</code></td>
<td>
<p>a character string specifying a path for <code>censFile</code>. If supplied, the output is also saved as an <code>.RData</code> file in this directory; otherwise the output is returned as a list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical value indicating whether information on the output directory and file name should be printed out (default is <code>TRUE</code>)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>All time variables use week as the unit of time. Month is defined as 52/12 weeks.
</p>
<p>The probability of correct treatment selection is defined as the probability that the treatment arm with the highest estimated VE(0–<code>stage2</code>) is the one with the true highest VE(0–<code>stage2</code>) and, for this treatment arm, the null hypothesis H0: VE(0–<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVE</code> x 100% is rejected. If <code>poolHead</code> is specified, the probability of correct pooled treatment selection is assessed for each set of two pooled treatment arms.
</p>
<p>VE(0–<code class="reqn">t</code>) is estimated as one minus the ratio of Nelson-Aalen-based cumulative incidence functions. The null hypothesis H0: VE(0–<code class="reqn">t</code>) <code class="reqn">\le</code> <code class="reqn">b</code> x 100% is rejected if the lower bound of the two-sided (1-<code>alpha</code>) x 100% confidence interval for VE(0–<code class="reqn">t</code>) lies above <code class="reqn">b</code>.
</p>
<p>For head-to-head individual and pooled treatment comparisons, powers to reject the null hypotheses that relative VE(0–<code>stage1</code>) <code class="reqn">\le</code> 0% and relative VE(0–<code>stage2</code>) <code class="reqn">\le</code> 0% are assessed using the aforementioned testing rule.
</p>


<h3>Value</h3>

<p>If <code>saveDir</code> is specified, the output list (named <code>out</code>) is saved as an <code>.RData</code> file in <code>saveDir</code> (the path to <code>saveDir</code> is printed); otherwise it is returned. The output object is a list with the following components:
</p>

<ul>
<li> <p><code>rankSelectPw</code>: the probability of correct selection of the winning most efficacious individual treatment
</p>
</li>
<li> <p><code>headHeadPw</code>: if <code>headHead</code> is specified, a matrix of powers to detect relative VE(0–<code>stage1</code>) (column 1) and relative VE(0–<code>stage2</code>) (column 2) in head-to-head comparisons of individual treatment arms
</p>
</li>
<li> <p><code>poolRankSelectPw</code>: if <code>poolHead</code> is specified, a numeric vector of the probabilities of correct selection of the winning most efficacious pooled treatment for each set of pooled treatments
</p>
</li>
<li> <p><code>poolHeadPw</code>: if <code>poolHead</code> is specified, a matrix of powers to detect relative VE(0–<code>stage1</code>) (column 1) and relative VE(0–<code>stage2</code>) (column 2) in head-to-head comparisons of pooled treatment arms
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>simTrial</code>, <code>monitorTrial</code>, and <code>censTrial</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
simData &lt;- simTrial(N=c(1000, rep(700, 2)), aveVE=seq(0, 0.4, by=0.2), 
                    VEmodel="half", vePeriods=c(1, 27, 79), enrollPeriod=78, 
                    enrollPartial=13, enrollPartialRelRate=0.5, dropoutRate=0.05, 
                    infecRate=0.04, fuTime=156, 
                    visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)),
                    missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=5, 
                    stage1=78, randomSeed=300)

monitorData &lt;- monitorTrial(dataFile=simData, stage1=78, stage2=156, 
                            harmMonitorRange=c(10,100), alphaPerTest=NULL, 
                            nonEffStartMethod="FKG", nonEffInterval=20, 
                            lowerVEnoneff=0, upperVEnoneff=0.4, 
                            highVE=0.7, stage1VE=0, lowerVEuncPower=0, 
                            alphaNoneff=0.05, alphaHigh=0.05, alphaStage1=0.05, 
                            alphaUncPower=0.05, estimand="cuminc", lagTime=26)

censData &lt;- censTrial(dataFile=simData, monitorFile=monitorData, stage1=78, stage2=156)
                       
rankData &lt;- rankTrial(censFile=censData, idxHighestVE=2, 
                      headHead=matrix(2:1, nrow=1, ncol=2), lowerVE=0, stage1=78, 
                      stage2=156, alpha=0.05)

### alternatively, to save the .RData output file (no '&lt;-' needed):
###
### simTrial(N=c(1400, rep(1000, 2)), aveVE=seq(0, 0.4, by=0.2), VEmodel="half", 
###          vePeriods=c(1, 27, 79), enrollPeriod=78, enrollPartial=13, 
###          enrollPartialRelRate=0.5, dropoutRate=0.05, infecRate=0.04, fuTime=156, 
###          visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)), 
###          missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=30, 
###          stage1=78, saveDir="./", randomSeed=300)
###
### monitorTrial(dataFile=
###          "simTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04.RData", 
###          stage1=78, stage2=156, harmMonitorRange=c(10,100), alphaPerTest=NULL, 
###          nonEffStartMethod="FKG", nonEffInterval=20, 
###          lowerVEnoneff=0, upperVEnoneff=0.4, highVE=0.7, stage1VE=0, 
###          lowerVEuncPower=0, alphaNoneff=0.05, alphaHigh=0.05, alphaStage1=0.05, 
###          alphaUncPower=0.05, estimand="cuminc", lagTime=26, saveDir="./")
###
### censTrial(dataFile=
###  "simTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04.RData",
###  monitorFile=
###  "monitorTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04_cuminc.RData",
###  stage1=78, stage2=156, saveDir="./")
###
### rankTrial(censFile=
###  "trialDataCens_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04_cuminc.RData",
###  idxHighestVE=2, headHead=matrix(2:1, nrow=1, ncol=2), lowerVE=0, stage1=78, 
###  stage2=156, alpha=0.05, saveDir="./")

</code></pre>


</div>