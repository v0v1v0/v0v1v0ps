<div class="container">

<table style="width: 100%;"><tr>
<td>surfaceSimulate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Simulate Data for SURFACE
</h2>

<h3>Description</h3>

<p>Provides several ways to simulate data sets on phylogenetic trees in conjunction with SURFACE analyses. Can simulate under simple models without regime shifts, under a Hansen model with sampled shift locations, or under a fitted Hansen model (optionally with resampled optima)
</p>


<h3>Usage</h3>

<pre><code class="language-R">surfaceSimulate(phy, type = "BM", param = 0, n_traits = NULL, dat = NULL, 
vcv = NULL, hansenfit = NULL, shifts = NULL, n_shifts = NULL, 
n_conv_shifts = NULL, n_regimes = NULL, n_per_regime = NULL, 
no_nested = TRUE, optima = NULL, sample_optima = TRUE, 
optima_distrib = NULL, optima_type = "rnorm", sigma_squared = NULL, 
alpha = NULL, pshift_timefactor = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>phy</code></td>
<td>

<p>A phylogenetic tree in <code>phylo</code> format on which to simulate data
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>

<p>Type of simulation desired - options are <code>"BM"</code>, <code>"hansen-fit"</code>, and <code>"hansen-paint"</code> (see Details)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param</code></td>
<td>

<p>If <code>type="BM"</code>, an optional parameter to rescale the tree (see Details)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_traits</code></td>
<td>

<p>Number of traits (if not provided will be determined from other inputs or default to 1)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>

<p>Optional data frame of original trait data (function will use this to extract features of the data set)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcv</code></td>
<td>

<p>Optional evolutionary variance-covariance matrix
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hansenfit</code></td>
<td>

<p>A fitted Hansen model (or a list of such if multiple traits) (if <code>type = "hansen-fit"</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shifts</code></td>
<td>

<p>A vector of regime shifts, named for the branches they are to be placed on in the Hansen model to be simulated under (if <code>type = "hansen-paint"</code>). If specified, <code>n_shifts</code>, <code>n_conv_shifts</code>, <code>n_regimes</code> and <code>n_per_regime</code> are all ignored
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_shifts</code></td>
<td>

<p>Number of shifts to add to the Hansen model (if <code>type = "hansen-paint"</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_conv_shifts</code></td>
<td>

<p>Number of convergent shifts to add to the Hansen model (if <code>type = "hansen-paint"</code>). Either <code>n_conv_shifts</code> or <code>n_regimes</code> can be specified along with <code>n_shifts</code>, but not both
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_regimes</code></td>
<td>

<p>Number of regimes to add to the Hansen model (if <code>type = "hansen-paint"</code>). Either <code>n_conv_shifts</code> or <code>n_regimes</code> can be specified along with <code>n_shifts</code>, but not both
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_per_regime</code></td>
<td>

<p>Integer vector of the number of shifts to each regime in the model (if <code>type = "hansen-paint"</code>). If specified, the vector length determines <code>n_regimes</code>, and the sum of the values determines <code>n_shifts</code>, and the number of entries &gt;1 determines <code>n_conv_shifts</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>no_nested</code></td>
<td>

<p>A logical indicating whether to ensure that a pair of ‘convergent’ regimes is not in fact two nested clades (if <code>type = "hansen-paint"</code>; defaults to <code>TRUE</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optima</code></td>
<td>

<p>Optional matrix of optima
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_optima</code></td>
<td>

<p>A logical indicating whether to replace the optima in the fitted model with new values from a distribution based on the inferred optima (if <code>type = "hansen-fit"</code>; defaults to <code>TRUE</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optima_distrib</code></td>
<td>

<p>Optional matrix of optima distribution for each trait (see <code>optima_type</code>). Each column is a two-element vector <code>c(A, B)</code> for the trait. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optima_type</code></td>
<td>

<p>How to sample optima based on <code>optima_distrib</code>. Can be one of <code>"rnorm"</code> (default; distribution is normal with mean=A, sd=B), <code>"runif"</code> (distribution is uniform with center=A, width=B), or <code>"even"</code> (optima are evenly spaced with spacing=B, then randomized)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma_squared</code></td>
<td>

<p>Scalar or vector of Brownian rate parameters to use in simulations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>

<p>Scalar or vector of OU attraction parameter values to use in simulations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pshift_timefactor</code></td>
<td>

<p>Factor by which to bias sampling of branches to place regimes on to be earlier (if &lt;1) or later (if &gt;1) in the tree. The sampling probability will be <code>pshift_timefactor</code> times higher at the tips than at the root
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Type of simulation may be <code>"BM"</code>, <code>"hansen-fit"</code>, or <code>"hansen-paint"</code>.
</p>
<p>If type = <code>"BM"</code>, simulation uses the <code>sim.char</code> function in <code>geiger</code>, with Brownian rate <code>sigma_squared</code>. If <code>type = "BM"</code>, <code>param</code> values other than 0 will transform the tree based on the Early Burst (<code>param &lt; 0</code>) or single-peak Ornstein-Uhlenbeck (<code>param &gt; 0</code>) model before simulating, causing trait disparity to be concentrated earlier or later in the tree, respectively 
</p>
<p>If <code>type = "hansen-fit"</code>, an existing <code>hansentree</code> object is used as the basis of simulation using <code>ouch</code> functions, optionally with new parameter values
</p>
<p>If <code>type = "hansen-paint"</code>, a new <code>hansentree</code> object is produced for simulation using <code>ouch</code> functions, with specified parameter values and numbers of regimes and/or regime shifts
</p>


<h3>Value</h3>

<p>A list with the following components (most are NULL if <code>type = "BM"</code>):
</p>
<table>
<tr style="vertical-align: top;">
<td><code>data </code></td>
<td>
<p>Simulated trait data in a data frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optima </code></td>
<td>
<p>Matrix of optima for each regime for each trait in the generating model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savedshifts </code></td>
<td>
<p>Shift locations in the generating Hansen model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regimes </code></td>
<td>
<p>Regime assignments of tip taxa</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shifttimes </code></td>
<td>
<p>Timing of each shift in the Hansen model (measured from the root of the tree</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit </code></td>
<td>
<p>Generating Hansen model used in the simulation</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Travis Ingram
</p>


<h3>References</h3>

<p>Ingram, T. &amp; Mahler, D.L. (2013) SURFACE: detecting convergent evolution from comparative data by fitting Ornstein-Uhlenbeck models with stepwise AIC. Methods in Ecology and Evolution 4: 416-425. 
</p>


<h3>See Also</h3>

<p><code>surfaceForward</code>, <code>surfaceBackward</code>, <code>surfaceTreePlot</code>, <code>surfaceTraitPlot</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(surfaceDemo)
tree&lt;-surfaceDemo$tree
dat&lt;-surfaceDemo$sim$dat
olist&lt;-convertTreeData(tree,dat)
otree&lt;-olist[[1]]; odata&lt;-olist[[2]]
sim&lt;-surfaceSimulate(otree,type="hansen-paint",dat=dat,shifts=c(c("1"="a","6"="b","17"="c")))
</code></pre>


</div>