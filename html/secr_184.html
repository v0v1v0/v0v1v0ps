<div class="container">

<table style="width: 100%;"><tr>
<td>mask.check</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Mask Diagnostics
</h2>

<h3>Description</h3>

<p><code>mask.check</code> evaluates the effect of varying buffer width and
mask spacing on either the likelihood or density estimates from
secr.fit().
</p>


<h3>Usage</h3>

<pre><code class="language-R">mask.check(object, buffers = NULL, spacings = NULL, poly = NULL,
    LLonly = TRUE, realpar = NULL, session = 1, file = NULL,
    drop = "", tracelevel = 0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>object of class ‘capthist’ or ‘secr’</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>buffers</code></td>
<td>
<p>vector of buffer widths</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spacings</code></td>
<td>
<p>vector of mask spacings</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>poly</code></td>
<td>
<p> matrix of two columns, the x- and  y-coordinates of a bounding polygon (optional) </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LLonly</code></td>
<td>
<p>logical; if TRUE then only the log likelihood is
computed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>realpar</code></td>
<td>
<p>list of parameter values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>session</code></td>
<td>
<p>vector of session indices (used if <code>object</code> spans multiple sessions)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>name of output file (optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop</code></td>
<td>
<p>character vector: names of fitted secr object to omit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tracelevel</code></td>
<td>
<p>integer for level of detail in reporting (0,1,2)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments passed to secr.fit</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Masks of varying buffer width and spacing are constructed with the
‘trapbuffer’ method in <code>make.mask</code>, using the detector locations
(‘traps’) from either a capthist object or a previous execution of
<code>secr.fit</code>. Default values are provided for <code>buffers</code> and
<code>spacings</code> if <code>object</code> is of class ‘secr’ (respectively c(1,
1.5, 2) and c(1, 0.75, 0.5) times the values in the existing
mask). The default for <code>buffers</code> will not work if a detector is
on the mask boundary, as the inferred buffer is then 0.
</p>
<p>Variation in the mask may be assessed for its effect on –
</p>
   
<ul>
<li>
<p> the log-likelihood evaluated for given values of the
parameters (<code>LLonly = TRUE</code>)
</p>
</li>
<li>
<p> estimates from maximizing the likelihood with each mask
(<code>LLonly = FALSE</code>)      
</p>
</li>
</ul>
<p><code>realpar</code> should be a list with one named component for each real
parameter (see Examples). It is relevant only if <code>LLonly =
  TRUE</code>. <code>realpar</code> may be omitted if <code>object</code> is of class
‘secr’; parameter values are then extracted from <code>object</code>.
</p>
<p><code>session</code> should be an integer or character vector suitable for
indexing sessions in <code>object</code>, or in <code>object$capthist</code> if
<code>object</code> is a fitted model. Each session is considered
separately; a model formula that refers to session or uses session
covariates will cause an error.
</p>
<p>If <code>file</code> is specified then detailed
results (including each model fit when <code>LLonly = FALSE</code>) are
saved to an external .RData file. Loading this file creates or
overwrites object(s) in the workspace: <code>mask.check.output</code> if
<code>LLonly = TRUE</code>, otherwise <code>mask.check.output</code> and
<code>mask.check.fit</code>. For multiple sessions these are replaced by
lists with one component per session (<code>mask.check.outputs</code> and
<code>mask.check.fits</code>). The <code>drop</code> argument is passed to
<code>trim</code> and applied to each fitted model; use it to save
space, at the risk of limiting further computation on the fitted
models.
</p>
<p><code>tracelevel&gt;0</code> causes more verbose reporting of progress during
execution.
</p>
<p>The ... argument may be used to override existing settings in
<code>object</code> - for example, a conditional likelihood fit (<code>CL =
  T</code>) may be selected even if the original model was fitted by
maximizing the full likelihood.
</p>


<h3>Value</h3>

<p>Array of log-likelihoods (<code>LLonly = TRUE</code>) or estimates
(<code>LLonly = FALSE</code>) for each combination of <code>buffers</code> and
<code>spacings</code>. The array has 3 dimensions if <code>LLonly = FALSE</code>
and both <code>buffers</code> and <code>spacings</code> have multiple levels;
otherwise it collapses to a matrix. Rows generally represent
<code>buffers</code>, but rows represent <code>spacings</code> if a single buffer
is specified.
</p>


<h3>Warning</h3>

<p><code>mask.check()</code> may fail if <code>object</code> is a fitted ‘secr’ model
and a data object named in the original call of <code>secr.fit()</code>
(i.e. <code>object$call</code>) is no longer in the working environment
(<code>secr.fit</code> arguments capthist, mask, verify &amp; trace are
exempt). Fix by any of (1) applying <code>mask.check</code> directly to the
‘capthist’ object, specifying other arguments (<code>buffers</code>,
<code>spacings</code>, <code>realpar</code>) as needed, (2) re-fitting the model
and running <code>mask.check</code> in the same environment, (3) specifying
the offending argument(s) in ..., or (4) re-creating the required
data objects(s) in the working environment, possibly from saved inputs
in <code>object</code> (e.g., <code>mytimecov &lt;- myfit$timecov</code>).
</p>


<h3>Note</h3>

<p>When <code>LLonly = TRUE</code> the functionality of <code>mask.check</code>
resembles that of the ‘Tools | ML SECR log likelihood’ menu option in
Density 5. The help page in Density 5 for ML SECR 2-D integration (see
index) may be helpful.
</p>
<p>Warning messages from <code>secr.fit</code> are suppressed. ‘capthist’
data provided via the <code>object</code> argument are checked with
<code>verify.capthist</code> if <code>tracelevel &gt; 0</code>.
</p>
<p>The likelihood-only method is fast, but not definitive. It is
reasonable to aim for stability in the third decimal place of the log
likelihood. Slight additional variation in the likelihood may cause
little change in the estimates; the only way to be sure is to check
these by setting <code>LLonly = FALSE</code>.
</p>
<p>The performance of a mask depends on the detection function; be sure
to set the <code>detectfn</code> argument appropriately. The hazard rate
function has a fat tail that can be problematic.
</p>
<p>When provided with an ‘secr’ <code>object</code>, <code>mask.check</code>
constructs a default vector of buffer widths as multiples of the
buffer used in <code>object</code> <em>even though that value is not saved
explicitly</em>. For this trick, detector locations in
<code>traps(object$capthist)</code> are compared to the bounding box of
<code>object$mask</code>; the base level of buffer width is the maximum
possible within the bounding box.
</p>


<h3>References</h3>

<p>Borchers, D. L. and Efford, M. G. (2008) Spatially explicit maximum
likelihood methods for capture–recapture studies. <em>Biometrics</em>
<b>64</b>, 377–385.
</p>
<p>Efford, M. G. (2012) <em>DENSITY 5.0: software for spatially explicit
capture–recapture</em>. Department of Mathematics and Statistics,
University of Otago, Dunedin, New Zealand. <a href="https://www.otago.ac.nz/density/">https://www.otago.ac.nz/density/</a>.
</p>


<h3>See Also</h3>

<p><code>esaPlot</code>, <code>make.mask</code>, <code>secr.fit</code> 
</p>


<h3>Examples</h3>

<pre><code class="language-R">

## Not run: 

## from a capthist object, specifying almost everything
mask.check (possumCH, spacings = c(20, 30), buffers =c(200, 300),
    realpar = list(g0 = 0.2, sigma = 50), CL = TRUE)

## from a fitted model, using defaults
mask.check (stoat.model.HN)
## LL did not change with varying buffer (rows) or spacing (cols):
##         78.125  58.59375   39.0625
## 1000 -144.0015 -144.0015 -144.0015
## 1500 -144.0017 -144.0017 -144.0017
## 2000 -144.0017 -144.0017 -144.0017

## fit new models for each combination of buffer &amp; spacing,
## and save fitted models to a file
mask.check (stoat.model.HN, buffers = 1500, spacings =
    c(40,60,80), LLonly = FALSE, file = "test", CL = TRUE)

## look in more detail at the preceding fits
## restores objects `mask.check.output' and `mask.check.fit'
load("test.RData")  
lapply(mask.check.fit, predict)
lapply(mask.check.fit, derived)

## multi-session data
mask.check(ovenbird.model.1, session = c("2005","2009"))

## clipping mask
txtfilename &lt;- system.file("extdata/possumarea.txt", package = "secr")
possumarea &lt;- read.table(txtfilename, header = TRUE)
mask.check (possum.model.0, spacings = c(20, 30), buffers =
    c(200, 300), poly = possumarea, LLonly = FALSE,
    file = "temp", CL = TRUE)

## review fitted models
load ("temp.RData")
par(mfrow = c(2,2), mar = c(1,4,4,4))
for (i in 1:4) {
    plot(traps(mask.check.fit[[i]]$capthist), border = 300,
        gridlines = FALSE)
    plot(mask.check.fit[[i]]$mask, add = TRUE)
    lines(possumarea)
    text ( 2698618, 6078427, names(mask.check.fit)[i])
    box()
}
par(mfrow = c(1,1), mar = c(5,4,4,2) + 0.1)    ## defaults


## End(Not run)

</code></pre>


</div>