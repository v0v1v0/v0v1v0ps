<div class="container">

<table style="width: 100%;"><tr>
<td>ad</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Adaptive smooth terms in a SOP model formula</h2>

<h3>Description</h3>

<p>Auxiliary function used to define adaptive smooth terms in a <code>sop</code> model formula. The function does not do any fitting but is used as part of a <code>sop()</code> model formula.</p>


<h3>Usage</h3>

<pre><code class="language-R">ad(..., nseg = 10, pord = 2, degree = 3, nseg.sp = 5, degree.sp = 3)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>the x-variable (continuous) to be used for adaptive smoothing. Currently, only one dimensional adaptive smoothers are allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nseg</code></td>
<td>
<p>the number of segments for the B-spline basis used to represent the smooth term. The default value is 10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pord</code></td>
<td>
<p>penalty order. The defauly value is 2 (second order penalty).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>the order of the polynomial for the B-spline basis for this term. The default value is 3 (cubic B-splines).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nseg.sp</code></td>
<td>
<p>the number of segments for the B-spline basis used to ‘smooth’ the smoothing parameters. The default value is 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree.sp</code></td>
<td>
<p>the order of the polynomial for the B-spline basis used for smoothing of the smoothing parameters. The default value is 3 (cubic B-splines).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function <code>ad()</code> can be use to fit an adaptive smooth function of <code>x</code>.
An ‘adaptive’  smooth function is one in which the smoothing parameter is allowed to vary over the range of the explanatory variable <code>x</code>. Details can be found in Rodriguez-Alvarez <em>at. al</em> (2019).  
</p>


<h3>Value</h3>

<p>The function is interpreted in the formula of a <code>sop</code> model and creates the right framework for fitting the adaptive smoother. List containing the following objects:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>name of the covariates involved in the adaptive smooth term.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nseg</code></td>
<td>
<p>the number of segments for the B-spline basis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pord</code></td>
<td>
<p>the penalty order.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>the order of the polynomial for the B-Spline basis for this term. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nseg.sp</code></td>
<td>
<p>the number of segments for the B-spline basis used to ‘smooth’ the smoothing parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree.sp</code></td>
<td>
<p>the order of the polynomial for the B-spline basis used for smoothing of the smoothing parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dim</code></td>
<td>
<p>The dimension of the smoother - i.e. the number of covariates that it is a function of.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label</code></td>
<td>
<p>labels terms.</p>
</td>
</tr>
</table>
<h3>References</h3>


<p>Rodriguez-Alvarez, M.X., Durban, M., Lee, D. J. and Eilers, P. (2019). On the estimation of variance parameters in non-standard generalised linear mixed models: application to penalised smoothing. <em>Statistics and Computing</em>, <b>29 (3)</b>, 483–500.
</p>


<h3>See Also</h3>

<p><code>f</code>, <code>rae</code>, <code>sop</code></p>


<h3>Examples</h3>

<pre><code class="language-R">library(SOP)
# Simulate the data
set.seed(123)
n &lt;- 1000
x &lt;- runif(n, 0.0001, 1)
doppler.function &lt;- function(x) sin(4 / (x + 0.1)) + 1.5
mu &lt;- doppler.function(x)
sigma &lt;- 0.2
y &lt;- mu + sigma*rnorm(n)
dat &lt;- data.frame(x = x, y = y)

# Fit the models
# With addaptive smoothing
m0 &lt;- sop(formula = y ~ ad(x, nseg = 197, nseg.sp = 17), data = dat, 
         control =  list(trace = FALSE, epsilon = 1e-03))

# Without addaptive smoothing
m1 &lt;- sop(formula = y ~ f(x, nseg = 197), data = dat, 
         control =  list(trace = FALSE, epsilon = 1e-03))         

# Plot results
plot(y ~ x, data = dat)
ox &lt;- order(dat$x)
lines(fitted(m0)[ox] ~ dat$x[ox], col = 2, lwd = 2)
lines(fitted(m1)[ox] ~ dat$x[ox], col = 4, lwd = 2)
legend("topright", c("Theoretical", "Adaptive", "Non Adaptive"), 
    col = c(1,2,4), lty = 1, lwd = 2, bty = "n")	
</code></pre>


</div>