<div class="container">

<table style="width: 100%;"><tr>
<td>das_effort</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Summarize DAS effort</h2>

<h3>Description</h3>

<p>Chop DAS data into effort segments
</p>


<h3>Usage</h3>

<pre><code class="language-R">das_effort(x, ...)

## S3 method for class 'data.frame'
das_effort(x, ...)

## S3 method for class 'das_df'
das_effort(
  x,
  method = c("condition", "equallength", "section"),
  conditions = NULL,
  strata.files = NULL,
  distance.method = c("greatcircle", "lawofcosines", "haversine", "vincenty"),
  seg0.drop = FALSE,
  comment.drop = FALSE,
  event.touse = NULL,
  num.cores = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an object of class <code>das_df</code>,
or a data frame that can be coerced to class <code>das_df</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments passed to the specified chopping function,
such as <code>seg.km</code> or <code>seg.min.km</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>character; method to use to chop DAS data into effort segments
Can be "condition", "equallength", "section",
or any partial match thereof (case sensitive)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conditions</code></td>
<td>
<p>character vector of names of conditions to include in segdata output.
These values must be column names from the output of <code>das_process</code>,
e.g. 'Bft', 'SwellHght', etc.
If <code>method == "condition"</code>, then these also are the conditions which
trigger segment chopping when they change. Only the following conditions can be used for chopping:
'Bft', 'SwellHght', 'RainFog', 'HorizSun', 'VertSun', 'Glare', 'Vis', 'Course', 'SpdKt'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata.files</code></td>
<td>
<p>list of path(s) of the CSV file(s) with points defining each stratum.
The CSV files must contain headers and be a closed polygon.
The list should be named; see the Details section.
If <code>NULL</code> (the default), then no effort segments are not classified by strata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distance.method</code></td>
<td>
<p>character;
method to use to calculate distance between lat/lon coordinates.
Can be "greatcircle", "lawofcosines", "haversine", "vincenty",
or any partial match thereof (case sensitive).
Default is "greatcircle"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seg0.drop</code></td>
<td>
<p>logical; flag indicating whether or not to drop segments
of length 0 that contain no sighting (S, K, M, G, t) events.
Default is <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comment.drop</code></td>
<td>
<p>logical; flag indicating if comments ("C" events)
should be ignored (i.e. position information should not be used)
when segment chopping. Default is <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event.touse</code></td>
<td>
<p>character vector of events to use to determine
segment lengths; overrides <code>comment.drop</code>.
If <code>NULL</code> (the default), then all on effort events are used.
If used, this argument must include at least R, E, S, and A events,
and cannot include ? or 1:8 events</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num.cores</code></td>
<td>
<p>Number of CPUs to over which to distribute computations.
Defaults to <code>NULL</code>, which uses one fewer than the number of cores
reported by <code>detectCores</code>.
Using 1 core likely will be faster for smaller datasets</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is the top-level function for chopping processed DAS data
into modeling segments (henceforth 'segments'), and assigning sightings
and related information (e.g., weather conditions) to each segment.
This function returns data frames with all relevant information for the
effort segments and associated sightings ('segdata' and 'sightinfo', respectively).
Before chopping, the DAS data is filtered for events (rows) where either
the 'OnEffort' column is <code>TRUE</code> or the 'Event' column "E".
In other words, the data is filtered for continuous effort sections (henceforth 'effort sections'),
where effort sections run from "R" to "E" events (inclusive),
and then passed to the chopping function specified using <code>method</code>.
Note that while B events immediately preceding an R are on effort,
they are ignored during effort chopping.
In addition, all on effort events (other than ? and numeric events)
with <code>NA</code> DateTime, Lat, or Lon values are verbosely removed.
</p>
<p>If <code>strata.files</code> is not <code>NULL</code>, then the effort lines
will be split by the user-provided stratum (strata).
In this case, a column 'stratum' will be added to the end of the segdata
data frame with the user-provided name of the stratum that the segment was in,
or <code>NA</code> if the segment was not in any of the strata.
If no name was provided for the stratum in <code>strata.files</code>,
then the value will be "Stratum#",
where "#" is the index of the applicable stratum in <code>strata.files</code>.
While the user can provide as many strata as they want,
these strata can share boundaries but they cannot overlap.
See <code>das_effort_strata</code> for more details.
</p>
<p>The following chopping methods are currently available:
"condition", "equallength", and "section.
When using the "condition" method, effort sections are chopped
into segments every time a condition changes,
thereby ensuring that the conditions are consistent across the entire segment.
See <code>das_chop_condition</code> for more details about this method,
including arguments that must be passed to it via the argument <code>...</code>
</p>
<p>The "equallength" method consists of
chopping effort sections into equal-length segments of length <code>seg.km</code>,
and doing a weighted average of the conditions for the length of that segment.
See <code>das_chop_equallength</code> for more details about this method,
including arguments that must be passed to it via the argument <code>...</code>
</p>
<p>The "section" method involves 'chopping' the effort into continuous effort sections,
i.e. each continuous effort section is a single effort segment.
See <code>das_chop_section</code> for more details about this method.
</p>
<p>The distance between the lat/lon points of subsequent events
is calculated using the method specified in <code>distance.method</code>.
If "greatcircle", <code>distance_greatcircle</code> is used,
while <code>distance</code> is used otherwise.
See <code>das_sight</code> for how the sightings are processed.
</p>
<p>The sightinfo data frame includes the column 'included',
which is used in <code>das_effort_sight</code> when summarizing
the number of sightings and animals for selected species.
<code>das_effort_sight</code> is a separate function to allow users to
personalize the included values as desired for their analysis.
By default, i.e. in the output of this function, 'included' is <code>TRUE</code> if:
the sighting was made when on effort,
by a standard observer (see <code>das_sight</code>),
and in a Beaufort sea state less than or equal to five.
</p>


<h3>Value</h3>

<p>List of three data frames:
</p>

<ul>
<li>
<p> segdata: one row for every segment, and columns for information including
unique segment number (segnum), the corresponding effort section (section_id),
the segment index within the corresponding effort section (section_sub_id),
the starting and ending line of the segment in the DAS file (stlin, endlin),
start/end/midpoint coordinates(lat1/lon1, lat2/lon2, and mlat/mlon, respectively),
the start/end/midpoint date/time of the segment (DateTime1, DateTime2, and mDateTime, respectively;
mDateTime is the average of DateTime1 and DateTime2), segment length (dist),
conditions (e.g. Beaufort), and, if applicable, stratum (InStratumName).
</p>
</li>
<li>
<p> sightinfo: details for all sightings in <code>x</code>, including:
the unique segment number it is associated with, segment mid points (lat/lon),
the 'included' column described in the 'Details' section,
and the output information described in <code>das_sight</code> for <code>return.format</code> is "default"
</p>
</li>
<li>
<p> randpicks: see <code>das_chop_equallength</code>;
<code>NULL</code> if using "condition" method
</p>
</li>
</ul>
<h3>See Also</h3>

<p>Internal functions called by <code>das_effort</code>:
<code>das_chop_condition</code>, <code>das_chop_equallength</code>,
<code>das_chop_section</code>, <code>das_segdata</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">y &lt;- system.file("das_sample.das", package = "swfscDAS")
y.proc &lt;- das_process(y)

# Using "condition" method
das_effort(
  y.proc, method = "condition", conditions = c("Bft", "SwellHght", "Vis"),
  seg.min.km = 0.05, num.cores = 1
)

# Using "section" method
das_effort(y.proc, method = "section", num.cores = 1)


# Using "equallength" method
y.rand &lt;- system.file("das_sample_randpicks.csv", package = "swfscDAS")
das_effort(
  y.proc, method = "equallength", seg.km = 10, randpicks.load = y.rand,
  num.cores = 1
)

# Using "section" method and chop by strata
stratum.file &lt;- system.file("das_sample_stratum.csv", package = "swfscDAS")
das_effort(
  y.proc, method = "section", strata.files = list(Poly1 = stratum.file),
  num.cores = 1
)


</code></pre>


</div>