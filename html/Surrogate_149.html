<div class="container">

<table style="width: 100%;"><tr>
<td>sensitivity_analysis_SurvSurv_copula</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Sensitivity analysis for individual causal association</h2>

<h3>Description</h3>

<p>The <code>sensitivity_analysis_SurvSurv_copula()</code> function performs the
sensitivity analysis for the individual causal association (ICA) as described
by Stijven et al. (2024).
</p>


<h3>Usage</h3>

<pre><code class="language-R">sensitivity_analysis_SurvSurv_copula(
  fitted_model,
  composite = TRUE,
  n_sim,
  eq_cond_association = TRUE,
  lower = c(-1, -1, -1, -1),
  upper = c(1, 1, 1, 1),
  degrees = c(0, 90, 180, 270),
  marg_association = TRUE,
  copula_family2 = fitted_model$copula_family[1],
  n_prec = 5000,
  ncores = 1,
  sample_plots = NULL,
  mutinfo_estimator = NULL,
  restr_time = +Inf
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fitted_model</code></td>
<td>
<p>Returned value from <code>fit_model_SurvSurv()</code>. This object
contains the estimated identifiable part of the joint distribution for the
potential outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>composite</code></td>
<td>
<p>(boolean)  If <code>composite</code> is <code>TRUE</code>, then the surrogate
endpoint is a composite of both a "pure" surrogate endpoint and the true
endpoint, e.g., progression-free survival is the minimum of time-to-progression
and time-to-death.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_sim</code></td>
<td>
<p>Number of replications in the <em>sensitivity analysis</em>. This value
should be large enough to sufficiently explore all possible values of the
ICA. The minimally sufficient number depends to a large extent on which
inequality assumptions are subsequently imposed (see Additional
Assumptions).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eq_cond_association</code></td>
<td>
<p>Boolean.
</p>

<ul>
<li> <p><code>TRUE</code> (default): Assume that the association in <code class="reqn">(\tilde{S}_1, T_0)' | \tilde{S}_0</code>
and <code class="reqn">(\tilde{S}_0, T_1)' | \tilde{S}_1</code> are the same.
</p>
</li>
<li> <p><code>FALSE</code>: There is not specific a priori relationship between the
above two associations.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower</code></td>
<td>
<p>(numeric) Vector of length 4 that provides the lower limit,
<code class="reqn">\boldsymbol{a} = (a_{23}, a_{13;2}, a_{24;3},
  a_{14;23})'</code>. Defaults to <code>c(-1, -1, -1, -1)</code>. If the provided lower limit
is smaller than what is allowed for a particular copula family, then the
copula family's lowest possible value is used instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper</code></td>
<td>
<p>(numeric) Vector of length 4 that provides the upper limit,
<code class="reqn">\boldsymbol{b} = (b_{23}, b_{13;2}, b_{24;3},
  b_{14;23})'</code>. Defaults to <code>c(1, 1, 1, 1)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degrees</code></td>
<td>
<p>(numeric) vector with copula rotation degrees. Defaults to
<code>c(0, 90, 180, 270)</code>. This argument is not used for the Gaussian and Frank
copulas since they already allow for positive and negative associations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marg_association</code></td>
<td>
<p>Boolean.
</p>

<ul>
<li> <p><code>TRUE</code>: Return marginal association measures
in each replication in terms of Spearman's rho. The proportion of harmed,
protected, never diseased, and always diseased is also returned. See also
Value.
</p>
</li>
<li> <p><code>FALSE</code> (default): No additional measures are returned.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>copula_family2</code></td>
<td>
<p>Copula family of the other bivariate copulas. For the
possible options, see <code>loglik_copula_scale()</code>. The elements of
<code>copula_family2</code> correspond to <code class="reqn">(c_{23}, c_{13;2}, c_{24;3}, c_{14;23})</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_prec</code></td>
<td>
<p>Number of Monte-Carlo samples for the <em>numerical approximation</em>
of the ICA in each replication of the sensitivity analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>Number of cores used in the sensitivity analysis. The
computations are computationally heavy, and this option can speed things up
considerably.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_plots</code></td>
<td>
<p>Indices for replicates in the sensitivity analysis for
which the sampled individual treatment effects are plotted. Defaults to
<code>NULL</code>: no plots are displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mutinfo_estimator</code></td>
<td>
<p>Function that estimates the mutual information
between the first two arguments which are numeric vectors. Defaults to
<code>FNN::mutinfo()</code> with default arguments.
@param plot_deltas (logical) Plot the sampled individual treatment effects?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>restr_time</code></td>
<td>
<p>Restriction time for the potential outcomes. Defaults to
<code>+Inf</code> which means no restriction. Otherwise, the sampled potential outcomes
are replace by <code>pmin(S0, restr_time)</code> (and similarly for the other potential
outcomes).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A data frame is returned. Each row represents one replication in the
sensitivity analysis. The returned data frame always contains the following
columns:
</p>

<ul>
<li> <p><code>ICA</code>, <code>sp_rho</code>: ICA as quantified by <code class="reqn">R^2_h(\Delta S^*, \Delta T^*)</code> and
<code class="reqn">\rho_s(\Delta S, \Delta T)</code>.
</p>
</li>
<li> <p><code>c23</code>, <code>c13_2</code>, <code>c24_3</code>, <code>c14_23</code>: sampled copula parameters of the
unidentifiable copulas in the D-vine copula. The parameters correspond to
the parameterization of the <code>copula_family2</code> copula as in the <code>copula</code>
R-package.
</p>
</li>
<li> <p><code>r23</code>, <code>r13_2</code>, <code>r24_3</code>, <code>r14_23</code>: sampled rotation parameters of the
unidentifiable copulas in the D-vine copula. These values are constant for
the Gaussian copula family since that copula is invariant to rotations.
</p>
<p>The returned data frame also contains the following columns when
<code>get_marg_tau</code> is <code>TRUE</code>:
</p>
</li>
<li> <p><code>sp_s0s1</code>, <code>sp_s0t0</code>, <code>sp_s0t1</code>, <code>sp_s1t0</code>, <code>sp_s1t1</code>, <code>sp_t0t1</code>:
Spearman's <code class="reqn">\rho</code> between the corresponding potential outcomes. Note
that these associations refer to the potential time-to-composite events
and/or time-to-true endpoint event. In contrary, the estimated association
parameters from <code>fit_model_SurvSurv()</code> refer to associations between the
time-to-surrogate event and time-to true endpoint event. Also note that
<code>sp_s1t1</code> is constant whereas <code>sp_s0t0</code> is not. This is a particularity of
the MC procedure to calculate both measures and thus not a bug.
</p>
</li>
<li> <p><code>prop_harmed</code>, <code>prop_protected</code>, <code>prop_always</code>, <code>prop_never</code>: proportions
of the corresponding population strata in each replication. These are
defined in Nevo and Gorfine (2022).
</p>
</li>
</ul>
<h3>Information-Theoretic Causal Inference Framework</h3>

<p>The information-theoretic causal inference (ITCI) is a general framework to
evaluate surrogate endpoints in the single-trial setting (Alonso et al.,
2015). In this framework, we focus on the individual causal effects,
<code class="reqn">\Delta S = S_1 - S_0</code> and <code class="reqn">\Delta T = T_1 - T_0</code> where <code class="reqn">S_z</code>
and <code class="reqn">T_z</code> are the potential surrogate end true endpoint under treatment
<code class="reqn">Z = z</code>.
</p>
<p>In the ITCI framework, we say that <code class="reqn">S</code> is a good surrogate for <code class="reqn">T</code>
if
<em><code class="reqn">\Delta S</code> conveys a substantial amount of information on <code class="reqn">\Delta T</code></em>
(Alonso, 2018). This amount of shared information can generally be quantified
by the mutual information between <code class="reqn">\Delta S</code> and <code class="reqn">\Delta T</code>,
denoted by <code class="reqn">I(\Delta S; \Delta T)</code>. However, the mutual information lies
in <code class="reqn">[0, + \infty]</code> which complicates the interpretation. In addition,
the mutual information may not be defined in specific scenarios where
absolute continuity of certain probability measures fails. Therefore, the
mutual information is transformed, and possibly modified, to enable a simple
interpretation in light of the definition of surrogacy. The resulting measure
is termed the individual causal association (ICA). This is explained in
the next sections.
</p>
<p>While the definition of surrogacy in the ITCI framework rests on information
theory, shared information is closely related to statistical association. Hence,
we can also define the ICA in terms of statistical association measures, like
Spearman's rho and Kendall's tau. The advantage of the latter are that they
are well-known, simple and rank-based measures of association.
</p>


<h3>Surrogacy in The Survival-Survival Setting</h3>



<h4>General Introduction</h4>

<p>Stijven et al. (2024) proposed to quantify the ICA through the squared
informational coefficient of correlation (SICC or <code class="reqn">R^2_H</code>), which is a
transformation of the mutaul information to the unit interval: </p>
<p style="text-align: center;"><code class="reqn">R^2_H =
1 - e^{-2 \cdot I(\Delta S; \Delta T)}</code>
</p>
<p> where 0 indicates independence, and 1
a functional relationship between <code class="reqn">\Delta S</code> and <code class="reqn">\Delta T</code>. The ICA
(or a modified version, see next) is returned by
<code>sensitivity_analysis_SurvSurv_copula()</code>. Concurrently, the Spearman's
correlation between <code class="reqn">\Delta S</code> and <code class="reqn">\Delta T</code> is also returned.
</p>



<h4>Issues with Composite Endpoints</h4>

<p>In the survival-survival setting where the surrogate is a composite endpoint,
care should be taken when defining the mutual information. Indeed, when
<code class="reqn">S_z</code> is progression-free survival and <code class="reqn">T_z</code> is overall survival,
there is a probability atom in the joint distribution of <code class="reqn">(S_z, T_z)'</code>
because <code class="reqn">P(S_z = T_z) &gt; 0</code>. In other words, there are patient that die
before progressing. While this probability atom is correctly taken into
account in the models fitted by <code>fit_model_SurvSurv()</code>, this probability atom
reappears when considering the distribution of <code class="reqn">(\Delta S, \Delta T)'</code>
because <code class="reqn">P(\Delta S = \Delta T) &gt; 0</code> if we are considering PFS and OS.
</p>
<p>Because of the atom in the distribution of <code class="reqn">(\Delta S, \Delta T)'</code>, the
corresponding mutual information is not defined. To solve this, the mutual
information is computed excluding the patients for which <code class="reqn">\Delta S =
\Delta T</code> when <code>composite = TRUE</code>. The proportion of excluded patients is, among
other things, returned when <code>marginal_association = TRUE</code>. This is the proportion
of "never" patients following the classification of Nevo and Gorfine (2022).
See also Additional Assumptions.
</p>
<p>This modified version of the ICA quantifies the surrogacy of <code class="reqn">S</code> when
"adjusted for the composite nature of <code class="reqn">S</code>". Indeed, we exclude patients
where <code class="reqn">\Delta S</code> perfectly predicts <code class="reqn">\Delta T</code> *just because <code class="reqn">S</code>
is a composite of <code class="reqn">T</code> (and other variables).
</p>
<p>Other (rank-based) statistical measures of association, however,
remain well-defined and are thus computed without excluding any patients.
</p>



<h3>Sensitivity Analysis</h3>



<h4>Monte Carlo Approach</h4>

<p>Because <code class="reqn">S_0</code> and <code class="reqn">S_1</code> are never simultaneously observed in the same
patient, <code class="reqn">\Delta S</code> is not observable, and analogously for <code class="reqn">\Delta
T</code>. Consequently, the ICA is unidentifiable. This is solved by considering a
(partly identifiable) model for the full vector of potential outcomes,
<code class="reqn">(T_0, S_0, S_1, T_1)'</code>. The identifiable parameters are estimated. The
unidentifiable parameters are sampled from their parameters space in each
replication of a sensitivity analysis. If the number of replications
(<code>n_sim</code>) is sufficiently large, the entire parameter space for the
unidentifiable parameters will be explored/sampled. In each replication, all
model parameters are "known" (either estimated or sampled). Consequently, the
ICA can be computed in each replication of the sensitivity analysis.
</p>
<p>The sensitivity analysis thus results in a set of values for the ICA. This
set can be interpreted as <em>all values for the ICA that are compatible with
the observed data</em>. However, the range of this set is often quite broad; this
means there remains too much uncertainty to make judgements regarding the
worth of the surrogate. To address this unwieldy uncertainty, additional
assumptions can be used that restrict the parameter space of the
unidentifiable parameters. This in turn reduces the uncertainty regarding the
ICA.
</p>



<h4>Intervals of Ignorance and Uncertainty</h4>

<p>The results of the sensitivity analysis can be formalized (and summarized) in
intervals of ignorance and uncertainty using <code>sensitivity_intervals_Dvine()</code>.
</p>



<h3>Additional Assumptions</h3>

<p>There are two possible types of assumptions that restrict the parameter space
of the unidentifiable parameters: (i) <em>equality</em> type of assumptions, and
(ii) <em>inequality</em> type of assumptions. These are discussed in turn in the
next two paragraphs.
</p>
<p>The equality assumptions have to be incorporated into the sensitivity
analysis itself. Only one type of equality assumption has been implemented;
this is the conditional independence assumption:
</p>
<p style="text-align: center;"><code class="reqn">\tilde{S}_0 \perp T_1 | \tilde{S}_1 \; \text{and} \;
\tilde{S}_1 \perp T_0 | \tilde{S}_0 .</code>
</p>
<p> This can informally be
interpreted as “what the control treatment does to the surrogate does not
provide information on the true endpoint under experimental treatment if we
already know what the experimental treatment does to the surrogate", and
analogously when control and experimental treatment are interchanged. Note
that <code class="reqn">\tilde{S}_z</code> refers to either the actual potential surrogate
outcome, or a latent version. This depends on the content of <code>fitted_model</code>.
</p>
<p>The inequality type of assumptions have to be imposed on the data frame that
is returned by the current function; those assumptions are thus imposed
<em>after</em> running the sensitivity analysis. If <code>marginal_association</code> is set to
<code>TRUE</code>, the returned data frame contains additional unverifiable quantities
that differ across replications of the sensitivity analysis: (i) the
unconditional Spearman's <code class="reqn">\rho</code> for all pairs of (observable/non-latent)
potential outcomes, and (ii) the proportions of the population strata as
defined by Nevo and Gorfine (2022) if semi-competing risks are present. More
details on the interpretation and use of these assumptions can be found in
Stijven et al. (2024).
</p>


<h3>References</h3>

<p>Alonso, A. (2018). An information-theoretic approach for the evaluation of
surrogate endpoints. In Wiley StatsRef: Statistics Reference Online. John
Wiley &amp; Sons, Ltd.
</p>
<p>Alonso, A., Van der Elst, W., Molenberghs, G., Buyse, M., and Burzykowski, T.
(2015). On the relationship between the causal-inference and meta-analytic
paradigms for the validation of surrogate endpoints. Biometrics 71, 15–24.
</p>
<p>Stijven, F., Alonso, a., Molenberghs, G., Van Der Elst, W., Van Keilegom, I.
(2024). An information-theoretic approach to the evaluation of time-to-event
surrogates for time-to-event true endpoints based on causal inference.
</p>
<p>Nevo, D., &amp; Gorfine, M. (2022). Causal inference for semi-competing risks
data. Biostatistics, 23 (4), 1115-1132
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Load Ovarian data
data("Ovarian")
# Recode the Ovarian data in the semi-competing risks format.
data_scr = data.frame(
  ttp = Ovarian$Pfs,
  os = Ovarian$Surv,
  treat = Ovarian$Treat,
  ttp_ind = ifelse(
    Ovarian$Pfs == Ovarian$Surv &amp;
      Ovarian$SurvInd == 1,
    0,
    Ovarian$PfsInd
  ),
  os_ind = Ovarian$SurvInd
)
# Fit copula model.
fitted_model = fit_model_SurvSurv(data = data_scr,
                                  copula_family = "clayton",
                                  n_knots = 1)
# Illustration with small number of replications and low precision
sens_results = sensitivity_analysis_SurvSurv_copula(fitted_model,
                  n_sim = 5,
                  n_prec = 2000,
                  copula_family2 = "clayton",
                  eq_cond_association = TRUE)
# Compute intervals of ignorance and uncertainty. Again, the number of
# bootstrap replications should be larger in practice.
sensitivity_intervals_Dvine(fitted_model, sens_results, B = 10)

</code></pre>


</div>