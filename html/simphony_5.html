<div class="container">

<table style="width: 100%;"><tr>
<td>simphony</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate feature abundance data</h2>

<h3>Description</h3>

<p>Simulate experiments in which abundances of rhythmic and non-rhythmic
features are measured at multiple timepoints in one or more conditions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">simphony(
  featureGroupsList,
  fracFeatures = NULL,
  nFeatures = 10,
  timepointsType = c("auto", "specified", "random"),
  timeRange = c(0, 48),
  interval = 2,
  nReps = 1,
  timepoints = NULL,
  nSamplesPerCond = NULL,
  rhyFunc = sin,
  dispFunc = NULL,
  logOdds = FALSE,
  family = c("gaussian", "negbinom", "bernoulli", "poisson")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>featureGroupsList</code></td>
<td>
<p><code>data.frame</code> or <code>data.table</code> (for a single
condition) or list of <code>data.frame</code>s or <code>data.table</code>s (for multiple
conditions), where each row corresponds to a group of features to simulate.
The following columns are all optional:
</p>

<dl>
<dt>fracFeatures</dt>
<dd>
<p>Fraction of simulated features to allocate to each
group. Defaults to 1/(number of groups).</p>
</dd>
<dt>rhyFunc</dt>
<dd>
<p>Function to generate rhythmic abundance. Must have a
period of <code class="reqn">2\pi</code>. Defaults to <code>sin</code>.</p>
</dd>
<dt>amp</dt>
<dd>
<p>Amplitude of rhythm. Defaults to 0. Corresponds to
multiplicative term in front of <code>rhyFunc</code>. Can be numeric (constant
over time) or a function (time-dependent). See vignette for examples.</p>
</dd>
<dt>period</dt>
<dd>
<p>Period of rhythm. Defaults to 24.</p>
</dd>
<dt>phase</dt>
<dd>
<p>Phase of rhythm, in the same units as <code>period</code>. Defaults to
0. Corresponds to an additive term in <code>rhyFunc</code>.</p>
</dd>
<dt>base</dt>
<dd>
<p>Baseline abundance, i.e., abundance when <code>rhyFunc</code> term is 0.
Depending on <code>family</code>, defaults to 0 ('gaussian'), 8 ('negbinom',
mean log2 counts), 0 ('bernoulli' with <code>logOdds</code> as <code>TRUE</code>),
0.5 ('bernoulli' if <code>logOdds</code> as <code>FALSE</code>), or 1 ('poisson'). Can be
numeric (constant over time) or a function (time-dependent). See
vignette for examples.</p>
</dd>
<dt>sd</dt>
<dd>
<p>Standard deviation of sampled abundance values. Defaults to 1.
Only used if <code>family</code> is 'gaussian'.</p>
</dd>
<dt>dispFunc</dt>
<dd>
<p>Function to calculate dispersion of sampled abundance
values, given expected abundance in counts. Only used if <code>family</code> is
'negbinom'.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fracFeatures</code></td>
<td>
<p>Fraction of simulated features to allocate to each group.
Defaults to 1/(number of groups). Only used if the first
<code>featureGroupsList</code> <code>data.frame</code> lacks a <code>fracFeatures</code> column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nFeatures</code></td>
<td>
<p>Integer for the total number of features to simulate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timepointsType</code></td>
<td>
<p>Character string for how to set the timepoints
for the simulation. Must be 'auto' (default), 'specified', or 'random'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeRange</code></td>
<td>
<p>Numeric vector for the range of timepoints to use for the
simulation. Defaults to c(0, 48). Only used if <code>timepointsType</code> is 'auto'
or 'random'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interval</code></td>
<td>
<p>Number for the amount of time between consecutive
timepoints, in the same units as <code>period</code>. The first timepoint is 0. Only
used if <code>timepointsType</code> is 'auto'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nReps</code></td>
<td>
<p>Integer for the number of replicates per timepoint. Only used
if <code>timepointsType</code> is 'auto'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timepoints</code></td>
<td>
<p>Numeric vector of exact timepoints to simulate, including
any replicates. Only used if <code>timepointsType</code> is 'specified'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nSamplesPerCond</code></td>
<td>
<p>Integer for the number of samples per condition,
which will be randomly uniformly spaced between 0 and <code>period</code> and
different for each condition. Only used if timepointsType is 'random'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rhyFunc</code></td>
<td>
<p>Function to generate rhythmic abundance. Must have a period
of <code class="reqn">2\pi</code>. Defaults to <code>sin</code>. Only used if a <code>data.frame</code> in
<code>featureGroupsList</code> lacks a <code>rhyFunc</code> column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dispFunc</code></td>
<td>
<p>Function to calculate dispersion of sampled abundance
values, given expected abundance in counts. Defaults to <code>defaultDispFunc</code>.
Only used if <code>family</code> is 'negbinom' and a <code>data.frame</code> in
<code>featureGroupsList</code> lacks a <code>dispFunc</code> column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logOdds</code></td>
<td>
<p>Logical for whether the rhythmic function corresponds to
log-odds. Only used if <code>family</code> is 'bernoulli'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>Character string for the family of distributions from which to
sample the abundance values. <code>simphony</code> will give a warning if it tries to
sample from a distribution outside the region in which the distribution is
defined: <code class="reqn">\mu &lt; 0</code> for negative binomial and Poisson, and <code class="reqn">\mu &lt; 0</code>
or <code class="reqn">\mu &gt; 1</code> for Bernoulli.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>List with the following elements:
</p>

<dl>
<dt>abundData</dt>
<dd>
<p>Matrix of abundance values (counts, if <code>family</code> is
'negbinom'), with features as rownames and samples as colnames.</p>
</dd>
<dt>sampleMetadata</dt>
<dd>
<p><code>data.table</code> with one row per sample.</p>
</dd>
<dt>featureMetadata</dt>
<dd>
<p><code>data.table</code> with one row per feature per condition.
Columns <code>amp</code> and <code>base</code> are functions of time. Columns <code>amp0</code> and
<code>base0</code> are numeric and correspond to the amplitude and baseline
abundance at time 0, respectively.</p>
</dd>
<dt>experMetadata</dt>
<dd>
<p>List of arguments that were passed to <code>simphony</code>.</p>
</dd>
</dl>
<h3>See Also</h3>

<p><code>defaultDispFunc()</code>, <code>getExpectedAbund()</code>, <code>getSampledAbund()</code>,
<code>mergeSimData()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library('data.table')

# Simulate data for features having one of three sets of rhythmic parameters.
featureGroups = data.table(amp = c(0, 1, 1), phase = c(0, 0, 6),
                           rhyFunc = c(cos, cos, sin))
simData = simphony(featureGroups)

# Simulate data for an experiment with specified timepoints and replicates.
featureGroups = data.table(amp = c(0, 1))
simData = simphony(featureGroups, timepointsType = 'specified',
                   timepoints = c(0, 2, 2, 4, 12, 16, 21))

# Simulate data for an experiment with random timepoints between 0 and 24.
featureGroups = data.table(amp = c(0, 2))
simData = simphony(featureGroups, timepointsType = 'random',
                   timeRange = c(0, 24), nSamplesPerCond = 20)

# Simulate data with time-dependent rhythm amplitude or baseline abundance
featureGroups = data.table(amp = c(function(x) 1, function(x) 2^(-x / 24)),
                           base = c(function(x) x / 12, function(x) 0))
simData = simphony(featureGroups)

# Simulate data for features whose rhythmicity varies between two conditions.
featureGroupsList = list(
  data.table(amp = c(1, 2, 2), phase = c(0, -3, 0), period = c(24, 24, 22)),
  data.table(amp = c(3, 2, 2), phase = c(0, 3, 0), period = c(24, 24, 26)))
simData = simphony(featureGroupsList)

# Simulate data from a negative binomial distribution with a higher variance.
featureGroups = data.table(amp = 1, base = 6:8)
dispFunc = function(x) 3 * defaultDispFunc(x)
simData = simphony(featureGroups, family = 'negbinom', dispFunc = dispFunc)

# Simulate data at high temporal resolution from a Poisson distribution that
# alternates between two states.
featureGroups = data.table(amp = 1, base = 0,
                           rhyFunc = function(x) ifelse(x %% (2 * pi) &lt; pi, 0.5, 4))

simData = simphony(featureGroups, timeRange = c(0, 24 * 4), interval = 0.1,
                   nReps = 1, family = 'poisson')

# Simulate data for 100 features, half non-rhythmic and half rhythmic, with
# amplitudes for rhythmic features sampled from a log-normal distribution.
nFeatures = 100
rhyFrac = 0.5
nRhyFeatures = round(rhyFrac * nFeatures)
rhyAmps = exp(rnorm(nRhyFeatures, mean = 0, sd = 0.25))
fracFeatures = c(1 - rhyFrac, rep(rhyFrac / nRhyFeatures, nRhyFeatures))
featureGroups = data.table(amp = c(0, rhyAmps), fracFeatures = fracFeatures)
simData = simphony(featureGroups, nFeatures = nFeatures)

# Simulate data for 100 rhythmic features, with baseline log2 expected counts
# and residual log dispersion sampled from distributions whose parameters
# were estimated, using DESeq2 and fitdistrplus, from circadian RNA-seq data
# from mouse liver (PRJNA297287).
nFeatures = 100
baseLog2Counts = rnorm(nFeatures, mean = 8.63, sd = 2.73)
dispFactors = exp(rnorm(nFeatures, sd = 0.819))
dispFuncs = sapply(dispFactors, function(z) {function(x) defaultDispFunc(x) * z})
featureGroups = data.table(base = baseLog2Counts, dispFunc = dispFuncs, amp = 1)
simData = simphony(featureGroups, nFeatures = nFeatures, family = 'negbinom')

</code></pre>


</div>