<div class="container">

<table style="width: 100%;"><tr>
<td>Clustered_DotPlot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Clustered DotPlot</h2>

<h3>Description</h3>

<p>Clustered DotPlots using ComplexHeatmap
</p>


<h3>Usage</h3>

<pre><code class="language-R">Clustered_DotPlot(
  seurat_object,
  features,
  split.by = NULL,
  colors_use_exp = viridis_plasma_dark_high,
  exp_color_min = -2,
  exp_color_middle = NULL,
  exp_color_max = 2,
  exp_value_type = "scaled",
  print_exp_quantiles = FALSE,
  colors_use_idents = NULL,
  x_lab_rotate = TRUE,
  plot_padding = NULL,
  flip = FALSE,
  k = 1,
  feature_km_repeats = 1000,
  ident_km_repeats = 1000,
  row_label_size = 8,
  row_label_fontface = "plain",
  grid_color = NULL,
  cluster_feature = TRUE,
  cluster_ident = TRUE,
  column_label_size = 8,
  legend_label_size = 10,
  legend_title_size = 10,
  raster = FALSE,
  plot_km_elbow = TRUE,
  elbow_kmax = NULL,
  assay = NULL,
  group.by = NULL,
  idents = NULL,
  show_parent_dend_line = TRUE,
  ggplot_default_colors = FALSE,
  color_seed = 123,
  seed = 123
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>seurat_object</code></td>
<td>
<p>Seurat object name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>features</code></td>
<td>
<p>Features to plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split.by</code></td>
<td>
<p>Variable in <code style="white-space: pre;">⁠@meta.data⁠</code> to split the identities plotted by.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colors_use_exp</code></td>
<td>
<p>Color palette to use for plotting expression scale.  Default is <code>viridis::plasma(n = 20, direction = -1)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp_color_min</code></td>
<td>
<p>Minimum scaled average expression threshold (everything smaller will be set to this).
Default is -2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp_color_middle</code></td>
<td>
<p>What scaled expression value to use for the middle of the provided <code>colors_use_exp</code>.
By default will be set to value in middle of <code>exp_color_min</code> and <code>exp_color_max</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp_color_max</code></td>
<td>
<p>Minimum scaled average expression threshold (everything smaller will be set to this).
Default is 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp_value_type</code></td>
<td>
<p>Whether to plot average normalized expression or
scaled average normalized expression.  Only valid when <code>split.by</code> is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print_exp_quantiles</code></td>
<td>
<p>Whether to print the quantiles of expression data in addition to plots.
Default is FALSE.  NOTE: These values will be altered by choices of <code>exp_color_min</code> and <code>exp_color_min</code>
if there are values below or above those cutoffs, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colors_use_idents</code></td>
<td>
<p>specify color palette to used for identity labels.  By default if
number of levels plotted is less than or equal to 36 it will use "polychrome" and if greater than 36
will use "varibow" with shuffle = TRUE both from <code>DiscretePalette_scCustomize</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_lab_rotate</code></td>
<td>
<p>How to rotate column labels.  By default set to <code>TRUE</code> which rotates labels 45 degrees.
If set <code>FALSE</code> rotation is set to 0 degrees.  Users can also supply custom angle for text rotation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_padding</code></td>
<td>
<p>if plot needs extra white space padding so no plot or labels are cutoff.
The parameter accepts TRUE or numeric vector of length 4.  If TRUE padding will be set to
c(2, 10, 0 0) (bottom, left, top, right).  Can also be customized further with numeric
vector of length 4 specifying the amount of padding in millimeters.
Default is NULL, no padding.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flip</code></td>
<td>
<p>logical, whether to flip the axes of final plot.  Default is FALSE; rows = features and
columns = idents.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>Value to use for k-means clustering on features  Sets (km) parameter in <code>ComplexHeatmap::Heatmap()</code>.
From <code>ComplexHeatmap::Heatmap()</code>: Apply k-means clustering on rows. If the value is larger than 1, the
heatmap will be split by rows according to the k-means clustering. For each row slice, hierarchical
clustering is still applied with parameters above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature_km_repeats</code></td>
<td>
<p>Number of k-means runs to get a consensus k-means clustering for features.
Note if <code>feature_km_repeats</code> is set to value greater than one, the final number of groups might be
smaller than row_km, but this might mean the original row_km is not a good choice.  Default is 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ident_km_repeats</code></td>
<td>
<p>Number of k-means runs to get a consensus k-means clustering. Similar to
<code>feature_km_repeats</code>.  Default is 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>row_label_size</code></td>
<td>
<p>Size of the feature labels.  Provided to <code>row_names_gp</code> in Heatmap call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>row_label_fontface</code></td>
<td>
<p>Fontface to use for row labels.  Provided to <code>row_names_gp</code> in Heatmap call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid_color</code></td>
<td>
<p>color to use for heatmap grid.  Default is NULL which "removes" grid by using NA color.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster_feature</code></td>
<td>
<p>logical, whether to cluster and reorder feature axis.  Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster_ident</code></td>
<td>
<p>logical, whether to cluster and reorder identity axis.  Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>column_label_size</code></td>
<td>
<p>Size of the feature labels.  Provided to <code>column_names_gp</code> in Heatmap call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_label_size</code></td>
<td>
<p>Size of the legend text labels.  Provided to <code>labels_gp</code> in Heatmap legend call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_title_size</code></td>
<td>
<p>Sise of the legend title text labels.  Provided to <code>title_gp</code> in Heatmap legend call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raster</code></td>
<td>
<p>Logical, whether to render in raster format (faster plotting, smaller files).  Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_km_elbow</code></td>
<td>
<p>Logical, whether or not to return the Sum Squared Error Elbow Plot for k-means clustering.
Estimating elbow of this plot is one way to determine "optimal" value for <code>k</code>.
Based on: <a href="https://stackoverflow.com/a/15376462/15568251">https://stackoverflow.com/a/15376462/15568251</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>elbow_kmax</code></td>
<td>
<p>The maximum value of k to use for <code>plot_km_elbow</code>.  Suggest setting larger value so the
true shape of plot can be observed.  Value must be 1 less than number of features provided.  If NULL parameter
will be set dependent on length of feature list up to <code>elbow_kmax = 20</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assay</code></td>
<td>
<p>Name of assay to use, defaults to the active assay.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group.by</code></td>
<td>
<p>Group (color) cells in different ways (for example, orig.ident).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>idents</code></td>
<td>
<p>Which classes to include in the plot (default is all).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_parent_dend_line</code></td>
<td>
<p>Logical, Sets parameter of same name in <code>ComplexHeatmap::Heatmap()</code>.
From <code>ComplexHeatmap::Heatmap()</code>: When heatmap is split, whether to add a dashed line to mark parent
dendrogram and children dendrograms.  Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ggplot_default_colors</code></td>
<td>
<p>logical.  If <code>colors_use = NULL</code>, Whether or not to return plot using
default ggplot2 "hue" palette instead of default "polychrome" or "varibow" palettes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_seed</code></td>
<td>
<p>random seed for the "varibow" palette shuffle if <code>colors_use = NULL</code> and number of
groups plotted is greater than 36.  Default = 123.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Sets seed for reproducible plotting (ComplexHeatmap plot).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A ComplexHeatmap or if plot_km_elbow = TRUE a list containing ggplot2 object and ComplexHeatmap.
</p>


<h3>Author(s)</h3>

<p>Ming Tang (Original Code), Sam Marsh (Wrap single function, added/modified functionality)
</p>


<h3>References</h3>

<p><a href="https://divingintogeneticsandgenomics.rbind.io/post/clustered-dotplot-for-single-cell-rnaseq/">https://divingintogeneticsandgenomics.rbind.io/post/clustered-dotplot-for-single-cell-rnaseq/</a>
</p>


<h3>See Also</h3>

<p><a href="https://twitter.com/tangming2005">https://twitter.com/tangming2005</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(Seurat)
Clustered_DotPlot(seurat_object = pbmc_small, features = c("CD3E", "CD8", "GZMB", "MS4A1"))


</code></pre>


</div>