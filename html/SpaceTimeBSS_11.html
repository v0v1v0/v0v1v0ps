<div class="container">

<table style="width: 100%;"><tr>
<td>stkmat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Spatio-Temporal Kernel Matrices
</h2>

<h3>Description</h3>

<p>Computation of spatio-temporal kernel matrices for given kernel functions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">stkmat(coords, time, kernel_type, kernel_parameters, lags)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>

<p>a numeric matrix of dimension <code>c(n,2)</code> where each row represents the spatial coordinates of the corresponding observation over a 2D spatial domain.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>

<p>an integer vector of length <code>n</code> where each entry represents the temporal coordinate of the corresponding observation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel_type</code></td>
<td>

<p>either a string or a string vector of length <code>K</code> (or <code>1</code>) indicating which spatio-temporal kernel function to use. Implemented choices are <code>'ring'</code>, <code>'ball'</code> or <code>'gauss'</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel_parameters</code></td>
<td>

<p>a numeric vector of length <code>K</code> (or <code>1</code>) for the <code>'ball'</code> and <code>'gauss'</code> kernel function or a list of length <code>K</code> (or <code>1</code>) for the <code>'ring'</code> kernel, see details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lags</code></td>
<td>

<p>an integer vector of length <code>K</code> (or <code>1</code>) that provides the temporal lags for the spatio-temporal kernel functions, see details.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The following kernel functions are implemented and chosen with the argument <code>kernel_type</code>:
</p>

<ul>
<li> <p><code>'ring'</code>: the spatial parameters are inner radius <code class="reqn">r_i</code> and outer radius <code class="reqn">r_o</code>, with <code class="reqn">r_i &lt; r_o</code>, and <code class="reqn">r_i, r_o \ge 0</code>, the temporal parameter is the temporal lag <code class="reqn">u</code>: </p>
<p style="text-align: center;"><code class="reqn">f(d_s,d_t) = I(r_i &lt; d_s \le r_o)I(d_t = u)</code>
</p>

</li>
<li> <p><code>'ball'</code>: the spatial parameter is the radius <code class="reqn">r</code>, with <code class="reqn">r \ge 0</code>, the temporal parameter is the temporal lag <code class="reqn">u</code>: </p>
<p style="text-align: center;"><code class="reqn">f(d_s,d_t) = I(d_s \le r)I(d_t = u)</code>
</p>

</li>
<li> <p><code>'gauss'</code>: Gaussian function where 95% of the mass is inside the spatial parameter <code class="reqn">r</code>, with <code class="reqn">r \ge 0</code>, the temporal parameter is the temporal lag <code class="reqn">u</code>: </p>
<p style="text-align: center;"><code class="reqn">f(d_s,d_t) = exp(-0.5 (\Phi^{-1}(0.95) d_s/r)^2)I(d_t = u)</code>
</p>

</li>
</ul>
<p>Above, <code class="reqn">I()</code> represents the indicator function. The argument <code>kernel_type</code> determines the used kernel function as presented above, the argument <code>lags</code> provides the used temporal lags for the kernel functions (<code class="reqn">u</code> in the above formulas) and the argument <code>kernel_parameters</code> gives the spatial parameters for the kernel function. Each of the arguments <code>kernel_type</code>, <code>lags</code> and <code>kernel_parameters</code> can be of length <code>K</code> or <code>1</code>. Specifically, <code>kernel_type</code> can be either one kernel, then each local autocovariance matrix use the same kernel type, or of length <code>K</code> which leads to different kernel functions for the provided kernel parameters. <code>lags</code> can be either one integer, then for each kernel the same temporal lag is used, or an integer vector of length  <code>K</code> which leads to different temporal lags. In the same fashion <code>kernel_parameters</code> is a vector of length <code>K</code> or <code>1</code>. If <code>kernel_type</code> equals <code>'ball'</code> or <code>'gauss'</code> then the corresponding entry of <code>kernel_parameters</code> gives the single spatial radius parameter. In contrast, if (at least one entry of) <code>kernel_type</code> equals <code>'ring'</code>, then <code>kernel_parameters</code> must be a list of length <code>K</code> (or <code>1</code>) where each entry is a numeric vector of length <code>2</code> defining the inner and outer spatial radius. See examples below.
</p>
<p>The output of this function can be used with the function <code>stbss</code> to avoid unnecessary computation of kernel matrices when <code>stbss</code> is called multiple times with the same coordinate/kernel function setting. Additionally, the output can be used with the function <code>lacov</code>.
</p>


<h3>Value</h3>

<p><code>stkmat</code> returns a list of length <code>K</code> containing numeric matrices of dimension <code>c(n,n)</code> corresponding to the spatio-temporal kernel matrices.
</p>


<h3>References</h3>

<p><cite>Muehlmann, C., De Iaco, S. and Nordhausen, K. (2023), Blind Recovery of Sources for Multivariate Space-Time Environmental Data. <em>Stochastic and Environmental Research and Risk Assessment</em>,  <b>37</b>, 1593â€“1613, &lt;doi:10.1007/s00477-022-02348-2&gt;.</cite>
</p>


<h3>See Also</h3>

<p><code>stbss</code>, <code>lacov</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# space and time coordinates
n_t &lt;- 50
n_sp &lt;- 10
coords &lt;- runif(n_sp ^ 2 * 2) * n_sp
dim(coords) &lt;- c(n_sp ^ 2, 2)
time &lt;- 1:n_t

st_coords &lt;- as.matrix(expand.grid(1:nrow(coords), 1:length(time)))
st_coords &lt;- cbind(coords[st_coords[, 1], ], time[st_coords[, 2]])

# different ring kernels and same lags
stkmat_r &lt;- stkmat(coords = st_coords[, 1:2], time = st_coords[, 3], 
                   kernel_type = 'ring', 
                   kernel_parameters = list(c(0, 1), c(1, 2)), lags = c(1, 1))

# same ball kernels and different lags
stkmat_b &lt;- stkmat(coords = st_coords[, 1:2], time = st_coords[, 3], 
                   kernel_type = 'ball', kernel_parameters = 1:3, lags = c(1, 2, 3))

# different gauss kernels and different lags
stkmat_g &lt;- stkmat(coords = st_coords[, 1:2], time = st_coords[, 3], 
                   kernel_type = 'gauss', kernel_parameters = 1:3, lags = 1:3)

# mixed kernels
stkmat_m &lt;- stkmat(coords = st_coords[, 1:2], time = st_coords[, 3], 
                   kernel_type = c('ball', 'ring', 'gauss'), 
                   kernel_parameters = list(1, c(1:2), 3), lags = 1:3)
</code></pre>


</div>