<div class="container">

<table style="width: 100%;"><tr>
<td>new_rscript</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>General purpose function to write R scripts</h2>

<h3>Description</h3>

<p>This function will create an object of class <code>slurmR_rscript</code> that can be used
to write the R component in a batch job.
</p>


<h3>Usage</h3>

<pre><code class="language-R">new_rscript(
  njobs,
  tmp_path,
  job_name,
  pkgs = list_loaded_pkgs(),
  libPaths = .libPaths()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>njobs</code></td>
<td>
<p>Integer. Number of jobs to use in the job-array. This specifies
the number of R sessions to initialize. This does not specify the number of
cores to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tmp_path</code></td>
<td>
<p>Character. Path to the directory where all the data (including
scripts) will be stored. Notice that this path must be accessible by all the
nodes in the network (See opts_slurmR).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>job_name</code></td>
<td>
<p>Character. Name of the job to be passed to <code>Slurm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pkgs</code></td>
<td>
<p>A named list with packages to be included. Each element of the list
must be a path to the R library, while the names of the list are the names of
the R packages to be loaded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>libPaths</code></td>
<td>
<p>A character vector. See .libPaths.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An environment of class <code>slurmR_rscript</code>. This has the following accessible
components:
</p>

<ul>
<li> <p><code>add_rds</code> Add rds files to be loaded in each job.", <code>x</code> is a named list
with the objects that should be loaded in the jobs. If <code>index = TRUE</code> the
function assumes that the user will be accessing a particular subset of <code>x</code>
during the job, which is accessed according to <code>INDICES[[ARRAY_ID]]</code>. The
option <code>compress</code> is passed to saveRDS.
</p>
<p>One important side effect is that when this function is called, the object
will be saved in the current job directory, this is <code>opts_slurmR$get_tmp_path()</code>.
</p>
</li>
<li> <p><code>append</code> Adds a line to the R script. Its only argument, <code>x</code> is a character
vector that will be added to the R script.
</p>
</li>
<li> <p><code>rscript</code> A character vector. This is the actual R script that will be written
at the end.
</p>
</li>
<li> <p><code>finalize</code> Adds the final line of the R script. This function receives a
character scalar <code>x</code> which is used as the name of the object to be saved.
If missing, the function will save a NULL object. The <code>compress</code> argument
is passed to saveRDS.
</p>
</li>
<li> <p><code>set_seed</code> Adds a vector of seeds to be used across the jobs. This vector
of seeds should be of length <code>njobs</code>. The other two parameters of the
function are passed to set.seed. By default the seed is picked as follows:
</p>
<div class="sourceCode"><pre>seeds &lt;- sample.int(.Machine$integer.max, njobs, replace = FALSE)
</pre></div>
</li>
<li> <p><code>write</code> Finalizes the process by writing the R script in the corresponding
folder to be used with Slurm.
</p>
</li>
</ul>
</div>