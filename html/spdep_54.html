<div class="container">

<table style="width: 100%;"><tr>
<td>EBlocal</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Local Empirical Bayes estimator</h2>

<h3>Description</h3>

<p>The function computes local empirical Bayes estimates for rates "shrunk" to a neighbourhood mean for neighbourhoods given by the <code>nb</code> neighbourhood list.
</p>


<h3>Usage</h3>

<pre><code class="language-R">EBlocal(ri, ni, nb, zero.policy = NULL, spChk = NULL, geoda=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ri</code></td>
<td>
<p>a numeric vector of counts of cases the same length as the neighbours list in nb; if there are many zero counts, some estimates may be affected by division by zero, see <a href="https://stat.ethz.ch/pipermail/r-sig-geo/2022-January/028882.html">https://stat.ethz.ch/pipermail/r-sig-geo/2022-January/028882.html</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ni</code></td>
<td>
<p>a numeric vector of populations at risk the same length as the neighbours list in nb</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nb</code></td>
<td>
<p>a <code>nb</code> object of neighbour relationships</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zero.policy</code></td>
<td>
<p>default NULL, use global option value; if TRUE assign zero to the lagged value of zones without neighbours, if FALSE assign NA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spChk</code></td>
<td>
<p>should the data vector names be checked against the spatial objects for identity integrity, TRUE, or FALSE, default NULL to use <code>get.spChkOption()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>geoda</code></td>
<td>
<p>default=FALSE, following Marshall's algorithm as interpreted by Bailey and Gatrell, pp. 305-307, and exercise 8.2, pp. 328-330 for the definition of phi; TRUE for the definition of phi used in GeoDa (see discussion on OpenSpace mailing list June 2003: http://agec221.agecon.uiuc.edu/pipermail/openspace/2003-June/thread.html)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Details of the implementation are to be found in Marshall, p. 286, and Bailey and Gatrell p. 307 and exercise 8.2, pp. 328–330. The example results do not fully correspond to the sources because of slightly differing neighbourhoods, but are generally close. If there are many zero counts, some estimates may be affected by division by zero, see <a href="https://stat.ethz.ch/pipermail/r-sig-geo/2022-January/028882.html">https://stat.ethz.ch/pipermail/r-sig-geo/2022-January/028882.html</a>.
</p>


<h3>Value</h3>

<p>A data frame with two columns:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>raw</code></td>
<td>
<p>a numerical vector of raw (crude) rates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est</code></td>
<td>
<p>a numerical vector of local empirical Bayes estimates</p>
</td>
</tr>
</table>
<p>and a <code>parameters</code> attribute list with components (if both are zero, the estimate will be <code>NaN</code>, <a href="https://stat.ethz.ch/pipermail/r-sig-geo/2022-January/028882.html">https://stat.ethz.ch/pipermail/r-sig-geo/2022-January/028882.html</a>):
</p>
<table>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>a numerical vector of local phi values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>a numerical vector of local gamma values</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Roger Bivand <a href="mailto:Roger.Bivand@nhh.no">Roger.Bivand@nhh.no</a>, based on contributions by Marilia Carvalho</p>


<h3>References</h3>

<p>Marshall R M (1991) Mapping disease and mortality rates using Empirical Bayes Estimators, Applied Statistics, 40, 283–294; Bailey T, Gatrell A (1995) Interactive Spatial Data Analysis, Harlow: Longman, pp. 303–306.</p>


<h3>See Also</h3>

<p><code>EBest</code>, <code>probmap</code></p>


<h3>Examples</h3>

<pre><code class="language-R">auckland &lt;- st_read(system.file("shapes/auckland.gpkg", package="spData")[1], quiet=TRUE)
auckland.nb &lt;- poly2nb(auckland)
res &lt;- EBlocal(auckland$M77_85,  9*auckland$Und5_81, auckland.nb)
auckland$est000 &lt;- res$est*1000
plot(auckland[,"est000"], breaks=c(0,2,2.5,3,3.5,8),
 main="Infant mortality per 1000 per year")
</code></pre>


</div>