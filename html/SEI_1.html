<div class="container">

<table style="width: 100%;"><tr>
<td>aggregate_xts</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Aggregate values in xts objects</h2>

<h3>Description</h3>

<p>Inputs an xts time series and outputs an xts time series whose
values have been aggregated over a moving window of a user-specified length.
</p>


<h3>Usage</h3>

<pre><code class="language-R">aggregate_xts(
  x,
  agg_period = 1,
  agg_scale = c("days", "mins", "hours", "weeks", "months", "years"),
  agg_fun = "sum",
  timescale = c("days", "mins", "hours", "weeks", "months", "years"),
  na_thres = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>xts object to be aggregated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>agg_period</code></td>
<td>
<p>length of the aggregation period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>agg_scale</code></td>
<td>
<p>timescale of <code>agg_period</code>;
one of <code>'mins'</code>, <code>'hours'</code>, <code>'days'</code>, <code>'weeks'</code>, <code>'months'</code>, <code>'years'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>agg_fun</code></td>
<td>
<p>string specifying the function used to aggregate the data over the
aggregation period, default is <code>'sum'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timescale</code></td>
<td>
<p>timescale of the data; one of <code>'mins'</code>, <code>'hours'</code>, <code>'days'</code>, <code>'weeks'</code>, <code>'months'</code>, <code>'years'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_thres</code></td>
<td>
<p>threshold for the percentage of NA values allowed in the
aggregation period; default is 10%.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This has been adapted from code available at
<a href="https://github.com/WillemMaetens/standaRdized">https://github.com/WillemMaetens/standaRdized</a>.
</p>
<p>Given a vector <code class="reqn">x_{1}, x_{2}, \dots</code>, the function <code>aggregate_xts</code> calculates
aggregated values <code class="reqn">\tilde{x}_{1}, \tilde{x}_{2}, \dots</code> as
</p>
<p style="text-align: center;"><code class="reqn">\tilde{x}_{t} = f(x_{t}, x_{t-1}, \dots, x_{t - k + 1}),</code>
</p>

<p>for each time point <code class="reqn">t = k, k + 1, \dots</code>, where <code class="reqn">k</code> (<code>agg_period</code>) is the number
of time units (<code>agg_scale</code>) over which to aggregate the time series (<code>x</code>),
and <code class="reqn">f</code> (<code>agg_fun</code>) is the function used to perform the aggregation.
The first <code class="reqn">k - 1</code> values of the aggregated time series are returned as <code>NA</code>.
</p>
<p>By default, <code>agg_fun = "sum"</code>, meaning the aggregation results in accumulations over the
aggregation period:
</p>
<p style="text-align: center;"><code class="reqn">\tilde{x}_{t} = \sum_{k=1}^{K} x_{t - k + 1}.</code>
</p>

<p>Alternative functions can also be used. For example, specifying
<code>agg_fun = "mean"</code> returns the mean over the aggregation period,
</p>
<p style="text-align: center;"><code class="reqn">\tilde{x}_{t} = \frac{1}{K} \sum_{k=1}^{K} x_{t - k + 1},</code>
</p>

<p>while <code>agg_fun = "max"</code> returns the maximum over the aggregation period,
</p>
<p style="text-align: center;"><code class="reqn">\tilde{x}_{t} = \text{max}(\{x_{t}, x_{t-1}, \dots, x_{t - k + 1}\}).</code>
</p>

<p><code>agg_period</code> is a single numeric value specifying over how many time units the
data <code>x</code> is to be aggregated. By default, <code>agg_period</code> is assumed to correspond
to a number of days, but this can also be specified manually using the argument
<code>agg_scale</code>. <code>timescale</code> is the timescale of the input data <code>x</code>.
By default, this is also assumed to be "days".
</p>
<p>Since the time series <code>x</code> aggregates data over the aggregation period, problems
may arise when <code>x</code> contains missing values. For example, if interest is
on daily accumulations, but 50% of the values in the aggregation period are missing,
the accumulation over this aggregation period will not be accurate.
This can be controlled using the argument <code>na_thres</code>.
<code>na_thres</code> specifies the percentage of <code>NA</code> values in the aggregation period
before a <code>NA</code> value is returned. i.e. the proportion of values that are allowed
to be missing. The default is <code>na_thres = 10</code>.
</p>


<h3>Value</h3>

<p>An xts time series with aggregated values.
</p>


<h3>Author(s)</h3>

<p>Sam Allen, Noelia Otero
</p>


<h3>Examples</h3>

<pre><code class="language-R">

data(data_supply, package = "SEI")

# consider hourly German energy production data in 2019
supply_de &lt;- subset(data_supply, country == "Germany", select = c("date", "PWS"))
supply_de &lt;- xts::xts(supply_de$PWS, order.by = supply_de$date)

# daily accumulations
supply_de_daily &lt;- aggregate_xts(supply_de, timescale = "hours")

# weekly means
supply_de_weekly &lt;- aggregate_xts(supply_de, agg_scale = "weeks",
                                  agg_fun = "mean", timescale = "hours")

plot(supply_de, main = "Hourly energy production")
plot(supply_de_daily, main = "Daily accumulated energy production")
plot(supply_de_weekly, main = "Weekly averaged energy production")



</code></pre>


</div>