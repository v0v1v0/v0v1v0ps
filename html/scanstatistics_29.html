<div class="container">

<table style="width: 100%;"><tr>
<td>scan_bayes_negbin</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate the negative binomial bayesian scan statistic..</h2>

<h3>Description</h3>

<p>Calculate the "Bayesian Spatial Scan Statistic" by Neill et al. (2006),
adapted to a spatio-temporal setting. The scan statistic assumes that,
given the relative risk, the data follows a Poisson distribution. The 
relative risk is in turn assigned a Gamma distribution prior, yielding a 
negative binomial marginal distribution for the counts under the null 
hypothesis. Under the alternative hypothesis, the
</p>


<h3>Usage</h3>

<pre><code class="language-R">scan_bayes_negbin(
  counts,
  zones,
  baselines = NULL,
  population = NULL,
  outbreak_prob = 0.05,
  alpha_null = 1,
  beta_null = 1,
  alpha_alt = alpha_null,
  beta_alt = beta_null,
  inc_values = seq(1, 3, by = 0.1),
  inc_probs = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>counts</code></td>
<td>
<p>Either:
</p>

<ul>
<li>
<p> A matrix of observed counts. Rows indicate time and are ordered
from least recent (row 1) to most recent (row 
<code>nrow(counts)</code>). Columns indicate locations, numbered from 1 
and up. If <code>counts</code> is a matrix, the optional matrix argument
<code>baselines</code> should also be specified.
</p>
</li>
<li>
<p> A data frame with columns "time", "location", "count", "baseline".
Alternatively, the column "baseline" can be replaced by a column
"population". The baselines are the expected values of the counts.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zones</code></td>
<td>
<p>A list of integer vectors. Each vector corresponds to a single
zone; its elements are the numbers of the locations in that zone.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baselines</code></td>
<td>
<p>Optional. A matrix of the same dimensions as <code>counts</code>. 
Not needed if <code>counts</code> is a data frame. Holds the Poisson mean 
parameter for each observed count. Will be estimated if not supplied 
(requires the <code>population</code> argument). These parameters are typically 
estimated from past data using e.g. Poisson (GLM) regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>population</code></td>
<td>
<p>Optional. A matrix or vector of populations for each 
location. Not needed if <code>counts</code> is a data frame. If <code>counts</code> is
a matrix, <code>population</code> is only needed if <code>baselines</code> are to be 
estimated and you want to account for the different populations in each 
location (and time). If a matrix, should be of the same dimensions as 
<code>counts</code>. If a vector, should be of the same length as the number of 
columns in <code>counts</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outbreak_prob</code></td>
<td>
<p>A scalar; the probability of an outbreak (at any time,
any place). Defaults to 0.05.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_null</code></td>
<td>
<p>A scalar; the shape parameter for the gamma distribution
under the null hypothesis of no anomaly. Defaults to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta_null</code></td>
<td>
<p>A scalar; the scale parameter for the gamma distribution
under the null hypothesis of no anomaly. Defaults to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_alt</code></td>
<td>
<p>A scalar; the shape parameter for the gamma distribution
under the alternative hypothesis of an anomaly. Defaults to the same value
as <code>alpha_null</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta_alt</code></td>
<td>
<p>A scalar; the scale parameter for the gamma distribution
under the alternative hypothesis of an anomaly. Defaults to the same value
as <code>beta_null</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inc_values</code></td>
<td>
<p>A vector of possible values for the increase in the mean
(and variance) of an anomalous count. Defaults to evenly spaced values 
between 1 and 3, with a difference of 0.1 between consecutive values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inc_probs</code></td>
<td>
<p>A vector of the prior probabilities of each value in 
<code>inc_values</code>. Defaults to 1, implying a discrete uniform 
distribution.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list which, in addition to the information about the type of scan
statistic, has the following components: <code>priors</code> (list), 
<code>posteriors</code> (list), <code>MLC</code> (list) and <code>marginal_data_prob</code> 
(scalar). The list <code>MLC</code> has elements
</p>

<dl>
<dt>zone</dt>
<dd>
<p>The number of the spatial zone of the most likely cluster 
(MLC).</p>
</dd>
<dt>duration</dt>
<dd>
<p>The most likely event duration.</p>
</dd>
<dt>log_posterior</dt>
<dd>
<p>The posterior log probability that an event is 
ongoing in the MLC.</p>
</dd>
<dt>log_bayes_factor</dt>
<dd>
<p>The logarithm of the Bayes factor for the MLC.</p>
</dd>
<dt>posterior</dt>
<dd>
<p>The posterior probability that an event is ongoing in 
the MLC.</p>
</dd>
<dt>locations</dt>
<dd>
<p>The locations involved in the MLC.</p>
</dd>
</dl>
<p>The list <code>priors</code> has elements
</p>

<dl>
<dt>null_prior</dt>
<dd>
<p>The prior probability of no anomaly.</p>
</dd>
<dt>alt_prior</dt>
<dd>
<p>The prior probability of an anomaly.</p>
</dd>
<dt>inc_prior</dt>
<dd>
<p>A vectorof prior probabilities of each value in the 
argument <code>inc_values</code>.</p>
</dd>
<dt>window_prior</dt>
<dd>
<p>The prior probability of an outbreak in any of the
space-time windows.</p>
</dd>
</dl>
<p>The list <code>posteriors</code> has elements
</p>

<dl>
<dt>null_posterior</dt>
<dd>
<p>The posterior probability of no anomaly.</p>
</dd>
<dt>alt_posterior</dt>
<dd>
<p>The posterior probability of an anomaly.</p>
</dd>
<dt>inc_posterior</dt>
<dd>
<p>A data frame with columns <code>inc_values</code> and
<code>inc_posterior</code>.</p>
</dd>
<dt>window_posteriors</dt>
<dd>
<p>A data frame with columns <code>zone</code>, 
<code>duration</code>, <code>log_posterior</code> and 
<code>log_bayes_factor</code>, each row corresponding
to a space-time window.</p>
</dd>
<dt>space_time_posteriors</dt>
<dd>
<p>A matrix with the posterior anomaly 
probability of each location-time 
combination.</p>
</dd>
<dt>location_posteriors</dt>
<dd>
<p>A vector with the posterior probability of an
anomaly at each location.</p>
</dd>
</dl>
<h3>References</h3>

<p>Neill, D. B., Moore, A. W., Cooper, G. F. (2006). 
<em>A Bayesian Spatial Scan Statistic</em>. Advances in Neural Information 
Processing Systems 18.
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1)
# Create location coordinates, calculate nearest neighbors, and create zones
n_locs &lt;- 50
max_duration &lt;- 5
n_total &lt;- n_locs * max_duration
geo &lt;- matrix(rnorm(n_locs * 2), n_locs, 2)
knn_mat &lt;- coords_to_knn(geo, 15)
zones &lt;- knn_zones(knn_mat)

# Simulate data
baselines &lt;- matrix(rexp(n_total, 1/5), max_duration, n_locs)
counts &lt;- matrix(rpois(n_total, as.vector(baselines)), max_duration, n_locs)

# Inject outbreak/event/anomaly
ob_dur &lt;- 3
ob_cols &lt;- zones[[10]]
ob_rows &lt;- max_duration + 1 - seq_len(ob_dur)
counts[ob_rows, ob_cols] &lt;- matrix(
  rpois(ob_dur * length(ob_cols), 2 * baselines[ob_rows, ob_cols]), 
  length(ob_rows), length(ob_cols))
res &lt;- scan_bayes_negbin(counts = counts,
                         zones = zones,
                         baselines = baselines)
</code></pre>


</div>