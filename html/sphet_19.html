<div class="container">

<table style="width: 100%;"><tr>
<td>kpjtest</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Kelejian and Piras J-test</h2>

<h3>Description</h3>

<p>The function calculate the Kelejian and Piras J-test for spatial models.
Both models (under the null and under the alternative) 
can be specified with additional endogenous variables, and additional instruments. 
The model under the null allows for heteroskedasticity as well as spatial autocorrelation:
</p>
<p style="text-align: center;"><code class="reqn">y=\lambda W y + X \beta + u  </code>
</p>

<p style="text-align: center;"><code class="reqn">u=Re</code>
</p>
<p>  with </p>
<p style="text-align: center;"><code class="reqn">e ~ N(0,\sigma^2_i) </code>
</p>

<p>Note that when R reduces to an identity matrix, the error term, while still heteroskedastic, is not spatially autocorrelated. 
On the other hand, when the <code class="reqn">\sigma^2_i</code> are all the same (and R is an identity matrix) than the error term is neither heteroskedastic nor autocorrelated.
</p>


<h3>Usage</h3>

<pre><code class="language-R">kpjtest(H0model, H1model, data = list(), listw0 = NULL, listw1 = NULL, 
         endogH0 = NULL, endogH1 = NULL, instrumentsH0 = NULL, instrumentsH1 = NULL, 
         lag.instr = FALSE, model = "lag", het = FALSE, HAC = F, 
         distance = NULL, type = "Epanechnikov",
         bandwidth = "variable",  na.action = na.fail)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>H0model</code></td>
<td>
<p>Formula object for the specification of the model under the null</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>H1model</code></td>
<td>
<p>Formula object for the specification of the model under the alternative</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an object of class data.frame. An optional data frame containing the variables
in the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>listw0</code></td>
<td>
<p>an object of class <code>listw</code>, <code>matrix</code>, or <code>Matrix</code>. The spatial weighting matrix under the null model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>listw1</code></td>
<td>
<p>an object of class <code>listw</code>, <code>matrix</code>, or <code>Matrix</code>. The spatial weighting matrix under the alternative model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>endogH0</code></td>
<td>
<p>additional endogenous variables under the null model. Default <code>NULL</code>. If not <code>NULL</code> should be specified as a formula with no dependent variable (endog = ~ x1 + x2). Note the ~ before the expression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>endogH1</code></td>
<td>
<p>additional endogenous variables under the alternative model. Default <code>NULL</code>. If not <code>NULL</code> should be specified as a formula with no dependent variable (endog = ~ x1 + x2). Note the ~ before the expression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>instrumentsH0</code></td>
<td>
<p>external instruments for the null model. Default <code>NULL</code>. If not <code>NULL</code> should be specified 
as a formula with no dependent variable (instruments = ~ x1 + x2). Note the ~ before the expression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>instrumentsH1</code></td>
<td>
<p>external instruments for the alternative model. Default <code>NULL</code>. If not <code>NULL</code> should be specified 
as a formula with no dependent variable (instruments = ~ x1 + x2). Note the ~ before the expression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lag.instr</code></td>
<td>
<p>should the external instruments be spatially lagged?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>one of <code>lag</code>, or <code>sarar</code>. The current version of the function only implements the lag model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>het</code></td>
<td>
<p>default FALSE: if TRUE uses the methods developed for heteroskedasticity</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>HAC</code></td>
<td>
<p>perform the HAC estimator of Kelejian and Prucha, 2007 on the null (and augmented) model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distance</code></td>
<td>
<p>an object of class <code>distance</code> created for example by read.gwt2dist 
The object contains the specification of the distance measure 
to be employed in the estimation of the VC matrix. See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>One of <code>c("Epanechnikov","Triangular","Bisquare","Parzen", "QS","TH","Rectangular")</code>. 
The type of Kernel to be used. See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bandwidth</code></td>
<td>
<p>"variable" (default) - or numeric when a fixed bandwidth is specified by the user.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>a function which indicates what should happen when the data contains missing values. See lm for details</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In order to calculate the J-test, the function follows a few steps:
</p>

<ul>
<li>
<p> The alternative model is estimated by S2SLS. 
</p>
</li>
<li>
<p> Based on the estimated parameters in the previous step,  obtain a prediction based on the alternative models of the dependent vector in the null model. The predictor is based on the right hand side of the model. 
</p>
</li>
<li>
<p> Use these predicted values of the dependent variable based on the alternative models into the null model to obtain the augmented model. 
</p>
</li>
<li>
<p> Estimate the augmented model by 2SLS using all of the instruments relating to the null model as well as all of the instruments relating to the alternative models. 
</p>
</li>
<li>
<p> Test for the statistical significance of the predicted value. If it is not significant, accept the null model. If it is  significant, reject the null and conclude that the true model is the alternative models. 
</p>
</li>
</ul>
<p>The output is an object of class <code>sphet</code> where the last row of the table of coefficients is the prediction. 
</p>
<p>When the model is heteroskedastic as well as spatially autocorrelated, an HAC procedure is employed. 
The default sets the bandwith for each observation to the maximum distance for that observation (i.e.
the max of each element of the list of distances). 
</p>
<p>Six different kernel functions are implemented:
</p>

<ul>
<li> <p><code>'Epanechnikov'</code>: <code class="reqn">K(z) = 1-z^2</code>
</p>
</li>
<li> <p><code>'Triangular'</code>: <code class="reqn">K(z) = 1-z</code> 
</p>
</li>
<li> <p><code>'Bisquare'</code>: <code class="reqn">K(z) = (1-z^2)^2</code>
</p>
</li>
<li> <p><code>'Parzen'</code>: <code class="reqn">K(z) = 1-6z^2+6 |z|^3</code> if  <code class="reqn">z \leq 0.5</code> and  
<code class="reqn"> K(z) = 2(1-|z|)^3</code> if <code class="reqn">0.5 &lt; z \leq 1</code> 
</p>
</li>
<li> <p><code>'TH'</code> (Tukey - Hanning):  <code class="reqn"> K(z) = \frac{1+ \cos(\pi z)}{2}</code>
</p>
</li>
<li> <p><code>'Rectangular'</code>:  <code class="reqn"> K(z) = 1</code>
</p>
</li>
<li> <p><code>'QS'</code> (Quadratic Spectral): <code class="reqn">K(z) = \frac{25}{12\pi^2z^2} 
     (\frac{\sin(6\pi z)/5)}{6\pi z/5} - \cos(6\pi z)/5)</code>). 
</p>
</li>
</ul>
<p>If the kernel type is not one of the six implemented, the function will terminate with an error message. 
The spatial two stage least square estimator is based on the matrix of instruments <code class="reqn">H=[X,WX,W^2X^2]</code>.
</p>


<h3>Value</h3>

<p>A list object of class <code>sphet</code>
</p>
<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>Generalized Spatial two stage least squares coefficient estimates of <code class="reqn">\delta</code> and GM estimator for <code class="reqn">\rho</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>variance-covariance matrix of the estimated coefficients</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s2</code></td>
<td>
<p>GS2SLS residuals variance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>GS2SLS residuals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yhat</code></td>
<td>
<p>difference between GS2SLS residuals and response variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the call used to create this object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>the model matrix of data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p><code>'s2slshac'</code></p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>References</h3>

<p>Kelejian and Piras (2017). <em>Spatial Econometrics</em>. Academic Press. ISBN: 978-0-12-813387-3 
</p>
<p>Gianfranco Piras (2010). sphet: Spatial Models with Heteroskedastic Innovations in R. <em>Journal of Statistical Software</em>, 35(1), 1-21. <a href="https://www.jstatsoft.org/v35/i01/">https://www.jstatsoft.org/v35/i01/</a>.
</p>
<p>Roger Bivand, Gianfranco Piras (2015). Comparing Implementations of Estimation Methods for Spatial Econometrics. <em>Journal of Statistical Software</em>, 63(18), 1-36. <a href="https://www.jstatsoft.org/v63/i18/">https://www.jstatsoft.org/v63/i18/</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"> library(spdep)
 library(sphet)
 data(boston)
 boslw &lt;- nb2listw(boston.soi)
 
 Bos.Knn &lt;- knearneigh(boston.utm, k = 5)
 bos.nb &lt;- knn2nb(Bos.Knn)
 boslw2 &lt;- nb2listw(bos.nb)
 
 fm &lt;- log(MEDV) ~ CRIM + ZN + INDUS + CHAS
 fm2 &lt;- log(MEDV) ~ CRIM + ZN + INDUS + RM + AGE 
 
 test &lt;- kpjtest(fm, fm2, data = boston.c, 
 listw0 = boslw, listw1 = boslw2, model = "lag")
 
</code></pre>


</div>