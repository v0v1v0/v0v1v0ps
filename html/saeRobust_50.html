<div class="container">

<table style="width: 100%;"><tr>
<td>rfh</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Robust Fay Herriot Model</h2>

<h3>Description</h3>

<p>User interface to fit robust Fay-Herriot type models. These models are here
framed as linear mixed models. The parameter estimation is robust against
outliers. Available models are the standard FH model, a spatial extension, a
temporal extension and a spatio-temporal extension.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rfh(formula, data, samplingVar, correlation = NULL, ...)

## S4 method for signature 'formula,data.frame,character,ANY'
rfh(formula, data,
  samplingVar, correlation, ...)

## S3 method for class 'fitrfh'
predict(object, type = "reblup", c = 1, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>(formula) a formula specifying the fixed effects part of the
model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>(data.frame) a data set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samplingVar</code></td>
<td>
<p>(character) the name of the variable in <code>data</code>
containing the sampling variances.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correlation</code></td>
<td>
<p>an optional correlation structure, e.g. corSAR1,
for the random effects part of the model. Default is no correlation, i.e. a
random intercept.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments passed fitGenericModel</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>(rfh) an object of class rfh</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>(character) one or more in <code>c("linear", "reblup", "reblupbc")</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>c</code></td>
<td>
<p>(numeric) scalar; a multiplyer constant used in the bias correction.
Default is to make no correction for realisations of direct estimator
within <code>c = 1</code> times the standard deviation of direct estimator.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To trigger the spatial and temporal extensions you can supply an argument
<code>correlation</code>. When <code>corSAR1</code> is used the model of Petrucci and
Salvati (2006); for <code>corAR1</code> the model of Rao and Yu (1994) is used; and
for <code>corSAR1AR1</code> the model of Marhuenda et al. (2013).
</p>
<p>The methods introducing the robust framework underpinning this implementation
can be found in Warnholz (2016). They are based on the results by Sinha and
Rao (2009) and Richardson and Welsh (1995).
</p>


<h3>Value</h3>

<p>A list with the following elements:
</p>

<ul>
<li> <p><code>call</code> (language) the call generating the value
</p>
</li>
<li> <p><code>formula</code> (formula) the formula passed as argument
</p>
</li>
<li> <p><code>samplingVar</code> (numeric) the vector of sampling variances
</p>
</li>
<li> <p><code>coefficients</code> (numeric) the vector of regression coefficients
</p>
</li>
<li> <p><code>variance</code> (numeric) the vector of fitted variance parameter(s)
</p>
</li>
<li> <p><code>iterations</code> (list) reporting each step in the optimisation
</p>
</li>
<li> <p><code>tol</code> (numeric) the tolerance level used
</p>
</li>
<li> <p><code>maxIter</code> (numeric) maximum overall allowed iterations
</p>
</li>
<li> <p><code>maxIterParam</code> (numeric) maximum allowed iterations for model
parameters in each overall iteration
</p>
</li>
<li> <p><code>maxIterRe</code> (numeric) maximum allowed iterations for fitting the
random effects
</p>
</li>
<li> <p><code>k</code> (numeric) tuning constant in influence function
</p>
</li>
<li> <p><code>K</code> (numeric) additional tuning constant; often derived from
<code>k</code> to scale down the residual variance
</p>
</li>
<li> <p><code>y</code> (numeric) the response vector
</p>
</li>
<li> <p><code>x</code> (Matrix) the design matrix
</p>
</li>
<li> <p><code>re</code> (numeric) the fitted random effects. Can be c(re1, re2)
</p>
</li>
<li> <p><code>reblup</code> (numeric) the robust best linear unbiased prediction
under the fitted model
</p>
</li>
<li> <p><code>residuals</code> (numeric) the realised sampling errors
</p>
</li>
<li> <p><code>fitted</code> (numeric) the fitted values using only the fixed effects
part
</p>
</li>
</ul>
<h3>References</h3>

<p>Marhuenda, Y., I. Molina and D. Morales (2013). "Small area estimation with
spatio-temporal Fay-Herriot models". In: Computational Statistics and Data
Analysis 58, pp. 308–325.
</p>
<p>Pratesi, M. and N. Salvati (2008). "Small area estimation: the EBLUP
estimator based on spatially correlated random area effects". In: Statistical
Methods &amp; Applications 17, pp. 113–141.
</p>
<p>Rao, J. N. K. and M. Yu (1994). "Small-Area Estimation by Combining
Time-Series and Cross-Sectional Data". In: Canadian Journal of Statistics
22.4, pp. 511–528.
</p>
<p>Richardson, A. M. and A. H. Welsh (1995). "Robust Restricted Maximum
Likelihood in Mixed Linear Models". In: Biometrics 51 (4), pp. 1429–1439.
</p>
<p>Sinha, S. K. and J. N. K. Rao (2009). "Robust Small Area Estimation". In: The
Canadian Journal of Statistics 37 (3), pp. 381–399.
</p>
<p>Warnholz, S. (2016): "Small Area Estimaiton Using Robust Extension to Area
Level Models". Dissertation. https://refubium.fu-berlin.de/handle/fub188/9706.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Non-temporal models:
data("grapes", package = "sae")
data("grapesprox", package = "sae")

fitRFH &lt;- rfh(
  grapehect ~ area + workdays - 1,
  data = grapes,
  samplingVar = "var"
)

fitRFH
summary(fitRFH)

plot(fitRFH)
plot(predict(fitRFH))
plot(mse(fitRFH))

## Not run: 
# And the same including a spatial structure:
fitRSFH &lt;- rfh(
  grapehect ~ area + workdays - 1,
  data = grapes,
  samplingVar = "var",
  corSAR1(as.matrix(grapesprox))
)

# Use the same methods, e.g. plot, for all these implementations:
data("spacetime", package = "sae")
data("spacetimeprox", package = "sae")
nTime &lt;- length(unique(spacetime$Time))

fitRTFH &lt;- rfh(
  Y ~ X1 + X2,
  spacetime,
  "Var",
  corAR1(nTime = nTime)
)

fitRSTFH &lt;- rfh(
  Y ~ X1 + X2,
  spacetime,
  "Var",
  corSAR1AR1(W = as.matrix(spacetimeprox), nTime = nTime)
)

## End(Not run)
</code></pre>


</div>