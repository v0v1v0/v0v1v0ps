<div class="container">

<table style="width: 100%;"><tr>
<td>depthfilter</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Filter locations by water depth</h2>

<h3>Description</h3>

<p>Function to filter locations according to bathymetry and tide.
</p>


<h3>Usage</h3>

<pre><code class="language-R">depthfilter(
  sdata,
  bathymetry,
  bilinear = TRUE,
  qi = 4,
  tide,
  tidal.plane,
  type = "HT",
  height = 0,
  filter = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sdata</code></td>
<td>
<p>A data frame containing columns with the following headers: "id", "DateTime", "lat", "lon", "qi". 
See the data <code>turtle</code> for an example.
The function filters the input data by a unique "id" (e.g. transmitter number, identifier for each animal). 
"DateTime" is the GMT date &amp; time of each location in class <code>POSIXct</code> or <code>character</code> with the following format "2012-06-03 01:33:46".
"lat" and "lon" are the latitude and longitude of each location in decimal degrees. 
"qi" is the quality index associated with each location fix. 
The input values can be either the number of GPS satellites or Argos Location Classes. 
Argos Location Classes will be converted to numerical values, where "A", "B", "Z" will be replaced with "-1", "-2", "-3" respectively.
The greater number indicates a higher accuracy.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bathymetry</code></td>
<td>
<p>A stars object containing bathymetric data in metres. 
Negative and positive values indicate below and above the water respectively. 
Geographic coordinate system is WGS84.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bilinear</code></td>
<td>
<p>Logical. This defines a method for how to extract cell values from the <em>bathymetry</em> layer.
Options are bilinear (TRUE) or nearest neighbour (False) as inherited from <code>st_extract</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qi</code></td>
<td>
<p>An integer specifying a threshold of quality index. 
<em>depthfilter</em> does not filter a location that is associated with a quality index higher than this threshold. 
Default is 4.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tide</code></td>
<td>
<p>A data frame containing columns with the following headers: "tideDT", "reading", "standard.port". 
"tideDT" is date &amp; time in class <code>POSIXct</code> at each observation. "reading" is the observed tidal height in metres. 
"standard.port" is the identifier of each tidal station.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tidal.plane</code></td>
<td>
<p>A data frame containing columns with the following headers: 
"standard.port", "secondary.port", "lat", "lon", "timeDiff", "datumDiff". 
"standard.port" is the identifier for a tidal observation station. 
"secondary.port" is the identifier for a station at which tide is only predicted using tidal records observed at the related standard port. 
"lat" and "lon" are the latitude and longitude of each secondary port in decimal degrees. 
"timeDiff" is the time difference between standard port and its associated secondary port. 
"datumDiff" is the baseline difference in metres if bathymetry and tidal observations/predictions 
uses different datum (e.g. LAT and MSL).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>The type of water depth considered in the filtering process.
"exp" is for the water depth experienced by the animal at the time.
This option may be applicable to species that remain in water at all times (e.g. dugongs, dolphins, etc).
"HT" is for the water depth at the nearest high tide (default). 
This option is useful for animals that use inter-tidal zones at high tide and may remain there even after the tide drops (e.g. some sea turtles).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>height</code></td>
<td>
<p>A numerical value to adjust the water depth an animal is likely to use. Default is 0 m. 
This parameter is useful if the minimum water depth used by the animal is known. 
For example, a dugong is unlikely to use water shallower than its body height (e.g. ~0.5 m)
so it may be sensible to consider the fix is an error if the estimated water depth is shallower than its body height.
A negative value indicates below the water surface. 
For the dugong example, to remove locations for which the water depth was &lt;0.5 m, 
it should be specified as; height = -0.5.
By supplying the body height to this argument, all the locations recorded shallower than its body will be removed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter</code></td>
<td>
<p>Default is TRUE. 
If FALSE, the function does not filter locations but it still returns estimates of the water depth experienced by the animal at each location.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function examines each location according to the water depth experienced by the animal or the water depth at the nearest high tide. 
The function looks for the closest match between each fix and tidal observations or predictions in temporal and spatial scales. 
When <em>filter</em> is disabled, the function does not filter locations but returns the estimated water depth of each location with 
the tide effect considered (bathymetry + tide).
</p>


<h3>Value</h3>

<p>When <em>filter</em> option is enabled, this function filters the input data and returns with two additional columns; "depth.exp", "depth.HT". 
"depth.exp" is the estimated water depth at each location at the time of location fixing. 
"depth.HT" is the estimated water depth at the nearest high tide at each location.
</p>


<h3>Note</h3>

<p>The input data must not contain temporal or spatial duplicates.
</p>


<h3>Author(s)</h3>

<p>Takahiro Shimada
</p>


<h3>References</h3>

<p>Shimada T, Limpus C, Jones R, Hazel J, Groom R, Hamann M (2016) 
Sea turtles return home after intentional displacement from coastal foraging areas. 
<em>Marine Biology</em> 163:1-14 <a href="https://doi.org/10.1007/s00227-015-2771-0">doi:10.1007/s00227-015-2771-0</a>
</p>
<p>Beaman, R.J. (2010) Project 3DGBR: A high-resolution depth model for the Great Barrier Reef and Coral Sea. 
<em>Marine and Tropical Sciences Research Facility (MTSRF) Project 2.5i.1a Final Report</em>, MTSRF, Cairns, Australia, pp. 13 plus Appendix 1.
</p>


<h3>See Also</h3>

<p><code>dupfilter</code>, <code>ddfilter</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

#### Load data sets
## Fastloc GPS data obtained from a green turtle
data(turtle)

## Bathymetry model developed by Beaman (2010)
data(bathymodel)

## A tidal plane for the example site
data(tidalplane)

## Tidal observations and predictions for the example site
data(tidedata)

## Maps for the example site
data(SandyStrait)


#### Remove temporal and/or spatial duplicates and biologically unrealistic fixes 
turtle.dd &lt;- ddfilter(dupfilter(turtle))


#### Apply depthfilter
turtle &lt;- depthfilter(sdata = turtle.dd, bathymetry = bathymodel, 
tide = tidedata, tidal.plane = tidalplane)


#### Plot data removed or retained by depthfilter
to_map(turtle.dd, bgmap = SandyStrait, point.bg = "red", point.size = 2, line.size = 0.5, 
        axes.lab.size = 0, title.size = 0, multiplot = FALSE)[[1]] + 
geom_point(aes(x = lon, y = lat), data = turtle, size = 2, fill = "yellow", shape = 21)+
geom_point(aes(x = x, y = y), data = data.frame(x = c(152.68, 152.68), y = c(-25.3, -25.34)), 
           size = 3, fill = c("yellow", "red"), shape = 21) + 
annotate("text", x = c(152.7, 152.7), y = c(-25.3, -25.34), label = c("Retained", "Removed"), 
         colour = "black", size = 4, hjust = 0)

## End(Not run)          
</code></pre>


</div>