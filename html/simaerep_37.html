<div class="container">

<table style="width: 100%;"><tr>
<td>sim_studies</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate studies.</h2>

<h3>Description</h3>

<p>Test function, test applicability of poisson test, by
calculating a the bootstrapped probability of obtaining a specific p-value
or lower, use in combination with <code>get_ecd_values()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim_studies(
  df_visit,
  df_site,
  r = 100,
  poisson_test = TRUE,
  prob_lower = TRUE,
  r_prob_lower = 1000,
  under_only = TRUE,
  parallel = FALSE,
  keep_ae = FALSE,
  min_n_pat_with_med75 = 1,
  studies = NULL,
  .progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df_visit</code></td>
<td>
<p>dataframe</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df_site</code></td>
<td>
<p>dataframe</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>integer, denotes number of simulations, Default: 1000</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>poisson_test</code></td>
<td>
<p>logical, calculates poisson.test pvalue, Default: TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob_lower</code></td>
<td>
<p>logical, calculates probability for getting a lower value,
Default: FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_prob_lower</code></td>
<td>
<p>integer, denotes number of simulations for prob_lower
value calculation,, Default: 1000</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>under_only</code></td>
<td>
<p>compute under-reporting probabilities only, default = TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>logical, see examples for registering parallel processing framework
, Default: FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep_ae</code></td>
<td>
<p>logical, keep ae numbers in output dataframe memory increase
roughly 30 percent, Default: F</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_n_pat_with_med75</code></td>
<td>
<p>integer, min number of patients with med75 at
site to simulate, Default: 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>studies</code></td>
<td>
<p>vector with study names, Default: NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.progress</code></td>
<td>
<p>logical, show progress bar</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Here we simulate study replicates maintaining the same number of
sites, patients and visit_med75 by bootstrap resampling, then probabilities
for obtaining lower or same mean_ae count and p-values using poisson.test
are calculated.
</p>
<p>adds column with simulated probabilities for equal or lower
mean_ae at visit_med75
</p>


<h3>Value</h3>

<p>dataframe
</p>


<h3>Examples</h3>

<pre><code class="language-R">
df_visit1 &lt;- sim_test_data_study(n_pat = 100, n_sites = 5,
                                      frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit1$study_id &lt;- "A"

df_visit2 &lt;- sim_test_data_study(n_pat = 1000, n_sites = 3,
                                      frac_site_with_ur = 0.2, ur_rate = 0.1)

df_visit2$study_id &lt;- "B"

df_visit &lt;- dplyr::bind_rows(df_visit1, df_visit2)

df_site &lt;- site_aggr(df_visit)

sim_studies(df_visit, df_site, r = 3, keep_ae = TRUE)

## Not run: 
# parallel processing -------------------------
library(future)
future::plan(multiprocess)
sim_studies(df_visit, df_site, r = 3, keep_ae = TRUE, parallel = TRUE)
future::plan(sequential)

## End(Not run)
</code></pre>


</div>