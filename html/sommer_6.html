<div class="container">

<table style="width: 100%;"><tr>
<td>AI</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Average Information Algorithm</h2>

<h3>Description</h3>

<p>Univariate version of the average information (AI) algorithm.
</p>


<h3>Usage</h3>

<pre><code class="language-R">AI(X=NULL,Z=NULL, Zind=NULL, Ai=NULL,y=NULL,S=NULL, H=NULL,
    nIters=80, tolParConvLL=1e-4, tolParConvNorm=.05, tolParInv=1e-6, theta=NULL, 
    thetaC=NULL, thetaF=NULL, addScaleParam=NULL,
    weightInfEMv=NULL, weightInfMat=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>an incidence matrix for fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>Z is a list of lists each element contains the Z matrices required for the covariance structure specified for a random effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Zind</code></td>
<td>
<p>vector specifying to which random effect each Z matrix belongs to. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ai</code></td>
<td>
<p>is a list with the inverses of the relationship matrix for each random effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>is the response variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>is the list of residual matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>H</code></td>
<td>
<p>is the matrix of weights. This will be squared via the cholesky decomposition and apply to the residual matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nIters</code></td>
<td>
<p>number of REML iterations .</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolParConvLL</code></td>
<td>
<p>rule for stoping the optimization problem, difference in log-likelihood between the current and past iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolParConvNorm</code></td>
<td>
<p>rule for stoping the optimization problem, difference in norms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolParInv</code></td>
<td>
<p>value to add to the diagonals of a matrix that cannot be inverted because is not positive-definite.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p> is the initial values for the vc (matrices should be symmetric).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thetaC</code></td>
<td>
<p> is the constraints for vc: 1 positive, 2 unconstrained, 3 fixed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thetaF</code></td>
<td>
<p> is the dataframe indicating the fixed constraints as x times another vc, rows indicate the variance components, columns the scale parameters (other VC plus additional ones preferred).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addScaleParam</code></td>
<td>
<p> any additional scale parameter to be included when applying constraints in thetaF.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weightInfEMv</code></td>
<td>
<p> is the vector to be put in a diagonal matrix (a list with as many matrices as iterations) representing the weight assigned to the EM information matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weightInfMat</code></td>
<td>
<p> is a vector of weights to the information matrix for the operation delta = I- * dLu/dLx # unstructured models may require less weight to the information matrix.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This algorithm is based on Jensen, Madsen and Thompson (1997) 
</p>


<h3>Value</h3>

<p>If all parameters are correctly indicated the program will return a list with the following information:
</p>

<dl>
<dt>res</dt>
<dd>
<p> a list of different outputs</p>
</dd>
</dl>
<h3>References</h3>

<p>Jensen, J., Mantysaari, E. A., Madsen, P., and Thompson, R. (1997). Residual maximum likelihood estimation of (co) variance components in multivariate mixed linear models using average information. Journal of the Indian Society of Agricultural Statistics, 49, 215-236.
</p>
<p>Covarrubias-Pazaran G. Genome assisted prediction of quantitative traits using the R package sommer. PLoS ONE 2016, 11(6): doi:10.1371/journal.pone.0156744   
</p>


<h3>See Also</h3>

<p>The core functions of the package <code>mmer</code> </p>


<h3>Examples</h3>

<pre><code class="language-R">####=========================================####
#### For CRAN time limitations most lines in the 
#### examples are silenced with one '#' mark, 
#### remove them and run the examples
####=========================================####

data("DT_example")
DT &lt;- DT_example
K &lt;- A_example
#### look at the data and fit the model
head(DT)

zz &lt;- with(DT, vsr(dsr(Env),Name))

Z &lt;- c(list(model.matrix(~Name-1, data=DT)),zz$Z)

Zind &lt;- c(1,2,2,2)

A &lt;- list(diag(41), diag(41))#rep(list(diag(41)),4)

Ai &lt;- lapply(A, function(x){solve(x)})

theta &lt;- list(
  matrix(10,1,1),
  diag(10,3,3),
  diag(10,3,3)
);theta

thetaC &lt;- list(
  matrix(1,1,1),
  diag(1,3,3),
  diag(1,3,3)
);thetaC

X &lt;- model.matrix(~Env, data=DT)

y &lt;- as.matrix(DT$Yield)

DTx &lt;- DT; DTx$units &lt;- as.factor(1:nrow(DTx))
ss &lt;- with(DTx, vsr(dsr(Env),units) )

S &lt;- ss$Z 

H &lt;- diag(length(y))

addScaleParam &lt;- 0
nn &lt;- unlist(lapply(thetaC, function(x){length(which(x &gt; 0))}))
nn2 &lt;- sum(nn[1:max(Zind)])
ff &lt;- diag(nn2)
thetaF &lt;- cbind(ff,matrix(0,nn2,1))

## apply the function
weightInfMat=rep(1,40); # weights for the information matrix
weightInfEMv=c(seq(.9,.1,-.1),rep(0,36)); # weights for the EM information matrix

# expr = res3&lt;-AI(X=X,Z=Z, Zind=Zind,
#                 Ai=Ai,y=y,
#                 S=S,
#                 H=H, 
#                 nIters=20, tolParConvLL=1e-5,
#                 tolParConvNorm=0.05,
#                 tolParInv=1e-6,theta=theta,
#                 thetaC=thetaC,thetaF=thetaF,
#                 addScaleParam=addScaleParam, weightInfEMv = weightInfEMv,
#                 weightInfMat = weightInfMat
#                 
# )
# # compare results
# res3$monitor


</code></pre>


</div>