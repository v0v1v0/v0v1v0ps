<div class="container">

<table style="width: 100%;"><tr>
<td>Set_DB</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Build up a comprehensive database regarding the school system</h2>

<h3>Description</h3>

<p>This function generates a unique dataframe of the school system data including a customary choice of available datasets. This function allows the user to aggregate the desired datasets, when available, among these:
</p>

<ul>
<li>
<p> Invalsi census survey
</p>
</li>
<li>
<p> School buildings
</p>
</li>
<li>
<p> Number of students and school classes
</p>
</li>
<li>
<p> Number of teachers
</p>
</li>
<li>
<p> Broadband connection availability
</p>
</li>
</ul>
<p>To save as much time as possible it is possible to plug in ready-made input data; otherwise they will be downloaded automatically but not saved in the global environment
When a new dataset is joined to the existing ones, it is possible that some observations in this datasets are missing. In this case, by default, the choice of keeping as much observational units as possible, or to remove units with missing variables is left to the user.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Set_DB(
  Year = 2023,
  level = "LAU",
  conservative = TRUE,
  Invalsi = TRUE,
  SchoolBuildings = TRUE,
  nstud = TRUE,
  nteachers = TRUE,
  BroadBand = TRUE,
  verbose = TRUE,
  show_col_types = FALSE,
  Invalsi_subj = c("ELI", "ERE", "ITA", "MAT"),
  Invalsi_grade = c(2, 5, 8, 10, 13),
  Invalsi_WLE = FALSE,
  SchoolBuildings_certifications = FALSE,
  SchoolBuildings_include_numerics = TRUE,
  SchoolBuildings_include_qualitatives = FALSE,
  SchoolBuildings_row_cutout = FALSE,
  SchoolBuildings_col_cut_thresh = 20000,
  SchoolBuildings_flag_outliers = TRUE,
  SchoolBuildings_count_missing = FALSE,
  nstud_imputation_thresh = 19,
  nstud_missing_to_1 = FALSE,
  UB_nstud_byclass = 99,
  LB_nstud_byclass = 1,
  InnerAreas = TRUE,
  ord_InnerAreas = FALSE,
  nstud_check = TRUE,
  nstud_check_registry = "Any",
  BroadBand_impute_missing = TRUE,
  Date = as.Date(paste0(substr(year.patternA(Year), 1, 4), "-09-01")),
  NA_autoRM = NULL,
  input_Invalsi_IS = NULL,
  input_Registry = NULL,
  input_SchoolBuildings = NULL,
  input_nstud = NULL,
  input_School2mun = NULL,
  input_AdmUnNames = NULL,
  input_InnerAreas = NULL,
  input_teachers4student = NULL,
  input_nteachers = NULL,
  input_BroadBand = NULL,
  autoAbort = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Year</code></td>
<td>
<p>Numeric or Character. The relevant school year. Available in the formats: <code>2023</code>, <code>"2022/2023"</code>, <code>202223</code>, <code>20222023</code>.
Important: if input datasets are plugged in, please select the same <code>Year</code> argument used to download the input data. <code>2023</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>Character. The administrative level of detail at which data must be aggregated.
Either <code>"LAU"</code>/<code>"Municipality"/"NUTS-4"</code> or <code>"NUTS-3"</code>/<code>"Province"</code>. <code>"LAU"</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conservative</code></td>
<td>
<p>Logical. If <code>FALSE</code>, only the schools included in all the datasets are taken as input. <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Invalsi</code></td>
<td>
<p>Logical. Whether the Invalsi census data must be included (see <code>Get_Invalsi_IS</code>. <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SchoolBuildings</code></td>
<td>
<p>Logical. Whether the school buildings dataset must be included (see <code>link{Get_DB_MIUR}</code>, <code>Util_DB_MIUR_num</code>. <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nstud</code></td>
<td>
<p>Logical. Whether the students number per class must be included (see <code>Get_nstud</code>. <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nteachers</code></td>
<td>
<p>Logical. Whether the number of teachers by province must be included (see <code>link{Get_nteachers_prov}</code>). <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BroadBand</code></td>
<td>
<p>Logical. Whether the broadband availability in schools must be included (see <code>Get_BroadBand</code>). <code>TRUE</code> by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the user keeps track of the main underlying operations. <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_col_types</code></td>
<td>
<p>Logical. If <code>TRUE</code>, if the <code>verbose</code> argument is also <code>TRUE</code>, the columns of the raw dataset are shown during the download. <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Invalsi_subj</code></td>
<td>
<p>Character. If <code>Invalsi == TRUE</code>, the school subject(s) to include, among <code>"Englis_listening"</code>/<code>"ELI"</code>, <code>"English_reading"</code>/<code>"ERE"</code>, <code>"Italian"</code>/<code>"Ita"</code> and <code>"Mathematics"</code>/<code>"MAT"</code>. All four by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Invalsi_grade</code></td>
<td>
<p>Numeric. If <code>Invalsi == TRUE</code>, the educational grade to choose. Either <code>2</code> (2nd year of primary school), <code>5</code> (last year of primary school), <code>8</code> (last year of middle shcool), <code>10</code> (2nd year of high school) or <code>13</code> (last year of school). All by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Invalsi_WLE</code></td>
<td>
<p>Logical. Whether to express Invalsi scores as averagev WLE score rather that the percentage of sufficient tests, if both are Invalsi_grade is either or <code>2</code> <code>5</code>. <code>FALSE</code> by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SchoolBuildings_certifications</code></td>
<td>
<p>Logical. If the school buldings database has to be downloaded, whether to include safety certifications.  Only relevant from schol year 2020/21 onwards (see <code>Get_DB_MIUR</code>). <code>FALSE</code> by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SchoolBuildings_include_numerics</code></td>
<td>
<p>Logical. Whether to include strictly numeric variables alongside with Boolean ones in the school buildings database (see <code>Util_DB_MIUR_num</code>). <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SchoolBuildings_include_qualitatives</code></td>
<td>
<p>Logical. Whether to include qualitative variables alongside with Boolean ones in the school buildings database (see <code>Util_DB_MIUR_num</code>). <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SchoolBuildings_row_cutout</code></td>
<td>
<p>Logical. Whether to filter out rows including missing fields in the school buildings database (see <code>Util_DB_MIUR_num</code>). <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SchoolBuildings_col_cut_thresh</code></td>
<td>
<p>Numeric. The threshold of missing values allowed for each variable in the school buildings database (see <code>Util_DB_MIUR_num</code>).
If a variable as a higher number of missing observations, then it is cut out. <code>20.000</code> by default.
Warning: if the option <code>SchoolBuildings_row_cutout</code> is active, please select a lower threshold (e.g. <code>1000</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SchoolBuildings_flag_outliers</code></td>
<td>
<p>Logical. Whether to assign NA to outliers in numeric variables; see <code>Util_DB_MIUR_num</code> for more details. <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SchoolBuildings_count_missing</code></td>
<td>
<p>Logical. Whether the function should return the percentage of NAs in the input school buildings database (see also <code>Group_DB_MIUR</code>). <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nstud_imputation_thresh</code></td>
<td>
<p>Numeric. If <code>nstud_missing_to_1 == TRUE</code>, the minimum threshold below which the number of classes is imputed to 1 if missing;
see also <code>Util_nstud_wide</code>. <code>19</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nstud_missing_to_1</code></td>
<td>
<p>Numeric. If <code>nstud == TRUE</code>, whether the number of classes should be imputed to 1 when it is missing and the number of students is below a threshold (argument <code>nstud_imputation_thresh</code>, see <code>Util_nstud_wide</code>). <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>UB_nstud_byclass</code></td>
<td>
<p>Numeric. The upper limit of the acceptable school-level average of the number of students by class if <code>nstud == TRUE</code>; see also <code>Util_nstud_wide</code>.  <code>99</code> by default, i.e. no restriction is made. Please notice that boundaries are included in the acceptance interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LB_nstud_byclass</code></td>
<td>
<p>Numeric. The lower limit of the acceptable school-level average of the number of students by class if <code>nstud == TRUE</code>; see also <code>Util_nstud_wide</code>. <code>1</code> by default. Please notice that boundaries are included in the acceptance interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>InnerAreas</code></td>
<td>
<p>Logical. Whether the percentage of schools belonging to inner/internal areas must be included (see <code>Get_InnerAreas</code>). TRUE by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ord_InnerAreas</code></td>
<td>
<p>Logical. If <code>check == TRUE</code> and <code>InnerAreas == TRUE</code>, whether the Inner areas classification should be treated as an ordinal variable rather than as a categorical one (see <code>Get_InnerAreas</code> for the classification). <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nstud_check</code></td>
<td>
<p>Logical. If <code>nstud == TRUE</code>, whether to check the students number availability across all school included in the school registries (see <code>Util_Check_nstud_availability</code>). <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nstud_check_registry</code></td>
<td>
<p>Character. If <code>nstud == TRUE</code> and <code>nstud_check == TRUE</code>, the school registries whose availability has to be checked. Either <code>"Registry_from_buildings"</code> (buildings registry), <code>"Registry_from_registry"</code> (proper registry), <code>"Any"</code> or <code>"Both"</code>. <code>"Any"</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BroadBand_impute_missing</code></td>
<td>
<p>Whether the schools not included in the Broadband dataset must be considered in the total of schools (i.e. the denominator to the Broadband availability indicator). <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Date</code></td>
<td>
<p>Character or Date. The threshold date to broadband activation to consider it activated for a school, i.e. the date before which the works of broadband activation must be finished in order to consider a school as provided with the broadband. By default, September 1st at the beginning of the school year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NA_autoRM</code></td>
<td>
<p>Logical. Either <code>TRUE</code>, <code>FALSE</code> or <code>NULL</code>. If <code>TRUE</code>, the values missing in a single dataset are automatically deleted from the final DB. If <code>FALSE</code>, the missing observations are kept automatically. If <code>NULL</code>, the choice is left to the user by an interactive menu. <code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_Invalsi_IS</code></td>
<td>
<p>Object of class <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>.
If <code>INVALSI == TRUE</code>, the raw Invalsi survey data, obtained as output of the <code>Get_Invalsi_IS</code> function.
If <code>NULL</code>, it will be downloaded automatically, but not saved in the global environment.
<code>NULL</code> by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_Registry</code></td>
<td>
<p>Object of class <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>.
The school registry corresponding to the year in scope, obtained as output of the function <code>Get_Registry</code>.
If <code>NULL</code>, it will be downloaded automatically, but not saved in the global environment.
<code>NULL</code> by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_SchoolBuildings</code></td>
<td>
<p>Object of class <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>. If <code>SchoolBuildings == TRUE</code>, the raw school buildings dataset obtained as output of the function <code>Get_DB_MIUR</code>.
If <code>NULL</code>, it will be downloaded automatically but not saved in the global environment. <code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_nstud</code></td>
<td>
<p>Object of class <code>list</code>, including two objects of class<code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>.
If <code>nstud == TRUE</code>, the students and classes counts, obtained as output of the function <code>Get_nstud</code> with default <code>filename</code> parameter.
If <code>NULL</code>, the function will download it automatically but it will not be saved in the global environment. <code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_School2mun</code></td>
<td>
<p>Object of class <code>list</code> with elements of class <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>
If <code>nstud == TRUE</code>, the mapping from school codes to municipality (and province) codes. Needed only if <code>check == TRUE</code>, obtained as output of the function <code>Get_School2mun</code>.
If <code>NULL</code>, it will be downloaded automatically, but not saved in the global environment. <code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_AdmUnNames</code></td>
<td>
<p>Object of class <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>, obtained as output of the function <code>Get_AdmUnNames</code>
If necessary,the ISTAT file including all the codes and the names of the administrative units for the year in scope. Required either if <code>nstud == TRUE &amp; nstud_check == TRUE</code>, or if <code>SchoolBuildings == TRUE</code>, <code>input_DB_MIUR</code> is not provided, and the school year is one of 2015/16, 2017/18 or 1018/19
If <code>NULL</code>, it will be downloaded automatically, but not saved in the global environment. <code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_InnerAreas</code></td>
<td>
<p>Object of class <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>.
If <code>InnerAreas == TRUE</code>, the classification of peripheral municipalities, obtained as output of the function <code>Get_InnerAreas</code>
If <code>NULL</code>, it will be downloaded automatically, but not saved in the global environment.
<code>NULL</code> by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_teachers4student</code></td>
<td>
<p>Object of class <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>. If <code>nteachers == TRUE</code> and <code>nstud = TRUE</code>, the number of teachers for studets by province. Please notice that
this object cannot be considered a substitute for the number of students by class since it provides no information on the number of schools in single educational grades but only at the school order level.
Obtained as output of the function <code>Group_teachers4stud</code>.
If <code>NULL</code>, it will be downloaded automatically, but not saved in the global environment.
<code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_nteachers</code></td>
<td>
<p>Object of class <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>. If <code>nteachers == TRUE</code>, the number of teachers by province, obtained as output of the function <code>Get_nteachers_prov</code>. If <code>NULL</code>, it will be downloaded automatically, but not saved in the global environment.
<code>NULL</code> by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_BroadBand</code></td>
<td>
<p>Object of classs <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>. If BroadBand == TRUE, the raw Broadband connection dataset obtaned as output of the function <code>Get_BroadBand</code>
If <code>NULL</code>, it will be downloaded automatically but not saved in the global environment. <code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autoAbort</code></td>
<td>
<p>Logical. In case any data must be retrieved, whether to automatically abort the operation and return NULL in case of missing internet connection or server response errors. <code>FALSE</code> by default.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of  class <code>tbl_df</code>, <code>tbl</code> and <code>data.frame</code>
</p>


<h3>See Also</h3>

<p><code>Util_DB_MIUR_num</code>, <code>Group_DB_MIUR</code>, <code>Group_nstud</code>, <code>Util_Check_nstud_availability</code>, <code>Get_School2mun</code>
for similar arguments.
</p>


<h3>Examples</h3>

<pre><code class="language-R">


DB23_prov &lt;- Set_DB(Year = 2023, level = "NUTS-3",Invalsi_grade = c(5, 8, 13),
      Invalsi_subj = "Italian",nteachers = FALSE, BroadBand = FALSE,
      SchoolBuildings_count_missing = FALSE,NA_autoRM= TRUE,
      input_SchoolBuildings = example_input_DB23_MIUR[, -c(11:18, 10:27)],
      input_Invalsi_IS = example_Invalsi23_prov,
      input_nstud = example_input_nstud23,
      input_InnerAreas = example_InnerAreas,
      input_School2mun = example_School2mun23,
      input_AdmUnNames = example_AdmUnNames20220630)


DB23_prov

summary(DB23_prov[, -c(22:62)])





</code></pre>


</div>