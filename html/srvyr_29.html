<div class="container">

<table style="width: 100%;"><tr>
<td>as_survey_twophase</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a tbl_svy survey object using two phase design</h2>

<h3>Description</h3>

<p>Create a survey object by specifying the survey's two phase design. It is a
wrapper around <code>twophase</code>. All survey variables must be
included in the data.frame itself. Variables are selected by using bare
column names, or convenience functions described in
<code>select</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">as_survey_twophase(.data, ...)

## S3 method for class 'data.frame'
as_survey_twophase(
  .data,
  id,
  strata = NULL,
  probs = NULL,
  weights = NULL,
  fpc = NULL,
  subset,
  method = c("full", "approx", "simple"),
  ...
)

## S3 method for class 'twophase2'
as_survey_twophase(.data, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.data</code></td>
<td>
<p>A data frame (which contains the variables specified below)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>list of two sets of variable names for sampling unit identifiers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata</code></td>
<td>
<p>list of two sets of variable names (or <code>NULLs</code>) for stratum identifiers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>
<p>list of two sets of variable names (or <code>NULLs</code>) for sampling probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Only for method = "approx", list of two sets of variable names (or <code>NULLs</code>)
for sampling weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fpc</code></td>
<td>
<p>list of two sets of variables (or <code>NULLs</code> for finite population corrections</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>bare name of a variable which specifies which observations are selected in phase 2</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>"full" requires (much) more memory, but gives unbiased variance estimates for
general multistage designs at both phases. "simple" or "approx" use less memory, and is correct for
designs with simple random sampling at phase one and stratified randoms sampling at phase two. See
<code>twophase</code> for more details.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>tbl_svy</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Examples from ?survey::twophase
# two-phase simple random sampling.
data(pbc, package="survival")
library(dplyr)

pbc &lt;- pbc %&gt;%
  mutate(randomized = !is.na(trt) &amp; trt &gt; 0,
         id = row_number())
d2pbc &lt;- pbc %&gt;%
  as_survey_twophase(id = list(id, id), subset = randomized)

d2pbc %&gt;% summarize(mean = survey_mean(bili))

# two-stage sampling as two-phase
library(survey)
data(mu284)

mu284_1 &lt;- mu284 %&gt;%
  dplyr::slice(c(1:15, rep(1:5, n2[1:5] - 3))) %&gt;%
  mutate(id = row_number(),
         sub = rep(c(TRUE, FALSE), c(15, 34-15)))

dmu284 &lt;- mu284 %&gt;%
  as_survey_design(ids = c(id1, id2), fpc = c(n1, n2))
# first phase cluster sample, second phase stratified within cluster
d2mu284 &lt;- mu284_1 %&gt;%
  as_survey_twophase(id = list(id1, id), strata = list(NULL, id1),
                  fpc = list(n1, NULL), subset = sub)
dmu284 %&gt;%
  summarize(total = survey_total(y1),
            mean = survey_mean(y1))
d2mu284 %&gt;%
  summarize(total = survey_total(y1),
            mean = survey_mean(y1))

# dplyr 0.7 introduced new style of NSE called quosures
# See `vignette("programming", package = "dplyr")` for details
ids &lt;- quo(list(id, id))
d2pbc &lt;- pbc %&gt;%
  as_survey_twophase(id = !!ids, subset = "randomized")

</code></pre>


</div>