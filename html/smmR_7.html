<div class="container">

<table style="width: 100%;"><tr>
<td>fitsmm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Maximum Likelihood Estimation (MLE) of a semi-Markov chain</h2>

<h3>Description</h3>

<p>Maximum Likelihood Estimation of a semi-Markov chain starting
from one or several sequences. This estimation can be parametric or
non-parametric, non-censored, censored at the beginning and/or at the end
of the sequence, with one or several trajectories. Several parametric
distributions are considered (Uniform, Geometric, Poisson, Discrete
Weibull and Negative Binomial).
</p>


<h3>Usage</h3>

<pre><code class="language-R">fitsmm(
  sequences,
  states,
  type.sojourn = c("fij", "fi", "fj", "f"),
  distr = "nonparametric",
  init.estim = "mle",
  cens.beg = FALSE,
  cens.end = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sequences</code></td>
<td>
<p>A list of vectors representing the sequences.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>states</code></td>
<td>
<p>Vector of state space (of length s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type.sojourn</code></td>
<td>
<p>Type of sojourn time (for more explanations, see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distr</code></td>
<td>
<p>By default <code>"nonparametric"</code> for the non-parametric estimation
case.
</p>
<p>If the parametric estimation case is desired, <code>distr</code> should be:
</p>

<ul>
<li>
<p> A matrix of distributions of dimension <code class="reqn">(s, s)</code> if <code>type.sojourn = "fij"</code>;
</p>
</li>
<li>
<p> A vector of distributions of length <code class="reqn">s</code> if <code>type.sojourn = "fi"</code> or <code>"fj"</code>;
</p>
</li>
<li>
<p> A distribution if <code>type.sojourn = "f"</code>.
</p>
</li>
</ul>
<p>The distributions to be used in <code>distr</code> must be one of <code>"unif"</code>, <code>"geom"</code>,
<code>"pois"</code>, <code>"dweibull"</code>, <code>"nbinom"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.estim</code></td>
<td>
<p>Optional. <code>init.estim</code> gives the method used to estimate
the initial distribution. The following methods are proposed:
</p>

<ul>
<li> <p><code>init.estim = "mle"</code>: the classical Maximum Likelihood Estimator
is used to estimate the initial distribution <code>init</code>;
</p>
</li>
<li> <p><code>init.estim = "limit"</code>: the initial distribution is replaced by
the limit (stationary) distribution of the semi-Markov chain;
</p>
</li>
<li> <p><code>init.estim = "freq"</code>: the initial distribution is replaced by
the frequencies of each state in the sequences;
</p>
</li>
<li> <p><code>init.estim = "unif"</code>: the initial probability of each state is
equal to <code class="reqn">1 / s</code>, with <code class="reqn">s</code> the number of states.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens.beg</code></td>
<td>
<p>Optional. A logical value indicating whether or not
sequences are censored at the beginning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens.end</code></td>
<td>
<p>Optional. A logical value indicating whether or not
sequences are censored at the end.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function estimates a semi-Markov model in parametric or
non-parametric case, taking into account the type of sojourn time and the
censoring described in references. The non-parametric estimation concerns
sojourn time distributions defined by the user. For the parametric
estimation, several discrete distributions are considered (see below).
</p>
<p>The difference between the Markov model and the semi-Markov model concerns
the modeling of the sojourn time. With a Markov chain, the sojourn time
distribution is modeled by a Geometric distribution (in discrete time).
With a semi-Markov chain, the sojourn time can be any arbitrary distribution.
In this package, the available distribution for a semi-Markov model are :
</p>

<ul>
<li>
<p> Uniform: <code class="reqn">f(x) = \frac{1}{n}</code> for <code class="reqn">1 \le x \le n</code>. <code class="reqn">n</code> is the parameter;
</p>
</li>
<li>
<p> Geometric: <code class="reqn">f(x) = \theta (1-\theta)^{x - 1}</code> for <code class="reqn">x = 1, 2,\ldots,n</code>, <code class="reqn">0 &lt; \theta &lt; 1</code>, <code class="reqn">\theta</code> is the probability of success.
<code class="reqn">\theta</code> is the parameter;
</p>
</li>
<li>
<p> Poisson: <code class="reqn">f(x) = \frac{\lambda^x exp(-\lambda)}{x!}</code> for <code class="reqn">x = 0, 1, 2,\ldots,n</code>, with <code class="reqn">\lambda &gt; 0</code>.
<code class="reqn">\lambda</code> is the parameter;
</p>
</li>
<li>
<p> Discrete Weibull of type 1: <code class="reqn">f(x)=q^{(x-1)^{\beta}}-q^{x^{\beta}}</code>, <code class="reqn">x = 1, 2,\ldots,n</code>,
with <code class="reqn">0 &lt; q &lt; 1</code>, the first parameter and <code class="reqn">\beta &gt; 0</code> the second parameter.
<code class="reqn">(q, \beta)</code> are the parameters;
</p>
</li>
<li>
<p> Negative binomial: <code class="reqn">f(x)=\frac{\Gamma(x+\alpha)}{\Gamma(\alpha) x!} p^{\alpha} (1 - p)^x</code>,
for <code class="reqn">x = 0, 1, 2,\ldots,n</code>, <code class="reqn">\Gamma</code> is the Gamma function,
<code class="reqn">\alpha</code> is the parameter of overdispersion and <code class="reqn">p</code> is the
probability of success, <code class="reqn">0 &lt; p &lt; 1</code>. <code class="reqn">(\alpha, p)</code> are the parameters;
</p>
</li>
<li>
<p> Non-parametric.
</p>
</li>
</ul>
<p>We define :
</p>

<ul>
<li>
<p> the semi-Markov kernel <code class="reqn">q_{ij}(k) = P( J_{m+1} = j, T_{m+1} - T_{m} = k | J_{m} = i )</code>;
</p>
</li>
<li>
<p> the transition matrix <code class="reqn">(p_{trans}(i,j))_{i,j} \in states</code> of the
embedded Markov chain <code class="reqn">J = (J_m)_m</code>, <code class="reqn">p_{trans}(i,j) = P( J_{m+1} = j | J_m = i )</code>;
</p>
</li>
<li>
<p> the initial distribution <code class="reqn">\mu_i = P(J_1 = i) = P(Z_1 = i)</code>, <code class="reqn">i \in 1, 2, \dots, s</code>;
</p>
</li>
<li>
<p> the conditional sojourn time distributions <code class="reqn">(f_{ij}(k))_{i,j} \in states,\ k \in N ,\ f_{ij}(k) = P(T_{m+1} - T_m = k | J_m = i, J_{m+1} = j )</code>,
<code class="reqn">f</code> is specified by the argument <code>param</code> in the parametric case
and by <code>distr</code> in the non-parametric case.
</p>
</li>
</ul>
<p>The maximum likelihood estimation of the transition matrix of the embedded
Markov chain is <code class="reqn">\widehat{p_{trans}}(i,j) = \frac{N_{ij}}{N_{i.}}</code>.
</p>
<p>Five methods are proposed for the estimation of the initial distribution :
</p>

<dl>
<dt>Maximum Likelihood Estimator: </dt>
<dd>
<p>The Maximum Likelihood Estimator
for the initial distribution. The formula is:
<code class="reqn">\widehat{\mu_i} = \frac{Nstart_i}{L}</code>, where <code class="reqn">Nstart_i</code> is
the number of occurences of the word <code class="reqn">i</code> (of length <code class="reqn">k</code>) at
the beginning of each sequence and <code class="reqn">L</code> is the number of sequences.
This estimator is reliable when the number of sequences <code class="reqn">L</code> is high.</p>
</dd>
<dt>Limit (stationary) distribution: </dt>
<dd>
<p>The limit (stationary)
distribution of the semi-Markov chain is used as a surrogate of the
initial distribution.</p>
</dd>
<dt>Frequencies of each state: </dt>
<dd>
<p>The initial distribution is replaced
by taking the frequencies of each state in the sequences.</p>
</dd>
<dt>Uniform distribution: </dt>
<dd>
<p>The initial probability of each state is
equal to <code class="reqn">1 / s</code>, with <code class="reqn">s</code>, the number of states.</p>
</dd>
</dl>
<p>Note that <code class="reqn">q_{ij}(k) = p_{trans}(i,j) \ f_{ij}(k)</code> in the general case
(depending on the present state and on the next state). For particular cases,
we replace <code class="reqn">f_{ij}(k)</code> by <code class="reqn">f_{i.}(k)</code> (depending on the present
state <code class="reqn">i</code>), <code class="reqn">f_{.j}(k)</code> (depending on the next state <code class="reqn">j</code>) and
<code class="reqn">f_{..}(k)</code> (depending neither on the present state nor on the next
state).
</p>
<p>In this package we can choose different types of sojourn time.
Four options are available for the sojourn times:
</p>

<ul>
<li>
<p> depending on the present state and on the next state (<code>fij</code>);
</p>
</li>
<li>
<p> depending only on the present state (<code>fi</code>);
</p>
</li>
<li>
<p> depending only on the next state (<code>fj</code>);
</p>
</li>
<li>
<p> depending neither on the current, nor on the next state (<code>f</code>).
</p>
</li>
</ul>
<p>If  <code>type.sojourn = "fij"</code>, <code>distr</code> is a matrix of dimension <code class="reqn">(s, s)</code>
(e.g., if the 1st element of the 2nd column is <code>"pois"</code>, that is to say we
go from the first state to the second state following a Poisson distribution).
If <code>type.sojourn = "fi"</code> or <code>"fj"</code>, <code>distr</code> must be a vector (e.g., if the
first element of vector is <code>"geom"</code>, that is to say we go from (or to) the
first state to (or from) any state according to a Geometric distribution).
If <code>type.sojourn = "f"</code>, <code>distr</code> must be one of <code>"unif"</code>, <code>"geom"</code>, <code>"pois"</code>,
<code>"dweibull"</code>, <code>"nbinom"</code> (e.g., if <code>distr</code> is equal to <code>"nbinom"</code>, that is
to say that the sojourn time when going from one state to another state
follows a Negative Binomial distribution).
For the non-parametric case, <code>distr</code> is equal to <code>"nonparametric"</code> whatever
type of sojourn time given.
</p>
<p>If the sequence is censored at the beginning and/or at the end, <code>cens.beg</code>
must be equal to <code>TRUE</code> and/or <code>cens.end</code> must be equal to <code>TRUE</code>.
All the sequences must be censored in the same way.
</p>


<h3>Value</h3>

<p>Returns an object of S3 class <code>smmfit</code> (inheriting from the S3
class <code>smm</code> and smmnonparametric class if <code>distr = "nonparametric"</code>
or smmparametric otherwise). The S3 class <code>smmfit</code> contains:
</p>

<ul>
<li>
<p> All the attributes of the S3 class smmnonparametric or
smmparametric depending on the type of estimation;
</p>
</li>
<li>
<p> An attribute <code>M</code> which is an integer giving the total length of
the set of sequences <code>sequences</code> (sum of all the lengths of the list
<code>sequences</code>);
</p>
</li>
<li>
<p> An attribute <code>loglik</code> which is a numeric value giving the value
of the log-likelihood of the specified semi-Markov model based on the
<code>sequences</code>;
</p>
</li>
<li>
<p> An attribute <code>sequences</code> which is equal to the parameter
<code>sequences</code> of the function <code>fitsmm</code> (i.e. a list of sequences used to
estimate the Markov model).
</p>
</li>
</ul>
<h3>References</h3>

<p>V. S. Barbu, N. Limnios. (2008). Semi-Markov Chains and Hidden Semi-Markov
Models Toward Applications - Their Use in Reliability and DNA Analysis.
New York: Lecture Notes in Statistics, vol. 191, Springer.
</p>


<h3>See Also</h3>

<p>smmnonparametric, smmparametric, simulate.smm,
simulate.smmfit, plot.smm, plot.smmfit
</p>


<h3>Examples</h3>

<pre><code class="language-R">states &lt;- c("a", "c", "g", "t")
s &lt;- length(states)

# Creation of the initial distribution
vect.init &lt;- c(1 / 4, 1 / 4, 1 / 4, 1 / 4)

# Creation of the transition matrix
pij &lt;- matrix(c(0, 0.2, 0.5, 0.3, 
                0.2, 0, 0.3, 0.5, 
                0.3, 0.5, 0, 0.2, 
                0.4, 0.2, 0.4, 0), 
              ncol = s, byrow = TRUE)

# Creation of the distribution matrix

distr.matrix &lt;- matrix(c(NA, "pois", "geom", "nbinom", 
                         "geom", NA, "pois", "dweibull",
                         "pois", "pois", NA, "geom", 
                         "pois", "geom", "geom", NA), 
                       nrow = s, ncol = s, byrow = TRUE)

# Creation of an array containing the parameters
param1.matrix &lt;- matrix(c(NA, 2, 0.4, 4, 
                          0.7, NA, 5, 0.6, 
                          2, 3, NA, 0.6, 
                          4, 0.3, 0.4, NA), 
                        nrow = s, ncol = s, byrow = TRUE)

param2.matrix &lt;- matrix(c(NA, NA, NA, 0.6, 
                          NA, NA, NA, 0.8, 
                          NA, NA, NA, NA, 
                          NA, NA, NA, NA), 
                        nrow = s, ncol = s, byrow = TRUE)

param.array &lt;- array(c(param1.matrix, param2.matrix), c(s, s, 2))

# Specify the semi-Markov model
semimarkov &lt;- smmparametric(states = states, init = vect.init, ptrans = pij, 
                            type.sojourn = "fij", distr = distr.matrix, 
                            param = param.array)

seqs &lt;- simulate(object = semimarkov, nsim = c(1000, 10000, 2000), seed = 100)

# Estimation of simulated sequences
est &lt;- fitsmm(sequences = seqs, states = states, type.sojourn = "fij", 
              distr = distr.matrix)

</code></pre>


</div>