<div class="container">

<table style="width: 100%;"><tr>
<td>fpeaks</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Frequency peak detection</h2>

<h3>Description</h3>

<p>This function searches for peaks of a frequency spectrum.</p>


<h3>Usage</h3>

<pre><code class="language-R">fpeaks(spec, f = NULL,
nmax = NULL, amp = NULL, freq = NULL, threshold = NULL,
mel =FALSE,
plot = TRUE, title = TRUE,
xlab = NULL, ylab = "Amplitude",
labels = TRUE, digits = 2,
legend = TRUE, collab = "red", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>spec</code></td>
<td>
<p>a data set resulting of a spectral analysis obtained
with <code>spec</code> or <code>meanspec</code>. Can be in dB.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>sampling frequency of <code>spec</code> (in Hz). Not requested if
the first column of <code>spec</code> contains the frequency axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nmax</code></td>
<td>
<p>maximal number of peaks detected. Overrides <code>amp</code> and
<code>freq</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>amp</code></td>
<td>
<p>amplitude slope parameter, a numeric vector of length
2. Refers to the amplitude slopes of the peak. The first value is the
left slope and the second value is the right slope. Only peaks with
higher slopes than threshold values will be kept. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freq</code></td>
<td>
<p>frequency threshold parameter (in Hz). If the frequency
difference of two successive peaks is less than this threshold, then 
the peak of highest amplitude will be kept only. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>amplitude threshold parameter. Only peaks above this
threshold will be considered. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mel</code></td>
<td>
<p>a logical, if <code>TRUE</code> the (htk-)mel scale is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>logical, if <code>TRUE</code>, a plot showing the peaks is returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>logical, if <code>TRUE</code> add the number of peaks detected
as a plot title.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>label of the x-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>label of the y-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>logical, if <code>TRUE</code> peak labels are plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>if <code>labels</code> is <code>TRUE</code>, the number of decimal
places (<code>round</code>) for the peak labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>logical, if <code>TRUE</code> a legend returning the different
selection parameters (<code>nmax</code>, <code>amp</code>, <code>freq</code>,
<code>threshold</code>, <code>threshold</code>) is added to the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>collab</code></td>
<td>
<p>labels color.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other <code>plot</code> graphical parameters.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Here are some details regarding the different selection
parameters:<br></p>

<ul>
<li> <p><code>nmax</code>: this parameter is to be used if you wish to get a
specific number of peaks. The peaks selected are those with the
highest slopes. It then does not work in conjunction with the other parameters.
</p>
</li>
<li> <p><code>freq</code>: this parameter allows to remove from the selection
successive peaks with a small frequency difference. Imagine you have two
successive peaks at 1200 Hz and 1210 Hz and at 0.5 
and 0.25 in amplitude. If you set <code>freq</code> to 50 Hz, then only the first
peak will be kept.
</p>
</li>
<li> <p><code>amp</code>: this parameter allows to remove from the selection
peaks with low slopes. You can make the selection on both slopes or on
a single one. Imagine you have an asymetric peak with a 0.01 left slope and a
0.02 right slope. The peak will be discarded for the following
settings: both values higher than 0.02 (<em>e.g.</em> <code>amp =
    c(0.03,0.04)</code>), the first value higher than 0.01 (<em>e.g.</em> <code>amp =
    c(0.02,0.001)</code>), the second value higher than 0.02 (<em>e.g.</em> <code>amp =
    c(0.001,0.03)</code>). If you do not want apply the selection
on one of the slope use 0. For instance, a selection on the left slope
only will be achieved with: <code>amp = c(0.02,0)</code>.
</p>
</li>
<li> <p><code>threshold</code>: this parameter can be used to do a rough
selection on the spectrum. Peaks with an amplitude value (not a slope)
lower than this threshold will be automatically discarded. This can be
useful when you want to remove peaks of a low-amplitude background noise.
</p>
</li>
</ul>
<h3>Value</h3>

<p>A two-column matrix, the first column corresponding to the
frequency values (x-axis) and the second column corresponding to the
amplitude values (y-axis) of the peaks.</p>


<h3>Note</h3>

<p>You can also use <code>fpeaks</code> with other kind of spectrum, for
instance a cepstral spectrum. See examples.</p>


<h3>Author(s)</h3>

<p>Jerome Sueur and Amandine Gasc</p>


<h3>See Also</h3>

<p><code>localpeaks</code>, <code>meanspec</code>, <code>spec</code></p>


<h3>Examples</h3>

<pre><code class="language-R">data(tico)
spec &lt;- meanspec(tico, f=22050, plot=FALSE)
specdB &lt;- meanspec(tico, f=22050, dB="max0", plot=FALSE)
# all peaks
fpeaks(spec)
# 10 highest peaks
fpeaks(spec, nmax=10)
# highest peak (ie dominant frequency)
fpeaks(spec, nmax=1)
# peaks that are separated by more than 500 Hz
fpeaks(spec, freq=500)
# peaks with a left slope higher than 0.1
fpeaks(spec, amp=c(0.1,0))
# peaks with a right slope higher than 0.1
fpeaks(spec, amp=c(0,0.1))
# peaks with left and right slopes higher than 0.1
fpeaks(spec, amp=c(0.1,0.1))
# peaks above a 0.5 threshold
fpeaks(spec, threshold=0.5)
# peaks of a dB spectrum with peaks showing slopes higher than 3 dB
fpeaks(specdB, amp=c(3,3))
# comparing different parameter settings
meanspec(tico, f=22050)
col &lt;- c("#ff000090","#0000ff75","#00ff00")
cex &lt;- c(2,1.25,1.5)
pch &lt;- c(19,17,4)
title(main="Peak detection \n (spectrum with values between 0 and 1)")
res1 &lt;- fpeaks(spec, plot = FALSE)
res2 &lt;- fpeaks(spec, amp=c(0.02,0.02), plot =FALSE)
res3 &lt;- fpeaks(spec, amp=c(0.02,0.02), freq=200, plot = FALSE)
points(res1, pch=pch[1], col=col[1], cex=cex[1])
points(res2, pch=pch[2], col=col[2], cex=cex[2])
points(res3, pch=pch[3], col=col[3], cex=cex[3])
legend("topright", legend=c("all peaks","amp", "amp &amp; freq"), pch=pch,
pt.cex=cex, col=col, bty="n")
# example with a cepstral spectrum
data(sheep)
res &lt;- ceps(sheep,f=8000,at=0.4,wl=1024,plot=FALSE)
fpeaks(res, nmax=4, xlab="Quefrency (s)")
# melscale
require(tuneR)
mel &lt;- melfcc(sheep, nbands = 256, dcttype = "t3", fbtype = "htkmel", spec_out=TRUE)
melspec.mean &lt;- apply(mel$aspectrum, MARGIN=2, FUN=mean)
melspec.mean &lt;- melspec.mean/max(melspec.mean) # [0,1] scaling 
fpeaks(melspec.mean, nmax=4, f=8000, mel=TRUE)
fpeaks(melspec.mean, freq=4, f=8000, mel=TRUE) # freq in Hz!
fpeaks(melspec.mean, threshold=0.3, f=8000, mel=TRUE)
fpeaks(melspec.mean, amp=c(0.1,0.1), f=8000, mel=TRUE)
</code></pre>


</div>