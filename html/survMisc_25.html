<div class="container">

<table style="width: 100%;"><tr>
<td>gof</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
<b>g</b>oodness <b>o</b>f <b>f</b>it test for a <code>coxph</code> object</h2>

<h3>Description</h3>

<p><b>g</b>oodness <b>o</b>f <b>f</b>it test for a <code>coxph</code> object
</p>


<h3>Usage</h3>

<pre><code class="language-R">gof(x, ...)

## S3 method for class 'coxph'
gof(x, ..., G = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An object of class <code>coxph</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments (not implemented)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>G</code></td>
<td>
<p>Number of <b>g</b>roups into which to divide risk score.
If <code>G=NULL</code> (the default), uses closest integer to
</p>
<p style="text-align: center;"><code class="reqn">G = \max(2, \quad \min(10, \quad \frac{ne}{40}))</code>
</p>

<p>where <code class="reqn">ne</code> is the number of events overall.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In order to verify the overall goodness of fit,
the risk score <code class="reqn">r_i</code> for each observation <code class="reqn">i</code> is given by
</p>
<p style="text-align: center;"><code class="reqn">r_i = \hat{\beta} X_i</code>
</p>

<p>where <code class="reqn">\hat{\beta}</code> is the vector of fitted coefficients
and <code class="reqn">X_i</code> is the vector of predictor variables for
observation <code class="reqn">i</code>.
<br>
This risk score is then sorted and 'lumped' into
a grouping variable with <code class="reqn">G</code> groups,
(containing approximately equal numbers of observations).
<br>
The number of observed (<code class="reqn">e</code>) and expected (<code class="reqn">exp</code>) events in
each group are used to generate a <code class="reqn">Z</code> statistic for each group,
which is assumed to follow a normal distribution with
<code class="reqn">Z \sim N(0,1)</code>.
<br>
The indicator variable <code>indicG</code> is added to the
original model and the two models are compared to determine the
improvement in fit via the likelihood ratio test.
</p>


<h3>Value</h3>

<p>A <code>list</code> with elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>groups</code></td>
<td>
<p>A <code>data.table</code> with one row per group <code class="reqn">G</code>.
The columns are </p>

<dl>
<dt>n</dt>
<dd>
<p>Number of observations</p>
</dd>
<dt>e</dt>
<dd>
<p>Number of events</p>
</dd>
<dt>exp</dt>
<dd>
<p>Number of events expected. This is
</p>
<p style="text-align: center;"><code class="reqn">exp = \sum e_i - M_i</code>
</p>

<p>where <code class="reqn">e_i</code> are the events and
<code class="reqn">M_i</code> are the martingale residuals
for each observation <code class="reqn">i</code></p>
</dd>
<dt>z</dt>
<dd>
<p><code class="reqn">Z</code> score, calculated as
</p>
<p style="text-align: center;"><code class="reqn"> Z = \frac{e - exp}{\sqrt{exp}}</code>
</p>

</dd>
<dt>p</dt>
<dd>
<p><code class="reqn">p</code>-value for <code class="reqn">Z</code>, which is
</p>
<p style="text-align: center;"><code class="reqn"> p = 2. \code{pnorm}(-|z|)</code>
</p>

<p>where <code>pnorm</code> is the normal distribution function
with mean <code class="reqn">\mu =0</code> and standard deviation <code class="reqn">\sigma =1</code>
and <code class="reqn">|z|</code> is the absolute value.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lrTest</code></td>
<td>
<p>Likelihood-ratio test.
Tests the improvement in log-likelihood with addition
of an indicator variable with <code class="reqn">G-1</code> groups.
This is done with <code>survival:::anova.coxph</code>.
The test is distributed as chi-square with <code class="reqn">G-1</code> degrees of freedom</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The choice of <code class="reqn">G</code> is somewhat arbitrary but rarely should
be <code class="reqn">&gt; 10</code>.
<br>
As illustrated in the example, a larger value for
<code class="reqn">G</code> makes the <code class="reqn">Z</code> test for each group more likely to be significant.
This does <em>not</em> affect the significance of adding the
indicator variable <code>indicG</code> to the original model.
<br><br>
The <code class="reqn">Z</code> score is chosen for simplicity, as for large sample sizes
the Poisson distribution approaches the normal. Strictly speaking,
the Poisson would be more appropriate for <code class="reqn">e</code> and <code class="reqn">exp</code> as
per Counting Theory.
<br>
The <code class="reqn">Z</code> score may be somewhat conservative as the expected events
are calculated using the martingale residuals from the overall model,
rather than by group. This is likely to bring the expected events
closer to the observed events.
<br><br>
This test is similar to the Hosmer-Lemeshow test for logistic regression.
</p>


<h3>Source</h3>

<p>Method and example are from: <br>
May S, Hosmer DW 1998.
A simplified method of calculating an overall goodness-of-fit test
for the Cox proportional hazards model.
<em>Lifetime Data Analysis</em> <b>4</b>(2):109–20.
<a href="https://doi.org/10.1023/A%3A1009612305785">doi:10.1023/A:1009612305785</a>
</p>


<h3>References</h3>

<p>Default value for <code class="reqn">G</code> as per: <br>
May S, Hosmer DW 2004.
A cautionary note on the use of the Gronnesby and Borgan
goodness-of-fit test for the Cox proportional hazards model.
<em>Lifetime Data Analysis</em> <b>10</b>(3):283–91.
<a href="https://doi.org/10.1023/B%3ALIDA.0000036393.29224.1d">doi:10.1023/B:LIDA.0000036393.29224.1d</a>
</p>
<p>Changes to the <code>pbc</code> dataset in the example are as detailed in: <br>
Fleming T, Harrington D 2005.
<em>Counting Processes and Survival Analysis</em>.
New Jersey: Wiley and Sons. Chapter 4, section 4.6, pp 188.
<a href="https://doi.org/10.1002/9781118150672">doi:10.1002/9781118150672</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("pbc", package="survival")
pbc &lt;- pbc[!is.na(pbc$trt), ]
## make corrections as per Fleming
pbc[pbc$id==253, "age"] &lt;-  54.4
pbc[pbc$id==107, "protime"] &lt;-  10.7
### misspecified; should be log(bili) and log(protime) instead
c1 &lt;- coxph(Surv(time, status==2) ~
            age + log(albumin) + bili + edema + protime,
            data=pbc)
gof(c1, G=10)
gof(c1)

</code></pre>


</div>