<div class="container">

<table style="width: 100%;"><tr>
<td>band_crm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Collision risk model, for a single species and one turbine scenario</h2>

<h3>Description</h3>

<p>Core function of the Collision Risk Model (CRM). Calculates the expected
number of in-flight collisions per month of a seabird species on a given
offshore windfarm, for a choice of model options.
</p>
<p>Calculations are equivalent to those performed on the original CRM
<a href="https://www.bto.org/sites/default/files/u28/downloads/Projects/Final_Report_SOSS02_Band2Tool.xlsm">spreadsheet</a>,
as per <a href="https://www.bto.org/sites/default/files/u28/downloads/Projects/Final_Report_SOSS02_Band1ModelGuidance.pdf">Band (2012)</a>,
providing backward compatibility with the original outputs.
</p>


<h3>Usage</h3>

<pre><code class="language-R">band_crm(
  model_options = c("1", "2", "3", "4"),
  flight_speed,
  body_lt,
  wing_span,
  flight_type,
  avoid_rt_basic = NULL,
  avoid_rt_ext = NULL,
  noct_activity,
  prop_crh_surv = NULL,
  dens_month,
  prop_upwind,
  site_fhd = NULL,
  gen_fhd = NULL,
  rotor_speed,
  rotor_radius,
  blade_width,
  blade_pitch,
  n_blades,
  hub_height,
  chord_prof = chord_prof_5MW,
  n_turbines,
  turb_oper_month,
  wf_width,
  wf_latitude,
  tidal_offset,
  lrg_arr_corr = TRUE,
  xinc = 0.05,
  yinc = 0.05,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model_options</code></td>
<td>
<p>Character vector, the model options for calculating collision
risk (see <strong>Details</strong> section below).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flight_speed</code></td>
<td>
<p>Numeric value. The bird flying speed (<code class="reqn">v</code>), in
metres/sec.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>body_lt</code></td>
<td>
<p>Numeric value. The length of the bird (<code class="reqn">L</code>), in metres.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wing_span</code></td>
<td>
<p>Numeric value. The wingspan of the bird (<code class="reqn">W</code>), in
metres.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flight_type</code></td>
<td>
<p>A character string, either 'flapping' or 'gliding',
indicating the species' characteristic flight type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoid_rt_basic, avoid_rt_ext</code></td>
<td>
<p>Numeric values. The avoidance rate for,
respectively, the basic model (i.e. required for model Options 1 and 2) and
the extended model (i.e. required for Options 3 and 4). Avoidance rate
expresses the probability that a bird flying on a collision course with a
turbine will take evading action to avoid collision.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noct_activity</code></td>
<td>
<p>A numeric value. The nocturnal flight activity level,
expressed as a proportion of daytime activity levels (<code class="reqn">f_night</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop_crh_surv</code></td>
<td>
<p>The proportion of flights at collision risk height derived
from site survey (<code class="reqn">Q_2R</code>). Only required for model Option 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dens_month</code></td>
<td>
<p>Data frame, containing estimates of daytime in-flight
bird densities per month within the windfarm footprint, in birds/km^2. It
must contain the following named columns:
</p>

<ul>
<li> <p><code>month</code>, the month names.
</p>
</li>
<li>
<p><code>dens</code>, the number of birds in flight at any height per
square kilometre in each month.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop_upwind</code></td>
<td>
<p>Numeric value between 0-1 giving the proportion of
flights upwind - defaults to 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gen_fhd, site_fhd</code></td>
<td>
<p>Data frame objects, with flight height distributions
(fhd) of the species - the relative frequency distribution of bird flights
at 1-metre height intervals from sea surface.
Specifically:
</p>

<ul>
<li>
<p><code>gen_fhd</code>, Data frame with the species' generic fhd derived
from combining wider survey data. Only required for model Options 2 and 3
</p>
</li>
<li>
<p><code>site_fhd</code>, Data frame with the species' site-specific fhd
derived from local survey data. Only required for model Option 4
</p>
</li>
</ul>
<p>Data frames must contain the following named columns:
</p>

<ul>
<li>
<p><code>height</code>, integers representing height bands from sea surface,
in metres. Function expects 0 as the first value, representing the 0-1m
band.
</p>
</li>
<li>
<p><code>prop</code>, the proportion of flights at each height band.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rotor_speed</code></td>
<td>
<p>Numeric value. The operational rotation speed, in
revolutions/min.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rotor_radius</code></td>
<td>
<p>Numeric value. The radius of the rotor (<code class="reqn">R</code>), in
metres.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blade_width</code></td>
<td>
<p>Numeric value, giving the maximum blade width, in metres.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blade_pitch</code></td>
<td>
<p>Numeric value. The average blade pitch angle, the angle
between the blade surface and the rotor plane (<code class="reqn">\gamma</code>), in radians.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_blades</code></td>
<td>
<p>An integer, the number of blades in rotor (<code class="reqn">b</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hub_height</code></td>
<td>
<p>A numeric value, the height of the rotor hub (<code class="reqn">H</code>), given by the
sum of rotor radius and minimum blade clearance above the highest
astronomical tide (HAT), in metres.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chord_prof</code></td>
<td>
<p>A data frame with the chord taper profile of the rotor
blade. Function expects two named columns:
</p>

<ul>
<li>
<p><code>pp_radius</code>, equidistant intervals of radius at bird passage point,
as a proportion of <code>rotor_radius</code>, within the range <code class="reqn">[0, 1]</code>.
</p>
</li>
<li>
<p><code>chord</code>, the chord width at <code>pp_radius</code>, as a proportion
of <code>blade_width</code>.
</p>
</li>
</ul>
<p>Defaults to a generic profile for a typical modern 5MW turbine. See
<code>chord_prof_5MW()</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_turbines</code></td>
<td>
<p>Integer, the number of turbines on the wind farm
(<code class="reqn">T</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>turb_oper_month</code></td>
<td>
<p>Data frame, holding the proportion of time during
which turbines are operational per month. The following named column are
expected:
</p>

<ul>
<li>
<p><code>month</code>, the month names.
</p>
</li>
<li>
<p><code>prop_oper</code>, the proportion of time operating, per month.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wf_width</code></td>
<td>
<p>Numeric value, the approximate longitudinal width of the
wind farm, in kilometres (<code class="reqn">w</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wf_latitude</code></td>
<td>
<p>A decimal value. The latitude of the centroid of the
windfarm, in degrees.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tidal_offset</code></td>
<td>
<p>A numeric value, the tidal offset, the difference between
HAT and mean sea level, in metres.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lrg_arr_corr</code></td>
<td>
<p>Boolean value. If TRUE, the large array correction will
be applied. This is a correction factor to account for the decay in
bird density at later rows in wind farms with a large array of turbines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yinc, xinc</code></td>
<td>
<p>numeric values, the increments along the y-axis and x-axis
for numerical integration across segments of the rotor circle. Chosen
values express proportion of rotor radius. By default these are set to
0.05, i.e. integration will be performed at a resolution of one twentieth
of the rotor radius.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to pass on when function is called in
<code>stoch_crm()</code>, namely <code>rotor_grids</code> and <code>wf_daynight_hrs_month</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Collision risk can be calculated under 4 options, specified by <code>model_options</code>:
</p>

<ul>
<li> <p><strong>Option 1</strong> - Basic model with proportion at
collision risk height derived from site survey (<code>prop_crh_surv</code>).
</p>
</li>
<li> <p><strong>Option 2</strong> - Basic model with proportion
at collision risk height derived from a generic flight height distribution
(<code>gen_fhd</code>).
</p>
</li>
<li> <p><strong>Option 3</strong> - Extended model using a
generic flight height distribution (<code>gen_fhd</code>).
</p>
</li>
<li> <p><strong>Option 4</strong> - Extended model using a
site-specific flight height distribution (<code>site_fhd</code>).
</p>
</li>
</ul>
<p>Where,
</p>

<ul>
<li>
<p> Basic model - assumes a uniform distribution of bird flights at
collision risk height (i.e. above the minimum and below the maximum height
of the rotor blade).
</p>
</li>
<li>
<p> Extended model - takes into account the distribution of bird flight
heights at collision risk height.
</p>
</li>
</ul>
<h3>Value</h3>

<p>Returns the expected number of bird collisions per month, for each of
the chosen CRM Options. Returned months are those shared between
<code>dens_month</code> and <code>turb_oper_month</code>. Output format is specific to how
the function is called:
</p>

<ul>
<li>
<p> data frame object, if called as a stand-alone function.
</p>
</li>
<li>
<p> list object, if called inside <code>stoch_crm()</code>.
</p>
</li>
</ul>
<h3>Validation and pre-processing of inputs</h3>

<p><code>band_crm()</code> requirements and behaviour are dependent on how it is called:
</p>

<dl>
<dt>As a stand-alone function</dt>
<dd>

<ul>
<li>
<p> All arguments are expected to be specified as describe above
</p>
</li>
<li>
<p> Input validation and pre-processing are carried out.
</p>
</li>
</ul>
</dd>
<dt>Inside <code>stoch_crm()</code>
</dt>
<dd>

<ul>
<li>
<p> Assumes inputs have already been pre-processed and validated, and
thence it skips those steps.
</p>
</li>
<li>
<p>  Additional arguments <code>rotor_grids</code> and
<code>wf_daynight_hrs_month</code> need to be passed to the function. Under the
stochastic context, these quantities can be calculated ahead of the
simulation loop to maximize performance. </p>
</li>
<li>
<p> Furthermore,
<code>gen_fhd</code>, <code>site_fhd</code>, <code>dens_month</code> and
<code>turb_oper_month</code> can be provided as numeric vectors
</p>
</li>
</ul>
</dd>
</dl>
<h3>Code revision and optimization</h3>

<p>Core code performing Band calculations in <a href="https://www.gov.scot/publications/scottish-marine-freshwater-science-vol-6-14-developing-avian-collision/">Masden (2015)</a> implementation
was substantially re-factored, re-structured and streamlined to conform with
conventional R packages requirements.
</p>
<p>Furthermore, previous code underpinning key calculations for the extended
model was replaced by an alternative approach, resulting in significant gains
in computational speed over Masden's approach. This
optimization is particularly beneficial under a stochastic context, when Band
calculations are called repeatedly, potentially thousands of times. See
<code>generate_rotor_grids()</code> for further details.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># ------------------------------------------------------
# Run with arbitrary parameter values, for illustration
# ------------------------------------------------------

# Setting a dataframe of parameters to draw from
params &lt;- data.frame(
  flight_speed = 13.1,         # Flight speed in m/s
  body_lt = 0.85,              # Body length in m
  wing_span = 1.01,            # Wing span in m
  flight_type = "flapping",    # flapping or gliding flight
  avoid_rt_basic = 0.989,      # avoidance rate for option 1 and 2
  avoid_rt_ext = 0.981,        # extended avoidance rate for option 3 and 4
  noct_activity = 0.5,         # proportion of day birds are inactive
  prop_crh_surv = 0.13,        # proportion of birds at collision risk height (option 1 only)
  prop_upwind = 0.5,           # proportion of flights that are upwind
  rotor_speed = 15,            # rotor speed in m/s
  rotor_radius = 120,          # radius of turbine in m
  blade_width = 5,             # width of turbine blades at thickest point in m
  blade_pitch = 15,            # mean radius pitch in Radians
  n_blades = 3,                # total number of blades per turbine
  hub_height = 150,            # height of hub in m above HAT
  n_turbines = 100,            # number of turbines in the wind farm
  wf_width = 52,               # width across longest section of wind farm
  wf_latitude = 56,            # latitude of centroid of wind farm
  tidal_offset = 2.5,          # mean tidal offset from HAT of the wind farm
  lrg_arr_corr = TRUE          # apply a large array correction?
)

# Monthly bird densities
b_dens &lt;- data.frame(
  month = month.abb,
  dens = runif(12, 0.8, 1.5)
)

# flight height distribution from Johnston et al
gen_fhd_dat &lt;- Johnston_Flight_heights_SOSS %&gt;%
  dplyr::filter(variable=="Gannet.est") %&gt;%
  dplyr::select(height,prop)


# monthly operational time of the wind farm
turb_oper &lt;- data.frame(
  month = month.abb,
  prop_oper = runif(12,0.5,0.8)
)


band_crm(
  model_options = c(1,2,3),
  flight_speed = params$flight_speed,
  body_lt = params$body_lt,
  wing_span = params$wing_span,
  flight_type = params$flight_type,
  avoid_rt_basic = params$avoid_rt_basic,
  avoid_rt_ext = params$avoid_rt_ext,
  noct_activity = params$noct_activity,
  prop_crh_surv = params$prop_crh_surv,
  dens_month = b_dens,
  prop_upwind = params$prop_upwind,
  gen_fhd = gen_fhd_dat,
  site_fhd = NULL,  # Option 4 only
  rotor_speed = params$rotor_speed,
  rotor_radius = params$rotor_radius,
  blade_width = params$blade_width,
  blade_pitch = params$blade_pitch,
  n_blades = params$n_blades,
  hub_height = params$hub_height,
  chord_prof = chord_prof_5MW,
  n_turbines = params$n_turbines,
  turb_oper_month = turb_oper,
  wf_width = params$wf_width,
  wf_latitude = params$wf_latitude,
  tidal_offset = params$tidal_offset,
  lrg_arr_corr = params$lrg_arr_corr
  )
</code></pre>


</div>