<div class="container">

<table style="width: 100%;"><tr>
<td>sim_marker</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate a Number of Observed Marker for an Individual</h2>

<h3>Description</h3>

<p>Simulates from
</p>
<p style="text-align: center;"><code class="reqn">\vec U_i \sim N^{(K)}(\vec 0, \Psi)</code>
</p>

<p style="text-align: center;"><code class="reqn">\vec Y_{ij} \mid \vec U_i = \vec u_i \sim N^{(r)}(\vec \mu(s_{ij}, \vec u_i), \Sigma)</code>
</p>

<p>with
</p>
<p style="text-align: center;"><code class="reqn">\vec\mu(s, \vec u) = \vec o + \left(I \otimes \vec g(s)^\top\right)vec(B) + \left(I \otimes \vec m(s)^\top\right) \vec u.</code>
</p>

<p>The number of observations and the observations times, <code class="reqn">s_{ij}</code>s, are
determined from the passed generating functions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim_marker(
  B,
  U,
  sigma_chol,
  r_n_marker,
  r_obs_time,
  m_func,
  g_func,
  offset,
  id = 1L
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>coefficient matrix for time-varying fixed effects.
Use <code>NULL</code> if there is no effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>U</code></td>
<td>
<p>random effects matrix for time-varying random effects.
Use <code>NULL</code> if there is no effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma_chol</code></td>
<td>
<p>Cholesky decomposition of the noise's covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_n_marker</code></td>
<td>
<p>function to generate the number of observed markers.
Takes an integer for the individual's id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_obs_time</code></td>
<td>
<p>function to generate the observations times given the
number of observed markers. Takes an
integer for the number of markers and an integer
for the individual's id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m_func</code></td>
<td>
<p>basis function for <code>U</code> like <code>poly</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>g_func</code></td>
<td>
<p>basis function for <code>B</code> like <code>poly</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>numeric vector with non-time-varying fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>integer with id passed to <code>r_n_marker</code> and
<code>r_obs_time</code>.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>draw_U</code>, <code>eval_marker</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#####
# example with polynomial basis functions
g_func &lt;- function(x){
  x &lt;- x - 1
  cbind(x^3, x^2, x)
}
m_func &lt;- function(x){
  x &lt;- x - 1
  cbind(x^2, x, 1)
}

# parameters
gamma &lt;- matrix(c(.25, .5, 0, -.4, 0, .3), 3, 2)
Psi &lt;- structure(c(0.18, 0.05, -0.05, 0.1, -0.02, 0.06, 0.05, 0.34, -0.25,
                   -0.06, -0.03, 0.29, -0.05, -0.25, 0.24, 0.04, 0.04,
                   -0.12, 0.1, -0.06, 0.04, 0.34, 0, -0.04, -0.02, -0.03,
                   0.04, 0, 0.1, -0.08, 0.06, 0.29, -0.12, -0.04, -0.08,
                   0.51), .Dim = c(6L, 6L))
B &lt;- structure(c(-0.57, 0.17, -0.48, 0.58, 1, 0.86), .Dim = 3:2)
sig &lt;- diag(c(.6, .3)^2)

# generator functions
r_n_marker &lt;- function(id){
  cat(sprintf("r_n_marker: passed id is %d\n", id))
  # the number of markers is Poisson distributed
  rpois(1, 10) + 1L
}
r_obs_time &lt;- function(id, n_markes){
  cat(sprintf("r_obs_time: passed id is %d\n", id))
  # the observations times are uniform distributed
  sort(runif(n_markes, 0, 2))
}

# simulate marker
set.seed(1)
U &lt;- draw_U(chol(Psi), NCOL(B))
sim_marker(B = B, U = U, sigma_chol = chol(sig), r_n_marker = r_n_marker,
           r_obs_time = r_obs_time, m_func = m_func, g_func = g_func,
           offset = NULL, id = 1L)

</code></pre>


</div>