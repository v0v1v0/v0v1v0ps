<div class="container">

<table style="width: 100%;"><tr>
<td>stb.default</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simultaneous Tolerance Bands (STB).</h2>

<h3>Description</h3>

<p>Compute And/Or Plot Simultaneous Tolerance Bands for numeric vectors.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## Default S3 method:
stb(
  obj,
  N = 10000L,
  alpha = 0.05,
  rand.func = rnorm,
  tol = 1e-04,
  max.iter = 100L,
  algo = c("rank", "C", "R"),
  Ncpu = 1,
  q.type = 2L,
  stb.col = "#0000FF40",
  col.points = "black",
  col.out = "red",
  col.pwb = "#0000FF40",
  main = NULL,
  add.pwb = FALSE,
  quiet = FALSE,
  add = FALSE,
  plot = TRUE,
  legend = FALSE,
  timer = FALSE,
  pch = 16,
  pch.out = 16,
  seed = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>(numeric) vector, which is supposed to be N(my, sigma^2)-distributed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>(integer) value specifying the number of random samples to be used for constructing the STB</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>(numeric) value specifying the simultaneous tolerance level, i.e. 100(1-alpha)% of all 'N'
random samples have to be completely enclosed by the bounds of the STB</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rand.func</code></td>
<td>
<p>(function) a function which generates random samples, e.g. <code>rand.func=rnorm</code> which corresponds to random
sampling from the standard normal distribution. Another example is defining func=function(n)rchisq(n=n, df=3, ncp=2)
and using <code>rand.func=func</code>. See examples for further examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>(numeric) value specifying the max. acceptable deviation from 'alpha' used in the bisection algorithm</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.iter</code></td>
<td>
<p>(integer) value specifying the max. number of iteration for finding the bounds of the STB</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>algo</code></td>
<td>
<p>(character) (string) specifying the method to be used for constructing a 100(1-alpha)% STB,
choose "rank" for the rank-based, "C" for a C-implementation of the quantile-based, and
"R" for an R-implentation of the quantile-based algorithm (see details). "C" uses SAS PCTLDEF5 definition of quantiles,
whereas "R" can use any of the built-in R types of quantiles (see <code>quantile</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ncpu</code></td>
<td>
<p>(integer) specifying the number cores/CPUs to be used, for N&gt;1 multi-processing is applied</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q.type</code></td>
<td>
<p>(integer) the quantile-type used if <code>algo="R"</code>, see ? quantile for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stb.col</code></td>
<td>
<p>(character) string, a valid specification of a color to be used for the STB</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.points</code></td>
<td>
<p>(character) color for the points in the QQ-plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.out</code></td>
<td>
<p>(character) color for points outsied of the 100(1-alpha)% STB</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.pwb</code></td>
<td>
<p>(character) color for the point-wise STB (not adjusted for multiplicity), defaults to "#0000FF40" which is "blue"
with 80% transparency</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>(characer) string for a main title appearing over the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.pwb</code></td>
<td>
<p>(logical) should the point-wise tolerance band be plotted for comparison?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>(logical) TRUE = no additional output ist printed (progress bar etc.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add</code></td>
<td>
<p>(logical) TRUE = the 100(1-alpha)% STB is added to an existing plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>(logical) TRUE = either a QQ-plot with STB (add=FALSE) or a STB added to an existing plot (add=TRUE) is plotted.
FALSE = only computations are carried out without plotting, an object of class 'STB' is returned which
can be stored an plotted later on, e.g. to avoid computing an STB every time a Sweave/mWeave report is updated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>(logical) TRUE a legend is plotted "topleft"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timer</code></td>
<td>
<p>(logical) TRUE = the time spent for computing the STB will be printed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch</code></td>
<td>
<p>(integer) plotting symbols for the QQ-plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch.out</code></td>
<td>
<p>(integer) plotting symbols for outlying points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>(numeric) value interpreted as integer, setting the random number generator (RNG) to a defined state</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further graphical parameters passed on</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function takes a numeric vector 'vec' and computes the 100(1-alpha)%-simultaneous tolerance band (STB) for
the (DEFAULT )Null-hypothesis H0: vec~N(my, sigma^2) distributed, which is equal to checking whether the residuals of 
the simplest linear model y = mu + e (y~1) are normally distributed, i.e. 'e ~ N(0, sigma^2)'. By specification of argument <code>rand.func</code> 
other null-distributions can be specified. One has to specify a function with a single argument 'n',  which returns a random sample with 'n' 
observations, randomly drawn from the desired null-distribution (see description argument <code>rand.func</code> below). 
Note that all random samples as well as vector <code>vec</code> will be centered to mean=0 and scaled to sd=1.
</p>
<p>One can choose between three methods for constructing the 100(1-alpha)% STB. There are two implementations of the quantile-based algorithm
("C", "R" see 1st reference) and one of the rank-based algorithm (see 2nd reference). Methods "C" and "R" can be run in parallel. The rank-based
algorithm does not benefit form parallel processing, at least not in the current implementation. It is still the default and recommended for small to medium 
sized vectors and 10000 &lt;= N &lt;= 20000 simulations, which should be sufficiently accurate reflect the null-distribution. The "C" and "R" options refer
to implementations of the quantile-based algorithm. The "C" implementation benefits most from using multiple cores, i.e. the larger 'Ncpu' the better,
and should be used for large problems, i.e. rather large number of elements and large number of simulations.
</p>
<p>The table below gives an impression how these algorithms perform. Runtimes were measured under Windows 7 on a Intel Xeon E5-2687W 3.1 GHz workstation with 16
logical cores and 16 GB RAM. The runtime of the C-implementation of the quantile-based algorithm is denoted as "t_qC12" applied parallely with 12 cores.
Each setting was repeated 10 times and the overall run time was then divided by 10 providing sufficiently robust simulation results.
Note, that for smaller problem sizes a large proportion of the overall runtime is due to simulating, i.e. drawing from the null-distribution.
</p>

<table>
<tr>
<td style="text-align: right;">
	<strong>_____N_obs</strong> </td>
<td style="text-align: right;"> <strong>_____N_sim</strong> </td>
<td style="text-align: right;"> <strong>____t_rank</strong> </td>
<td style="text-align: right;"> <strong>____t_qC12</strong> </td>
</tr>
<tr>
<td style="text-align: right;">
 25    </td>
<td style="text-align: right;"> 5000  </td>
<td style="text-align: right;">  0.4s </td>
<td style="text-align: right;">   0.5s </td>
</tr>
<tr>
<td style="text-align: right;">
 25	  </td>
<td style="text-align: right;"> 10000 </td>
<td style="text-align: right;">  0.8s </td>
<td style="text-align: right;">   1.3s </td>
</tr>
<tr>
<td style="text-align: right;">
 50	  </td>
<td style="text-align: right;"> 10000 </td>
<td style="text-align: right;">  1.0s </td>
<td style="text-align: right;">   3.2s </td>
</tr>
<tr>
<td style="text-align: right;"> 
 100	  </td>
<td style="text-align: right;"> 10000 </td>
<td style="text-align: right;">  1.7s </td>
<td style="text-align: right;">   2.9s </td>
</tr>
<tr>
<td style="text-align: right;">
 100	  </td>
<td style="text-align: right;"> 20000 </td>
<td style="text-align: right;">  3.0s </td>
<td style="text-align: right;">   4.8s </td>
</tr>
<tr>
<td style="text-align: right;">
 225	  </td>
<td style="text-align: right;"> 20000 </td>
<td style="text-align: right;">  5.1s </td>
<td style="text-align: right;">   8.3s </td>
</tr>
<tr>
<td style="text-align: right;">
 300	  </td>
<td style="text-align: right;"> 30000 </td>
<td style="text-align: right;">  9.6s </td>
<td style="text-align: right;">  17.2s </td>
</tr>
<tr>
<td style="text-align: right;">
 300	  </td>
<td style="text-align: right;"> 50000 </td>
<td style="text-align: right;"> 16.1s </td>
<td style="text-align: right;">  24.9s </td>
</tr>
<tr>
<td style="text-align: right;">
 1000  </td>
<td style="text-align: right;"> 50000 </td>
<td style="text-align: right;"> 47.8s </td>
<td style="text-align: right;"> 123.5s </td>
</tr>
<tr>
<td style="text-align: right;">
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly returns a list-type object of class <code>STB</code>, which comprises all arguments accepted by this function.
</p>


<h3>Author(s)</h3>

<p>Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>
</p>


<h3>References</h3>

<p>Schuetzenmeister, A., Jensen, U., Piepho, H.P. (2011), Checking assumptions of normality and homoscedasticity in the general linear model. 
Communications in Statistics - Simulation and Computation; S. 141-154
</p>
<p>Schuetzenmeister, A. and Piepho, H.P. (2012). Residual analysis of linear mixed models using a simulation approach.
Computational Statistics and Data Analysis, 56, 1405-1416
</p>


<h3>See Also</h3>

<p>plot.STB
</p>


<h3>Examples</h3>

<pre><code class="language-R">### log-normal vector to be checked for normality
## Not run: 
set.seed(111)
stb(exp(rnorm(30)), col.out="red", legend=TRUE)

### uniformly distributed sample checked for Chi-Squared Distribution with DF=1, degrees of freedom
set.seed(707)
stb(runif(25, -5, 5), rand.func=function(n){rchisq(n=n, df=1)}, 
    col.out="red", legend=TRUE, main="Chi-Squared with DF=1")

### check whether an Chi-Squared (DF=1) random sample better fits 
stb(rchisq(25, df=1), rand.func=function(n){rchisq(n=n, df=1)}, 
    col.out="red", legend=TRUE, main="Chi-Squared with DF=1")

### add STB to an existing plot
plot(sort(rnorm(30)), sort(rnorm(30)))
stb(rnorm(30), add=TRUE)

### compute STB for later use and prevent plotting
STB &lt;- stb(rnorm(30), plot=FALSE)

## End(Not run)
</code></pre>


</div>