<div class="container">

<table style="width: 100%;"><tr>
<td>cv.svy</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>CV for survey data</h2>

<h3>Description</h3>

<p>This is a cross validation function designed for survey samples taken using a SRS,
stratified, clustered, or clustered-and-stratified sampling design.
Returns survey CV estimates of the mean loss for each model
(MSE for linear models, or binary cross-entropy for logistic models).
</p>


<h3>Usage</h3>

<pre><code class="language-R">cv.svy(
  Data,
  formulae,
  nfolds = 5,
  strataID = NULL,
  clusterID = NULL,
  nest = FALSE,
  fpcID = NULL,
  method = c("linear", "logistic"),
  weightsID = NULL,
  useSvyForFolds = TRUE,
  useSvyForFits = TRUE,
  useSvyForLoss = TRUE,
  na.rm = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Data</code></td>
<td>
<p>Dataframe of dataset to be used for CV</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formulae</code></td>
<td>
<p>Vector of formulas (as strings) for the GLMs to be compared in
cross validation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfolds</code></td>
<td>
<p>Number of folds to be used during cross validation, defaults to
5</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strataID</code></td>
<td>
<p>String of the variable name used to stratify during sampling, must
be the same as in the dataset used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clusterID</code></td>
<td>
<p>String of the variable name used to cluster during sampling, must
be the same as in the dataset used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nest</code></td>
<td>
<p>Specify nest = TRUE if clusters are nested within strata, defaults to FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fpcID</code></td>
<td>
<p>String of the variable name used for finite population corrections, must
be the same as in the dataset used, see <code>svydesign</code> for details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>String, must be either "linear" or "logistic", determines type of
model fit during cross validation, defaults to linear</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weightsID</code></td>
<td>
<p>String of the variable name in the dataset that contains sampling weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useSvyForFolds</code></td>
<td>
<p>Specify useSvyForFolds = TRUE (default) to take svydesign into account when making folds;
should not be set FALSE except for running simulations to understand the properties of surveyCV</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useSvyForFits</code></td>
<td>
<p>Specify useSvyForFits = TRUE (default) to take svydesign into account when fitting models on training sets;
should not be set FALSE except for running simulations to understand the properties of surveyCV</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useSvyForLoss</code></td>
<td>
<p>Specify useSvyForLoss = TRUE (default) to take svydesign into account when calculating loss over test sets;
should not be set FALSE except for running simulations to understand the properties of surveyCV</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Whether to drop cases with missing values when taking 'svymean'
of test losses</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If you have already created a <code>svydesign</code> object or fitted a <code>svyglm</code>,
you will probably prefer the convenience wrapper functions
<code>cv.svydesign</code> or <code>cv.svyglm</code>.
</p>
<p>For models other than linear or logistic regression,
you can use <code>folds.svy</code> or <code>folds.svydesign</code> to generate
CV fold IDs that respect any stratification or clustering in the survey design.
You can then carry out K-fold CV as usual,
taking care to also use the survey design features and survey weights
when fitting models in each training set
and also when evaluating models against each test set.
</p>


<h3>Value</h3>

<p>Object of class <code>svystat</code>, which is a named vector of survey CV estimates of the mean loss
(MSE for linear models, or binary cross-entropy for logistic models) for each model,
with names ".Model_1", ".Model_2", etc. corresponding to the models provided in <code>formulae</code>;
and with a <code>var</code> attribute giving the variances.
See <code>surveysummary</code> for details.
</p>


<h3>See Also</h3>

<p><code>surveysummary</code>, <code>svydesign</code>
</p>
<p><code>cv.svydesign</code> for a wrapper to use with a <code>svydesign</code> object,
or <code>cv.svyglm</code> for a wrapper to use with a <code>svyglm</code> object
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Compare CV MSEs and their SEs under 3 linear models
# for a stratified sample and a one-stage cluster sample,
# using data from the `survey` package
library(survey)
data("api", package = "survey")
# stratified sample
cv.svy(apistrat, c("api00~ell",
                   "api00~ell+meals",
                   "api00~ell+meals+mobility"),
       nfolds = 5, strataID = "stype", weightsID = "pw", fpcID = "fpc")
# one-stage cluster sample
cv.svy(apiclus1, c("api00~ell",
                   "api00~ell+meals",
                   "api00~ell+meals+mobility"),
       nfolds = 5, clusterID = "dnum", weightsID = "pw", fpcID = "fpc")

# Compare CV MSEs and their SEs under 3 linear models
# for a stratified cluster sample with clusters nested within strata
data(NSFG_data)
library(splines)
cv.svy(NSFG_data, c("income ~ ns(age, df = 2)",
                    "income ~ ns(age, df = 3)",
                    "income ~ ns(age, df = 4)"),
       nfolds = 4,
       strataID = "strata", clusterID = "SECU",
       nest = TRUE, weightsID = "wgt")

# Logistic regression example, using the same stratified cluster sample;
# instead of CV MSE, we calculate CV binary cross-entropy loss,
# where (as with MSE) lower values indicate better fitting models
# (NOTE: na.rm=TRUE is not usually ideal;
#  it's used below purely for convenience, to keep the example short,
#  but a thorough analysis would look for better ways to handle the missing data)
cv.svy(NSFG_data, c("KnowPreg ~ ns(age, df = 1)",
                    "KnowPreg ~ ns(age, df = 2)",
                    "KnowPreg ~ ns(age, df = 3)"),
       method = "logistic", nfolds = 4,
       strataID = "strata", clusterID = "SECU",
       nest = TRUE, weightsID = "wgt",
       na.rm = TRUE)
</code></pre>


</div>