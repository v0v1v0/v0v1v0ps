<div class="container">

<table style="width: 100%;"><tr>
<td>getSmoothed</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Extract smoothed estimates.</h2>

<h3>Description</h3>

<p>Extract smoothed estimates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">getSmoothed(
  inla_mod,
  nsim = 1000,
  weight.strata = NULL,
  weight.frame = NULL,
  verbose = FALSE,
  mc = 0,
  include_time_unstruct = FALSE,
  CI = 0.95,
  draws = NULL,
  save.draws = FALSE,
  include_subnational = TRUE,
  only.age = NULL,
  joint = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>inla_mod</code></td>
<td>
<p>output from <code>smoothDirect</code> or <code>smoothCluster</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>number of simulations, only applicable for the cluster-level model or direct model when <code>joint = TRUE</code> is specified. The smooth direct model will draw 1e5 samples from the marginal distribution when <code>joint = FALSE</code> since the computation is faster.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight.strata</code></td>
<td>
<p>a data frame with two columns specifying time and region, followed by columns specifying proportion of each strata for each region. This argument specifies the weights for strata-specific estimates on the probability scale.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight.frame</code></td>
<td>
<p>a data frame with three columns, years, region, and the weight of each frame for the corresponding time period and region. This argument specifies the weights for frame-specific estimates on the logit scale. Notice this is different from weight.strata argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical indicator whether to print progress messages from inla.posterior.sample.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mc</code></td>
<td>
<p>number of monte carlo draws to approximate the marginal prevalence/hazards for binomial model. If mc = 0, analytical approximation is used. The analytical approximation is invalid for hazard modeling with more than one age groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_time_unstruct</code></td>
<td>
<p>Indicator whether to include the temporal unstructured effects (i.e., shocks) in the smoothed estimates from cluster-level model. The argument only applies to the cluster-level models (from <code>smoothCluster</code>). Default is FALSE which excludes all unstructured temporal components. If set to TRUE all  the unstructured temporal random effects will be included. Alternatively, if this is specified as a vector of   subset of year labels (as in the year_label argument), only the unstructured terms in the corresponding time periods will be added to the prediction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI</code></td>
<td>
<p>Desired level of credible intervals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draws</code></td>
<td>
<p>Posterior samples drawn from the fitted model. This argument allows the previously sampled draws (by setting save.draws to be TRUE) be used in new aggregation tasks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.draws</code></td>
<td>
<p>Logical indicator whether the raw posterior draws will be saved. Saved draws can be used to accelerate aggregations with different weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_subnational</code></td>
<td>
<p>logical indicator whether to include the spatial and space-time interaction components in the smoothed estimates. If set to FALSE, only the main temporal trends are returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>only.age</code></td>
<td>
<p>a vector of age groups used to compute the final estimates. Default to be NULL, which includes all age groups in the model. This argument can be used to extract mortality rates of finer age groups when fitting multiple age groups jointly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>joint</code></td>
<td>
<p>Logical indicator whether the posterior draws should be drawn from the joint posterior or marginal distributions. Only releveant for the smooth direct model. Default from the marginal distribution (joint = FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Unused arguments, for users with fitted object from the package before v1.0.0, arguments including Amat, year_label, and year_range can still be specified manually.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A data frame or a list of data frames of S3 class SUMMERproj, which contains the smoothed estimates.
</p>


<h3>Author(s)</h3>

<p>Zehang Richard Li
</p>


<h3>See Also</h3>

<p><code>plot.SUMMERproj</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
years &lt;- levels(DemoData[[1]]$time)

# obtain direct estimates
data &lt;- getDirectList(births = DemoData, 
years = years,  
regionVar = "region", timeVar = "time", 
clusterVar = "~clustid+id", 
ageVar = "age", weightsVar = "weights", 
geo.recode = NULL)
# obtain direct estimates
data_multi &lt;- getDirectList(births = DemoData, years = years,
  regionVar = "region",  timeVar = "time", clusterVar = "~clustid+id",
  ageVar = "age", weightsVar = "weights", geo.recode = NULL)
data &lt;- aggregateSurvey(data_multi)

##
## The following example shows extracting estimates from 
##   fitted smoothDirect() model
##
#  national model
years.all &lt;- c(years, "15-19")
fit1 &lt;- smoothDirect(data = data, Amat = NULL, 
  year_label = years.all, year_range = c(1985, 2019), 
  rw = 2, is.yearly=FALSE, m = 5)
out1 &lt;- getSmoothed(fit1)
plot(out1, is.subnational=FALSE)

#  subnational model
fit2 &lt;- smoothDirect(data = data, Amat = mat, 
  year_label = years.all, year_range = c(1985, 2019), 
  rw = 2, is.yearly=TRUE, m = 5, type.st = 4)
out2 &lt;- getSmoothed(fit2)
plot(out2, is.yearly=TRUE, is.subnational=TRUE)

## The following examples compare the marginal posterior draws
##    with joint posterior draws. The latter gives draws of 
##    all estimates in addition to marginal summaries.
## The plots should fall closely along the 45 degree line 

#  national period model
years.all &lt;- c(years, "15-19")
fit0 &lt;- smoothDirect(data = data, Amat = NULL, 
year_label = years, year_range = c(1985, 2019), 
time.model = 'rw2', m = 1, control.compute = list(config =TRUE))
out0 &lt;- getSmoothed(fit0)
out0a &lt;- getSmoothed(fit0, joint = TRUE, nsim = 1e5)
par(mfrow = c(1, 3))
plot(out0$median, out0a$overall$median)
abline(c(0, 1))
plot(out0$upper, out0a$overall$upper)
abline(c(0, 1))
plot(out0$lower, out0a$overall$lower)
abline(c(0, 1))

#  national yearly model
years.all &lt;- c(years, "15-19")
fit1 &lt;- smoothDirect(data = data, Amat = NULL, 
year_label = years.all, year_range = c(1985, 2019), 
time.model = 'rw2', m = 5, control.compute = list(config =TRUE))
out1 &lt;- getSmoothed(fit1)
out1a &lt;- getSmoothed(fit1, joint = TRUE, nsim = 1e5, save.draws = TRUE)
par(mfrow = c(1, 3))
plot(out1$median, out1a$overall$median)
abline(c(0, 1))
plot(out1$upper, out1a$overall$upper)
abline(c(0, 1))
plot(out1$lower, out1a$overall$lower)
abline(c(0, 1))

#  subnational model
fit2 &lt;- smoothDirect(data = data, Amat = DemoMap$Amat, 
year_label = years.all, year_range = c(1985, 2019), 
time.model = 'rw2',is.yearly=TRUE, m = 5, type.st = 4, 
control.compute = list(config =TRUE))
out2 &lt;- getSmoothed(fit2)
out2a &lt;- getSmoothed(fit2, joint = TRUE, nsim = 1e5, save.draws = TRUE)
par(mfrow = c(1, 3))
plot(out2$median, out2a$overall$median)
abline(c(0, 1))
plot(out2$upper, out2a$overall$upper)
abline(c(0, 1))
plot(out2$lower, out2a$overall$lower)
abline(c(0, 1))

#  subnational space-only model combining all periods
fit3 &lt;- smoothDirect(data = data, 
       time.model = NULL, Amat = DemoMap$Amat, 
   control.compute = list(config =TRUE))
out3 &lt;- getSmoothed(fit3)
out3a &lt;- getSmoothed(fit3, joint = TRUE, nsim = 1e5, save.draws = TRUE)
par(mfrow = c(1, 3))
plot(out3$median, out3a$overall$median)
abline(c(0, 1))
plot(out3$upper, out3a$overall$upper)
abline(c(0, 1))
plot(out3$lower#' , out3a$overall$lower)
abline(c(0, 1))

## End(Not run)

</code></pre>


</div>