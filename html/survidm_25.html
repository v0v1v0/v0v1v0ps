<div class="container">

<table style="width: 100%;"><tr>
<td>tprob</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nonparametric estimation of transition probabilities in
the illness-death model</h2>

<h3>Description</h3>

<p>This function is used to obtain nonparametric estimates of
the transition probabilities in the illness-death model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">tprob(
  formula,
  s,
  method = "AJ",
  conf = FALSE,
  conf.level = 0.95,
  conf.type = "log",
  n.boot = 199,
  data,
  z.value,
  bw = "dpik",
  window = "gaussian",
  method.weights = "NW",
  cluster = FALSE,
  ncores = NULL,
  na.rm = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A <code>formula</code> object, which must have a <code>survIDM</code>
object as the response on the left of the <code>~</code> operator and, if desired,
a term on the right. The term may be a qualitative or quantitative variable.
Without covariates, the right hand side should be <code>~ 1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p>The first time for obtaining estimates for the transition
probabilities. If missing, 0 will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>The method used to compute the transition probabilities.
Possible options are <code>"AJ"</code>, <code>"LIDA"</code> <code>"LM"</code>, <code>"PLM"</code>,
<code>"LMAJ"</code>, <code>"PLMAJ"</code>, <code>"PAJ"</code>, <code>"IPCW"</code> and <code>"breslow"</code>.
Defaults to <code>"AJ"</code>. The <code>"IPCW"</code> method
is recommended to obtain conditional transition probabilities (i.e., with a
quantitative term on the right hand side of formula). The <code>"breslow"</code> method
is based on a Cox's regression model (Cox, 1972) fitted marginally to each allowed
transition, with the corresponding baseline hazard function estimated by the
Breslow's method (Breslow, 1972).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf</code></td>
<td>
<p>Provides pointwise confidence bands. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>Level of confidence. Defaults to 0.95 (corresponding to 95%).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.type</code></td>
<td>
<p>Method to compute the confidence intervals. Depends on the
choice of the estimation method of the transition probabilities. For
Aalen-Johansen type estimators (<code>"AJ"</code>, <code>"LMAJ"</code>, <code>"PAJ"</code> and
<code>"PLMAJ"</code>) possible choices are <code>"linear"</code>, <code>"log"</code> and
<code>"log-log"</code>. Default method is <code>"log"</code>. The <code>"linear"</code> option provides
the standard intervals curve +-k *se(curve), where k is determined from <code>"conf.int"</code>.
The <code>"log"</code> option calculates the intervals based on the cumulative hazard or
-log(survival). The <code>"log-log"</code> option uses the log hazard function or
log(-log(survival)). For the remaining estimation methods (<code>"LIDA"</code>,
<code>"LM"</code>, <code>"PLM"</code>, <code>"IPCW"</code> and <code>"breslow"</code>) the percentile
bootstrap which resamples each datum with probability 1/n is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.boot</code></td>
<td>
<p>The number of bootstrap replicates to compute the variance
of the non-Markovian estimator. Default is 199.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data.frame including at least four columns named
<code>time1</code>, <code>event1</code>, <code>Stime</code> and <code>event</code>, which correspond
to disease free survival time, disease free survival indicator, time to death
or censoring, and death indicator, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z.value</code></td>
<td>
<p>The value of the covariate on the right hand side of formula
at which the transition probabilities are computed. For quantitative
covariates, i.e. of class integer and numeric.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bw</code></td>
<td>
<p>A single numeric value to compute a kernel density bandwidth.
Use <code>"dpik"</code> for the <span class="pkg">KernSmooth</span> package based selector or <code>"np"</code>
for the <code>'npudensbw'</code> function of the <span class="pkg">np</span> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>window</code></td>
<td>
<p>A character string specifying the desired kernel.
See details below for possible options. Defaults to <code>"gaussian"</code>
where the gaussian density kernel will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method.weights</code></td>
<td>
<p>A character string specifying the desired weights method.
Possible options are <code>"NW"</code> for the Nadaraya-Watson weights and <code>"LL"</code>
for local linear weights. Defaults to <code>"NW"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>A logical value. If <code>TRUE</code> (default), the bootstrap procedure
for the confidence intervals is parallelized. Note that there are
cases (e.g., a low number of bootstrap repetitions) that <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> will gain in
performance through serial computation. <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> takes time to distribute tasks
across the processors also it will need time for binding them all together
later on. Therefore, if the time for distributing and gathering pieces
together is greater than the time need for single-thread computing,
it does not worth parallelize.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>An integer value specifying the number of cores to be used in
the parallelized procedure. If <code>NULL</code> (default), the number of cores
to be used is equal to the number of cores of the machine - 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>A logical value indicating whether NA values should
be stripped in the computation.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Possible options for argument window are <code>"gaussian"</code>,
<code>"epanechnikov"</code>, <code>"tricube"</code>, <code>"boxcar"</code>,
<code>"triangular"</code>, <code>"quartic"</code> or <code>"cosine"</code>. The LIDA estimator
was labelled according to the acronym of the Lifetime Data Analysis journal
in which the estimator was described for the first time (Meira-Machado,
U?a-?lvarez and Cadarso-Su?rez, 2006).
</p>
<p>Possible methods are:
</p>

<ul>
<li>
<p><code>AJ</code> Aalen-Johansen estimator
</p>
</li>
<li>
<p><code>PAJ</code> Presmoothed Aalen-Johansen estimator
</p>
</li>
<li>
<p><code>LIDA</code> LIDA estimator
</p>
</li>
<li>
<p><code>LM</code> Landmark approach estimator
</p>
</li>
<li>
<p><code>PLM</code> Presmoothed Landmark approach estimator
</p>
</li>
<li>
<p><code>LMAJ</code> Landmark approach Aalen-Johansen estimator
</p>
</li>
<li>
<p><code>PLDAJ</code> Presmoothed Landmark approach Aalen-Johansen estimator
</p>
</li>
<li>
<p><code>tpIPCW</code> Inverse Probability of Censoring Weighting for Transition Probabilities
</p>
</li>
<li>
<p><code>tpBreslow</code> Breslow method
</p>
</li>
</ul>
<h3>Value</h3>

<p>An object of class <code>"survIDM"</code> and one of the following
five classes: <code>"AJ"</code>, <code>"LIDA"</code>, <code>"LM"</code>, <code>"PLM"</code>,
<code>"LMAJ"</code>, <code>"PLMAJ"</code>, <code>"PAJ"</code>,
<code>"tpIPCW"</code> and <code>"tpBreslow"</code>. Objects are implemented as a list with elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>est</code></td>
<td>
<p>data.frame with estimates of the transition probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI</code></td>
<td>
<p>data.frame with the confidence intervals of the transition probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>Level of confidence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p>The first time for obtaining estimates for the transition probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>
<p>The time for obtaining the estimates of transition probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf</code></td>
<td>
<p>logical; if <code>FALSE</code> (default) the pointwise confidence
bands are not given.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.type</code></td>
<td>
<p>Type of the confidence interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>callp</code></td>
<td>
<p>The expression of the estimated probability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Nlevels</code></td>
<td>
<p>The number of levels of the covariate. Provides important
information when the covariate at the right hand side of formula
is of class factor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>levels</code></td>
<td>
<p>The levels of the qualitative covariate
(if it is of class factor) on the right hand side of formula.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A formula object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>A call object.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Luis Meira-Machado, Marta Sestelo and Gustavo Soutinho.
</p>


<h3>References</h3>

<p>Aalen O. O., Johansen S. (1978) An Empirical Transition Matrix for
Nonhomogeneous Markov Chains Based on Censored Observations. Scandinavian
Journal of Statistics 5(3), 141–150.
</p>
<p>Meira-Machado L. F., de Una-Alvarez J. and Cadarso-Suarez C. (2006).
Nonparametric estimation of transition probabilities in a non-Markov
illness-death model. Lifetime Data Anal 12(3), 325–344.
</p>
<p>de Una-Alvarez J. and Meira-Machado L. (2015). Nonparametric estimation
of transition probabilities in a non-Markov illness-death model:
a comparative study. Biometrics 71, 364–375.
</p>
<p>Cox, DR (1972). Regression models and life tables (with discussion). Journal
of the Royal Statistical Society, Series B 34, 187-200.
</p>
<p>Breslow, N. (1972). Discussion of paper by dr cox. Journal of Royal Statistical
Society, Series B 34, 216-217.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Aalen-Johansen
res &lt;- tprob(survIDM(time1, event1, Stime, event) ~ 1, s = 0,
method = "AJ", conf = FALSE, data = colonIDM)
summary(res, time=365*1:6)
plot(res)
# Transition Probabilities Pij(t)=Pij(365,t)
# LIDA
res1 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ 1, s = 365,
             method = "LIDA", conf = FALSE, data = colonIDM)

summary(res1, time=365*1:6)
plot(res1)
plot(res1, trans="01", ylim=c(0,0.15))
# Landmark (LM)
res2 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ 1, s = 365,
              method = "LM", conf = FALSE, data = colonIDM)
summary(res2, time=365*1:6)
plot(res2)
# Presmoothed LM
res3 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ 1, s = 365,
              method = "PLM", conf = TRUE, data = colonIDM)
summary(res3, time=365*1:6)
autoplot(res3, interactive = TRUE)
# Conditional transition probabilities
# With factor
res4 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ factor(sex), s = 365,
              method = "AJ", conf = TRUE, data = colonIDM)
summary(res4, time=365*1:6)
plot(res4, trans="02", ylim=c(0,0.5))
res5 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ rx, s =365,
              method = "breslow", z.value='Lev', conf = TRUE, data =colonIDM)
summary(res5, time=365*1:6)
plot(res5,trans="02", ylim=c(0,0.5))
# with continuous covariate (IPCW and Breslow Method)
res6 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ age, s = 365,
              method = "IPCW", z.value = 48, conf = FALSE, data = colonIDM,
              bw = "dpik", window = "gaussian", method.weights = "NW")
summary(res6, time=365*1:6)
plot(res6)
res7 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ age, s =365,
              method = "breslow", z.value=60, conf = FALSE, data =colonIDM)
summary(res7, time=365*1:6)
autoplot(res7, interactive=TRUE)
res8 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ age, s =365,
              method = "breslow", conf.type='bootstrap', z.value=60, conf = TRUE, data =colonIDM)
summary(res8, time=365*1:6)
plot(res8)
res9 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ rx, s =365,
              method = "breslow", conf.type='bootstrap',  conf = TRUE, data =colonIDM)
summary(res9, time=365*1:6)
plot(res9, trans="02", ylim=c(0,0.5))
# more than a covariate (Breslow Method)
res10&lt;- tprob(survIDM(time1, event1, Stime, event) ~ nodes + factor(rx), s =365,
              method = "breslow", conf = TRUE, data =colonIDM)
summary(res10,t=365*1:5)
autoplot(res10)
res11&lt;- tprob(survIDM(time1, event1, Stime, event) ~ nodes + factor(rx), s =365,
              method = "breslow", z.value=c(10,'Obs'), conf = TRUE, data =colonIDM)
summary(res11,t=365*1:5)
autoplot(res11)
# more than a covariate for Non Linear Models (Breslow Method)
res12&lt;- tprob(survIDM(time1, event1, Stime, event) ~ pspline(age)+ nodes + factor(rx), s =365,
              method = "breslow", conf = TRUE, data =colonIDM)
summary(res12,t=365*1:5)
autoplot(res12)
# Confidence intervals
res13 &lt;- tprob(survIDM(time1, event1, Stime, event) ~ 1, s = 365,
               method = "AJ", conf = TRUE, n.boot = 5, conf.level = 0.95,
               conf.type = "log", data = colonIDM)
summary(res13, time=365*1:7)
autoplot(res13)

## End(Not run)
</code></pre>


</div>