<div class="container">

<table style="width: 100%;"><tr>
<td>utility.gen</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Distributional comparison of synthesised and observed data</h2>

<h3>Description</h3>

<p>Distributional comparison of synthesised data set with the original (observed) 
data set using propensity scores.
</p>
<p>This function can be also used with synthetic data NOT created by 
<code>syn()</code>, but then additional parameters <code>not.synthesised</code> 
and <code>cont.na</code> might need to be provided.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'synds'
utility.gen(object, data, 
            method = "cart", maxorder = 1, k.syn = FALSE, tree.method = "rpart",
            max.params = 400, print.stats = c("pMSE", "S_pMSE"), resamp.method = NULL, 
            nperms = 50, cp = 1e-3, minbucket = 5, mincriterion = 0, vars = NULL, 
            aggregate = FALSE, maxit = 200, ngroups = NULL, print.flag = TRUE,
            print.every = 10, digits = 6, print.zscores = FALSE, zthresh = 1.6,
            print.ind.results = FALSE, print.variable.importance = FALSE, ...)

## S3 method for class 'data.frame'
utility.gen(object, data, not.synthesised = NULL, cont.na = NULL, 
            method = "cart", maxorder = 1, k.syn = FALSE, tree.method = "rpart",
            max.params = 400, print.stats = c("pMSE", "S_pMSE"), resamp.method = NULL, 
            nperms = 50, cp = 1e-3, minbucket = 5, mincriterion = 0, vars = NULL, 
            aggregate = FALSE, maxit = 200, ngroups = NULL, print.flag = TRUE,
            print.every = 10, digits = 6, print.zscores = FALSE, zthresh = 1.6,
            print.ind.results = FALSE, print.variable.importance = FALSE, ...)

## S3 method for class 'list'
utility.gen(object, data, not.synthesised = NULL, cont.na = NULL, 
            method = "cart", maxorder = 1, k.syn = FALSE, tree.method = "rpart",
            max.params = 400, print.stats = c("pMSE", "S_pMSE"), resamp.method = NULL, 
            nperms = 50, cp = 1e-3, minbucket = 5, mincriterion = 0, vars = NULL, 
            aggregate = FALSE, maxit = 200, ngroups = NULL, print.flag = TRUE,
            print.every = 10, digits = 6, print.zscores = FALSE, zthresh = 1.6,
            print.ind.results = FALSE, print.variable.importance = FALSE, ...)


## S3 method for class 'utility.gen'
print(x, digits = NULL, zthresh = NULL, 
               print.zscores = NULL, print.stats = NULL,
               print.ind.results = NULL, print.variable.importance = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>it can be an object of class <code>synds</code>, which stands for 
'synthesised data set'. It is typically created by function <code>syn()</code> 
and it includes <code>object$m</code> synthesised data set(s) as <code>object$syn</code>. 
This a single data set when <code>object$m = 1</code> or a list of length 
<code>object$m</code> when <code>object$m &gt; 1</code>. Alternatively, when data are 
synthesised not using <code>syn()</code>, it can be a data frame with a synthetic 
data set or a list of data frames with synthetic data sets, all created from 
the same original data with the same variables and the same method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the original (observed) data set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>not.synthesised</code></td>
<td>
<p>a vector of variable names for any variables that has 
been left unchanged in the synthetic data. Not required if oject is of 
class <code>synds</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cont.na</code></td>
<td>
<p>a named list of codes for missing values for continuous
variables if different from the <code>R</code> missing data code <code>NA</code>.
The names of the list elements must correspond to the variables names for 
which the missing data codes need to be specified. Not required if oject is
of class <code>synds</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a single string specifying the method for modeling the propensity 
scores. Method can be selected from <code>"logit"</code> and <code>"cart"</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxorder</code></td>
<td>
<p>maximum order of interactions to be considered in 
<code>"logit"</code> method. For model without interactions <code>0</code> should be
provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k.syn</code></td>
<td>
<p>a logical indicator as to whether the sample size itself has 
been synthesised.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tree.method</code></td>
<td>
<p>implementation of <code>"cart"</code> method that is used when 
<code>method = "cart"</code>. It can be <code>"rpart"</code> or <code>"ctree"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.params</code></td>
<td>
<p>the maximum number of parameters for a <code>"logit"</code> model 
which alerts the user to possible fitting failure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.stats</code></td>
<td>
<p>statistics to be printed must be a selection from
<code>"pMSE"</code>, <code>"SPECKS"</code>, <code>"PO50"</code>, <code>"S_pMSE"</code>, 
<code>"S_SPECKS"</code>, <code>"S_PO50"</code>. If <code>print.stats = "all"</code>, 
all of the measures mentioned above will be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resamp.method</code></td>
<td>
<p>method used for resampling estimates of standardized 
measures can be <code>"perm"</code>, <code>"pairs"</code> or <code>"none"</code>.  
Defaults to <code>"pairs"</code> if <code>print.stats</code> includes <code>"S_SPECKS"</code> 
or <code>"S_PO50"</code> or synthesis is incomplete else defaults to <code>"perm"</code>
if method is <code>"cart"</code> or to <code>NULL</code>, no resampling needed, 
if method is <code>"logit"</code>. <code>"none"</code> can be used to get results 
without standardized measures e.g. in simulations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperms</code></td>
<td>
<p>number of permutations for the permutation test to obtain the 
null distribution of the utility measure when <code>resamp.method = "perm"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cp</code></td>
<td>
<p>complexity parameter for classification with tree.method 
<code>"rpart"</code>. Small values grow bigger trees.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minbucket</code></td>
<td>
<p>minimum number of observations allowed in a leaf for 
classification when <code>method = "cart"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mincriterion</code></td>
<td>
<p>criterion between 0 and 1 to use to control 
<code>tree.method = "ctree"</code> when the tree will not be allowed to split 
further. A value of <code>0.95</code> would be equivalent to a <code>5%</code> 
significance test. Here we set it to <code>0</code> to effectively disable this 
test and grow large trees.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>variables to be included in the utility comparison. It can be 
a character vector of names of variables or an integer vector of their 
column indices. If none are specified all the variables in the synthesised 
data will be included.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate</code></td>
<td>
<p>logical flag as to whether the data should be aggregated by 
collapsing identical rows before computation. This can lead to much faster 
computation when all the variables are categorical. Only works for 
<code>method = "logit"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>maximum iterations to use when <code>method = "logit"</code>. If the 
model does not converge in this number a warning will suggest increasing 
it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ngroups</code></td>
<td>
<p>target number of groups for categorisation of each numeric 
variable: final number may differ if there are many repeated values. If 
<code>NULL</code> (default) variables are not categorised into groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.flag</code></td>
<td>
<p>TRUE/FALSE to indicate if any messages should 
be printed during calculations. Change to FALSE for simulations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.every</code></td>
<td>
<p>controls the printing of progress of resampling when  
<code>resamp.method</code> is not <code>NULL</code>. When <code>print.every = 0</code> 
no progress is reported, otherwise the resample number is printed every 
<code>print.every</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional parameters passed to <code>glm</code>,
<code>rpart</code>, or <code>ctree</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an object of class <code>utility.gen</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>number of digits to print in the default output values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zthresh</code></td>
<td>
<p>threshold value to use to suppress the printing of z-scores 
under <code>+</code>/<code>-</code> this value for <code>method = "logit"</code>. If set to 
<code>NA</code> all z-scores are printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.zscores</code></td>
<td>
<p>logical value as to whether z-scores for coefficients of 
the logit model should be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.ind.results</code></td>
<td>
<p>logical value as to whether utility score results 
from individual syntheses should be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.variable.importance</code></td>
<td>
<p>logical value as to whether the variable 
importance measure should be printed when <code>tree.method = "rpart"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function follows the method for evaluating the utility of masked data 
as given in Snoke et al. (2018) and originally proposed by Woo et al. 
(2009). The original and synthetic data are combined into one dataset and 
propensity scores, as detailed in Rosenbaum and Rubin (1983), are calculated 
to estimate the probability of membership in the synthetic data set.
The utility measure is based on the mean squared difference between these 
probabilities and the probability expected if the data did not distinguish 
the synthetic data from the original. 
</p>
<p>If <code>k.syn = FALSE</code> the expected probability is just the proportion of 
synthetic data in the combined data set, <code>0.5</code> when the original and 
synthetic data have the same number of records. Setting <code>k.syn = TRUE</code> 
indicates that the numbers of observations in the synthetic data was 
synthesised and not fixed by the synthesiser. In this case the expected 
probability will be <code>0.5</code> in all cases and the model to discriminate
between observed and synthetic will include an intercept term. This will 
usually only apply when the standalone version of this function 
<code>utility.gen.sa()</code> is used.
</p>
<p>Propensity scores can be modeled by logistic regression <code>method = "logit"</code> 
or by two different implementations of classification and regression trees as 
method <code>"cart"</code>. For logistic regression the predictors are all variables 
in the data and their interactions up to order <code>maxorder</code>. The default of 
<code>1</code> gives all main effects and first order interactions. For logistic 
regression the null distribution of the propensity score is derived and is 
used to calculate ratios and standardised values.
</p>
<p>For <code>method = "cart"</code> the expectation and variance of the null 
distribution is calculated from a permutation test. Our recent work
indicates that this method can sometimes give misleading results.
</p>
<p>If missing values exist, indicator variables are added and included in the 
model as recommended by Rosenbaum and Rubin (1984). For categorical variables, 
<code>NA</code> is treated as a new category.</p>


<h3>Value</h3>

<p>An object of class <code>utility.gen</code> which is a list including the utility 
measures their expected null values for each synthetic set with the following 
components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the call that produced the result.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>number of synthetic data sets in object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>method used to fit propensity score.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tree.method</code></td>
<td>
<p>cart function used to fit propensity score when 
<code>method = "cart"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resamp.method</code></td>
<td>
<p>type of resampling used to get <code>pMSEExp</code> and 
<code>pval</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxorder</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfix</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ngroups</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>degrees of freedom for the chi-squared test for logit models
derived from the number of non-aliased coefficients in the logistic model, 
minus <code>1</code> for <code>k.syn = FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mincriterion </code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperms</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>incomplete</code></td>
<td>
<p>TRUE/FALSE indicator if any of the variables being compared 
are not synthesised.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pMSE</code></td>
<td>
<p>propensity score mean square error from the utility model or a  
vector of these values if <code>object$m &gt; 1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_pMSE</code></td>
<td>
<p>ratio(s) of <code>pMSE</code> to its Null expectation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PO50</code></td>
<td>
<p>percentage  over 50% of each synthetic data set where the model 
used correctly predicts whether real or synthetic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_PO50</code></td>
<td>
<p>ratio(s) of <code>PO50</code> to its Null expectation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SPECKS</code></td>
<td>
<p>Kolmogorov-Smirnov statistic to compare the propensity scores  
for the original and synthetic records.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_SPECKS</code></td>
<td>
<p>ratio(s) of <code>SPECKS</code> to its Null expectation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.stats</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>the fitted model for the propensity score or a list of fitted 
models of length <code>m</code> if <code>m &gt; 0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nosplits</code></td>
<td>
<p>for resampling methods and cart models, a list of the number
of times from the total each resampled cart model failed to select any 
splits to classify the indicator. Indicates that this method is not working 
correctly and results should not be used but a logit model selected instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.ind.results</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.zscores</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zthresh</code></td>
<td>
<p>see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.variable.importance</code></td>
<td>
<p>see above.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Woo, M-J., Reiter, J.P., Oganian, A. and Karr, A.F. (2009). Global measures 
of data utility for microdata masked for disclosure limitation. 
<em>Journal of Privacy and Confidentiality</em>, <b>1</b>(1), 111-124.
</p>
<p>Rosenbaum, P.R. and Rubin, D.B. (1984). Reducing bias in observational 
studies using subclassification on the propensity score.
<em>Journal of the American Statistical Association</em>,
<b>79</b>(387), 516-524.
</p>
<p>Snoke, J., Raab, G.M., Nowok, B., Dibben, C. and Slavkovic, A. (2018). 
General and specific utility measures for synthetic data. 
<em>Journal of the Royal Statistical Society: Series A</em>, <b>181</b>, 
Part 3, 663-688.
</p>


<h3>See Also</h3>

<p><code>utility.tab</code>    
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
  ods &lt;- SD2011[1:1000, c("age", "bmi", "depress", "alcabuse", "nofriend")]
  s1 &lt;- syn(ods, m = 5, method = "parametric", 
            cont.na = list(nofriend = -8))
    
  ### synthetic data provided as a 'synds' object   
  u1 &lt;- utility.gen(s1, ods)
  print(u1, print.zscores = TRUE, zthresh = 1, digits = 6)
  u2 &lt;- utility.gen(s1, ods, ngroups = 3, print.flag = FALSE)
  print(u2, print.zscores = TRUE)
  u3 &lt;- utility.gen(s1, ods, method = "cart", nperms = 20)
  print(u3, print.variable.importance = TRUE)
    
  ### synthetic data provided as 'list'
  utility.gen(s1$syn, ods, cont.na = list(nofriend = -8))  
  
## End(Not run)
</code></pre>


</div>