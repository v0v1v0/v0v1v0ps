<div class="container">

<table style="width: 100%;"><tr>
<td>ss3sim_base</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Base wrapper function to run an ss3sim simulation</h2>

<h3>Description</h3>

<p>This function is a wrapper function that can call <code>run_ss3model</code>
for the operating model, sample the output (add recruitment deviations,
survey the data, etc.), and run the estimation model. <code>ss3sim_base</code> is
the main internal function for <span class="pkg">ss3sim</span>. It is intended to be used
through <code>run_ss3sim</code>, but can also be used directly.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ss3sim_base(iterations, scenarios, f_params, index_params, lcomp_params,
  agecomp_params, calcomp_params = NULL, wtatage_params = NULL,
  mlacomp_params = NULL, em_binning_params = NULL,
  estim_params = NULL, tv_params = NULL, operat_params = NULL,
  om_dir, em_dir, retro_params = NULL, data_params = NULL,
  user_recdevs = NULL, user_recdevs_warn = TRUE, bias_adjust = FALSE,
  hess_always = FALSE, print_logfile = TRUE, sleep = 0, seed = 21,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>iterations</code></td>
<td>
<p>Which iterations to run. A numeric vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scenarios</code></td>
<td>
<p>Which scenarios to run.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f_params</code></td>
<td>
<p>A named list containing arguments for <code>change_f</code>.
A mandatory case.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index_params</code></td>
<td>
<p>A named list containing arguments for
<code>sample_index</code>. A mandatory case.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lcomp_params</code></td>
<td>
<p>A named list containing arguments for
<code>sample_lcomp</code>. A mandatory case.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>agecomp_params</code></td>
<td>
<p>A named list containing arguments for
<code>sample_agecomp</code>. A mandatory case.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calcomp_params</code></td>
<td>
<p>A named list containing arguments for
<code>sample_calcomp</code>, for conditional age-at-length data.
Currently CAL is not implemented in this version of ss3sim,
so calcomp_params should be NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wtatage_params</code></td>
<td>
<p>A named list containing arguments for
<code>sample_wtatage</code>, for empirical weight-at-age data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mlacomp_params</code></td>
<td>
<p>A named list containing arguments for
<code>sample_mlacomp</code>, for mean length-at-age data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>em_binning_params</code></td>
<td>
<p>A named list containing arguments for
<code>change_em_binning</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estim_params</code></td>
<td>
<p>A named list containing arguments for
<code>change_e</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tv_params</code></td>
<td>
<p>A named list containing arguments for
<code>change_tv</code> (time-varying).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>operat_params</code></td>
<td>
<p>A named list containing arguments for <code>change_o</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>om_dir</code></td>
<td>
<p>The directory with the operating model you want to copy and use
for the specified simulations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>em_dir</code></td>
<td>
<p>The directory with the estimation model you want to copy and
use for the specified simulations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>retro_params</code></td>
<td>
<p>A named list containing arguments for
<code>change_retro</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_params</code></td>
<td>
<p>A named list containing arguments for
<code>change_data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>user_recdevs</code></td>
<td>
<p>An optional matrix of recruitment deviations to replace
the recruitment deviations built into the package. The columns represent
run iterations and the rows represent years. <code>user_recdevs</code> can be a
matrix of 0s for deterministic model checking. For traditional stochastic
simulations these would be independent and normally distributed deviations
with a standard deviation equal to the desired sigma R. Note that these
recruitment deviations will be used verbatim (after exponentiation).
<code>user_recdevs</code> will *not* be multiplied by sigma R and they will *not*
be log-normal bias corrected. If <code>user_recdevs</code> are specified as
anything besides <code>NULL</code> the package will issue a warning about this.
Biased recruitment deviations can lead to biased model results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>user_recdevs_warn</code></td>
<td>
<p>A logical argument allowing users to turn the
warning regarding biased recruitment deviations off when <code>user_recdevs</code>
are specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bias_adjust</code></td>
<td>
<p>Run bias adjustment first?.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hess_always</code></td>
<td>
<p>If <code>TRUE</code> then the Hessian will always be calculated.
If <code>FALSE</code> then the Hessian will only be calculated for
bias-adjustment runs thereby saving time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print_logfile</code></td>
<td>
<p>Logical. Print a log file?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sleep</code></td>
<td>
<p>A time interval (in seconds) to pause on each iteration. Useful
if you want to reduce average CPU time â€“ perhaps because you're working on
a shared server.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>The seed value to pass to <code>get_recdevs</code> when
generating recruitment deviations. The generated recruitment deviations
depend on the iteration value, but also on the value of <code>seed</code>. A
given combination of iteration, number of years, and <code>seed</code> value will
result in the same recruitment deviations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Anything extra to pass to <code>run_ss3model</code>. For
example, you may want to pass additional options to <code>SS3</code> through
the argument <code>admb_options</code>. Anything that doesn't match a named
argument in <code>run_ss3model</code> will be passed to the
<code>system</code> call that runs <code>SS3</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is written to be flexible. You can specify the fishing
mortality, survey index, length composition, age composition, and
time-varying parameters in the function call as list objects (see the
example below). For a generic higher-level function, see
<code>run_ss3sim</code>.
</p>


<h3>Value</h3>

<p>The output will appear in whatever your current <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> working directory
is. There will be folders named after your scenarios. They will
look like this:
</p>

<ul>
<li> <p><code>D0-F0-cod/1/om</code>
</p>
</li>
<li> <p><code>D0-F0-cod/1/em</code>
</p>
</li>
<li> <p><code>D0-F0-cod/2/om</code>
</p>
</li>
<li>
<p> ...
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Sean Anderson with contributions from many others as listed in
the DESCRIPTION file.
</p>


<h3>See Also</h3>

<p><code>run_ss3sim</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Create a temporary folder for the output and set the working directory:
  # Create a temporary folder for the output and set the working directory:
  temp_path &lt;- file.path(tempdir(), "ss3sim-base-example")
  dir.create(temp_path, showWarnings = FALSE)
  wd &lt;- getwd()
  setwd(temp_path)
  on.exit(setwd(wd), add = TRUE)

  # Find the data in the ss3sim package:
  d &lt;- system.file("extdata", package = "ss3sim")
  om &lt;- file.path(d, "models", "cod-om")
  em &lt;- file.path(d, "models", "cod-em")
  case_folder &lt;- file.path(d, "eg-cases")

  # Pull in file paths from the package example data:
  d &lt;- system.file("extdata", package = "ss3sim")
  om_dir &lt;- file.path(d, "models", "cod-om")
  em_dir &lt;- file.path(d, "models", "cod-em")
  a &lt;- get_caseargs(folder = file.path(d, "eg-cases"),
                    case_files = list(F = "F",
                                      D = c("index", "lcomp", "agecomp"),
                                      E = "E"),
                    scenario = "F0-D0-E0-cod")
  ss3sim_base(iterations = 1,
              scenarios = "F0-D0-E0-cod",
              f_params = a$F,
              index_params = a$index,
              lcomp_params = a$lcomp,
              agecomp_params = a$agecomp,
              tv_params = a$tv_params,
              estim_params = a$E,
              om_dir = om_dir,
              em_dir = em_dir)
  unlink("F0-D0-E0-cod", recursive = TRUE) # clean up

  # Or, create the argument lists directly in R and skip the case file setup:

  F0 &lt;- list(years = 1:100,
             fisheries = 1,
             fvals = c(rep(0, 25), rep(0.114, 75)))

  index1 &lt;- list(fleets = 2, years = list(seq(62, 100, by = 2)),
                 sds_obs = list(0.1))

  lcomp1 &lt;- list(fleets = c(1, 2), Nsamp = list(100, 100),
                 years = list(26:100, seq(62, 100, by = 2)),
                 lengthbin_vector = NULL, cpar = c(1, 1))

  agecomp1 &lt;- list(fleets = c(1, 2), Nsamp = list(100, 100),
                   years = list(26:100, seq(62, 100, by = 2)),
                   agebin_vector = NULL, cpar = c(1, 1))

  E0 &lt;- list(natM_type = NULL, natM_n_breakpoints = NULL, natM_lorenzen = NULL,
             natM_val = NULL,
             par_name = c("LnQ_base_Fishery", "NatM_p_1_Fem_GP_1"),
             par_int = c(NA, NA), par_phase = c(-1, -1), forecast_num = 0)

  ss3sim_base(iterations = 1,
              scenarios = "D1-E0-F0-cod", #name as desired
              f_params = F0,
              index_params = index1,
              lcomp_params = lcomp1,
              agecomp_params = agecomp1,
              estim_params = E0,
              om_dir = om,
              em_dir = em)

  unlink("D1-E0-F0-cod", recursive = TRUE) # clean up

## End(Not run)
</code></pre>


</div>