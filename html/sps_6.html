<div class="container">

<table style="width: 100%;"><tr>
<td>prop_allocation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Construct a proportional allocation</h2>

<h3>Description</h3>

<p>Generate a proportional-to-size allocation for stratified sampling.
</p>


<h3>Usage</h3>

<pre><code class="language-R">prop_allocation(
  x,
  n,
  strata,
  initial = 0L,
  divisor = function(a) a + 1,
  ties = c("largest", "first")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A positive and finite numeric vector of sizes for units in the
population (e.g., revenue for drawing a sample of businesses).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>A positive integer giving the sample size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata</code></td>
<td>
<p>A factor, or something that can be coerced into one, giving
the strata associated with units in the population. The default is to place
all units into a single stratum.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial</code></td>
<td>
<p>A positive integer vector giving the initial (or minimal)
allocation for each stratum, ordered according to the levels of
<code>strata</code>. A single integer is recycled for each stratum using a special
algorithm to ensure a feasible allocation; see details. Non-integers are
truncated towards 0. The default allows for no units to be allocated to a
stratum.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>divisor</code></td>
<td>
<p>A divisor function for the divisor (highest-averages)
apportionment method. The default uses the Jefferson (D'Hondt) method. See
details for other possible functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ties</code></td>
<td>
<p>Either 'largest' to break ties in favor of the stratum with the
largest size, or 'first' to break ties in favor of the ordering of
<code>strata</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>prop_allocation()</code> function gives a sample size for each level in
<code>strata</code> that is proportional to the sum of <code>x</code> across strata and
adds up to <code>n</code>. This is done using the divisor (highest-averages)
apportionment method (Balinksi and Young, 1982, Appendix A), for which there
are a number of different divisor functions:
</p>

<dl>
<dt>Jefferson/D'Hondt</dt>
<dd>
<p><code style="white-space: pre;">⁠\(a) a + 1⁠</code></p>
</dd>
<dt>Webster/Sainte-Laguë</dt>
<dd>
<p><code style="white-space: pre;">⁠\(a) a + 0.5⁠</code></p>
</dd>
<dt>Imperiali</dt>
<dd>
<p><code style="white-space: pre;">⁠\(a) a + 2⁠</code></p>
</dd>
<dt>Huntington-Hill</dt>
<dd>
<p><code style="white-space: pre;">⁠\(a) sqrt(a * (a + 1))⁠</code></p>
</dd>
<dt>Danish</dt>
<dd>
<p><code style="white-space: pre;">⁠\(a) a + 1 / 3⁠</code></p>
</dd>
<dt>Adams</dt>
<dd>
<p><code style="white-space: pre;">⁠\(a) a⁠</code></p>
</dd>
<dt>Dean</dt>
<dd>
<p><code style="white-space: pre;">⁠\(a) a * (a + 1) / (a + 0.5)⁠</code></p>
</dd>
</dl>
<p>Note that a divisor function with <code class="reqn">d(0) = 0</code> (i.e., Huntington-Hill,
Adams, Dean) should have an initial allocation of at least 1 for all strata.
In all cases, ties are broken according to the sum of <code>x</code> if
<code>ties = 'largest'</code>; otherwise, if <code>ties = 'first'</code>, then ties are broken
according to the levels of <code>strata</code>.
</p>
<p>In cases where the number of units with non-zero size in a stratum is
smaller than its allocation, the allocation for that stratum is set to the
number of available units, with the remaining sample size reallocated to
other strata proportional to <code>x</code>. This is similar to <code>PROC
SURVEYSELECT</code> in SAS with <code>ALLOC = PROPORTIONAL</code>.
</p>
<p>Passing a single integer for the initial allocation first checks that
recycling this value for each stratum does not result in an allocation
larger than the sample size. If it does, then the value is reduced so that
recycling does not exceed the sample size. This recycled vector can be
further reduced in cases where it exceeds the number of units in a stratum,
the result of which is the initial allocation. This special recycling
ensures that the initial allocation is feasible.
</p>


<h3>Value</h3>

<p>A named integer vector of sample sizes for each stratum in <code>strata</code>.
</p>


<h3>References</h3>

<p>Balinksi, M. L. and Young, H. P. (1982).
<em>Fair Representation: Meeting the Ideal of One Man, One Vote</em>.
Yale University Press.
</p>


<h3>See Also</h3>

<p><code>sps()</code> for stratified sequential Poisson sampling.
</p>
<p><code>expected_coverage()</code> to calculate the expected number of strata in a sample
without stratification.
</p>
<p><code>strAlloc()</code> in the <span class="pkg">PracTools</span> package for other allocation methods.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Make a population with units of different size
x &lt;- c(rep(1:9, each = 3), 100, 100, 100)

# ... and 10 strata
s &lt;- rep(letters[1:10], each = 3)

# Generate an allocation
prop_allocation(x, 15, s, initial = 1)

</code></pre>


</div>