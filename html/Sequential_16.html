<div class="container">

<table style="width: 100%;"><tr>
<td>Performance.AlphaSpend.CondPoisson</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculates performance and signaling thresholds for user-defined alpha spending for sequential analysis with conditional Poisson data.</h2>

<h3>Description</h3>

<p>The function <code>Performance.AlphaSpend.CondPoisson</code> calculates power, expected time to signal and signaling threshold (critical values) associated to any user-specified alpha spending, flat or non-flat, for continuous or group sequential analysis with conditional Poisson data,
all for a pre-specified upper limit on the sample size.</p>


<h3>Usage</h3>

<pre><code class="language-R">Performance.AlphaSpend.CondPoisson(K,cc,alpha,AlphaSpend="n",
GroupSizes="n",rho=0.5,gamma="n",Tailed="upper",RR)
      </code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>The upper limit on the sample size (length of surveillance) expressed in terms of the number of events arriving in the surveillance period. There is no default value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cc</code></td>
<td>
<p>Number of events observed in the historical period. There is no default value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>The overall significance level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AlphaSpend</code></td>
<td>
<p>A vector with the cummulative Type I error probabiliy to be spent up to each test. Alternatively, one can use an integer between 1 to 4. There is no default value. See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>GroupSizes</code></td>
<td>
<p>Test-specific number of events between two looks at the data for group or continuous sequential analysis. There is no default value. See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>Positive number used for the power-type alpha spending function (<code>AlphaSpend=1</code>) only. The default value is "rho=0.5". See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>Positive number used for the gamma-type alpha spending function (<code>AlphaSpend=4</code>) only. There is no default value. See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tailed</code></td>
<td>
<p>Tailed="upper" (default) for H0:RR&lt;=1, and Tailed="lower" for H0:RR&gt;=1 or Tailed="two" for H0:RR=1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RR</code></td>
<td>
<p>Vector of relative risks for performance calculation. There is no default value.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For continuous and group sequential analysis based on monitoring Poisson data conditioned on matched
historical Poisson data, the threshold impplied by user-specified alpha spending is calculated with
<code>Performance.AlphaSpend.CondPoisson</code>. The function delivers the threshold in two scales, the the Conditional Maximized Sequential
Probability Ratio Test statistic (CMaxSPRT) scale (Li and Kulldorff, 2010), and the surveillance versus historical person-time ratio (Silva et al., 2019a).
For the CMaxSPRT scale, the null hypothesis is rejected if the test statistic exceeds the critical value at some test. Regarding the person-time ratio scale,
using the notation by Silva et al. (2019a) and Silva et al. (2019b), let <code class="reqn">V</code> denote the
total person-time from the historical data, where <code>cc</code> events were observed, and let <code class="reqn">P_{k(i)}</code> denote the the cummulative
person-time from the surveillance data at the i-th test with a cummulative <code class="reqn">k(i)</code> events. Suppose that for
a three-group sequential plan, with sample sizes of 20, 15, 25, the critival values were 0.1, 0.5, and 1. This way, H0 is rejected if: <code class="reqn">P_20/V</code> &lt;= 0.1 in the first test,
or <code class="reqn">P_35/V</code> &lt;= 0.5 in the second test, or <code class="reqn">P_60/V</code> &lt;= 1 in the third test. 
</p>
<p><code>AlphaSpend</code> is used for arbitrary cumulative type I error probability spending defined by the user.
Alternatively, the user can select among one of the four classical alpha spending shapes bellow:<br><code class="reqn">F_{1}(t)=\alpha t^{\rho}</code>, where <code class="reqn">\rho&gt;0</code>,<br><code class="reqn">F_{2}(t)=2-2\Phi(x_{\alpha}\sqrt{t^{-1}})</code>, where <code class="reqn">x_{\alpha}=\Phi^{-1}(1-\alpha/2)</code>,<br><code class="reqn">F_{3}(t)= \alpha \times log(1+[exp{1}-1]\times t) </code>,<br><code class="reqn">F_{4}(t)=\alpha[1-exp(-t\gamma)]/[1-exp(-\gamma)]</code> with <code class="reqn">\gamma \in \Re</code>,<br>
and <code class="reqn">t</code> represents a fraction of the maximum length of surveillance. For more details on these alpha spending choices,
see the paper by Silva et al. (2019c), Section 2.6.
</p>
<p>To select one of the four alpha spending types above, and using an integer <code class="reqn">i</code> to indicate the type among
<code class="reqn">i=</code> 1, 2, 3, and 4, for <code class="reqn">F_{1}(t)</code>, <code class="reqn">F_{2}(t)</code>, <code class="reqn">F_{3}(t)</code> and <code class="reqn">F_{4}(t)</code>, respectively,
one needs to set <code>AlphaSpend=i</code>. Specifically for <code>AlphaSpend=1</code>, it is necessary to choose a <code>rho</code> value,
or a <code>gamma</code> value if  <code>AlphaSpend=4</code> is used.
</p>
<p>With <code>GroupSizes</code> the user informs the sample size of each test in the scale of the
number of events in the surveillance period. Therefore, only positive
numbers are accepted in <code>GroupSizes</code>. For irregular group sizes, a vector must be informed
with each test-specific number of events between two looks at the data, therefore the entries of
<code>GroupSizes</code> must sums up <code>K</code>. For regular group sizes, a single number can be informed
for the constant sample size of each test. For example, for continuous sequential analysis,
<code>GroupSizes=1</code>. For ten-group sequential analysis with <code>K=50</code>, <code>GroupSizes=5</code>. 
</p>
<p>For <code>RR</code> the user must specify the target relative risks for calculation of statistical performance measures.
It can be a vector of positive numbers or a single number. 
</p>
<p>For details on the calculation of signaling thresholds and alpha spending for Poisson data conditioned to historical data,
see the papers by Silva et al. (2019a) and Silva et al. (2019b), respectively.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>CV</code></td>
<td>
<p>Signaling threshold in the scale of CMaxSPRT associated to the user-specified alpha spending.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Person-timeRatioH0</code></td>
<td>
<p>Signaling threshold in the <code class="reqn">P_k/V</code> scale.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Performance</code></td>
<td>
<p>A matrix with the following three performance measures for each target RR: statistical power, expected time to signal and expected sample size.</p>
</td>
</tr>
</table>
<h3>Acknowledgements</h3>

<p>Development of the Performance.AlphaSpend.CondPoisson function was funded by:<br>
-	National Institute of General Medical Sciences, NIH, USA, through grant number R01GM108999 (v2.0,2.0 to 3.1).<br>
-	Federal University of Ouro Preto (UFOP), through contract under internal UFOP's resolution CEPE 4600 (v2.0 to 3.1).<br><br></p>


<h3>See also</h3>

<p><code>Performance.Threshold.CondPoisson</code>: for calculating performance and alpha spending for user-specified signaling threshold with conditional Poisson data.<br><code>CV.CondPoisson</code>: for calculating Wald-type signaling thresholds for continuous sequential analysis with conditional Poisson data based on the CMaxSPRT test statistic.<br><code>Analyze.CondPoisson</code>: for performing sequential analysis with group, continuous or unpredictable sequential fashion for condicional Poisson data based on the CMaxSPRT test statistic.
</p>


<h3>Author(s)</h3>

<p>Ivair Ramos Silva, Martin Kulldorff.
</p>


<h3>References</h3>

<p>Jennison C, Turnbull B. (2000). Group Sequential Methods with Applications to Clinical Trials, London: Chapman and Hall/CRC.
</p>
<p>Kulldorff M, Davis RL, Kolczak M, Lewis E, Lieu T, Platt R. (2011). A Maximized Sequential Probability Ratio Test for Drug and Safety Surveillance. <em>Sequential Analysis</em>, <b>30</b>: 58–78.
</p>
<p>Li L, Kulldorff M. (2010). A conditional maximized sequential probability ratio test for Pharmacovigilance. Statistics in Medicine, 29 (2), 284–295. 
</p>
<p>O'Brien PC, Fleming TR. (1979). A multiple testing procedure for clinical trials. Biometrics. 35:549–556.
</p>
<p>Pocock SJ. (1977). Group sequential methods in the design and analysis of clinical trials. Biometrika. 64:191–199.
</p>
<p>Silva IR, Li L, Kulldorff M. (2019a), Exact conditional maximized sequential probability ratio test adjusted for covariates. Sequential Analysis, 38(1), 115–133.
</p>
<p>Silva IR., Lopes LM., Dias P., Yih WK. (2019b). Alpha Spending for Historical Versus Surveillance Poisson Data With CMaxSPRT. Statistics in Medicine, 38(12), 2126–2138.
</p>
<p>Silva IR, Kulldorff M. (2015). Continuous versus Group Sequential Analysis for Vaccine and Drug Safety Surveillance. Biometrics, 71 (3), 851–858.
</p>
<p>Silva IR, Maro J, Kulldorff M. (2019c). Exact Sequential Analysis Using R Sequential. Working Paper.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
#### Example 1
## Performance and threshold for three group CMaxSPRT sequential with
#  a maximum sample size of 30 events for upper-tailed
#  testing, i.e. H0:RR&lt;=1, with regular groups of sizes 10
#  and alpha spending of 0.01, 0.02, and 0.05 for tests
#  1, 2 and 3, respectively. 
#  The statistical performance is evaluated for three
#  target RR= 1.2, 1.5, 2:

# res&lt;- Performance.AlphaSpend.CondPoisson(K=30,cc=10,alpha=0.05,
# AlphaSpend=c(0.01,0.02,0.05),GroupSizes=c(10,10,10),RR=c(1.2,1.5,2))

#### Example 2
## Performance and threshold for three group CMaxSPRT with
#  a maximum sample size of 30 events for upper-tailed
#  testing, i.e. H0:RR&lt;=1, with regular groups of sizes 10
#  and alpha spending of the power-type.
#  The statistical performance is evaluated for three
#  target RR= 1.2, 1.5, 2:

# res&lt;- Performance.AlphaSpend.CondPoisson(K=30,cc=10,alpha=0.05,
# AlphaSpend=1,GroupSizes=c(10,10,10),rho=0.75,RR=c(1.2,1.5,2))

</code></pre>


</div>