<div class="container">

<table style="width: 100%;"><tr>
<td>getSurprisal</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Get surprisal</h2>

<h3>Description</h3>

<p>Tracks the (un)predictability of spectral changes in a sound over time,
returning a continuous contour of "surprisal". This is an attempt to track
auditory salience over time - that is, to identify parts of a sound that are
likely to involuntarily attract the listeners' attention. The functions
returns surprisal proper ('$surprisal') and its product with increases in
loudness ('$surprisalLoudness'). Because getSurprisal() is slow and
experimental, it is not called by analyze().
</p>


<h3>Usage</h3>

<pre><code class="language-R">getSurprisal(
  x,
  samplingRate = NULL,
  scale = NULL,
  from = NULL,
  to = NULL,
  winSurp = 2000,
  audSpec_pars = list(filterType = "butterworth", nFilters = 64, step = 20, yScale =
    "bark"),
  method = c("acf", "np")[1],
  summaryFun = "mean",
  reportEvery = NULL,
  cores = 1,
  plot = TRUE,
  savePlots = NULL,
  osc = c("none", "linear", "dB")[2],
  heights = c(3, 1),
  ylim = NULL,
  contrast = 0.2,
  brightness = 0,
  maxPoints = c(1e+05, 5e+05),
  padWithSilence = TRUE,
  colorTheme = c("bw", "seewave", "heat.colors", "...")[1],
  col = NULL,
  extraContour = NULL,
  xlab = NULL,
  ylab = NULL,
  xaxp = NULL,
  mar = c(5.1, 4.1, 4.1, 2),
  main = NULL,
  grid = NULL,
  width = 900,
  height = 500,
  units = "px",
  res = NA,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>path to a folder, one or more wav or mp3 files c('file1.wav',
'file2.mp3'), Wave object, numeric vector, or a list of Wave objects or
numeric vectors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samplingRate</code></td>
<td>
<p>sampling rate of <code>x</code> (only needed if <code>x</code> is a
numeric vector)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>maximum possible amplitude of input used for normalization of
input vector (only needed if <code>x</code> is a numeric vector)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from, to</code></td>
<td>
<p>if NULL (default), analyzes the whole sound, otherwise
from...to (s)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>winSurp</code></td>
<td>
<p>surprisal analysis window, ms (Inf = from sound onset to each
point)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>audSpec_pars</code></td>
<td>
<p>a list of parameters passed to
<code>audSpectrogram</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>acf = change in maximum autocorrelation after adding the final
point, np = nonlinear prediction (see <code>nonlinPred</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>summaryFun</code></td>
<td>
<p>functions used to summarize each acoustic characteristic,
eg "c('mean', 'sd')"; user-defined functions are fine (see examples); NAs
are omitted automatically for mean/median/sd/min/max/range/sum, otherwise
take care of NAs yourself</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reportEvery</code></td>
<td>
<p>when processing multiple inputs, report estimated time
left every ... iterations (NULL = default, NA = don't report)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>number of cores for parallel processing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>if TRUE, plots the auditory spectrogram and the
<code>suprisalLoudness</code> contour</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savePlots</code></td>
<td>
<p>full path to the folder in which to save the plots (NULL =
don't save, ‚Äù = same folder as audio)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>osc</code></td>
<td>
<p>"none" = no oscillogram; "linear" = on the original scale; "dB" =
in decibels</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>heights</code></td>
<td>
<p>a vector of length two specifying the relative height of the
spectrogram and the oscillogram (including time axes labels)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>frequency range to plot, kHz (defaults to 0 to Nyquist
frequency). NB: still in kHz, even if yScale = bark, mel, or ERB</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrast</code></td>
<td>
<p>spectrum is exponentiated by contrast (any real number,
recommended -1 to +1). Contrast &gt;0 increases sharpness, &lt;0 decreases
sharpness</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>brightness</code></td>
<td>
<p>how much to "lighten" the image (&gt;0 = lighter, &lt;0 = darker)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxPoints</code></td>
<td>
<p>the maximum number of "pixels" in the oscillogram (if any)
and spectrogram; good for quickly plotting long audio files; defaults to
c(1e5, 5e5)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>padWithSilence</code></td>
<td>
<p>if TRUE, pads the sound with just enough silence to
resolve the edges properly (only the original region is plotted, so the
apparent duration doesn't change)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colorTheme</code></td>
<td>
<p>black and white ('bw'), as in seewave package ('seewave'),
matlab-type palette ('matlab'), or any palette from
<code>palette</code> such as 'heat.colors', 'cm.colors', etc</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>actual colors, eg rev(rainbow(100)) - see ?hcl.colors for colors
in base R (overrides colorTheme)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extraContour</code></td>
<td>
<p>a vector of arbitrary length scaled in Hz (regardless of
yScale!) that will be plotted over the spectrogram (eg pitch contour); can
also be a list with extra graphical parameters such as lwd, col, etc. (see
examples)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab, ylab, main, mar, xaxp</code></td>
<td>
<p>graphical parameters for plotting</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid</code></td>
<td>
<p>if numeric, adds n = <code>grid</code> dotted lines per kHz</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width, height, units, res</code></td>
<td>
<p>graphical parameters for saving plots passed to
<code>png</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other graphical parameters</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Algorithm: we start with an auditory spectrogram produced by applying a bank
of bandpass filters to the signal, by default with central frequencies
equally spaced on the bark scale (see <code>audSpectrogram</code>). For each
frequency channel, a sliding window is analyzed to compare the actually
observed final value with its expected value. There are many ways to
extrapolate / predict time series and thus perform this comparison such as
autocorrelation (method = 'acf') or nonlinear prediction (method = 'np'). The
resulting per-channel surprisal contours are aggregated by taking their mean
weighted by the average amplitude of each frequency channel across the
analysis window. Because increases in loudness are known to be important
predictors of auditory salience, loudness per frame is also returned, as well
as the square root of the product of its derivative and surprisal.
</p>


<h3>Value</h3>

<p>Returns a list with $detailed per-frame and $summary per-file results
(see <code>analyze</code> for more information). Three measures are
reported: <code>loudness</code> (in sone, as per <code>getLoudness</code>), the
first derivative of loudness with respect to time (<code>dLoudness</code>),
<code>surprisal</code> (non-negative), and <code>suprisalLoudness</code> (geometric
mean of surprisal and dLoudness, treating negative values of dLoudness as
zero).
</p>


<h3>Examples</h3>

<pre><code class="language-R"># A quick example
s = soundgen(nSyl = 2, sylLen = 50, pauseLen = 25, addSilence = 15)
surp = getSurprisal(s, samplingRate = 16000)
surp

## Not run: 
# A more meaningful example
sound = soundgen(nSyl = 5, sylLen = 150,
  pauseLen = c(50, 50, 50, 130), pitch = c(200, 150),
  noise = list(time = c(-300, 200), value = -20), plot = TRUE)
# playme(sound)
surp = getSurprisal(sound, samplingRate = 16000,
  yScale = 'bark', method = 'acf')
surp = getSurprisal(sound, samplingRate = 16000,
  yScale = 'bark', method = 'np')  # very slow
surp = getSurprisal(sound, samplingRate = 16000,
  yScale = 'bark', method = 'acf', audSpec_pars = list(
  nFilters = 128, yScale = 'ERB', bandwidth = 1/12))

# short window = amnesia (every event is equally surprising)
getSurprisal(sound, samplingRate = 16000, winSurp = 250)
# long window - remembers further into the past, Inf = from the beginning
surp = getSurprisal(sound, samplingRate = 16000, winSurp = Inf)

# plot "pure" surprisal, without weighting by loudness
spectrogram(sound, 16000, extraContour = surp$detailed$surprisal /
  max(surp$detailed$surprisal, na.rm = TRUE) * 8000)

# NB: surprisalLoudness contour is also log-transformed if yScale = 'log',
# so zeros become NAs
surp = getSurprisal(sound, samplingRate = 16000, yScale = 'log')

# add bells and whistles
surp = getSurprisal(sound, samplingRate = 16000,
  yScale = 'mel',
  osc = 'dB',  # plot oscillogram in dB
  heights = c(2, 1),  # spectro/osc height ratio
  brightness = -.1,  # reduce brightness
  # colorTheme = 'heat.colors',  # pick color theme...
  col = rev(hcl.colors(30, palette = 'Viridis')),  # ...or specify the colors
  cex.lab = .75, cex.axis = .75,  # text size and other base graphics pars
  ylim = c(0, 5),  # always in kHz
  main = 'Audiogram with surprisal contour', # title
  extraContour = list(col = 'blue', lty = 2, lwd = 2)
  # + axis labels, etc
)

surp = getSurprisal('~/Downloads/temp/', savePlots = '~/Downloads/temp/surp')
surp$summary

## End(Not run)
</code></pre>


</div>