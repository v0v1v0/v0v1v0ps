<div class="container">

<table style="width: 100%;"><tr>
<td>slurm_job</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Creating Slurm jobs</h2>

<h3>Description</h3>

<p>Utilities to deal with objects of class <code>slurm_job</code>. The function <code>new_slurm_job</code>,
which is mostly intended to be for internal used, creates an object of class
<code>slurm_job</code>. The function <code>last_submitted_job</code> returns the last submitted
job in the current R session, and the functions <code>read/write_slurm_job</code> are
utility functions to read and write R jobs respectively.
</p>


<h3>Usage</h3>

<pre><code class="language-R">new_slurm_job(
  call,
  rscript,
  bashfile,
  robjects,
  njobs,
  opts_job,
  opts_r,
  hooks = NULL
)

## S3 method for class 'slurm_job'
print(x, ...)

read_slurm_job(path)

write_slurm_job(x, path = NULL)

last_submitted_job()

last_job()
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>The original call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rscript, bashfile</code></td>
<td>
<p>The R script and bash file path.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>robjects</code></td>
<td>
<p>A character vector of R objects that will be imported in the job.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>njobs</code></td>
<td>
<p>Integer. Number of jobs to start (array).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>opts_job, opts_r</code></td>
<td>
<p>List. In the case of <code>opts_job</code>, a list of parameters
passed to sbatch. <code>opts_r</code> is a list of parameters used within R. Both can
be retrieved by opts_slurmR<code style="white-space: pre;">⁠$get_opts_job()⁠</code> and opts_slurmR<code style="white-space: pre;">⁠$get_opts_r()⁠</code>
respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hooks</code></td>
<td>
<p>List of functions. To be called on the collected results after
it finalizes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An object of class <code>slurm_job</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to the method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>Character scalar. Path to either a directory with a <code>job.rds</code> file,
or directly to a <code>job.rds</code> file.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In the case of the function <code>new_slurm_job</code>, besides of creating the
object of class <code>slurm_job</code>, the function calls <code>write_slurm_job</code> and stores
the job object in an <code>rds</code> class file. The name and location of
the saved rds file is generated using the function <code>snames("job")</code>.
</p>
<p>The <code>read_slurm_job</code> can help the user recovering a previously saved
<code>slurm_job</code> object. If <code>path</code> is a directory, then the function will assume
that the file that is looking for lives within that directory and is named
<code>job.rds</code>. Otherwise, if a file, then it will read it directly. In any case,
it will check that the read object is an object of class <code>slurm_job</code>.
</p>
<p>The <code>write_slurm_job</code> function simply takes a <code>slurm_job</code> object
and saves it in, if <code>path</code> is not specified, whatever the <code>job$options$chdir</code>
folder is under the name <code>job.rds</code>. If a path is specified, the it is directly
passed to <code>saveRDS()</code>.
</p>
<p>The <code>las_submitted_job</code> function will return the latest <code>slurm_job</code>
object that was submitted via sbatch in the current session. The <code>last_job</code>
function is just an alias of the later. If no job has been submitted, then
the resulting value will be <code>NULL</code>.
</p>


<h3>Value</h3>

<p>An environment of class <code>slurm_job</code>. This has the following items:
</p>

<ul>
<li> <p><code>call</code> The original call (Slurm_lapply, Slurm_Map, etc.)
</p>
</li>
<li> <p><code>rscript</code> The full path to the R script to be executed by bash file.
</p>
</li>
<li> <p><code>bashfile</code> The full path to the bash file to be executed by sbatch.
</p>
</li>
<li> <p><code>robjects</code> Ignored.
</p>
</li>
<li> <p><code>njobs</code> The number of jobs to be submitted (job array).
</p>
</li>
<li> <p><code>opts_job</code>,<code>opts_r</code> Two lists of options as returned by opts_slurmR$get_opts_job()
and opts_slurmR$get_r_opts() at the moment of the creation of the <code>slurm_job</code>.
</p>
</li>
<li> <p><code>hooks</code> A list of functions to be called on the collected objects
by Slurm_collect.
</p>
</li>
</ul>
<p>In the case of the function <code>write_slurm_job</code>, it returns the full
path to the file.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# The last_job function can be handy when `plan = "collect"` in a called,
# for example
job &lt;- Slurm_lapply(1:1000, function(i) runif(100), njobs = 2, plan = "collect")

# Post collection analysis
status(last_job())

## End(Not run)
</code></pre>


</div>