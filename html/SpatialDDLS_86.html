<div class="container">

<table style="width: 100%;"><tr>
<td>simMixedProfiles</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate training and test mixed spot profiles</h2>

<h3>Description</h3>

<p>Simulate training and test mixed spot transcriptional profiles using cell
composition matrices generated by the <code>genMixedCellProp</code>
function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">simMixedProfiles(
  object,
  type.data = "both",
  mixing.function = "AddRawCount",
  file.backend = NULL,
  compression.level = NULL,
  block.processing = FALSE,
  block.size = 1000,
  chunk.dims = NULL,
  threads = 1,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p><code>SpatialDDLS</code> object with
<code>single.cell.real</code>/<code>single.cell.simul</code>, and
<code>prob.cell.types</code> slots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type.data</code></td>
<td>
<p>Type of data to generate: <code>'train'</code>, <code>'test'</code> or
<code>'both'</code> (the last by default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mixing.function</code></td>
<td>
<p>Function used to build mixed transcriptional profiles.
It may be: </p>
  <ul>
<li> <p><code>"AddRawCount"</code>: single-cell profiles (raw
counts) are added up across cells. Then, log-CPMs are calculated (by
default). </p>
</li>
<li> <p><code>"MeanCPM"</code>: single-cell profiles (raw counts) are
transformed into CPMs and cross-cell averages are calculated. Then,
<code>log2(CPM + 1)</code> is calculated. </p>
</li>
<li> <p><code>"AddCPM"</code>: single-cell
profiles (raw counts) are transformed into CPMs and are added up across
cells. Then, log-CPMs are calculated.</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file.backend</code></td>
<td>
<p>Valid file path to store simulated mixed expression
profiles as an HDF5 file (<code>NULL</code> by default). If provided, data are
stored in HDF5 files used as back-end by using the <span class="pkg">DelayedArray</span>,
<span class="pkg">HDF5Array</span> and <span class="pkg">rhdf5</span> packages instead of loading all data into
RAM. Note that operations on this matrix will be performed in blocks (i.e
subsets of determined size) which may result in longer execution times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compression.level</code></td>
<td>
<p>The compression level used if <code>file.backend</code> is
provided. It is an integer value between 0 (no compression) and 9 (highest
and slowest compression). See
<code>?getHDF5DumpCompressionLevel</code> from the
<span class="pkg">HDF5Array</span> package for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>block.processing</code></td>
<td>
<p>Boolean indicating whether data should be simulated
in blocks (only if <code>file.backend</code> is used, <code>FALSE</code> by default).
This functionality is suitable for cases where it is not possible to load
all data into memory, and it leads to longer execution times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>block.size</code></td>
<td>
<p>Only if <code>block.processing = TRUE</code>. Number of mixed
expression profiles that will be simulated in each iteration. Larger
numbers result in higher memory usage but shorter execution times. Set
accordingly to available computational resources (1000 by default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunk.dims</code></td>
<td>
<p>Specifies the dimensions that HDF5 chunk will have. If
<code>NULL</code>, the default value is a vector of two items: the number of
genes considered by <code>SpatialDDLS</code> object during the
simulation, and a single sample to reduce read times in the following
steps. A larger number of columns written in each chunk can lead to longer
read times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threads</code></td>
<td>
<p>Number of threads used during simulation (1 by default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Show informative messages during the execution (<code>TRUE</code> by
default).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Mixed profiles are generated under the assumption that the expression level
of a particular gene in a given spot is the sum of the expression levels of
the cell types that make it up weighted by their proportions. In practice, as
described in Torroja and Sanchez-Cabo, 2019, these profiles are generated by
summing gene expression levels of a determined number of cells specified by a
known cell composition matrix. The number of simulated spots and cells used
to simulate each spot are determined by the <code>genMixedCellProp</code>
function. This step can be avoided by using the <code>on.the.fly</code> argument in
the <code>trainDeconvModel</code> function.
</p>
<p><span class="pkg">SpatialDDLS</span> allows to use HDF5 files as back-end to store simulated
data using the <span class="pkg">DelayedArray</span> and <span class="pkg">HDF5Array</span> packages. This
functionality allows to work without keeping the data loaded into RAM, which
could be useful during some computationally heavy steps such as neural
network training on RAM-limited machines. You must provide a valid file path
in the <code>file.backend</code> argument to store the resulting file with the
'.h5' extension. This option slows down execution times, as subsequent
transformations of the data will be done in blocks. Note that if you use the
<code>file.backend</code> argument with <code>block.processing = FALSE</code>, all mixed
profiles will be simulated in one step and, thus, loaded into RAM. Then, the
matrix will be written to an HDF5 file. To avoid the RAM collapse, these
profiles can be simulated and written to HDF5 files in blocks of
<code>block.size</code> size by setting <code>block.processing = TRUE</code>. We
recommend this option accordingly to the computational resources available
and the number of simulated spots to be generated, but, in most of the cases,
it is not necessary.
</p>


<h3>Value</h3>

<p>A <code>SpatialDDLS</code> object with <code>mixed.profiles</code>
slot containing a list with one or two entries (depending on selected
<code>type.data</code> argument): <code>'train'</code> and <code>'test'</code>. Each entry
consists of a <code>SummarizedExperiment</code> object with the
simulated mixed slot profiles.
</p>


<h3>References</h3>

<p>Fischer B, Smith M and Pau, G (2020). rhdf5: R Interface to HDF5.
R package version 2.34.0.
</p>
<p>Pagès H, Hickey P and Lun A (2020). DelayedArray: A unified framework for
working transparently with on-disk and in-memory array-like datasets. R
package version 0.16.0.
</p>
<p>Pagès H (2020). HDF5Array: HDF5 backend for DelayedArray objects. R package
version 1.18.0.
</p>


<h3>See Also</h3>

<p><code>genMixedCellProp</code> <code>PropCellTypes</code>
<code>trainDeconvModel</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(123)
sce &lt;- SingleCellExperiment::SingleCellExperiment(
  assays = list(
    counts = matrix(
      rpois(100, lambda = 5), nrow = 40, ncol = 30,
      dimnames = list(paste0("Gene", seq(40)), paste0("RHC", seq(30)))
    )
  ),
  colData = data.frame(
    Cell_ID = paste0("RHC", seq(30)),
    Cell_Type = sample(x = paste0("CellType", seq(4)), size = 30,
                       replace = TRUE)
  ),
  rowData = data.frame(
    Gene_ID = paste0("Gene", seq(40))
  )
)

SDDLS &lt;- createSpatialDDLSobject(
  sc.data = sce,
  sc.cell.ID.column = "Cell_ID",
  sc.gene.ID.column = "Gene_ID",
  sc.filt.genes.cluster = FALSE,
  project = "Simul_example"
)
SDDLS &lt;- genMixedCellProp(
  object = SDDLS,
  cell.ID.column = "Cell_ID",
  cell.type.column = "Cell_Type",
  num.sim.spots = 10,
  train.freq.cells = 2/3,
  train.freq.spots = 2/3,
  verbose = TRUE
)
SDDLS &lt;- simMixedProfiles(SDDLS, verbose = TRUE)

</code></pre>


</div>