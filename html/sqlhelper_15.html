<div class="container">

<table style="width: 100%;"><tr>
<td>run_queries</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Execute a sequence of SQL queries</h2>

<h3>Description</h3>

<p>Accepts a character vector of SQL queries and attempts to execute each
</p>


<h3>Usage</h3>

<pre><code class="language-R">run_queries(sql, ..., default.conn = default_conn(), include_params = FALSE)

runqueries(sql, ..., default.conn = default_conn(), include_params = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sql</code></td>
<td>
<p>An optionally-named list or character vector containing sql
strings, or a tibble returned by <code>read_sql()</code> or <code>prepare_sql()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments to be passed to <code>read_sql()</code> or <code>prepare_sql()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>default.conn</code></td>
<td>
<p>Either the name of a sqlhelper connection, or a database
connection returned by <code>DBI::dbConnect()</code> or <code>pool::dbPool()</code>. This
connection is used as a fall-back when the <code>sql</code> parameter is a tibble and
no per-query connection name is supplied, or the connection name is
<code>default</code> (see <code>prepare_sql()</code>). It may be used by <code>glue::glue_sql()</code> to
interpolate SQL strings, and as the connection against which to execute SQL
queries.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_params</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>. Should the parameters be
included in the output? Mainly useful for debugging.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If no default connection is supplied via <code>default.conn</code> and no
connections have been configured using <code>connect()</code>, an attempt will be made
to configure connections via <code>connect()</code> using the configuration search
path. If no database connections are available after this attempt, an error
will be raised. See <code>vignette("connections")</code> for details about the
configuration search path.
</p>


<h3>Value</h3>


<ul>
<li>
<p> If <code>include_params</code> is <code>FALSE</code> and the <code>sql</code> argument is a
vector, a list containing the results of each query; element names will be
taken from the <code>sql</code> argument.
</p>
</li>
<li>
<p> If the length of the <code>sql</code> argument is 1 and is not named, the result of
that query is returned as-is (e.g. a data.frame), not as a 1-element list.
</p>
</li>
<li>
<p> If <code>include_params</code> is <code>TRUE</code>, a tibble is returned containing 1
row per query with the following fields:
</p>
</li>
</ul>
<dl>
<dt>qname</dt>
<dd>
<p>character. A name for this query</p>
</dd>
<dt>quotesql</dt>
<dd>
<p>"yes" or "no". Should parameterized character values be quoted for this query?</p>
</dd>
<dt>interpolate</dt>
<dd>
<p>"yes" or "no". Should this query be parameterized with values from R?</p>
</dd>
<dt>execmethod</dt>
<dd>
<p>The method to execute this query.
One of "get" (<code>DBI::dbGetQuery()</code>), "execute" (<code>DBI::dbExecute()</code>), "sendq" (<code>DBI::dbSendQuery()</code>), "sends" (<code>DBI::dbSendStatement()</code>) or "spatial" (<code>sf::st_read()</code>)</p>
</dd>
<dt>geometry</dt>
<dd>
<p>character. If <code>execmethod</code> is "spatial", this should be the name of the geometry column.</p>
</dd>
<dt>conn_name</dt>
<dd>
<p>character. The name of the database connection against which to execute this query.
Must be the name of a configured sqlhelper connection.</p>
</dd>
<dt>sql</dt>
<dd>
<p>The sql query to be executed</p>
</dd>
<dt>filename</dt>
<dd>
<p>The value of <code>file_name</code></p>
</dd>
<dt>prepared_sql</dt>
<dd>
<p>The sql query to be executed, i.e. with interpolations
and quoting in place</p>
</dd>
<dt>result</dt>
<dd>
<p>The result of the query</p>
</dd>
</dl>
<h3>See Also</h3>

<p><code>read_sql()</code>, <code>prepare_sql()</code>
</p>
<p>Other SQL runners: 
<code>run_files()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(sqlhelper)

readLines(
    system.file("examples/sqlhelper_db_conf.yml",
                package="sqlhelper")
    ) |&gt;
writeLines()

connect(
    system.file("examples/sqlhelper_db_conf.yml", package="sqlhelper"),
    exclusive=TRUE)

DBI::dbWriteTable( default_conn(),
                  "iris",
                  iris)

n &lt;- 5

run_queries(
    c(top_n = "select * from iris limit {n}",
      uniqs = "select distinct species as species from iris")
)

## use include_params to review the execution context
run_queries(
    c(top_n = "select * from iris limit {n}",
      uniqs = "select distinct species as species from iris"),
   include_params = TRUE
)

## pass an env of interpolation values to the 'values' parameter
## result of a single, unnamed query is returned as an object, not a
## 1-element list
e &lt;- new.env()
e$n &lt;- 2
run_queries(
    "select * from iris limit {n}",
    values = e
)

## Use the execmethod parameter for statements
run_queries("create table iris_setosa as select * from iris where species = 'setosa'",
          execmethod = 'execute')

run_queries("select distinct species as species from iris_setosa")

</code></pre>


</div>