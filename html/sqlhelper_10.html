<div class="container">

<table style="width: 100%;"><tr>
<td>prepare_sql</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>prepare queries and assemble meta data prior to execution</h2>

<h3>Description</h3>

<p>Except for <code>sql</code>, parameters are default values to be used when none are
supplied in <code>sql</code> (i.e. when <code>sql</code> is a tibble returned by <code>read_sql()</code>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">prepare_sql(
  sql,
  quotesql = "yes",
  values = parent.frame(),
  execmethod = "get",
  geometry = NA,
  default.conn = default_conn()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sql</code></td>
<td>
<p>An optionally-named list or character vector containing sql
commands, or a tibble returned by <code>read_sql()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quotesql</code></td>
<td>
<p>"yes" or "no" - should interpolated characters be quoted by
default? Anything that isn't "no" is treated as "yes".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>values</code></td>
<td>
<p>An environment containing variables to interpolate into the
SQL. Pass any object that is not an environment (commonly-used options
include "no", NA, FALSE or NULL) if interpolation is to be skipped, or
another environment containing values to interpolate to avoid using
<code>.GlobalEnv</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>execmethod</code></td>
<td>
<p>One of "get", "execute", "sendq", "sends" or "spatial" -
which method should be used to execute the query? "get" means
<code>DBI::dbGetQuery()</code>; "execute" means <code>DBI::dbExecute()</code>; "sendq" means
DBI::dbSendQuery; "sends" means <code>DBI::dbSendStatement()</code>; "spatial" means
<code>sf::st_read()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>geometry</code></td>
<td>
<p>If <code>execmethod</code> is "spatial", which column contains the
geometry? Ignored if <code>execmethod</code> is not "spatial".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>default.conn</code></td>
<td>
<p>Either the name of a sqlhelper connection, or a database
connection returned by <code>DBI::dbConnect()</code> or <code>pool::pool()</code>, or NA. This
connection is only used by <code>glue::glue_sql()</code> to quote SQL interpolations;
<code>prepare_sql()</code> does not execute any SQL code.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>default.conn</code> parameter may be used to supply a connection object that
is not a configured sqlhelper connection which can then be used to
interpolate quoted strings.
</p>


<h3>Value</h3>

<p>A tibble containing 1 row per query with the following fields:
</p>

<dl>
<dt>qname</dt>
<dd>
<p>character. A name for this query</p>
</dd>
<dt>quotesql</dt>
<dd>
<p>"yes" or "no". Should parameterized character values be
quoted for this query?</p>
</dd>
<dt>interpolate</dt>
<dd>
<p>"yes" or "no". Should this query
be parameterized with values from R?</p>
</dd>
<dt>execmethod</dt>
<dd>
<p>The method to
execute this query. One of "get" (<code>DBI::dbGetQuery()</code>), "execute"
(<code>DBI::dbExecute()</code>), "sendq" (<code>DBI::dbSendQuery()</code>), "sends"
(<code>DBI::dbSendStatement()</code>) or "spatial" (<code>sf::st_read()</code>)</p>
</dd>
<dt>geometry</dt>
<dd>
<p>character. If <code>execmethod</code> is "spatial", which is the
geometry column?</p>
</dd>
<dt>conn_name</dt>
<dd>
<p>character. The name of the database
connection to use for this query. Must be the name of a configured
sqlhelper connection.</p>
</dd>
<dt>sql</dt>
<dd>
<p>The sql query as entered</p>
</dd>
<dt>filename</dt>
<dd>
<p>The value of <code>file_name</code></p>
</dd>
<dt>prepared_sql</dt>
<dd>
<p>The sql query
to be executed, i.e. with interpolations and quoting in place</p>
</dd>
</dl>
<h3>Examples</h3>

<pre><code class="language-R">library(sqlhelper)
connect(
    system.file("examples/sqlhelper_db_conf.yml",
                package="sqlhelper"),
    exclusive = TRUE
)

n &lt;- 5
foo &lt;- 'bar'
prepped &lt;- prepare_sql(c("select {`foo`}", "select {n}"))
prepped
prepped$prepared_sql

</code></pre>


</div>