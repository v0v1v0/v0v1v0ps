<div class="container">

<table style="width: 100%;"><tr>
<td>fit.models</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit parametric survival analysis for health economic evaluations</h2>

<h3>Description</h3>

<p>Runs the survival analysis with several useful options, using either MLE
(via flexsurv) or a Bayesian approach (via R-INLA or rstan)
</p>


<h3>Usage</h3>

<pre><code class="language-R">fit.models(formula = NULL, data, distr = NULL, method = "mle", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a formula specifying the model to be used, in the form
<code>Surv(time,event)~treatment[+covariates]</code> for flexsurv, or
<code>inla.surv(time,event)~treatment[+covariates]</code> for INLA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing the data to be used for the analysis.
This must contain data for the 'event' variable. In case there is no
censoring, then <code>event</code> is a column of 1s.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distr</code></td>
<td>
<p>a (vector of) string(s) containing the name(s) of the model(s)
to be fitted.  Available options are:
</p>
<p><code>flexsurv</code>:
"exponential","gamma","genf","gengamma","gompertz","weibull",
"weibullPH","loglogistic","lognormal" <code>INLA</code>:
"exponential","weibull","lognormal","loglogistic" <code>hmc</code>:
"exponential","gamma","genf","gengamma","gompertz","weibull","weibullPH",
"loglogistic","lognormal"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A string specifying the inferential method (<code>'mle'</code>,
<code>'inla'</code> or <code>'hmc'</code>). If <code>method</code> is set to <code>'hmc'</code>,
then <code>survHE</code> will write suitable model code in the Stan language
(according to the specified distribution), prepare data and initial values
and then run the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional options (for INLA or HMC).
</p>
<p><strong>INLA</strong> specific options <code>dz</code> = defines the step length for the grid
search over the hyperparameters space (default = 0.1) <code>diff.logdens</code> =
defines the difference in the log-density for the hyperparameters to stop
integration (default = 5) <code>control.fixed</code> = defines the default for the
priors, unless specified by the user.  Default values are prior mean = 0 for
<em>all</em> fixed effects prior var = 1000 for <em>all</em> fixed effects prior mean = 0
for the intercept prior prec -&gt; 0 for the intercept <code>control.family</code> =
a list of options. If distr is a vector, then can be provided as a named
list of options, for example something like this:
<code>control.family=list(weibull=list(param=c(.1,.1)),lognormal=list(initial=2))</code>
the names of the elements of the list need to be the same as those given in
the vector <code>distr</code>
</p>
<p><strong>HMC</strong> specific options <code>chains</code> = number of chains to run in the HMC
(default = 2) <code>iter</code> = total number of iterations (default = 2000)
<code>warmup</code> = number of warmup iterations (default = iter/2) <code>thin</code> =
number of thinning (default = 1) <code>control</code> = a list specifying
Stan-related options, eg <code>control=list(adapt_delta=0.85)</code> (default =
NULL) <code>seed</code> = the random seed (to make things replicable) <code>pars</code>
= a vector of parameters (string, default = NA) <code>include</code> = a logical
indicator (if FALSE, then the pars are not saved; default = TRUE)
<code>priors</code> = a list (of lists) specifying the values for the parameters
of the prior distributions in the models <code>save.stan</code> = a logical
indicator (default = FALSE). If TRUE, then saves the data list for Stan and
the model file(s)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>On object in the class <code>survHE</code> containing the following elements
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>models</code></td>
<td>
<p> A list containing the fitted models. These contain
the output from the original inference engine (<code>flexsurv</code>, <code>INLA</code>
or <code>rstan</code>). Can be processed using the methods specific to the
original packages, or via <code>survHE</code>-specific methods (such as
<code>plot</code>, <code>print</code>) or other specialised functions (eg to extrapolate
the survival curves, etc). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.fitting</code></td>
<td>
<p> A list containing the
output of the model-fit statistics (AIC, BIC, DIC). The AIC and BIC are
estimated for all methods, while the DIC is only estimated when using
Bayesian inference. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p> A string indicating the method used to
fit the model, ie <code>'mle'</code>, <code>'inla'</code> or <code>'hmc'</code>.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>misc</code></td>
<td>
<p> A list containing the time needed to run the model(s) (in
seconds), the formula used, the results of the Kaplan-Meier analysis (which
is automatically performed using <code>npsurv</code>) and the original data frame.
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Gianluca Baio
</p>


<h3>References</h3>

<p>G Baio (2019). survHE: Survival analysis for health economic evaluation
and cost-effectiveness modelling. Journal of Statistical Software (2020). vol 95,
14, 1-47. <a href="doi:10.18637/jss.v095.i14">doi:10.18637/jss.v095.i14</a>
</p>


<h3>See Also</h3>

<p><code>make.surv</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Loads an example dataset from 'flexsurv'
data(bc)

# Fits the same model using the 3 inference methods
mle = fit.models(formula=Surv(recyrs,censrec)~group,data=bc,
    distr="exp",method="mle")
inla = fit.models(formula=Surv(recyrs,censrec)~group,data=bc,
    distr="exp",method="inla")
hmc = fit.models(formula=Surv(recyrs,censrec)~group,data=bc,
    distr="exp",method="hmc")
    
# Prints the results in comparable fashion using the survHE method
print(mle)
print(inla)
print(hmc)

# Or visualises the results using the original packages methods
print(mle,original=TRUE)
print(inla,original=TRUE)
print(hmc,original=TRUE)

# Plots the survival curves and estimates
plot(mle)
plot(mle,inla,hmc,labs=c("MLE","INLA","HMC"),colors=c("black","red","blue"))

## End(Not run)

</code></pre>


</div>