<div class="container">

<table style="width: 100%;"><tr>
<td>pairedbinCUSUM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Paired binary CUSUM and its run-length computation</h2>

<h3>Description</h3>

<p>CUSUM for paired binary data as described in Steiner et al. (1999).
</p>


<h3>Usage</h3>

<pre><code class="language-R">pairedbinCUSUM(stsObj, control = list(range=NULL,theta0,theta1,
                                      h1,h2,h11,h22))
pairedbinCUSUM.runlength(p,w1,w2,h1,h2,h11,h22, sparse=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>stsObj</code></td>
<td>
<p>Object of class <code>sts</code> containing the paired
responses for each of the, say n, patients. The observed slot of
<code>stsObj</code> is thus a <code class="reqn">n \times 2</code> matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>Control object as a list containing several parameters.
</p>

<dl>
<dt><code>range</code></dt>
<dd>
<p>Vector of indices in the observed slot to monitor.</p>
</dd>
<dt><code>theta0</code></dt>
<dd>
<p>In-control parameters of the paired binary CUSUM.</p>
</dd>
<dt><code>theta1</code></dt>
<dd>
<p>Out-of-control parameters of the paired binary CUSUM.</p>
</dd>
<dt><code>h1</code></dt>
<dd>
<p>Primary control limit (=threshold) of 1st CUSUM.</p>
</dd>
<dt><code>h2</code></dt>
<dd>
<p>Primary control limit (=threshold) of 2nd CUSUM.</p>
</dd>
<dt><code>h11</code></dt>
<dd>
<p>Secondary limit for 1st CUSUM.</p>
</dd>
<dt><code>h22</code></dt>
<dd>
<p>Secondary limit for 2nd CUSUM.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>Vector giving the probability of the four different
possible states, i.e. c((death=0,near-miss=0),(death=1,near-miss=0),
(death=0,near-miss=1),(death=1,near-miss=1)).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w1</code></td>
<td>
<p>The parameters <code>w1</code> and <code>w2</code> are the sample
weights vectors for the two CUSUMs, see eqn. (2) in the paper. We
have that <code>w1</code> is equal to deaths </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w2</code></td>
<td>
<p>As for <code>w1</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h1</code></td>
<td>
<p>decision barrier for 1st individual cusums</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h2</code></td>
<td>
<p>decision barrier for 2nd cusums</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h11</code></td>
<td>
<p>together with <code>h22</code> this makes up the joing decision barriers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h22</code></td>
<td>
<p>together with <code>h11</code> this makes up the joing decision barriers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparse</code></td>
<td>
<p>Boolean indicating whether to use sparse matrix
computations from the <code>Matrix</code> library (usually much faster!). Default:
<code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For details about the method see the Steiner et al. (1999) reference
listed below. Basically, two individual CUSUMs are run each based on a
logistic regression model. The combined CUSUM not only signals if one
of its two individual CUSUMs signals, but also if the two CUSUMs
simultaneously cross the secondary limits.
</p>


<h3>Value</h3>

<p>An <code>sts</code> object with <code>observed</code>, <code>alarm</code>,
etc. slots trimmed to the <code>control$range</code> indices.
</p>


<h3>Author(s)</h3>

<p>S. Steiner and M. Höhle</p>


<h3>References</h3>

<p>Steiner, S. H., Cook, R. J., and Farewell, V. T. (1999), Monitoring
paired binary surgical outcomes using cumulative sum charts,
Statistics in Medicine, 18, pp. 69–86.
</p>


<h3>See Also</h3>

<p><code>categoricalCUSUM</code></p>


<h3>Examples</h3>

<pre><code class="language-R">#Set in-control and out-of-control parameters as in paper
theta0 &lt;- c(-2.3,-4.5,2.5)
theta1 &lt;- c(-1.7,-2.9,2.5)

#Small helper function to compute the paired-binary likelihood
#of the length two vector yz when the true parameters are theta
dPBin &lt;- function(yz,theta) {
    exp(dbinom(yz[1],size=1,prob=plogis(theta[1]),log=TRUE) +
    dbinom(yz[2],size=1,prob=plogis(theta[2]+theta[3]*yz[1]),log=TRUE))
}

#Likelihood ratio for all four possible configurations
p &lt;- c(dPBin(c(0,0), theta=theta0), dPBin(c(0,1), theta=theta0),
       dPBin(c(1,0), theta=theta0), dPBin(c(1,1), theta=theta0))
if (surveillance.options("allExamples"))
#Compute ARL using slow, non-sparse matrix operations
pairedbinCUSUM.runlength(p,w1=c(-1,37,-9,29),w2=c(-1,7),h1=70,h2=32,
                         h11=38,h22=17)

#Sparse computations can be considerably (!) faster
pairedbinCUSUM.runlength(p,w1=c(-1,37,-9,29),w2=c(-1,7),h1=70,h2=32,
                         h11=38,h22=17,sparse=TRUE)

#Use paired binary CUSUM on the De Leval et al. (1994) arterial switch
#operation data on 104 newborn babies
data("deleval")

#Switch between death and near misses
observed(deleval) &lt;- observed(deleval)[,c(2,1)]

#Run paired-binary CUSUM without generating alarms.
pb.surv &lt;- pairedbinCUSUM(deleval,control=list(theta0=theta0,
             theta1=theta1,h1=Inf,h2=Inf,h11=Inf,h22=Inf))

plot(pb.surv, xaxis.labelFormat=NULL, ylab="CUSUM Statistic")



######################################################################
#Scale the plots so they become comparable to the plots in Steiner et
#al. (1999). To this end a small helper function is defined.
######################################################################

######################################################################
#Log LR for conditional specification of the paired model
######################################################################
LLR.pairedbin &lt;- function(yz,theta0, theta1) {
    #In control
    alphay0 &lt;- theta0[1] ; alphaz0 &lt;- theta0[2] ; beta0 &lt;- theta0[3]
    #Out of control
    alphay1 &lt;- theta1[1] ; alphaz1 &lt;- theta1[2] ; beta1 &lt;- theta1[3]
    #Likelihood ratios
    llry &lt;- (alphay1-alphay0)*yz[1]+log(1+exp(alphay0))-log(1+exp(alphay1))
    llrz &lt;- (alphaz1-alphaz0)*yz[2]+log(1+exp(alphaz0+beta0*yz[1]))-
                                    log(1+exp(alphaz1+beta1*yz[1]))
    return(c(llry=llry,llrz=llrz))
}


val &lt;- expand.grid(0:1,0:1)
table &lt;- t(apply(val,1, LLR.pairedbin, theta0=theta0, theta1=theta1))
w1 &lt;- min(abs(table[,1]))
w2 &lt;- min(abs(table[,2]))
S &lt;- upperbound(pb.surv) / cbind(rep(w1,nrow(observed(pb.surv))),w2)

#Show results
opar &lt;- par(mfcol=c(2,1))
plot(1:nrow(deleval),S[,1],type="l",main="Near Miss",xlab="Patient No.",
     ylab="CUSUM Statistic")
lines(c(0,1e99), c(32,32),lty=2,col=2)
lines(c(0,1e99), c(17,17),lty=2,col=3)

plot(1:nrow(deleval),S[,2],type="l",main="Death",xlab="Patient No.",
     ylab="CUSUM Statistic")
    lines(c(0,1e99), c(70,70),lty=2,col=2)
    lines(c(0,1e99), c(38,38),lty=2,col=3)
par(opar)

######################################################################
# Run the CUSUM with thresholds as in Steiner et al. (1999).
# After each alarm the CUSUM statistic is set to zero and
# monitoring continues from this point. Triangles indicate alarm
# in the respective CUSUM (nearmiss or death). If in both
# simultaneously then an alarm is caused by the secondary limits.
######################################################################
pb.surv2 &lt;- pairedbinCUSUM(deleval,control=list(theta0=theta0,
             theta1=theta1,h1=70*w1,h2=32*w2,h11=38*w1,h22=17*w2))

plot(pb.surv2, xaxis.labelFormat=NULL)
</code></pre>


</div>