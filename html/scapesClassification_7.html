<div class="container">

<table style="width: 100%;"><tr>
<td>cond.4.nofn</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Test conditions for neighbors and neighbors of neighbors</h2>

<h3>Description</h3>

<p>Evaluate conditions for cells neighboring specific classes and classify them
if conditions are true.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cond.4.nofn(
  attTbl,
  ngbList,
  rNumb = FALSE,
  classVector,
  class,
  nbs_of,
  cond,
  min.bord = NULL,
  max.iter = +Inf,
  peval = 1,
  directional = FALSE,
  ovw_class = FALSE,
  hgrowth = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>attTbl</code></td>
<td>
<p>data.frame, the attribute table returned by the function
<code>attTbl</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ngbList</code></td>
<td>
<p>list, the list of neighborhoods returned by the function
<code>ngbList</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rNumb</code></td>
<td>
<p>logic, the neighborhoods of the argument <code>ngbList</code> are
identified by cell numbers (<code>rNumb=FALSE</code>) or by row numbers
(<code>rNumb=TRUE</code>) (see <code>ngbList</code>). It is advised to use row
numbers for large rasters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>classVector</code></td>
<td>
<p>numeric vector, defines the cells in the attribute table
that have already been classified. See <code>conditions</code> for more
information about class vectors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>class</code></td>
<td>
<p>numeric, the classification number to assign to all cells that
meet the function conditions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbs_of</code></td>
<td>
<p>numeric or numeric vector, indicates the class(es) of focal and
anchor cells. Conditions are only evaluated at positions adjacent to anchor
and focal cells. If the classification number assigned with the argument
<code>class</code> is also included in the argument <code>nbs_of</code>, the function
takes into account <em>class continuity</em> (see <code>conditions</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cond</code></td>
<td>
<p>character string, the conditions a cell have to meet to be
classified as indicated by the argument <code>class</code>. The classification
number is only assigned to unclassified cells unless the argument
<code>ovw_class = TRUE</code>. See <code>conditions</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.bord</code></td>
<td>
<p>numeric value between 0 and 1. A test cell is classified if
conditions are true and if among its bordering cells a percentage equal
or greater than <code>min.bord</code> belong to one of the classes of
<code>nbs_of</code>. Percentages are computed counting only valid neighbors
(i.e., neighbors with complete cases).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.iter</code></td>
<td>
<p>integer, the maximum number of iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>peval</code></td>
<td>
<p>numeric value between 0 and 1. If <em>absolute or relative
neighborhood conditions</em> are considered, test cells are classified if the
number of positive evaluations is equal or greater than the percentage
specified by the argument <code>peval</code> (see <code>conditions</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>directional</code></td>
<td>
<p>logic, absolute or relative neighborhood conditions are
tested using the <em>directional neighborhood</em> (see <code>conditions</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ovw_class</code></td>
<td>
<p>logic, reclassify cells that were already classified and
that meet the function conditions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hgrowth</code></td>
<td>
<p>logic, if true the classes in <code>nbs_of</code> are treated as
discrete raster objects and the argument <code>class</code> is ignored.</p>
</td>
</tr>
</table>
<h3>Details</h3>

 <ul>
<li>
<p> The function evaluates the conditions of the
argument <code>cond</code> for all unclassified cells in the neighborhood of
focal and anchor cells (specified by the argument <code>nbs_of</code>).
Unclassified cells are NA-cells in <code>classVector</code>.
</p>
</li>
<li>
<p> Cells that meet the function conditions are classified as indicted by
the argument <code>class</code>.
</p>
</li>
<li> <p><em>Class continuity</em> is considered if the classification number
assigned with the argument <code>class</code> is also included in the argument
<code>nbs_of</code>. This means that, at each iteration, newly classified cells
become focal cells and conditions are tested in their neighborhood.
</p>
</li>
<li>
<p> All types of conditions can be used. The condition string can only
include one neighborhood condition (<code>'{}'</code>) (see
<code>conditions</code>).</p>
</li>
</ul>
<p><strong>Homogeneous growth (<code>hgrowth</code>)</strong>
</p>
<p>If the argument <code>hgrowth</code> is true the classes in <code>nbs_of</code> are
treated as discrete raster objects and the argument <code>class</code> is
ignored. Iterations proceed as follow:
</p>

<ul>
<li>
<p> cells contiguous to the first element of <code>nbs_of</code> are evaluated
against the classification rules and, when evaluations are true, cells are
assigned to that element;
</p>
</li>
<li>
<p> the same process is repeated for cells contiguous to the second element
of <code>nbs_of</code>, then for cells contiguous to the third element and so on
until the last element of <code>nbs_of</code>;
</p>
</li>
<li>
<p> once cells contiguous to the last element of <code>nbs_of</code> are evaluated
the iteration is complete;
</p>
</li>
<li>
<p> cells classified in one iteration become focal cells in the next
iteration;
</p>
</li>
<li>
<p> a new iteration starts as long as new cells were classified in the
previous iteration and if the iteration number &lt; <code>max.iter</code>.
</p>
</li>
</ul>
<h3>Value</h3>

<p>Update <code>classVector</code> with the new cells that were classified by
the function. See <code>conditions</code> for more details about class
vectors.
</p>


<h3>See Also</h3>

<p><code>conditions()</code>, <code>attTbl()</code>, <code>ngbList()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># DUMMY DATA
######################################################################################
# LOAD LIBRARIES
library(scapesClassification)
library(terra)

# LOAD THE DUMMY RASTER
r &lt;- list.files(system.file("extdata", package = "scapesClassification"),
                pattern = "dummy_raster\\.tif", full.names = TRUE)
r &lt;- terra::rast(r)

# COMPUTE THE ATTRIBUTE TABLE
at &lt;- attTbl(r, "dummy_var")

# COMPUTE THE LIST OF NEIGBORHOODS
nbs &lt;- ngbList(r)

# SET A DUMMY FOCAL CELL (CELL #25)
at$cv[at$Cell == 25] &lt;- 0

# SET FIGURE MARGINS
m &lt;- c(2, 8, 2.5, 8)

######################################################################################
# ABSOLUTE TEST CELL CONDITION - NO CLASS CONTINUITY
######################################################################################

# conditions: "dummy_var &gt;= 3"
cv1 &lt;- cond.4.nofn(attTbl = at, ngbList = nbs,

                   # CLASS VECTOR - INPUT
                   classVector = at$cv,

                   # CLASSIFICATION NUMBER
                   class = 1,

                   # FOCAL CELL CLASS
                   nbs_of = 0,

                   # ABSOLUTE TEST CELL CONDITION
                   cond = "dummy_var &gt;= 3")

# CONVERT THE CLASS VECTOR INTO A RASTER
r_cv1 &lt;- cv.2.rast(r, at$Cell,classVector = cv1, plot = FALSE)

# PLOT
plot(r_cv1, type="classes", axes=FALSE, legend = FALSE, asp = NA, mar = m,
     colNA="#818792", col=c("#78b2c4", "#cfad89"))
text(r)
mtext(side=3, line=1, adj=0, cex=1, font=2, "CONDITION: ABSOLUTE TEST CELL")
mtext(side=3, line=0, adj=0, cex=1, "Class continuity: NO")
mtext(side=1, line=0, cex=0.9, adj=0, "Rule: 'dummy_var &gt;= 3'")
legend("bottomright", bg = "white", fill = c("#78b2c4", "#cfad89", "#818792"),
       legend = c("Focal cell", "Classified cells", "Unclassified cells"))

######################################################################################
# ABSOLUTE TEST CELL CONDITION - WITH CLASS CONTINUITY
######################################################################################

# conditions: "dummy_var &gt;= 3"
cv2 &lt;- cond.4.nofn(attTbl = at, ngbList = nbs, classVector = at$cv,

                  # CLASSIFICATION NUMBER
                   class = 1,

                   nbs_of = c(0,  # FOCAL CELL CLASS
                              1), # CLASSIFICATION NUMBER

                   # ABSOLUTE CONDITION
                   cond = "dummy_var &gt;= 3")

# CONVERT THE CLASS VECTOR INTO A RASTER
r_cv2 &lt;- cv.2.rast(r, at$Cell,classVector = cv2, plot = FALSE)

# PLOT
plot(r_cv2, type="classes", axes=FALSE, legend = FALSE, asp = NA, mar = m,
     colNA="#818792", col=c("#78b2c4", "#cfad89"))
text(r)
mtext(side=3, line=1, adj=0, cex=1, font=2, "CONDITION: ABSOLUTE TEST CELL")
mtext(side=3, line=0, adj=0, cex=1, "Class continuity: YES")
mtext(side=1, line=0, cex=0.9, adj=0, "Rule: 'dummy_var &gt;= 3'")
legend("bottomright", bg = "white", fill = c("#78b2c4", "#cfad89", "#818792"),
       legend = c("Focal cell", "Classified cells", "Unclassified cells"))

######################################################################################
# ABSOLUTE NEIGHBORHOOD CONDITION
######################################################################################

# conditions: "dummy_var{} &gt;= 3"
cv3 &lt;- cond.4.nofn(attTbl = at, ngbList = nbs, classVector = at$cv, nbs_of = c(0,1), class = 1,

                   # ABSOLUTE NEIGHBORHOOD CONDITION
                   cond = "dummy_var{} &gt;= 3",

                   # RULE HAS TO BE TRUE FOR 100% OF THE EVALUATIONS
                   peval = 1)

# CONVERT THE CLASS VECTOR INTO A RASTER
r_cv3 &lt;- cv.2.rast(r, at$Cell,classVector = cv3, plot = FALSE)

#PLOT
plot(r_cv3, type="classes", axes=FALSE, legend = FALSE, asp = NA, mar = m,
     colNA="#818792", col=c("#78b2c4", "#cfad89"))
text(r)
mtext(side=3, line=1, adj=0, cex=1, font=2, "CONDITION: ABSOLUTE NEIGHBORHOOD")
mtext(side=3, line=0, adj=0, cex=1, "Class continuity: YES")
mtext(side=1, line=0, cex=0.9, adj=0, "Rule: 'dummy_var{ } &gt;= 3'")
mtext(side=1, line=0, cex=0.9, adj=1, "('{ }' cell neighborhood)")
mtext(side=1, line=1, cex=0.9, adj=0, "Fn_perc: 1 (100%)")
legend("bottomright", bg = "white", fill = c("#78b2c4", "#cfad89", "#818792"),
       legend = c("Focal cell", "Classified cells", "Unclassified cells"))

######################################################################################
# RELATIVE NEIGHBORHOOD CONDITION
######################################################################################

# conditions: "dummy_var &gt; dummy_var{}"
cv4 &lt;- cond.4.nofn(attTbl = at, ngbList = nbs, classVector = at$cv, nbs_of = c(0,1), class = 1,

                   # RELATIVE NEIGHBORHOOD CONDITION
                   cond = "dummy_var &gt; dummy_var{}",

                   # RULE HAS TO BE TRUE FOR AT LEAST 60% OF THE EVALUATIONS
                   peval = 0.6)


# CONVERT THE CLASS VECTOR INTO A RASTER
r_cv4 &lt;- cv.2.rast(r, at$Cell, classVector = cv4, plot = FALSE)

#PLOT
plot(r_cv4, type="classes", axes=FALSE, legend = FALSE, asp = NA, mar = m,
     colNA="#818792", col=c("#78b2c4", "#cfad89"))
text(r)
mtext(side=3, line=1, adj=0, cex=1, font=2, "CONDITION: RELATIVE NEIGHBORHOOD")
mtext(side=3, line=0, adj=0, cex=1, "Class continuity: YES")
mtext(side=1, line=0, cex=0.9, adj=0, "Rule: 'dummy_var &gt; dummy_var{ }'")
mtext(side=1, line=0, cex=0.9, adj=1, "('{ }' cell neighborhood)")
mtext(side=1, line=1, cex=0.9, adj=0, "Fn_perc: 0.6 (60%)")
legend("bottomright", bg = "white", fill = c("#78b2c4", "#cfad89", "#818792"),
       legend = c("Focal cell", "Classified cells", "Unclassified cells"))

######################################################################################
# RELATIVE FOCAL CELL CONDITION
######################################################################################

# conditions: "dummy_var &gt; dummy_var[]"
cv5 &lt;- cond.4.nofn(attTbl = at, ngbList = nbs, classVector = at$cv, nbs_of = c(0,1), class = 1,

                   # RELATIVE FOCAL CELL CONDITION
                   cond = "dummy_var &gt; dummy_var[]")


# CONVERT THE CLASS VECTOR INTO A RASTER
r_cv5 &lt;- cv.2.rast(r, at$Cell,classVector = cv5, plot = FALSE)

#PLOT
plot(r_cv5, type="classes", axes=FALSE, legend = FALSE, asp = NA, mar = m,
     colNA="#818792", col=c("#78b2c4", "#cfad89"))
text(r)
mtext(side=3, line=1, adj=0, cex=1, font=2, "CONDITION: RELATIVE FOCAL CELL")
mtext(side=3, line=0, adj=0, cex=1, "Class continuity: YES")
mtext(side=1, line=0, cex=0.9, adj=0, "Rule: 'dummy_var &gt; dummy_var[ ]'")
mtext(side=1, line=0, cex=0.9, adj=1, "('[ ]' focal cell)")
legend("bottomright", bg = "white", fill = c("#78b2c4", "#cfad89", "#818792"),
       legend = c("Focal cell", "Classified cells", "Unclassified cells"))

######################################################################################
# HOMOGENEOUS GROWTH
######################################################################################

# Dummy raster objects 1 and 2
ro &lt;- as.numeric(rep(NA, NROW(at)))
ro[which(at$dummy_var == 10)] &lt;- 1
ro[which(at$dummy_var == 8)] &lt;- 2

# Not homogeneous growth
nhg &lt;- cond.4.nofn(attTbl = at, ngbList = nbs, classVector = ro,
                   nbs_of = 1, class = 1, # GROWTH ROBJ 1
                   cond = "dummy_var &lt;= dummy_var[] &amp; dummy_var != 1")

nhg &lt;- cond.4.nofn(attTbl = at, ngbList = nbs, classVector = nhg, # UPDATE nhg
                   nbs_of = 2, class = 2, # GROWTH ROBJ 2
                   cond = "dummy_var &lt;= dummy_var[] &amp; dummy_var != 1")


# Homogeneous growth
hg &lt;- cond.4.nofn(attTbl = at, ngbList = nbs, classVector = ro,
                  nbs_of = c(1, 2), class = NULL,
                  cond = "dummy_var &lt;= dummy_var[] &amp; dummy_var != 1",
                  hgrowth = TRUE) # HOMOGENEOUS GROWTH

# Convert class vectors into rasters
r_nhg &lt;- cv.2.rast(r, at$Cell,classVector = nhg, plot = FALSE)
r_hg  &lt;- cv.2.rast(r, at$Cell,classVector = hg, plot = FALSE)

# Plots
oldpar &lt;- par(mfrow = c(1,2))
m &lt;- c(3, 1, 5, 1)

# Original raster objects (for plotting)
r_nhg[at$dummy_var == 10] &lt;- 3
r_nhg[at$dummy_var == 8]  &lt;- 4

r_hg[at$dummy_var == 10] &lt;- 3
r_hg[at$dummy_var == 8]  &lt;- 4
#t
# 1)
plot(r_nhg, type="classes", axes=FALSE, legend=FALSE, asp=NA, mar = m,
     colNA="#818792", col=c("#78b2c4", "#cfc1af", "#1088a0", "#cfad89"))
text(r)
mtext(side=3, line=1, adj=0, cex=1, font=2, "RASTER OBJECTS GROWTH")
mtext(side=3, line=0, adj=0, cex=0.9, "Not homogeneous (hgrowth = FALSE)")
mtext(side=1, line=0, cex=0.9, adj=0, "Growth rule:")
mtext(side=1, line=1, cex=0.9, adj=0, "'dummy_var&lt;=dummy_var[ ] &amp; dummy_var!=1''")
legend("topleft", bg = "white", y.intersp= 1.3,
       fill = c("#1088a0", "#cfc1af", "#78b2c4", "#cfc1af", "#818792"),
       legend = c("RO1", "RO2", "RO1 - growth", "RO2 - growth", "Unclassified cells"))
# 2)
plot(r_hg, type="classes", axes=FALSE, legend=FALSE, asp=NA, mar = m,
     colNA="#818792", col=c("#78b2c4", "#cfc1af", "#1088a0", "#cfad89"))
text(r)
mtext(side=3, line=1, adj=0, cex=1, font=2, "RASTER OBJECTS GROWTH")
mtext(side=3, line=0, adj=0, cex=0.9, "Homogeneous (hgrowth = TRUE)")
mtext(side=1, line=0, cex=0.9, adj=0, "Growth rule:")
mtext(side=1, line=1, cex=0.9, adj=0, "'dummy_var&lt;=dummy_var[ ] &amp; dummy_var!=1''")
legend("topleft", bg = "white", y.intersp= 1.3,
       fill = c("#1088a0", "#cfc1af", "#78b2c4", "#cfc1af", "#818792"),
       legend = c("RO1", "RO2", "RO1 - growth", "RO2 - growth", "Unclassified cells"))
par(oldpar)
</code></pre>


</div>