<div class="container">

<table style="width: 100%;"><tr>
<td>SAM_prior</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculating SAM priors</h2>

<h3>Description</h3>

<p>The <code>SAM_prior</code> function is designed to display the SAM prior, given
the informative prior (constructed from historical data), non-informative
prior, and the mixture weight calculated using <code>SAM_weight</code>
function (<em>Yang, et al., 2023</em>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">SAM_prior(if.prior, nf.prior, weight, ...)

## S3 method for class 'betaMix'
SAM_prior(if.prior, nf.prior, weight, ...)

## S3 method for class 'gammaMix'
SAM_prior(if.prior, nf.prior, weight, ...)

## S3 method for class 'normMix'
SAM_prior(if.prior, nf.prior, weight, ..., sigma)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>if.prior</code></td>
<td>
<p>Informative prior constructed from historical data,
represented (approximately) as a mixture of conjugate distributions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nf.prior</code></td>
<td>
<p>Non-informative prior used for the mixture.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>Weight assigned to the informative prior component
(<code class="reqn">0 \leq</code> <code>weight</code> <code class="reqn">\leq 1</code>), which should be determined by
<code>SAM_weight</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters required for different endpoints.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>Variance used for constructing the non-informative prior for
continuous endpoints.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>SAM prior is constructed by mixing an informative prior
<code class="reqn">\pi_1(\theta)</code>, constructed based on historical data, with a
non-informative prior <code class="reqn">\pi_0(\theta)</code> using the mixture weight
<code class="reqn">w</code> determined by <code>SAM_weight</code> function to achieve the
degree of prior-data conflict (<em>Schmidli et al., 2015, Yang et al., 2023</em>).
</p>
<p>Let <code class="reqn">\theta</code> and <code class="reqn">\theta_h</code> denote the treatment effects
associated with the current arm data <code class="reqn">D</code> and historical data <code class="reqn">D_h</code>,
respectively. Let <code class="reqn">\delta</code> denote the clinically significant difference
such that if <code class="reqn">|\theta_h - \theta| \ge \delta</code>, then <code class="reqn">\theta_h</code> is
regarded as clinically distinct from <code class="reqn">\theta</code>, and it is therefore
inappropriate to borrow any information from <code class="reqn">D_h</code>. Consider two
hypotheses:
</p>
<p style="text-align: center;"><code class="reqn">H_0: \theta = \theta_h, ~ H_1: \theta = \theta_h + \delta ~ or ~  \theta = \theta_h - \delta.</code>
</p>

<p><code class="reqn">H_0</code> represents that <code class="reqn">D_h</code> and <code class="reqn">D</code> are consistent (i.e.,
no prior-data conflict) and thus information borrowing is desirable,
whereas <code class="reqn">H_1</code> represents that the treatment effect of <code class="reqn">D</code>
differs from <code class="reqn">D_h</code> to such a degree that no information should be
borrowed.
</p>
<p>The SAM prior uses the likelihood ratio test (LRT) statistics <code class="reqn">R</code> to
quantify the degree of prior-data conflict and determine the extent of
information borrowing.
</p>
<p style="text-align: center;"><code class="reqn">R = P(D | H_0, \theta_h) / P(D | H_1, \theta_h) = P(D | \theta = \theta_h) / \max(P(D | \theta = \theta_h + \delta), P(D | \theta = \theta_h - \delta)) ,</code>
</p>

<p>where <code class="reqn">P(D | \cdot)</code> denotes the likelihood function. An alternative
Bayesian choice is the posterior probability ratio (PPR):
</p>
<p style="text-align: center;"><code class="reqn">R = P(D | H_0, \theta_h) / P(D | H_1, \theta_h) = P(H_0) / P( H_1) \times BF, </code>
</p>

<p>where <code class="reqn">P(H_0)</code> and <code class="reqn">P(H_1)</code> is the prior probabilities of <code class="reqn">H_0</code>
and <code class="reqn">H_1</code> being true. <code class="reqn">BF</code> is the Bayes Factor that in this case
is the same as the LRT.
</p>
<p>The SAM prior, denoted as <code class="reqn">\pi_{sam}(\theta)</code>, is then defined
as a mixture of an informative prior <code class="reqn">\pi_1(\theta)</code>, constructed
based on <code class="reqn">D_h</code> and a non-informative prior <code class="reqn">\pi_0(\theta)</code>:
</p>
<p style="text-align: center;"><code class="reqn">\pi_{sam}(\theta) = w\pi_1(\theta) + (1-w)\pi_0(\theta),</code>
</p>

<p>where the mixture weight <code class="reqn">w</code> is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">w = R / (1 + R).</code>
</p>

<p>As the level of prior-data conflict increases, the likelihood ratio
<code class="reqn">R</code> decreases, resulting in a decrease in the weight <code class="reqn">w</code>
assigned to the informative prior and thus a decrease in information
borrowing. As a result, <code class="reqn">\pi_{sam}(\theta)</code> is data-driven and
has the ability to self-adapt the information borrowing based on the
degree of prior-data conflict.
</p>


<h3>Value</h3>

<p>Displays the SAM prior as a mixture of an informative prior
(constructed based on the historical data) and a non-informative prior.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>SAM_prior(betaMix)</code>: The function calculates the SAM prior for beta
mixture distribution. The default <code>nf.prior</code> is set to be
<code>mixbeta(c(1,1,1))</code> which represents a uniform prior <code>Beta(1,1)</code>.
</p>
</li>
<li> <p><code>SAM_prior(gammaMix)</code>: The function calculates the SAM prior for gamma
mixture distribution. The default <code>nf.prior</code> is set to be
<code>mixgamma(c(1,0.001,0.001))</code> which represents a vague gamma prior
<code>Gamma(0.001,0.001)</code>.
</p>
</li>
<li> <p><code>SAM_prior(normMix)</code>: The function calculates the SAM prior for normal
mixture distribution. The default <code>nf.prior</code> is set to be
<code>mixnorm(c(1,summary(if.prior)['mean'], sigma))</code> which represents a
unit-information prior.
</p>
</li>
</ul>
<h3>References</h3>

<p>Yang P, Zhao Y, Nie L, Vallejo J, Yuan Y.
SAM: Self-adapting mixture prior to dynamically borrow information from
historical data in clinical trials. <em>Biometrics</em> 2023; 00, 1â€“12.
https://doi.org/10.1111/biom.13927
</p>
<p>Schmidli H, Gsteiger S, Roychoudhury S, O'Hagan A,
Spiegelhalter D, Neuenschwander B.  Robust meta-analytic-predictive
priors in clinical trials with historical control information.
<em>Biometrics</em> 2014; 70(4):1023-1032.
</p>


<h3>See Also</h3>

<p><code>SAM_weight</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(123)
## Examples for binary endpoints
## Suppose that the informative prior constructed based on historical data is
## beta(40, 60)
prior.historical &lt;- mixbeta(c(1, 40, 60))
## Data of the control arm
data.control     &lt;- rbinom(60, size = 1, prob = 0.42)
## Calculate the mixture weight of the SAM prior
wSAM &lt;- SAM_weight(if.prior = prior.historical,
                   delta = 0.15,        ## Clinically significant difference
                   data = data.control  ## Control arm data
                   )
## Assume beta(1,1) as the non-informative prior used for mixture
nf.prior  &lt;- mixbeta(nf.prior = c(1,1,1))
## Generate the SAM prior
SAM.prior &lt;- SAM_prior(if.prior = prior.historical, ## Informative prior
                       nf.prior = nf.prior,         ## Non-informative prior
                       weight = wSAM                ## Mixture weight of the SAM prior
                       )
plot(SAM.prior)

## Examples for continuous endpoints
## Suppose that the informative prior constructed based on historical data is
## N(0, 3)
sigma      &lt;- 3
prior.mean &lt;- 0
prior.se   &lt;- sigma/sqrt(100)
prior.historical &lt;- mixnorm(c(1, prior.mean, prior.se), sigma = sigma)
## Data of the control arm
data.control &lt;- rnorm(80, mean = 0, sd = sigma)
## Calculate the mixture weight of the SAM prior
wSAM &lt;- SAM_weight(if.prior = prior.historical,
                   delta = 0.2 * sigma,    ## Clinically significant difference
                   data = data.control     ## Control arm data
                   )
## Assume unit-information prior N(0,3) as the non-informative prior used
## for the mixture
nf.prior         &lt;- mixnorm(nf.prior = c(1,prior.mean, sigma),
                            sigma = sigma)
## Generate the SAM prior
SAM.prior &lt;- SAM_prior(if.prior = prior.historical, ## Informative prior
                       nf.prior = nf.prior,         ## Non-informative prior
                       weight = wSAM                ## Mixture weight of the SAM prior
                       )
plot(SAM.prior)

</code></pre>


</div>