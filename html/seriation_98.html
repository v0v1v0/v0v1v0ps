<div class="container">

<table style="width: 100%;"><tr>
<td>pimage</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Permutation Image Plot</h2>

<h3>Description</h3>

<p>Provides methods for matrix shading, i.e., displaying a color image for
matrix (including correlation matrices and data frames) and <code>dist</code> objects given an
optional permutation. The plot arranges colored rectangles to represent the
values in the matrix. This visualization is also know as a heatmap.
Implementations based on the
<span class="pkg">grid</span> graphics engine and based n <span class="pkg">ggplot2</span> are provided.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pimage(x, order = FALSE, ...)

## S3 method for class 'matrix'
pimage(
  x,
  order = FALSE,
  col = NULL,
  main = "",
  xlab = "",
  ylab = "",
  zlim = NULL,
  key = TRUE,
  keylab = "",
  symkey = TRUE,
  upper_tri = TRUE,
  lower_tri = TRUE,
  diag = TRUE,
  row_labels = NULL,
  col_labels = NULL,
  prop = isSymmetric(x),
  flip_axes = FALSE,
  reverse_columns = FALSE,
  ...,
  newpage = TRUE,
  pop = TRUE,
  gp = NULL
)

## S3 method for class 'table'
pimage(x, order = NULL, ...)

## S3 method for class 'data.frame'
pimage(x, order = NULL, ...)

## S3 method for class 'dist'
pimage(
  x,
  order = NULL,
  col = NULL,
  main = "",
  xlab = "",
  ylab = "",
  zlim = NULL,
  key = TRUE,
  keylab = "",
  symkey = TRUE,
  upper_tri = TRUE,
  lower_tri = TRUE,
  diag = TRUE,
  row_labels = NULL,
  col_labels = NULL,
  prop = TRUE,
  flip_axes = FALSE,
  reverse_columns = FALSE,
  ...,
  newpage = TRUE,
  pop = TRUE,
  gp = NULL
)

ggpimage(x, order = NULL, ...)

## S3 method for class 'matrix'
ggpimage(
  x,
  order = NULL,
  zlim = NULL,
  upper_tri = TRUE,
  lower_tri = TRUE,
  diag = TRUE,
  row_labels = NULL,
  col_labels = NULL,
  prop = isSymmetric(x),
  flip_axes = FALSE,
  reverse_columns = FALSE,
  ...
)

## S3 method for class 'dist'
ggpimage(
  x,
  order = NULL,
  zlim = NULL,
  upper_tri = TRUE,
  lower_tri = TRUE,
  diag = TRUE,
  row_labels = NULL,
  col_labels = NULL,
  prop = TRUE,
  flip_axes = FALSE,
  reverse_columns = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a matrix, a data.frame, or an object of class <code>dist</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>a logical where <code>FALSE</code> means no reordering and <code>TRUE</code> applies
a permutation using the default seriation method for the type of <code>x</code>. Alternatively,
any object that can be coerced to class <code>ser_permutation</code>
can be supplied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>if <code>order</code> is the name of a seriation method then further arguments are passed
on to the seriation method, otherwise they are ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>a list of colors used. If <code>NULL</code>, a gray scale is used (for
matrix larger values are displayed darker and for <code>dist</code> smaller
distances are darker). For matrices containing logical data, black and white
is used. For matrices containing negative values a symmetric diverging color
palette is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>plot title.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab, ylab</code></td>
<td>
<p>labels for the x and y axes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zlim</code></td>
<td>
<p>vector with two elements giving the range (min, max) for
representing the values in the matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key</code></td>
<td>
<p>logical; add a color key? No key is available for logical
matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keylab</code></td>
<td>
<p>string plotted next to the color key.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>symkey</code></td>
<td>
<p>logical; if <code>x</code> contains negative values, should the
color palate be symmetric (zero is in the middle)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper_tri, lower_tri, diag</code></td>
<td>
<p>a logical indicating whether to show the
upper triangle, the lower triangle or the diagonal of the (distance) matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>row_labels, col_labels</code></td>
<td>
<p>a logical indicating if row and column labels
in <code>x</code> should be displayed.  If <code>NULL</code> then labels are displayed
if the <code>x</code> contains the appropriate dimname and the number of labels is
25 or less. A character vector of the appropriate length with labels can
also be supplied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop</code></td>
<td>
<p>logical; change the aspect ratio so cells in the image have a
equal width and height.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flip_axes</code></td>
<td>
<p>logical; exchange rows and columns for plotting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reverse_columns</code></td>
<td>
<p>logical; revers the order of how the columns are
displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newpage, pop, gp</code></td>
<td>
<p>Start plot on a new page, pop the viewports after
plotting, and use the supplied <code>gpar</code> object (see <span class="pkg">grid</span>).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Plots a matrix in its original row and column orientation (image in <span class="pkg">stats</span>
reverses the rows). This means, in a
plot the columns become the x-coordinates and the rows the y-coordinates (in
reverse order).
</p>
<p><strong>Grid-based plot:</strong> The viewports used for plotting are called:
<code>"plot"</code>, <code>"image"</code> and <code>"colorkey"</code>.  Use <span class="pkg">grid</span> functions
to manipulate the plots (see Examples section).
</p>
<p><strong>ggplot2-based plot:</strong> A ggplot2 object is returned. Colors, axis limits
and other visual aspects can be added using standard ggplot2 functions
(<code>labs</code>, <code>scale_fill_continuous</code>, <code>labs</code>, etc.).
</p>


<h3>Value</h3>

<p>Nothing.
</p>


<h3>Author(s)</h3>

<p>Christian Buchta and Michael Hahsler
</p>


<h3>See Also</h3>

<p>Other plots: 
<code>VAT()</code>,
<code>bertinplot()</code>,
<code>dissplot()</code>,
<code>hmap()</code>,
<code>palette()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1234)
data(iris)
x &lt;- as.matrix(iris[sample(nrow(iris), 20) , -5])

pimage(x)

# Show all labels and flip axes, reverse columns, or change colors
pimage(x, prop = TRUE)
pimage(x, flip_axes = TRUE)
pimage(x, reverse_columns = TRUE)
pimage(x, col = grays(100))

# A matrix with positive and negative values
x_scaled &lt;- scale(x)
pimage(x_scaled)

# Use reordering
pimage(x_scaled, order = TRUE)
pimage(x_scaled, order = "Heatmap")

## Example: Distance Matrix
# Show a reordered distance matrix (distances between rows).
# Dark means low distance. The aspect ratio is automatically fixed to 1:1
# using prop = TRUE
d &lt;- dist(x)
pimage(d)
pimage(d, order = TRUE)

# Supress the upper triangle and diagonal
pimage(d, order = TRUE, upper = FALSE, diag = FALSE)

# Show only distances that are smaller than 2 using limits on z.
pimage(d, order = TRUE, zlim = c(0, 3))

## Example: Correlation Matrix
# we calculate correlation between rows and seriate the matrix
# and seriate by converting the correlations into distances.
# pimage reorders then rows and columns with c(o, o).
r &lt;- cor(t(x))
o &lt;- seriate(as.dist(sqrt(1 - r)))
pimage(r, order = c(o, o),
  upper = FALSE, diag = FALSE,
  zlim = c(-1, 1),
  reverse_columns = TRUE,
  main = "Correlation matrix")

# Add to the plot using functions in package grid
# Note: pop = FALSE allows us to manipulate viewports
library("grid")
pimage(x, order = TRUE, pop = FALSE)

# available viewports are: "main", "colorkey", "plot", "image"
current.vpTree()

# Highlight cell 2/2 with a red arrow
# Note: columns are x and rows are y.
downViewport(name = "image")
grid.lines(x = c(1, 2), y = c(-1, 2), arrow = arrow(),
  default.units = "native", gp = gpar(col = "red", lwd = 3))

# add a red box around the first 4 rows of the 2nd column
grid.rect(x = 1 + .5 , y = 4 + .5, width = 1, height = 4,
  hjust = 0, vjust = 1,
  default.units = "native", gp = gpar(col = "red", lwd = 3, fill = NA))

## remove the viewports
popViewport(0)

## put several pimages on a page (use grid viewports and newpage = FALSE)
# set up grid layout
library(grid)
grid.newpage()
top_vp &lt;- viewport(layout = grid.layout(nrow = 1, ncol = 2,
  widths = unit(c(.4, .6), unit = "npc")))
col1_vp &lt;- viewport(layout.pos.row = 1, layout.pos.col = 1, name = "col1_vp")
col2_vp &lt;- viewport(layout.pos.row = 1, layout.pos.col = 2, name = "col2_vp")
splot &lt;- vpTree(top_vp, vpList(col1_vp, col2_vp))
pushViewport(splot)

seekViewport("col1_vp")
o &lt;- seriate(d)
pimage(x, c(o, NA), col_labels = FALSE, main = "Data",
  newpage = FALSE)

seekViewport("col2_vp")
## add the reordered dissimilarity matrix for rows
pimage(d, o, main = "Distances",
  newpage = FALSE)

popViewport(0)

##-------------------------------------------------------------
## ggplot2 Examples
if (require("ggplot2")) {

library("ggplot2")

set.seed(1234)
data(iris)
x &lt;- as.matrix(iris[sample(nrow(iris), 20) , -5])

ggpimage(x)

# Show all labels and flip axes, reverse columns
ggpimage(x, prop = TRUE)
ggpimage(x, flip_axes = TRUE)
ggpimage(x, reverse_columns = TRUE)


# A matrix with positive and negative values
x_scaled &lt;- scale(x)
ggpimage(x_scaled)

# Use reordering
ggpimage(x_scaled, order = TRUE)
ggpimage(x_scaled, order = "Heatmap")

## Example: Distance Matrix
# Show a reordered distance matrix (distances between rows).
# Dark means low distance. The aspect ratio is automatically fixed to 1:1
# using prop = TRUE
d &lt;- dist(x)
ggpimage(d)
ggpimage(d, order = TRUE)

# Supress the upper triangle and diagonal
ggpimage(d, order = TRUE, upper = FALSE, diag = FALSE)

# Show only distances that are smaller than 2 using limits on z.
ggpimage(d, order = TRUE, zlim = c(0, 2))

## Example: Correlation Matrix
# we calculate correlation between rows and seriate the matrix
r &lt;- cor(t(x))
o &lt;- seriate(as.dist(sqrt(1 - r)))
ggpimage(r, order = c(o, o),
  upper = FALSE, diag = FALSE,
  zlim = c(-1, 1),
  reverse_columns = TRUE) + labs(title = "Correlation matrix")

## Example: Custom themes and colors
# Reorder matrix, use custom colors, add a title,
# and hide colorkey.
ggpimage(x) +
  theme(legend.position = "none") +
  labs(title = "Random Data") + xlab("Variables")

# Add lines
ggpimage(x) +
  geom_hline(yintercept = seq(0, nrow(x)) + .5) +
  geom_vline(xintercept = seq(0, ncol(x)) + .5)

# Use ggplot2 themes with theme_set
old_theme &lt;- theme_set(theme_linedraw())
ggpimage(d)
theme_set(old_theme)

# Use custom color palettes: Gray scale, Colorbrewer (provided in ggplot2) and colorspace
ggpimage(d, order = seriate(d), upper_tri = FALSE) +
  scale_fill_gradient(low = "black", high = "white", na.value = "white")

ggpimage(d, order = seriate(d), upper_tri = FALSE) +
  scale_fill_distiller(palette = "Spectral", direction = +1, na.value = "white")

ggpimage(d, order = seriate(d), upper_tri = FALSE) +
  colorspace::scale_fill_continuous_sequential("Reds", rev = FALSE, na.value = "white")
}
</code></pre>


</div>