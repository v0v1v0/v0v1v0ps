<div class="container">

<table style="width: 100%;"><tr>
<td>twinstim_siaf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Spatial Interaction Function Objects
</h2>

<h3>Description</h3>

<p>A spatial interaction function for use in <code>twinstim</code>
can be constructed via the <code>siaf</code> function.
It checks the supplied function elements, assigns defaults for
missing arguments, and returns all checked arguments in a list.
However, for standard applications it is much easier to use one of the
pre-defined spatial interaction functions, e.g.,
<code>siaf.gaussian</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">siaf(f, F, Fcircle, effRange, deriv, Deriv, simulate, npars,
     validpars = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>the spatial interaction function. It must accept
two arguments, the first one being a (2-column) coordinate matrix, the
second one a parameter vector. For marked <code>twinstim</code>, it must
accept the type of the event (integer code) as its third argument
(either a single type for all locations or separate types for each
location).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>F</code></td>
<td>
<p>function computing the integral of <code class="reqn">f(s)</code> (passed as
second argument) over a polygonal <code>"owin"</code> domain (first argument).
The third and fourth argument are
the parameter vector and the (<em>single</em>) type, respectively.
There may be additional arguments, which can then be specified in
the <code>control.siaf$F</code> argument list of <code>twinstim</code>. If the <code>F</code>
function is missing, a general default (<code>polyCub</code>) 
will be used, with extra arguments <code>method</code> (default: <code>"SV"</code>) 
and corresponding accuracy parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fcircle</code></td>
<td>
<p>optional function for fast calculation of the
(two-dimensional) integral of <code class="reqn">f(s)</code> over a circle with radius
<code>r</code> (first argument). Further arguments are as for <code>f</code>. It
must not be vectorized (will always be called with single radius
and a single type). If this function is specified, integration of
the <code>siaf</code> over the spatial influence region of an event will
be faster if the region is actually circular. This is the case if
the event is located at least a distance <code>eps.s</code> from the border
of the observation region <code>W</code>, or if the distance to the border
is larger than the effective integration range (if specified, see
<code>effRange</code> below).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effRange</code></td>
<td>
<p>optional function returning the “effective”
range of <code class="reqn">f(s)</code> for the given set of parameters (the first and
only argument) such that the circle with radius <code>effRange</code>
contains the numerically essential proportion of the 
integral mass. For the Gaussian kernel the default is
<code>function (logsd) 6*exp(logsd)</code>. The return value must be a
vector of length <code>nTypes</code> (effective range for each type). This
function is only used if <code>Fcircle</code> is also specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deriv</code></td>
<td>
<p>optional derivative of <code class="reqn">f(s)</code> <em>with respect to
the parameters</em>. It takes the same arguments as <code>f</code> but
returns a matrix with as many rows as there were coordinates in the
input and <code>npars</code> columns. This derivative is necessary for the
calculation of the score function in <code>twinstim()</code>, which is
advantageous for the numerical log-likelihood maximization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Deriv</code></td>
<td>
<p>function computing the integral of <code>deriv</code> (passed as
second argument) over a polygonal <code>"owin"</code> domain (first
argument). The return value is thus a vector of length <code>npars</code>.
The third argument is the parameter vector and the fourth argument
is a (<em>single</em>) type and must be named <code>type</code>.
There may be additional arguments, which can then be specified in
the <code>control.siaf$Deriv</code> argument list of <code>twinstim</code>. If the
<code>Deriv</code> function is missing, a general default
(<code>polyCub</code>) will be used, with extra arguments
<code>method</code> (default: <code>"SV"</code>) and corresponding accuracy parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simulate</code></td>
<td>
<p>optional function returning a sample drawn from the
spatial kernel (only required for the simulation of <code>twinstim</code>
models).  Its first argument is the size of the sample to
generate, next the parameter vector, an optional single event type,
and an optional upper bound for the radius within which to simulate
points. The function must return a two-column <em>matrix</em> of the
sampled locations. 
Note that the simulation method actually samples only one location
at a time, thus it is sufficient to have a working
<code>function(n=1, pars, type, ub)</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npars</code></td>
<td>
<p>the number of parameters of the spatial interaction
function <code>f</code> (i.e. the length of its second argument).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>validpars</code></td>
<td>

<p>optional function taking one argument, the parameter vector, indicating if it
is valid. This approach to specify parameter constraints is rarely
needed, because usual box-constrained parameters can be taken into
account by using L-BFGS-B as the optimization method in
<code>twinstim</code> (with arguments <code>lower</code> and <code>upper</code>), and
positivity constraints by using log-parametrizations.
This component is not necessary (and ignored) if <code>npars == 0</code>.
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>list of checked arguments.
</p>


<h3>Author(s)</h3>

<p>Sebastian Meyer
</p>


<h3>See Also</h3>

<p><code>siaf.gaussian</code> for a pre-defined spatial interaction
function, and <code>tiaf</code> for the temporal interaction function.
</p>


</div>