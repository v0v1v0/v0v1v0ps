<div class="container">

<table style="width: 100%;"><tr>
<td>msq</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multi-Server Queue Simulation</h2>

<h3>Description</h3>

<p>A next-event simulation of a single-queue multiple-server
service node, with extensible arrival and service processes.
</p>


<h3>Usage</h3>

<pre><code class="language-R">msq(
  maxArrivals = Inf,
  seed = NA,
  numServers = 2,
  serverSelection = c("LRU", "LFU", "CYC", "RAN", "ORD"),
  interarrivalFcn = NULL,
  serviceFcn = NULL,
  interarrivalType = "M",
  serviceType = "M",
  maxTime = Inf,
  maxDepartures = Inf,
  maxInSystem = Inf,
  maxEventsPerSkyline = 15,
  saveAllStats = FALSE,
  saveInterarrivalTimes = FALSE,
  saveServiceTimes = FALSE,
  saveWaitTimes = FALSE,
  saveSojournTimes = FALSE,
  saveNumInQueue = FALSE,
  saveNumInSystem = FALSE,
  saveServerStatus = FALSE,
  showOutput = TRUE,
  animate = FALSE,
  showQueue = NULL,
  showSkyline = NULL,
  showSkylineSystem = FALSE,
  showSkylineQueue = FALSE,
  showSkylineServer = FALSE,
  showTitle = TRUE,
  showProgress = TRUE,
  plotQueueFcn = defaultPlotMSQ,
  plotSkylineFcn = defaultPlotSkyline,
  jobImage = NA,
  plotDelay = NA,
  respectLayout = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>maxArrivals</code></td>
<td>
<p>maximum number of customer arrivals allowed to enter the system</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>initial seed to the random number generator (NA uses current state of
random number generator; NULL seeds using system clock)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numServers</code></td>
<td>
<p>Number of servers to simulation (an integer between 1 and 24)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>serverSelection</code></td>
<td>
<p>Algorithm to use for selecting among idle servers (default is "LRU")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interarrivalFcn</code></td>
<td>
<p>Function for generating interarrival times for queue simulation.
Default value (<code>NA</code>) will result in use of default interarrival
function based on <code>interarrivalType</code>.  See examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>serviceFcn</code></td>
<td>
<p>Function for generating service times for queue simulation.
Default value (<code>NA</code>) will result in use of default service function
based on <code>serviceType</code>.  See examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interarrivalType</code></td>
<td>
<p>string representation of desired interarrival process.
Options are "M" – exponential with rate 1;
"G" – uniform(0,2), having mean 1; and "D" – deterministic with
constant value 1.  Default is "M".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>serviceType</code></td>
<td>
<p>string representation of desired service process .
Options are "M" – exponential with rate 10/9;
"G" – uniform(0, 1.8), having mean 9/10; and "D" –
deterministic with constant value 9/10.  Default is "M".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxTime</code></td>
<td>
<p>maximum time to simulate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxDepartures</code></td>
<td>
<p>maximum number of customer departures to process</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxInSystem</code></td>
<td>
<p>maximum number of customers that the system can hold (server(s) plus queue).
Infinite by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxEventsPerSkyline</code></td>
<td>
<p>maximum number of events viewable at a time in the skyline plot.
A large value for this parameter may result in plotting delays.
This parameter does not impact the final plotting, which will show all
end-of-simulation results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveAllStats</code></td>
<td>
<p>if <code>TRUE</code>, returns all vectors of statistics (see below)
collected by the simulation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveInterarrivalTimes</code></td>
<td>
<p>if <code>TRUE</code>, returns a vector of all interarrival times generated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveServiceTimes</code></td>
<td>
<p>if <code>TRUE</code>, returns a vector of all service times generated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveWaitTimes</code></td>
<td>
<p>if <code>TRUE</code>, returns a vector of all wait times (in the queue) generated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveSojournTimes</code></td>
<td>
<p>if <code>TRUE</code>, returns a vector of all sojourn times (time spent in the system)
generated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveNumInQueue</code></td>
<td>
<p>if <code>TRUE</code>, returns a vector of times and a vector of counts for whenever
the number in the queue changes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveNumInSystem</code></td>
<td>
<p>if <code>TRUE</code>, returns a vector of times and a vector of counts for whenever
the number in the system changes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveServerStatus</code></td>
<td>
<p>if <code>TRUE</code>, returns a vector of times and a vector of
server status (0:idle, 1:busy) for whenever the status changes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showOutput</code></td>
<td>
<p>if <code>TRUE</code>, displays summary statistics upon completion</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>animate</code></td>
<td>
<p>If FALSE, no animation will be shown.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showQueue</code></td>
<td>
<p>if TRUE, displays a visualization of the queue</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showSkyline</code></td>
<td>
<p>If <code>NULL</code> (default), defers to each individual showSkyline...
parameter below; otherwise, supersedes individual showSkyline...
parameter values.
If <code>TRUE</code>, displays full skyline plot; <code>FALSE</code> suppresses
skyline plot. Can alternatively be specified using chmod-like octal
component specification: use 1, 2, 4 for system, queue, and server
respectively, summing to indicate desired combination (e.g., 7 for all).
Can also be specified as a binary vector (e.g., c(1,1,1) for all).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showSkylineSystem</code></td>
<td>
<p>logical; if <code>TRUE</code>, includes number in system
as part of skyline plot.  Value for <code>showSkyline</code>
supersedes this parameter's value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showSkylineQueue</code></td>
<td>
<p>logical; if <code>TRUE</code>, includes number in queue
as part of skyline plot.  Value for <code>showSkyline</code>
supersedes this parameter's value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showSkylineServer</code></td>
<td>
<p>logical; if <code>TRUE</code>, includes number in server
as part of skyline plot.  Value for <code>showSkyline</code>
supersedes this parameter's value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showTitle</code></td>
<td>
<p>if <code>TRUE</code>, display title at the top of the main plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showProgress</code></td>
<td>
<p>if TRUE, displays a progress bar on screen during no-animation execution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotQueueFcn</code></td>
<td>
<p>Plotting function to display Queue visualization.
By default, this is provided by <code>defaultPlotSSQ</code>. Please refer to
the corresponding help for more details about required arguments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotSkylineFcn</code></td>
<td>
<p>Plotting function to display Skyline visualization.
By default, this is provided by <code>defaultPlotSkyline</code>.  Please refer
to the corresponding help for more details about required arguments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jobImage</code></td>
<td>
<p>a vector of URLs/local addresses of images to use as jobs. Requires
package <code>'magick'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotDelay</code></td>
<td>
<p>a positive numeric value indicating seconds between plots.
A value of -1 enters 'interactive' mode, where the state will pause
for user input at each step.  A value of 0 will display only the final
end-of-simulation plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>respectLayout</code></td>
<td>
<p>If TRUE, plot layout (i.e., par, device, etc.) settings will be respected.
Not recommended except for specialized use.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Implements a next-event implementation of a single-queue multiple-server
queue simulation.
</p>
<p>The <code>seed</code> parameter can take one of three valid
argument types:
</p>

<ul>
<li> <p><code>NA</code> (default), which will use the current state of the random
number generator without explicitly setting a new seed (see examples);
</p>
</li>
<li>
<p> a positive integer, which will be used as the initial seed passed in
an explicit call to <code>set.seed</code>; or
</p>
</li>
<li> <p><code>NULL</code>, which will be passed in an explicit call to to
<code>set.seed</code>, thereby setting the initial seed using the
system clock.
</p>
</li>
</ul>
<p>The server selection mechanism can be chosen from among five options, with
<code>"LRU"</code> being the default:
</p>

<ul>
<li> <p><code>"LRU"</code> (least recently used): from among the currently
available (idle) servers, selects the server who has been idle longest.
</p>
</li>
<li> <p><code>"LFU"</code> (least frequently used): from among the currently
available servers, selects the server having the lowest computed
utilization.
</p>
</li>
<li> <p><code>"CYC"</code> (cyclic): selects a server in a cyclic manner; i.e,
indexing the servers 1, 2, <code class="reqn">\ldots</code>, <code>numServers</code> and incrementing
cyclically, starts from one greater than the index of the most recently
engaged server and selects the first idle server encountered.
</p>
</li>
<li> <p><code>"RAN"</code> (random): selects a server at random from among the
currently available servers.
</p>
</li>
<li> <p><code>"ORD"</code> (in order): indexing the servers 1, 2, <code class="reqn">\ldots</code>,
<code>numServers</code>, selects the idle server having the lowest index.
</p>
</li>
</ul>
<h3>Value</h3>

<p>The function returns a list containing:
</p>

<ul>
<li>
<p> the number of arrivals to the system (<code>customerArrivals</code>),
</p>
</li>
<li>
<p> the number of customers processed (<code>customerDepartures</code>),
</p>
</li>
<li>
<p> the ending time of the simulation (<code>simulationEndTime</code>),
</p>
</li>
<li>
<p> average wait time in the queue (<code>avgWait</code>),
</p>
</li>
<li>
<p> average time in the system (<code>avgSojourn</code>),
</p>
</li>
<li>
<p> average number in the system (<code>avgNumInSystem</code>),
</p>
</li>
<li>
<p> average number in the queue (<code>avgNumInQueue</code>), and
</p>
</li>
<li>
<p> server utilization (<code>utilization</code>).
</p>
</li>
</ul>
<p>of the queue as computed by the simulation.
When requested via the “save...” parameters, the list may also contain:
</p>

<ul>
<li>
<p> a vector of interarrival times (<code>interarrivalTimes</code>),
</p>
</li>
<li>
<p> a vector of wait times (<code>waitTimes</code>),
</p>
</li>
<li>
<p> a vector of service times (<code>serviceTimes</code>),
</p>
</li>
<li>
<p> a vector of sojourn times (<code>sojournTimes</code>),
</p>
</li>
<li>
<p> two vectors (time and count) noting changes to number in the system
(<code>numInSystemT</code>, <code>numInSystemN</code>),
</p>
</li>
<li>
<p> two vectors (time and count) noting changes to number in the queue
(<code>numInQueueT</code>, <code>numInQueueN</code>), and
</p>
</li>
<li>
<p> two vectors (time and status) noting changes to server status
(<code>serverStatusT</code>, <code>serverStatusN</code>).
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Barry Lawson (<a href="mailto:blawson@bates.edu">blawson@bates.edu</a>), <br>
Larry Leemis (<a href="mailto:leemis@math.wm.edu">leemis@math.wm.edu</a>), <br>
Vadim Kudlay (<a href="mailto:vkudlay@nvidia.com">vkudlay@nvidia.com</a>)
</p>


<h3>See Also</h3>

<p><code>rstream</code>, <code>set.seed</code>,
<code>stats::runif</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"> # process 100 arrivals, R-provided seed (via NULL seed), default 2 servers
 msq(100, NULL)
 # process 100 arrivals, seed 8675309, 3 servers, LFU server selection
 msq(100, 8675309, 3, 'LFU')

 msq(maxArrivals = 100, seed = 8675309)
 msq(maxTime = 100, seed = 8675309)

 ############################################################################
 # example to show use of seed = NA (default) to rely on current state of generator
 output1 &lt;- msq(200, 8675309, showOutput = FALSE, saveAllStats = TRUE)
 output2 &lt;- msq(300,          showOutput = FALSE, saveAllStats = TRUE)
 set.seed(8675309)
 output3 &lt;- msq(200,          showOutput = FALSE, saveAllStats = TRUE)
 output4 &lt;- msq(300,          showOutput = FALSE, saveAllStats = TRUE)
 sum(output1$sojournTimes != output3$sojournTimes) # should be zero
 sum(output2$sojournTimes != output4$sojournTimes) # should be zero

 ############################################################################
 # use same service function for (default) two servers
 myArrFcn &lt;- function() { vexp(1, rate = 1/4, stream = 1) }               # mean is 4
 mySvcFcn &lt;- function() { vgamma(1, shape = 1, rate = 0.3, stream = 2) }  # mean is 3.3
 output &lt;- msq(maxArrivals = 100, interarrivalFcn = myArrFcn,
     serviceFcn = mySvcFcn, saveAllStats = TRUE)
 mean(output$interarrivalTimes)
 mean(output$serviceTimes)

 ############################################################################
 # use different service function for (default) two servers
 myArrFcn  &lt;- function() { vexp(1, rate = 1/4, stream = 1) }                # mean is 4
 mySvcFcn1 &lt;- function() { vgamma(1, shape = 3, scale = 1.1, stream = 2) }  # mean is 3.3
 mySvcFcn2 &lt;- function() { vgamma(1, shape = 3, scale = 1.2, stream = 3) }  # mean is 3.6
 output &lt;- msq(maxArrivals = 100, interarrivalFcn = myArrFcn,
     serviceFcn = list(mySvcFcn1, mySvcFcn2), saveAllStats = TRUE)
 mean(output$interarrivalTimes)
 meanTPS(output$numInQueueT, output$numInQueueN)  # compute time-averaged num in queue
 mean(output$serviceTimesPerServer[[1]])  # compute avg service time for server 1
 mean(output$serviceTimesPerServer[[2]])  # compute avg service time for server 2
 meanTPS(output$serverStatusT[[1]], output$serverStatusN[[1]])  # compute server 1 utilization
 meanTPS(output$serverStatusT[[2]], output$serverStatusN[[2]])  # compute server 2 utilization

 ############################################################################
 # example to show use of (simple) trace data for arrivals and service times,
 # allowing for reuse of trace data times
 smallQueueTrace &lt;- list()
 smallQueueTrace$arrivalTimes &lt;- c(15, 47, 71, 111, 123, 152, 166, 226, 310, 320)
 smallQueueTrace$serviceTimes &lt;- c(43, 36, 34,  30,  38,  40,  31,  29,  36,  30)

 interarrivalTimes &lt;- NULL
 serviceTimes      &lt;- NULL

 getInterarr &lt;- function()
 {
     if (length(interarrivalTimes) == 0) {
           interarrivalTimes &lt;&lt;- c(smallQueueTrace$arrivalTimes[1],
                                  diff(smallQueueTrace$arrivalTimes))
     }
     nextInterarr &lt;- interarrivalTimes[1]
     interarrivalTimes &lt;&lt;- interarrivalTimes[-1]  # remove 1st element globally
     return(nextInterarr)
 }

 getService &lt;- function()
 {
     if (length(serviceTimes) == 0) {
         serviceTimes &lt;&lt;- smallQueueTrace$serviceTimes
     }
     nextService &lt;- serviceTimes[1]
     serviceTimes &lt;&lt;- serviceTimes[-1]  # remove 1st element globally
     return(nextService)
 }

 output &lt;- msq(maxArrivals = 100, numServers = 2, interarrivalFcn = getInterarr,
               serviceFcn = getService, saveAllStats = TRUE)
 mean(output$interarrivalTimes)
 mean(output$serviceTimes)
 mean(output$serviceTimesPerServer[[1]])  # compute avg service time for server 1
 mean(output$serviceTimesPerServer[[2]])  # compute avg service time for server 2

 ############################################################################
 # Testing with visualization

 # Visualizing msq with a set seed, infinite queue capacity, 10 arrivals,
 # and showing queue (default) and skyline for all 3 attributes
 msq(seed = 1234, numServers = 5, maxArrivals = 10, showSkyline = 7, 
     plotDelay = 0.1)

 # Same simulation as above but using default interactive mode
 if (interactive()) {
   msq(seed = 1234, numServers = 5, maxArrivals = 10, showSkyline = 7)
 }

 # Visualizing msq with a set seed, finite queue capacity, 20 arrivals,
 # and showing queue (default) and skyline for all 3 attributes
 msq(seed = 1234, numServers = 5, maxArrivals = 25, showSkyline = 7,
     maxInSystem = 5, plotDelay = 0)

 # Using default distributions to simulate an M/G/2 queue
 msq(seed = 1234, maxDepartures = 10, 
     interarrivalType = "M", serviceType = "G", plotDelay = 0)

</code></pre>


</div>