<div class="container">

<table style="width: 100%;"><tr>
<td>estN</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate Effective Sample Size</h2>

<h3>Description</h3>

<p>Estimate the effective sample size for catch-at-age or catch-at-length
data, based on the multinomial distribution.
</p>


<h3>Usage</h3>

<pre><code class="language-R">estN(model, what="CAc", series=NULL, init=NULL, FUN=mean, ceiling=Inf,
     digits=0)

estN.int(P, Phat)  # internal function
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>fitted <code>scape</code> model containing catch-at-age and/or
catch-at-length data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>what</code></td>
<td>
<p>name of model element: <code>"CAc"</code>, <code>"CAs"</code>,
<code>"CLc"</code>, or <code>"CLs"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>series</code></td>
<td>
<p>vector of strings indicating which gears or surveys to
analyze (all by default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init</code></td>
<td>
<p>initial sample size, determining the relative pattern of
the effective sample size between years.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FUN</code></td>
<td>
<p>function to standardize the effective sample size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ceiling</code></td>
<td>
<p>largest possible sample size in one year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>number of decimal places to use when rounding, or
<code>NULL</code> to suppress rounding.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>P</code></td>
<td>
<p>observed catch-at-age or catch-at-length matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Phat</code></td>
<td>
<p>fitted catch-at-age or catch-at-length matrix.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>init</code> sample sizes set a fixed pattern for the relative
sample sizes between years. For example, if there are two years of
catch-at-age data and the initial sample sizes are 100 in year 1 and
200 in year 2, the effective sample size will be two times greater in
year 2 than in year 1, although both will be scaled up or down
depending on how closely the model fits the catch-at-age data. The
value of <code>init</code> can be one of the following:
</p>

<dl>
<dt><code>NULL</code></dt>
<dd>
<p>means read the initial sample sizes from the
existing <code>SS</code> column (default).</p>
</dd>
<dt>model</dt>
<dd>
<p>means read the initial sample sizes from the <code>SS</code>
column in that model (object of class <code>scape</code>).</p>
</dd>
<dt>numeric vector</dt>
<dd>
<p>means those are the initial sample sizes (same
length as the number of years).</p>
</dd>
<dt><code>FALSE</code></dt>
<dd>
<p>means ignore the initial sample sizes and use
the empirical multinomial sample size (<code class="reqn">\hat n</code>) in each
year.</p>
</dd>
<dt><code>1</code></dt>
<dd>
<p>means calculate one effective sample size to use
across all years, e.g. the mean or median of <code class="reqn">\hat n</code>.</p>
</dd>
</dl>
<p>The idea behind <code>FUN=mean</code> is to guarantee that regardless of the
value of <code>init</code>, the mean effective sample size will always be
the same. Other functions can be used to a similar effect, such as
<code>FUN=median</code>.
</p>
<p>The <code>estN</code> function is implemented for basic single-sex datasets.
If the data are sex-specific, <code>estN</code> pools (averages) the sexes
before estimating effective sample sizes. The general function
<code>estN.int</code>, on the other hand, is suitable for analyzing any
datasets in <code>matrix</code> format. The ‘<span class="samp">⁠int⁠</span>’ in <code>estN.int</code>
stands for internal (not integer), analogous to <code>rep.int</code>,
<code>seq.int</code>, <code>sort.int</code>, and similar functions.
</p>


<h3>Value</h3>

<p>Numeric vector of effective sample sizes (one value if <code>init=1</code>),
or a list of such vectors when analyzing multiple series.
</p>


<h3>Note</h3>

<p>This function uses the empirical multinomial sample size to estimate
an effective sample size, which may be appropriate as likelihood
weights for catch-at-age and catch-at-length data. The better the
model fits the data, the larger the effective sample size. See
McAllister and Ianelli (1997), Gavaris and Ianelli (2002), and
Magnusson et al. (2013).
</p>
<p><code>estN</code> can be used iteratively, along with
<code>estSigmaI</code> and <code>estSigmaR</code> to assign
likelihood weights that are indicated by the model fit to the data.
Sigmas and sample sizes are then adjusted between model runs, until
they converge. The <code>iterate</code> function facilitates this procedure.
</p>
<p>If <code class="reqn">P_{t,a}</code> is the observed proportion of fish at age (or
length bin) <code class="reqn">a</code> in year <code class="reqn">t</code>, and <code class="reqn">\hat P_{t,a}</code>
is the fitted proportion, then the estimated sample size in that year
is:
</p>
<p style="text-align: center;"><code class="reqn">\hat n_t=\left.\sum_a{\hat P_{t,a}(1-\hat
      P_{t,a})}\right/\sum_a{(P_{t,a}-\hat P_{t,a})^2}</code>
</p>

<p>Due to the non-random and non-independent nature of sampling fish, the
effective sample size, for statistical purposes, is much less than the
number of fish sampled. Common starting points include using the
number of tows as the sample size in each year, or using the empirical
multinomial sample sizes. Those “initial” sample sizes can then
be scaled up or down. Sample sizes between 20 and 200 are common in
the stock assessment literature.
</p>


<h3>References</h3>

<p>Gavaris, S. and Ianelli, J. N. (2002) Statistical issues in fisheries'
stock assessments. <em>Scandinavian Journal of Statistics</em>,
<b>29</b>, 245–271.
</p>
<p>Magnusson, A., Punt, A. E. and Hilborn, R. (2013) Measuring
uncertainty in fisheries stock assessment: the delta method,
bootstrap, and MCMC. <em>Fish and Fisheries</em>, <b>14</b>, 325–342.
</p>
<p>McAllister, M. K. and Ianelli, J. N. (1997) Bayesian stock assessment
using catch-age data and the sampling-importance resampling algorithm.
<em>Canadian Journal of Fisheries and Aquaticic Sciences</em>,
<b>54</b>, 284–300.
</p>


<h3>See Also</h3>

<p><code>getN</code>, <code>getSigmaI</code>, <code>getSigmaR</code>,
<code>estN</code>, <code>estSigmaI</code>, and <code>estSigmaR</code>
extract and estimate sample sizes and sigmas.
</p>
<p><code>iterate</code> combines all the <code>get*</code> and <code>est*</code>
functions in one call.
</p>
<p><code>plotCA</code> and <code>plotCL</code> show what is behind the
sample-size estimation.
</p>
<p><code>scape-package</code> gives an overview of the package.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Exploring candidate sample sizes:

getN(x.sbw)     # sample sizes used in assessment: number of tows
estN(x.sbw)     # effective sample size, given data (tows) and model fit
estN(x.sbw, ceiling=200)  # could use this
estN(x.sbw, init=FALSE)   # from model fit, disregarding tows
plotCA(x.sbw)             # years with good fit =&gt; large sample size
estN(x.sbw, init=1)       # one sample size across all years
estN(x.sbw, init=c(rep(1,14),rep(2,9)))  # two sampling periods

## Same mean, regardless of init:

mean(estN(x.sbw, digits=NULL))
mean(estN(x.sbw, digits=NULL, init=FALSE))
mean(estN(x.sbw, digits=NULL, init=1))
mean(estN(x.sbw, digits=NULL, init=c(rep(1,14),rep(2,9))))

## Same median, regardless of init:

median(estN(x.sbw, FUN=median, digits=NULL))
median(estN(x.sbw, FUN=median, digits=NULL, init=FALSE))
median(estN(x.sbw, FUN=median, digits=NULL, init=1))
median(estN(x.sbw, FUN=median, digits=NULL, init=c(rep(1,14),rep(2,9))))

## Multiple series:

getN(x.ling, "CLc")              # sample size used in assessment
getN(x.ling, "CLc", digits=0)    # rounded
estN(x.ling, "CLc")              # model fit implies larger sample sizes

getN(x.ling, "CLc", series="1", digits=0)  # get one series
estN(x.ling, "CLc", series="1")            # estimate one series
</code></pre>


</div>