<div class="container">

<table style="width: 100%;"><tr>
<td>sleepwalk</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Interactively explore one or several 2D embeddings</h2>

<h3>Description</h3>

<p>A function to interactively explore a 2D embedding of some higher-dimensional
point cloud, as produced by a dimension reduction method such as MDS, t-SNE, or the like.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sleepwalk(
  embeddings,
  featureMatrices = NULL,
  maxdists = NULL,
  pointSize = 1.5,
  titles = NULL,
  distances = NULL,
  same = c("objects", "features"),
  compare = c("embeddings", "distances"),
  saveToFile = NULL,
  ncol = NULL,
  nrow = NULL,
  on_selection = NULL,
  mode = c("canvas", "svg"),
  metric = "euclid",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>embeddings</code></td>
<td>
<p>either an <code class="reqn">n x 2</code> embedding matrix (where <code class="reqn">n</code> is a number of points) or
a list of <code class="reqn">n_i x 2</code> matrices - one for each embedding. If <code>same = "objects"</code> all embedding
matrices must have the same number of rows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>featureMatrices</code></td>
<td>
<p>either an <code class="reqn">n x m</code> matrix of point coordinates in the feature-dimension
space or a list of such matrices - one for each embedding. The displayed distances will be calculated 
as Euclidean distances of the rows of these matrices. Alternatively, if <code>same = "objects"</code>
it is possible to provide the distances directly via the <code>distances</code> argument. 
If <code>same = "features"</code> then all the points must be from the same feature space and therefore
have the same number of columns. It is possible to use one feature matrix for all the embeddings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxdists</code></td>
<td>
<p>a vector of the maximum distances (in feature space) for each provided feature or
distance matrix that should still be covered by the colour 
scale; higher distances are shown in light gray. This values can be changed later interactively.
If not provided, maximum distances will be estimated automatically as median value of the 
distances.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pointSize</code></td>
<td>
<p>size of the points on the plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>titles</code></td>
<td>
<p>a vector of titles for each embedding. Must be the same length as the list of 
<code>embeddings</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distances</code></td>
<td>
<p>distances (in feature space) between points that should be displayed as colours.
This is an alternative to <code>featureMatrices</code> if <code>same = "objects"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>same</code></td>
<td>
<p>defines what kind of distances to show; must be either <code>"objects"</code> or <code>"features"</code>.
Use <code>same = "objects"</code> when all the embeddings show the same set of points. In this case,
each embedding is colored to show the distance of the selected point to all other points.
The same or different features can be supplied as <code>featureMatrices</code>, to use the same or different distances
in the different embeddings.
<code>same = "features"</code>
is used to compare different sets of points (e.g. samples from different patients, or different batches) 
in the same feature space. In this case the distance is calculated from the selected point to all other 
points (including those in other embeddings).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compare</code></td>
<td>
<p>defines what kind of comparison to perform; must be either <code>"embeddings"</code> or
<code>"distances"</code>. If <code>compare == "embeddings"</code>, then in each of the displayed embeddings
all the points will be coloured the same way, even if different feature or distance matrices are provided. 
This allows one to immediately identify the corresponding points and neighbourhoods in each of the embeddings.
If <code>commpare == "distances"</code>, point colours for each embedding are calculated independently. This allows, 
for instance, to compare different metrics or show an additional layer of information, when exploring an
embedding. This parameter has no effect if <code>same == "features"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveToFile</code></td>
<td>
<p>path to the .html file where to save the plots. The resulting page will be fully interactive
and contain all the data. If this is <code>NULL</code>, than the plots will be shown as the web page in your 
default browser. Note, that if you try to save that page, using your browser's functionality,
it'll become static.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncol</code></td>
<td>
<p>number of columns in the table, where all the embeddings are placed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrow</code></td>
<td>
<p>number of rows in the table, where all the embeddings are placed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>on_selection</code></td>
<td>
<p>a callback function that is called every time the user selects a group of points in
the web browser. From the <code>sleepwalk</code> app it gets two arguments: The first one is a vector of indices of
all the selected points and the second one is an index of an embedding from where the points were selected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mode</code></td>
<td>
<p>defines whether to use Canvas or SVG to display points. Using Canvas is faster and allows to plot 
more points simultaneously, yet we currently consider SVG mode to be more stable and vigorously tested. In future
versions SVG mode will be deprecated. Must be one of <code>canvas</code> or <code>svg</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>specifies what metric to use to calculate distances from feature matrices. Currently only Euclidean 
(<code>"euclid"</code>, default) and cosine (<code>"cosine"</code>) are supported. This can be a single string (then the selected
metric is used for all the charts) or a vector of strings - one per each chart.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to <code>openPage</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function opens a browser window and displays the embeddings as point clouds. When the user
moves the mouse over a point, the point gets selected and all data points change colour such
that their colour indicates
the feature-space distance to the point under the mouse cursor. This allows to quickly and
intuitively check how tight clusters are, how faithful the embedding is, and how similar
the clusters are to each other.
</p>


<h3>Value</h3>

<p>None.
</p>


<h3>Author(s)</h3>

<p>Simon Anders, Svetlana Ovchinnikova
</p>


<h3>References</h3>

<p>doi: <a href="https://doi.org/10.1101/603589">10.1101/603589</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#generate cockscrew-shaped 3D data with 3 additional noisy dimensions
ts &lt;- c(rnorm(100), rnorm(200, 5), rnorm(150, 13), runif(200, min = -5, max = 20))

a &lt;- 3
w &lt;- 1

points &lt;- cbind(30*cos(w * ts), 30*sin(w * ts), a * ts)

ndim &lt;- 6
noise &lt;- cbind(matrix(rnorm(length(ts) * 3, sd = 5), ncol = 3),
               matrix(rnorm(length(ts) * (ndim - 3), sd = 10), ncol = ndim - 3))

data &lt;- noise
data[, 1:3] &lt;- data[, 1:3] + points

pca &lt;- prcomp(data)

#compare Euclidean distance with the real position on the helix
sleepwalk(list(pca$x[, 1:2], pca$x[, 1:2]), list(data, as.matrix(ts)), 
          compare = "distances", pointSize = 3)
#the same, but with saving the web page to an HTML file
sleepwalk(list(pca$x[, 1:2], pca$x[, 1:2]), list(data, as.matrix(ts)), 
          compare = "distances", pointSize = 3,
          saveToFile = paste0(tempdir(), "/test.html"))

  
</code></pre>


</div>