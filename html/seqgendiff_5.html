<div class="container">

<table style="width: 100%;"><tr>
<td>fix_cor</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fixes an invalid target correlation.</h2>

<h3>Description</h3>

<p>Shrinks the target correlation using a uniform scaling factor so that
the overall correlation matrix is positive semi-definite. The method
is described in detail in Gerard (2020).
</p>


<h3>Usage</h3>

<pre><code class="language-R">fix_cor(design_perm, target_cor, num_steps = 51)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>design_perm</code></td>
<td>
<p>A numeric design matrix whose rows are to be permuted
(thus controlling the amount by which they are correlated with the
surrogate variables). The rows index the samples and the columns index
the variables. The intercept should <em>not</em> be included
(though see Section "Unestimable Components").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_cor</code></td>
<td>
<p>A numeric matrix of target correlations between the
variables in <code>design_perm</code> and the surrogate variables. The
rows index the observed covariates and the columns index the surrogate
variables. That is, <code>target_cor[i, j]</code> specifies the target
correlation between the <code>i</code>th column of <code>design_perm</code> and the
<code>j</code>th surrogate variable. The surrogate variables are estimated
either using factor analysis or surrogate variable analysis (see the
parameter <code>use_sva</code>).
The number of columns in <code>target_cor</code> specifies the number of
surrogate variables. Set <code>target_cor</code> to <code>NULL</code> to indicate
that <code>design_perm</code> and the surrogate variables are independent.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_steps</code></td>
<td>
<p>The number of steps between 0 and 1 to take in the
grid search for the shrinkage factor. The step-size would be
<code>1 / (num_steps - 1)</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Let <code class="reqn">W</code> = <code>cor(design_perm)</code>. Let <code class="reqn">R</code> = <code>target_cor</code>.
Then the overall correlation matrix is:
</p>
<p style="text-align: center;"><code class="reqn"> \left(
\begin{array}{cc}
W  &amp; R\\
R' &amp; I_K
\end{array}
\right).
</code>
</p>

<p>This function applies a multiplicative scaling factor to <code class="reqn">R</code> until
the above matrix is positive semi-definite. That is, it finds <code class="reqn">a</code>
between 0 and 1 such that
</p>
<p style="text-align: center;"><code class="reqn"> \left(
\begin{array}{cc}
W  &amp; aR\\
aR' &amp; I_K
\end{array}
\right)
</code>
</p>

<p>is positive semi-definite.
</p>


<h3>Value</h3>

<p>A matrix of correlations the same dimension as <code>target_cor</code>.
Actually, the returned matrix is <code>a * target_cor</code>, where <code>a</code>
was determined to make the overall correlation matrix positive
semi-definite.
</p>


<h3>Author(s)</h3>

<p>David Gerard
</p>


<h3>References</h3>


<ul><li>
<p>Gerard, D (2020). "Data-based RNA-seq simulations by binomial thinning." <em>BMC Bioinformatics</em>. 21(1), 206. <a href="https://doi.org/10.1186/s12859-020-3450-9">doi:10.1186/s12859-020-3450-9</a>.
</p>
</li></ul>
<h3>Examples</h3>

<pre><code class="language-R">n &lt;- 10
design_perm &lt;- matrix(rep(c(0, 1), length.out = n))
target_cor &lt;- matrix(seq(1, 0, length.out = 10), nrow = 1)
new_cor &lt;- seqgendiff:::fix_cor(design_perm = design_perm, target_cor = target_cor)
new_cor / target_cor

## In the case of one observed covariate, the requirement is just that
## the sum of squared correlations is less than or equal to one.
sum(target_cor ^ 2)
sum(new_cor ^ 2)
</code></pre>


</div>