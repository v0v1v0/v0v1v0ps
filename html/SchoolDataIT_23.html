<div class="container">

<table style="width: 100%;"><tr>
<td>Map_DB</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Map school data</h2>

<h3>Description</h3>

<p>This function displays a map of the data arranged trough the function <code>Set_DB</code>.
It supports two kinds of map:
</p>

<ul>
<li>
<p> Interactive map (default option), which allows the user to visualize all the data in scope through the interactive popup, and
</p>
</li>
<li>
<p> Static map (ggplot), which can be easily exported in <code>.pdf</code> objects.
</p>
</li>
</ul>
<p>The user must select a variable to display.
It is possible to insert either a readily-downloaded database obtained through the function <code>Set_DB</code> or the basic inputs to plug in that function, other than an input shapefile. Relevant arguments not provided by the user will be download automatically, but not saved into the global environment. However we suggest to plug in at least some inputs, as otherwise the running time may be long.
This function generalises the functionalities of the more data-specific functions <code>Map_School_Buildings</code> and <code>Map_Invalsi</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Map_DB(
  data = NULL,
  Year = 2023,
  field,
  level = "LAU",
  plot = "mapview",
  popup_height = 200,
  col_rev = FALSE,
  pal = "Blues",
  input_shp = NULL,
  region_code = c(1:20),
  main_pos = "top",
  main = "",
  order = NULL,
  autoAbort = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Object of class <code>tbl.df</code>, <code>tbl</code> and <code>data.frame</code>, obtained as output of the <code>Set_DB</code> function. If NULL, it will be arranged automatically but not saved into the global environment. NULL by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Year</code></td>
<td>
<p>Numeric or Character. The reference school year, needed if either <code>data</code> or <code>input_shp</code> are not provided.
Available in the formats: <code>2023</code>, <code>"2022/2023"</code>, <code>202223</code>, <code>20222023</code>.  <code>2023</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>field</code></td>
<td>
<p>Character. The variable to display in the map.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>Character. The administrative level of detailed at which the target variable must be displayed. Either <code>"LAU"</code>/<code>"Municipality"</code> or <code>"NUTS-3"</code>/<code>"Province"</code>. If the <code>"data"</code> argument is plugged in, please select the same level. <code>"LAU"</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>Character. The type of map to display; either <code>"mapview"</code> for interactive maps, or <code>"ggplot"</code> for static maps. <code>"mapview"</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popup_height</code></td>
<td>
<p>Numeric. The height of the popup table in terms of pixels if the <code>"mapview"</code> mode is chosen. <code>200</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col_rev</code></td>
<td>
<p>Logical. Whether the scale of the colour palette should be reverted or not. <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pal</code></td>
<td>
<p>Character. The palette to use if the <code>"mapview"</code> mode is chose. <code>"Blues"</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_shp</code></td>
<td>
<p>Object of class <code>sf</code>, <code>tbl.df</code>, <code>tbl</code> and <code>data.frame</code>. The relevant shapefiles of Italian administrative boundaries,
at the selected level of detail (LAU or NUTS-3). If <code>NULL</code>, it is downloaded automatically but not saved in the global environment. <code>NULL</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>region_code</code></td>
<td>
<p>Numeric. The NUTS-2 codes of the units that must be displayed.
If the level is set to <code>"LAU"</code>, choosing a limited number of regions is recommended.
By default, <code>c(1,3,5:20)</code>, i.e. all Italian regions except the provinces of Aosta, Trento and Bozen which have data availability issues.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main_pos</code></td>
<td>
<p>Character.Where the header should be placed if the <code>ggplot</code> mode is chosen.
The header is located on the top if <code>"top"</code> is given as input, and above the legend scale otherwise. <code>"top"</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>Character. The title to display in the <code>"ggplot"</code> rendering options.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>Character. The educational level. Either <code>"Primary"</code> (primary school), <code>"Middle"</code> (middle school), or <code>"High"</code> (high school).
If the data include the Invalsi census survey, please select a level consistent with the chosen educational grade. <code>"Media"</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autoAbort</code></td>
<td>
<p>Logical. In case any data must be retrieved, whether to automatically abort the operation and return NULL in case of missing internet connection or server response errors. <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments for the input database, if not provided; see <code>Set_DB</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>If <code>plot == "mapview"</code>, an object of class <code>mapview</code>. Otherwise, if <code>plot == "ggplot"</code>, an object of class <code>gg</code> and <code>ggplot</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">


DB23 &lt;- Set_DB(Year = 2023, level = "NUTS-3",
       Invalsi_grade = c(10,13), NA_autoRM = TRUE,
       input_Invalsi_IS = example_Invalsi23_prov, input_nstud = example_input_nstud23,
       input_InnerAreas = example_InnerAreas,
       input_School2mun = example_School2mun23,
       input_AdmUnNames = example_AdmUnNames20220630,
       nteachers = FALSE, BroadBand = FALSE, SchoolBuildings = FALSE)




Map_DB(DB23, field = "Students_per_class_13", input_shp = example_Prov22_shp, level = "NUTS-3",
 col_rev = TRUE, plot = "ggplot")

Map_DB(DB23, field = "Inner_area", input_shp = example_Prov22_shp, order = "High",
 level = "NUTS-3",col_rev = TRUE, plot = "ggplot")

Map_DB(DB23, field = "M_Mathematics_10", input_shp = example_Prov22_shp, level = "NUTS-3",
 plot = "ggplot")


</code></pre>


</div>