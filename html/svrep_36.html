<div class="container">

<table style="width: 100%;"><tr>
<td>rescale_reps</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Rescale replicate factors</h2>

<h3>Description</h3>

<p>Rescale replicate factors.
The main application of this rescaling is to ensure
that all replicate weights are strictly positive.
</p>
<p>Note that this rescaling has no impact on variance estimates for totals (or other linear statistics),
but variance estimates for nonlinear statistics will be affected by the rescaling.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rescale_reps(x, tau = NULL, min_wgt = 0.01, digits = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Either a replicate survey design object,
or a numeric matrix of replicate weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>Either a single positive number, or <code>NULL</code>. 
This is the rescaling constant <code class="reqn">\tau</code> used in the transformation 
<code class="reqn">\frac{w + \tau - 1}{\tau}</code>,
where <code class="reqn">w</code> is the original weight. <br>
If <code>tau=NULL</code> or is left unspecified, 
then the argument <code>min_wgt</code> should be used instead,
in which case, <code class="reqn">\tau</code> is automatically set to the smallest value needed to rescale
the replicate weights such that they are all at least <code>min_wgt</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_wgt</code></td>
<td>
<p>Should only be used if <code>tau=NULL</code> or <code>tau</code> is left unspecified. 
Specifies the minimum acceptable value for the rescaled weights,
which will be used to automatically determine the value <code class="reqn">\tau</code> used
in the transformation <code class="reqn">\frac{w + \tau - 1}{\tau}</code>,
where <code class="reqn">w</code> is the original weight.
Must be at least zero and must be less than one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>Only used if the argument <code>min_wgt</code> is used. 
Specifies the number of decimal places
to use for choosing <code>tau</code>. Using a smaller number of <code>digits</code>
is useful simply for producing easier-to-read documentation.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Let <code class="reqn">\mathbf{A} = \left[ \mathbf{a}^{(1)} \cdots \mathbf{a}^{(b)} \cdots \mathbf{a}^{(B)} \right]</code> denote the <code class="reqn">(n \times B)</code> matrix of replicate adjustment factors.
To eliminate negative adjustment factors, Beaumont and Patak (2012) propose forming a rescaled matrix of nonnegative replicate factors <code class="reqn">\mathbf{A}^S</code> by rescaling each adjustment factor <code class="reqn">a_k^{(b)}</code> as follows:
</p>
<p style="text-align: center;"><code class="reqn">
   a_k^{S,(b)} = \frac{a_k^{(b)} + \tau - 1}{\tau}
 </code>
</p>

<p>where <code class="reqn">\tau \geq 1 - a_k^{(b)} \geq 1</code> for all <code class="reqn">k</code> in <code class="reqn">\left\{ 1,\ldots,n \right\}</code> and all <code class="reqn">b</code> in <code class="reqn">\left\{1, \ldots, B\right\}</code>.
</p>
<p>The value of <code class="reqn">\tau</code> can be set based on the realized adjustment factor matrix <code class="reqn">\mathbf{A}</code> or by choosing <code class="reqn">\tau</code> prior to generating the adjustment factor matrix <code class="reqn">\mathbf{A}</code> so that <code class="reqn">\tau</code> is likely to be large enough to prevent negative adjustment factors.
</p>
<p>If the adjustment factors are rescaled in this manner, it is important to adjust the scale factor used in estimating the variance with the bootstrap replicates.
For example, for bootstrap replicates, the adjustment factor becomes <code class="reqn">\frac{\tau^2}{B}</code> instead of <code class="reqn">\frac{1}{B}</code>.
</p>
<p style="text-align: center;"><code class="reqn">
 \textbf{Prior to rescaling: } v_B\left(\hat{T}_y\right) = \frac{1}{B}\sum_{b=1}^B\left(\hat{T}_y^{*(b)}-\hat{T}_y\right)^2
 </code>
</p>

<p style="text-align: center;"><code class="reqn">
 \textbf{After rescaling: } v_B\left(\hat{T}_y\right) = \frac{\tau^2}{B}\sum_{b=1}^B\left(\hat{T}_y^{S*(b)}-\hat{T}_y\right)^2
</code>
</p>



<h3>Value</h3>

<p>If the input is a numeric matrix, returns the rescaled matrix.
If the input is a replicate survey design object, returns an updated replicate survey design object.
</p>
<p>For a replicate survey design object, results depend on
whether the object has a matrix of replicate factors rather than
a matrix of replicate weights (which are the product of replicate factors and sampling weights).
If the design object has <code>combined.weights=FALSE</code>,
then the replication factors are adjusted.
If the design object has <code>combined.weights=TRUE</code>,
then the replicate weights are adjusted. It is strongly
recommended to only use the rescaling method for replication factors
rather than the weights.
</p>
<p>For a replicate survey design object, the <code>scale</code> element
of the design object will be updated appropriately,
and an element <code>tau</code> will also be added.
If the input is a matrix instead of a survey design object,
the result matrix will have an attribute named <code>tau</code>
which can be retrieved using <code>attr(x, 'tau')</code>.
</p>


<h3>References</h3>

<p>This method was suggested by Fay (1989) for the specific application
of creating replicate factors using his generalized replication method.
Beaumont and Patak (2012) provided an extended discussion on this rescaling
method in the context of rescaling generalized bootstrap replication factors
to avoid negative replicate weights.
</p>
<p>The notation used in this documentation is taken from Beaumont and Patak (2012).
</p>
<p>- Beaumont, Jean-François, and Zdenek Patak. 2012.
"On the Generalized Bootstrap for Sample Surveys with Special Attention to Poisson Sampling: Generalized Bootstrap for Sample Surveys."
International Statistical Review 80 (1): 127–48.
https://doi.org/10.1111/j.1751-5823.2011.00166.x.
<br><br>
- Fay, Robert. 1989. "Theory And Application Of Replicate Weighting For Variance Calculations."
In, 495–500. Alexandria, VA: American Statistical Association.
http://www.asasrms.org/Proceedings/papers/1989_033.pdf
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example 1: Rescaling a matrix of replicate weights to avoid negative weights

 rep_wgts &lt;- matrix(
   c(1.69742746694909, -0.230761178913411, 1.53333377634192,
     0.0495043413294782, 1.81820367441039, 1.13229198793703,
     1.62482013925955, 1.0866133494029, 0.28856654131668,
     0.581930729719006, 0.91827012312825, 1.49979905894482,
     1.26281337410693, 1.99327362761477, -0.25608700039304),
   nrow = 3, ncol = 5
 )

 rescaled_wgts &lt;- rescale_reps(rep_wgts, min_wgt = 0.01)

 print(rep_wgts)
 print(rescaled_wgts)
 
 # Example 2: Rescaling replicate weights with a specified value of 'tau'
 
 rescaled_wgts &lt;- rescale_reps(rep_wgts, tau = 2)
 print(rescaled_wgts)

 # Example 3: Rescaling replicate weights of a survey design object
 set.seed(2023)
 library(survey)
 data('mu284', package = 'survey')

 ## First create a bootstrap design object
 svy_design_object &lt;- svydesign(
   data = mu284,
   ids = ~ id1 + id2,
   fpc = ~ n1 + n2
 )

 boot_design &lt;- as_gen_boot_design(
   design = svy_design_object,
   variance_estimator = "Stratified Multistage SRS",
   replicates = 5, tau = 1
 )

 ## Rescale the weights
 rescaled_boot_design &lt;- boot_design |&gt;
   rescale_reps(min_wgt = 0.01)

 boot_wgts &lt;- weights(boot_design, "analysis")
 rescaled_boot_wgts &lt;- weights(rescaled_boot_design, 'analysis')

 print(boot_wgts)
 print(rescaled_boot_wgts)
</code></pre>


</div>