<div class="container">

<table style="width: 100%;"><tr>
<td>scalpelStep2</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Perform Step 2 of SCALPEL.</h2>

<h3>Description</h3>

<p>This step involves refinement of the spatial component dictionary from Step 1. We eliminate redundancy
in the spatial component dictionary by clustering together preliminary dictionary elements that represent
the same neuron, based on spatial and temporal information.
</p>


<h3>Usage</h3>

<pre><code class="language-R">scalpelStep2(step1Output, cutoff = 0.18, omega = 0.2, maxSizeToCluster = 3000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>step1Output</code></td>
<td>
<p>An object of class <code>scalpel</code> or <code>scalpelStep1</code>, which result from running the
<code>scalpel</code> or <code>scalpelStep1</code> functions, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>A value in [0,1] indicating where to cut the dendrogram that results from hierarchical clustering
of the preliminary dictionary elements. The default value is 0.18.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omega</code></td>
<td>
<p>A value in [0,1] indicating how to weight spatial vs. temporal information in the dissimilarity metric
used for clustering. If <code>omega=1</code>, only spatial information is used. The default value is 0.2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxSizeToCluster</code></td>
<td>
<p>Optional advanced user argument: The maximum number of preliminary dictionary elements to cluster at once. We attempt to cluster each
overlapping set of preliminary dictionary elements, but if one of these sets is very large (e.g., &gt;10,000), memory issues may
result. Thus we perform a two-stage clustering in which we first cluster together random sets of size
approximately equaling <code>maxSizeToCluster</code> and then cluster together the representatives from the first stage.
Finally, we recalculate the representatives using all of the preliminary dictionary elements in the final clusters. The default value is 3000.
If <code>maxSizeToCluster</code> is set to <code>NULL</code>, single-stage clustering is done, regardless of the size of the overlapping sets.
Memory issues may result when using this option to force single-stage clustering if the size of
the largest overlapping set of preliminary dictionary elements is very large (e.g., &gt;10,000).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Several files containing data from this step and a summary of the step are saved in the folder
"outputFolder/Step1_version/Step2_omega_omega_cutoff_cutoff" where <code>version</code> is a 5-digit unique
identifier that is automatically generated in Step 1 and <code>omega</code> and <code>cutoff</code> are the user-supplied parameters.
</p>


<h3>Value</h3>

<p>An object of class <code>scalpelStep2</code>, which can be summarized using <code>summary</code>, used to run SCALPEL Step 3 using <code>scalpelStep3</code>,
or can be used with the plotting functions <code>plotCluster</code> and <code>plotSpatial</code>.
</p>

<ul>
<li>
<p><code>A</code>: A matrix containing the dictionary elements, where the ith column of <code>A</code>
is a vector of 1's and 0's, indicating whether each pixel is contained in the ith dictionary element.
</p>
</li>
<li>
<p><code>repComps</code>: A vector where the ith element indicates which preliminary dictionary element is the ith representive
component. That is, <code>A[,i]=step1Output$Azero[,repComps[i]]</code>.
</p>
</li>
<li>
<p><code>clusterID</code>: A vector whose ith element indicates which of the dictionary elements in <code>A</code> is the
representative for the ith preliminary dictionary element.
</p>
</li>
<li>
<p><code>overlapSetID</code>: A vector indicating which preliminary dictionary elements overlap, with the ith element
giving the group index for the ith preliminary dictionary element.
</p>
</li>
<li>
<p><code>treeList</code>: A list of length <code>max(overlapSetID)</code> with the ith element containing an object of class <code>protoclust</code> corresponding
to prototype clustering for the preliminary dictionary elements with <code>overlapSetID=i</code>. If two-stage clustering was done for a
particular set, then the element will be <code>NULL</code>.
</p>
</li>
<li>
<p>Other elements: As specified by the user or returned from a previous step.
</p>
</li>
</ul>
<h3>See Also</h3>

<p>The entire SCALPEL pipeline can be implemented using the <code>scalpel</code> function. The
other steps in the pipeline can be run using the <code>scalpelStep0</code>, <code>scalpelStep1</code>, <code>scalpelStep3</code> functions.
Results from this step can be summarized using <code>summary</code>, loaded at a later time using <code>getScalpelStep2</code>, and plotted using
<code>plotCluster</code> and <code>plotSpatial</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
### many of the functions in this package are interconnected so the
### easiest way to learn to use the package is by working through the vignette,
### which is available at ajpete.com/software

#assumes you have run the example for the "scalpelStep1" function

#run Step 2 of SCALPEL
Step2Out = scalpelStep2(step1Output = Step1Out)
summary(Step2Out)

## End(Not run)
</code></pre>


</div>