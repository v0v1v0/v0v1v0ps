<div class="container">

<table style="width: 100%;"><tr>
<td>secr.test</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Goodness-of-Fit Test</h2>

<h3>Description</h3>

<p>Simple Monte-Carlo goodness-of-fit tests for full-likelihood SECR
models. The approach is to calculate a statistic from either the raw
data or a fitted model, and to relate this to the distribution of the
statistic under the original fitted model. The distribution is
estimated by simulating data from the model, and possibly re-fitting
the model to each simulated dataset.
</p>
<p>The suitability of different test statistics has yet to be assessed. 
An alternative and possibly more informative set of tests is provided 
in function <code>MCgof</code> that implements the approach of 
Choo et al. (2024) for a range of models.
</p>


<h3>Usage</h3>

<pre><code class="language-R">
secr.test(object, nsim = 99, statfn, fit = FALSE, seed =
NULL, ncores = NULL, tracelevel = 1, ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>a fitted secr model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>integer number of replicates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statfn</code></td>
<td>
<p>function to compute a numeric vector of one or more statistics from a
single-session ‘capthist’ object or from a fitted model (see Details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>logical; if TRUE the model is re-fitted to each simulated
dataset</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>either NULL or an integer that will be used in a call to <code>set.seed</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>integer number of threads for parallel processing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tracelevel</code></td>
<td>
<p> see <code>sim.secr</code> </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments passed to statfn, if needed</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The test statistic(s) may be computed either on a dataset or on a
fitted model, as determined by the argument <code>fit</code>. The single
argument expected by <code>statfn</code> should be either a ‘capthist’ object
(<code>fit = FALSE</code>) or an ‘secr’ object (<code>fit = TRUE</code>).
</p>
<p>The default statistic when <code>fit = FALSE</code> is the proportion of
individuals observed on only one occasion, which is equivalent to
<code>statfn = function(CH) c(f1 = sum(apply(abs(CH) &gt; 0,1,sum) == 1) /
nrow(CH))</code>. Repeat detections on one occasion at the same or different
detectors are not counted. The default statistic is therefore not
appropriate for some data, specifically from ‘count’ or ‘polygon’
detectors with few occasions or only one.
</p>
<p>The default statistic when <code>fit = TRUE</code> is the deviance divided by
the residual degrees of freedom (i.e., <code>statfn = function(object)
  c(devdf = deviance(object) / df.residual(object))</code>). 
</p>
<p>The reported probability (p) is the rank of the observed value in the
vector combining the observed value and simulated values, divided by
(nsim + 1). Ranks are computed with <code>rank</code> using the default
<code>ties.method = "average"</code>.
</p>
<p>Simulations take account of the usage attribute of detectors in the
original capthist object, given that usage was defined and ignoreusage was not
set.
</p>
<p>Setting <code>ncores = NULL</code> uses the existing value from the environment variable 
RCPP_PARALLEL_NUM_THREADS (see <code>setNumThreads</code>).
</p>
<p><code>statfn</code> may return a vector of statistics for each observed or
simulated dataset or model: then the value of each statistic will be
calculated for every simulated dataset, and summarised. If <code>fit =
TRUE</code> the vector of statistics may include both those computed on the
raw data (object$capthist) and the fitted model. 
</p>


<h3>Value</h3>

<p>An object of class <code>c('secrtest','list')</code> with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>as input</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>as input</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statfn</code></td>
<td>
<p>as input</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>as input</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>as input</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>list comprising the simulated values,
the observed value(s), and estimated probabilities</p>
</td>
</tr>
</table>
<p>For multi-session input when <code>fit = FALSE</code>, ‘output’ is a list
in which each session provides one component.
</p>
<p>Print and plot methods are provided for ‘secrtest’ objects.
</p>


<h3>Note</h3>

<p><code>simulate.secr</code> is always used to simulate the raw data, but
<code>simulate.secr</code> does not work for all types of fitted
model. Models fitted by maximizing the likelihood conditional on
<code class="reqn">n</code> (<code>CL = TRUE</code> in <code>secr.fit</code>) potentially include
individual covariates whose distribution in the population is
unknown. This precludes simulation, and conditional-likelihood models
in general are therefore not covered by <code>secr.test</code>.
</p>
<p>Other exclusions include exotic non-binary behavioural responses
(“bn", “bkn", “bkc", “Bkc" - but these are generally undocumented
in any case).
</p>
<p>If <code>fit = TRUE</code> then <code>sim.secr</code> is used.
</p>
<p>At each simulation a new population is generated across the extent of
the original mask. If the extent is unduly large then time will be
wasted simulating the possibility of detection for many essentially
undetectable animals. This is an argument for keeping the mask tight -
large enough only to avoid mask-induced bias.
</p>


<h3>References</h3>

<p>Choo, Y. R., Sutherland, C. and Johnston, A. (2024) A Monte Carlo resampling 
framework for implementing goodness-of-fit tests in spatial capture-recapture model
<em>Methods in Ecology and Evolution</em> DOI: 10.1111/2041-210X.14386.
</p>


<h3>See Also</h3>

<p><code>MCgof</code>,
<code>print.secrtest</code>,
<code>plot.secrtest</code>,
<code>simulate.secr</code>,
<code>sim.secr</code>,
<code>deviance.secr</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 

secr.test(secrdemo.0, nsim = 99)

secr.test(ovenbird.model.1, nsim = 20)

## example combining raw data summary and model fit
## assumes single-session
bothfn &lt;- function(object) {
    CH &lt;- object$capthist
    f1 &lt;- sum(apply(abs(CH) &gt; 0, 1, sum) == 1) / nrow(CH)
    devdf &lt;- deviance(object) / df.residual(object)
    c(f1 = f1, devdf = devdf)
}
test &lt;- secr.test (secrdemo.0, nsim = 19, statfn = bothfn, fit = TRUE)
test
plot(test, main = '')


## End(Not run)

</code></pre>


</div>