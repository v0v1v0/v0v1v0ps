<div class="container">

<table style="width: 100%;"><tr>
<td>simulate.fitStMoMo</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate future sample paths from a Stochastic Mortality Model</h2>

<h3>Description</h3>

<p>Simulate future sample paths from a Stochastic Mortality Model.
The period indexes <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are modelled
using ether a Multivariate Random Walk with Drift (MRWD) or 
<code class="reqn">N</code> independent ARIMA<code class="reqn">(p, d, q)</code> models. The cohort index 
<code class="reqn">\gamma_{t-x}</code> is modelled using an ARIMA<code class="reqn">(p, d, q)</code>. 
By default an ARIMA<code class="reqn">(1, 1, 0)</code> with a constant is used.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'fitStMoMo'
simulate(object, nsim = 1000, seed = NULL, h = 50,
  oxt = NULL, gc.order = c(1, 1, 0), gc.include.constant = TRUE,
  jumpchoice = c("fit", "actual"), kt.method = c("mrwd", "iarima"),
  kt.order = NULL, kt.include.constant = TRUE, kt.lookback = NULL,
  gc.lookback = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>number of sample paths to simulate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>either <code>NULL</code> or an integer that will be used in a 
call to <code>set.seed</code> before simulating the time series. 
The default, <code>NULL</code> will not change the random generator state.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>number of years ahead to forecast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oxt</code></td>
<td>
<p>optional matrix/vector or scalar of known offset to be 
added in the simulations. This can be used to specify any a priori 
known component to be added to the simulated predictor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc.order</code></td>
<td>
<p>a specification of the ARIMA model for the cohort effect: 
the three components <code class="reqn">(p, d, q)</code> are the AR order, the degree of 
differencing, and the MA. The default is an ARIMA<code class="reqn">(1, 1, 0)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc.include.constant</code></td>
<td>
<p>a logical value indicating if the ARIMA model
should include a constant value. The default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jumpchoice</code></td>
<td>
<p>option to select the jump-off rates, i.e. the rates 
from the final year of observation, to use in projections of mortality 
rates. <code>"fit"</code>(default) uses the fitted rates and <code>"actual"</code> 
uses the actual rates from the final year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.method</code></td>
<td>
<p>optional forecasting method for the period index. 
The alternatives are <code>"mrwd"</code>(default) and <code>"iarima"</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.order</code></td>
<td>
<p>an optional matrix with one row per period index
specifying the ARIMA models: for the ith row (ith period index) the three 
components <code class="reqn">(p, d, q)</code> are the AR order, the degree of  differencing, 
and the MA order. If absent the arima models are fitted using 
<code>auto.arima</code>. This argument is only used when
<code>kt.method</code> is <code>"iarima"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.include.constant</code></td>
<td>
<p>an optional vector of logical values 
indicating if the ARIMA model for the ith period index should include a 
constant value. The default is <code>TRUE</code>.  This argument is only used 
when <code>kt.method</code> is <code>"iarima"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the time series model for the period indexes. By 
default all the estimated values are used. If 
<code>kt.lookback</code> is provided then the last <code>kt.lookback</code> 
years of <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the ARIMA model for the cohort effect. By 
default all the estimated values are used in estimating the ARIMA 
model. If <code>gc.lookback</code> is provided then the last 
<code>gc.lookback</code> years of <code class="reqn">\gamma_{t-x}</code> are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If <code>kt.method</code> is <code>"mrwd"</code>, fitting and simulation of 
the time series model for the  period indexes is done with a 
Multivariate Random Walk with Drift using the function 
<code>mrwd</code>.
</p>
<p>If <code>kt.method</code> is <code>"iarima"</code>, fitting and simulation of 
the time series model for the  period indexes is done with <code class="reqn">N</code> 
independent arima models using the function <code>iarima</code>. 
See this latter function for details on input arguments 
<code>kt.order</code> and <code>kt.include.constant</code>.  
</p>
<p>Fitting and simulation of the ARIMA model for the cohort index
is done with function <code>Arima</code> from package 
<span class="pkg">forecast</span>. See the latter function for further details on 
input arguments <code>gc.order</code> and <code>gc.include.constant</code>. 
</p>
<p>Note that in some cases simulations of the 
cohort effects may be needed for a horizon longer than <code>h</code>.
This is the case when in the fitted model the most recent cohorts 
have been zero weighted. The simulated cohorts can be seen in 
<code>gc.s$cohorts</code>.
</p>


<h3>Value</h3>

<p>A list of class <code>"simStMoMo"</code> with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>rates</code></td>
<td>
<p> a three dimensional array with the future simulated rates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ages</code></td>
<td>
<p> vector of ages corresponding to the first dimension of 
<code>rates</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>years</code></td>
<td>
<p>vector of years for which a simulations has been produced. 
This corresponds to the second dimension of <code>rates</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.s</code></td>
<td>
<p> information on the simulated paths of the period indexes 
of the model. This is a list with the  <code>model</code> fitted to 
<code class="reqn">\kappa_t</code>; the simulated paths (<code>sim</code>); and the <code>years</code> 
for which simulations were produced. If the mortality model does not 
have any age-period terms (i.e. <code class="reqn">N=0</code>) this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc.s</code></td>
<td>
<p> information on the simulated paths of the cohort index of 
the model. This is a list with the <code>model</code> fitted to <code class="reqn">\gamma_c</code>; 
the simulated paths (<code>sim</code>); and the <code>cohorts</code> for which 
simulations were produced. If the mortality model does not have a cohort 
effect this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oxt.s</code></td>
<td>
<p> a three dimensional array with the offset used in the 
simulations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted</code></td>
<td>
<p> a three dimensional array with the in-sample rates of 
the model for the years for which the mortality model was fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jumpchoice</code></td>
<td>
<p>Jump-off method used in the simulation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.method</code></td>
<td>
<p>method used in the modelling of the period index.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p> the model fit from which the simulations were produced.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>forecast.fitStMoMo</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#Lee-Carter
LCfit &lt;- fit(lc(), data = EWMaleData, ages.fit = 55:89)
LCsim.mrwd &lt;- simulate(LCfit, nsim = 100)
LCsim.iarima &lt;- simulate(LCfit, nsim = 100, kt.method = "iarima", 
                         kt.order = c(1, 1, 2))

par(mfrow=c(2, 2))
plot(LCfit$years, LCfit$kt[1, ], xlim = range(LCfit$years, LCsim.mrwd$kt.s$years),
     ylim = range(LCfit$kt, LCsim.mrwd$kt.s$sim), type = "l", 
     xlab = "year", ylab = "kt", 
     main = "Lee-Carter: Simulated paths of the period index kt (mrwd)")
matlines(LCsim.mrwd$kt.s$years, LCsim.mrwd$kt.s$sim[1, , ], type = "l", lty = 1)

plot(LCfit$years, (LCfit$Dxt / LCfit$Ext)["65", ], 
     xlim = range(LCfit$years, LCsim.mrwd$years),
     ylim = range((LCfit$Dxt / LCfit$Ext)["65", ], LCsim.mrwd$rates["65", , ]), 
     type = "l", xlab = "year", ylab = "rate", 
     main = "Lee-Carter: Simulated mortality rates at age 65")
matlines(LCsim.mrwd$years, LCsim.mrwd$rates["65", , ], type = "l", lty = 1)

plot(LCfit$years, LCfit$kt[1, ], xlim = range(LCfit$years, LCsim.iarima$kt.s$years),
     ylim = range(LCfit$kt, LCsim.iarima$kt.s$sim), type = "l", 
     xlab = "year", ylab = "kt", 
     main = "Lee-Carter: Simulated paths of the period index kt (ARIMA(1, 1, 2))")
matlines(LCsim.iarima$kt.s$years, LCsim.iarima$kt.s$sim[1, , ], type = "l", lty = 1)

plot(LCfit$years, (LCfit$Dxt / LCfit$Ext)["65", ], 
     xlim = range(LCfit$years, LCsim.iarima$years),
     ylim = range((LCfit$Dxt / LCfit$Ext)["65", ], LCsim.iarima$rates["65", , ]), 
     type = "l", xlab = "year", ylab = "rate", 
     main = "Lee-Carter: Simulated mortality rates at age 65 (ARIMA(1, 1, 2))")
matlines(LCsim.iarima$years, LCsim.iarima$rates["65", , ], type = "l", lty = 1)

#APC
par(mfrow=c(1, 3))
wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
APCfit &lt;- fit(apc(), data = EWMaleData, ages.fit = 55:89, wxt = wxt)
APCsim &lt;- simulate(APCfit, nsim = 100, gc.order = c(1, 1, 0))

plot(APCfit$years, APCfit$kt[1, ], 
     xlim = range(APCfit$years, APCsim$kt.s$years),
     ylim = range(APCfit$kt, APCsim$kt.s$sim), type = "l",
     xlab = "year", ylab = "kt",
     main = "APC: Simulated paths of the period index kt")
matlines(APCsim$kt.s$years, APCsim$kt.s$sim[1, , ], type = "l", lty = 1)

plot(APCfit$cohorts, APCfit$gc, 
     xlim = range(APCfit$cohorts, APCsim$gc.s$cohorts),
     ylim = range(APCfit$gc, APCsim$gc.s$sim, na.rm = TRUE), type = "l",
     xlab = "year", ylab = "kt", 
     main = "APC: Simulated paths of the cohort index (ARIMA(1,1,0))")
matlines(APCsim$gc.s$cohorts, APCsim$gc.s$sim, type = "l", lty = 1)

plot(APCfit$years, (APCfit$Dxt / APCfit$Ext)["65", ], 
     xlim = range(APCfit$years, APCsim$years),
     ylim = range((APCfit$Dxt/APCfit$Ext)["65", ], APCsim$rates["65", , ]), 
     type = "l", xlab = "year", ylab = "rate", 
     main = "APC: Simulated of mortality rates at age 65")
matlines(APCsim$years, APCsim$rates["65", , ], type = "l", lty = 1)

#Compare LC and APC
library(fanplot)
par(mfrow=c(1, 1))
plot(LCfit$years, (LCfit$Dxt / LCfit$Ext)["65", ], 
     xlim = range(LCfit$years, LCsim.mrwd$years),
     ylim = range((LCfit$Dxt / LCfit$Ext)["65", ], LCsim.mrwd$rates["65", , ], 
     APCsim$rates["65", , ]), type = "l", xlab = "year", ylab = "rate", 
     main = "Fan chart of mortality rates at age 65 (LC vs. APC)")
fan(t(LCsim.mrwd$rates["65", , ]), start = LCsim.mrwd$years[1], 
    probs = c(2.5, 10, 25, 50, 75, 90, 97.5), n.fan = 4,
    fan.col = colorRampPalette(c(rgb(1, 0, 0), rgb(1, 1, 1))), ln = NULL)
fan(t(APCsim$rates["65", 1:(length(APCsim$years) - 3), ]), 
    start = APCsim$years[1], probs = c(2.5, 10, 25, 50, 75, 90, 97.5), 
    n.fan = 4, fan.col = colorRampPalette(c(rgb(0, 0, 1), rgb(1, 1, 1))), 
    ln = NULL) 
</code></pre>


</div>