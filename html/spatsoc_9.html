<div class="container">

<table style="width: 100%;"><tr>
<td>group_lines</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Group Lines</h2>

<h3>Description</h3>

<p><code>group_lines</code> groups rows into spatial groups by generating LINESTRINGs and
grouping based on spatial intersection. The function accepts a <code>data.table</code>
with relocation data, individual identifiers and a distance threshold. The
relocation data is transformed into sf LINESTRINGs using build_lines and
intersecting LINESTRINGs are grouped. The threshold argument is used to
specify the distance criteria for grouping. Relocation data should be in two
columns representing the X and Y coordinates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">group_lines(
  DT = NULL,
  threshold = NULL,
  projection = NULL,
  id = NULL,
  coords = NULL,
  timegroup = NULL,
  sortBy = NULL,
  splitBy = NULL,
  sfLines = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>DT</code></td>
<td>
<p>input data.table</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>The width of the buffer around the lines in the units of the
projection. Use <code>threshold = 0</code> to compare intersection without buffering.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>projection</code></td>
<td>
<p>numeric or character defining the coordinate reference
system to be passed to sf::st_crs. For example, either
<code>projection = "EPSG:32736"</code> or <code>projection = 32736</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>Character string of ID column name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>
<p>Character vector of X coordinate and Y coordinate column names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timegroup</code></td>
<td>
<p>timegroup field in the DT within which the grouping will be
calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sortBy</code></td>
<td>
<p>Character string of date time column(s) to sort rows by. Must
be a POSIXct.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>splitBy</code></td>
<td>
<p>(optional) character string or vector of grouping column
name(s) upon which the grouping will be calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sfLines</code></td>
<td>
<p>Alternatively to providing a DT, provide a simple feature
LINESTRING object generated with the sf package. The id argument is
required to provide the identifier matching each LINESTRING.
If an sfLines object is provided, groups cannot be calculated by timegroup
or splitBy.</p>
</td>
</tr>
</table>
<h3>Details</h3>



<h4>R-spatial evolution</h4>

<p>Please note, spatsoc has followed updates from R spatial, GDAL and PROJ for
handling projections, see more at
<a href="https://r-spatial.org/r/2020/03/17/wkt.html">https://r-spatial.org/r/2020/03/17/wkt.html</a>.
</p>
<p>In addition, <code>group_lines</code> (and build_lines) previously used
sp::SpatialLines, rgeos::gIntersects, rgeos::gBuffer but have been
updated to use sf::st_as_sf, sf::st_linestring, sf::st_intersects, and
sf::st_buffer according to the R-spatial evolution, see more at
<a href="https://r-spatial.org/r/2022/04/12/evolution.html">https://r-spatial.org/r/2022/04/12/evolution.html</a>.
</p>



<h4>Notes on arguments</h4>

<p>The <code>DT</code> must be a <code>data.table</code>. If your data is a
<code>data.frame</code>, you can convert it by reference using data.table::setDT.
</p>
<p>The <code>id</code>, <code>coords</code>, <code>sortBy</code> (and optional <code>timegroup</code>
and <code>splitBy</code>) arguments expect the names of respective columns in
<code>DT</code> which correspond to the individual identifier, X and Y coordinates,
sorting, timegroup (generated by group_times) and additional grouping
columns.
</p>
<p>The <code>projection</code> argument expects a numeric or character defining the
coordinate reference system. For example, for UTM zone 36N (EPSG 32736), the
projection argument is either <code>projection = 'EPSG:32736'</code> or <code>projection = 32736</code>. See details in <code>sf::st_crs()</code> and
<a href="https://spatialreference.org">https://spatialreference.org</a> for a list of EPSG codes.
</p>
<p>The <code>sortBy</code> argument is used to order the input <code>DT</code> when creating sf
LINESTRINGs. It must a column in the input <code>DT</code> of type POSIXct to ensure the
rows are sorted by date time.
</p>
<p>The <code>threshold</code> must be provided in the units of the coordinates. The
<code>threshold</code> can be equal to 0 if strict overlap is intended, otherwise it
should be some value greater than 0. The coordinates must be planar
coordinates (e.g.: UTM). In the case of UTM, a <code>threshold = 50</code> would
indicate a 50m distance threshold.
</p>
<p>The <code>timegroup</code> argument is optional, but recommended to pair with
group_times. The intended framework is to group rows temporally with
group_times then spatially with group_lines (or group_pts,
group_polys). With group_lines, pick a relevant group_times threshold
such as <code>'1 day'</code> or <code>'7 days'</code> which is informed by your study species,
system or question.
</p>
<p>The <code>splitBy</code> argument offers further control building LINESTRINGs. If in
your input <code>DT</code>, you have multiple temporal groups (e.g.: years) for example,
you can provide the name of the column which identifies them and build
LINESTRINGs for each individual in each year. The grouping performed by
group_lines will only consider rows within each <code>splitBy</code> subgroup.
</p>



<h3>Value</h3>

<p><code>group_lines</code> returns the input <code>DT</code> appended with a "group"
column.
</p>
<p>This column represents the spatial (and if <code>timegroup</code> was provided -
spatiotemporal) group calculated by intersecting lines. As with the other
grouping functions,  the actual value of group is arbitrary and represents
the identity of a given group where 1 or more individuals are assigned to a
group. If the data was reordered, the group may change, but the contents of
each group would not.
</p>
<p>A message is returned when a column named "group" already exists in the
input <code>DT</code>, because it will be overwritten.
</p>


<h3>See Also</h3>

<p>build_lines group_times
</p>
<p>Other Spatial grouping: 
<code>group_polys()</code>,
<code>group_pts()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load data.table
library(data.table)


# Read example data
DT &lt;- fread(system.file("extdata", "DT.csv", package = "spatsoc"))

# Subset only individuals A, B, and C
DT &lt;- DT[ID %in% c('A', 'B', 'C')]

# Cast the character column to POSIXct
DT[, datetime := as.POSIXct(datetime, tz = 'UTC')]

# EPSG code for example data
utm &lt;- 32736

group_lines(DT, threshold = 50, projection = utm, sortBy = 'datetime',
            id = 'ID', coords = c('X', 'Y'))

## Daily movement tracks
# Temporal grouping
group_times(DT, datetime = 'datetime', threshold = '1 day')

# Subset only first 50 days
DT &lt;- DT[timegroup &lt; 25]

# Spatial grouping
group_lines(DT, threshold = 50, projection = utm,
            id = 'ID', coords = c('X', 'Y'),
            timegroup = 'timegroup', sortBy = 'datetime')

## Daily movement tracks by population
group_lines(DT, threshold = 50, projection = utm,
            id = 'ID', coords = c('X', 'Y'),
            timegroup = 'timegroup', sortBy = 'datetime',
            splitBy = 'population')
</code></pre>


</div>