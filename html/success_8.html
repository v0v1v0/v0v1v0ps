<div class="container">

<table style="width: 100%;"><tr>
<td>bernoulli_RL_cdf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cumulative distribution function (cdf) of Run Length for Bernoulli CUSUM</h2>

<h3>Description</h3>

<p>Calculate the cdf of the Run Length of the Bernoulli CUSUM,
starting from initial value between 0 and <code>h</code>, using Markov Chain methodology.
</p>


<h3>Usage</h3>

<pre><code class="language-R">bernoulli_RL_cdf(h, x, n_grid, glmmod, theta, theta_true, p0, p1,
  smooth_prob = FALSE, exact = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>Control limit for the Bernoulli CUSUM</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Quantile at which to evaluate the cdf.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_grid</code></td>
<td>
<p>Number of state spaces used to discretize the outcome space (when <code>method = "MC"</code>)
or number of grid points used for trapezoidal integration (when <code>method = "SPRT"</code>).
Increasing this number improves accuracy, but can also significantly increase computation time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glmmod</code></td>
<td>
<p>Generalized linear regression model used for risk-adjustment as produced by
the function <code>glm()</code>. Suggested: <br><code>glm(as.formula("(survtime &lt;= followup) &amp; (censorid == 1) ~ covariates"), data = data)</code>. <br>
Alternatively, a list containing the following elements:
</p>

<dl>
<dt>
<code>formula</code>:</dt>
<dd>
<p>a <code>formula()</code> in the form <code>~ covariates</code>;</p>
</dd>
<dt>
<code>coefficients</code>:</dt>
<dd>
<p>a named vector specifying risk adjustment coefficients
for covariates. Names must be the same as in <code>formula</code> and colnames of <code>data</code>.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>The <code class="reqn">\theta</code> value used to specify the odds ratio
<code class="reqn">e^\theta</code> under the alternative hypothesis.
If <code class="reqn">\theta &gt;= 0</code>, the average run length for the upper one-sided
Bernoulli CUSUM will be determined. If <code class="reqn">\theta &lt; 0</code>,
the average run length for the lower one-sided CUSUM will be determined.
Note that </p>
<p style="text-align: center;"><code class="reqn">p_1 = \frac{p_0 e^\theta}{1-p_0 +p_0 e^\theta}.</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta_true</code></td>
<td>
<p>The true log odds ratio <code class="reqn">\theta</code>, describing the
true increase in failure rate from the null-hypothesis. Default = log(1), indicating
no increase in failure rate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p0</code></td>
<td>
<p>The baseline failure probability at <code>entrytime + followup</code> for individuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p1</code></td>
<td>
<p>The alternative hypothesis failure probability at <code>entrytime + followup</code> for individuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth_prob</code></td>
<td>
<p>Should the probability distribution of failure under the null distribution be smoothed?
Useful for small samples. Can only be TRUE when <code>glmmod</code> is supplied. Default = FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exact</code></td>
<td>
<p>Should the cdf be determined exactly (TRUE), or approximately
(FALSE)? The approximation works well for large <code>x</code>, and can cut computation
time significantly. Default = TRUE.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Let <code class="reqn">K</code> denote the run length of the Bernoulli CUSUM with control limit <code>h</code>, then
this function can be used to evaluate <code class="reqn">P(K \leq x)</code>.
</p>
<p>The formula on page 543 of Brook &amp; Evans (1972)
is used if <code>exact = TRUE</code>. When <code>exact = FALSE</code>, formula (3.9) on
page 545 is used instead, approximating the transition matrix using its
Jordan canonical form. This can save computation time considerably, but is
not appropriate for small values of <code>x</code>.
</p>


<h3>Value</h3>

<p>A list containing:
</p>

<ul>
<li> <p><code>Fr_0</code>: A numeric value indicating the probability of the run
length being smaller than <code>x</code>.
</p>
</li>
<li> <p><code>Fr</code>: A <code>data.frame</code> containing the cumulative distribution function of the run length
depending on the state in which the process starts <code class="reqn">(E_0, E_1, \ldots, E_{n_{grid}-1})</code>
</p>

<dl>
<dt>
<code>start_val</code>:</dt>
<dd>
<p>Starting value of the CUSUM, corresponding to the
discretized state spaces <code class="reqn">E_{i}</code>;</p>
</dd>
<dt>
<code>P(K &lt;= x)</code>:</dt>
<dd>
<p>Value of the cdf at <code>x</code> for the CUSUM with
initial value <code>start_val</code>;</p>
</dd>
</dl>
</li>
<li> <p><code>R</code>: A transition probability <code>matrix</code> containing the transition
probabilities between states <code class="reqn">E_0, \ldots, E_{t-1}</code>.
<code class="reqn">R_{i,j}</code> is the transition probability from state i to state j.
</p>
</li>
</ul>
<p> The value of <code>ARL_0</code> will be printed to the console.
</p>


<h3>References</h3>

<p>Brook, D., &amp; Evans, D. A. (1972). An Approach to the Probability
Distribution of CUSUM Run Length. Biometrika, 59(3), 539-549.
<a href="https://doi.org/10.2307/2334805">doi:10.2307/2334805</a>
</p>
<p>Steiner, S. H., Cook, R. J., Farewell, V. T., &amp; Treasure, T. (2000).
Monitoring surgical performance using risk-adjusted cumulative sum charts.
Biostatistics, 1(4), 441-452. <a href="https://doi.org/10.1093/biostatistics/1.4.441">doi:10.1093/biostatistics/1.4.441</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#Determine a risk-adjustment model using a generalized linear model.
#Outcome (failure within 100 days) is regressed on the available covariates:
glmmodber &lt;- glm((survtime &lt;= 100) &amp; (censorid == 1)~ age + sex + BMI,
                  data = surgerydat, family = binomial(link = "logit"))
#Determine probability of run length being less than 600
prob600 &lt;- bernoulli_RL_cdf(h = 2.5, x = 600, n_grid = 200, glmmod = glmmodber, theta = log(2))
</code></pre>


</div>