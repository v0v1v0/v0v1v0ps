<div class="container">

<table style="width: 100%;"><tr>
<td>forecast.fitStMoMo</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Forecast mortality rates using a Stochastic Mortality Model</h2>

<h3>Description</h3>

<p>Forecast mortality rates using a Stochastic Mortality Model fit.
The period indexes <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are forecasted
using ether a Multivariate Random Walk with Drift (MRWD) or 
<code class="reqn">N</code> independent ARIMA<code class="reqn">(p, d, q)</code> models. The cohort index 
<code class="reqn">\gamma_{t-x}</code> is forecasted using an ARIMA<code class="reqn">(p, d, q)</code>. 
By default an ARIMA<code class="reqn">(1, 1, 0)</code> with a constant is used.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'fitStMoMo'
forecast(object, h = 50, level = c(80, 95),
  oxt = NULL, gc.order = c(1, 1, 0), gc.include.constant = TRUE,
  jumpchoice = c("fit", "actual"), kt.method = c("mrwd", "iarima"),
  kt.order = NULL, kt.include.constant = TRUE, kt.lookback = NULL,
  gc.lookback = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object of class <code>"fitStMoMo"</code> with the fitted 
parameters of a stochastic mortality model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>number of years ahead to forecast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>confidence level for prediction intervals of the 
period and cohort indices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oxt</code></td>
<td>
<p>optional matrix/vector or scalar of known offset to be 
added in the forecasting. This can be used to specify any a priori 
known component to be added to the forecasted predictor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc.order</code></td>
<td>
<p>a specification of the ARIMA model for the cohort effect: 
the three components <code class="reqn">(p, d, q)</code> are the AR order, the degree of 
differencing, and the MA. The default is an ARIMA<code class="reqn">(1, 1, 0)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc.include.constant</code></td>
<td>
<p>a logical value indicating if the ARIMA model
should include a constant value. The default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jumpchoice</code></td>
<td>
<p>option to select the jump-off rates, i.e. the rates 
from the final year of observation, to use in projections of mortality 
rates. <code>"fit"</code>(default) uses the fitted rates and <code>"actual"</code> 
uses the actual rates from the final year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.method</code></td>
<td>
<p>optional forecasting method for the period index. 
The alternatives are <code>"mrwd"</code>(default) and <code>"iarima"</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.order</code></td>
<td>
<p>an optional matrix with one row per period index
specifying the ARIMA models: for the ith row (ith period index) the three 
components <code class="reqn">(p, d, q)</code> are the AR order, the degree of  differencing, 
and the MA order. If absent the arima models are fitted using 
<code>auto.arima</code>. This argument is only used when
<code>kt.method</code> is <code>"iarima"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.include.constant</code></td>
<td>
<p>an optional vector of logical values 
indicating if the ARIMA model for the ith period index should include a 
constant value. The default is <code>TRUE</code>.  This argument is only used 
when <code>kt.method</code> is <code>"iarima"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the time series model for the period indexes. By 
default all the estimated values are used. If 
<code>kt.lookback</code> is provided then the last <code>kt.lookback</code> 
years of <code class="reqn">\kappa_t^{(i)}, i = 1,..N,</code> are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc.lookback</code></td>
<td>
<p>optional argument to specify the look-back window to use
in the estimation of the ARIMA model for the cohort effect. By 
default all the estimated values are used in estimating the ARIMA 
model. If <code>gc.lookback</code> is provided then the last 
<code>gc.lookback</code> years of <code class="reqn">\gamma_{t-x}</code> are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments for <code>iarima</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If <code>kt.method</code> is <code>"mrwd"</code>, fitting and forecasting of 
the time series model for the  period indexes is done with a 
Multivariate Random Walk with Drift using the function 
<code>mrwd</code>.
</p>
<p>If <code>kt.method</code> is <code>"iarima"</code>, fitting and forecasting of 
the time series model for the  period indexes is done with <code class="reqn">N</code> 
independent arima models using the function <code>iarima</code>. 
See this latter function for details on input arguments 
<code>kt.order</code> and <code>kt.include.constant</code>.  
</p>
<p>Fitting and forecasting of the ARIMA model for the cohort index
is done with function <code>Arima</code> from package 
<span class="pkg">forecast</span>. See the latter function for further details on 
input arguments <code>gc.order</code> and <code>gc.include.constant</code>. 
</p>
<p>Note that in some cases forecast of the cohort effects may be
needed for a horizon longer than <code>h</code>. This is the case when 
in the fitted model the most recent cohorts have been zero weighted. 
The forecasted cohorts can be seen in <code>gc.f$cohorts</code>.
</p>


<h3>Value</h3>

<p>A list of class <code>"forStMoMo"</code> with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>rates</code></td>
<td>
<p> a matrix with the point forecast of the rates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ages</code></td>
<td>
<p> vector of ages corresponding to the rows of <code>rates</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>years</code></td>
<td>
<p>vector of years for which a forecast has been produced. This
corresponds to the columns of <code>rates</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.f</code></td>
<td>
<p> forecasts of period indexes of the model. This is a list with 
the <code>model</code> fitted to <code class="reqn">\kappa_t</code>; the <code>mean</code>(central) 
forecast, the <code>lower</code> and <code>upper</code> limits of the prediction 
intervals; the confidence <code>level</code> associated with the prediction 
intervals; and the <code>years</code> for which a forecast was produced. If the 
model does not have any age-period terms (i.e. <code class="reqn">N=0</code>) this is set to 
<code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc.f</code></td>
<td>
<p> forecasts of cohort index of the model. This is a list with 
the <code>model</code> fitted to <code class="reqn">\gamma_c</code>; the <code>mean</code>(point) forecast,
the <code>lower</code> and <code>upper</code> limits of the prediction intervals; the
confidence <code>level</code> associated with the prediction intervals; and the 
<code>cohorts</code> for which a forecast was produced. If the mortality model
does not have a cohort effect this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oxt.f</code></td>
<td>
<p> the offset used in the forecast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted</code></td>
<td>
<p> a matrix with the fitted in-sample rates of the model for 
the years for which the mortality model was fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>the model fit from which the forecast was produced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jumpchoice</code></td>
<td>
<p>Jump-off method used in the forecast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt.method</code></td>
<td>
<p>method used in the forecast of the period index.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">#Lee-Carter (random walk with drift)
LCfit &lt;- fit(lc(), data = EWMaleData, ages.fit = 55:89)
LCfor &lt;- forecast(LCfit)
plot(LCfor)

#Lee-Carter (forecast with ARIMA(1,1,2) with drift )
LCfor.iarima1 &lt;- forecast(LCfit, kt.method = "iarima", kt.order = c(1, 1 , 2))
plot(LCfor.iarima1)

#Lee-Carter (forecast with auto.arima)
LCfor.iarima2 &lt;- forecast(LCfit, kt.method = "iarima")
plot(LCfor.iarima2)

#CBD (Multivariate random walk with drift)
CBDfit &lt;- fit(cbd(), data = central2initial(EWMaleData), ages.fit = 55:89)
CBDfor &lt;- forecast(CBDfit)
plot(CBDfor, parametricbx = FALSE)

#CBD (Independent Arima models)
kt.order &lt;- matrix(c(1, 1, 2,  #ARIMA(1, 1, 2) for k[1]
                     0, 1, 1), #ARIMA(0, 1, 1) for k[2]
                   nrow = 2, ncol = 3, byrow = TRUE)
CBDfor.iarima &lt;- forecast(CBDfit, kt.method = "iarima", kt.order = kt.order)
plot(CBDfor.iarima, parametricbx = FALSE)

#APC: Compare forecast with different models for the cohort index
wxt &lt;- genWeightMat(55:89,  EWMaleData$years, clip = 3)
APCfit &lt;- fit(apc(), data = EWMaleData,  ages.fit = 55:89, 
              wxt = wxt)
APCfor1 &lt;- forecast(APCfit)
plot(APCfor1, parametricbx = FALSE, nCol = 3)
APCfor2 &lt;- forecast(APCfit, gc.order = c(0, 2, 2))
plot(APCfor2, only.gc = TRUE)
plot(c(APCfit$years, APCfor1$years), 
     cbind(APCfor1$fitted, APCfor1$rates)["65", ], 
     type = "l", xlab = "year", ylab = "Mortality rate at age 65", 
     main = "Forecasts with different models for gc")
lines(APCfor2$years, APCfor2$rates["65", ], col = "blue")
points(APCfit$years, (APCfit$Dxt / APCfit$Ext)["65", ], pch = 19) 

#Compare Lee-Carter forecast using: 
#  1. Fitted jump-off rates and all history for kt
#  2. Actual jump-off rates and all history for kt
#  3. Fitted jump-off rates and only history for 
#     the past 30 years of kt (i.e 1982-2011)

LCfor1 &lt;- forecast(LCfit)
LCfor2 &lt;- forecast(LCfit, jumpchoice = "actual")
LCfor3 &lt;- forecast(LCfit, kt.lookback = 30) 

plot(LCfit$years, (LCfit$Dxt / LCfit$Ext)["60", ],
     xlim = range(LCfit$years, LCfor1$years),
     ylim = range((LCfit$Dxt / LCfit$Ext)["60", ], LCfor1$rates["60", ],
                  LCfor2$rates["60", ], LCfor3$rates["60", ]),
     type = "p", xlab = "year", ylab = "rate",
     main = "Lee-Carter: Forecast of mortality rates at age 60")
lines(LCfit$years, fitted(LCfit, type = "rates")["60", ])
lines(LCfor1$years, LCfor1$rates["60", ], lty = 2)
lines(LCfor2$years, LCfor2$rates["60", ], lty = 3, col = "blue")
lines(LCfor3$years, LCfor3$rates["60", ], lty = 4, col = "red")
legend("topright",legend = c("Fitted jump-off", "Actual jump-off", 
       "Fitted jump-off, 30 year look-back"), 
       lty = 1:3, col = c("black", "blue", "red"))
</code></pre>


</div>