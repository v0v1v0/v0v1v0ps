<div class="container">

<table style="width: 100%;"><tr>
<td>RunUMAP</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Run UMAP</h2>

<h3>Description</h3>

<p>Runs the Uniform Manifold Approximation and Projection (UMAP) dimensional
reduction technique. To run using <code>umap.method="umap-learn"</code>, you must
first install the umap-learn python package (e.g. via
<code>pip install umap-learn</code>). Details on this package can be
found here: <a href="https://github.com/lmcinnes/umap">https://github.com/lmcinnes/umap</a>. For a more in depth
discussion of the mathematics underlying UMAP, see the ArXiv paper here:
<a href="https://arxiv.org/abs/1802.03426">https://arxiv.org/abs/1802.03426</a>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">RunUMAP(object, ...)

## Default S3 method:
RunUMAP(
  object,
  reduction.key = "UMAP_",
  assay = NULL,
  reduction.model = NULL,
  return.model = FALSE,
  umap.method = "uwot",
  n.neighbors = 30L,
  n.components = 2L,
  metric = "cosine",
  n.epochs = NULL,
  learning.rate = 1,
  min.dist = 0.3,
  spread = 1,
  set.op.mix.ratio = 1,
  local.connectivity = 1L,
  repulsion.strength = 1,
  negative.sample.rate = 5,
  a = NULL,
  b = NULL,
  uwot.sgd = FALSE,
  seed.use = 42,
  metric.kwds = NULL,
  angular.rp.forest = FALSE,
  densmap = FALSE,
  dens.lambda = 2,
  dens.frac = 0.3,
  dens.var.shift = 0.1,
  verbose = TRUE,
  ...
)

## S3 method for class 'Graph'
RunUMAP(
  object,
  assay = NULL,
  umap.method = "umap-learn",
  n.components = 2L,
  metric = "correlation",
  n.epochs = 0L,
  learning.rate = 1,
  min.dist = 0.3,
  spread = 1,
  repulsion.strength = 1,
  negative.sample.rate = 5L,
  a = NULL,
  b = NULL,
  uwot.sgd = FALSE,
  seed.use = 42L,
  metric.kwds = NULL,
  densmap = FALSE,
  densmap.kwds = NULL,
  verbose = TRUE,
  reduction.key = "UMAP_",
  ...
)

## S3 method for class 'Neighbor'
RunUMAP(object, reduction.model, ...)

## S3 method for class 'Seurat'
RunUMAP(
  object,
  dims = NULL,
  reduction = "pca",
  features = NULL,
  graph = NULL,
  assay = DefaultAssay(object = object),
  nn.name = NULL,
  slot = "data",
  umap.method = "uwot",
  reduction.model = NULL,
  return.model = FALSE,
  n.neighbors = 30L,
  n.components = 2L,
  metric = "cosine",
  n.epochs = NULL,
  learning.rate = 1,
  min.dist = 0.3,
  spread = 1,
  set.op.mix.ratio = 1,
  local.connectivity = 1L,
  repulsion.strength = 1,
  negative.sample.rate = 5L,
  a = NULL,
  b = NULL,
  uwot.sgd = FALSE,
  seed.use = 42L,
  metric.kwds = NULL,
  angular.rp.forest = FALSE,
  densmap = FALSE,
  dens.lambda = 2,
  dens.frac = 0.3,
  dens.var.shift = 0.1,
  verbose = TRUE,
  reduction.name = "umap",
  reduction.key = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed to other methods and UMAP</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reduction.key</code></td>
<td>
<p>dimensional reduction key, specifies the string before
the number for the dimension names. UMAP by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assay</code></td>
<td>
<p>Assay to pull data for when using <code>features</code>, or assay used to construct Graph
if running UMAP on a Graph</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reduction.model</code></td>
<td>
<p><code>DimReduc</code> object that contains the umap model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.model</code></td>
<td>
<p>whether UMAP will return the uwot model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>umap.method</code></td>
<td>
<p>UMAP implementation to run. Can be
</p>

<dl>
<dt>
<code>uwot</code>:</dt>
<dd>
<p>Runs umap via the uwot R package</p>
</dd>
<dt>
<code>uwot-learn</code>:</dt>
<dd>
<p>Runs umap via the uwot R package and return the learned umap model</p>
</dd>
<dt>
<code>umap-learn</code>:</dt>
<dd>
<p>Run the Seurat wrapper of the python umap-learn package</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.neighbors</code></td>
<td>
<p>This determines the number of neighboring points used in
local approximations of manifold structure. Larger values will result in more
global structure being preserved at the loss of detailed local structure. In
general this parameter should often be in the range 5 to 50.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.components</code></td>
<td>
<p>The dimension of the space to embed into.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>metric: This determines the choice of metric used to measure
distance in the input space. A wide variety of metrics are already coded, and
a user defined function can be passed as long as it has been JITd by numba.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.epochs</code></td>
<td>
<p>he number of training epochs to be used in optimizing the low dimensional
embedding. Larger values result in more accurate embeddings. If NULL is specified, a value will
be selected based on the size of the input dataset (200 for large datasets, 500 for small).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>learning.rate</code></td>
<td>
<p>The initial learning rate for the embedding optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.dist</code></td>
<td>
<p>This controls how tightly the embedding is allowed compress points together.
Larger values ensure embedded points are moreevenly distributed, while smaller values allow the
algorithm to optimise more accurately with regard to local structure. Sensible values are in
the range 0.001 to 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spread</code></td>
<td>
<p>The effective scale of embedded points. In combination with min.dist this
determines how clustered/clumped the embedded points are.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>set.op.mix.ratio</code></td>
<td>
<p>Interpolate between (fuzzy) union and intersection as the set operation
used to combine local fuzzy simplicial sets to obtain a global fuzzy simplicial sets. Both fuzzy
set operations use the product t-norm. The value of this parameter should be between 0.0 and
1.0; a value of 1.0 will use a pure fuzzy union, while 0.0 will use a pure fuzzy intersection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>local.connectivity</code></td>
<td>
<p>The local connectivity required - i.e. the number of nearest neighbors
that should be assumed to be connected at a local level. The higher this value the more connected
the manifold becomes locally. In practice this should be not more than the local intrinsic
dimension of the manifold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>repulsion.strength</code></td>
<td>
<p>Weighting applied to negative samples in low dimensional embedding
optimization. Values higher than one will result in greater weight being given to negative
samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>negative.sample.rate</code></td>
<td>
<p>The number of negative samples to select per positive sample in the
optimization process. Increasing this value will result in greater repulsive force being applied,
greater optimization cost, but slightly more accuracy.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>More specific parameters controlling the embedding. If NULL, these values are set
automatically as determined by min. dist and spread. Parameter of differentiable approximation of
right adjoint functor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>More specific parameters controlling the embedding. If NULL, these values are set
automatically as determined by min. dist and spread. Parameter of differentiable approximation of
right adjoint functor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uwot.sgd</code></td>
<td>
<p>Set <code>uwot::umap(fast_sgd = TRUE)</code>; see <code>umap</code> for more details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed.use</code></td>
<td>
<p>Set a random seed. By default, sets the seed to 42. Setting
NULL will not set a seed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric.kwds</code></td>
<td>
<p>A dictionary of arguments to pass on to the metric, such as the p value for
Minkowski distance. If NULL then no arguments are passed on.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>angular.rp.forest</code></td>
<td>
<p>Whether to use an angular random projection forest to initialise the
approximate nearest neighbor search. This can be faster, but is mostly on useful for metric that
use an angular style distance such as cosine, correlation etc. In the case of those metrics
angular forests will be chosen automatically.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>densmap</code></td>
<td>
<p>Whether to use the density-augmented objective of densMAP.
Turning on this option generates an embedding where the local densities
are encouraged to be correlated with those in the original space.
Parameters below with the prefix ‘dens’ further control the behavior
of this extension. Default is FALSE. Only compatible with 'umap-learn' method
and version of umap-learn &gt;= 0.5.0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dens.lambda</code></td>
<td>
<p>Specific parameter which controls the regularization weight
of the density correlation term in densMAP. Higher values prioritize density
preservation over the UMAP objective, and vice versa for values closer to zero.
Setting this parameter to zero is equivalent to running the original UMAP algorithm.
Default value is 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dens.frac</code></td>
<td>
<p>Specific parameter which controls the fraction of epochs
(between 0 and 1) where the density-augmented objective is used in densMAP.
The first (1 - dens_frac) fraction of epochs optimize the original UMAP
objective before introducing the density correlation term. Default is 0.3.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dens.var.shift</code></td>
<td>
<p>Specific parameter which specifies a small constant
added to the variance of local radii in the embedding when calculating
the density correlation objective to prevent numerical instability from
dividing by a small number. Default is 0.1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Controls verbosity</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>densmap.kwds</code></td>
<td>
<p>A dictionary of arguments to pass on to the densMAP optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dims</code></td>
<td>
<p>Which dimensions to use as input features, used only if
<code>features</code> is NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reduction</code></td>
<td>
<p>Which dimensional reduction (PCA or ICA) to use for the
UMAP input. Default is PCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>features</code></td>
<td>
<p>If set, run UMAP on this subset of features (instead of running on a
set of reduced dimensions). Not set (NULL) by default; <code>dims</code> must be NULL to run
on features</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>graph</code></td>
<td>
<p>Name of graph on which to run UMAP</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nn.name</code></td>
<td>
<p>Name of knn output on which to run UMAP</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slot</code></td>
<td>
<p>The slot used to pull data for when using <code>features</code>. data slot is by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reduction.name</code></td>
<td>
<p>Name to store dimensional reduction under in the Seurat object</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a Seurat object containing a UMAP representation
</p>


<h3>References</h3>

<p>McInnes, L, Healy, J, UMAP: Uniform Manifold Approximation and
Projection for Dimension Reduction, ArXiv e-prints 1802.03426, 2018
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
data("pbmc_small")
pbmc_small
# Run UMAP map on first 5 PCs
pbmc_small &lt;- RunUMAP(object = pbmc_small, dims = 1:5)
# Plot results
DimPlot(object = pbmc_small, reduction = 'umap')

## End(Not run)

</code></pre>


</div>