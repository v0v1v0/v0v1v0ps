<div class="container">

<table style="width: 100%;"><tr>
<td>run_interaction_analysis</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Run (differential) intercellular communication analysis</h2>

<h3>Description</h3>

<p>Perform (differential) cell type to cell type communication analysis from a
<a href="https://satijalab.org/seurat/index.html">Seurat object</a>,
using an internal database of ligand-receptor interactions (LRIs). It
infers biologically relevant cell-cell interactions (CCIs) and how they
change between two conditions of interest. Over-representation analysis
is automatically performed to determine dominant differential signals at the
level of the genes, cell types, GO Terms and KEGG Pathways.
</p>


<h3>Usage</h3>

<pre><code class="language-R">run_interaction_analysis(
  seurat_object,
  LRI_species,
  seurat_celltype_id,
  seurat_condition_id,
  iterations = 1000,
  scdiffcom_object_name = "scDiffCom_object",
  seurat_assay = "RNA",
  seurat_slot = "data",
  log_scale = FALSE,
  score_type = "geometric_mean",
  threshold_min_cells = 5,
  threshold_pct = 0.1,
  threshold_quantile_score = 0.2,
  threshold_p_value_specificity = 0.05,
  threshold_p_value_de = 0.05,
  threshold_logfc = log(1.5),
  return_distributions = FALSE,
  seed = 42,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>seurat_object</code></td>
<td>
<p>Seurat object that must contain normalized
data and relevant <code>meta.data</code> columns (see below). Gene names must be
MGI (mouse) or HGNC (human) approved symbols.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LRI_species</code></td>
<td>
<p>Either <code>"mouse"</code>, <code>"human"</code> or <code>"rat"</code>. Indicates which
LRI database to use and corresponds to the species of the <code>seurat_object</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seurat_celltype_id</code></td>
<td>
<p>Name of the <code>meta.data</code> column in
<code>seurat_object</code> that contains cell-type annotations
(e.g.: <code>"CELL_TYPE"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seurat_condition_id</code></td>
<td>
<p>List that contains information regarding the
two conditions on which to perform differential analysis. Must contain
the following three named items:
</p>

<ol>
<li> <p><code>column_name</code>: name of the <code>meta.data</code> column in
<code>seurat_object</code> that indicates the condition on each cell (e.g. <code>"AGE"</code>)
</p>
</li>
<li> <p><code>cond1_name</code>: name of the first condition (e.g. <code>"YOUNG"</code>)
</p>
</li>
<li> <p><code>cond2_name</code>: name of the second condition (e.g. <code>"OLD"</code>)
</p>
</li>
</ol>
<p>Can also be set to <code>NULL</code> to only perform a detection analysis
(see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterations</code></td>
<td>
<p>Number of permutations to perform the statistical
analysis. The default (<code>1000</code>) is a good compromise for an exploratory
analysis and to obtain reasonably accurate p-values in a short time.
Otherwise, we recommend using <code>10000</code> iterations and to run the
analysis in parallel (see Details). Can also be set to <code>0</code> for
debugging and quickly returning partial results without
statistical significance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scdiffcom_object_name</code></td>
<td>
<p>Name of the <code>scDiffCom</code> S4 object that will
be returned (<code>"scDiffCom_object"</code> by default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seurat_assay</code></td>
<td>
<p>Assay of <code>seurat_object</code> from which to extract data.
See Details for an explanation on how data are extracted based on the three
parameters <code>seurat_assay</code>, <code>seurat_slot</code> and <code>log_scale</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seurat_slot</code></td>
<td>
<p>Slot of <code>seurat_object</code> from which to extract data.
See Details for an explanation on how data are extracted based on the three
parameters <code>seurat_assay</code>, <code>seurat_slot</code> and <code>log_scale</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log_scale</code></td>
<td>
<p>When <code>FALSE</code> (the default, recommended), data are
treated as normalized but not log1p-transformed. See Details for an
explanation on how data are extracted based on the three
parameters <code>seurat_assay</code>, <code>seurat_slot</code> and <code>log_scale</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>score_type</code></td>
<td>
<p>Metric used to compute cell-cell interaction (CCI) scores.
Can either be <code>"geometric_mean"</code> (default) or <code>"arithmetic_mean"</code>.
It is strongly recommended to use the geometric mean, especially when
performing differential analysis. The arithmetic mean might be used when
uniquely doing a detection analysis or if the results want to be compared
with those of another package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold_min_cells</code></td>
<td>
<p>Minimal number of cells - of a given cell type
and condition - required to express a gene for this gene to be considered
expressed in the corresponding cell type. Incidentally, cell types with
less cells than this threshold are removed from the analysis.
Set to <code>5</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold_pct</code></td>
<td>
<p>Minimal fraction of cells - of a given cell type
and condition - required to express a gene for this gene to be considered
expressed in the corresponding cell type. Set to  <code>0.1</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold_quantile_score</code></td>
<td>
<p>Threshold value used in conjunction with
<code>threshold_p_value_specificity</code> to establish if a CCI is considered
"detected". The default (<code>0.2</code>) indicates that CCIs with a score
in the 20% lowest-scores are not considered detected. Can be modified
without the need to re-perform the permutation analysis (see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold_p_value_specificity</code></td>
<td>
<p>Threshold value used in conjunction
with <code>threshold_quantile_score</code> to establish if a CCI is considered
"detected". CCIs with a (BH-adjusted) specificity p-value above the
threshold (<code>0.05</code> by default) are not considered detected. Can be
modified without the need to re-perform the permutation analysis
(see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold_p_value_de</code></td>
<td>
<p>Threshold value used in conjunction
with <code>threshold_logfc</code> to establish how CCIs are differentially
expressed between <code>cond1_name</code> and <code>cond2_name</code>. CCIs with a
(BH-adjusted) differential p-value above the threshold (<code>0.05</code> by
default) are not considered to change significantly. Can be modified
without the need to re-perform the permutation analysis (see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold_logfc</code></td>
<td>
<p>Threshold value used in conjunction with
<code>threshold_p_value_de</code> to establish how CCIs are differentially
expressed between <code>cond1_name</code> and <code>cond2_name</code>. CCIs with an
absolute logFC below the threshold (<code>log(1.5)</code> by default) are
considered "FLAT". Can be modified without the need to
re-perform the permutation analysis (see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_distributions</code></td>
<td>
<p><code>FALSE</code> by default. If <code>TRUE</code>, the
distributions obtained from the permutation test are returned alongside
the other results. May be used for testing or benchmarking purposes. Can
only be enabled when <code>iterations</code> is less than <code>1000</code> in order
to avoid out of memory issues.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Set a random seed (<code>42</code> by default) to obtain reproducible
results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If <code>TRUE</code> (default), print progress messages.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The primary use of this function (and of the package) is to perform
differential intercellular communication analysis. However, it is also
possible to only perform a detection analysis (by setting
<code>seurat_condition_id</code> to <code>NULL</code>), e.g. if one wants to
infer cell-cell interactions from a dataset without having conditions on the cells.
</p>
<p>By convention, when performing differential analysis, LOGFC are computed as
<code>log(score(cond2_name)/score(cond1_name))</code>. In other words,
"UP"-regulated CCIs have a larger score in <code>cond2_name</code>.
</p>
<p>Parallel computing. If possible, it is recommended to
run this function in parallel in order to speed up the analysis for large
dataset and/or to obtain better accuracy on the p-values by setting a higher
number of <code>iterations</code>. This is as simple as loading the
<a href="https://CRAN.R-project.org/package=future">future</a>
package and setting an appropriate <code>plan</code> (see also our
<a href="https://cyrillagger.github.io/scDiffCom/articles/scDiffCom-vignette.html">vignette</a>).
</p>
<p>Data extraction. The UMI or read counts matrix is extracted from
the assay <code>seurat_assay</code> and the slot <code>seurat_slot</code>. By default,
it is assumed that <code>seurat_object</code> contains log1p-transformed
normalized data in the slot "data" of its assay "RNA". If <code>log_scale</code>
is <code>FALSE</code> (as recommended), the data are <code>expm1()</code> transformed
in order to recover normalized values not in log scale.
</p>
<p>Modifying filtering parameters (differential analysis only). As long as
the slot <code>cci_table_raw</code> of
the returned scDiffCom object is not erased, filtering parameters can be
modified to recompute the slots <code>cci_table_detected</code> and
<code>ora_table</code>, without re-performing the time consuming permutation
analysis. This may be useful if one wants a fast way to analyze how the
results behave in function of, say, different LOGFC thresholds. In practice,
this can be done by calling the functions <code>FilterCCI</code> or
<code>RunORA</code> (see also our
<a href="https://cyrillagger.github.io/scDiffCom/articles/scDiffCom-vignette.html">vignette</a>).
</p>


<h3>Value</h3>

<p>An S4 object of class <code>scDiffCom-class</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
run_interaction_analysis(
  seurat_object = seurat_sample_tms_liver,
  LRI_species = "mouse",
  seurat_celltype_id = "cell_type",
  seurat_condition_id = list(
    column_name = "age_group",
    cond1_name = "YOUNG",
    cond2_name = "OLD"
  )
)

## End(Not run)
</code></pre>


</div>