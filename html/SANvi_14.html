<div class="container">

<table style="width: 100%;"><tr>
<td>variational_CAM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Mean Field Variational Bayes estimation of CAM</h2>

<h3>Description</h3>

<p><code>variational_CAM</code> is used to perform posterior inference under the common atoms model (CAM) of Denti et al. (2023) with Gaussian likelihood. 
The model uses Dirichlet process mixtures (DPM) at both the observational and distributional levels.
</p>


<h3>Usage</h3>

<pre><code class="language-R">variational_CAM(y, group, maxL = 30, maxK = 20, 
                m0 = 0, tau0 = .01, lambda0 = 3, gamma0 = 2, 
                conc_hyperpar = c(1,1,1,1), conc_par = NULL, 
                epsilon = 1e-6, seed = NULL, maxSIM = 1e5, 
                warmstart = TRUE, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Numerical vector of observations (required).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>Numerical vector of the same length of <code>y</code>, indicating the group membership (required).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxL, maxK</code></td>
<td>
<p>integers, the upper bounds for the observational and distributional clusters to fit, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m0, tau0, lambda0, gamma0</code></td>
<td>
<p>Hyperparameters on <code class="reqn">(\mu, \sigma^2) \sim NIG(m_0, \tau_0, \lambda_0,\gamma_0)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conc_hyperpar, conc_par</code></td>
<td>
<p>Vectors of values used for the concentration parameters of  of the stick-breaking representation for the distributional and observational DPs, respectively. 
The following two arguments can be passed. Specifically,
</p>

<dl>
<dt><code>conc_hyperpar</code></dt>
<dd>
<p>a vector with 4 positive entries: <code class="reqn">(s_1^\alpha,s_2^\alpha,s_1^\beta,s_2^\beta)</code>. 
If a random concentration parameters <code class="reqn">\alpha</code> and <code class="reqn">\beta</code> are adopted, the specifications are
<code class="reqn">\alpha \sim Gamma(s_1^\alpha,s_2^\alpha)</code> and <code class="reqn">\beta \sim Gamma(s_1^\beta,s_2^\beta)</code>. Default set to unitary vector.</p>
</dd>
<dt><code>conc_par</code></dt>
<dd>
<p>a vector with 2 positive entries: <code class="reqn">(\alpha,\beta)</code>. Default is set to <code>NULL</code>. If specified, the previous argument is ignored
and the two concentration parameters are assumed fixed and equal to <code>(alpha,beta)</code>.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon</code></td>
<td>
<p>the tolerance that drives the convergence criterion adopted as stopping rule</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>random seed to control the initialization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxSIM</code></td>
<td>
<p>the maximum number of CAVI iteration to perform.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warmstart</code></td>
<td>
<p>logical, if <code>TRUE</code>, the observational means of the cluster atoms are initialized with a k-means algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical, if <code>TRUE</code> the iterations are printed.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The common atoms mixture model is used to perform inference in nested settings, where the data are organized into <code class="reqn">J</code> groups.
The data should be continuous observations <code class="reqn">(Y_1,\dots,Y_J)</code>, where each <code class="reqn">Y_j = (y_{1,j},\dots,y_{n_j,j})</code>
contains the <code class="reqn">n_j</code> observations from group <code class="reqn">j</code>, for <code class="reqn">j=1,\dots,J</code>.
The function takes as input the data as a numeric vector <code>y</code> in this concatenated form. Hence <code>y</code> should be a vector of length
<code class="reqn">n_1+\dots+n_J</code>. The <code>group</code> parameter is a numeric vector of the same size as <code>y</code> indicating the group membership for each
individual observation.
Notice that with this specification the observations in the same group need not be contiguous as long as the correspondence between the variables
<code>y</code> and <code>group</code> is maintained.
</p>
<p><strong>Model</strong>
</p>
<p>The data are modeled using a Gaussian likelihood, where both the mean and the variance are observational-cluster-specific, i.e.,
</p>
<p style="text-align: center;"><code class="reqn">y_{i,j}\mid M_{i,j} = l \sim N(\mu_l,\sigma^2_l)</code>
</p>

<p>where <code class="reqn">M_{i,j} \in \{1,2,\dots\}</code> is the observational cluster indicator of observation <code class="reqn">i</code> in group <code class="reqn">j</code>.
The prior on the model parameters is a Normal-Inverse-Gamma distribution <code class="reqn">(\mu_l,\sigma^2_l)\sim NIG (m_0,\tau_0,\lambda_0,\gamma_0)</code>,
i.e., <code class="reqn">\mu_l\mid\sigma^2_l \sim N(m_0, \sigma^2_l / \tau_0)</code>, <code class="reqn">1/\sigma^2_l \sim Gamma(\lambda_0, \gamma_0)</code> (shape, rate).
</p>
<p><strong>Clustering</strong>
</p>
<p>The model performs a clustering of both observations and groups.
The clustering of groups (distributional clustering) is provided by the allocation variables <code class="reqn">S_j \in \{1,2,\dots\}</code>, with
</p>
<p style="text-align: center;"><code class="reqn">Pr(S_j = k \mid \dots ) = \pi_k  \qquad \text{for } \: k = 1,2,\dots</code>
</p>

<p>The distribution of the probabilities is <code class="reqn"> \{\pi_k\}_{k=1}^{\infty} \sim GEM(\alpha)</code>,
where GEM is the Griffiths-Engen-McCloskey distribution of parameter <code class="reqn">\alpha</code>,
which characterizes the stick-breaking construction of the DP (Sethuraman, 1994).
</p>
<p>The clustering of observations (observational clustering) is provided by the allocation variables <code class="reqn">M_{i,j} \in \{1,2,\dots\}</code>, with
</p>
<p style="text-align: center;"><code class="reqn"> Pr(M_{i,j} = l \mid S_j = k, \dots ) = \omega_{l,k} \qquad \text{for } \: k = 1,2,\dots \, ; \: l = 1,2,\dots </code>
</p>

<p>The distribution of the probabilities is <code class="reqn"> \{\omega_{l,k}\}_{l=1}^{\infty} \sim GEM(\beta)</code> for all <code class="reqn">k = 1,2,\dots</code>
</p>


<h3>Value</h3>

<p><code>variational_CAM</code> returns a list of class <code>SANvb</code> containing four objects:
</p>

<ul>
<li> <p><code>model</code>: name of the fitted model.
</p>
</li>
<li> <p><code>params</code>: list containing the data and the parameters used in the simulation. Details below.
</p>
</li>
<li> <p><code>sim</code>: list containing the simulated values (optimized variational parameters). Details below.
</p>
</li>
<li> <p><code>time</code>: total computation time.
</p>
</li>
</ul>
<p><strong>Data and parameters</strong>:
<code>params</code> is a list with the following components:
</p>

<dl>
<dt><code>y, group, Nj, J</code></dt>
<dd>
<p>Data, group labels, group frequencies, and number of groups.</p>
</dd>
<dt><code>K, L</code></dt>
<dd>
<p>Number of fitted distributional and observational clusters.</p>
</dd>
<dt><code>m0, tau0, lambda0, gamma0</code></dt>
<dd>
<p>Model hyperparameters.</p>
</dd>
<dt><code>epsilon, seed</code></dt>
<dd>
<p>The threshold controlling the convergence criterion and the random seed adopted to replicate the run.</p>
</dd>
<dt>(<code>hyp_alpha1,hyp_alpha2</code>) or <code>alpha</code>
</dt>
<dd>
<p>Hyperparameters on <code class="reqn">\alpha</code> (if <code class="reqn">\alpha</code> random);
or provided value for <code class="reqn">\alpha</code> (if fixed).</p>
</dd>
<dt>(<code>hyp_beta1,hyp_beta2</code>) or <code>beta</code>
</dt>
<dd>
<p>Hyperparameters on <code class="reqn">\beta</code> (if <code class="reqn">\beta</code> random);
or provided value for <code class="reqn">\beta</code> (if fixed).</p>
</dd>
</dl>
<p><strong>Simulated values</strong>:
<code>sim</code> is a list with the following components:
</p>

<dl>
<dt><code>theta_l</code></dt>
<dd>
<p>Matrix of size (L,4).
Each row is a posterior variational estimate of the four normal-inverse gamma hyperparameters.</p>
</dd>
<dt><code>Elbo_val</code></dt>
<dd>
<p>Vector containing the values of the ELBO.</p>
</dd>
<dt><code>XI</code></dt>
<dd>
<p>A list of length J. Each element is a matrix of size (N, L)
posterior variational probability of assignment of assignment of the i-th observation in the j-th group to the l-th OC, 
i.e., <code class="reqn">\hat{\xi}_{i,j,l} = \hat{\mathbb{Q}}(M_{i,j}=l)</code>.</p>
</dd>
<dt><code>RHO</code></dt>
<dd>
<p>Matrix of size (J, K).
Each row is a posterior variational probability of assignment of the j-th group to the k-th DC, i.e., <code class="reqn">\hat{\rho}_{j,k} = \hat{\mathbb{Q}}(S_j=k)</code>. </p>
</dd>
<dt><code>a_tilde_k,b_tilde_k</code></dt>
<dd>
<p>Vector of updated variational parameters of the Beta distributions governing the distributional stick-breaking process.</p>
</dd>
<dt><code>a_tilde_lk,b_tilde_lk</code></dt>
<dd>
<p>Matrix of updated variational parameters of the Beta distributions governing the observational stick-breaking 
process (arranged by column).</p>
</dd>
<dt><code>conc_hyper</code></dt>
<dd>
<p>If the concentration parameters are chosen to be random, these object contain a vector with the four updated hyperparameters.</p>
</dd>
<dt>
<code>alpha</code>,<code>beta</code>
</dt>
<dd>
<p>If the concentration parameters are chosen to be fixed, these objects contain the passed values.</p>
</dd>
</dl>
<h3>References</h3>

<p>Denti, F., Camerlenghi, F., Guindani, M., and Mira, A. (2023). A Common Atoms Model for the Bayesian Nonparametric Analysis of Nested Data. 
<em>Journal of the American Statistical Association</em>, 118(541), 405-416. DOI: 10.1080/01621459.2021.1933499
</p>
<p>Sethuraman, A.J. (1994). A Constructive Definition of Dirichlet Priors, <em>Statistica Sinica</em>, 4, 639–650.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
set.seed(123)
y &lt;- c(rnorm(100),rnorm(100,5))
g &lt;- rep(1:2,rep(100,2))
est &lt;- variational_CAM(y, g, verbose = FALSE,epsilon = 1e-2)

</code></pre>


</div>