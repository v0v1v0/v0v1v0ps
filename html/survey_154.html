<div class="container">

<table style="width: 100%;"><tr>
<td>postStratify</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Post-stratify a survey </h2>

<h3>Description</h3>

<p>Post-stratification adjusts the sampling and replicate weights so that
the joint distribution of a set of post-stratifying variables matches
the known population joint distribution. Use <code>rake</code> when
the full joint distribution is not available.
</p>


<h3>Usage</h3>

<pre><code class="language-R">postStratify(design, strata, population, partial = FALSE, ...)
## S3 method for class 'svyrep.design'
postStratify(design, strata, population, partial = FALSE, compress=NULL,...)
## S3 method for class 'survey.design'
postStratify(design, strata, population, partial = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>design</code></td>
<td>
<p>A survey design with replicate weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata</code></td>
<td>
<p>A formula or data frame of post-stratifying variables, which must not contain missing values. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>population</code></td>
<td>
<p>A <code>table</code>, <code>xtabs</code> or <code>data.frame</code>
with population frequencies </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>partial</code></td>
<td>
<p>if <code>TRUE</code>, ignore population strata not present in
the sample</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compress</code></td>
<td>
<p>Attempt to compress the replicate weight matrix? When
<code>NULL</code> will attempt to compress if the original weight matrix
was compressed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments for future expansion</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>population</code> totals can be specified as a table with the
strata variables in the margins, or as a data frame where one column
lists frequencies and the other columns list the unique combinations
of strata variables (the format produced by <code>as.data.frame</code>
acting on a <code>table</code> object).   A table must have named dimnames
to indicate the variable names.
</p>
<p>Compressing the replicate weights will take time and may even
increase memory use if there is actually little redundancy in the
weight matrix (in particular if the post-stratification variables have
many values and cut  across PSUs).
</p>
<p>If a <code>svydesign</code> object is to be converted to a replication
design the post-stratification should be performed after conversion.
</p>
<p>The variance estimate for replication designs follows the same
procedure as Valliant (1993) described for estimating totals. Rao et
al (2002) describe this procedure for estimating functions (and also
the GREG or g-calibration procedure, see <code>calibrate</code>)
</p>


<h3>Value</h3>

<p>A new survey design object.
</p>


<h3>Note</h3>

<p>If the sampling weights are already post-stratified there will be no
change in point estimates after <code>postStratify</code> but the standard
error estimates will decrease to correctly reflect the post-stratification.
</p>


<h3>References</h3>

<p>Valliant R (1993) Post-stratification and conditional variance
estimation. JASA 88: 89-96  
</p>
<p>Rao JNK, Yung W, Hidiroglou MA (2002)   Estimating equations for the
analysis of survey data using poststratification information. Sankhya
64 Series A Part 2, 364-378.
</p>


<h3>See Also</h3>

<p><code>rake</code>, <code>calibrate</code> for other things to do
with auxiliary information
</p>
<p><code>compressWeights</code> for information on compressing weights</p>


<h3>Examples</h3>

<pre><code class="language-R">data(api)
dclus1&lt;-svydesign(id=~dnum, weights=~pw, data=apiclus1, fpc=~fpc)
rclus1&lt;-as.svrepdesign(dclus1)

svymean(~api00, rclus1)
svytotal(~enroll, rclus1)

# post-stratify on school type
pop.types &lt;- data.frame(stype=c("E","H","M"), Freq=c(4421,755,1018))
#or: pop.types &lt;- xtabs(~stype, data=apipop)
#or: pop.types &lt;- table(stype=apipop$stype)

rclus1p&lt;-postStratify(rclus1, ~stype, pop.types)
summary(rclus1p)
svymean(~api00, rclus1p)
svytotal(~enroll, rclus1p)


## and for svydesign objects
dclus1p&lt;-postStratify(dclus1, ~stype, pop.types)
summary(dclus1p)
svymean(~api00, dclus1p)
svytotal(~enroll, dclus1p)
</code></pre>


</div>