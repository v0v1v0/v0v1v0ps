<div class="container">

<table style="width: 100%;"><tr>
<td>selectMatch</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Two-level sample selection</h2>

<h3>Description</h3>

<p>Carries out a two-level sample selection where the possibility of an initially selected
site not wanting to participate is anticipated, and the site is optimally replaced. 
The procedure aims to reduce the bias (and/or loss of generalizability) with respect to the target population.
</p>


<h3>Usage</h3>

<pre><code class="language-R">selectMatch(
  df,
  unitID,
  subunitID,
  subunitSampVars,
  unitVars,
  nUnitSamp,
  nRepUnits,
  nsubUnits,
  exactMatchVars = NULL,
  calipMatchVars = NULL,
  calipValue = 0.2,
  seedN = NA,
  matchDistance = "mahalanobis",
  sizeFlag = TRUE,
  repFlag = TRUE,
  writeOut = FALSE,
  replacementUnitsFilename = "replacementUnits.csv",
  subUnitTableFilename = "subUnitTable.csv"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>dataframe; sub-unit level dataframe with both sub-unit and unit level variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitID</code></td>
<td>
<p>character; name of unit ID column</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subunitID</code></td>
<td>
<p>character; name of sub-unit ID column</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subunitSampVars</code></td>
<td>
<p>vector;  column names of unit level variables  to sample units on</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitVars</code></td>
<td>
<p>vector; column names of unit level variables  to match units on</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nUnitSamp</code></td>
<td>
<p>numeric; number of units to be initially randomly selected</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nRepUnits</code></td>
<td>
<p>numeric; number of replacement units to find for each selected unit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsubUnits</code></td>
<td>
<p>numeric; number of sub-units to be randomly selected for each unit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exactMatchVars</code></td>
<td>
<p>vector; column names of categorical variables on which units must be matched exactly. Must be present in 'unitVars'; default = NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calipMatchVars</code></td>
<td>
<p>vector; column names of continuous variables on which units must be matched within a specified caliper. Must be present in 'unitVars'; default = NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calipValue</code></td>
<td>
<p>numeric; number of standard deviations to be used as caliper for matching units on calipMatchVars</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seedN</code></td>
<td>
<p>numeric; seed number to be used for sampling. If NA, calls set.seed(); default = NA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matchDistance</code></td>
<td>
<p>character; MatchIt distance parameter to obtain optimal matches (nearest neigboors); default = "mahalanois"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sizeFlag</code></td>
<td>
<p>logical; if TRUE, sampling is made proportional to unit size; default = TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>repFlag</code></td>
<td>
<p>logical; if TRUE, pick unit matches with/without repetition; default = TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>writeOut</code></td>
<td>
<p>logical; if TRUE, writes a .csv file for each output table; default = FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replacementUnitsFilename</code></td>
<td>
<p>character; csv filename for saving unit:replacement directory when writeOut == TRUE; default = "replacementUnits.csv"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subUnitTableFilename</code></td>
<td>
<p>character; csv filename for saving unit:replacement directory when writeOut == TRUE; default = "subUnitTable.csv"</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>list with: 1) table of the form: selected unit i: (unit i replacements), 2) table of the form: potential unit i:(unit i sub-units), 3) balance diagnostics.
</p>


<h3>Examples</h3>

<pre><code class="language-R">################################################################################
############## Prepare dataframe [sitepickR Package] ###########################
######### Robert Olsen, Elizabeth A. Stuart &amp; Elena Badillo-Goicoechea (2022) ##

# Basic usage of selectMatch()

rawCCD &lt;- sitepickR::rawCCD

uSampVarsCCD &lt;- c("w.pct.frlunch", "w.pct.black", "w.pct.hisp", "w.pct.female") 
suSampVarsCCD &lt;- c("sch.pct.frlunch", "sch.pct.black", "sch.pct.hisp", "sch.pct.female")

dfCCD &lt;- prepDF(rawCCD,
                unitID="LEAID", subunitID="NCESSCH")
dfCCD &lt;- dplyr::filter(dfCCD, unitID %in% unique(dfCCD$unitID)[1:80])

smOut &lt;- selectMatch(df = dfCCD, # user dataset
                     unitID = "LEAID", # column name of unit ID in user dataset
                     subunitID = "NCESSCH", # column name of sub-unit ID in user dataset
                     unitVars = uSampVarsCCD, # name of unit level covariate columns
                     subunitSampVars = suSampVarsCCD, # name of sub-unit level covariate columns
                     nUnitSamp = 30,
                     nRepUnits = 5,
                     nsubUnits = 2
)
</code></pre>


</div>