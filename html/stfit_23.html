<div class="container">

<table style="width: 100%;"><tr>
<td>stfit_landsat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>STFIT for Landsat data</h2>

<h3>Description</h3>

<p>This function is used for Landsat data imputation, which includes five steps: 
mean estimation, outlier detection, temporal effect estimation, spatial effect
estimation and imputation. In real application, one can use this as a template
to create a five steps imputation procedure depending on the real data structure.
</p>


<h3>Usage</h3>

<pre><code class="language-R">stfit_landsat(
  year,
  doy,
  mat,
  img.nrow,
  img.ncol,
  doyeval = 1:365,
  h.tcov = 100,
  h.tsigma2 = 300,
  h.scov = 2,
  h.ssigma2 = 2,
  nnr = 10,
  outlier.action = c("keep", "remove"),
  outlier.tol = 0.2,
  intermediate.save = TRUE,
  intermediate.dir = "./intermediate_output/",
  use.intermediate.result = TRUE,
  teff = TRUE,
  seff = TRUE,
  doy.break = NULL,
  cycle = FALSE,
  t.grid = NULL,
  t.grid.num = 50,
  clipRange = c(0, 1800),
  clipMethod = "nnr",
  var.est = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>year</code></td>
<td>
<p>vecotr of year</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>doy</code></td>
<td>
<p>vecotr of DOY (day of the year)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mat</code></td>
<td>
<p>a numeric matrix. Each row contains a row stacked image pixel values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>img.nrow</code></td>
<td>
<p>number of rows of the image</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>img.ncol</code></td>
<td>
<p>number of columns of the image</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>doyeval</code></td>
<td>
<p>a vector of DOY on which to get the mean and temporal imputation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h.tcov</code></td>
<td>
<p>bandwidth for temporal covariance estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h.tsigma2</code></td>
<td>
<p>bandwith for temporal variance estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h.scov</code></td>
<td>
<p>bandwidth for spatial covariance estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h.ssigma2</code></td>
<td>
<p>bandwidth for spatial variance estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nnr</code></td>
<td>
<p>maximum number of nearest neighbor pixels to use for spatial covariance estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outlier.action</code></td>
<td>
<p>"keep" to keep outliers; "remove" to replace outliers with imputed values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outlier.tol</code></td>
<td>
<p>The threshold to use to define outlier image. Default is 0.2, i.e. images
with more than 20% outlier pixels are treated as outlier image.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intermediate.save</code></td>
<td>
<p>TRUE or FASLE; whether to save the intermediate results including
mean, temporal effect and spacial effect imputation resutls. The intermediate results can be
useful to avoid duplicating the computation for some imputation steps.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intermediate.dir</code></td>
<td>
<p>directory where to save the intermediate results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.intermediate.result</code></td>
<td>
<p>whether to use the intermediate results in the 'intermediate.dir' folder. 
Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>teff</code></td>
<td>
<p>TRUE or FALSE, wheter to calculate the temporal effect. Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seff</code></td>
<td>
<p>TRUE or FALSE, wheter to calculate the spatial effect. Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>doy.break</code></td>
<td>
<p>a vector of break points for <code>doy</code> where the spatial effect are 
estimated seperately on each interval. Default is NULL, i.e. the spatial effect is assumed
to be the same over <code>doy</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cycle</code></td>
<td>
<p>TRUE or FALSE. When <code>doy.break</code> is specified, whether to combine the first
<code>doy.break</code> interval and the last <code>doy.break</code> together for spatial effect estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t.grid</code></td>
<td>
<p>a vector of grid points on which to calculate the temporal covariance function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t.grid.num</code></td>
<td>
<p>number of grid points to use for temporal covariance estimation. 
Ignored if <code>t.grid</code> is given.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clipRange</code></td>
<td>
<p>passed to <code>meanEst</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clipMethod</code></td>
<td>
<p>passed to <code>meanEst</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.est</code></td>
<td>
<p>Whether to estimate the variance of the temporal and spatial effects. Default is FALSE.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>List of length 4 with entries:
</p>

<ul>
<li>
<p> imat: imputed matrix of <code>mat</code>
</p>
</li>
<li>
<p> smat: standard error matrix of the same size as <code>mat</code>
</p>
</li>
<li>
<p> idx: a list of image indexes 
</p>

<ul>
<li>
<p> idx.allmissing: completely missing image indexes,
</p>
</li>
<li>
<p> idx.partialmissing: partially observed image indexes,
</p>
</li>
<li>
<p> idx.fullyobserved: fully observed image indexes,
</p>
</li>
<li>
<p> idx.outlier: outlier image indexes.
</p>
</li>
</ul>
</li>
<li>
<p> outlier: a list of image outliers information
</p>

<ul>
<li>
<p> outidx: image index with outlier pixels,
</p>
</li>
<li>
<p> outpct: percentage of outlier pixels corresponding to <code>outidx</code>,
</p>
</li>
<li>
<p> outlst: a list of the same length as <code>outidx</code>, with each list the missing 
pixel index.
</p>
</li>
</ul>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
library(doParallel)
library(raster)
library(rasterVis)
library(RColorBrewer)
dfB = landsat106[landsat106$year &gt;= 2000,]
matB = as.matrix(dfB[,-c(1:2)])
year = dfB$year
doy = dfB$doy
if(require(doParallel))
  registerDoParallel(1)
res &lt;- stfit_landsat(year, doy, matB, 31, 31, nnr=30,
use.intermediate.result = FALSE, intermediate.save = FALSE, var.est = TRUE)
## visualize the imputed results
idx = c(res$idx$idx.allmissing[150], res$idx$idx.partialmissing[c(30, 60, 90)])
rst_list = list()
for(i in 1:length(idx)){
  rst_list[(i-1)*3+1] = raster(matrix(matB[idx[i],], 31))
  rst_list[(i-1)*3+2] = raster(matrix(res$imat[idx[i],], 31))
  rst_list[(i-1)*3+3] = raster(matrix(res$sdmat[idx[i],], 31))
}
s = stack(rst_list)
levelplot(s, index.cond=list(c(seq(1, 12, 3), seq(2, 12, 3), seq(3, 12, 3))),
          par.setting = rasterTheme(panel.background=list(col="black"),
                                    region = brewer.pal(9, 'YlOrRd')),
          names.attr = c(rbind(paste0("Original ", idx), 
                               paste0("Imputed ", idx),
                               paste0("Std. Error ", idx))),
          layout = c(4,3))


</code></pre>


</div>