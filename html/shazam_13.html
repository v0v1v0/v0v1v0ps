<div class="container">

<table style="width: 100%;"><tr>
<td>consensusSequence</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Construct a consensus sequence</h2>

<h3>Description</h3>

<p>Construct a consensus sequence
</p>


<h3>Usage</h3>

<pre><code class="language-R">consensusSequence(
  sequences,
  db = NULL,
  method = c("mostCommon", "thresholdedFreq", "catchAll", "mostMutated", "leastMutated"),
  minFreq = NULL,
  muFreqColumn = NULL,
  lenLimit = NULL,
  includeAmbiguous = FALSE,
  breakTiesStochastic = FALSE,
  breakTiesByColumns = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sequences</code></td>
<td>
<p>character vector of sequences.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>db</code></td>
<td>
<p><code>data.frame</code> containing sequence data for a single clone.
Applicable to and required for the <code>"mostMutated"</code> and
<code>"leastMutated"</code> methods. Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>method to calculate consensus sequence. One of
<code>"thresholdedFreq"</code>, <code>"mostCommon"</code>, <code>"catchAll"</code>,
<code>"mostMutated"</code>, or <code>"leastMutated"</code>. See "Methods" under
collapseClones for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minFreq</code></td>
<td>
<p>frequency threshold for calculating input consensus sequence.
Applicable to and required for the <code>"thresholdedFreq"</code> method.
A canonical choice is 0.6. Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>muFreqColumn</code></td>
<td>
<p><code>character</code> name of the column in db containing mutation
frequency. Applicable to and required for the <code>"mostMutated"</code>
and <code>"leastMutated"</code> methods. Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lenLimit</code></td>
<td>
<p>limit on consensus length. if <code>NULL</code> then no length limit is set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>includeAmbiguous</code></td>
<td>
<p>whether to use ambiguous characters to represent positions at
which there are multiple characters with frequencies that are at least
<code>minimumFrequency</code> or that are maximal (i.e. ties). Applicable to
and required for the <code>"thresholdedFreq"</code> and <code>"mostCommon"</code>
methods. Default is <code>FALSE</code>. See "Choosing ambiguous characters"
under collapseClones for rules on choosing ambiguous characters.
Note: this argument refers to the use of ambiguous nucleotides in the 
output consensus sequence. Ambiguous nucleotides in the input sequences
are allowed for methods catchAll, mostMutated and leastMutated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breakTiesStochastic</code></td>
<td>
<p>In case of ties, whether to randomly pick a sequence from sequences that
fulfill the criteria as consensus. Applicable to and required for all methods
except for <code>"catchAll"</code>. Default is <code>FALSE</code>. See "Methods"
under collapseClones for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breakTiesByColumns</code></td>
<td>
<p>A list of the form <code>list(c(col_1, col_2, ...), c(fun_1, fun_2, ...))</code>,
where <code>col_i</code> is a <code>character</code> name of a column in <code>db</code>,
and <code>fun_i</code> is a function to be applied on that column. Currently,
only <code>max</code> and <code>min</code> are supported. Note that the two <code>c()</code>'s
in <code>list()</code> are essential (i.e. if there is only 1 column, the list
should be of the form <code>list(c(col_1), c(func_1))</code>. Applicable to and
optional for the <code>"mostMutated"</code> and <code>"leastMutated"</code> methods.
If supplied, <code>fun_i</code>'s are applied on <code>col_i</code>'s to help break
ties. Default is <code>NULL</code>. See "Methods" under collapseClones
for details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See collapseClones for detailed documentation on methods and additional parameters.
</p>


<h3>Value</h3>

<p>A list containing <code>cons</code>, which is a character string that is the consensus sequence
for <code>sequences</code>; and <code>muFreq</code>, which is the maximal/minimal mutation frequency of
the consensus sequence for the <code>"mostMutated"</code> and <code>"leastMutated"</code> methods, or
<code>NULL</code> for all other methods.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Subset example data
data(ExampleDb, package="alakazam")
db &lt;- subset(ExampleDb, c_call %in% c("IGHA", "IGHG") &amp; sample_id == "+7d")
clone &lt;- subset(db, clone_id == "3192")

# First compute mutation frequency for most/leastMutated methods
clone &lt;- observedMutations(clone, frequency=TRUE, combine=TRUE)

# Manually create a tie
clone &lt;- rbind(clone, clone[which.max(clone$mu_freq), ])

# ThresholdedFreq method. 
# Resolve ties deterministically without using ambiguous characters
cons1 &lt;- consensusSequence(clone$sequence_alignment,
                           method="thresholdedFreq", minFreq=0.3,
                           includeAmbiguous=FALSE, 
                           breakTiesStochastic=FALSE)
cons1$cons
                                        
</code></pre>


</div>