<div class="container">

<table style="width: 100%;"><tr>
<td>PLSrounding</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>PLS inspired rounding</h2>

<h3>Description</h3>

<p>Small count rounding of necessary inner cells are performed so that all small frequencies of cross-classifications to be published
(publishable cells) are rounded. The publishable cells can be defined from a model formula, hierarchies or automatically from data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">PLSrounding(
  data,
  freqVar = NULL,
  roundBase = 3,
  hierarchies = NULL,
  formula = NULL,
  dimVar = NULL,
  maxRound = roundBase - 1,
  printInc = nrow(data) &gt; 1000,
  output = NULL,
  preAggregate = is.null(freqVar),
  ...
)

PLSroundingInner(..., output = "inner")

PLSroundingPublish(..., output = "publish")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Input data as a data frame (inner cells)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freqVar</code></td>
<td>
<p>Variable holding counts (inner cells frequencies).  When <code>NULL</code> (default), microdata is assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roundBase</code></td>
<td>
<p>Rounding base</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hierarchies</code></td>
<td>
<p>List of hierarchies</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Model formula defining publishable cells</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dimVar</code></td>
<td>
<p>The main dimensional variables and additional aggregating variables. This parameter can be  useful when hierarchies and formula are unspecified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxRound</code></td>
<td>
<p>Inner cells contributing to original publishable cells equal to or less than maxRound will be rounded</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>printInc</code></td>
<td>
<p>Printing iteration information to console when TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>Possible non-NULL values are <code>"input"</code>, <code>"inner"</code> and <code>"publish"</code>. Then a single data frame is returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>preAggregate</code></td>
<td>
<p>When <code>TRUE</code>, the data will be aggregated beforehand within the function by the dimensional variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further parameters sent to <code>RoundViaDummy</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is a user-friendly wrapper for <code>RoundViaDummy</code> with data frame output and with computed summary of the results.
See <code>RoundViaDummy</code> for more details.
</p>


<h3>Value</h3>

<p>Output is a four-element list with class attribute "PLSrounded" (to ensure informative printing).
</p>
<table>
<tr style="vertical-align: top;">
<td><code>inner</code></td>
<td>
<p>Data frame corresponding to input data with the main dimensional variables and with cell
frequencies (original, rounded, difference).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>publish</code></td>
<td>
<p>Data frame of publishable data with the main dimensional variables and with cell frequencies
(original, rounded, difference).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metrics</code></td>
<td>
<p>A named character vector of various statistics calculated from the two output data frames
("<code>inner_</code>" used to distinguish). See examples below and the function <code>HDutility</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freqTable</code></td>
<td>
<p>Matrix of frequencies of cell frequencies and absolute differences.
For example, row "<code>rounded</code>" and column "<code>inn.4+</code>" is the number of rounded
inner cell frequencies greater than or equal to <code>4</code>.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Langsrud, Ø. and Heldal, J. (2018): “An Algorithm for Small Count Rounding of Tabular Data”.
Presented at: <em>Privacy in statistical databases</em>, Valencia, Spain. September 26-28, 2018.
<a href="https://www.researchgate.net/publication/327768398_An_Algorithm_for_Small_Count_Rounding_of_Tabular_Data">https://www.researchgate.net/publication/327768398_An_Algorithm_for_Small_Count_Rounding_of_Tabular_Data</a>
</p>


<h3>See Also</h3>

<p><code>RoundViaDummy</code>, <code>PLS2way</code>, <code>ModelMatrix</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Small example data set
z &lt;- SmallCountData("e6")
print(z)

# Publishable cells by formula interface
a &lt;- PLSrounding(z, "freq", roundBase = 5,  formula = ~geo + eu + year)
print(a)
print(a$inner)
print(a$publish)
print(a$metrics)
print(a$freqTable)

# Recalculation of maxdiff, HDutility, meanAbsDiff and rootMeanSquare
max(abs(a$publish[, "difference"]))
HDutility(a$publish[, "original"], a$publish[, "rounded"])
mean(abs(a$publish[, "difference"]))
sqrt(mean((a$publish[, "difference"])^2))

# Six lines below produce equivalent results 
# Ordering of rows can be different
PLSrounding(z, "freq") # All variables except "freq" as dimVar  
PLSrounding(z, "freq", dimVar = c("geo", "eu", "year"))
PLSrounding(z, "freq", formula = ~eu * year + geo * year)
PLSrounding(z[, -2], "freq", hierarchies = SmallCountData("eHrc"))
PLSrounding(z[, -2], "freq", hierarchies = SmallCountData("eDimList"))
PLSrounding(z[, -2], "freq", hierarchies = SmallCountData("eDimList"), formula = ~geo * year)

# Define publishable cells differently by making use of formula interface
PLSrounding(z, "freq", formula = ~eu * year + geo)

# Define publishable cells differently by making use of hierarchy interface
eHrc2 &lt;- list(geo = c("EU", "@Portugal", "@Spain", "Iceland"), year = c("2018", "2019"))
PLSrounding(z, "freq", hierarchies = eHrc2)

# Also possible to combine hierarchies and formula
PLSrounding(z, "freq", hierarchies = SmallCountData("eDimList"), formula = ~geo + year)

# Single data frame output
PLSroundingInner(z, "freq", roundBase = 5, formula = ~geo + eu + year)
PLSroundingPublish(z, roundBase = 5, formula = ~geo + eu + year)

# Microdata input
PLSroundingInner(rbind(z, z), roundBase = 5, formula = ~geo + eu + year)

# Parameter avoidHierarchical (see RoundViaDummy and ModelMatrix) 
PLSroundingPublish(z, roundBase = 5, formula = ~geo + eu + year, avoidHierarchical = TRUE)

# Package sdcHierarchies can be used to create hierarchies. 
# The small example code below works if this package is available. 
if (require(sdcHierarchies)) {
  z2 &lt;- cbind(geo = c("11", "21", "22"), z[, 3:4], stringsAsFactors = FALSE)
  h2 &lt;- list(
    geo = hier_compute(inp = unique(z2$geo), dim_spec = c(1, 1), root = "Tot", as = "df"),
    year = hier_convert(hier_create(root = "Total", nodes = c("2018", "2019")), as = "df"))
  PLSrounding(z2, "freq", hierarchies = h2)
}

# Use PLS2way to produce tables as in Langsrud and Heldal (2018) and to demonstrate 
# parameters maxRound, zeroCandidates and identifyNew (see RoundViaDummy).   
# Parameter rndSeed used to ensure same output as in reference.
exPSD &lt;- SmallCountData("exPSD")
a &lt;- PLSrounding(exPSD, "freq", 5, formula = ~rows + cols, rndSeed=124)
PLS2way(a, "original")  # Table 1
PLS2way(a)  # Table 2
a &lt;- PLSrounding(exPSD, "freq", 5, formula = ~rows + cols, identifyNew = FALSE, rndSeed=124)
PLS2way(a)  # Table 3
a &lt;- PLSrounding(exPSD, "freq", 5, formula = ~rows + cols, maxRound = 7)
PLS2way(a)  # Values in col1 rounded
a &lt;- PLSrounding(exPSD, "freq", 5, formula = ~rows + cols, zeroCandidates = TRUE)
PLS2way(a)  # (row3, col4): original is 0 and rounded is 5
</code></pre>


</div>