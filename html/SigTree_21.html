<div class="container">

<table style="width: 100%;"><tr>
<td>plotSigTree</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function to plot the phylogenetic tree in R with branches (tips) colored according to significance of families of p-values (tips' p-values)
</h2>

<h3>Description</h3>

<p><code>plotSigTree</code> takes <code>tree</code> and <code>unsorted.pvalues</code> and computes p-values for each branch (family
of tips) and colors the corresponding descendant branches.  It computes the p-values based on arguments 
involving p-value adjustment (for multiple hypothesis testing) and either Hartung's, Stouffer's, or Fisher's 
p-value combination method.  There are arguments that allow for the customization of the p-value cutoff 
ranges as well as the colors to be used in the coloring of the branches.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plotSigTree(tree, unsorted.pvalues, adjust=TRUE, side=1, 
	method="hommel", p.cutoffs=ifelse(rep(side==1, ifelse(side==1, 6, 3)),
	c(.01, .05, .1, .9, .95, .99), c(.01, .05, .1)),
	pal=ifelse(rep(side==1, ifelse(side==1, 1, length(p.cutoffs)+1)),
	"RdBu", rev(brewer.pal(length(p.cutoffs)+1,"Reds"))),
	test="Stouffer", branch.label=FALSE, tip.color=TRUE, edge.color=TRUE,
	tip.label.size=1, branch.label.size=1,  type="fan",
	use.edge.length=TRUE, edge.width=1, branch="edge", 
	root.edge=ifelse(type=="fan",FALSE,TRUE),
	branch.label.frame="none")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tree</code></td>
<td>

<p>a phylogenetic tree of class <code>phylo</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unsorted.pvalues</code></td>
<td>

<p>a data frame (or matrix) with tip labels in column 1 and p-values in column 2.  The tip labels must correspond to the tip labels in <code>tree</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjust</code></td>
<td>

<p>a logical argument that controls whether there is p-value adjustment performed (<code>TRUE</code>) or not (<code>FALSE</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>side</code></td>
<td>

<p>a numerical argument that takes values <code>1</code> and <code>2</code>, depending on whether the p-values in <code>unsorted.pvalues</code> are 1-sided or 2-sided, respectively.  Only used in p-value adjustment if <code>adjust = TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>

<p>one of the p-value adjustment methods (used for multiple-hypothesis testing) found in <code>p.adjust.methods</code> (<code>"holm"</code>, <code>"hochberg"</code>, <code>"hommel"</code>, <code>"BH"</code>, <code>"bonferroni"</code>, <code>"BY"</code>, <code>"fdr"</code>, and <code>"none"</code>).  See help for <code>p.adjust</code> for more details on these methods.  <code>method</code> is only used if <code>adjust = TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.cutoffs</code></td>
<td>

<p>a vector of increasing p-value cutoffs (excluding 0 and 1) to determine the ranges of p-values used in the coloring of the branches.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pal</code></td>
<td>

<p>one of the palettes from the RColorBrewer package (see <code>brewer.pal.info</code> for a list) or a vector of hexadecimal colors (or other valid <code>R</code> colors).  These are the colors that are used to color the branches.  The first color corresponds to the first range in p.cutoffs and so on.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test</code></td>
<td>

<p>a character string taking on <code>"Hartung"</code>, <code>"Stouffer"</code>, or <code>"Fisher"</code>.  This is the p-value combination method that will be used.  In most cases, "Stouffer" will be most appropriate, unless <code>adonis.tree</code> indicates significant evidence of dependence among p-values, in which case "Hartung" is preferred.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>branch.label</code></td>
<td>

<p>a logical argument that controls whether the branches are labeled (<code>TRUE</code>) or not (<code>FALSE</code>). This results in either edges or nodes being labeled, depending on the <code>branch</code> argument.  The edge and node labeling is internal to class <code>phylo</code>, and are not necessarily sequential numbers.  When <code>branch="edge"</code> is used, the tip edges are not labeled (to avoid clutter).  Branch labels match those returned by <code>export.inherit</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tip.color</code></td>
<td>

<p>a logical argument that controls whether the tips are colored (<code>TRUE</code>) or not (<code>FALSE</code>). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>edge.color</code></td>
<td>

<p>a logical argument that controls whether the edges are colored (<code>TRUE</code>) or not (<code>FALSE</code>). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tip.label.size</code></td>
<td>

<p>a numerical argument that controls the (cex) size of the text of the tip labels.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>branch.label.size</code></td>
<td>

<p>a numerical argument that controls the (cex) size of the text of the branch labels (see <code>branch.label</code> argument).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>

<p>a character string that controls which type of plot will be produced.  Possible values are <code>"phylogram"</code>, <code>"cladogram"</code>, <code>"fan"</code>, <code>"unrooted"</code>, and <code>"radial"</code>.  See <code>plot.phylo</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.edge.length</code></td>
<td>

<p>a logical argument that uses the original edge lengths from <code>tree</code> (<code>TRUE</code>) or not (<code>FALSE</code>).  This has no effect if <code>tree</code> does not have edge lengths defined to begin with.  Can be affected by <code>root.edge</code>, depending on <code>type</code> (see <code>root.edge</code> below).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>edge.width</code></td>
<td>

<p>a numeric vector controlling width of plotted edges. This is passed to (<code>plot.phylo</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>branch</code></td>
<td>

<p>a character controlling branch definition: <code>"edge"</code> and <code>"node"</code> are the only options.  This does not affect statistical methods, only the colors used in edge coloring. Prior to package version 1.2, only <code>branch="node"</code> was implemented.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>root.edge</code></td>
<td>

<p>a logical argument that controls whether the root edge is plotted (<code>TRUE</code>) or not (<code>FALSE</code>). Note that <code>root.edge=TRUE</code> forces <code>use.edge.length=FALSE</code> when <code>type</code> is <code>"phylogram"</code>, <code>"cladogram"</code>, <code>"fan"</code>, or <code>"unrooted"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>branch.label.frame</code></td>
<td>

<p>a character controlling the frame around the branch labels (only used when <code>branch.label=TRUE</code>).  Only options <code>"none"</code>, <code>"circ"</code>, and <code>"rect"</code> are supported.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The tip labels of <code>tree</code> (accessed via <code>tree$tip.label</code>) must have the same names (and the same length) as the tip labels in <code>unsorted.pvalues</code>, but may be in a different order.  The p-values in column 2 of <code>unsorted.pvalues</code> obviously must be in the [0, 1] range.  <code>p.cutoffs</code> takes values in the (0, 1) range.  The default value for <code>p.cutoffs</code> is <code>c(0.01, 0.05, 0.1, 0.9, 0.95, 0.99)</code> if <code>side</code> is <code>1</code> and <code>c(0.01, 0.05, 0.1)</code> if side is <code>2</code>.  Thus, the ranges (when side is <code>1</code>) are: [0, .01], (.01, .05], ..., (.99, 1].  These ranges correspond to the colors specified in <code>pal</code>.  P-values in the [0, .01] range correspond to the left-most color if <code>pal</code> is a palette (view this via <code>display.brewer.pal(x, pal)</code> - where <code>x</code> is the number of colors to be used) or the first value in the vector if <code>pal</code> is a vector of colors.  If <code>pal</code> is a vector of colors, then the length of <code>pal</code> should be one greater than the length of <code>p.cutoffs</code>.  In other words, its length must be the same as the number of p-value ranges.  An example of a color in hexadecimal format is <code>"#B2182B"</code>. The default value of <code>pal</code> is <code>"RdBu"</code> (a divergent palette of reds and blues, with reds corresponding to small p-values) if <code>side</code> is <code>1</code> and the reverse of <code>"Reds"</code> (a sequential palette) if <code>side</code> is 2.   The sequential palettes in <code>RColorBrewer</code> go from light to dark, so <code>"Reds"</code> is reversed so that the dark red corresponds to small p-values.    It probably makes more sense to use a divergent palette when using 1-sided p-values and a sequential palette (reversed) when using 2-sided p-values.  To create a vector of reversed colors from a palette with <code>x</code> number of colors and <code>"PaletteName"</code> as the name of the palette, use <code>rev(brewer.pal(x, "PaletteName"))</code>.  <code>use.edge.length</code> may be useful to get a more uniformly-shaped tree.  <code>plotSigTree</code> assumes that each internal node has exactly two descendants.  It also assumes that each internal node has a lower number than each of its ancestors (excluding tips).
</p>
<p>The <code>branch</code> argument controls whether edge coloring corresponds to the combined p-value of the tips below the edge (<code>"edge"</code>) or of the tips below the edge's leading (away from the tips) node (<code>"node"</code>).  Note that if <code>branch="node"</code> is used, then both edges leaving a node will necessarily be colored the same.
</p>
<p>To access the tutorial document for this package (including this function), type in R: <code>vignette("SigTree")</code>
</p>


<h3>Value</h3>

<p>This function produces a phylogenetic tree plot.
</p>


<h3>Note</h3>

<p>Extensive discussion of methods developed for this package are available in Jones (2012).  In that reference, (and prior to package version number 1.1), this <code>plotSigTree</code> function was named <code>plot.color</code>; the name change was made to resolve S3 class issues.
</p>
<p>For purposes of acknowledgments, it is worth noting here that the plotting done by <code>plotSigTree</code> relies internally on tools of the <code>ape</code> package (Paradis et al., 2004 Bioinformatics 20:289-290).  To accomodate edge-specific coloring (as with the <code>branch="edge"</code> option), some of these <code>ape</code> package tools were adapted and re-named in the <code>SigTree</code> package.  Specifically, see <code>?plotphylo2</code> and <code>?circularplot2</code>.
</p>


<h3>Author(s)</h3>

<p>John R. Stevens and Todd R. Jones
</p>


<h3>References</h3>

<p>Stevens J.R., Jones T.R., Lefevre M., Ganesan B., and Weimer B.C. (2017) "SigTree: A Microbial Community Analysis Tool to Identify and Visualize Significantly Responsive Branches in a Phylogenetic Tree."  Computational and Structural Biotechnology Journal 15:372-378.
</p>
<p>Jones T.R. (2012) "SigTree: An Automated Meta-Analytic Approach to Find Significant Branches in a Phylogenetic Tree" (2012). MS Thesis, Utah State University, Department of Mathematics and Statistics.  http://digitalcommons.usu.edu/etd/1314
</p>


<h3>Examples</h3>

<pre><code class="language-R">### To access the tutorial document for this package, type in R (not run here): 
# vignette('SigTree')

### Create tree, then data frame, then use plotSigTree to plot the tree
### Code for random tree and data frame
node.size &lt;- 10
seed &lt;- 109
# Create tree
set.seed(seed);
library(ape)
r.tree &lt;- rtree(node.size)
# Create p-values data frame
set.seed(seed)
r.pval &lt;- rbeta(node.size, .1, .1)
# Randomize the order of the tip labels
# (just to emphasize that labels need not be sorted)
set.seed(seed)
r.tip.label &lt;- sample(r.tree$tip.label, size=length(r.tree$tip.label))
r.pvalues &lt;- data.frame(label=r.tip.label, pval=r.pval)

# Check for dependence among p-values; lack of significance here
# indicates default test="Stouffer" is appropriate; 
# otherwise, test="Hartung" would be more appropriate.
adonis.tree(r.tree,r.pvalues)

# Plot tree in default 'fan' type, with branches labeled
plotSigTree(r.tree, r.pvalues, edge.width=4, branch.label=TRUE)

# Plot tree in 'phylogram' type, with branch labels circled
plotSigTree(r.tree, r.pvalues, edge.width=4, branch.label=TRUE,
  type='phylo', branch.label.frame='circ')
  
# Plot tree in 'phylogram' type, with branch labels circled,
# and assuming original p-values were for 2-sided test
plotSigTree(r.tree, r.pvalues, edge.width=4, branch.label=TRUE,
  type='phylo', branch.label.frame='circ', side=2)

# Plot tree in 'phylogram' type, with branch labels boxed;
# also give custom significance thresholds, and use
# a Purple-Orange palette (dark purple for low p-vals
# to dark orange for high p-vals)
plotSigTree(r.tree, r.pvalues, edge.width=4, branch.label=TRUE,
  type='phylo', branch.label.frame='rect',
  p.cutoffs=c(.01,.025,.975,.99), pal='PuOr')
  
</code></pre>


</div>