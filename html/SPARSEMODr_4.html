<div class="container">

<table style="width: 100%;"><tr>
<td>model_parallel</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Parallelized implementation of the SPARSE-MOD models
</h2>

<h3>Description</h3>

<p>The function uses <code>R</code>-level parallelization to speed up the generation of stochastic realizations of the SPARSEMODr models and to combine output data into a read-to-use data frame. This is the preferred method to run <code>model_interface</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">  model_parallel(..., input_realz_seeds = 1:2, control)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Universal model arguments passed to <code>model_interface</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_realz_seeds</code></td>
<td>

<p>An integer vector of user-specified random seeds to generate the stochastic realizations of the model. The number of realizations will be equal to the length of this vector.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>

<p>Either a <code>covid19_control</code> or a <code>seir_control</code> named list data object.
</p>
</td>
</tr>
</table>
<h3>Details</h3>


<p>Relies on <code>future_lapply</code> to run stochastic realizations of the SPARSEMODr model in parallel.
</p>


<h3>Value</h3>

<p>A data frame that combines the two named lists of <code>model_interface</code>.
</p>


<h3>Author(s)</h3>

<p>Joseph Mihaljevic, <a href="mailto:joseph.mihaljevic@nau.edu">joseph.mihaljevic@nau.edu</a>; Toby Hocking, <a href="mailto:toby.hocking@r-project.org">toby.hocking@r-project.org</a>
</p>


<h3>See Also</h3>

<p><code>future_lapply</code>, <code>model_interface</code>, <code>time_windows</code>, <code>covid19_control</code>, <code>seir_control</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## See vignettes for more detailed work-ups.


##########################################
# Required for run:
require(lubridate)

## Using supplied example data:

# Read in the example data:
ex_dir &lt;- system.file(
  "extdata", "sparsemodr_example.Rdata", package="SPARSEMODr", mustWork=TRUE)
load(ex_dir)
n_pop &lt;- length(dat_list[["pop_N"]])

# Set up realizations:
realz_seeds &lt;- 1:2
n_realz &lt;- length(realz_seeds)

# START FUTURE PLAN FOR PARALLELIZATION
future::plan("multisession")

# Set up time windows (see time_windows for other ways to do this)
input_beta &lt;-           c(   0.3,   0.3,  0.08,  0.08,  0.15)
input_dist_phi &lt;-     c(   200,   200,    20,   150,   150)
input_m &lt;-              c( 0.002, 0.002, 0.002,  0.02,  0.02)
input_imm_frac &lt;-       c(   0.0,   0.0,   0.0,  0.02,  0.02)
# Window intervals
start_dates = c(mdy("1-1-20"),  mdy("2-1-20"),  mdy("2-16-20"), mdy("3-11-20"),  mdy("3-22-20"))
end_dates =   c(mdy("1-31-20"), mdy("2-15-20"), mdy("3-10-20"), mdy("3-21-20"), mdy("5-1-20"))


# User creates the time_windows object here
tw &lt;- time_windows(beta = input_beta,
                   dist_phi = input_dist_phi,
                   m = input_m,
                   imm_frac = input_imm_frac,
                   start_dates = start_dates,
                   end_dates = end_dates)

# Randomly generate initial conditions for
# EXPOSED class:
E_pops &lt;- vector("numeric", length = n_pop)
n_initial_E &lt;- 40
# (more exposed in larger populations)
these_E &lt;- sample.int(n_pop,
                     size = n_initial_E,
                     replace = TRUE,
                     prob = dat_list$pop_N)
for(i in 1:n_initial_E){
  E_pops[these_E[i]] &lt;- E_pops[these_E[i]] + 1
}

# Population sizes
N_pops &lt;- as.integer(dat_list[["pop_N"]])

# Set up a function to use the dat_list

get_result &lt;- function(input_realz_seeds, control = NULL){

    with(dat_list, SPARSEMODr::model_parallel(
        input_census_area = census_area,
        input_dist_mat = dist_vec,
        input_realz_seeds = input_realz_seeds,
        input_tw = tw,
        control = control)
    )
}

# User creates control list of parameters
covid19_control &lt;- covid19_control(input_N_pops = N_pops,
                                   input_E_pops = E_pops)

covid_model_output &lt;-
    get_result(
        input_realz_seeds = realz_seeds,
        control = covid19_control
    )

# Shut down parallel workers
future::plan("sequential")
</code></pre>


</div>