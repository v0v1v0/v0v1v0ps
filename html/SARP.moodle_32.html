<div class="container">

<table style="width: 100%;"><tr>
<td>legender_image.moodle</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Créer une question demandant de placer des éléments à des positions
précises d'une image
</h2>

<h3>Description</h3>

<p> Cette fonction permet de créer une question dans laquelle
le but est de placer des éléments sur une image.
</p>


<h3>Usage</h3>

<pre><code class="language-R">legender_image.moodle( texte, titre = "L\u00e9gender...",
                       f.creer_figure,
                       fichier.image,
                       zones, marques,
                       ordre.aleatoire = TRUE, afficher.erreurs = TRUE,
                       commentaire.global = NA, penalite = NA,
                       note.question = NA, idnum = NA,
                       temps,
                       fichier.xml = get( "fichier.xml",
                                           envir = SARP.Moodle.env ),
                       ... )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>texte</code></td>
<td>
<p> L'énoncé de la question (une chaîne de caractères). Cet
énoncé peut contenir n'importe quel caractère (codage en UTF-8) et
n'importe quelles balises HTML.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>titre</code></td>
<td>
<p> L'intitulé de la question, en HTML. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f.creer_figure</code></td>
<td>
<p> La fonction qui va construire l'image et les
zones sur lesquelles déposer les éléments (voyez les détails,
ci-dessous). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fichier.image</code></td>
<td>
<p> Le nom du fichier contenant l'image à
légender. Ignoré si <code>f.creer_figure</code> est fournie.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zones</code></td>
<td>
<p> Une liste décrivant les zones de la figure. Le format
est celui utilisé par f.creer_figure, voyez les détails ci-dessous;
les coordonnées doivent cependant être données directement en
pixels. Ignoré si <code>f.creer_figure</code> est fournie.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marques</code></td>
<td>
<p>Une <code>data.frame</code> décrivant les marques à placer
sur la figure. Le format est celui utilisé par f.creer_figure, voyez
les détails ci-dessous. Ignoré si <code>f.creer_figure</code> est fournie.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ordre.aleatoire</code></td>
<td>
<p>Si <code>TRUE</code>, l'ordre des marques est permuté
aléatoirement dans le fichier</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>afficher.erreurs</code></td>
<td>
<p>Si <code>TRUE</code>, en cas de réponse incorrecte à
la question, les réponses erronées sont identifiées.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>commentaire.global, penalite, note.question, idnum</code></td>
<td>
<p>Options
communes à toutes les questions Moodle, voyez
<code>debut_question.moodle</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temps</code></td>
<td>
<p> Le temps conseillé pour répondre à la question, en
minutes. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fichier.xml</code></td>
<td>
<p> Le fichier correspondant au questionnaire qui
contiendra cette question (par défaut, le dernier créé).  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p> Arguments additionnels qui seront passés à
<code>f.creer_figure</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p> Ce type de question affiche une image et, en-dessous, des
étiquettes textuelles (code HTML possible) à placer sur l'image. Le
placement de l'étiquette est défini par son coin supérieur gauche (qui
est affiché sous forme de cible quand on la déplace). Les zones où
placer les étiquettes sont invisibles et couvrent une surface libre de
l'image, qui peut être rectangulaire, circulaire ou définie à l'aide
d'un polygone.
</p>
<p><b>Utilisation de la fonction <code>f.creer_figure</code></b>
</p>
<p>Avec cette méthode, la fonction se charge de créer le fichier d'image
(au format PNG, dans le dossier temporaire de R) avant d'appeler
<code>f.creer_figure</code>. La fonction <code>f.creer_figure</code> peut alors
utiliser tous les outils graphiques basiques de R pour créer une
figure et les zones à légender sur cette figure. Elle <em>ne</em> doit
<em>pas</em> clore la figure (pas d'appel à <code>dev.off()</code> ou à
<code>graphics.off</code>.
</p>
<p>La fonction <code>f.creer_figure</code> doit renvoyer une liste de deux
éléments:
</p>

<ul>
<li>
<p> un élément nommé <code>Marques</code> qui définit les marques à
placer sur la figure;
</p>
</li>
<li>
<p> un élément nommé <code>Zones</code> qui définit les zones possibles
pour placer ces marques.
</p>
</li>
</ul>
<p>L'élément <code>Zones</code> doit être une liste qui contient autant
d'éléments que de zones à définir. Chaque élément est lui-même une
liste qui doit contenir
</p>
    
<ul>
<li>
<p> un élément nommé <code>Type</code> qui définit, sous forme d'une
chaîne de caractères, la forme géométrique de la zone. Moodle
connaît trois types de forme: rectangulaire (chaîne à utiliser:
“Rectangle”), circulaire (“Cercle”) et polygonale
(“Polygone”).
</p>
</li>
<li>
<p> un élément nommé <code>Coord</code>, qui doit être une data.frame
contenant au moins deux colonnes appelées <code>X</code> et <code>Y</code>, et
autant de lignes que de coordonnées nécessaires pour définir la
zone.  Pour une zone rectangulaire, la première ligne définit le
coin supérieur, gauche et la seconde ligne le coin inférieur
droit. Pour une zone polygonale, chaque ligne définit un sommet du
polygone (il n'est pas nécessaire de répéter les coordonnées du
premier sommet à la fin). Pour une zone circulaire, une seule ligne
est nécessaire, définissant le centre du cercle. Le rayon du cercle
doit être donné dans une troisième colonne, nommée <code>Rayon</code>. </p>
</li>
</ul>
<p>Les coordonnées doivent être données en unités “utilisateur”,
c'est-à-dire les coordonnées naturelles de l'image (celles des
échelles des axes). La conversion en pixels sera faite
automatiquement, à l'aide des fonctions <code>grconvertX</code> et
<code>grconvertY</code>.  En général, les échelles ne sont pas les
mêmes pour les deux axes, de ce fait la conversion du rayon d'un
cercle ne conduit pas à la même valeur suivant qu'il est considéré
parallèle à l'axe des abscisses ou à l'axe des ordonnées (ce qui
revient à dire qu'un cercle serait représenté par une ellipse sur la
figure).  La plus grande de ces deux valeurs est utilisée pour définir
le rayon, en pixels, de la zone à créer.  Si vous voulez contrôler
parfaitement la forme de la zone, vous devez forcer le graphe à avoir
les mêmes échelles dans les deux dimensions (option <code>asp = TRUE</code>
dans <code>plot</code>).
</p>
<p>L'élément <code>Marques</code> doit être une <code>data.frame</code> qui contient
autant de lignes que de marques à placer. Cette <code>data.frame</code> doit
avoir au moins une colonne nommée “<code>Marque</code>”, qui contient
le texte de chaque marque (tout code HTML est possible et sera mis en
forme par Moodle). Par défaut, chaque marque ne peut être utilisée
qu'une fois.  Pour préciser un nombre d'utilisation plus important, la
colonne “<code>Nombre</code>” peut être utilisée (y compris avec la
valeur <code>+Inf</code>).
</p>
<p><b>Utilisation directe</b>
</p>
<p>Il est aussi possible de préciser une image quelconque, grâce à
l'option <code>fichier.image</code>. Dans ce cas, les options <code>zones</code>
et <code>marques</code> doivent contenir, respectivement, les zones à
définir et les marques à placer, en utilisant le format ci-dessus.
Seule différence, les coordonnées des points définissant les zones (et
le rayon, pour une zone circulaire) doivent être exprimés directement
en pixels.
</p>


<h3>Value</h3>

<p>Aucune valeur n'est renvoyée par cette fonction.
</p>


<h3>Author(s)</h3>

<p>Emmanuel Curis <a href="mailto:emmanuel.curis@parisdescartes.fr">emmanuel.curis@parisdescartes.fr</a>
</p>


<h3>See Also</h3>

<p><code>glisser_deposer.moodle</code> pour une autre façon de
demander à placer des éléments sur une image;
<code>glisser_textes.moodle</code> pour faire glisser des textes dans un
texte à trou.  </p>


</div>