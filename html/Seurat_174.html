<div class="container">

<table style="width: 100%;"><tr>
<td>HarmonyIntegration</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Harmony Integration</h2>

<h3>Description</h3>

<p>Harmony Integration
</p>


<h3>Usage</h3>

<pre><code class="language-R">HarmonyIntegration(
  object,
  orig,
  features = NULL,
  scale.layer = "scale.data",
  new.reduction = "harmony",
  layers = NULL,
  npcs = 50L,
  key = "harmony_",
  theta = NULL,
  lambda = NULL,
  sigma = 0.1,
  nclust = NULL,
  tau = 0,
  block.size = 0.05,
  max.iter.harmony = 10L,
  max.iter.cluster = 20L,
  epsilon.cluster = 1e-05,
  epsilon.harmony = 1e-04,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An <code>Assay5</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>orig</code></td>
<td>
<p>A dimensional reduction to correct</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>features</code></td>
<td>
<p>Ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale.layer</code></td>
<td>
<p>Ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new.reduction</code></td>
<td>
<p>Name of new integrated dimensional reduction</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>layers</code></td>
<td>
<p>Ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npcs</code></td>
<td>
<p>If doing PCA on input matrix, number of PCs to compute</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key</code></td>
<td>
<p>Key for Harmony dimensional reduction</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>Diversity clustering penalty parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>Ridge regression penalty parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>Width of soft kmeans clusters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nclust</code></td>
<td>
<p>Number of clusters in model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>Protection against overclustering small datasets with large ones</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>block.size</code></td>
<td>
<p>What proportion of cells to update during clustering</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.iter.harmony</code></td>
<td>
<p>Maximum number of rounds to run Harmony</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.iter.cluster</code></td>
<td>
<p>Maximum number of rounds to run clustering at each round of Harmony</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon.cluster</code></td>
<td>
<p>Convergence tolerance for clustering round of Harmony</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon.harmony</code></td>
<td>
<p>Convergence tolerance for Harmony</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Whether to print progress messages. TRUE to print, FALSE to suppress</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Ignored</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>...
</p>


<h3>Note</h3>

<p>This function requires the
<a href="https://cran.r-project.org/package=harmony"><span class="pkg">harmony</span></a> package
to be installed
</p>


<h3>See Also</h3>

<p><code>harmony::HarmonyMatrix()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Preprocessing
obj &lt;- SeuratData::LoadData("pbmcsca")
obj[["RNA"]] &lt;- split(obj[["RNA"]], f = obj$Method)
obj &lt;- NormalizeData(obj)
obj &lt;- FindVariableFeatures(obj)
obj &lt;- ScaleData(obj)
obj &lt;- RunPCA(obj)

# After preprocessing, we integrate layers with added parameters specific to Harmony:
obj &lt;- IntegrateLayers(object = obj, method = HarmonyIntegration, orig.reduction = "pca",
  new.reduction = 'harmony', verbose = FALSE)

# Modifying Parameters
# We can also add arguments specific to Harmony such as theta, to give more diverse clusters
obj &lt;- IntegrateLayers(object = obj, method = HarmonyIntegration, orig.reduction = "pca",
  new.reduction = 'harmony', verbose = FALSE, theta = 3)
# Integrating SCTransformed data
obj &lt;- SCTransform(object = obj)
obj &lt;- IntegrateLayers(object = obj, method = HarmonyIntegration,
  orig.reduction = "pca", new.reduction = 'harmony',
  assay = "SCT", verbose = FALSE)

## End(Not run)


</code></pre>


</div>