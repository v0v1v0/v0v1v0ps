<div class="container">

<table style="width: 100%;"><tr>
<td>spRecover</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function for recovering regression coefficients and spatial
random effects for <code>spLM</code>, <code>spMvLM</code>,
<code>spMisalignLM</code>, <code>spSVC</code> using composition sampling
</h2>

<h3>Description</h3>

<p>Function for recovering regression coefficients and spatial random
effects for <code>spLM</code>, <code>spMvLM</code>, and
<code>spMisalignLM</code> using composition sampling.
</p>


<h3>Usage</h3>

<pre><code class="language-R">spRecover(sp.obj, get.beta=TRUE, get.w=TRUE, start=1, end, thin=1,
          verbose=TRUE, n.report=100, n.omp.threads=1, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sp.obj</code></td>
<td>
<p>an object returned by <code>spLM</code>,
<code>spMvLM</code>, <code>spMisalignLM</code>, or <code>spSVC</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>get.beta</code></td>
<td>
<p>if <code>TRUE</code>, regression coefficients will be recovered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>get.w</code></td>
<td>
<p>if <code>TRUE</code>, spatial random effects will be recovered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>specifies the first sample included in the composition sampling.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end</code></td>
<td>
<p>specifies the last sample included in the composition.
The default is to use all posterior samples in <code>sp.obj</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>a sample thinning factor.  The default of 1 considers all
samples between <code>start</code> and <code>end</code>.  For example, if <code>thin = 10</code> then 1 in 10 samples are considered between <code>start</code> and
<code>end</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>if <code>TRUE</code>, model specification and progress of the
sampler is printed to the screen. Otherwise, nothing is printed to
the screen.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.report</code></td>
<td>
<p>the interval to report sampling progress. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.omp.threads</code></td>
<td>
<p>a positive integer indicating
the number of threads to use for SMP parallel processing. The package must
be compiled for OpenMP support. For most Intel-based machines, we
recommend setting <code>n.omp.threads</code> up to the number of
hyperthreaded cores. This argument is only
implemented for <code>spSVC</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>currently no additional arguments.  </p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The input <code>sp.obj</code> with posterior samples of regression coefficients and/or spatial random effects appended. 
tags:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>p.theta.recover.samples</code></td>
<td>
<p>those <code>p.theta.samples</code> used in the composition sampling. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.beta.recover.samples</code></td>
<td>
<p>a <code>coda</code> object of regression coefficients posterior samples. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.w.recover.samples</code></td>
<td>
<p>a <code>coda</code> object of spatial random
effects posterior samples. Rows correspond to locations' random
effects and columns are posterior samples. Given <code class="reqn">q</code> responses, the <code>p.w.recover.samples</code> matrix
for <code>spMvLM</code> has <code class="reqn">qn</code> rows. The recovered
random effects for locations are held in rows
<code class="reqn">1:q, (q+1):2q, \ldots, ((n-1)q+1):qn</code> (i.e., the samples for the first location's <code class="reqn">q</code>
response variables are in rows 1:q, second location in rows <code class="reqn">(q+1):2q</code>,
etc.).
</p>
<p>For <code>spSVC</code> given the <code class="reqn">r</code> space-varying
coefficients, <code>p.w.recover.samples</code> has
<code class="reqn">rn</code> rows. The recovered
random effects for locations are held in rows
<code class="reqn">1:r, (r+1):2r, \ldots, ((n-1)r+1):rn</code> (i.e., the samples for the first location's
<code class="reqn">r</code> regression coefficients are in rows 1:r, second location in rows <code class="reqn">(r+1):2r</code>,
etc.).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.w.recover.samples.list</code></td>
<td>
<p>only returned for
<code>spSVC</code>. This provides <code>p.w.recover.samples</code> in a
different (more convenient form). Elements in this list hold
samples for each of the <code class="reqn">r</code> coefficients. List element names
indicate either the coefficient index or name specified in
<code>spSVC</code>'s <code>svc.cols</code> argument. The sample matrices
are <code class="reqn">n</code> rows and predictive samples along the columns. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.tilde.beta.recover.samples.list</code></td>
<td>
<p>only returned for
<code>spSVC</code>. Like <code>p.w.recover.samples.list</code> but with
the addition of the corresponding <code class="reqn">\beta</code> posterior
samples (i.e., <code class="reqn">\beta+w(s)</code>). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.y.samples</code></td>
<td>
<p>only returned for
<code>spSVC</code>. These posterior are the fitted values with locations on
the rows and samples on the columns. For a given sample the fitted
value for the <code class="reqn">i^{th}</code> location is <code class="reqn">N(x(s_i)\beta +
    z(s_i)w(s_i), \tau^2)</code>. </p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Andrew O. Finley <a href="mailto:finleya@msu.edu">finleya@msu.edu</a>, <br>
Sudipto Banerjee <a href="mailto:sudipto@ucla.edu">sudipto@ucla.edu</a>
</p>


<h3>References</h3>

<p>Banerjee, S., Carlin, B.P., and Gelfand, A.E. (2004). Hierarchical
modeling and analysis for spatial data. Chapman and Hall/CRC Press,
Boca Raton, FL.
</p>
<p>Finley, A.O., S. Banerjee, and A.E. Gelfand. (2015) spBayes for large
univariate and multivariate point-referenced spatio-temporal data
models. <em>Journal of Statistical Software</em>,
63:1â€“28. <a href="https://www.jstatsoft.org/article/view/v063i13">https://www.jstatsoft.org/article/view/v063i13</a>.
</p>
<p>Finley, A.O. and S. Banerjee (2019) Bayesian spatially varying
coefficient models in the spBayes R package. <a href="https://arxiv.org/abs/1903.03028">https://arxiv.org/abs/1903.03028</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
rmvn &lt;- function(n, mu=0, V = matrix(1)){
  p &lt;- length(mu)
  if(any(is.na(match(dim(V),p))))
    stop("Dimension problem!")
  D &lt;- chol(V)
  t(matrix(rnorm(n*p), ncol=p)%*%D + rep(mu,rep(n,p)))
}

set.seed(1)

n &lt;- 50
coords &lt;- cbind(runif(n,0,1), runif(n,0,1))
X &lt;- as.matrix(cbind(1, rnorm(n)))

B &lt;- as.matrix(c(1,5))
p &lt;- length(B)
sigma.sq &lt;- 10
tau.sq &lt;- 0.01
phi &lt;- 3/0.5

D &lt;- as.matrix(dist(coords))
R &lt;- exp(-phi*D)
w &lt;- rmvn(1, rep(0,n), sigma.sq*R)
y &lt;- rnorm(n, X%*%B + w, sqrt(tau.sq))

n.samples &lt;- 1000

starting &lt;- list("phi"=3/0.5, "sigma.sq"=50, "tau.sq"=1)
tuning &lt;- list("phi"=0.1, "sigma.sq"=0.1, "tau.sq"=0.1)
priors &lt;- list("beta.Flat", "phi.Unif"=c(3/1, 3/0.1),
               "sigma.sq.IG"=c(2, 5), "tau.sq.IG"=c(2, 0.01))
cov.model &lt;- "exponential"

m.1 &lt;- spLM(y~X-1, coords=coords, starting=starting, tuning=tuning,
            priors=priors, cov.model=cov.model, n.samples=n.samples)

m.1 &lt;- spRecover(m.1, start=0.5*n.samples, thin=2)

summary(window(m.1$p.beta.recover.samples))

w.hat &lt;- apply(m.1$p.w.recover.samples, 1, mean)
plot(w, w.hat, xlab="Observed w", ylab="Fitted w")

## End(Not run)
</code></pre>


</div>