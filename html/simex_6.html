<div class="container">

<table style="width: 100%;"><tr>
<td>mcsimex</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Misclassification in models using MCSIMEX</h2>

<h3>Description</h3>

<p>Implementation of the misclassification MCSIMEX algorithm as described by Küchenhoff, Mwalili and Lesaffre.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mcsimex(model, SIMEXvariable, mc.matrix, lambda = c(0.5, 1, 1.5, 2),
  B = 100, fitting.method = "quadratic",
  jackknife.estimation = "quadratic", asymptotic = TRUE)

## S3 method for class 'mcsimex'
plot(x, xlab = expression((1 + lambda)),
  ylab = colnames(b)[-1], ask = FALSE, show = rep(TRUE, NCOL(b) - 1),
  ...)

## S3 method for class 'mcsimex'
predict(object, newdata, ...)

## S3 method for class 'mcsimex'
print(x, digits = max(3, getOption("digits") - 3), ...)

## S3 method for class 'summary.mcsimex'
print(x, digits = max(3, getOption("digits") -
  3), ...)

## S3 method for class 'mcsimex'
summary(object, ...)

## S3 method for class 'mcsimex'
refit(object, fitting.method = "quadratic",
  jackknife.estimation = "quadratic", asymptotic = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>the naive model, the misclassified variable must be a factor</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SIMEXvariable</code></td>
<td>
<p>vector of names of the variables for which the MCSIMEX-method should be applied</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mc.matrix</code></td>
<td>
<p>if one variable is misclassified it can be a matrix. If more
than one variable is misclassified it must be a list of the misclassification
matrices, names must match with the SIMEXvariable names, column- and row-names
must match with the factor levels. If a special misclassification is desired,
the name of a function can be specified (see details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>vector of exponents for the misclassification matrix (without 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>number of iterations for each lambda</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitting.method</code></td>
<td>
<p><code>linear</code>, <code>quadratic</code> and <code>loglinear</code>
are implemented (first 4 letters are enough)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jackknife.estimation</code></td>
<td>
<p>specifying the extrapolation method for jackknife
variance estimation. Can be set to <code>FALSE</code> if it should not be performed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>asymptotic</code></td>
<td>
<p>logical, indicating if asymptotic variance estimation should
be done, the option <code>x = TRUE</code> must be enabled in the naive model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>object of class 'mcsimex'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>optional name for the X-Axis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>vector containing the names for the Y-Axis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ask</code></td>
<td>
<p>ogical. If <code>TRUE</code>, the user is asked for input, before a new figure is drawn</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show</code></td>
<td>
<p>vector of logicals indicating for which variables a plot should be produced</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments passed to other functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>object of class 'mcsimex'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>optionally, a data frame in which to look for variables with
which to predict. If omitted, the fitted linear predictors are used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>number of digits to be printed</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If <code>mc.matrix</code> is a function the first argument of that function must
be the whole dataset used in the naive model, the second argument must be
the exponent (lambda) for the misclassification. The function must return
a <code>data.frame</code> containing the misclassified <code>SIMEXvariable</code>. An
example can be found below.
</p>
<p>Asymptotic variance estimation is only implemented for <code>lm</code> and <code>glm</code>
</p>
<p>The loglinear fit has the form <code>g(lambda, GAMMA) = exp(gamma0 + gamma1 * lambda)</code>.
It is realized via the <code>log()</code> function. To avoid negative values the
minimum +1 of the dataset is added and after the prediction later substracted
<code>exp(predict(...)) - min(data) - 1</code>.
</p>
<p>The 'log2' fit is fitted via the <code>nls()</code> function for direct fitting of
the model <code>y ~ exp(gamma.0 + gamma.1 * lambda)</code>. As starting values the
results of a LS-fit to a linear model with a log transformed response are used.
If <code>nls</code> does not converge, the model with the starting values is returned.
</p>
<p><code>refit()</code> refits the object with a different extrapolation function.
</p>


<h3>Value</h3>

<p>An object of class 'mcsimex' which contains:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>corrected coefficients of the MCSIMEX model,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SIMEX.estimates</code></td>
<td>
<p>the MCSIMEX-estimates of the coefficients for each lambda,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>the values of lambda,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>the naive model,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mc.matrix</code></td>
<td>
<p>the misclassification matrix,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>the number of iterations,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extrapolation</code></td>
<td>
<p>the model object of the extrapolation step,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitting.method</code></td>
<td>
<p>the fitting method used in the extrapolation step,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SIMEXvariable</code></td>
<td>
<p>name of the SIMEXvariables,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the function call,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance.jackknife</code></td>
<td>
<p>the jackknife variance estimates,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extrapolation.variance</code></td>
<td>
<p>the model object of the variance extrapolation,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance.jackknife.lambda</code></td>
<td>
<p>the data set for the extrapolation,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance.asymptotic</code></td>
<td>
<p>the asymptotic variance estimates,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>all estimated coefficients for each lambda and B,</p>
</td>
</tr>
</table>
<p>...
</p>


<h3>Methods (by generic)</h3>


<ul>
<li> <p><code>plot</code>: Plots of the simulation and extrapolation
</p>
</li>
<li> <p><code>predict</code>: Predict with mcsimex correction
</p>
</li>
<li> <p><code>print</code>: Nice printing
</p>
</li>
<li> <p><code>print</code>: Print summary nicely
</p>
</li>
<li> <p><code>summary</code>: Summary for mcsimex
</p>
</li>
<li> <p><code>refit</code>: Refits the model with a different extrapolation function
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Wolfgang Lederer, <a href="mailto:wolfgang.lederer@gmail.com">wolfgang.lederer@gmail.com</a>
</p>


<h3>References</h3>

<p>Küchenhoff, H., Mwalili, S. M.  and Lesaffre, E. (2006) A general method for
dealing with misclassification in regression: The Misclassification SIMEX.
<em>Biometrics</em>, <b>62</b>, 85 – 96
</p>
<p>Küchenhoff, H., Lederer, W. and E. Lesaffre. (2006) Asymptotic Variance Estimation
for the Misclassification SIMEX.
<em>Computational Statistics and Data Analysis</em>, <b>51</b>, 6197 – 6211
</p>
<p>Lederer, W. and Küchenhoff, H. (2006) A short introduction to the SIMEX and MCSIMEX. <em>R News</em>, <b>6(4)</b>, 26–31
</p>


<h3>See Also</h3>

<p><code>misclass</code>, <code>simex</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">x &lt;- rnorm(200, 0, 1.142)
z &lt;- rnorm(200, 0, 2)
y &lt;- factor(rbinom(200, 1, (1 / (1 + exp(-1 * (-2 + 1.5 * x -0.5 * z))))))
Pi &lt;- matrix(data = c(0.9, 0.1, 0.3, 0.7), nrow = 2, byrow = FALSE)
dimnames(Pi) &lt;- list(levels(y), levels(y))
ystar &lt;- misclass(data.frame(y), list(y = Pi), k = 1)[, 1]
naive.model &lt;- glm(ystar ~ x + z, family = binomial, x = TRUE, y = TRUE)
true.model  &lt;- glm(y ~ x + z, family = binomial)
simex.model &lt;- mcsimex(naive.model, mc.matrix = Pi, SIMEXvariable = "ystar")

op &lt;- par(mfrow = c(2, 3))
invisible(lapply(simex.model$theta, boxplot, notch = TRUE, outline = FALSE,
                 names = c(0.5, 1, 1.5, 2)))
                 plot(simex.model)
simex.model2 &lt;- refit(simex.model, "line")
plot(simex.model2)
par(op)

# example using polr from the MASS package
## Not run: 
if(require(MASS)) {
  yord &lt;- cut((1 / (1 + exp(-1 * (-2 + 1.5 * x -0.5 * z)))), 3, ordered=TRUE)
  Pi3 &lt;- matrix(data = c(0.8, 0.1, 0.1, 0.2, 0.7, 0.1, 0.1, 0.2, 0.7), nrow = 3, byrow = FALSE)
  dimnames(Pi3) &lt;- list(levels(yord), levels(yord))
  ystarord &lt;- misclass(data.frame(yord), list(yord = Pi3), k = 1)[, 1]
  naive.ord.model &lt;- polr(ystarord ~ x + z, Hess = TRUE)
  simex.ord.model &lt;- mcsimex(naive.ord.model, mc.matrix = Pi3,
      SIMEXvariable = "ystarord", asymptotic=FALSE)
}

## End(Not run)

# example for a function which can be supplied to the function mcsimex()
# "ystar" is the variable which is to be misclassified
# using the example above
## Not run: 
my.misclass &lt;- function (datas, k) {
    ystar &lt;- datas$"ystar"
    p1 &lt;- matrix(data = c(0.75, 0.25, 0.25, 0.75), nrow = 2, byrow = FALSE)
    colnames(p1) &lt;- levels(ystar)
    rownames(p1) &lt;- levels(ystar)
    p0 &lt;- matrix(data = c(0.8, 0.2, 0.2, 0.8), nrow = 2, byrow = FALSE)

    colnames(p0) &lt;- levels(ystar)
    rownames(p0) &lt;- levels(ystar)
    ystar[datas$x &lt; 0] &lt;-
    misclass(data.frame(ystar = ystar[datas$x &lt; 0]), list(ystar = p1), k = k)[, 1]
    ystar[datas$x &gt; 0] &lt;-
    misclass(data.frame(ystar = ystar[datas$x &gt; 0]), list(ystar = p0), k = k)[, 1]
    ystar &lt;- factor(ystar)
    return(data.frame(ystar))}

simex.model.differential &lt;- mcsimex(naive.model, mc.matrix = "my.misclass", SIMEXvariable = "ystar")

## End(Not run)

</code></pre>


</div>