<div class="container">

<table style="width: 100%;"><tr>
<td>FixedDiscrDiscrIT</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Investigates surrogacy for binary or ordinal outcomes using the Information Theoretic framework</h2>

<h3>Description</h3>

<p>The function <code>FixedDiscrDiscrIT</code> uses the information theoretic
approach (Alonso and Molenberghs 2007) to estimate trial and individual level
surrogacy based on fixed-effects models when the surrogate is binary and the 
true outcome is ordinal, the converse case or when both outcomes are ordinal 
(the user must specify which form the data is in). The user can specify whether
a weighted or unweighted analysis is required at the trial level. The penalized
likelihood approach of Firth (1993) is applied to resolve issues of separation in discrete outcomes for particular trials. Requires packages <code>OrdinalLogisticBiplot</code> and <code>logistf</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">FixedDiscrDiscrIT(Dataset, Surr, True, Treat, Trial.ID, 
Weighted = TRUE, Setting = c("binord"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Dataset</code></td>
<td>
<p>A <code>data.frame</code> that should consist of one line per patient. Each line contains (at least) a surrogate value, a true outcome value, a treatment indicator and a trial ID.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Surr</code></td>
<td>
<p>The name of the variable in <code>Dataset</code> that contains the surrogate outcome values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>True</code></td>
<td>
<p>The name of the variable in <code>Dataset</code> that contains the true outcome values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Treat</code></td>
<td>
<p>The name of the  in <code>Dataset</code> that contains the treatment group values, 0/1 or -1/+1 are recommended.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Trial.ID</code></td>
<td>
<p>The name of the variable in <code>Dataset</code> that contains the trial ID to which the patient belongs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Weighted</code></td>
<td>
<p>Logical. In practice it is often the case that different trials (or other clustering units) have different sample sizes. Univariate models are used to assess surrogacy in the information-theoretic approach, so it can be useful to adjust for heterogeneity in information content between the trial-specific contributions (particularly when trial-level surrogacy measures are of primary interest and when the heterogeneity in sample sizes is large). If <code>Weighted=TRUE</code>, weighted regression models are fitted. If <code>Weighted=FALSE</code>, unweighted regression analyses are conducted. See the <b>Details</b> section below. Default <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Setting</code></td>
<td>
<p>Specifies whether an ordinal or binary surrogate or true outcome are present in <code>Dataset</code>. <code>Setting=c("binord")</code> for a binary surrogate and ordinal true outcome, <code>Setting=c("ordbin")</code> for an ordinal surrogate and binary true outcome and <code>Setting=c("ordord")</code> where both outcomes are ordinal.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><em>Individual level surrogacy</em>
</p>
<p>The following univariate logistic regression models are fitted when <code>Setting=c("ordbin")</code>:
</p>
<p style="text-align: center;"><code class="reqn">logit(P(T_{ij}=1))=\mu_{Ti}+\beta_{i}Z_{ij},    (1)</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(P(T_{ij}=1|S_{ij}=s))=\gamma_{0i}+\gamma_{1i}Z_{ij}+\gamma_{2i}S_{ij},    (1)</code>
</p>

<p>where: <code class="reqn">i</code> and <code class="reqn">j</code> are the trial and subject indicators; <code class="reqn">S_{ij}</code> and <code class="reqn">T_{ij}</code> are the surrogate and true outcome values of subject <code class="reqn">j</code> in trial <code class="reqn">i</code>; and <code class="reqn">Z_{ij}</code> is the treatment indicator for subject <code class="reqn">j</code> in trial <code class="reqn">i</code>; <code class="reqn">\mu_{Ti}</code> and <code class="reqn">\beta_{i}</code> are the trial-specific intercepts and treatment-effects on the true endpoint in trial <code class="reqn">i</code>; and <code class="reqn">\gamma_{0i}</code> and <code class="reqn">\gamma_{1i}</code> are the trial-specific intercepts and treatment-effects on the true endpoint in trial <code class="reqn">i</code> after accounting for the effect of the surrogate endpoint.
The <code class="reqn">-2</code> log likelihood values of the previous models in each of the <code class="reqn">i</code> trials (i.e., <code class="reqn">L_{1i}</code> and <code class="reqn">L_{2i}</code>, respectively) are subsequently used to compute individual-level surrogacy based on the  so-called Likelihood Reduction Factor (LRF; for details, see Alonso &amp; Molenberghs, 2006):
</p>
<p style="text-align: center;"><code class="reqn">R^2_{h}= 1 - \frac{1}{N} \sum_{i} exp \left(-\frac{L_{2i}-L_{1i}}{n_{i}} \right),      </code>
</p>

<p>where <code class="reqn">N</code> is the number of trials and <code class="reqn">n_{i}</code> is the number of patients within trial <code class="reqn">i</code>.
</p>
<p>At the individual level in the discrete case <code class="reqn">R^2_{h}</code> is bounded above by a number strictly less than one and is re-scaled (see Alonso &amp; Molenberghs (2007)):
</p>
<p style="text-align: center;"><code class="reqn">\widehat{R^2_{h}}= \frac{R^2_{h}}{1-e^{-2L_{0}}},</code>
</p>

<p>where <code class="reqn">L_{0}</code> is the log-likelihood of the intercept only model of the true outcome (<code class="reqn">logit(P(T_{ij}=1)=\gamma_{3}</code>).
</p>
<p>In the case of <code>Setting=c("binord")</code> or <code>Setting=c("ordord")</code> proportional odds models in (1) are used to accommodate the ordinal true response outcome, in all other respects the calculation of <code class="reqn">R^2_{h}</code> would proceed in the same manner.
</p>
<p><em>Trial-level surrogacy</em>
</p>
<p>When  <code>Setting=c("ordbin")</code> trial-level surrogacy is assessed by fitting the following univariate logistic regression and proportional odds models for the ordinal surrogate and binary true response variables regressed on treatment for each trial <code class="reqn">i</code>: 
</p>
<p style="text-align: center;"><code class="reqn">logit(P(S_{ij} \leq W))=\mu_{S_{wi}}+\alpha_{i}Z_{ij},   (2)</code>
</p>
 
<p style="text-align: center;"><code class="reqn">logit(P(T_{ij}=1))=\mu_{Ti}+\beta_{i}Z_{ij},   (2)</code>
</p>
 
<p>where: <code class="reqn">i</code> and <code class="reqn">j</code> are the trial and subject indicators; <code class="reqn">S_{ij}</code> and <code class="reqn">T_{ij}</code> are the surrogate and true outcome values of subject <code class="reqn">j</code> in trial <code class="reqn">i</code>; <code class="reqn">Z_{ij}</code> is the treatment indicator for subject <code class="reqn">j</code> in trial <code class="reqn">i</code>; <code class="reqn">\mu_{S_{wi}}</code> are the trial-specific intercept values for each cut point <code class="reqn">w</code>, where <code class="reqn">w=1,..,W-1</code>, of the ordinal surrogate outcome; <code class="reqn">\mu_{Ti}</code> are the fixed trial-specific intercepts for T; and <code class="reqn">\alpha_{i}</code> and <code class="reqn">\beta_{i}</code> are the fixed trial-specific treatment effects on S and T, respectively. The mean trial-specific intercepts for the surrogate are calculated, <code class="reqn">\overline{\mu}_{S_{wi}}</code>.The following model is subsequently fitted:
</p>
<p style="text-align: center;"><code class="reqn">\widehat{\beta}_{i}=\lambda_{0}+\lambda_{1}\widehat{\overline{\mu}}_{S_{wi}}+\lambda_{2}\widehat{\alpha}_{i}+\varepsilon_{i},   (3)</code>
</p>

<p>where the parameter estimates for <code class="reqn">\beta_i</code>, <code class="reqn">\overline{\mu}_{S_{wi}}</code>, and <code class="reqn">\alpha_i</code> are based on models (2) (see above).  When a weighted model is requested (using the argument <code>Weighted=TRUE</code> in the function call), model (2) is a weighted regression model (with weights based on the number of observations in trial <code class="reqn">i</code>). The <code class="reqn">-2</code> log likelihood value of the (weighted or unweighted) model (2) (<code class="reqn">L_1</code>) is subsequently compared to the <code class="reqn">-2</code> log likelihood value of an intercept-only model (<code class="reqn">\widehat{\beta}_{i}=\lambda_{3}</code>; <code class="reqn">L_0</code>), and <code class="reqn">R^2_{ht}</code> is computed based on the Likelihood Reduction Factor (for details, see Alonso &amp; Molenberghs, 2006):
</p>
<p style="text-align: center;"><code class="reqn">R^2_{ht}= 1 - exp \left(-\frac{L_1-L_0}{N} \right),</code>
</p>

<p>where <code class="reqn">N</code> is the number of trials. 
</p>
<p>When separation (the presence of zero cells) occurs in the cross tabs of treatment and the true or surrogate outcome for a particular trial in models (2) extreme bias can occur in <code class="reqn">R^2_{ht}</code>. Under separation there are no unique maximum likelihood for parameters <code class="reqn">\beta_i</code>, <code class="reqn">\overline{\mu}_{S_{wi}}</code> and <code class="reqn">\alpha_i</code>, in (2), for the affected trial <code class="reqn">i</code>. This typically leads to extreme bias in the estimation of these parameters and hence outlying influential points in model (3), bias in <code class="reqn">R^2_{ht}</code> inevitably follows. 
</p>
<p>To resolve the issue of separation the penalized likelihood approach of Firth (1993) is applied. This approach adds an asymptotically negligible component to the score function to allow unbiased estimation of <code class="reqn">\beta_i</code>, <code class="reqn">\overline{\mu}_{S_{wi}}</code>, and <code class="reqn">\alpha_i</code> and in turn <code class="reqn">R^2_{ht}</code>. The penalized likelihood R function <code>logitf</code> from the package of the same name is applied in the case of binary separation (Heinze and Schemper, 2002). The function <code>pordlogistf</code> from the package <code>OrdinalLogisticBioplot</code> is applied in the case of ordinal separation (Hern'andez, 2013). All instances of separation are reported.
</p>
<p>In the case of <code>Setting=c("binord")</code> or <code>Setting=c("ordord")</code> the appropriate models (either logistic regression or a proportional odds models) are fitted in (2) to accommodate the form (either binary or ordinal) of the true or surrogate response variable. The rest of the analysis would proceed in a similar manner as that described above.
</p>


<h3>Value</h3>

<p>An object of class <code>FixedDiscrDiscrIT</code> with components, 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Trial.Spec.Results</code></td>
<td>
<p>A <code>data.frame</code> that contains the trial-specific intercepts and treatment effects for the surrogate and the true endpoints. Also, the number of observations per trial; whether the trial was able to be included in the analysis for both <code class="reqn">R^2_{h}</code> and <code class="reqn">R^2_{ht}</code>; whether separation occurred and hence the penalized likelihood approach used for the surrogate or true outcome.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R2ht</code></td>
<td>
<p>A <code>data.frame</code> that contains the trial-level surrogacy estimate and its confidence interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R2h</code></td>
<td>
<p>A <code>data.frame</code> that contains the individual-level surrogacy estimate and its confidence interval.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Hannah M. Ensor &amp; Christopher J. Weir
</p>


<h3>References</h3>

<p>Alonso, A, &amp; Molenberghs, G. (2007). Surrogate marker evaluation from an information theory perspective. <em>Biometrics, 63,</em> 180-186.
</p>
<p>Alonso, A, &amp; Molenberghs, G., Geys, H., Buyse, M. &amp; Vangeneugden, T. (2006). A unifying approach for surrogate marker validation based on Prentice's criteria. <em>Statistics in medicine, 25,</em> 205-221.
</p>
<p>Firth, D. (1993). Bias reduction of maximum likelihood estimates. <em>Biometrika, 80,</em> 27-38.
</p>
<p>Heinze, G. &amp; Schemper, M. 2002. A solution to the problem of separation in logistic regression.  <em>Statistics in medicine, 21,</em> 2409-2419.
</p>
<p>Hern'andez, J. C. V.-V. O., J. L. 2013. OrdinalLogisticBiplot: Biplot representations of ordinal variables. R.
</p>


<h3>See Also</h3>

<p><code>FixedContContIT</code>, <code>plot Information-Theoretic</code>, <code>logistf</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run:  # Time consuming (&gt;5sec) code part
# Example 1
# Conduct an analysis based on a simulated dataset with 2000 patients, 100 trials,
# and Rindiv=Rtrial=.8

# Simulate the data:
Sim.Data.MTS(N.Total=2000, N.Trial=100, R.Trial.Target=.8, R.Indiv.Target=.8,
Seed=123, Model="Full")

# create a binary true and ordinal surrogate outcome
Data.Observed.MTS$True&lt;-findInterval(Data.Observed.MTS$True, 
c(quantile(Data.Observed.MTS$True,0.5)))
Data.Observed.MTS$Surr&lt;-findInterval(Data.Observed.MTS$Surr, 
c(quantile(Data.Observed.MTS$Surr,0.333),quantile(Data.Observed.MTS$Surr,0.666)))

# Assess surrogacy based on a full fixed-effect model
# in the information-theoretic framework for a binary surrogate and ordinal true outcome:
SurEval &lt;- FixedDiscrDiscrIT(Dataset=Data.Observed.MTS, Surr=Surr, True=True, Treat=Treat,
Trial.ID=Trial.ID, Setting="ordbin")

# Show a summary of the results:
summary(SurEval)
SurEval$Trial.Spec.Results
SurEval$R2h
SurEval$R2ht

## End(Not run)
</code></pre>


</div>