<div class="container">

<table style="width: 100%;"><tr>
<td>Frechet.bounds.cat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Frechet bounds of cells in a contingency table</h2>

<h3>Description</h3>

<p>This function permits to derive the bounds for cell probabilities of the table Y vs. Z starting from the marginal tables (<b>X</b> vs. Y), (<b>X</b> vs. Z) and the joint distribution of the <b>X</b> variables.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Frechet.bounds.cat(tab.x, tab.xy, tab.xz, print.f="tables", align.margins = FALSE,
                            tol= 0.001, warn = TRUE) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tab.x</code></td>
<td>

<p>A <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> table crossing the <b>X</b> variables.  This table must be obtained by using the function <code>xtabs</code> or <code>table</code>,  e.g. <br><code>tab.x &lt;- xtabs(~x1+x2+x3, data=data.all)</code>. <br>
When <code>tab.x = NULL</code> then only <code>tab.xy</code> and <code>tab.xz</code> must be supplied.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tab.xy</code></td>
<td>

<p>A <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> table of <b>X</b> vs. Y variable.  This table must be obtained by using the function <code>xtabs</code> or <code>table</code>, e.g. <br><code>table.xy &lt;- xtabs(~x1+x2+x3+y, data=data.A)</code>.
</p>
<p>A single categorical Y variable is allowed.  One or more categorical variables can be considered as <b>X</b> variables (common variables).  Obviously, the same <b>X</b> variables in <code>tab.x</code> must be available in <code>tab.xy</code>.  Usually, it is assumed that the joint distribution of the <b>X</b> variables computed from <code>tab.xy</code> is equal to <code>tab.x</code> (a warning appears if any absolute difference is greater than <code>tol</code>). Note that when marginal distribution of  <b>X</b> in <code>tab.xy</code> is not equal to that of <code>tab.x</code> it is possible to ask their alignment (see argument <code>align.margins</code>).
</p>
<p>When <code>tab.x = NULL</code> then <code>tab.xy</code> should be a one–dimensional table providing the marginal distribution of the Y variable.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tab.xz</code></td>
<td>

<p>A <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> table of <b>X</b> vs. Z variable.  This table must be obtained by using the function <code>xtabs</code> or <code>table</code>, e.g. <br><code>tab.xz &lt;- xtabs(~x1+x2+x3+z, data=data.B)</code>.
</p>
<p>A single categorical Z variable is allowed.  One or more categorical variables can be considered as <b>X</b> variables (common variables).  The same <b>X</b> variables in <code>tab.x</code> must be available in <code>tab.xz</code>.  Usually, it is assumed that the joint distribution of the <b>X</b> variables computed from <code>tab.xz</code> is equal to <code>tab.x</code> (a warning appears if any absolute difference is greater than <code>tol</code>). Note that when marginal distribution of  <b>X</b> in <code>tab.xz</code> is not equal to that of <code>tab.x</code> it is possible to ask their alignment (see argument <code>align.margins</code>).
</p>
<p>When <code>tab.x = NULL</code> then <code>tab.xz</code> should be a one–dimensional table providing the marginal distribution of the Z variable.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.f</code></td>
<td>

<p>A string: when <code>print.f="tables"</code> (default) all the cells' estimates will be saved as tables in a list.  On the contrary, if <code>print.f="data.frame"</code>, they will be saved as columns of a data.frame.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>align.margins</code></td>
<td>

<p>Logical (default <code>FALSE</code>). When when <code>TRUE</code> the distribution of <b>X</b> variables in <code>tab.xy</code> is aligned with the distribution resulting from <code>tab.x</code>, without affecting the marginal distribution of Y. Similarly, the distribution of <b>X</b> variables in <code>tab.xz</code> is aligned with the distribution resulting from <code>tab.x</code> without affecting the marginal distribution of Z. The alignment is performed by running IPF algorithm as implemented in the function <code>Estimate</code> in the package <span class="pkg">mipfp</span>. Note that to avoid lack of convergence due to combinations of Xs encountered in one table but not in the other (statistical 0s), before running IPF a small constant (1e-06) is added to empty cells in <code>tab.xy</code> and <code>tab.xz</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>

<p>Tolerance used in comparing joint distributions as far as <b>X</b> variables are considered (default <code>tol= 0.001</code>); estimation of cells bounds would require that distribution of <b>X</b> variables computed from <code>tab.xy</code> and <code>tab.xz</code> should be approximately equal to that in <code>tab.x</code>, on contrary  incoherences in estimated cells' bounds could happen. In case of not-coherent marginal distributions it is suggested to get them aligned by setting <code>align.margins=TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn</code></td>
<td>

<p>Logical, when <code>TRUE</code> (default) return warnings when marginal distributions of <b>X</b> variables show differences grater than <code>tol</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function permits to compute the expected conditional Frechet bounds for the relative frequencies in the contingency table of Y vs. Z, starting from the distributions P(Y|X), P(Z|X) and P(X).  The expected conditional bounds for the relative frequencies <code class="reqn">p_{j,k}</code> in the table Y vs. Z are:
</p>
<p style="text-align: center;"><code class="reqn">  p^{(low)}_{Y=j,Z=k} = \sum_{i}  p_{X=i}\max (0; p_{Y=j|X=i} + p_{Z=k|X=i} - 1 ) </code>
</p>

<p style="text-align: center;"><code class="reqn"> p^{(up)}_{Y=j,Z=k} = \sum_{i} p_{X=i} \min ( p_{Y=j|X=i};  p_{Z=k|X=i})</code>
</p>

<p>The relative frequencies <code class="reqn">p_{X=i}=n_i/n</code> are computed from the frequencies in <code>tab.x</code>; <br>
the relative frequencies <code class="reqn">p_{Y=j|X=i}=n_{ij}/n_{i+}</code> are derived from <code>tab.xy</code>, <br>
finally, <code class="reqn">p_{Z=k|X=i}=n_{ik}/n_{i+}</code> are derived from <code>tab.xz</code>.
</p>
<p>Estimation requires that all the starting tables share the same marginal distribution of the <b>X</b> variables. 
</p>
<p>This function returns also the unconditional bounds for the relative frequencies in the contingency table of Y vs. Z, i.e. computed also without considering the <b>X</b> variables:
</p>
<p style="text-align: center;"><code class="reqn"> \max\{0; p_{Y=j} + p_{Z=k} - 1\} \leq p_{Y=j,Z=k} \leq \min \{ p_{Y=j}; p_{Z=k}\}</code>
</p>

<p>These bounds represent the unique output when <code>tab.x = NULL</code>.
</p>
<p>Finally, the contingency table of Y vs. Z estimated under the Conditional Independence Assumption (CIA) is obtained by considering:
</p>
<p style="text-align: center;"><code class="reqn"> p_{Y=j,Z=k} = p_{Y=j|X=i} \times p_{Z=k|X=i} \times p_{X=i}.</code>
</p>

<p>When <code>tab.x = NULL</code> then it is also provided the expected table under the assumption of independence between Y and Z:
</p>
<p style="text-align: center;"><code class="reqn"> p_{Y=j,Z=k} = p_{Y=j} \times p_{Z=k}.</code>
</p>

<p>The presence of too many cells with 0s in the input contingency tables is an indication of sparseness; this is an unappealing situation when estimating the cells' relative frequencies needed to derive the bounds; in such cases the corresponding results may be unreliable. A possible alternative way of working consists in estimating the required parameters by considering a pseudo-Bayes estimator (see <code>pBayes</code>); in practice the input <code>tab.x</code>, <code>tab.xy</code> and <code>tab.xz</code> should be the ones provided by the <code>pBayes</code> function.
</p>


<h3>Value</h3>

<p>When <code>print.f="tables"</code> (default) a list with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>low.u</code></td>
<td>

<p>The estimated lower bounds for the relative frequencies in the table Y vs. Z without conditioning on the <b>X</b> variables.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>up.u</code></td>
<td>

<p>The estimated upper bounds for the relative frequencies in the table Y vs. Z without conditioning on the <b>X</b> variables.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CIA</code></td>
<td>

<p>The estimated relative frequencies in the table Y vs. Z under the Conditional Independence Assumption (CIA).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>low.cx</code></td>
<td>

<p>The estimated lower bounds for the relative frequencies in the table Y vs. Z when conditioning on the <b>X</b> variables.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>up.cx</code></td>
<td>

<p>The estimated upper bounds for the relative frequencies in the table Y vs. Z when conditioning on the <b>X</b> variables.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uncertainty</code></td>
<td>

<p>The uncertainty associated to input data, measured in terms of average width of uncertainty bounds with and without conditioning on the <b>X</b> variables.
</p>
</td>
</tr>
</table>
<p>When <code>print.f="data.frame"</code> the output list contains just two components: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>bounds</code></td>
<td>

<p>A data.frame whose columns reports the estimated uncertainty bounds.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uncertainty</code></td>
<td>

<p>The uncertainty associated to input data, measured in terms of average width of uncertainty bounds with and without conditioning on the <b>X</b> variables.
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Marcello D'Orazio <a href="mailto:mdo.statmatch@gmail.com">mdo.statmatch@gmail.com</a> 
</p>


<h3>References</h3>

<p>D'Orazio, M., Di Zio, M. and Scanu, M. (2006) “Statistical Matching for Categorical Data: Displaying Uncertainty and Using Logical Constraints”, <em>Journal of Official Statistics</em>, 22, pp. 137–157. 
</p>
<p>D'Orazio, M., Di Zio, M. and Scanu, M. (2006). <em>Statistical Matching: Theory and Practice.</em> Wiley, Chichester.
</p>


<h3>See Also</h3>

 
<p><code>Fbwidths.by.x</code>, <code>harmonize.x</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(quine, package="MASS") #loads quine from MASS
str(quine)

# split quine in two subsets
suppressWarnings(RNGversion("3.5.0"))
set.seed(7654)
lab.A &lt;- sample(nrow(quine), 70, replace=TRUE)
quine.A &lt;- quine[lab.A, 1:3]
quine.B &lt;- quine[-lab.A, 2:4]

# compute the tables required by Frechet.bounds.cat()
freq.xA &lt;- xtabs(~Sex+Age, data=quine.A)
freq.xB &lt;- xtabs(~Sex+Age, data=quine.B)

freq.xy &lt;- xtabs(~Sex+Age+Eth, data=quine.A)
freq.xz &lt;- xtabs(~Sex+Age+Lrn, data=quine.B)

# apply Frechet.bounds.cat()
bounds.yz &lt;- Frechet.bounds.cat(tab.x=freq.xA+freq.xB, tab.xy=freq.xy,
        tab.xz=freq.xz, print.f="data.frame")
bounds.yz

# harmonize distr. of Sex vs. Age during computations
# in Frechet.bounds.cat()

#compare marg. distribution of Xs in A and B vs. pooled estimate
comp.prop(p1=margin.table(freq.xy,c(1,2)), p2=freq.xA+freq.xB, 
          n1=nrow(quine.A), n2=nrow(quine.A)+nrow(quine.B), ref=TRUE)

comp.prop(p1=margin.table(freq.xz,c(1,2)), p2=freq.xA+freq.xB, 
          n1=nrow(quine.A), n2=nrow(quine.A)+nrow(quine.B), ref=TRUE)

bounds.yz &lt;- Frechet.bounds.cat(tab.x=freq.xA+freq.xB, tab.xy=freq.xy,
        tab.xz=freq.xz, print.f="data.frame", align.margins=TRUE)
bounds.yz

</code></pre>


</div>