<div class="container">

<table style="width: 100%;"><tr>
<td>senmCI</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Sensitivity Analysis for a Confidence Interval.
</h2>

<h3>Description</h3>

<p>Each matched set contains one treated
individual and one or more controls.
Uses Huber's M-statistic as the basis for
a confidence interval for an additive constant treatment effect,
<code class="reqn">\tau</code>.  Produces either a randomization
based confidence interval or an analysis of sensitivity to
departures from random assignment.  Also produces a point estimate
for randomization inference or an interval of point estimates
for a sensitivity analysis.  For tests, use function senm().
The method is described in Rosenbaum (2007,2013).
</p>


<h3>Usage</h3>

<pre><code class="language-R">senmCI(y, z, mset, gamma=1, inner=0, trim=3, lambda=1/2,
                  alpha=0.05, twosided=TRUE, upper=TRUE, TonT=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p> A vector of responses with no missing data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p> Treatment indicators, z=1 for treated, z=0 for control with
length(z)==length(y).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mset</code></td>
<td>
<p> Matched set indicators, 1, 2, ..., sum(z) with
length(mset)==length(y).  Matched set indicators should be either integers or a factor.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>

<p>gamma is the sensitivity parameter <code class="reqn">\Gamma</code>, where <code class="reqn">\Gamma \ge 1</code>.  Setting
<code class="reqn">\Gamma = 1</code> is equivalent to assuming ignorable treatment assignment given
the matched sets, and it returns a randomization-based confidence interval.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inner</code></td>
<td>

<p>inner and trim together define the <code class="reqn">\psi</code>-function for the M-statistic.
The default values yield a version of Huber's <code class="reqn">\psi</code>-function, while
setting inner = 0 and trim = Inf uses the mean within each matched set.
The <code class="reqn">\psi</code>-function is an odd function, so <code class="reqn">\psi(w) = -\psi(-w)</code>.  For
<code class="reqn">w \ge 0</code>, the <code class="reqn">\psi</code>-function is <code class="reqn">\psi(w)=0</code> for <code class="reqn">0 \le w \le </code> inner,
is <code class="reqn">\psi(w)= </code> trim for <code class="reqn">w \ge </code> trim, and rises linearly from 0 to trim
for inner &lt; w &lt; trim.
</p>
<p>An error will result unless <code class="reqn">0 \le </code> inner <code class="reqn"> \le </code> trim.
</p>
<p>Taking trim &lt; Inf limits the influence of outliers; see Huber (1981).
Taking inner &gt; 0 often increases design sensitivity; see Rosenbaum (2013).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trim</code></td>
<td>

<p>inner and trim together define the <code class="reqn">\psi</code>-function for the M-statistic.
See inner.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>

<p>Before applying the <code class="reqn">\psi</code>-function to treated-minus-control differences,
the differences are scaled by dividing by the lambda quantile of all
within set absolute differences.  Typically, lambda = 1/2 for the median.
The value of lambda has no effect if trim=Inf and inner=0.  See Maritz (1979)
for the paired case and Rosenbaum (2007) for matched sets.
</p>
<p>An error will result unless 0 &lt; lambda &lt; 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>

<p>The coverage rate of the confidence interval is 1-alpha. If the bias in
treatment assignment is at most <code class="reqn">\Gamma</code>, then the confidence interval
will cover the true <code class="reqn">\tau</code> with probability at least <code class="reqn">1-\alpha</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>twosided</code></td>
<td>

<p>If twosided==TRUE, then a two-sided <code class="reqn">1-\alpha</code> confidence interval is
constructed.  If twosided==FALSE, then a one-sided <code class="reqn">1-\alpha</code>
confidence interval is constructed.  The two sided interval is the
intersection of two one-sided <code class="reqn">1-\alpha/2</code> intervals.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper</code></td>
<td>

<p>If twosided==TRUE, then upper is ignored. If twosided==FALSE and
upper=TRUE, then an upper <code class="reqn">1-\alpha</code> confidence interval
is constructed.  If twosided==FALSE and upper=FALSE, then
a lower <code class="reqn">1-\alpha</code> confidence interval is constructed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TonT</code></td>
<td>

<p>TonT refers to the effect of the treatment on the treated; see Rosenbaum and Rubin (1985, equation 1.1.1)  The default is TonT=FALSE.  If TonT=FALSE, then the total score in matched set i is divided by the number ni of individuals in set i, as in expression (8) in Rosenbaum (2007).  This division by ni has few consequences when every matched set has the same number of individuals, but when set sizes vary, dividing by ni is intended to increase efficiency by weighting inversely as the variance; see the discussion in section 4.2 of Rosenbaum (2007).  If TonT=TRUE, then the division is by ni-1, not by ni, and there is a further division by the total number of matched sets to make it a type of mean.  If TonT=TRUE and trim=Inf, then the statistic is the mean over matched sets of the treated minus mean-control response, so it is weighted to estimate the average effect of the treatment on the treated.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For the given <code class="reqn">\Gamma</code>, senmCI() inverts the test in the function
senm() to produce the confidence interval.  That is, it tests every
<code class="reqn">\tau</code> and retains the values not rejected at level <code class="reqn">\alpha</code>.
</p>
<p>The test is a large sample approximation
based on a Normal approximation to the null distribution;
see Rosenbaum (2007).
</p>
<p>If TonT=FALSE, matched sets of unequal size are weighted using weights that would
be efficient in a randomization test under a simple model with
additive set and treatment effects and errors with constant variance;
see Rosenbaum (2007).
</p>
<p>The upper bound on the P-value is based on the separable approximation
described in Gastwirth, Krieger and Rosenbaum (2000); see also
Rosenbaum (2007).
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>PointEstimates </code></td>
<td>
<p>The interval of point estimates of <code class="reqn">\tau</code>.
If gamma=1, then the interval is a single point estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ConfidenceInterval </code></td>
<td>
<p>The confidence interval for <code class="reqn">\tau</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>description </code></td>
<td>
<p>Reminder of the coverage rate, gamma, and
type of interval.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>In a sensitivity analysis, a one-sided confidence interval is
not conservative; however, two-sided intervals formed
as the intersection of two one-sided <code class="reqn">1-\alpha/2</code>
intervals are somewhat conservative.  See the
discussion of two-sided tests in the documentation
for senm().
</p>


<h3>Author(s)</h3>

<p>Paul R. Rosenbaum.
</p>


<h3>References</h3>

<p>Huber, P. (1981) Robust Statistics.  New York: John Wiley.
(M-estimates based on M-statistics.)
</p>
<p>Maritz, J. S. (1979). A note on exact robust confidence
intervals for location. Biometrika 66 163â€“166. (Introduces
exact permutation tests based on M-statistics by redefining
the scaling parameter.)
</p>
<p>Rosenbaum, P. R. (1993). Hodges-Lehmann point estimates of
treatment effect in observational studies.
Journal of the American Statistical Association, 88, 1250-1253.
(Introduces sensitivity analysis for point estimates.)
</p>
<p>Rosenbaum, P. R. (2007). Sensitivity analysis for m-estimates, tests
and confidence intervals in matched observational studies.
Biometrics 63 456-64. (R package sensitivitymv) &lt;doi:10.1111/j.1541-0420.2006.00717.x&gt;
</p>
<p>Rosenbaum, P. R. (2013). Impact of multiple matched controls on
design sensitivity in observational studies. Biometrics 69 118-127.
(Introduces inner trimming.) &lt;doi:10.1111/j.1541-0420.2012.01821.x&gt;
</p>
<p>Rosenbaum, P. R. (2015).  Two R packages for sensitivity analysis
in observational studies.  Observational Studies, v. 1. (Free on-line.)
</p>
<p>Rosenbaum, P. R. (2016) Using Scheffe projections for multiple outcomes
in an observational study of smoking and periondontal disease.  Annals of
Applied Statistics, 10, 1447-1471. DOI: 10.1214/16-AOAS942.
</p>
<p>Rosenbaum, P. R., &amp; Rubin, D. B. (1985). The bias due to incomplete
matching. Biometrics, 41, 103-116.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(teeth)
attach(teeth)
#
# Note: Computing confidence intervals takes a few moments
# The calls to senmCI() are commented to meet time requirements
# for cran examples.  Remove the comment symbol to run them.
#
# The calculations that follow reproduce the intervals from
# section 5.1 of Rosenbaum (2016, p. 1466)
# senmCI(either4low,smoker,mset,trim=2.5,gamma=1.5)
# senmCI(either4up,smoker,mset,trim=2.5,gamma=1.5)
# Confidence interval using the mean by inverting the
# permuational t-test.
# senmCI(either4low,smoker,mset,trim=Inf,TonT=TRUE)
dif&lt;-either4low[smoker==1]-either4low[smoker==0] # Matched pair differences
mean(dif) # Equals the point estimate above
t.test(dif) # But permutational t-interval and t-interval differ
# Sensitivity analysis using the mean difference
# senmCI(either4low,smoker,mset,gamma=1.5,trim=Inf,TonT=TRUE)
detach(teeth)
</code></pre>


</div>