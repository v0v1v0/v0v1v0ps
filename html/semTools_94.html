<div class="container">

<table style="width: 100%;"><tr>
<td>plausibleValues</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plausible-Values Imputation of Factor Scores Estimated from a lavaan Model</h2>

<h3>Description</h3>

<p>Draw plausible values of factor scores estimated from a fitted
<code>lavaan</code> model, then treat them as multiple imputations
of missing data using <code>runMI</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plausibleValues(object, nDraws = 20L, seed = 12345,
  omit.imps = c("no.conv", "no.se"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>A fitted model of class <code>lavaan</code>,
<code>blavaan</code>, or <code>lavaan.mi</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nDraws</code></td>
<td>
<p><code>integer</code> specifying the number of draws, analogous to
the number of imputed data sets. If <code>object</code> is of class
<code>lavaan.mi</code>, this will be the number of draws taken
<em>per imputation</em>.  If <code>object</code> is of class
<code>blavaan</code>, <code>nDraws</code> cannot exceed
<code>blavInspect(object, "niter") * blavInspect(bfitc, "n.chains")</code>
(number of MCMC samples from the posterior). The drawn samples will be
evenly spaced (after permutation for <code>target="stan"</code>), using
<code>ceiling</code> to resolve decimals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p><code>integer</code> passed to <code>set.seed()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omit.imps</code></td>
<td>
<p><code>character</code> vector specifying criteria for omitting
imputations when <code>object</code> is of class <code>lavaan.mi</code>.
Can include any of <code>c("no.conv", "no.se", "no.npd")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Optional arguments to pass to <code>lavPredict</code>.
<code>assemble</code> will be ignored because multiple groups are always
assembled into a single <code>data.frame</code> per draw. <code>type</code> will be
ignored because it is set internally to <code>type="lv"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Because latent variables are unobserved, they can be considered as missing
data, which can be imputed using Monte Carlo methods.  This may be of
interest to researchers with sample sizes too small to fit their complex
structural models.  Fitting a factor model as a first step,
<code>lavPredict</code> provides factor-score estimates, which can
be treated as observed values in a path analysis (Step 2).  However, the
resulting standard errors and test statistics could not be trusted because
the Step-2 analysis would not take into account the uncertainty about the
estimated factor scores.  Using the asymptotic sampling covariance matrix
of the factor scores provided by <code>lavPredict</code>,
<code>plausibleValues</code> draws a set of <code>nDraws</code> imputations from the
sampling distribution of each factor score, returning a list of data sets
that can be treated like multiple imputations of incomplete data.  If the
data were already imputed to handle missing data, <code>plausibleValues</code>
also accepts an object of class <code>lavaan.mi</code>, and will
draw <code>nDraws</code> plausible values from each imputation.  Step 2 would
then take into account uncertainty about both missing values and factor
scores.  Bayesian methods can also be used to generate factor scores, as
available with the <span class="pkg">blavaan</span> package, in which case plausible
values are simply saved parameters from the posterior distribution. See
Asparouhov and Muthen (2010) for further technical details and references.
</p>
<p>Each returned <code>data.frame</code> includes a <code>case.idx</code> column that
indicates the corresponding rows in the data set to which the model was
originally fitted (unless the user requests only Level-2 variables).  This
can be used to merge the plausible values with the original observed data,
but users should note that including any new variables in a Step-2 model
might not accurately account for their relationship(s) with factor scores
because they were not accounted for in the Step-1 model from which factor
scores were estimated.
</p>
<p>If <code>object</code> is a multilevel <code>lavaan</code> model, users can request
plausible values for latent variables at particular levels of analysis by
setting the <code>lavPredict</code> argument <code>level=1</code> or
<code>level=2</code>.  If the <code>level</code> argument is not passed via ...,
then both levels are returned in a single merged data set per draw.  For
multilevel models, each returned <code>data.frame</code> also includes a column
indicating to which cluster each row belongs (unless the user requests only
Level-2 variables).
</p>


<h3>Value</h3>

<p>A <code>list</code> of length <code>nDraws</code>, each of which is a
<code>data.frame</code> containing plausible values, which can be treated as
a <code>list</code> of imputed data sets to be passed to <code>runMI</code>
(see <b>Examples</b>). If <code>object</code> is of class
<code>lavaan.mi</code>, the <code>list</code> will be of length
<code>nDraws*m</code>, where <code>m</code> is the number of imputations.
</p>


<h3>Author(s)</h3>

<p>Terrence D. Jorgensen (University of Amsterdam;
<a href="mailto:TJorgensen314@gmail.com">TJorgensen314@gmail.com</a>)
</p>


<h3>References</h3>

<p>Asparouhov, T. &amp; Muthen, B. O. (2010). <em>Plausible values for latent
variables using M</em>plus. Technical Report. Retrieved from
www.statmodel.com/download/Plausible.pdf
</p>


<h3>See Also</h3>

<p><code>runMI</code>, <code>lavaan.mi</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## example from ?cfa and ?lavPredict help pages
HS.model &lt;- ' visual  =~ x1 + x2 + x3
              textual =~ x4 + x5 + x6
              speed   =~ x7 + x8 + x9 '

fit1 &lt;- cfa(HS.model, data = HolzingerSwineford1939)
fs1 &lt;- plausibleValues(fit1, nDraws = 3,
                       ## lavPredict() can add only the modeled data
                       append.data = TRUE)
lapply(fs1, head)

## To merge factor scores to original data.frame (not just modeled data)
fs1 &lt;- plausibleValues(fit1, nDraws = 3)
idx &lt;- lavInspect(fit1, "case.idx")      # row index for each case
if (is.list(idx)) idx &lt;- do.call(c, idx) # for multigroup models
data(HolzingerSwineford1939)             # copy data to workspace
HolzingerSwineford1939$case.idx &lt;- idx   # add row index as variable
## loop over draws to merge original data with factor scores
for (i in seq_along(fs1)) {
  fs1[[i]] &lt;- merge(fs1[[i]], HolzingerSwineford1939, by = "case.idx")
}
lapply(fs1, head)


## multiple-group analysis, in 2 steps
step1 &lt;- cfa(HS.model, data = HolzingerSwineford1939, group = "school",
            group.equal = c("loadings","intercepts"))
PV.list &lt;- plausibleValues(step1)

## subsequent path analysis
path.model &lt;- ' visual ~ c(t1, t2)*textual + c(s1, s2)*speed '
## Not run: 
step2 &lt;- sem.mi(path.model, data = PV.list, group = "school")
## test equivalence of both slopes across groups
lavTestWald.mi(step2, constraints = 't1 == t2 ; s1 == s2')

## End(Not run)


## multilevel example from ?Demo.twolevel help page
model &lt;- '
  level: 1
    fw =~ y1 + y2 + y3
    fw ~ x1 + x2 + x3
  level: 2
    fb =~ y1 + y2 + y3
    fb ~ w1 + w2
'
msem &lt;- sem(model, data = Demo.twolevel, cluster = "cluster")
mlPVs &lt;- plausibleValues(msem, nDraws = 3) # both levels by default
lapply(mlPVs, head, n = 10)
## only Level 1
mlPV1 &lt;- plausibleValues(msem, nDraws = 3, level = 1)
lapply(mlPV1, head)
## only Level 2
mlPV2 &lt;- plausibleValues(msem, nDraws = 3, level = 2)
lapply(mlPV2, head)



## example with 10 multiple imputations of missing data:

## Not run: 
HSMiss &lt;- HolzingerSwineford1939[ , c(paste("x", 1:9, sep = ""),
                                      "ageyr","agemo","school")]
set.seed(12345)
HSMiss$x5 &lt;- ifelse(HSMiss$x5 &lt;= quantile(HSMiss$x5, .3), NA, HSMiss$x5)
age &lt;- HSMiss$ageyr + HSMiss$agemo/12
HSMiss$x9 &lt;- ifelse(age &lt;= quantile(age, .3), NA, HSMiss$x9)
## impute data
library(Amelia)
set.seed(12345)
HS.amelia &lt;- amelia(HSMiss, m = 10, noms = "school", p2s = FALSE)
imps &lt;- HS.amelia$imputations
## specify CFA model from lavaan's ?cfa help page
HS.model &lt;- '
  visual  =~ x1 + x2 + x3
  textual =~ x4 + x5 + x6
  speed   =~ x7 + x8 + x9
'
out2 &lt;- cfa.mi(HS.model, data = imps)
PVs &lt;- plausibleValues(out2, nDraws = nPVs)

idx &lt;- out2@Data@case.idx # can't use lavInspect() on lavaan.mi
## empty list to hold expanded imputations
impPVs &lt;- list()
nPVs &lt;- 5
nImps &lt;- 10
for (m in 1:nImps) {
  imps[[m]]["case.idx"] &lt;- idx
  for (i in 1:nPVs) {
    impPVs[[ nPVs*(m - 1) + i ]] &lt;- merge(imps[[m]],
                                          PVs[[ nPVs*(m - 1) + i ]],
                                          by = "case.idx")
  }
}
lapply(impPVs, head)


## End(Not run)

</code></pre>


</div>