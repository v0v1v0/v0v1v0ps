<div class="container">

<table style="width: 100%;"><tr>
<td>simaerep</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create simaerep object</h2>

<h3>Description</h3>

<p>Simulate AE under-reporting probabilities.
</p>


<h3>Usage</h3>

<pre><code class="language-R">simaerep(
  df_visit,
  r = 1000,
  check = TRUE,
  under_only = TRUE,
  visit_med75 = TRUE,
  inframe = FALSE,
  progress = TRUE,
  mult_corr = TRUE,
  param_site_aggr = list(method = "med75_adj", min_pat_pool = 0.2),
  param_sim_sites = list(r = 1000, poisson_test = FALSE, prob_lower = TRUE),
  param_eval_sites = list(method = "BH"),
  env = parent.frame()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df_visit</code></td>
<td>
<p>Data frame with columns: study_id, site_number, patnum, visit,
n_ae.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>Integer or tbl_object, number of repetitions for bootstrap
simulation. Pass a tbl object referring to a table with one column and as
many rows as desired repetitions. Default: 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>
<p>Logical, perform data check and attempt repair with
<code>check_df_visit()</code>. Computationally expensive on large data sets. Default:
TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>under_only</code></td>
<td>
<p>Logical, compute under-reporting probabilities only.
Supersedes under_only parameter passed to <code>eval_sites()</code> and <code>sim_sites()</code>.
Default: TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>visit_med75</code></td>
<td>
<p>Logical, should evaluation point visit_med75 be used.
Default: TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inframe</code></td>
<td>
<p>Logical, only table operations to be used; does not require
visit_med75. Compatible with dbplyr supported database backends.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>Logical, display progress bar. Default: TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mult_corr</code></td>
<td>
<p>Logical, multiplicity correction, Default: TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param_site_aggr</code></td>
<td>
<p>List of parameters passed to <code>site_aggr()</code>. Default:
list(method = "med75_adj", min_pat_pool = 0.2).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param_sim_sites</code></td>
<td>
<p>List of parameters passed to <code>sim_sites()</code>. Default:
list(r = 1000, poisson_test = FALSE, prob_lower = TRUE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param_eval_sites</code></td>
<td>
<p>List of parameters passed to <code>eval_sites()</code>. Default:
list(method = "BH").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>Optional, provide environment of original visit data. Default:
parent.frame().</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Executes <code>site_aggr()</code>, <code>sim_sites()</code>, and <code>eval_sites()</code> on original
visit data and stores all intermediate results. Stores lazy reference to
original visit data for facilitated plotting using generic plot(x).
</p>


<h3>Value</h3>

<p>A simaerep object.
</p>


<h3>See Also</h3>

<p><code>site_aggr()</code>, <code>sim_sites()</code>, <code>eval_sites()</code>, <code>orivisit()</code>,
<code>plot.simaerep()</code>
</p>
<p>site_aggr(), sim_sites(),
eval_sites(), orivisit(),
plot.simaerep()
</p>


<h3>Examples</h3>

<pre><code class="language-R">df_visit &lt;- sim_test_data_study(
  n_pat = 100,
  n_sites = 5,
  frac_site_with_ur = 0.4,
  ur_rate = 0.6
)
df_visit$study_id &lt;- "A"
aerep &lt;- simaerep(df_visit)
aerep
str(aerep)

  # In-frame table operations
  simaerep(df_visit, inframe = TRUE, visit_med75 = FALSE, under_only = FALSE)$df_eval
  simaerep(df_visit, inframe = TRUE, visit_med75 = TRUE, under_only = FALSE)$df_eval
  # Database example
  con &lt;- DBI::dbConnect(duckdb::duckdb(), dbdir = ":memory:")
  df_r &lt;- tibble::tibble(rep = seq(1, 1000))
  dplyr::copy_to(con, df_visit, "visit")
  dplyr::copy_to(con, df_r, "r")
  tbl_visit &lt;- dplyr::tbl(con, "visit")
  tbl_r &lt;- dplyr::tbl(con, "r")
  simaerep(tbl_visit, r = tbl_r, inframe = TRUE, visit_med75 = FALSE, under_only = FALSE)$df_eval
  simaerep(tbl_visit, r = tbl_r, inframe = TRUE, visit_med75 = TRUE, under_only = FALSE)$df_eval
  DBI::dbDisconnect(con)

</code></pre>


</div>