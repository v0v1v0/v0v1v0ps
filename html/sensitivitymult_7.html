<div class="container">

<table style="width: 100%;"><tr>
<td>senm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Sensitivity Analysis for a Matched Comparison in an Observational Study.
</h2>

<h3>Description</h3>

<p>Each matched set contains one treated
individual and one or more controls.
Uses Huber's M-statistic as the basis for
the test, for instance, a mean.  Performs either a randomization
test or an analysis of sensitivity to departures from random
assignment.  For confidence intervals, use function senmCI().
The method is described in Rosenbaum (2007,2013).
The senm() function is intended as a convenience for a user
of the comparison() function in the sensitivitymult package.
The function senm() in the sensitivitymult package is essentially
the same as senmv() in the sensitivitymv package, except the
format of the input to senm() resembles the format of the
input to comparison().  In particular, in the sensitivitymv
package, the rows of y are matched sets, not people, whereas
in sensitivitymult the rows of y are people with treated
and control people identified by z and matched sets
identified by mset.
</p>


<h3>Usage</h3>

<pre><code class="language-R">senm(y, z, mset, gamma = 1, inner = 0, trim = 3, lambda = 1/2,
              tau = 0, alternative="greater", TonT = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p> A vector of responses with no missing data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p> Treatment indicator, z=1 for treated, z=0 for control with
length(z)==length(y).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mset</code></td>
<td>
<p> Matched set indicator, 1, 2, ..., sum(z) with
length(mset)==length(y).  Matched set indicators should be either integers or a factor.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>

<p>gamma is the sensitivity parameter <code class="reqn">\Gamma</code>, where <code class="reqn">\Gamma \ge 1</code>.  Setting
<code class="reqn">\Gamma = 1</code> is equivalent to assuming ignorable treatment assignment given
the matched sets, and it performs a within-set randomization test.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inner</code></td>
<td>

<p>inner and trim together define the <code class="reqn">\psi</code>-function for the M-statistic.
The default values yield a version of Huber's <code class="reqn">\psi</code>-function, while
setting inner = 0 and trim = Inf uses the mean within each matched set.
The <code class="reqn">\psi</code>-function is an odd function, so <code class="reqn">\psi(w) = -\psi(-w)</code>.  For
<code class="reqn">w \ge 0</code>, the <code class="reqn">\psi</code>-function is <code class="reqn">\psi(w)=0</code> for <code class="reqn">0 \le w \le </code> inner,
is <code class="reqn">\psi(w)= </code> trim for <code class="reqn">w \ge </code> trim, and rises linearly from 0 to trim
for inner &lt; w &lt; trim.
</p>
<p>An error will result unless <code class="reqn">0 \le </code> inner <code class="reqn"> \le </code> trim.
</p>
<p>Taking trim &lt; Inf limits the influence of outliers; see Huber (1981).
Taking trim &lt; Inf and inner = 0 uses Huber's psi function.
Taking trim = Inf does no trimming and is similar to a weighted mean; see TonT.
Taking inner &gt; 0 often increases design sensitivity; see Rosenbaum (2013).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trim</code></td>
<td>

<p>inner and trim together define the <code class="reqn">\psi</code>-function for the M-statistic.
See inner.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>

<p>Before applying the <code class="reqn">\psi</code>-function to treated-minus-control differences,
the differences are scaled by dividing by the lambda quantile of all
within set absolute differences.  Typically, lambda = 1/2 for the median.
The value of lambda has no effect if trim=Inf and inner=0.  See Maritz (1979)
for the paired case and Rosenbaum (2007) for matched sets.
</p>
<p>An error will result unless 0 &lt; lambda &lt; 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>

<p>The null hypothesis asserts that the treatment has an additive effect, tau.
By default, tau=0, so by default the null hypothesis is Fisher's sharp null
hypothesis of no treatment effect.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>

<p>If alternative="greater", the null hypothesis of a treatment effect of tau
is tested against the alternative of a treatment effect larger than tau.  If
alternative="less", the null hypothesis of a treatment effect of tau
is tested against the alternative of a treatment effect smaller than tau.
In particular, alternative="less" is equivalent to: (i) alternative="greater",
(ii) y replaced by -y, and (iii) tau replaced by -tau.  See the note for
discussion of two-sided sensitivity analyses.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TonT</code></td>
<td>

<p>TonT refers to the effect of the treatment on the treated; see Rosenbaum and Rubin (1985, equation 1.1.1)  The default is TonT=FALSE.  If TonT=FALSE, then the total score in matched set i is divided by the number ni of individuals in set i, as in expression (8) in Rosenbaum (2007).  This division by ni has few consequences when every matched set has the same number of individuals, but when set sizes vary, dividing by ni is intended to increase efficiency by weighting inversely as the variance; see the discussion in section
4.2 of Rosenbaum (2007).  If TonT=TRUE, then the division is by ni-1, not by ni, and there is a further division by the total number of matched sets to make it a type of mean.  If TonT=TRUE and trim=Inf, then the statistic is the mean over matched sets of the treated minus mean-control response, so it is weighted to estimate the average effect of the treatment on the treated.  See the examples.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For the given <code class="reqn">\Gamma</code>, senm() computes the upper bound on the 1-sided
P-value testing the null hypothesis
of an additive treatment effect tau against the alternative hypothesis of
a treatment effect larger than tau.  By default, senm() tests the null hypothesis of
no treatment effect against the alternative of a positive treatment effect.
The P-value is an approximate P-value
based on a Normal approximation to the null distribution; see Rosenbaum (2007).
</p>
<p>Matched sets of unequal size are weighted using weights that would
be efficient in a randomization test under a simple model with
additive set and treatment effects and errors with constant variance;
see Rosenbaum (2007).
</p>
<p>The upper bound on the P-value is based on the separable approximation
described in Gastwirth, Krieger and Rosenbaum (2000); see also
Rosenbaum (2007).
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pval </code></td>
<td>
<p>The upper bound on the 1-sided P-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviate </code></td>
<td>
<p>The deviate that was compared to the Normal
distribution to produce pval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic </code></td>
<td>
<p>The value of the M-statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expectation </code></td>
<td>
<p>The maximum expectation of the
M-statistic for the given <code class="reqn">\Gamma</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance </code></td>
<td>
<p>The maximum variance of the
M-statistic among treatment assignments
that achieve the maximum expectation.
Part of the separable approximation.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The function senm() performs 1-sided tests.  One approach
to a 2-sided, <code class="reqn">\alpha</code>-level test does both 1-sided tests
at level <code class="reqn">\alpha/2</code>, and rejects the null hypothesis if either
1-sided
test rejects.  Equivalently, a bound on the two sided
P-value is the smaller of 1 and twice the smaller of the two 1-sided
P-values.  This approach views a 2-sided test as two 1-sided tests
with a Bonferroni correction; see Cox (1977, Section 4.2).  In all
cases, this approach is a valid large sample test: a true
null hypothesis is falsely
rejected with probability at most <code class="reqn">\alpha</code> if the bias in
treatment assignment is at most <code class="reqn">\Gamma</code>; so, this procedure
is entirely safe to use.  For a randomization test, <code class="reqn">\Gamma=1</code>, this
Bonferroni procedure is not typically conservative. For large <code class="reqn">\Gamma</code>,
this Bonferroni procedure tends to be somewhat conservative.
</p>
<p>Related packages are sensitivitymv, sensitivitymw, sensitivityfull
and sensitivity2x2xk.
</p>


<h3>Author(s)</h3>

<p>Paul R. Rosenbaum.
</p>


<h3>References</h3>

<p>Cox, D. R. (1977).  The role of signficance tests (with Discussion).
Scand. J. Statist. 4, 49-70.
</p>
<p>Huber, P. (1981) Robust Statistics.  New York: John Wiley.
(M-estimates based on M-statistics.)
</p>
<p>Maritz, J. S. (1979). A note on exact robust confidence
intervals for location. Biometrika 66 163â€“166. (Introduces
exact permutation tests based on M-statistics by redefining
the scaling parameter.)
</p>
<p>Rosenbaum, P. R. (2007). Sensitivity analysis for m-estimates, tests
and confidence intervals in matched observational studies.
Biometrics 63 456-64. (R package sensitivitymv) &lt;doi:10.1111/j.1541-0420.2006.00717.x&gt;
</p>
<p>Rosenbaum, P. R. (2013). Impact of multiple matched controls on
design sensitivity in observational studies. Biometrics 69 118-127.
(Introduces inner trimming.) &lt;doi:10.1111/j.1541-0420.2012.01821.x&gt;
</p>
<p>Rosenbaum, P. R. (2014). Weighted M-statistics with superior design
sensitivity in matched observational studies with multiple controls.
J. Am. Statist. Assoc. 109 1145-1158. (R package sensitivitymw)
&lt;doi:10.1080/01621459.2013.879261&gt;
</p>
<p>Rosenbaum, P. R. (2015).  Two R packages for sensitivity analysis
in observational studies.  Observational Studies, v. 1. (Free on-line.)
</p>
<p>Rosenbaum, P. R. (2016) Using Scheffe projections for multiple outcomes
in an observational study of smoking and periondontal disease.  Annals of
Applied Statistics, 10, 1447-1471. &lt;doi:10.1214/16-AOAS942&gt;
</p>
<p>Rosenbaum, P. R., &amp; Rubin, D. B. (1985). The bias due to incomplete
matching. Biometrics, 41, 103-116.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(teeth)
attach(teeth)
# The following example reproduces the deviate for lower teeth
# mentioned on line 4 of Rosenbaum (2016, p. 1466).
senm(either4low,smoker,mset,trim=2.5,gamma=2.2)
# The calculation above is equivalent to using comparison()
# with weights w=c(0,1) so upper teeth are ignored.
comparison(cbind(either4up,either4low),smoker,mset,c(0,1),trim=2.5,gamma=2.2)
# The following example illustrates the permutational t-test
# which uses the mean of the pair differences as a test statistic.
senm(either4low,smoker,mset,trim=Inf,TonT=TRUE)
dif&lt;-either4low[smoker==1]-either4low[smoker==0] # Matched pair differences
mean(dif) # Equals the test statistic above
detach(teeth)
</code></pre>


</div>