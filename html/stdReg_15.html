<div class="container">

<table style="width: 100%;"><tr>
<td>stdCoxph</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Regression standardization in Cox proportional hazards models
</h2>

<h3>Description</h3>

<p><code>stdCoxph</code> performs regression standardization in Cox proportional hazards models,
at specified values of the exposure, over the sample covariate distribution.
Let <code class="reqn">T</code>, <code class="reqn">X</code>, and <code class="reqn">Z</code> be the survival outcome, the exposure, and a
vector of covariates, respectively. <code>stdCoxph</code> uses a fitted Cox 
proportional hazards model to estimate the standardized 
survival function <code class="reqn">\theta(t,x)=E\{S(t|X=x,Z)\}</code>, where <code class="reqn">t</code> is a specific value of <code class="reqn">T</code>, 
<code class="reqn">x</code> is a specific value of <code class="reqn">X</code>, and the expectation is over the marginal 
distribution of <code class="reqn">Z</code>.     
</p>


<h3>Usage</h3>

<pre><code class="language-R">stdCoxph(fit, data, X, x, t, clusterid, subsetnew)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>

<p>an object of class <code>"coxph"</code>, as returned by the <code>coxph</code> function 
in the <span class="pkg">survival</span> package, but without special terms <code>strata</code>, <code>cluster</code> or <code>tt</code>. 
Only <code>breslow</code> method for handling ties is allowed. If arguments 
<code>weights</code> and/or <code>subset</code> are used when fitting the model, 
then the same weights and subset are used in <code>stdGlm</code>.  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>a data frame containing the variables in the model. This should be the same 
data frame as was used to fit the model in <code>fit</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>

<p>a string containing the name of the exposure variable <code class="reqn">X</code> in <code>data</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>an optional vector containing the specific values of <code class="reqn">X</code> at which to estimate 
the standardized survival function. If <code class="reqn">X</code> is binary (0/1) or
a factor, then <code>x</code> defaults to all values of <code class="reqn">X</code>. If <code class="reqn">X</code> is numeric,
then <code>x</code> defaults to the mean of <code class="reqn">X</code>. If <code>x</code> is set to <code>NA</code>,
then <code class="reqn">X</code> is not altered. This produces an estimate of the marginal survival 
function <code class="reqn">S(t)=E\{S(t|X,Z)\}</code>.   
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>

<p>an optional vector containing the specific values of <code class="reqn">T</code> at which to estimate 
the standardized survival function. It defaults to all the observed event times
in <code>data</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clusterid</code></td>
<td>

<p>an optional string containing the name of a cluster identification variable when data are clustered.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subsetnew</code></td>
<td>

<p>an optional logical statement specifying a subset of observations to be used in 
the standardization. This set is assumed to be a subset of the subset (if any)
that was used to fit the regression model. 
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>stdCoxph</code> assumes that a Cox proportional hazards model 
</p>
<p style="text-align: center;"><code class="reqn">\lambda(t|X,Z)=\lambda_0(t)exp\{h(X,Z;\beta)\}</code>
</p>

<p>has been fitted. Breslow's 
estimator of the cumulative baseline hazard <code class="reqn">\Lambda_0(t)=\int_0^t\lambda_0(u)du</code>
is used together with the partial likelihood estimate of <code class="reqn">\beta</code> to obtain 
estimates of the survival function <code class="reqn">S(t|X=x,Z)</code>:
</p>
<p style="text-align: center;"><code class="reqn">\hat{S}(t|X=x,Z)=exp[-\hat{\Lambda}_0(t)exp\{h(X=x,Z;\hat{\beta})\}].</code>
</p>
 
<p>For each <code class="reqn">t</code> in the <code>t</code> argument and for each <code class="reqn">x</code> in the <code>x</code> argument, 
these estimates are averaged across all subjects (i.e. all observed values of <code class="reqn">Z</code>)
to produce estimates 
</p>
<p style="text-align: center;"><code class="reqn">\hat{\theta}(t,x)=\sum_{i=1}^n \hat{S}(t|X=x,Z_i)/n,</code>
</p>
 
<p>where <code class="reqn">Z_i</code> is the value of <code class="reqn">Z</code> for subject <code class="reqn">i</code>, <code class="reqn">i=1,...,n</code>. 
The variance for <code class="reqn">\hat{\theta}(t,x)</code> is obtained by the sandwich formula. 
</p>


<h3>Value</h3>

<p>An object of class <code>"stdCoxph"</code> is a list containing 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>

<p>the matched call. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input</code></td>
<td>

<p><code>input</code> is a list containing all input arguments.     
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est</code></td>
<td>

<p>a matrix with <code>length(t)</code> rows and <code>length(x)</code> columns, where the element 
on row <code>i</code> and column <code>j</code> is equal to <code class="reqn">\hat{\theta}</code>(<code>t[i],x[j]</code>). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcov</code></td>
<td>

<p>a list with <code>length(t)</code> elements. Each element is a square matrix with 
<code>length(x)</code> rows. In the <code>k:th</code> matrix, the element on row <code>i</code> 
and column <code>j</code> is the (estimated) covariance of <code class="reqn">\hat{\theta}</code>(<code>t[k]</code>,<code>x[i]</code>) 
and <code class="reqn">\hat{\theta}</code>(<code>t[k]</code>,<code>x[j]</code>).
</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>Standardized survival functions are sometimes referred to as (direct) adjusted
survival functions in the literature.
</p>
<p><code>stdCoxph</code> does not currently handle time-varying exposures or covariates. 
</p>
<p><code>stdCoxph</code> internally loops over all values in the <code>t</code> argument. Therefore,
the function will usually be considerably faster if <code>length(t)</code> is small.
</p>
<p>The variance calculation performed by <code>stdCoxph</code> does not condition on 
the observed covariates <code class="reqn">\bar{Z}=(Z_1,...,Z_n)</code>. To see how this matters, 
note that 
</p>
<p style="text-align: center;"><code class="reqn">var\{\hat{\theta}(t,x)\}=E[var\{\hat{\theta}(t,x)|\bar{Z}\}]+var[E\{\hat{\theta}(t,x)|\bar{Z}\}].</code>
</p>
 
<p>The usual parameter <code class="reqn">\beta</code> in a Cox proportional hazards model does not 
depend on <code class="reqn">\bar{Z}</code>. Thus, <code class="reqn">E(\hat{\beta}|\bar{Z})</code> is independent of 
<code class="reqn">\bar{Z}</code> as well (since <code class="reqn">E(\hat{\beta}|\bar{Z})=\beta</code>), so that the 
term <code class="reqn">var[E\{\hat{\beta}|\bar{Z}\}]</code> in the corresponding variance 
decomposition for <code class="reqn">var(\hat{\beta})</code> becomes equal to 0. However, 
<code class="reqn">\theta(t,x)</code> depends on <code class="reqn">\bar{Z}</code> through the average over the sample 
distribution for <code class="reqn">Z</code>, and thus the term <code class="reqn">var[E\{\hat{\theta}(t,x)|\bar{Z}\}]</code> 
is not 0, unless one conditions on <code class="reqn">\bar{Z}</code>. The variance calculation by 
Gail and Byar (1986) ignores this term, and thus effectively conditions on 
<code class="reqn">\bar{Z}</code>.      
</p>


<h3>Author(s)</h3>

<p>Arvid Sjolander
</p>


<h3>References</h3>

<p>Chang I.M., Gelman G., Pagano M. (1982). Corrected group prognostic curves
and summary statistics. <em>Journal of Chronic Diseases</em> <b>35</b>, 669-674.
</p>
<p>Gail M.H. and Byar D.P. (1986). Variance calculations for direct adjusted survival
curves, with applications to testing for no treatment effect. <em>Biometrical Journal</em>
<b>28</b>(5), 587-599. 
</p>
<p>Makuch R.W. (1982). Adjusted survival curve estimation using covariates.
<em>Journal of Chronic Diseases</em> <b>35</b>, 437-443.
</p>
<p>Sjolander A. (2016). Regression standardization with the R-package stdReg.
<em>European Journal of Epidemiology</em> <b>31</b>(6), 563-574.
</p>
<p>Sjolander A. (2016). Estimation of causal effect measures with the R-package stdReg.
<em>European Journal of Epidemiology</em> <b>33</b>(9), 847-858.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
require(survival)

n &lt;- 1000
Z &lt;- rnorm(n)
X &lt;- rnorm(n, mean=Z)
T &lt;- rexp(n, rate=exp(X+Z+X*Z)) #survival time
C &lt;- rexp(n, rate=exp(X+Z+X*Z)) #censoring time
U &lt;- pmin(T, C) #time at risk
D &lt;- as.numeric(T &lt; C) #event indicator
dd &lt;- data.frame(Z, X, U, D)
fit &lt;- coxph(formula=Surv(U, D)~X+Z+X*Z, data=dd, method="breslow")
fit.std &lt;- stdCoxph(fit=fit, data=dd, X="X", x=seq(-1,1,0.5), t=1:5)
print(summary(fit.std, t=3))
plot(fit.std)

</code></pre>


</div>