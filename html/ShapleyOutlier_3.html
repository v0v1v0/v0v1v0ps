<div class="container">

<table style="width: 100%;"><tr>
<td>MOE</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Detecting cellwise outliers using Shapley values based on local outlyingness.</h2>

<h3>Description</h3>

<p>The <code>MOE</code> function indicates outlying cells for
a data vector with <code class="reqn">p</code> entries or data matrix with <code class="reqn">n \times p</code> entries containing only numeric entries <code>x</code>
for a given center <code>mu</code> and covariance matrix <code>Sigma</code> using the Shapley value.
It is a more sophisticated alternative to the <code>SCD</code> algorithm,
which uses the information of the regular cells to derive an alternative reference point  (Mayrhofer and Filzmoser 2022).
</p>


<h3>Usage</h3>

<pre><code class="language-R">MOE(
  x,
  mu,
  Sigma,
  Sigma_inv = NULL,
  step_size = 0.1,
  min_deviation = 0,
  max_step = NULL,
  local = TRUE,
  max_iter = 1000,
  q = 0.99,
  check_outlyingness = FALSE,
  check = TRUE,
  cells = NULL,
  method = "cellMCD"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data vector with <code class="reqn">p</code> entries or data matrix with <code class="reqn">n \times p</code> entries containing only numeric entries.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>Either <code>NULL</code> (default) or mean vector of <code>x</code>. If NULL, <code>method</code> is used for parameter estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma</code></td>
<td>
<p>Either <code>NULL</code> (default) or covariance matrix <code class="reqn">p \times p</code> of <code>x</code>. If NULL, <code>method</code> is used for parameter estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma_inv</code></td>
<td>
<p>Either <code>NULL</code> (default) or Sigma's inverse <code class="reqn">p \times p</code> matrix.
If <code>NULL</code>, the inverse of <code>Sigma</code> is computed using <code>solve(Sigma)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>step_size</code></td>
<td>
<p>Numeric. Step size for the imputation of outlying cells, with <code>step_size</code> <code class="reqn">\in [0,1]</code>. Defaults to <code class="reqn">0.1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_deviation</code></td>
<td>
<p>Numeric. Detection threshold, with <code>min_deviation</code> <code class="reqn">\in [0,1]</code>. Defaults to <code class="reqn">0.2</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_step</code></td>
<td>
<p>Either <code>NULL</code> (default) or an integer. The maximum number of steps in each iteration.
If <code>NULL</code>, <code>max_step</code> <code class="reqn">= p</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>local</code></td>
<td>
<p>Logical. If TRUE (default), the non-central Chi-Squared distribution is used to determine the cutoff value based on <code>mu_tilde</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_iter</code></td>
<td>
<p>Integer. The maximum number of iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>Numeric. The quantile of the Chi-squared distribution for detection and imputation of outliers. Defaults to <code class="reqn">0.99</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check_outlyingness</code></td>
<td>
<p>Logical. If TRUE (default), the outlyingness is rechecked after applying <code>min_deviation</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>
<p>Logical. If <code>TRUE</code> (default), inputs are checked before running the function
and an error message is returned if one of the inputs is not as expected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cells</code></td>
<td>
<p>Either <code>NULL</code> (default) or a vector/matrix of the same dimension as <code>x</code>,
indicating the outlying cells. The matrix must contain only zeros and ones, or <code>TRUE</code>/<code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Either "cellMCD" (default) or "MCD". Specifies the method used for parameter estimation if <code>mu</code> and/or <code>Sigma</code> are not provided.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list of class <code>shapley_algorithm</code> (<code>new_shapley_algorithm</code>) containing the following:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code class="reqn">p</code>-dimensional vector (or a <code class="reqn">n \times p</code> matrix) containing the imputed data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>A <code class="reqn">p</code>-dimensional vector (or a <code class="reqn">n \times p</code> matrix) containing the Shapley values (outlyingness-scores) of <code>x</code>; see <code>shapley</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu_tilde</code></td>
<td>
<p>A <code class="reqn">p</code>-dimensional vector (or a <code class="reqn">n \times p</code> matrix) containing the alternative reference points based on the regular cells of the original observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_original</code></td>
<td>
<p>A <code class="reqn">p</code>-dimensional vector (or a <code class="reqn">n \times p</code> matrix) containing the original data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_original</code></td>
<td>
<p>The non-centrality parameters for the Chi-Squared distribution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_history</code></td>
<td>
<p>A list with <code class="reqn">n</code> elements, each containing the path of how the original data vector was modified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi_history</code></td>
<td>
<p>A list with <code class="reqn">n</code> elements, each containing the Shapley values corresponding to <code>x_history</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu_tilde_history</code></td>
<td>
<p>A list with <code class="reqn">n</code> elements, each containing the alternative reference points corresponding to <code>x_history</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_history</code></td>
<td>
<p>A list with <code class="reqn">n</code> elements, each containing the indices of the outlying cells in each iteration.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Mayrhofer M, Filzmoser P (2022).
“Multivariate outlier explanations using Shapley values and Mahalanobis distances.”
<a href="https://doi.org/10.48550/ARXIV.2210.10063">doi:10.48550/ARXIV.2210.10063</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">p &lt;- 5
mu &lt;- rep(0,p)
Sigma &lt;- matrix(0.9, p, p); diag(Sigma) = 1
Sigma_inv &lt;- solve(Sigma)
x &lt;- c(0,1,2,2.3,2.5)
MOE_x &lt;- MOE(x = x, mu = mu, Sigma = Sigma)
plot(MOE_x)

library(MASS)
set.seed(1)
n &lt;- 100; p &lt;- 10
mu &lt;- rep(0,p)
Sigma &lt;- matrix(0.9, p, p); diag(Sigma) = 1
X &lt;- mvrnorm(n, mu, Sigma)
X[sample(1:(n*p), 100, FALSE)] &lt;- rep(c(-5,5),50)
MOE_X &lt;- MOE(X, mu, Sigma)
plot(MOE_X, subset = 20)
</code></pre>


</div>