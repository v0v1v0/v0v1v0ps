<div class="container">

<table style="width: 100%;"><tr>
<td>FQI</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Forecast Quality Index
</h2>

<h3>Description</h3>

<p>Functions for calculating the Forecast Quality Index (FQI) and its components.
</p>


<h3>Usage</h3>

<pre><code class="language-R">FQI(object, surr = NULL, k = 4, time.point = 1, obs = 1, model = 1, ...)

UIQI(X, Xhat, ...)

ampstats(X, Xhat, only.nonzero = FALSE)

## S3 method for class 'fqi'
print(x, ...)

## S3 method for class 'fqi'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>

<p>list object of class “SpatialVx”.  In the case of the <code>summary</code> method, <code>object</code> is the list object returned by <code>FQI</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X,Xhat</code></td>
<td>
<p>numeric matrices giving the fields for the verification set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>list object of class “fqi” as returned by <code>FQI</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surr</code></td>
<td>

<p>three-dimesnional array containing surrogate fields for <code>X</code>, e.g. as returned by <code>surrogater2d</code>.  If NULL, these will be calculated using <code>surrogater2d</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>only.nonzero</code></td>
<td>
<p>logical, should the means and variances of only the non-zero values of the fields be calculated (if so, the covariance is returned as NA)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>

<p>numeric vector for use with the partial Hausdorff distance.  For k that are whole numerics or integers &gt;= 1, then the k-th highest value is returned by <code>locmeasures2d</code>.  If 0 &lt;= k &lt; 1, then the corresponding quantile is returned.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.point</code></td>
<td>
<p>numeric or character indicating which time point from the “SpatialVx” verification set to select for analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs, model</code></td>
<td>
<p>numeric indicating which forecast model to select for the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>In the case of <code>FQI</code>, additional arguments to <code>surrogater2d</code>.  Only used if <code>surr</code> is NULL.  In the case of <code>UIQI</code>, additional arguments to <code>ampstats</code>.  In the case of <code>summary.fqi</code>, these are not used.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The FQI was proposed as a spatial verification metric (a true metric in the mathematical sense) by Venugopal et al. (2005) to combine amplitude and displacement error information in a single summary statistic.  It is given by
</p>
<p>FQI = (PHD_k(X, Xhat)/mean( PHD_k(X, surr_i); i in 1 to number of surrogates)) / (brightness * distortion)
</p>
<p>where the numerator is a normalized partial Hausdorff distance (see help file for locperf), brightness (also called bias) is given by 2*(mu1*mu2)/(mu1^2+mu2^2), where mu1 (mu2) is the mean value of X (Xhat), and the distortion term is given by 2*(sig1*sig2)/(sig1^2+sig2^2), where sig1^2 (sig2^2) is the variance of X (Xhat) values.  The denominator is a modified UIQI (Universal Image Quality Index; Wang and Bovik, 2002), which itself is given by
</p>
<p>UIQI = cor(X,Xhat)*brightness*distortion.
</p>
<p>Note that if <code>only.nonzero</code> is <code>TRUE</code> in the call to <code>UIQI</code>, then the modified UIQI used in the FQI formulation is returned (i.e., without multiplying by the correlation term).
</p>
<p>The <code>print</code> method so far just calls the <code>summary</code> method.
</p>


<h3>Value</h3>

<p>FQI returns a list with with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>phd.norm </code></td>
<td>
<p>matrix of normalized partial Hausdorff distances for each value of k (rows) and each threshold (columns).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uiqi.norm </code></td>
<td>
<p>numeric vector of modified UIQI values for each threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fqi</code></td>
<td>
<p>matrix of FQI values for each value of k (rows) and each threshold (columns).</p>
</td>
</tr>
</table>
<p>It will also have the same attributes as the “SpatialVx” object with additional attributes defining the arguments specific to parameters used by the function.
</p>
<p>UIQI returns a list with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>data.name</code></td>
<td>
<p>character vector giving the names of the two fields.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor</code></td>
<td>
<p>single numeric giving the correlation between the two fields.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>brightness.bias</code></td>
<td>
<p>single numeric giving the brightness (bias) value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distortion.variability</code></td>
<td>
<p>single numeric giving the distortion (variability) value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>UIQI</code></td>
<td>
<p>single numeric giving the UIQI (or modified UIQI if only.nonzero is set to TRUE) value.</p>
</td>
</tr>
</table>
<p>ampstats returns a list object with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>mean.fcst,mean.vx</code></td>
<td>
<p>single numerics giving the mean of Xhat and X, resp.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.fcst,var.vx</code></td>
<td>
<p>single numerics giving the variance of Xhat and X, resp.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov</code></td>
<td>
<p>single numeric giving the covariance between Xhat and X (if only.nonzero is TRUE, this will be NA).</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Eric Gilleland
</p>


<h3>References</h3>

<p>Venugopal, V., Basu, S. and Foufoula-Georgiou, E. (2005) A new metric for comparing precipitation patterns with an application to ensemble forecasts.  <em>J. Geophys. Res.</em>, <b>110</b>, D08111, 11 pp., doi:10.1029/2004JD005395.
</p>
<p>Wang, Z. and Bovik, A. C. (2002) A universal image quality index.  <em>IEEE Signal Process. Lett.</em>, <b>9</b>, 81–84.
</p>


<h3>See Also</h3>

<p><code>locperf</code>, <code>surrogater2d</code>, <code>locmeasures2d</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data( "ExampleSpatialVxSet" )

 x &lt;- ExampleSpatialVxSet$vx
 xhat &lt;- ExampleSpatialVxSet$fcst

 # Now, find surrogates of the simulated field.
 z &lt;- surrogater2d(x, zero.down=TRUE, n=10)

 u &lt;- list( X = cbind( quantile( c(x), c(0.75, 0.9)) ),
	Xhat = cbind( quantile( c(xhat), c(0.75, 0.9) ) ) )

hold &lt;- make.SpatialVx(x, xhat, thresholds = u,
			field.type = "Example", units = "none",
			data.name = "ExampleSpatialVxSet",
			obs.name = "X", model.name = "Xhat" )

FQI(hold, surr = z, k = c(4, 0.75) )
</code></pre>


</div>