<div class="container">

<table style="width: 100%;"><tr>
<td>bSpline</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>B-Spline Basis for Polynomial Splines</h2>

<h3>Description</h3>

<p>Generates the spline basis matrix for B-splines representing the family of
piecewise polynomials with the specified interior knots, degree, and
boundary knots, evaluated at the values of <code>x</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">bSpline(
  x,
  df = NULL,
  knots = NULL,
  degree = 3L,
  intercept = FALSE,
  Boundary.knots = NULL,
  periodic = FALSE,
  derivs = 0L,
  integral = FALSE,
  warn.outside = getOption("splines2.warn.outside", TRUE),
  ...
)

ibs(
  x,
  df = NULL,
  knots = NULL,
  degree = 3,
  intercept = FALSE,
  Boundary.knots = NULL,
  ...
)

dbs(
  x,
  derivs = 1L,
  df = NULL,
  knots = NULL,
  degree = 3,
  intercept = FALSE,
  Boundary.knots = NULL,
  ...
)

bsp(
  x,
  df = NULL,
  knots = NULL,
  degree = 3L,
  intercept = FALSE,
  Boundary.knots = NULL,
  periodic = FALSE,
  derivs = 0L,
  integral = FALSE,
  warn.outside = getOption("splines2.warn.outside", TRUE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The predictor variable.  Missing values are allowed and will be
returned as they are.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>Degree of freedom that equals to the column number of the returned
matrix.  One can specify <code>df</code> rather than <code>knots</code>, then the
function chooses <code>df - degree - as.integer(intercept)</code> internal
knots at suitable quantiles of <code>x</code> ignoring missing values and
those <code>x</code> outside of the boundary.  For periodic splines, <code>df
- as.integer(intercept)</code> internal knots will be chosen at suitable
quantiles of <code>x</code> relative to the beginning of the cyclic intervals
they belong to (see Examples) and the number of internal knots must be
greater or equal to the specified <code>degree - 1</code>.  If internal knots
are specified via <code>knots</code>, the specified <code>df</code> will be ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>The internal breakpoints that define the splines.  The default
is <code>NULL</code>, which results in a basis for ordinary polynomial
regression.  Typical values are the mean or median for one knot,
quantiles for more knots.  For periodic splines, the number of knots
must be greater or equal to the specified <code>degree - 1</code>.
Duplicated internal knots are not allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>A nonnegative integer specifying the degree of the piecewise
polynomial. The default value is <code>3</code> for cubic splines. Zero degree
is allowed for piecewise constant basis functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>If <code>TRUE</code>, the complete basis matrix will be returned.
Otherwise, the first basis will be excluded from the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Boundary.knots</code></td>
<td>
<p>Boundary points at which to anchor the splines.  By
default, they are the range of <code>x</code> excluding <code>NA</code>.  If both
<code>knots</code> and <code>Boundary.knots</code> are supplied, the basis
parameters do not depend on <code>x</code>. Data can extend beyond
<code>Boundary.knots</code>.  For periodic splines, the specified bounary
knots define the cyclic interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>periodic</code></td>
<td>
<p>A logical value.  If <code>TRUE</code>, the periodic splines will
be returned.  The default value is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>derivs</code></td>
<td>
<p>A nonnegative integer specifying the order of derivatives of
splines basis function.  The default value is <code>0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integral</code></td>
<td>
<p>A logical value.  If <code>TRUE</code>, the corresponding
integrals of spline basis functions will be returned.  The default value
is <code>FALSE</code>. For periodic splines, the integral of each basis is
integrated from the left boundary knot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn.outside</code></td>
<td>
<p>A logical value indicating if a warning should be thrown
out when any <code>x</code> is outside the boundary.  This option can also be
set through <code>options("splines2.warn.outside")</code> after the package is
loaded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Optional arguments that are not used.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function extends the <code>bs()</code> function in the <code>splines</code> package
for B-spline basis functions by allowing piecewise constant (left-closed and
right-open except on the right boundary) spline basis of degree zero.  In
addition, the function provides derivatives or integrals of the B-spline
basis functions when one specifies the arguments <code>derivs</code> or
<code>integral</code> appropriately.  The function constructs periodic B-splines
when <code>periodic</code> is <code>TRUE</code>.  All the implementations are based on
the closed-form recursion formula following De Boor (1978) and Wang and Yan
(2021).
</p>
<p>The functions <code>ibs()</code> and <code>dbs()</code> are provided for convenience.
The former provides the integrals of B-splines and is equivalent to
<code>bSpline()</code> with <code>integral = TRUE</code>.  The latter produces the
derivatives of given order of B-splines and is equivalent to
<code>bSpline()</code> with default <code>derivs = 1</code>.  The function <code>bsp()</code>
is an alias of to encourage the use in a model formula.
</p>


<h3>Value</h3>

<p>A numeric matrix of <code>length(x)</code> rows and <code>df</code> columns if
<code>df</code> is specified.  If <code>knots</code> are specified instead, the
output matrix will consist of <code>length(knots) + degree +
    as.integer(intercept)</code> columns if <code>periodic = FALSE</code>, or
<code>length(knots) + as.integer(intercept)</code> columns if <code>periodic =
    TRUE</code>.  Attributes that correspond to the arguments specified are
returned for usage of other functions in this package.
</p>


<h3>References</h3>

<p>De Boor, Carl. (1978). <em>A practical guide to splines</em>.
Vol. 27. New York: Springer-Verlag.
</p>
<p>Wang, W., &amp; Yan, J. (2021). <em>Shape-restricted regression splines with R
package splines2</em>. Journal of Data Science, 19(3),498â€“517.
</p>


<h3>See Also</h3>

<p><code>knots</code> for extracting internal and boundary knots.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(splines2)

set.seed(1)
x &lt;- runif(100)
knots &lt;- c(0.3, 0.5, 0.6) # internal knots

## cubic B-splines
bsMat &lt;- bSpline(x, knots = knots, degree = 3, intercept = TRUE)
ibsMat &lt;- update(bsMat, integral = TRUE) # the integrals
d1Mat &lt;- deriv(bsMat)                    # the 1st derivaitves
d2Mat &lt;- deriv(bsMat, 2)                 # the 2nd derivaitves

op &lt;- par(mfrow = c(2, 2), mar = c(2.5, 2.5, 0.2, 0.1), mgp = c(1.5, 0.5, 0))
plot(bsMat, ylab = "Cubic B-splines")
plot(ibsMat, ylab = "The integrals")
plot(d1Mat, ylab = "The 1st derivatives")
plot(d2Mat, ylab = "The 2nd derivatives")

## evaluate at new values
predict(bsMat, c(0.125, 0.801))

## periodic B-splines
px &lt;- seq(0, 3, 0.01)
pbsMat &lt;- bSpline(px, knots = knots, Boundary.knots = c(0, 1),
                  intercept = TRUE, periodic = TRUE)
ipMat &lt;- update(pbsMat, integral = TRUE)
dpMat &lt;- deriv(pbsMat)
dp2Mat &lt;- deriv(pbsMat, 2)

plot(pbsMat, ylab = "Periodic B-splines", mark_knots = "b")
plot(ipMat, ylab = "The integrals", mark_knots = "b")
plot(dpMat, ylab = "The 1st derivatives", mark_knots = "b")
plot(dp2Mat, ylab = "The 2nd derivatives", mark_knots = "b")
par(op) # reset to previous plotting settings
</code></pre>


</div>