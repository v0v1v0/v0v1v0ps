<div class="container">

<table style="width: 100%;"><tr>
<td>ifun</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Invert an expression defining a data transformation</h2>

<h3>Description</h3>

<p>Given a transformed variable and the expression used to transform it, <code>ifun</code> creates
a function containing the inverse expression that will back-transform the variable.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ifun(expr, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>expr</code></td>
<td>
<p>a single-variable call or quoted expression to be inverted.
The variable's name in <code>expr</code> is referred to here as <code>varname</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical controlling printing of the intermediate functions
<code class="reqn">f(.)</code>, <code class="reqn">g(.)</code>, <code class="reqn">h(.)</code> etc (see 'Details').</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ifun</code> returns the inverting function such that
<code>ifun(expr)(eval(expr)) = varname</code>, where
<code>expr</code> can include any of the invertible functions in the <code>Math</code> and <code>Ops</code>
groups, plus <code>identity</code> and <code>I</code>.
</p>
<p>To illustrate its use, consider variants of the <code>sitar</code> model
<code>height ~ age</code> where <code>age</code> and/or <code>height</code> are transformed,
e.g. <code>height ~ log(age)</code> or <code>log(height) ~ sqrt(age)</code>. Each model
is of the form <code>y ~ x</code> but the units of <code>x</code> and <code>y</code> vary.
</p>
<p>The models are compared by plotting the fitted curves in their original units,
by first applying suitable functions to back-transform <code>x</code> and <code>y</code>.
For example with <code>log(age)</code>, where <code>expr = quote(log(age))</code>,
the function <code>ifun = function(x) exp(x)</code> back-transforms
<code>eval(expr)</code> to give <code>age</code>. See the first example.
</p>
<p><code>ifun</code> generalises this process for increasingly complex <code>expr</code>, as
the next two examples show.
</p>
<p>The final example shows <code>ifun</code> in action with <code>plot.sitar</code>,
which uses <code>ifun</code> as the default function for arguments <code>xfun</code> and
<code>yfun</code> - they are used to back-transform <code>x</code> and <code>y</code> using the
values of <code>expr</code> for <code>x</code> and <code>y</code> extracted from the model's
<code>sitar</code> call.
</p>
<p>Structuring <code>expr</code> suitably ensures it can be inverted - it should
contain a single mention of a single variable (<code>varname</code> here),
and possibly functions such as <code class="reqn">f(.)</code>, <code class="reqn">g(.)</code>, <code class="reqn">h(.)</code> etc
such that <code>expr</code> = <code class="reqn">f(g(h((varname))))</code>. The number of such functions
is in principle unlimited. <code>ifun</code> returns <code>function(x)</code>
<code class="reqn">h^{-1}(g^{-1}(f^{-1}((x))))</code>,
which ensures that
<code>expr</code> is invertible so long as the individual functions are invertible.
</p>


<h3>Value</h3>

<p>The required inverting function, with single argument <code>x</code>. Its
<code>"varname"</code> attribute contains <code>varname</code> as a character string.
</p>


<h3>Author(s)</h3>

<p>Tim Cole <a href="mailto:tim.cole@ucl.ac.uk">tim.cole@ucl.ac.uk</a>
</p>


<h3>See Also</h3>

<p><code>plot.sitar</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## for best effect run all the code

## define varname variable
(age &lt;- 1:9)

## simple case - age transformed to log(age)
(expr &lt;- quote(log(age)))
## transformed age
eval(expr)
## inverting function, with "varname" attribute set to "age"
ifun(expr)
## inverted transformed age identical to age
all.equal(age, ifun(expr)(eval(expr)))

## more complex case - age transformed to log age since conception
(expr &lt;- quote(log(age + 0.75)))
## inverting function
ifun(expr)
## inverted transformed age identical to age
all.equal(age, ifun(expr)(eval(expr)))

## ludicrously complex case involving exp, log10, ^, pi and trigonometry
(expr &lt;- quote((exp(sin(pi * log10(age + 0.75)/2) - 1)^4)))
## inverting function, showing intermediate stages
ifun(expr, verbose=TRUE)
## identical to original
all.equal(age, ifun(expr)(eval(expr)))

## example of plot.sitar back-transforming transformed x and y in sitar models
## fit sitar models
m1 &lt;- sitar(x=age, y=height^2, id=id, data=heights, df=6)
m2 &lt;- update(m1, x=log(age+0.75), y=height)

## default plot options for xfun &amp; yfun back-transform x &amp; y to original scales
## xfun=ifun(x$call.sitar$x)
## yfun=ifun(x$call.sitar$y)
## compare mean curves for the two models where x &amp; y are on the original scales
plot(m1, 'd', las=1)
lines(m2, 'd', col=2)
</code></pre>


</div>