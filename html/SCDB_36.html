<div class="container">

<table style="width: 100%;"><tr>
<td>Logger</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Logger: Complete logging to console, file and database</h2>

<h3>Description</h3>

<p>The <code>Logger</code> class facilitates logging to a database and/or file and to console.
</p>
<p>A <code>Logger</code> is associated with a specific table and timestamp which must be supplied at initialization.
This information is used to create the log file (if a <code>log_path</code> is given) and the log entry in the database
(if a <code>log_table_id</code> and <code>log_conn</code> is given).
</p>
<p>Logging to the database must match the fields in the log table.
</p>


<h3>Value</h3>

<p>A new instance of the <code>Logger</code> R6 class.
</p>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>output_to_console</code></dt>
<dd>
<p>(<code>logical(1)</code>)<br>
Should the Logger output to console? Read only.
This can always be overridden by Logger$log_info(..., output_to_console = FALSE).</p>
</dd>
<dt><code>log_path</code></dt>
<dd>
<p>(<code>character(1)</code>)<br>
The location log files are written (if this is not NULL). Defaults to <code>getOption("SCDB.log_path")</code>. Read only.</p>
</dd>
<dt><code>log_tbl</code></dt>
<dd>
<p>(<code>tbl_dbi(1)</code>)<br>
The database table used for logging. Class is connection-specific, but inherits from <code>tbl_dbi</code>. Read only.</p>
</dd>
<dt><code>start_time</code></dt>
<dd>
<p>(<code>POSIXct(1)</code>)<br>
The time at which data processing was started. Read only.</p>
</dd>
<dt><code>log_filename</code></dt>
<dd>
<p>(<code>character(1)</code>)<br>
The filename (basename) of the file that the <code>Logger</code> instance will output to.  Read only.</p>
</dd>
<dt><code>log_realpath</code></dt>
<dd>
<p>(<code>character(1)</code>)<br>
The full path to the logger's log file. Read only.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-Logger-new"><code>Logger$new()</code></a>
</p>
</li>
<li> <p><a href="#method-Logger-finalize"><code>Logger$finalize()</code></a>
</p>
</li>
<li> <p><a href="#method-Logger-log_info"><code>Logger$log_info()</code></a>
</p>
</li>
<li> <p><a href="#method-Logger-log_warn"><code>Logger$log_warn()</code></a>
</p>
</li>
<li> <p><a href="#method-Logger-log_error"><code>Logger$log_error()</code></a>
</p>
</li>
<li> <p><a href="#method-Logger-log_to_db"><code>Logger$log_to_db()</code></a>
</p>
</li>
<li> <p><a href="#method-Logger-finalize_db_entry"><code>Logger$finalize_db_entry()</code></a>
</p>
</li>
<li> <p><a href="#method-Logger-clone"><code>Logger$clone()</code></a>
</p>
</li>
</ul>
<hr>
<a id="method-Logger-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Create a new <code>Logger</code> object
</p>


<h5>Usage</h5>

<div class="r"><pre>Logger$new(
  db_table = NULL,
  timestamp = NULL,
  output_to_console = TRUE,
  log_table_id = getOption("SCDB.log_table_id"),
  log_conn = NULL,
  log_path = getOption("SCDB.log_path"),
  start_time = Sys.time(),
  warn = TRUE
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>db_table</code></dt>
<dd>
<p>(<code style="white-space: pre;">⁠id-like object(1)⁠</code>)<br>
A table specification (coercible by <code>id()</code>) specifying the table being updated.</p>
</dd>
<dt><code>timestamp</code></dt>
<dd>
<p>(<code>POSIXct(1)</code>, <code>Date(1)</code>, or <code>character(1)</code>)<br>
A timestamp describing the data being processed (not the current time).</p>
</dd>
<dt><code>output_to_console</code></dt>
<dd>
<p>(<code>logical(1)</code>)<br>
Should the Logger output to console?</p>
</dd>
<dt><code>log_table_id</code></dt>
<dd>
<p>(<code style="white-space: pre;">⁠id-like object(1)⁠</code>)<br>
A table specification (coercible by <code>id()</code>) specifying the location of the log table.</p>
</dd>
<dt><code>log_conn</code></dt>
<dd>
<p>(<code>DBIConnection(1)</code>)<br>
A database connection where log table should exist.</p>
</dd>
<dt><code>log_path</code></dt>
<dd>
<p>(<code>character(1)</code>)<br>
The path where logs are stored.
If <code>NULL</code>, no file logs are created.</p>
</dd>
<dt><code>start_time</code></dt>
<dd>
<p>(<code>POSIXct(1)</code>)<br>
The time at which data processing was started (defaults to <code>Sys.time()</code>).</p>
</dd>
<dt><code>warn</code></dt>
<dd>
<p>(<code>logical(1)</code>)<br>
Should a warning be produced if no logging will be done?</p>
</dd>
</dl>
</div>


<hr>
<a id="method-Logger-finalize"></a>



<h4>Method <code>finalize()</code>
</h4>

<p>Remove generated <code>log_name</code> from database if not writing to a file.
</p>


<h5>Usage</h5>

<div class="r"><pre>Logger$finalize()</pre></div>


<hr>
<a id="method-Logger-log_info"></a>



<h4>Method <code>log_info()</code>
</h4>

<p>Write a line to log (console / file).
</p>


<h5>Usage</h5>

<div class="r"><pre>Logger$log_info(
  ...,
  tic = Sys.time(),
  output_to_console = self$output_to_console,
  log_type = "INFO",
  timestamp_format = getOption("SCDB.log_timestamp_format", "%F %R:%OS3")
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>(<code>character()</code>)<br>
Character strings to be concatenated as log message.</p>
</dd>
<dt><code>tic</code></dt>
<dd>
<p>(<code>POSIXct(1)</code>)<br>
The timestamp used by the log entry.</p>
</dd>
<dt><code>output_to_console</code></dt>
<dd>
<p>(<code>logical(1)</code>)<br>
Should the line be written to console?</p>
</dd>
<dt><code>log_type</code></dt>
<dd>
<p>(<code>character(1)</code>)<br>
The severity of the log message.</p>
</dd>
<dt><code>timestamp_format</code></dt>
<dd>
<p>(<code>character(1)</code>)<br>
The format of the timestamp used in the log message (parsable by <code>strftime()</code>).</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>Returns the log message invisibly
</p>


<hr>
<a id="method-Logger-log_warn"></a>



<h4>Method <code>log_warn()</code>
</h4>

<p>Write a warning to log file and generate warning.
</p>


<h5>Usage</h5>

<div class="r"><pre>Logger$log_warn(..., log_type = "WARNING")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>(<code>character()</code>)<br>
Character strings to be concatenated as log message.</p>
</dd>
<dt><code>log_type</code></dt>
<dd>
<p>(<code>character(1)</code>)<br>
The severity of the log message.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-Logger-log_error"></a>



<h4>Method <code>log_error()</code>
</h4>

<p>Write an error to log file and stop execution.
</p>


<h5>Usage</h5>

<div class="r"><pre>Logger$log_error(..., log_type = "ERROR")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>(<code>character()</code>)<br>
Character strings to be concatenated as log message.</p>
</dd>
<dt><code>log_type</code></dt>
<dd>
<p>(<code>character(1)</code>)<br>
The severity of the log message.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-Logger-log_to_db"></a>



<h4>Method <code>log_to_db()</code>
</h4>

<p>Write or update log table.
</p>


<h5>Usage</h5>

<div class="r"><pre>Logger$log_to_db(...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>(<code style="white-space: pre;">⁠Name-value pairs⁠</code>)<br>
Structured data written to database log table. Name indicates column and value indicates value to be written.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-Logger-finalize_db_entry"></a>



<h4>Method <code>finalize_db_entry()</code>
</h4>

<p>Auto-fills "end_time" and "duration" for the log entry and clears the "log_file" field if no
file is being written.
</p>


<h5>Usage</h5>

<div class="r"><pre>Logger$finalize_db_entry(end_time = Sys.time())</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>end_time</code></dt>
<dd>
<p>(<code>POSIXct(1)</code>, <code>Date(1)</code>, or <code>character(1)</code>)<br>
The end time for the log entry.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-Logger-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>Logger$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>Examples</h3>

<pre><code class="language-R">  logger &lt;- Logger$new(
    db_table = "test.table",
    timestamp = "2020-01-01 09:00:00"
  )

  logger$log_info("This is an info message")
  logger$log_to_db(message = "This is a message")

  try(logger$log_warn("This is a warning!"))
  try(logger$log_error("This is an error!"))
</code></pre>


</div>