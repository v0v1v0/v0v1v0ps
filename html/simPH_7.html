<div class="container">

<table style="width: 100%;"><tr>
<td>coxsimtvc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate time-interactive quantities of interest from Cox Proportional
Hazards models</h2>

<h3>Description</h3>

<p><code>coxsimtvc</code> simulates time-interactive relative hazards, first
differences, and hazard ratios from models estimated with <code>coxph</code>
using the multivariate normal distribution. These can be plotted with
<code>simGG</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">coxsimtvc(
  obj,
  b,
  btvc,
  qi = "Relative Hazard",
  Xj = NULL,
  Xl = NULL,
  tfun = "linear",
  pow = NULL,
  nsim = 1000,
  from,
  to,
  by = 1,
  ci = 0.95,
  spin = FALSE,
  extremesDrop = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>a <code>coxph</code> fitted model object with a time interaction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>the non-time interacted variable's name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>btvc</code></td>
<td>
<p>the time interacted variable's name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qi</code></td>
<td>
<p>character string indicating what quantity of interest you would
like to calculate. Can be <code>'Relative Hazard'</code>,
<code>'First Difference'</code>, <code>'Hazard Ratio'</code>, <code>'Hazard Rate'</code>.
Default is <code>qi = 'Relative Hazard'</code>. If <code>qi = 'First Difference'</code>
or <code>qi = 'Hazard Ratio'</code> then you can set <code>Xj</code> and <code>Xl</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xj</code></td>
<td>
<p>numeric vector of fitted values for <code>b</code>. Must be the same
length as <code>Xl</code> or <code>Xl</code> must be <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xl</code></td>
<td>
<p>numeric vector of fitted values for Xl. Must be the same length as
<code>Xj</code>. Only applies if <code>qi = 'First Difference'</code> or
<code>qi = 'Hazard Ratio'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tfun</code></td>
<td>
<p>function of time that btvc was multiplied by. Default is
"linear". It can also be "log" (natural log) and "power". If
<code>tfun = "power"</code> then the pow argument needs to be specified also.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pow</code></td>
<td>
<p>if <code>tfun = "power"</code>, then use pow to specify what power the
time interaction was raised to.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>the number of simulations to run per point in time. Default is
<code>nsim = 1000</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>point in time from when to begin simulating coefficient values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>point in time to stop simulating coefficient values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>time intervals by which to simulate coefficient values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>the proportion of simulations to keep. The default is
<code>ci = 0.95</code>, i.e. keep the middle 95 percent. If <code>spin = TRUE</code>
then <code>ci</code> is the confidence level of the shortest probability interval.
Any value from 0 through 1 may be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spin</code></td>
<td>
<p>logical, whether or not to keep only the shortest probability
interval rather than the middle simulations. Currently not supported for
hazard rates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extremesDrop</code></td>
<td>
<p>logical whether or not to drop simulated quantity of
interest values that are <code>Inf</code>, <code>NA</code>, <code>NaN</code> and
<code class="reqn">&gt; 1000000</code> for <code>spin = FALSE</code> or <code class="reqn">&gt; 800</code> for
<code>spin = TRUE</code>.
These values are difficult to plot <code>simGG</code> and may prevent
<code>spin</code> from finding the central interval.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Simulates time-varying relative hazards, first differences, and
hazard ratios using parameter estimates from <code>coxph</code> models. Can also
simulate hazard rates for multiple strata.
</p>
<p>Relative hazards are found using:
</p>
<p style="text-align: center;"><code class="reqn">RH = e^{\beta_{1} + \beta_{2}f(t)}</code>
</p>

<p>where <code class="reqn">f(t)</code> is the function of time.
</p>
<p>First differences are found using:
</p>
<p style="text-align: center;"><code class="reqn">FD = (e^{(X_{j} - X_{l}) (\beta_{1} + \beta_{2}f(t))} - 1) * 100</code>
</p>

<p>where <code class="reqn">X_{j}</code> and <code class="reqn">X_{l}</code> are some values of <code class="reqn">X</code> to
contrast.
</p>
<p>Hazard ratios are calculated using:
</p>
<p style="text-align: center;"><code class="reqn">FD = e^{(X_{j} - X_{l}) (\beta_{1} + \beta_{2}f(t))}</code>
</p>

<p>When simulating non-stratifed time-varying harzards <code>coxsimtvc</code> uses
the point estimates for a given coefficient <code class="reqn">\hat{\beta}_{x}</code> and its time interaction <code class="reqn">\hat{\beta}_{xt}</code>
along with the variance matrix (<code class="reqn">\hat{V}(\hat{\beta})</code>)
estimated from a <code>coxph</code> model. These are used to draw values of
<code class="reqn">\beta_{1}</code> and <code class="reqn">\beta_{2}</code> from the
multivariate normal distribution <code class="reqn">N(\hat{\beta},\: \hat{V}(\hat{\beta}))</code>.
</p>
<p>When simulating stratified time-varying hazard rates <code class="reqn">H</code> for a given
strata <code class="reqn">k</code>, <code>coxsimtvc</code> uses:
</p>
<p style="text-align: center;"><code class="reqn">H_{kxt} = \hat{\beta}_{k0t}e^{\hat{\beta_{1}} + \beta_{2}f(t)}</code>
</p>

<p>The resulting simulation values can be plotted using <code>simGG</code>.
</p>


<h3>Value</h3>

<p>a <code>simtvc</code> object
</p>


<h3>References</h3>

<p>Gandrud, Christopher. 2015. simPH: An R Package for Illustrating
Estimates from Cox Proportional Hazard Models Including for Interactive and
Nonlinear Effects. Journal of Statistical Software. 65(3)1-20.
</p>
<p>Golub, Jonathan, and Bernard Steunenberg. 2007. ”How Time
Affects EU Decision-Making.” European Union Politics 8(4): 555-66.
</p>
<p>Licht, Amanda A. 2011. ”Change Comes with Time: Substantive Interpretation
of Nonproportional Hazards in Event History Analysis.” Political Analysis
19: 227-43.
</p>
<p>King, Gary, Michael Tomz, and Jason Wittenberg. 2000. ”Making the Most of
Statistical Analyses: Improving Interpretation and Presentation.” American
Journal of Political Science 44(2): 347-61.
</p>
<p>Liu, Ying, Andrew Gelman, and Tian Zheng. 2013. ”Simulation-Efficient
Shortest Probability Intervals.” Arvix.
<a href="https://arxiv.org/pdf/1302.2142v1.pdf">https://arxiv.org/pdf/1302.2142v1.pdf</a>.
</p>


<h3>See Also</h3>

<p><code>simGG</code>, <code>survival</code>, <code>strata</code>,
and <code>coxph</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Load Golub &amp; Steunenberg (2007) Data
data("GolubEUPData")

# Load survival package
library(survival)

# Expand data (not run to speed processing time, but should be run)
GolubEUPData &lt;- SurvExpand(GolubEUPData, GroupVar = 'caseno',
                     Time = 'begin', Time2 = 'end', event = 'event')

# Create time interactions
BaseVars &lt;- c('qmv', 'backlog', 'coop', 'codec', 'qmvpostsea', 'thatcher')
GolubEUPData &lt;- tvc(GolubEUPData, b = BaseVars, tvar = 'end', tfun = 'log')

# Run Cox PH Model
M1 &lt;- coxph(Surv(begin, end, event) ~ qmv + qmvpostsea + qmvpostteu +
                coop + codec + eu9 + eu10 + eu12 + eu15 + thatcher +
                agenda + backlog + qmv_log + qmvpostsea_log + coop_log +
                codec_log + thatcher_log + backlog_log,
            data = GolubEUPData, ties = "efron")

# Create simtvc object for Relative Hazard
Sim1 &lt;- coxsimtvc(obj = M1, b = "qmv", btvc = "qmv_log",
                   tfun = "log", from = 80, to = 2000,
                   Xj = 1, by = 15, ci = 0.99, nsim = 100)

# Create simtvc object for First Difference
Sim2 &lt;- coxsimtvc(obj = M1, b = "qmv", btvc = "qmv_log",
                 qi = "First Difference", Xj = 1,
                 tfun = "log", from = 80, to = 2000,
                 by = 15, ci = 0.95)

# Create simtvc object for Hazard Ratio
Sim3 &lt;- coxsimtvc(obj = M1, b = "backlog", btvc = "backlog_log",
                  qi = "Hazard Ratio", Xj = c(191, 229),
                  Xl = c(0, 0),
                  tfun = "log", from = 80, to = 2000,
                  by = 15, ci = 0.5)

## End(Not run)

</code></pre>


</div>