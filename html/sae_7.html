<div class="container">

<table style="width: 100%;"><tr>
<td>ebBHF</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>EB estimators of an indicator with non-sample values of auxiliary variables.</h2>

<h3>Description</h3>

<p>Fits by REML method the unit level model of Battese, Harter and Fuller (1988) to a transformation of the specified dependent variable by a Box-Cox family or power family and obtains Monte Carlo approximations 
of EB estimators of the specified small area indicators, when the values of auxiliary variables for out-of-sample units are available.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ebBHF(formula, dom, selectdom, Xnonsample, MC = 100, data,
      transform = "BoxCox", lambda = 0, constant = 0, indicator)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class <code>formula</code> (or one that can be coerced to that class): 
a symbolic description of the model to be fitted. The details of model 
specification are given under Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dom</code></td>
<td>
<p><code>n*1</code> vector or factor (same size as <code>y</code> in <code>formula</code>) with domain codes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selectdom</code></td>
<td>
<p><code>I*1</code> optional vector or factor with the domain codes for which we 
want to estimate the indicators. It must be a subset of the domain codes in <code>dom</code>. 
If this parameter is not included, the unique domain codes included in <code>dom</code> 
are considered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xnonsample</code></td>
<td>
<p>matrix or data frame containing in the first column the domain codes and in the rest of columns the values of each of <code>p</code> auxiliary variables for the out-of-sample units in each selected domain. The domains considered in <code>Xnonsample</code> must contain at least those specified in <code>selectdom</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MC</code></td>
<td>
<p>number of Monte Carlo replicates for the empirical approximation of the EB estimator. Default value is <code>MC=100</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>optional data frame containing the variables named in <code>formula</code> and <code>dom</code>. By default the variables are taken from the environment from which <code>ebBHF</code> is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform</code></td>
<td>
<p>type of transformation for the dependent variable to be chosen between the <code>"BoxCox"</code> and <code>"power"</code> families so that the dependent variable in <code>formula</code> follows approximately a Normal distribution. Default value is <code>"BoxCox"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>value for the parameter of the family of transformations specified in <code>transform</code>. Default value is <code>0</code>, which gives the log transformation for the two possible families.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constant</code></td>
<td>
<p>constant added to the dependent variable before doing the transformation, to achieve a distribution close to Normal. Default value is <code>0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>indicator</code></td>
<td>
<p>function of the (untransformed) variable on the left hand side of <code>formula</code> that we want to estimate in each domain.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<p>This function uses random number generation. To fix the seed, use <code>set.seed</code>.
</p>
<p>A typical model has the form response ~ terms where response is the (numeric) response vector and 
terms is a series of terms which specifies a linear predictor for response. A terms specification of 
the form first + second indicates all the terms in first together with all the terms in second with 
duplicates removed. 
</p>
<p>A formula has an implied intercept term. To remove this use either y ~ x - 1 or y ~ 0 + x. See <code>formula</code> 
for more details of allowed formulae. 
</p>


<h3>Value</h3>

<p> The function returns a list with the following objects:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>eb</code></td>
<td>
<p>data frame with number of rows equal to number of selected domains,
containing in its columns the domain codes (<code>domain</code>), the EB 
estimators of <code>indicator</code> (<code>eb</code>) and the sample sizes (<code>sampsize</code>). 
For domains with zero sample size, the EB estimators are based on the synthetic regression. For domains in <code>selectdom</code> not included in <code>Xnonsample</code> the EB estimators are NA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>a list containing the following objects: 
</p>

<ul>
<li>
<p><code>summary</code>: summary of the unit level model fitting.
</p>
</li>
<li>
<p><code>fixed</code>: vector with the estimated values of the fixed regression coefficient.
</p>
</li>
<li>
<p><code>random</code>: vector with the predicted random effects.
</p>
</li>
<li>
<p><code>errorvar</code>: estimated model error variance.
</p>
</li>
<li>
<p><code>refvar</code>: estimated random effects variance.
</p>
</li>
<li>
<p><code>loglike</code>: log-likelihood.
</p>
</li>
<li>
<p><code>residuals</code>: vector with raw residuals from the model fit.
</p>
</li>
</ul>
</td>
</tr>
</table>
<p>Cases with NA values in <code>formula</code> or <code>dom</code> are ignored. 
</p>


<h3>References</h3>

 
<p>- Molina, I. and Rao, J.N.K. (2010). Small Area Estimation of Poverty Indicators. The Canadian Journal of Statistics 38, 369-385.
</p>


<h3>See Also</h3>

  <p><code>pbmseebBHF</code> </p>


<h3>Examples</h3>

<pre><code class="language-R">data(incomedata)         # Load data set
attach(incomedata)

# Construct design matrix for sample elements
Xs &lt;- cbind(age2, age3, age4, age5, nat1, educ1, educ3, labor1, labor2)

# Select the domains to compute EB estimators. 
data(Xoutsamp)
domains &lt;- unique(Xoutsamp[,"domain"])

# Poverty gap indicator
povertyline &lt;- 0.6*median(income)
povertyline                         # 6477.484
povgap &lt;- function(y)     
{
   z &lt;- 6477.484
   result &lt;- mean((y&lt;z) * (z-y) / z) 
   return (result)
}

# Compute EB predictors of poverty gap. The value constant=3600 is selected
# to achieve approximately symmetric residuals.
set.seed(123)
result &lt;- ebBHF(income ~ Xs, dom=prov, selectdom=domains,
                Xnonsample=Xoutsamp, MC=10, constant=3600, indicator=povgap)
result$eb
result$fit$summary
result$fit$fixed
result$fit$random[,1]
result$fit$errorvar
result$fit$refvar
result$fit$loglike
result$fit$residuals[1:10]

detach(incomedata)
</code></pre>


</div>