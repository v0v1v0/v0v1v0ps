<div class="container">

<table style="width: 100%;"><tr>
<td>smart_permanova</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Smart Permutational Multivariate Analysis of Variance</h2>

<h3>Description</h3>

<p>Computes Permutational Multivariate Analysis of Variance (PERMANOVA) for testing differences in group location using multivariate data. Variance partitioning computed on a sample-by-sample triangular matrix obtained from variable-by-sample data following Anderson (2001).
Calculates a range of inter-sample distances, similarities and dissimilarities.
Includes control for genetic drift for bi-allelic genetic markers such as single nucleotide polymorphisms (SNP) following Patterson, Price and Reich (2006) that can be combined with SMART Principal Component Analysis (PCA). Optimized to run fast matrix building and permutations for big datasets in ecological, evolutionary and genomic research.
</p>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>snp_data</code></td>
<td>
<p>File name read from working directory.
SNP = rows, samples = columns without row names or column headings.
SNP values must be count data (no decimals allowed).
File extension detected automatically whether text or <code>EIGENSTRAT</code>.
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>packed_data</code></td>
<td>
<p>Logical value for <code>EIGENSTRAT</code>, irrelevant for text data.
Default <code>packed_data = FALSE</code> assumes uncompressed <code>EIGENSTRAT</code>.
<code>packed_data = TRUE</code> for compressed or binary <code>EIGENSTRAT</code> (<code>PACKENDANCESTRYMAP</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_group</code></td>
<td>
<p>Character or numeric vector assigning samples to groups. Coerced to factor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_remove</code></td>
<td>
<p>Logical <code>FALSE</code> or numeric vector indicating column numbers (samples) to be removed from computations.
Default <code>sample_remove =  FALSE</code> keeps all samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>snp_remove</code></td>
<td>
<p>Logical <code>FALSE</code> or numeric vector indicating row numbers (SNPs) to be removed from computations.
Default <code>snp_remove =  FALSE</code> keeps all SNPs. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>missing_value</code></td>
<td>
<p>Number <code>9</code> or string <code>NA</code> indicating missing value.
Default <code>missing_value = 9</code> as in <code>EIGENSTRAT</code>.
If no missing values present, no effect on computation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>missing_impute</code></td>
<td>
<p>String handling missing values.
Default <code>missing_impute = "mean"</code> replaces missing values of each SNP by mean of non-missing values across samples.
<code>missing_impute = "remove"</code> removes SNPs with at least one missing value.
If no missing values present, no effect on computation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scaling</code></td>
<td>
<p>String. Default <code>scaling = "drift"</code> scales SNPs to control for expected allele frequency dispersion caused by genetic drift (SMARTPCA).
<code>scaling = "center"</code> for <code>centering</code> (covariance-based PCA).
<code>scaling = "sd"</code> for <code>centered</code> SNPs divided by standard deviation (correlation-based PCA).
<code>scaling = "none"</code> for no scaling.
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_distance</code></td>
<td>
<p>Type of inter-sample proximity computed (distance, similarity, dissimilarity).
Default is <code>Euclidean distance</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>program_distance</code></td>
<td>
<p>A string value indicating R package to estimate proximities between pairs of samples.
Default <code>program_distance = "Rfast"</code> uses function <code>Dist</code>; <code>program_distance = "vegan"</code> uses <code>vegdist</code>.
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_space</code></td>
<td>
<p>String.
Default <code>target_space = "multidimensional"</code> applies PERMANOVA to sample-by-sample triangular matrix computed from variable-by-sample data, <code>pc_axes</code> has no effect on computation.
<code>target_space = "pca"</code> applies PERMANOVA to sample-by-sample data in PCA space, <code>pc_axes</code> determines number of PCA axes for testing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pc_axes</code></td>
<td>
<p>Number of PCA axes computed always starting with PCA axis 1. Default <code>pc_axes = 2</code> computes PCA axes 1 and 2 if <code>target_space = "pca"</code>.
No effect on computation if <code>target_space = "multidimensional"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pairwise</code></td>
<td>
<p>Logical.
Default <code>pairwise = FALSE</code> computes global test.
<code>pairwise = TRUE</code> computes global and pairwise tests.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pairwise_method</code></td>
<td>
<p>String specifying type of correction for multiple testing.
Default <code>"holm"</code>.
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>permutation_n</code></td>
<td>
<p>Number of permutations resulting in PERMANOVA test <em>p value</em>.
Default <code>9999</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>permutation_seed</code></td>
<td>
<p>Number fixing random generator of permutations.
Default <code>1</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>PERMANOVA is a form of linear modelling that partitions variation in a triangular matrix of inter-sample proximities obtained from variable-by-sample data.
Uses permutations to estimate the probability of observed group differences in SNP composition given a null hypothesis of no differences between groups (Anderson 2001).
Proximity between samples can be any type of distance, similarity or dissimilarity.
Original acronym <code>NPMANOVA</code> (Non-Parametric MANOVA) replaced with PERMANOVA (Anderson 2004, 2017).<br></p>
<p>Univariate ANOVA captures differences in mean and variance referred to as location and dispersion in PERMANOVA's multivariate context (Anderson &amp; Walsh 2013, Warton, Wright and Wang 2012).
To attribute group differences to location (position of sample groups) and/or dispersion (spread of sample groups), PERMANOVA must be combined with PERMDISP as implemented through <code>smart_permdisp</code>.<br></p>
<p>Function <code>smart_permanova</code> uses <code>adonis</code> to fit formula <code>snp_eucli ~ sample_group</code>, where <code>snp_eucli</code> is the sample-by-sample triangular matrix in Principal Coordinate Analysis (Gower 1966) space.
Current version restricted to one-way designs (one categorical predictor) though PERMANOVA can handle &gt;1 crossed and/or nested factors (Anderson 2001) and continuous predictors (McArdle &amp; Anderson 2001).
If &gt;2 sample groups tested, <code>pairwise = TRUE</code> allows pairwise testing and correction for multiple testing by <code>holm (Holm)</code> [default], <code>hochberg (Hochberg)</code>, <code>hommel (Hommel)</code>, <code>bonferroni (Bonferroni)</code>, <code>BY (Benjamini-Yekuieli)</code>, <code>BH (Benjamini-Hochberg)</code> or <code>fdr (False Discovery Rate)</code>.<br></p>
<p>For big data, <code>Dist</code> builds sample-by-sample triangular matrix much faster than <code>vegdist</code>.
<code>Dist</code> computes proximities <code>euclidean</code>, <code>manhattan</code>, <code>canberra1</code>, <code>canberra2</code>, <code>minimum</code>, <code>maximum</code>, <code>minkowski</code>, <code>bhattacharyya</code>, <code>hellinger</code>, <code>kullback_leibler</code> and <code>jensen_shannon</code>. <code>vegdist</code> computes <code>manhattan</code>, <code>euclidean</code>, <code>canberra</code>, <code>clark</code>, <code>bray</code>, <code>kulczynski</code>, <code>jaccard</code>, <code>gower</code>, <code>altGower</code>, <code>morisita</code>, <code>horn</code>, <code>mountford</code>, <code>raup</code>, <code>binomial</code>, <code>chao</code>, <code>cao</code> and <code>mahalanobis</code>.
Euclidean distance required for SMARTPCA scaling.<br></p>
<p><code>sample_remove</code> should include both samples removed from PCA and ancient samples projected onto PCA space (if any).<br></p>
<p>Data read from working directory with SNPs as rows and samples as columns.
Two alternative formats: (1) text file of SNPs by samples (file extension and column separators recognized automatically) read using <code>fread</code>; or (2) duet of <code>EIGENSTRAT</code> files (see <a href="https://reich.hms.harvard.edu/software">https://reich.hms.harvard.edu/software</a>) using <code>vroom_fwf</code>, including a genotype file of SNPs by samples (<code>*.geno</code>), and a sample file (<code>*.ind</code>) containing three vectors assigning individual samples to unique user-predefined groups (populations), sexes (or other user-defined descriptor) and alphanumeric identifiers.
For <code>EIGENSTRAT</code>, vector <code>sample_group</code> assigns samples to groups retrievable from column 3 of file <code>*.ind</code>.
SNPs with zero variance removed prior to SVD to optimize computation time and avoid undefined values if <code>scaling = "sd"</code> or <code>"drift"</code>.<br></p>
<p>Users can select subsets of samples or SNPs by introducing a vector including column numbers for samples (<code>sample_remove</code>) and/or row numbers for SNPs (<code>snp_remove</code>) to be removed from computations.
Function stops if the final number of SNPs is 1 or 2.
<code>EIGENSOFT</code> was conceived for the analysis of human genes and its SMARTPCA suite so accepts 22 (autosomal) chromosomes by default.
If &gt;22 chromosomes are provided and the internal parameter <code>numchrom</code> is not set to the target number chromosomes of interest, SMARTPCA automatically subsets chromosomes 1 to 22.
In contrast, <code>smart_permanova</code> accepts any number of autosomes with or without the sex chromosomes from an <code>EIGENSTRAT</code> file.<br></p>


<h3>Value</h3>

<p>Returns a list containing the following elements:
</p>

<ul>
<li>
<p>permanova.samplesDataframe showing sample summary.
Column <em>Group</em> assigns samples to tested groups.
Column <em>Class</em> specifies if samples were used in, or removed from, testing.
</p>
</li>
<li>
<p>permanova.global_testList showing table with degrees of freedom, sum of squares, mean sum of squares, <em>F</em> statistic, variance explained (<em>R2</em>) and <em>p</em> value.
</p>
</li>
<li>
<p>permanova.pairwise_testList showing table <em>F</em> statistic, variance explained (<em>R2</em>), <em>p</em> value and corrected <em>p</em> value per pair of groups.
Obtained only if <code>pairwise = TRUE</code>.
</p>
</li>
<li>
<p>permanova.pairwise_correctionString indicating type of correction for multiple testing.
</p>
</li>
<li>
<p>permanova.permutation_numberNumber of permutations applied to obtain the distribution of <em>p value</em>.
</p>
</li>
<li>
<p>permanova.permutation_seedNumber fixing random generator of permutations for reproducibility of results.
</p>
</li>
</ul>
<h3>References</h3>

<p>Anderson, M. J. (2001) A new method for non-parametric multivariate analysis of variance. Austral Ecology, 26, 32-46.<br>
Anderson, M. J. (2004). PERMANOVA_2factor: a FORTRAN computer program for permutational multivariate analysis of variance (for any two-factor ANOVA design) using permutation tests  (Department of Statistics, University of Auckland, New Zealand).<br>
Anderson, M. J. &amp; D. C. I. Walsh (2013) PERMANOVA, ANOSIM, and the Mantel test in the face of heterogeneous dispersions: What null hypothesis are you testing? Ecological Monographs, 83, 557-574.<br>
Gower, J. C. (1966) Some distance properties of latent root and vector methods used in multivariate analysis. Biometrika, 53, 325-338.<br>
McArdle, B. H. &amp; M. J. Anderson (2001) Fitting multivariate models to community data: a comment on distance-based redundancy analysis. Ecology, 82, 290-297.<br>
Patterson, N., A. L. Price and D. Reich (2006) Population structure and eigenanalysis. PLoS Genetics, 2, e190.<br>
Warton, D. I., S. T. Wright and Y. Wang (2012) Distance-based multivariate analyses confound location and dispersion effects. Methods in Ecology and Evolution, 3, 89-101.
</p>


<h3>See Also</h3>

<p><code>adonis</code> (package <b>vegan</b>),
<code>Dist</code> (package <b>Rfast</b>),
<code>fread</code> (package <b>data.table</b>),
<code>vegdist</code> (package <b>vegan</b>),
<code>vroom_fwf</code> (package <b>vroom</b>)
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Path to example genotype matrix "dataSNP"
pathToGenoFile = system.file("extdata", "dataSNP", package = "smartsnp")

# Assign 50 samples to each of two groups
my_groups &lt;- as.factor(c(rep("A", 50), rep("B", 50)))

# Run PERMANOVA
permanovaR &lt;- smart_permanova(snp_data = pathToGenoFile, sample_group = my_groups)

# Extract summary table assigning samples to groups
permanovaR$permanova.samples

# Extract PERMANOVA table
permanovaR$permanova.global_test

# Plot means of squares per group
#run pca with truncated SVD (PCA 1 x PCA 2)
pcaR1 &lt;- smart_pca(snp_data = pathToGenoFile, sample_group = my_groups)
#compute Euclidean inter-sample distances in PCA space (triangular matrix)
snp_eucli &lt;- vegan::vegdist(pcaR1$pca.sample_coordinates[,c("PC1","PC2")], method = "euclidean")
#run PERMANOVA
permanova &lt;- vegan::adonis(formula = snp_eucli ~ my_groups, permutations = 9999)
#extract meanSqs (groups versus residuals)
meanSqs &lt;- as.matrix(t(permanova$aov.tab$MeanSqs[1:2]))
colnames(meanSqs) &lt;- c("Groups", "Residuals")
#two horizontal plots
oldpar &lt;- par(mfrow = c(2,1), oma = c(0,5,0.1,0.1), lwd = 2)
barplot(meanSqs, horiz = TRUE, main = "PERMANOVA mean of squares",
  cex.names = 2, cex.main = 2, col = c("grey40"))
#run ANOSIM
anosimD &lt;- vegan::anosim(snp_eucli, my_groups, permutations = 999)
#remove outputs for clean plotting
#anosimD[2] &lt;- ""; anosimD[5] &lt;- ""
par(mar = c(5, 0.1, 3.5, 0.1))
plot(anosimD, xlab = "", ylab = "distance/similarity ranks",
  main = "Inter-sample proximity ranks", cex.main =2, cex.axis = 2,
  col = c("cyan", "red", "blue"))
par(oldpar)

</code></pre>


</div>