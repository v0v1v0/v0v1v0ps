<div class="container">

<table style="width: 100%;"><tr>
<td>poissonize</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Transform survival data for fitting a Poisson model
</h2>

<h3>Description</h3>

<p>This function transform survival data into a format compatible with
the <code>glm()</code> function for fitting an auxiliary Poisson model,
providing the parameter estimates of the associated proportional hazard model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">poissonize(data,
           all.breaks = NULL, interval.width = NULL, nInts = 8,
           factors = NULL, compress = TRUE)
plotsson(x, type = c('survival', 'hazard'),
         add = FALSE, xscale = 1, by, col, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>a data frame with columns:
</p>

<ul>
<li>
<p> id       : the patient identifier
</p>
</li>
<li>
<p> time     : the event/censoring time
</p>
</li>
<li>
<p> status   : the event(1) or censoring(0) indicator
</p>
</li>
<li>
<p> ...      : other factors such like the covariables needed
in the regression model   
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all.breaks</code></td>
<td>

<p>the breakpoints between time intervals
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interval.width</code></td>
<td>

<p>the width of the time intervals on which the risks will be assumed constant,
in case of intervals of the same length.
This parameter is ignored if <code>all.breaks</code> is specified
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nInts</code></td>
<td>

<p>the number of intervals containing the same expected number of events
(used only if <code>is.null(interval.width)</code>, see Details).
This parameter is ignored if either <code>all.breaks</code>
or <code>interval.width</code> is specified
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factors</code></td>
<td>

<p>a vector of characters, containing the names of the factors
to be kept in the transformed data set
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compress</code></td>
<td>

<p>a logical, indicating whether the record with the same
factor profile should be summarized into one record,
i.e. whether the data should be expressed in a short form
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>The fitted Poisson model on the poissonized data
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>

<p>the type of plot, either 'haz' for the hazard function
or 'Surv', for the survival curve
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add</code></td>
<td>

<p>should the plot added to the active device?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xscale</code></td>
<td>

<p>scaling factor for the time (x) axis
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>

<p>covariate for which a different curve per level has to be plotted
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col, ...</code></td>
<td>

<p>other graphical parameters
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If <code>interval.width</code> is not null, the study period is divided into
equal-length intervals of length <code>interval.width</code>.
Otherwise, <code>nInts</code> intervals are used, and the location of their bounds
is computed based on the empirical quantiles of the survival function.
</p>


<h3>Note</h3>

<p>This code is hugely inspired by original code made publicly available by Stephanie Kovalchik.
</p>


<h3>Author(s)</h3>

<p>NA
</p>


<h3>References</h3>

<p>Whitehead, J.
Fitting Cox's regression model to survival
data using GLIM.
<em>J Roy Stat Soc C Appl Stat</em> 1980; <b>29</b>(3):268-275.
<a href="https://www.jstor.org/stable/2346901">https://www.jstor.org/stable/2346901</a>.
</p>
<p>Crowther MJ, Riley RD, Staessen JA, Wang J, Gueyffier F, Lambert PC.
Individual patient data meta-analysis of survival data
using Poisson regression models.
<em>BMC Medical Research Methodology</em> 2012; <b>12</b>:34.
doi: <a href="https://doi.org/10.1186/1471-2288-12-34">10.1186/1471-2288-12-34</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">################################################################################
# Example 1 - KIDNEY data                                                      #
################################################################################
library(survival)
data(kidney)
kidney &lt;- kidney[1:(nrow(kidney)/2)*2,]
head(kidney) 

par(mfrow=c(1, 3))
for (int in c(50, 20, 10)) {
    head(wdata1 &lt;- poissonize(kidney, interval.width = int, 
                              factors = c('disease'), compress = FALSE))
    head(wdata2 &lt;- poissonize(kidney, interval.width = int, 
                              factors = c('disease'), compress = TRUE))
    
    fitcox &lt;- (coxph(Surv(time, status) ~ disease, data = kidney))
    fitpoi1 &lt;- glm(event ~ -1 + interval + disease + offset(log(time)),
                   data = wdata1, family = 'poisson')
    fitpoi2 &lt;- glm(m ~ -1 + interval + offset(log(Rt)) + disease,
                   data = wdata2, family = 'poisson')
    cox.base &lt;- basehaz(fitcox, centered = FALSE)
    plot(stepfun(cox.base$time[-nrow(cox.base)], exp(-cox.base$hazard)),
         ylim = 0:1, xlim = c(0, max(cox.base$time)),
         do.points = FALSE, verticals = FALSE, xaxs = 'i',
         main = paste0('KIDNEY data set\nInterval width = ', int),
         xlab = 'Time', ylab = 'Survival probability')
    plotsson(fitpoi1, 'Surv', add = TRUE, col = 2, lty = 2)
    plotsson(fitpoi2, 'Surv', add = TRUE, col = 3, lty = 3) 
    legend('topright', col = 1:3, lty = 1:3,
           legend = c('Breslow (Cox)', 'Poisson',
                      'Poisson (compressed dataset)'))
}
print(cbind(Cox                = coef(fitcox),
            Poisson            = rev(rev(coef(fitpoi1))[1:3]),
            Poisson_Compressed = rev(rev(coef(fitpoi2))[1:3])), digits = 2)



################################################################################
#  Example 2 - COLON data                                                      #
################################################################################
library(survival)
data(colon)
head(wdata1 &lt;- poissonize(subset(colon, etype == 1), interval.width = 365.25, 
                          factors=c('surg', 'sex', 'age'), compress = FALSE))
head(wdata2 &lt;- poissonize(subset(colon, etype == 1), interval.width = 365.25, 
                          factors=c('surg', 'sex', 'age'), compress = TRUE))

fitcox &lt;- coxph(Surv(time, status) ~ surg + sex + age, 
                data = subset(colon, etype == 1))

system.time({
    fitpoi1 &lt;- glm(event ~ -1 + interval + surg + sex + age + offset(log(time)),
                   data = wdata1, fam = 'poisson')
})
system.time({
    fitpoi2 &lt;- glm(m ~ -1 + interval + offset(log(Rt)) + surg + sex + age,
                   data = wdata2, family = 'poisson')
})
{
    cox.base &lt;- basehaz(fitcox, centered = FALSE)
    par(mfrow = c(1, 1))
    plot(stepfun(cox.base$time[-nrow(cox.base)], exp(-cox.base$hazard)),
         ylim = 0:1, xlim = c(0, max(cox.base$time)),
         do.points = FALSE, verticals = FALSE, xaxs = 'i',
         main = 'COLON data set', xlab = 'Time', ylab = 'Survival probability')
    plotsson(fitpoi1, 'Surv', add = TRUE, col = 2, lty = 2) 
    plotsson(fitpoi2, 'Surv', add = TRUE, col = 3, lty = 3) 
    legend('topright', col = 1:3, lty = 1:3,
           legend = c('Cox', 'Poisson', 'Poisson (compressed dataset)'))
}
print(cbind(Cox                = coef(fitcox),
            Poisson            = rev(rev(coef(fitpoi1))[1:3]),
            Poisson_Compressed = rev(rev(coef(fitpoi2))[1:3])), digits = 2)



################################################################################
#  Example 3 - LUNG data                                                       #
################################################################################
library(survival)
data(lung)
lung$status &lt;- lung$status - 1
lung$id &lt;- 1:nrow(lung)
head(wdata1 &lt;- poissonize(lung, interval.width = 365.25/12, 
                          factors = c('pat.karno', 'sex', 'age'), 
                          compress = FALSE))
head(wdata2 &lt;- poissonize(lung, interval.width = 365.25/12,
                          factors = c('pat.karno', 'sex', 'age'),
                          compress = TRUE))

fitcox &lt;- coxph(Surv(time, status) ~ pat.karno + sex + age, data = lung)

system.time({
    fitpoi1 &lt;- glm(event ~ -1 + interval + pat.karno + sex + age + 
                              offset(log(time)),
                   data = wdata1, family = 'poisson')
})
system.time({
    fitpoi2 &lt;- glm(m ~ -1 + interval + pat.karno + sex + age + offset(log(Rt)),
                   data = wdata2, family = 'poisson')
})
{
    cox.base &lt;- basehaz(fitcox, centered = FALSE)
    plot(stepfun(cox.base$time[-nrow(cox.base)], exp(-cox.base$hazard)),
         ylim = 0:1, xlim = c(0, max(cox.base$time)),
         do.points = FALSE, verticals = FALSE, xaxs = 'i',
         main = 'LUNG data set', xlab = 'Time', ylab = 'Survival probability')
    plotsson(fitpoi1, 'Surv', add = TRUE, col = 2, lty = 2) 
    plotsson(fitpoi2, 'Surv', add = TRUE, col = 3, lty = 3) 
    legend('topright', col = 1:3, lty = 1:3,
           legend = c('Cox', 'Poisson', 'Poisson (compressed dataset)'))
}
print(cbind(Cox                = coef(fitcox),
            Poisson            = rev(rev(coef(fitpoi1))[1:3]),
            Poisson_Compressed = rev(rev(coef(fitpoi2))[1:3])), digits = 2)

</code></pre>


</div>