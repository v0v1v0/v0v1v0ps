<div class="container">

<table style="width: 100%;"><tr>
<td>slope.com</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Common slope test amongst several allometric lines </h2>

<h3>Description</h3>

<p>Test if several major axis or standardised major axis lines share a common slope. This can now be done via <code>sma(y~x*groups)</code>, see help on the <code>sma</code> function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">slope.com(y, x, groups, method = 'SMA', alpha = 0.05, 
   data = NULL, intercept = TRUE, robust=FALSE,
   V = array(0, c(2, 2, length(unique(groups)))), 
   group.names = sort(unique(groups)),
   ci = TRUE, bs = TRUE, slope.test=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p> The Y-variable for all observations (as a vector) </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p> The X-variable for all observations (as a vector) </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups</code></td>
<td>
<p> Coding variable identifying which group each observation belongs to (as a factor or vector) </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p> The line fitting method:
</p>

<dl>
<dt>'SMA' or 1</dt>
<dd>
<p>standardised major axis (this is the default)</p>
</dd>
<dt>'MA' or 2</dt>
<dd>
<p>major axis</p>
</dd>
<dt>'lamest' or 3</dt>
<dd>
<p>Error variance ratio is estimated from the data</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p> The desired confidence level for the 100(1-alpha)% confidence interval for the common slope. (Default value is 0.05, which returns a 95% confidence interval.) </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p> Deprecated. Use with() instead (see Examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p> (logical) Whether or not the line includes an  intercept.
</p>

<dl>
<dt>FALSE</dt>
<dd>
<p> no intercept, so the line is forced through the origin </p>
</dd>
<dt>TRUE</dt>
<dd>
<p> an intercept is fitted (this is the default) </p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>robust</code></td>
<td>
<p>If TRUE, uses a robust method to fit the lines and construct the test statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>V</code></td>
<td>
<p> The estimated variance matrices of measurement error, for each group. This is a 3-dimensional array with measurement error in Y in the first row and column, error in X in the second row and column, and groups running along the third dimension. Default is that there is no measurement error. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group.names</code></td>
<td>
<p> (optional: rarely required). A vector containing the labels for ‘groups’. (Only actually useful for reducing computation time in simulation work). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p> (logical) Whether or not to return a confidence interval for the common slope. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bs</code></td>
<td>
<p> (logical) Whether or not to return the slopes for the separate groups, with confidence intervals. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slope.test</code></td>
<td>
<p>If a value provided, tests the common slope fit against this value.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For several bivariate groups of observations, this function tests if the line-of-best-fit has a common slope for all samples, when the line-of-best-fit is estimated using the major axis, standardised major axis, or a more general version of these methods in which the error variance ratio is estimated from the data.
</p>
<p>The test assumes the following:
</p>

<ol>
<li>
<p> each group of observations was independently sampled
</p>
</li>
<li>
<p> y and x are linearly related within each group
</p>
</li>
<li>
<p> residuals independently follow a normal distribution with equal variance at all points along the line, within each group
</p>
</li>
</ol>
<p>Note that we do not need to assume equal variance across groups, unlike in the standard test for common slope for linear regression.
</p>
<p>The assumptions can be visually checked by plotting residual scores against fitted axis scores, and by constructing a Q-Q plot of residuals against a normal distribution, available using the <code>plot.sma</code> function.
</p>
<p>Setting <code>robust=TRUE</code> fits lines using Huber's M estimation, and modifies the test statistic as proposed in Taskinen &amp; Warton (in review).
</p>
<p>The common slope is estimated from a maximum of 100 iterations, convergence is reached when the change in b is <code class="reqn">&lt; 10^{-6}</code>.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lr </code></td>
<td>
<p>The (Bartlett-corrected) likelihood ratio statistic testing for common slope</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p </code></td>
<td>
<p>The P-value of the test. This is calculated assuming that lr has a chi-square distribution with (g-1) df, if there are g groups</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b </code></td>
<td>
<p>The common slope estimate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varb </code></td>
<td>
<p>The sample variance of the common slope</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci </code></td>
<td>
<p>A 100(1-alpha)% confidence interval for the common slope</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda </code></td>
<td>
<p>The error variance ratio - the ratio of error variance in y to error variance in x. For MA, this is assumed to be 1. for SMA, this is assumed to be <code class="reqn">b^2</code>. For the ‘lamest’ method, the error variance ratio is estimated from the data under the common slope assumption.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bs </code></td>
<td>
<p>The slopes and confidence intervals for data from each group.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Warton, D.I.<a href="mailto:David.Warton@unsw.edu.au">David.Warton@unsw.edu.au</a>, J. Ormerod, &amp; S. Taskinen</p>


<h3>References</h3>

<p> Warton D. I. and Weber N. C. (2002) Common slope tests for bivariate structural relationships.  <em>Biometrical Journal</em> <b>44</b>, 161–174.
</p>
<p>Warton D. I., Wright I. J., Falster D. S. and Westoby M. (2006) A review of bivariate line-fitting methods for allometry.  <em>Biological Reviews</em> <b>81</b>, 259–291.
</p>
<p>Taskinen, S. and D.I. Warton. in review. Robust tests for one or more allometric lines.
</p>


<h3>See Also</h3>

 <p><code>sma</code>, <code>line.cis</code>, <code>elev.com</code>, <code>shift.com</code> </p>


<h3>Examples</h3>

<pre><code class="language-R">#load leaf longevity data
data(leaflife)

#plot the data, with different symbols for different groups.
plot(leaflife$lma, leaflife$longev, type='n', log='xy', xlab=
   'leaf mass per area [log scale]', ylab='leaf longevity [log scale]')
colours &lt;- c('blue', 'red', 'green', 'yellow')
points(leaflife$lma, leaflife$longev,
   col=colours[as.numeric(leaflife$site)])
legend(55, 5, as.character(unique(leaflife$site)), col=colours,
   pch=rep(1,4))

#test for common SMA slope of log(leaf longevity) vs log(LMA),
#across species sampled at different sites:
fit &lt;- with(leaflife, slope.com(log10(longev), log10(lma), site))
fit

#Residual vs fits plots for SMA fit of each site
y &lt;- log10(leaflife$longev)
x &lt;- log10(leaflife$lma)
site &lt;- leaflife$site
par( mfrow=c(2,2) )
plot(y[site==1] + fit$bs[1,1] * x[site==1], y[site==1] - fit$bs[1,1] 
   * x[site==1], xlab='fits (site 1)', ylab='residuals (site 1)')
plot(y[site==2] + fit$bs[1,2] * x[site==2], y[site==2] - fit$bs[1,2]
   * x[site==2], xlab='fits (site 2)', ylab='residuals (site 2)')
plot(y[site==3] + fit$bs[1,3] * x[site==3], y[site==3] - fit$bs[1,3]
   * x[site==3], xlab='fits (site 3)', ylab='residuals (site 3)')
plot(y[site==4] + fit$bs[1,4] * x[site==4], y[site==4] - fit$bs[1,4]
   * x[site==4], xlab='fits (site 4)', ylab='residuals (site 4)')

#Test for common SMA slope amongst species at low rainfall sites
#with different levels of soil nutrients
leaf.low.rain &lt;- leaflife[leaflife$rain=='low',]
with(leaf.low.rain, slope.com(log10(longev), log10(lma), soilp))

#test for common MA slope:
with(leaflife, slope.com(log10(longev), log10(lma), site, method='MA'))

#test for common MA slope, and produce a 90% CI for the common slope:
with(leaflife, slope.com(log10(longev), log10(lma), site,  method='MA', alpha=0.1))

</code></pre>


</div>