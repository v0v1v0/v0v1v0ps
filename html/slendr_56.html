<div class="container">

<table style="width: 100%;"><tr>
<td>ts_ibd</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Collect Identity-by-Descent (IBD) segments (EXPERIMENTAL)</h2>

<h3>Description</h3>

<p>This function iterates over a tree sequence and returns IBD tracts between
pairs of individuals or nodes
</p>


<h3>Usage</h3>

<pre><code class="language-R">ts_ibd(
  ts,
  coordinates = FALSE,
  within = NULL,
  between = NULL,
  squash = FALSE,
  minimum_length = NULL,
  maximum_time = NULL,
  sf = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ts</code></td>
<td>
<p>Tree sequence object of the class <code>slendr_ts</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coordinates</code></td>
<td>
<p>Should coordinates of all detected IBD tracts be reported?
If <code>FALSE</code> (the default), only the total length of shared IBD segments
and their numbers are reported. If <code>TRUE</code>, coordinates of each segment
will be returned (but note that this can have a massive impact on memory
usage). See details for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>within</code></td>
<td>
<p>A character vector with individual names or an integer vector with
node IDs indicating a set of nodes within which to look for IBD segments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>between</code></td>
<td>
<p>A list of lists of character vectors with individual names or
integer vectors with node IDs, indicating a set of nodes between which to
look for shared IBD segments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>squash</code></td>
<td>
<p>Should adjacent IBD segments for pairs of nodes be squashed if they
only differ by their 'genealogical paths' but not by their MRCA? Default is
<code>FALSE</code>. For more context, see <a href="https://github.com/tskit-dev/tskit/issues/2459">https://github.com/tskit-dev/tskit/issues/2459</a>.
This option is EXPERIMENTAL!</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minimum_length</code></td>
<td>
<p>Minimum length of an IBD segment to return in results.
This is useful for reducing the total amount of IBD returned (but see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maximum_time</code></td>
<td>
<p>Oldest MRCA of a node to be considered as an IBD ancestor
to return that IBD segment in results. This is useful for reducing the total
amount of IBD returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sf</code></td>
<td>
<p>If IBD segments in a spatial tree sequence are being analyzed, should
the returned table be a spatial sf object? Default is <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is considered experimental. For full control over IBD segment
detection in tree-sequence data, users can (and perhaps, for the time being,
should) rely on the tskit method <code>ibd_segments</code>
(see <a href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.TreeSequence.ibd_segments">https://tskit.dev/tskit/docs/stable/python-api.html#tskit.TreeSequence.ibd_segments</a>).
</p>
<p>Iternally, this function leverages the tskit <code>TreeSequence</code> method
<code>ibd_segments</code>. However, note that the <code>ts_ibd</code> function always
returns a data frame of IBD tracts, it does not provide an option to iterate
over individual IBD segments as shown in the official tskit documentation
at <a href="https://tskit.dev/tskit/docs/stable/ibd.html">https://tskit.dev/tskit/docs/stable/ibd.html</a>. In general, R handles
heavy iteration poorly, and this function does not attempt to serve as
a full wrapper to <code>ibd_segments</code>.
</p>
<p>Unfortunately, the distinction between "squashed IBD" (what many would consider
to be the expected definition of IBD) and tskitâ€™s IBD which is defined via
distinct genealogical paths (see <a href="https://github.com/tskit-dev/tskit/issues/2459">https://github.com/tskit-dev/tskit/issues/2459</a>
for a discussion of the topic), makes the meaning of the filtering parameter
of the <code>ibd_segments()</code> method of tskit <code>minimum_length</code> somewhat
unintuitive. As of this moment, this function argument filters on IBD segments
on the tskit level, not the level of the squashed IBD segments!
</p>


<h3>Value</h3>

<p>A data frame with IBD results (either coordinates of each IBD segment
shared by a pair of nodes, or summary statistics about the total IBD sharing
for that pair)
</p>


<h3>Examples</h3>

<pre><code class="language-R">
init_env()

# load an example model with an already simulated tree sequence
slendr_ts &lt;- system.file("extdata/models/introgression_slim.trees", package = "slendr")
model &lt;- read_model(path = system.file("extdata/models/introgression", package = "slendr"))

# load the tree-sequence object from disk
ts &lt;- ts_load(slendr_ts, model)

# find IBD segments between specified Neanderthals and Europeans
ts_ibd(
  ts,
  coordinates = TRUE,
  between = list(c("NEA_1", "NEA_2"), c("EUR_1", "EUR_2")),
  minimum_length = 40000
)
</code></pre>


</div>