<div class="container">

<table style="width: 100%;"><tr>
<td>sits_cube</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create data cubes from image collections</h2>

<h3>Description</h3>

<p>Creates a data cube based on spatial and temporal restrictions
in collections available in cloud services or local repositories.
The following cloud providers are supported, based on the STAC protocol:
Amazon Web Services (AWS), Brazil Data Cube (BDC),
Digital Earth Africa (DEAFRICA), Microsoft Planetary Computer (MPC),
Nasa Harmonized Landsat/Sentinel (HLS), USGS Landsat (USGS), and
Swiss Data Cube (SDC). Data cubes can also be created using local files.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sits_cube(source, collection, ...)

## S3 method for class 'sar_cube'
sits_cube(
  source,
  collection,
  ...,
  orbit = "ascending",
  bands = NULL,
  tiles = NULL,
  roi = NULL,
  start_date = NULL,
  end_date = NULL,
  platform = NULL,
  multicores = 2,
  progress = TRUE
)

## S3 method for class 'stac_cube'
sits_cube(
  source,
  collection,
  ...,
  bands = NULL,
  tiles = NULL,
  roi = NULL,
  start_date = NULL,
  end_date = NULL,
  platform = NULL,
  multicores = 2,
  progress = TRUE
)

## S3 method for class 'local_cube'
sits_cube(
  source,
  collection,
  ...,
  data_dir,
  vector_dir = NULL,
  tiles = NULL,
  bands = NULL,
  vector_band = NULL,
  start_date = NULL,
  end_date = NULL,
  labels = NULL,
  parse_info = NULL,
  version = "v1",
  delim = "_",
  multicores = 2L,
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>source</code></td>
<td>
<p>Data source (one of <code>"AWS"</code>, <code>"BDC"</code>,
<code>"DEAFRICA"</code>, <code>"MPC"</code>, <code>"SDC"</code>,
<code>"USGS"</code> - character vector of length 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>collection</code></td>
<td>
<p>Image collection in data source
(character vector of length 1).
To find out the supported collections,
use <code>sits_list_collections()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other parameters to be passed for specific types.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>orbit</code></td>
<td>
<p>Orbit name ("ascending", "descending") for SAR cubes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bands</code></td>
<td>
<p>Spectral bands and indices to be included
in the cube (optional - character vector).
Use <code>sits_list_collections()</code> to find out
the bands available for each collection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tiles</code></td>
<td>
<p>Tiles from the collection to be included in
the cube (see details below)
(character vector of length 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roi</code></td>
<td>
<p>Region of interest (either an sf object, shapefile,
or a numeric vector with named XY values
("xmin", "xmax", "ymin", "ymax") or
named lat/long values
("lon_min", "lat_min", "lon_max", "lat_max").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start_date, end_date</code></td>
<td>
<p>Initial and final dates to include
images from the collection in the cube (optional).
(Date in YYYY-MM-DD format).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>platform</code></td>
<td>
<p>Optional parameter specifying the platform in case
of collections that include more than one satellite
(character vector of length 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>multicores</code></td>
<td>
<p>Number of workers for parallel processing
(integer, min = 1, max = 2048).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>Logical: show a progress bar?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_dir</code></td>
<td>
<p>Local directory where images are stored
(for local cubes - character vector of length 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vector_dir</code></td>
<td>
<p>Local director where vector files are stored
(for local vector cubes - character vector of length 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vector_band</code></td>
<td>
<p>Band for vector cube ("segments", "probs", "class")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>Labels associated to the classes
(Named character vector for cubes of
classes "probs_cube" or "class_cube").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parse_info</code></td>
<td>
<p>Parsing information for local files
(for local cubes - character vector).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>version</code></td>
<td>
<p>Version of the classified and/or labelled files.
(for local cubes - character vector of length 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delim</code></td>
<td>
<p>Delimiter for parsing local files
(single character)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>tibble</code> describing the contents of a data cube.
</p>


<h3>Note</h3>


<p>To create cubes from cloud providers, users need to inform:
</p>

<ol>
<li> <p><code>source</code>: One of "AWS", "BDC", "DEAFRICA", "HLS", "MPC",
"SDC" or "USGS";
</p>
</li>
<li> <p><code>collection</code>: Collection available in the cloud provider.
Use <code>sits_list_collections()</code> to see which
collections are supported;
</p>
</li>
<li> <p><code>tiles</code>: A set of tiles defined according to the collection
tiling grid;
</p>
</li>
<li> <p><code>roi</code>: Region of interest. Either
a named <code>vector</code> (<code>"lon_min"</code>, <code>"lat_min"</code>,
<code>"lon_max"</code>, <code>"lat_max"</code>) in WGS84, a <code>sfc</code>
or <code>sf</code> object from sf package in WGS84 projection.
</p>
</li>
</ol>
<p>Either <code>tiles</code> or  <code>roi</code> must be informed.
The parameters <code>bands</code>, <code>start_date</code>, and
<code>end_date</code> are optional for cubes created from cloud providers.
</p>
<p>GeoJSON geometries (RFC 7946) and shapefiles should be converted to
<code>sf</code> objects before being used to define a region of interest.
This parameter does not crop a region; it only selects images that
intersect the <code>roi</code>.
</p>
<p>To create a cube from local files, users need to inform:
</p>

<ol>
<li> <p><code>source</code>: Provider from where the data has been downloaded
(e.g, "BDC");
</p>
</li>
<li> <p><code>collection</code>: Collection where the data has been extracted from.
(e.g., "SENTINEL-2-L2A" for the Sentinel-2 MPC collection level 2A);
</p>
</li>
<li> <p><code>data_dir</code>: Local directory where images are stored.
</p>
</li>
<li> <p><code>parse_info</code>: Parsing information for files.
Default is <code>c("X1", "X2", "tile", "band", "date")</code>.
</p>
</li>
<li> <p><code>delim</code>: Delimiter character for parsing files.
Default is <code>"_"</code>.
</p>
</li>
</ol>
<p>To create a cube from local files, all images should have
the same spatial resolution and projection and each file should contain
a single image band for a single date.
Files can belong to different tiles of a spatial reference system and
file names need to include tile, date, and band information.
For example: <code>"CBERS-4_WFI_022024_B13_2018-02-02.tif"</code>
and <code>"SENTINEL-2_MSI_20LKP_B02_2018-07-18.jp2"</code> are accepted names.
The user has to provide parsing information to allow <code>sits</code>
to extract values of tile, band, and date. In the examples above,
the parsing info is c("X1", "X2", "tile", "band", "date")
and the delimiter is "_", which are the default values.
</p>
<p>It is also possible to create result cubes for these are local files
produced by classification or post-classification algorithms. In
this case, more parameters that are required (see below). The
parameter <code>parse_info</code> is specified differently, as follows:
</p>

<ol>
<li> <p><code>band</code>: Band name associated to the type of result. Use
<code>"probs"</code>, for probability cubes produced by <code>sits_classify()</code>;
<code>"bayes"</code>, for smoothed cubes produced by <code>sits_smooth()</code>;
<code>"segments"</code>, for vector cubes produced by <code>sits_segment()</code>;
<code>"entropy"</code> when using <code>sits_uncertainty()</code>, and <code>"class"</code>
for cubes produced by <code>sits_label_classification()</code>;
</p>
</li>
<li> <p><code>labels</code>: Labels associated to the classification results;
</p>
</li>
<li> <p><code>parse_info</code>: File name parsing information
to deduce the values of "tile", "start_date", "end_date" from
the file name. Default is c("X1", "X2", "tile", "start_date",
"end_date", "band"). Unlike non-classified image files,
cubes with results have both
"start_date" and "end_date".
</p>
</li>
</ol>
<p>In MPC, sits can access are two open data collections:
<code>"SENTINEL-2-L2A"</code> for Sentinel-2/2A images, and
<code>"LANDSAT-C2-L2"</code> for the Landsat-4/5/7/8/9 collection.
(requester-pays) and <code>"SENTINEL-S2-L2A-COGS"</code> (open data).
</p>
<p>Sentinel-2/2A level 2A files in MPC are organized by sensor
resolution. The bands in 10m resolution are <code>"B02"</code>, <code>"B03"</code>,
<code>"B04"</code>, and <code>"B08"</code>. The  20m bands are <code>"B05"</code>,
<code>"B06"</code>, <code>"B07"</code>, <code>"B8A"</code>, <code>"B11"</code>, and <code>"B12"</code>.
Bands <code>"B01"</code> and <code>"B09"</code> are available at 60m resolution.
The <code>"CLOUD"</code> band is also available.
</p>
<p>All Landsat-4/5/7/8/9 images in MPC have bands with 30 meter
resolution. To account for differences between the different sensors,
Landsat bands in this collection have been renamed <code>"BLUE"</code>,
<code>"GREEN"</code>, <code>"RED"</code>, <code>"NIR08"</code>, <code>"SWIR16"</code>
and <code>"SWIR22"</code>. The <code>"CLOUD"</code> band is also available.
</p>
<p>In AWS, there are two types of collections: open data and
requester-pays. Currently, <code>sits</code> supports collection
<code>"SENTINEL-2-L2A"</code> (open data) and LANDSAT-C2-L2 (requester-pays).
There is no need to provide AWS credentials to access open data
collections. For requester-pays data, users need to provide their
access codes as environment variables, as follows:
<code>
Sys.setenv(
    AWS_ACCESS_KEY_ID     = &lt;your_access_key&gt;,
    AWS_SECRET_ACCESS_KEY = &lt;your_secret_access_key&gt;
)</code>
</p>
<p>Sentinel-2/2A level 2A files in AWS are organized by sensor
resolution. The AWS bands in 10m resolution are <code>"B02"</code>, <code>"B03"</code>,
<code>"B04"</code>, and <code>"B08"</code>. The  20m bands are <code>"B05"</code>,
<code>"B06"</code>, <code>"B07"</code>, <code>"B8A"</code>, <code>"B11"</code>, and <code>"B12"</code>.
Bands <code>"B01"</code> and <code>"B09"</code> are available at 60m resolution.
</p>
<p>For DEAFRICA, sits currently works with collections <code>"S2_L2A"</code>
for Sentinel-2 level 2A and <code>"LS8_SR"</code> for Landsat-8 ARD collection.
(open data). These collections are located in Africa
(Capetown) for faster access to African users. No payment for access
is required.
</p>
<p>For USGS, sits currently works with collection
<code>"LANDSAT-C2L2-SR"</code>, which corresponds to Landsat
Collection 2 Level-2 surface reflectance data, covering
Landsat-8 dataset. This collection is requester-pays and
requires payment for accessing.
</p>
<p>All BDC collections are regularized.
BDC users need to provide their credentials using environment
variables. To create your credentials, please see
&lt;brazil-data-cube.github.io/applications/dc_explorer/token-module.html&gt;.
Accessing data in the BDC is free.
After obtaining the BDC access key, please include it as
an environment variable, as follows:
<code>
Sys.setenv(
    BDC_ACCESS_KEY = &lt;your_bdc_access_key&gt;
)</code>

</p>


<h3>Examples</h3>

<pre><code class="language-R">if (sits_run_examples()) {
    # --- Access to the Brazil Data Cube
    # create a raster cube file based on the information in the BDC
    cbers_tile &lt;- sits_cube(
        source = "BDC",
        collection = "CBERS-WFI-16D",
        bands = c("NDVI", "EVI"),
        tiles = "007004",
        start_date = "2018-09-01",
        end_date = "2019-08-28"
    )
    # --- Access to Digital Earth Africa
    # create a raster cube file based on the information about the files
    # DEAFRICA does not support definition of tiles
    cube_deafrica &lt;- sits_cube(
        source = "DEAFRICA",
        collection = "SENTINEL-2-L2A",
        bands = c("B04", "B08"),
        roi = c(
            "lat_min" = 17.379,
            "lon_min" = 1.1573,
            "lat_max" = 17.410,
            "lon_max" = 1.1910
        ),
        start_date = "2019-01-01",
        end_date = "2019-10-28"
    )
    # --- Access to Digital Earth Australia
    cube_deaustralia &lt;- sits_cube(
        source = "DEAUSTRALIA",
        collection = "GA_LS8CLS9C_GM_CYEAR_3",
        bands = c("RED", "GREEN", "BLUE"),
        roi = c(
            lon_min = 137.15991,
            lon_max = 138.18467,
            lat_min = -33.85777,
            lat_max = -32.56690
        ),
        start_date = "2018-01-01",
        end_date = "2018-12-31"
    )
    # --- Access to CDSE open data Sentinel 2/2A level 2 collection
    # --- remember to set the appropriate environmental variables
    # It is recommended that `multicores` be used to accelerate the process.
    s2_cube &lt;- sits_cube(
        source = "CDSE",
        collection = "SENTINEL-2-L2A",
        tiles = c("20LKP"),
        bands = c("B04", "B08", "B11"),
        start_date = "2018-07-18",
        end_date = "2019-01-23"
    )

    ## --- Sentinel-1 SAR from CDSE
    # --- remember to set the appropriate environmental variables
    roi_sar &lt;- c("lon_min" = 33.546, "lon_max" = 34.999,
                 "lat_min" = 1.427, "lat_max" = 3.726)
    s1_cube_open &lt;- sits_cube(
       source = "CDSE",
       collection = "SENTINEL-1-RTC",
       bands = c("VV", "VH"),
       orbit = "descending",
       roi = roi_sar,
       start_date = "2020-01-01",
       end_date = "2020-06-10"
    )

    # --- Access to AWS open data Sentinel 2/2A level 2 collection
    s2_cube &lt;- sits_cube(
        source = "AWS",
        collection = "SENTINEL-S2-L2A-COGS",
        tiles = c("20LKP", "20LLP"),
        bands = c("B04", "B08", "B11"),
        start_date = "2018-07-18",
        end_date = "2019-07-23"
    )

    # --- Creating Sentinel cube from MPC
    s2_cube &lt;- sits_cube(
        source = "MPC",
        collection = "SENTINEL-2-L2A",
        tiles = "20LKP",
        bands = c("B05", "CLOUD"),
        start_date = "2018-07-18",
        end_date = "2018-08-23"
    )

    # --- Creating Landsat cube from MPC
    roi &lt;- c("lon_min" = -50.410, "lon_max" = -50.379,
             "lat_min" = -10.1910 , "lat_max" = -10.1573)
    mpc_cube &lt;- sits_cube(
        source = "MPC",
        collection = "LANDSAT-C2-L2",
        bands = c("BLUE", "RED", "CLOUD"),
        roi = roi,
        start_date = "2005-01-01",
        end_date = "2006-10-28"
    )

    ## Sentinel-1 SAR from MPC
    roi_sar &lt;- c("lon_min" = -50.410, "lon_max" = -50.379,
                 "lat_min" = -10.1910, "lat_max" = -10.1573)

    s1_cube_open &lt;- sits_cube(
       source = "MPC",
       collection = "SENTINEL-1-GRD",
       bands = c("VV", "VH"),
       orbit = "descending",
       roi = roi_sar,
       start_date = "2020-06-01",
       end_date = "2020-09-28"
    )
    # --- Access to World Cover data (2021) via Terrascope
    cube_terrascope &lt;- sits_cube(
        source = "TERRASCOPE",
        collection = "WORLD-COVER-2021",
        roi = c(
            lon_min = -62.7,
            lon_max = -62.5,
            lat_min = -8.83,
            lat_max = -8.70
        )
    )
    # --- Create a cube based on a local MODIS data
    data_dir &lt;- system.file("extdata/raster/mod13q1", package = "sits")
    modis_cube &lt;- sits_cube(
        source = "BDC",
        collection = "MOD13Q1-6.1",
        data_dir = data_dir
    )
}
</code></pre>


</div>