<div class="container">

<table style="width: 100%;"><tr>
<td>Plots</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
<code>Plot</code> wrapper intended for use in a SpaDES module</h2>

<h3>Description</h3>

<p>This is a single function call that allows a user to change which format in which
the plots will occur.
Specifically, the two common formats would be to <code>"screen"</code> or to disk as an image file,
such as <code>"png"</code>.
<em>This has currently been tested with <code>ggplot2</code>, <code>RasterLayer</code>, and <code>tmap</code> objects.</em>
The default (or change with e.g., <code style="white-space: pre;">⁠fn = "print", usePlot = FALSE⁠</code>) uses
<code>Plot</code> internally, so individual plots may be rearranged. When saved to
disk (e.g., via <code>type = 'png'</code>), then <code>Plot</code> will not be used and the single object
that is the result of this <code>Plots</code> call will be saved to disk.
This function requires at least 2 things: a plotting function and arguments passed
to that function (which could include <code>data</code>, but commonly would simply be named
arguments required by <code>fn</code>).
See below and examples.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Plots(
  data,
  fn,
  filename,
  types = quote(params(sim)[[currentModule(sim)]]$.plots),
  path = quote(figurePath(sim)),
  .plotInitialTime = quote(params(sim)[[currentModule(sim)]]$.plotInitialTime),
  ggsaveArgs = list(),
  usePlot = getOption("spades.PlotsUsePlot", FALSE),
  deviceArgs = list(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An (optional) arbitrary data object. If supplied, it will be passed as
the first argument to <code>Plot</code> function, and should contain all the data
required for the inner plotting. If passing a <code>RasterLayer</code>,
it may be a good idea to set <code>names(RasterLayer)</code> so that
multiple layers can be plotted without overlapping each other. When a custom <code>fn</code>
is used and all arguments for <code>fn</code> are supplied and named, then this can be omitted.
See examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fn</code></td>
<td>
<p>An arbitrary plotting function. If not provided, defaults to using <code>quickPlot::Plot</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>A name that will be the base for the files that will be saved, i.e,
do not supply the file extension, as this will be determined based on <code>types</code>.
If a user provides this as an absolute path, it will override the <code>path</code>
argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>types</code></td>
<td>
<p>Character vector, zero or more of types. If used within a module, this
will be deduced from the <code>P(sim)$type</code> and can be omitted. See below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>Currently a single path for the saved objects on disk. If <code>filename</code>
is supplied as an absolute path, <code>path</code> will be set to <code>dirname(filename)</code>,
overriding this argument value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.plotInitialTime</code></td>
<td>
<p>A numeric. If <code>NA</code> then no visual on screen. Anything
else will have visuals plotted to screen device. This is here for backwards
compatibility. A developer should set in the module to the intended initial
plot time and leave it, i.e., <em>not</em> <code>NA</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ggsaveArgs</code></td>
<td>
<p>An optional list of arguments passed to <code>ggplot2::ggsave</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usePlot</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the default, then the plot will occur
with <code>quickPlot::Plot</code>, so it will be arranged with previously existing plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviceArgs</code></td>
<td>
<p>An optional list of arguments passed to one of <code>png</code>,
<code>pdf</code>, <code>tiff</code>, <code>bmp</code>, or <code>jgeg</code>.
This is useful when the plotting function is not creating a <code>ggplot</code> object,
e.g., plotting a <code>RasterLayer</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Anything needed by <code>fn</code>, all named.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ul><li> <p><code>type</code>
</p>

<ul>
<li> <p><code>"screen"</code> – Will plot to the current device, normally a plot window
</p>
</li>
<li> <p><code>"object"</code> – Will save the plot object, e.g., <code>ggplot</code> object
</p>
</li>
<li> <p><code>"raw"</code> – Will save the raw data prior to plotting, e.g.,
the data argument
</p>
</li>
<li> <p><code>"png"</code> – or any other type save-able with <code>ggsave</code>
</p>
</li>
</ul>
</li></ul>
<h3>Value</h3>

<p>Called for its side effect of plot creation.
</p>


<h3>Recording of files saved</h3>

<p>In cases where files are saved, and where <code>Plots</code> is used within a SpaDES module,
the file(s) that is/are saved will be appended to the <code>outputs</code> slot of the
<code>simList</code> of the module. This will, therefore, keep a record of figures saved
<em>within</em> the <code>simList</code>
</p>


<h3>Note</h3>

<p><strong>This is still experimental and could change in the next release.</strong>
</p>
<p><code>Plots</code> now has experimental support for "just a <code>Plot</code> call", but with <code>types</code> specified.
See examples.
The devices to save on disk will have some different behaviours to the screen representation,
since "wiping" an individual plot on a device doesn't exist for a file device.
</p>
<p>This offers up to 4 different actions for a given plot:
</p>

<ul>
<li>
<p> To screen device
</p>
</li>
<li>
<p> To disk as raw data (limited testing)
</p>
</li>
<li>
<p> To disk as a saved plot object  (limited testing)
</p>
</li>
<li>
<p> To disk as a ‘<span class="file">.png</span>’ or other image file, e.g., ‘<span class="file">.pdf</span>’
</p>
</li>
</ul>
<p>To turn off plotting both to screen and disk, set both
<code>.plotInititalTime = NA</code> and <code>.plots = NA</code> or any other
value that will not trigger a TRUE with a <code>grepl</code> with the <code>types</code>
argument (e.g., <code>""</code> will omit all saving).
</p>


<h3>Examples</h3>

<pre><code class="language-R">
  # Note: if this is used inside a SpaDES module, do not define this
  #  function inside another function. Put it outside in a normal
  #  module script. Otherwise, it will cause a memory leak.
  if (requireNamespace("ggplot2")) {
    fn &lt;- function(d)
      ggplot2::ggplot(d, ggplot2::aes(a)) +
      ggplot2::geom_histogram()
    sim &lt;- simInit()
    sim$something &lt;- data.frame(a = sample(1:10, replace = TRUE))

    Plots(data = sim$something, fn = fn,
          types = c("png"),
          path = file.path("figures"),
          filename = tempfile(),
          .plotInitialTime = 1
          )

    # plot to active device and to png
    Plots(data = sim$something, fn = fn,
          types = c("png", "screen"),
          path = file.path("figures"),
          filename = tempfile(),
          .plotInitialTime = 1
          )

    # Can also be used like quickPlot::Plot, but with control over output type
    r &lt;- terra::rast(terra::ext(0,10,0,10), vals = sample(1:3, size = 100, replace = TRUE))
    Plots(r, types = c("screen", "png"), deviceArgs = list(width = 700, height = 500),
          usePlot = TRUE)

    # with ggplotify, Plots can also be used to plot/save
    # non-ggplot objects:


    if (require("ggplotify")) {
      if (!require("lattice")) stop("please install lattice")

      plotFile &lt;- tempfile()

      p1 &lt;- densityplot(~mpg|cyl, data=mtcars)
      Plots(data = p1, fn = as.ggplot, filename = plotFile,
            ggsaveArgs = list(width = 5, height = 4, dpi = 300, bg = "white", units = "in"),
            types = c("screen", "png"), .plotInitialTime = 1)
    }
  } # end ggplot
 # end of dontrun
</code></pre>


</div>