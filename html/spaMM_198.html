<div class="container">

<table style="width: 100%;"><tr>
<td>WinterWheat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Example of yield stability analysis
</h2>

<h3>Description</h3>

<p>Translation of an example that may be found at<br><a href="https://www.r-bloggers.com/2019/06/genotype-experiments-fitting-a-stability-variance-model-with-r/">https://www.r-bloggers.com/2019/06/genotype-experiments-fitting-a-stability-variance-model-with-r/</a>,
based on yield of eight durum wheat genotypes over seven years, following a randomised block design with three replicates.
A genotype-in-year random effect is used to quantify genotype-by-environment interactions. 
In the first fit (<code>constvar</code>), the variance of this random effect is constant over genotypes. 
In the second fit (<code>varvar</code>), different variances are fitted for the distinct genotypes, to assess the relative stability of yield of the different genotypes over environments. This second model can be fitted as a 
constrained random-coefficient model, where the constraint describes a diagonal covariance matrix for the random coefficients.
</p>
<p>This example uses the fact that the argument <code>fixed=list(ranCoefs=&lt;...&gt;)</code> can be used to fit a 
covariance matrix with an arbitrary set of constrained elements. Only elements 
left as 'NA' (here the diagonal elements of the matrix) are fitted.  
</p>


<h3>Examples</h3>

<pre><code class="language-R">
if (spaMM.getOption("example_maxtime")&gt;1.5 &amp;&amp;
      requireNamespace("agridat", quietly = TRUE)) {

data("onofri.winterwheat", package="agridat")

(constvar &lt;- fitme(
  yield ~ gen + (1|year) + (1|block %in% year)+(1|gen %in% year), 
  data=onofri.winterwheat, method="REML"))
  
# Diagonal matrix of NA's, represented as vector for its lower triangle:
ranCoefs_for_diag &lt;- function(nlevels) { 
 ## Conceptual version
 # diagmat &lt;- matrix(NA, ncol=nlevels,nrow=nlevels)
 # diagmat[lower.tri(diagmat,diag=FALSE)] &lt;- 0
 # return(diagmat[lower.tri(diagmat,diag=TRUE)])
 ## which amounts to:
 vec &lt;- rep(0,nlevels*(nlevels+1L)/2L)
 vec[cumsum(c(1L,rev(seq(nlevels-1L)+1L)))] &lt;- NA
 vec
} 

(varvar &lt;- fitme(
  yield ~ gen + (1|year) + (1|block %in% year)+(0+gen|gen %in% year), method="REML", 
  data=onofri.winterwheat, fixed=list(ranCoefs=list("3"=ranCoefs_for_diag(8L)))))

}

</code></pre>


</div>