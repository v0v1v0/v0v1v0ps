<div class="container">

<table style="width: 100%;"><tr>
<td>scdataMulti</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Data Preparation for <code>scest</code> or <code>scpi</code> for Point Estimation and Inference Procedures Using Synthetic Control Methods.</h2>

<h3>Description</h3>

<p>The command prepares the data to be used by <code>scest</code> or <code>scpi</code> to implement estimation
and inference procedures for Synthetic Control (SC) methods
in the general case of multiple treated units and staggered adoption. It is a generalization of <code>scdata</code>, since this latter prepares
the data in the particular case of a single treated unit.
</p>
<p>The names of the output matrices follow the terminology proposed in
<a href="https://nppackages.github.io/references/Cattaneo-Feng-Titiunik_2021_JASA.pdf">Cattaneo, Feng, Palomba and Titiunik (2022)</a>.
</p>
<p>Companion <a href="https://www.stata.com/">Stata</a> and <a href="https://www.python.org/">Python</a> packages are
described in <a href="https://arxiv.org/abs/2202.05984">Cattaneo, Feng, Palomba, and Titiunik (2022)</a>.
</p>
<p>Companion commands are: scdata for data preparation in the single treated unit case, scest for point estimation,
scpi for inference procedures,
scplot and scplotMulti for plots in the single and multiple treated unit(s) cases, respectively.
</p>
<p>Related Stata, R, and Python packages useful for inference in SC designs are described in the following website:
</p>
<p><a href="https://nppackages.github.io/scpi/"> https://nppackages.github.io/scpi/</a>
</p>
<p>For an introduction to synthetic control methods, see <a href="https://www.aeaweb.org/articles?id=10.1257/jel.20191450">Abadie (2021)</a> and references therein.
</p>


<h3>Usage</h3>

<pre><code class="language-R">scdataMulti(
  df,
  id.var,
  time.var,
  outcome.var,
  treatment.var,
  features = NULL,
  cov.adj = NULL,
  cointegrated.data = FALSE,
  post.est = NULL,
  units.est = NULL,
  donors.est = NULL,
  anticipation = 0,
  effect = "unit-time",
  constant = FALSE,
  verbose = TRUE,
  sparse.matrices = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>a dataframe object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id.var</code></td>
<td>
<p>a character with the name of the variable containing units' IDs. The ID variable can be numeric or character.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.var</code></td>
<td>
<p>a character with the name of the time variable. The time variable has to be numeric, integer, or Date. In
case <code>time.var</code> is Date it should be the output of <code>as.Date()</code> function. An integer or
numeric time variable is suggested when working with yearly data, whereas for all other formats a Date type
time variable is preferred.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome.var</code></td>
<td>
<p>a character with the name of the outcome variable. The outcome variable has to be numeric.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treatment.var</code></td>
<td>
<p>a character with the name of the variable containing the treatment assignment of each unit. The referenced
variable has to take value 1 if the unit is treated in that period and value 0 otherwise. Please notice that, as common in the SC
literature, we presume that once a unit is treated it remains treated forever. If treatment.var does not comply with this requirement
the command would not work as expected!</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>features</code></td>
<td>
<p>a list containing the names of the feature variables used for estimation.
If this option is not specified the default is <code>features = outcome.var</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov.adj</code></td>
<td>
<p>a list specifying the names of the covariates to be used for adjustment for each feature. If <code>outcome.var</code> is
not in the variables specified in <code>features</code>, we force <code>cov.adj&lt;-NULL</code>. See the <strong>Details</strong> section for more.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cointegrated.data</code></td>
<td>
<p>a logical that indicates if there is a belief that the data is cointegrated or not. The default value is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>post.est</code></td>
<td>
<p>a scalar specifying the number of post-treatment periods or a list specifying the periods
for which treatment effects have to be computed for each treated unit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units.est</code></td>
<td>
<p>a list specifying the treated units for which treatment effects have to be computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>donors.est</code></td>
<td>
<p>a list specifying the donors units to be used. If the list has length 1, then all treated units share the same
potential donors. Otherwise, if the user requires different donor pools for different treated units, the list must be of the same
length of the number of treated units and each element has to be named with one treated unit's name as specified in id.var.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>anticipation</code></td>
<td>
<p>a scalar that indicates the number of periods of potential anticipation effects. Default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effect</code></td>
<td>
<p>a string indicating the type of treatment effect to be computed. Options are: 'unit-time', which estimates treatment effects for each
treated unit- post treatment period combination; 'unit', which estimates the treatment effect for each unit by averaging post-treatment features over time;
'time', which estimates the average treatment effect on the treated at various horizons.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constant</code></td>
<td>
<p>a logical which controls the inclusion of a constant term across features. The default value is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>if <code>TRUE</code> prints additional information in the console.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparse.matrices</code></td>
<td>
<p>if <code>TRUE</code> all block diagonal matrices (<code class="reqn">\mathbf{B}</code>, <code class="reqn">\mathbf{C}</code>, and <code class="reqn">\mathbf{P}</code>)
are sparse matrices. This is suggested if the dimension of the dataset is large as it will likely reduce the execution time.
The sparse matrices will be objects of class 'dgCMatrix' or 'lgCMatrix', thus to visualize them they need to be transformed
in matrices, e.g. <code>View(as.matrix(B))</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ul>
<li>
<p><strong>Covariate-adjustment.</strong> See the <strong>Details</strong> section in <code>scdata</code> for further information on how
to specify covariate-adjustment feature-by-feature.
</p>
</li>
<li>
<p><strong>Cointegration.</strong> <code>cointegrated.data</code> allows the user to model the belief that <code class="reqn">\mathbf{A}</code> and <code class="reqn">\mathbf{B}</code> form a
cointegrated system. In practice, this implies that when dealing with the pseudo-true
residuals <code class="reqn">\mathbf{u}</code>, the first-difference of <code class="reqn">\mathbf{B}</code> are used rather than the levels.
</p>
</li>
<li>
<p><strong>Effect.</strong> <code>effect</code> allows the user to select between two causal quantities. The default
option, <code>effect = "unit-time"</code>, prepares the data for estimation of
</p>
<p style="text-align: center;"><code class="reqn">\tau_{ik},\quad k\geq, i=1,\ldots,N_1,</code>
</p>

<p>whereas the option <code>effect = "unit"</code> prepares the data for estimation of
</p>
<p style="text-align: center;"><code class="reqn">\tau_{\cdot k}=\frac{1}{N_1} \sum_{i=1}^{N_1} \tau_{i k}</code>
</p>

<p>which is the average effect on the treated unit across multiple post-treatment periods.
</p>
</li>
</ul>
<h3>Value</h3>

<p>The command returns an object of class 'scdataMulti' containing the following
</p>
<table>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>a matrix containing pre-treatment features of the treated units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>a matrix containing pre-treatment features of the control units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C</code></td>
<td>
<p>a matrix containing covariates for adjustment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>P</code></td>
<td>
<p>a matrix whose rows are the vectors used to predict the out-of-sample series for the synthetic units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>P.diff</code></td>
<td>
<p>for internal use only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y.df</code></td>
<td>
<p>a dataframe containing the outcome variable for all units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y.pre</code></td>
<td>
<p>a matrix containing the pre-treatment outcome of the treated units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y.post</code></td>
<td>
<p>a matrix containing the post-treatment outcome of the treated units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y.donors</code></td>
<td>
<p>a matrix containing the pre-treatment outcome of the control units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>specs</code></td>
<td>
<p>a list containing some specifics of the data:
</p>

<ul>
<li>
<p><code>J</code>, a list containing the number of donors for each treated unit
</p>
</li>
<li>
<p><code>K</code>, a list containing the number of covariates used for adjustment for each feature for each treated unit
</p>
</li>
<li>
<p><code>KM</code>, a list containing the total number of covariates used for adjustment for each treated unit
</p>
</li>
<li>
<p><code>M</code>, a list containing number of features used for each treated unit
</p>
</li>
<li>
<p><code>I</code>, number of treated units
</p>
</li>
<li>
<p><code>KMI</code>, overall number of covariates used for adjustment
</p>
</li>
<li>
<p><code>period.pre</code>, a list containing a numeric vector with the pre-treatment period for each treated unit
</p>
</li>
<li>
<p><code>period.post</code>, a list containing a numeric vector with the post-treatment period for each treated unit
</p>
</li>
<li>
<p><code>T0.features</code>, a list containing a numeric vector with the number of periods used in estimation for each feature for each treated unit
</p>
</li>
<li>
<p><code>T1.outcome</code>, a list containing the number of post-treatment periods for each treated unit
</p>
</li>
<li>
<p><code>features.list</code>, a list containing the name of the features for each treated unit
</p>
</li>
<li>
<p><code>outcome.var</code>, a character containing the name of the outcome variable
</p>
</li>
<li>
<p><code>constant</code>, for internal use only
</p>
</li>
<li>
<p><code>effect</code>, for internal use only
</p>
</li>
<li>
<p><code>anticipation</code>, number of periods of potential anticipation effects
</p>
</li>
<li>
<p><code>out.in.features</code>, for internal use only
</p>
</li>
<li>
<p><code>sparse.matrices</code>, for internal use only
</p>
</li>
<li>
<p><code>treated.units</code>, list containing the IDs of all treated units
</p>
</li>
<li>
<p><code>donors.list</code>, list containing the IDs of the donors of each treated unit</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Matias Cattaneo, Princeton University. <a href="mailto:cattaneo@princeton.edu">cattaneo@princeton.edu</a>.
</p>
<p>Yingjie Feng, Tsinghua University. <a href="mailto:fengyj@sem.tsinghua.edu.cn">fengyj@sem.tsinghua.edu.cn</a>.
</p>
<p>Filippo Palomba, Princeton University (maintainer). <a href="mailto:fpalomba@princeton.edu">fpalomba@princeton.edu</a>.
</p>
<p>Rocio Titiunik, Princeton University. <a href="mailto:titiunik@princeton.edu">titiunik@princeton.edu</a>.
</p>


<h3>References</h3>


<ul>
<li>
<p><a href="https://www.aeaweb.org/articles?id=10.1257/jel.20191450">Abadie, A. (2021)</a>. Using synthetic controls: Feasibility, data requirements, and methodological aspects.
<em>Journal of Economic Literature</em>, 59(2), 391-425.
</p>
</li>
<li>
<p><a href="https://nppackages.github.io/references/Cattaneo-Feng-Titiunik_2021_JASA.pdf">Cattaneo, M. D., Feng, Y., and Titiunik, R.
(2021)</a>. Prediction intervals for synthetic control methods. <em>Journal of the American Statistical Association</em>, 116(536), 1865-1880.
</p>
</li>
<li>
<p><a href="https://arxiv.org/abs/2202.05984">Cattaneo, M. D., Feng, Y., Palomba F., and Titiunik, R. (2022).</a>
scpi: Uncertainty Quantification for Synthetic Control Methods, <em>arXiv</em>:2202.05984.
</p>
</li>
<li>
<p><a href="https://arxiv.org/abs/2210.05026">Cattaneo, M. D., Feng, Y., Palomba F., and Titiunik, R. (2022).</a>
Uncertainty Quantification in Synthetic Controls with Staggered Treatment Adoption, <em>arXiv</em>:2210.05026.
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>scdata</code>, <code>scest</code>, <code>scpi</code>, <code>scplot</code>, <code>scplotMulti</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
datager &lt;- scpi_germany

datager$tr_id &lt;- 0
datager$tr_id[(datager$country == "West Germany" &amp; datager$year &gt; 1990)] &lt;- 1
datager$tr_id[(datager$country == "Italy" &amp; datager$year &gt; 1992)] &lt;- 0

outcome.var &lt;- "gdp"
id.var &lt;- "country"
treatment.var &lt;- "tr_id"
time.var &lt;- "year"
df.unit &lt;- scdataMulti(datager, id.var = id.var, outcome.var = outcome.var,
                       treatment.var = treatment.var,
                       time.var = time.var, features = list(c("gdp", "trade")),
               		    cointegrated.data = TRUE, constant = TRUE)

</code></pre>


</div>