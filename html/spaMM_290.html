<div class="container">

<table style="width: 100%;"><tr>
<td>covStruct</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Specifying correlation structures</h2>

<h3>Description</h3>

<p><code>covStruct</code> is a formal argument of <code>HLCor</code>, also handled by <code>fitme</code> and <code>corrHLfit</code>, that allows one to specify the correlation structure for different types of random effects, It is an alternative to other ad hoc formal arguments such as <code>corrMatrix</code> or <code>adjMatrix</code>. It replaces the deprecated function <code>Predictor(...)</code> which has served as an interface for specifying the design matrices for random effects in early versions of <code>spaMM</code>. 
</p>
<p>The main use of <code>covStruct</code> is to specify the correlation matrix of levels of a given random effect term, or its inverse (a precision matrix). Assuming that the design matrix of each random effect term follows the structure <b>ZAL</b> described in <code>random-effects</code>, it is thus an indirect way of specifying the “square root” <b>L</b> of the correlation matrix. The optional <b>A</b> factor can also be given by the optional <code>"AMatrices"</code> attribute of <code>covStruct</code>.      
</p>
<p><code>covStruct</code> is a <code>list</code> of matrices with names specifying the type of matrix considered:<br><code>covStruct=list(corrMatrix=&lt;some matrix&gt;)</code> or <code>covStruct=list(adjMatrix=&lt;some matrix&gt;)</code>, where the “corrMatrix” or “adjMatrix” labels are used to specify the type of information provided (accordingly, the names can be repeated: <code>covStruct=list(corrMatrix=&lt;.&gt;,corrMatrix=&lt;.&gt;)</code>). 
<code>NULL</code> list members may be necessary, e.g.<br><code>covStruct=list(corrMatrix=&lt;.&gt;,"2"=NULL,corrMatrix=&lt;.&gt;)</code>)<br>
when correlations matrices are required only for the first and third random effect. 
</p>
<p>The covariance structure of a <code>corrMatrix(1|&lt;grouping factor&gt;)</code> formula term can be specified in two ways (see Examples): either by a correlation matrix factor (<code>covStruct=list(corrMatrix=&lt;some matrix&gt;)</code>), or by a precision matrix factor <b>Q</b> such that the covariance factor is <code class="reqn">\lambda</code><b>Q</b><code class="reqn">^{-1}</code>, using the type name <code>"precision"</code>: <code>covStruct=list(precision=&lt;some matrix&gt;)</code>. 
The function <code>as_precision</code> can be used to perform the conversion from correlation information to precision factor (using a crude solve() that may not always be efficient), but fitting functions may also perform such conversions automatically.
</p>
<p><code>"AMatrices"</code> is a list of matrices. The names of elements of the list does not matter, but the <em>i</em>th <code>A</code> matrix, and its row names, should match the <em>i</em>th <b>Z</b> matrix, and its column names. This implies that <code>NULL</code> list members may be necessary, as for the <code>covStruct</code> list.
</p>


<h3>Usage</h3>

<pre><code class="language-R">as_precision(corrMatrix, condnum=1e12)  
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>corrMatrix</code></td>
<td>
<p>Correlation matrix, specified as <code>matrix</code> or as <code>dist</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condnum</code></td>
<td>
<p>Numeric: when a standard Cholesky factorization fails, the matrix is regularized so that the regularized matrix has this condition number (in version 3.10.0 this correction has been implemented more exactly than in previous versions).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>covStruct</code> can also be specified as a list with an optional <code>"types"</code> attribute, e.g.<br><code>structure(list(&lt;some matrix&gt;,types="corrMatrix"))</code>.
</p>


<h3>Value</h3>

<p><code>as_precision</code> returns a list with additional class <code>precision</code> and with single element a symmetric matrix of class <code>dsCMatrix</code>.
</p>


<h3>See Also</h3>

<p><code>Gryphon</code> and <code>pedigree</code> for a type of applications where declaring a precision matrix is useful.</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
data("blackcap") 
# a 'dist' object can be used to specify a corrMatrix:  
MLdistMat &lt;- MaternCorr(proxy::dist(blackcap[,c("latitude","longitude")]),
                        nu=0.6285603,rho=0.0544659) # a 'dist' object!
blackcap$name &lt;- as.factor(rownames(blackcap))     
fitme(migStatus ~ means + corrMatrix(1|name), data=blackcap,
      corrMatrix=MLdistMat)

#### Same result by different input and algorithm:
fitme(migStatus ~ means + corrMatrix(1|name), data=blackcap,
      covStruct=list(precision=as_precision(MLdistMat)))

# Manual version of the same:
as_mat &lt;- proxy::as.matrix(MLdistMat, diag=1) 
prec_mat &lt;- solve(as_mat) ## precision factor matrix
fitme(migStatus ~ means + corrMatrix(1|name), data=blackcap,
      covStruct=list(precision=prec_mat))

# Since no correlation parameter is estimated, 
# HLcor(., method="ML")  is here equivalent to fitme()

## End(Not run)
</code></pre>


</div>