<div class="container">

<table style="width: 100%;"><tr>
<td>focal2</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Apply a focal filter on a raster</h2>

<h3>Description</h3>

<p>Applies a focal filter with weighted neighborhood <code>w</code> on a raster. The weights (<code>w</code>) can be added to, subtracted from, multiplied by or divided with the raster values (as specified with <code>weight_fun</code>). The focal cell is then taken as the mean, sum, minimum or maximum of the weighted values (as specified with <code>fun</code>).  Input and output are rasters of class <code>stars</code>, single-band (i.e., only '"x"' and '"y"' dimensions), with one attribute.
</p>


<h3>Usage</h3>

<pre><code class="language-R">focal2(
  x,
  w,
  fun = "mean",
  weight_fun = "*",
  na.rm = FALSE,
  mask = FALSE,
  na_flag = -9999
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A raster (class <code>stars</code>) with one attribute and two dimensions: <code>x</code> and <code>y</code>, i.e., a single-band raster.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>Weights matrix defining the neighborhood size around the focal cell, as well as the weights. For example, <code>matrix(1,3,3)</code> implies a neighborhood of size 3*3 with equal weights of 1 for all cells. The matrix must be square, i.e., with an odd number of rows and columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>A function to aggregate the resulting values for each neighborhood. Possible values are: <code>"mean"</code>, <code>"sum"</code>, <code>"min"</code>, <code>"max"</code>, and <code>"mode"</code>. The default is <code>"mean"</code>, i.e., the resulting values per neighborhood are <em>averaged</em> before being assigned to the new focal cell value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight_fun</code></td>
<td>
<p>An operator which is applied on each pair of values comprising the cell value and the respective weight value, as in <code>raster_value-weight</code>. Possible values are: <code>"+"</code>, <code>"-"</code>, <code>"*"</code>, <code>"/"</code>. The default is <code>"*"</code>, i.e., each cell value is <em>multiplied</em> by the respective weight.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Should <code>NA</code> values in the neighborhood be removed from the calculation? Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mask</code></td>
<td>
<p>If <code>TRUE</code>, pixels with <code>NA</code> in the input are set to <code>NA</code> in the output as well, i.e., the output is "masked" using the input (default is <code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_flag</code></td>
<td>
<p>Value used to mark <code>NA</code> values in C code. This should be set to a value which is guaranteed to be absent from the input raster <code>x</code> (default is <code>-9999</code>).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The filtered <code>stars</code> raster.
</p>


<h3>Note</h3>

<p>The raster is "padded" with <code>(nrow(w)-1)/2</code> more rows and columns of <code>NA</code> values on all sides, so that the neighborhood of the outermost rows and columns is still a complete neighborhood. Those rows and columns are removed from the final result before returning it. This means, for instance, that the outermost rows and columns in the result will be <code>NA</code> when using <code>na.rm=FALSE</code>.
</p>


<h3>References</h3>

<p>The function interface was inspired by function <code>raster::focal</code>. The C code for this function is a modified and expanded version of the C function named <code>applyKernel</code> included with R package <code>spatialfil</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Small example
data(dem)
dem_mean3 = focal2(dem, matrix(1, 3, 3), "mean")
r = c(dem, round(dem_mean3, 1), along = 3)
r = st_set_dimensions(r, 3, values = c("input", "output (mean, k=3)"))
plot(r, text_values = TRUE, breaks = "equal", col = terrain.colors(11))

# Larger example
data(carmel)
carmel_mean15 = focal2(carmel, matrix(1, 15, 15), "mean")
r = c(carmel, carmel_mean15, along = 3)
r = st_set_dimensions(r, 3, values = c("input", "output (mean, k=15)"))
plot(r, breaks = "equal", col = terrain.colors(11))


</code></pre>


</div>