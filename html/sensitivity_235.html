<div class="container">

<table style="width: 100%;"><tr>
<td>sobolrec</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Recursive estimation of Sobol' indices</h2>

<h3>Description</h3>

<p><code>sobolrec</code> implements a recursive version of the procedure introduced by Tissot &amp; Prieur (2015) using two replicated nested designs. This function estimates either all first-order indices or all closed second-order indices at a total cost of <code class="reqn">2 \times N</code> model evaluations where <code class="reqn">N</code> is the size of each replicated nested design.</p>


<h3>Usage</h3>

<pre><code class="language-R">sobolrec(model=NULL, factors, layers, order, precision, method=NULL, tail=TRUE, 
          ...)
## S3 method for class 'sobolrec'
ask(x, index, ...)
## S3 method for class 'sobolrec'
tell(x, y = NULL, index, ...)
## S3 method for class 'sobolrec'
print(x, ...)
## S3 method for class 'sobolrec'
plot(x, ylim = c(0,1), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a function, or a model with a <code>predict</code> method,
defining the model to analyze.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factors</code></td>
<td>
<p>an integer giving the number of factors, or a vector of character strings giving their names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>layers</code></td>
<td>
<p>If <code>order=1</code>, a vector specifying the respective sizes of each layer (see "Details"). If <code>order=2</code>, an integer specifying the size of all layers.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>an integer specifying which indices to estimate: <code>1</code> for first-order indices, <code>2</code> for closed second-order indices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>precision</code></td>
<td>
<p>a vector containing:
</p>

<ul>
<li>
<p> the target precision for the stopping criterion.
</p>
</li>
<li>
<p> the number of steps for the stopping criterion (must be greater than 1).</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tail</code></td>
<td>
<p>a boolean specifying the method used to choose the number of levels of the orthogonal array (see "Warning messages").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>If <code>order=2</code>, a character specifying the method to construct the orthogonal arrays (see "Details"):
</p>

<ul>
<li> <p><code>"al"</code> for the algebraic method 
</p>
</li>
<li> <p><code>"ar"</code> for the accept-reject method
</p>
</li>
</ul>
<p>Set to <code>NULL</code> if <code>order=1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a list of class <code>"sobolrec"</code> storing the state of the
sensitivity study (parameters, data, estimates).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index</code></td>
<td>
<p>an integer specifying the step of the recursion</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the model response.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>y-coordinate plotting limits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>any other arguments for <code>model</code> which are passed
unchanged each time it is called.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For first-order indices, <code>layers</code> is a vector:
</p>
<p style="text-align: center;"><code class="reqn">\left(s_1, ...,s_m \right)</code>
</p>

<p>specifying the number <code class="reqn">m</code> of layers of the nested design whose respective size are given by: 
</p>
<p style="text-align: center;"><code class="reqn">\prod_{i=1}^{k-1} s_i, \ k=2, ...,m+1</code>
</p>

<p>For closed second-order indices, <code>layers</code> directly specifies the size of all layers.
</p>
<p>For each Sobol' index <code class="reqn">S</code> the stopping criterion writes:
</p>
<p style="text-align: center;"><code class="reqn">\mid S_{l-1}-S_{l} \mid &lt; \epsilon</code>
</p>

<p>This criterion is tested for the last <code class="reqn">l_0</code> steps (including the current one). <code class="reqn">\epsilon</code> and <code class="reqn">l_0</code> are respectively the target precision and the number of steps of the stopping criterion specified in <code>precision</code>.
</p>
<p><code>sobolrec</code> uses either an algebraic or an accept-rejet <code>method</code> to construct the orthogonal arrays for the estimation of closed second-order indices. The algebraic method is less precise than the accept-reject method but offers more steps when the number of <code>factors</code> is small.
</p>
<p><code>sobolrec</code> automatically assigns a uniform distribution on [0,1] to each input. Transformations of distributions (between U[0,1] and the wanted distribution) have to be performed before the call to tell().
</p>


<h3>Value</h3>

<p><code>sobolrec</code> returns a list of class <code>"sobolrec"</code>, containing all
the input arguments detailed before, plus the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a <code>data.frame</code> containing the design of experiments (row concatenation of the two replicated designs).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a list of the response used at each step.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>V</code></td>
<td>
<p>a list of the model variance estimated at each step.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>a list of the Sobol' indices estimated at each step.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>steps</code></td>
<td>
<p>the number of steps performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>the size of each replicated nested design.</p>
</td>
</tr>
</table>
<h3>Warning messages</h3>


<dl>
<dt>"The value entered for <code>layers</code> is not the square of a prime number. It has been replaced by: "</dt>
<dd>
<p>When <code>order=2</code>, the value of <code>layers</code> must be the square of a prime power number.  This warning message indicates that it was not the case and the value has been replaced depending on <code>tail</code>. If <code>tail=TRUE</code> (resp. <code>tail=FALSE</code>) the new value of <code>layers</code> is equal to the square of the prime number preceding (resp. following) the square root of <code>layers</code>.</p>
</dd>
<dt>"The value entered for <code>layers</code> is not satisfying the constraint. It has been replaced by: "</dt>
<dd>
<p>the value <code class="reqn">N</code> for <code>layers</code> must satisfied the constraint <code class="reqn">N \geq (d-1)^{2}</code> where <code class="reqn">d</code> is the number of factors. This warning message indicates that <code>N</code> was replaced by the square of the prime number following (or equals to) <code class="reqn">d-1</code>.</p>
</dd>
</dl>
<h3>References</h3>

<p>A.S. Hedayat, N.J.A. Sloane and J. Stufken, 1999, <em>Orthogonal Arrays: Theory and Applications</em>, Springer Series in Statistics.
</p>
<p>L. Gilquin, E. Arnaud, H. Monod and C. Prieur, 2021, <em>Recursive estimation procedure of Sobol' indices based on replicated designs</em>, 
Computational and Applied Mathematics, 40:1â€“23. 
</p>


<h3>Examples</h3>

<pre><code class="language-R">	
# Test case: the non-monotonic Sobol g-function

# The method of sobol requires 2 samples
# (there are 8 factors, all following the uniform distribution on [0,1])

# first-order indices estimation
x &lt;- sobolrec(model = sobol.fun, factors = 8, layers=rep(2,each=15), order=1,
              precision = c(5*10^(-2),2), method=NULL, tail=TRUE)
print(x)

# closed second-order indices estimation
x &lt;- sobolrec(model = sobol.fun, factors = 8, layers=11^2, order=2,
              precision = c(10^(-2),3), method="al", tail=TRUE)
print(x)


# Test case: dealing with external model 
# put in comment because of bug with ask use !

#x &lt;- sobolrec(model = NULL, factors = 8, layers=rep(2,each=15), order=1,
#              precision = c(5*10^(-2),2), method=NULL, tail=TRUE)
#toy &lt;- sobol.fun
#k &lt;- 1
#stop_crit &lt;- FALSE
#while(!(stop_crit) &amp; (k&lt;length(x$layers))){
#  ask(x, index=k)
#  y &lt;- toy(x$block)
#  tell(x, y, index=k)
#  stop_crit &lt;- x$stop_crit
#  k &lt;- k+1
#}
#print(x)


</code></pre>


</div>