<div class="container">

<table style="width: 100%;"><tr>
<td>Vmat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Compute covariance matrix of residuals for general linear models fitted with complex survey data
</h2>

<h3>Description</h3>

<p>Compute a covariance matrix using residuals from a fixed effects, general linear regression model fitted with data collected from one- and two-stage complex survey designs.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Vmat(mobj, stvar = NULL, clvar = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mobj</code></td>
<td>

<p>model object produced by <code>svyglm</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stvar</code></td>
<td>

<p>field in <code>mobj</code> that contains the stratum variable in the complex sample design; use <code>stvar = NULL</code> if there are no strata
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clvar</code></td>
<td>

<p>field in <code>mobj</code> that contains the cluster variable in the complex sample design; use <code>clvar = NULL</code> if there are no clusters
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>Vmat</code> computes a covariance matrix among the residuals returned from <code>svyglm</code> in the <code>survey</code> package. <code>Vmat</code> is called by <code>svyvif</code> when computing variance inflation factors. The matrix that is computed by <code>Vmat</code> is appropriate under these model assumptions: (1) in single-stage, unclustered sampling, units are assumed to be uncorrelated but can have different model variances, (2) in single-stage, stratified sampling, units are assumed to be uncorrelated within strata and between strata but can have different model variances; (3) in unstratified, clustered samples, units in different clusters are assumed to be uncorrelated but units within clusters are correlated; (3) in stratified, clustered samples, units in different strata or clusters are assumed to be uncorrelated but units within clusters are correlated.
</p>


<h3>Value</h3>

<p><code class="reqn">n \times n</code> matrix where <code class="reqn">n</code> is the number of cases used in the linear regression model
</p>


<h3>Author(s)</h3>

<p>Richard Valliant
</p>


<h3>References</h3>

<p>Liao, D, and Valliant, R. (2012). Variance inflation factors in the analysis of complex survey data. <em>Survey Methodology</em>, 38, 53-62.
</p>
<p>Lumley, T. (2010). <em>Complex Surveys</em>. New York: John Wiley &amp; Sons.
</p>
<p>Lumley, T. (2023). survey: analysis of complex survey samples. R package version 4.2.
</p>


<h3>See Also</h3>

<p><code>svyvif</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(Matrix)
require(survey)
data(nhanes2007)
black &lt;- nhanes2007$RIDRETH1 == 4
X &lt;- nhanes2007
X &lt;-  cbind(X, black)
X1 &lt;- X[order(X$SDMVSTRA, X$SDMVPSU),]

    # unstratified, unclustered design
nhanes.dsgn &lt;- svydesign(ids = 1:nrow(X1),
                         strata = NULL,
                         weights = ~WTDRD1, data=X1)
m1 &lt;- svyglm(BMXWT ~ RIDAGEYR + as.factor(black) + DR1TKCAL, design=nhanes.dsgn)
summary(m1)

V &lt;- Vmat(mobj = m1,
          stvar = NULL,
          clvar = NULL)

    # stratified, clustered design
nhanes.dsgn &lt;- svydesign(ids = ~SDMVPSU,
                         strata = ~SDMVSTRA,
                         weights = ~WTDRD1, nest=TRUE, data=X1)
m1 &lt;- svyglm(BMXWT ~ RIDAGEYR + as.factor(black) + DR1TKCAL, design=nhanes.dsgn)
summary(m1)
V &lt;- Vmat(mobj = m1,
          stvar = "SDMVSTRA",
          clvar = "SDMVPSU")
</code></pre>


</div>