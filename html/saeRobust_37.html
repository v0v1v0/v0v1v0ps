<div class="container">

<table style="width: 100%;"><tr>
<td>matU</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Matrix constructor functions</h2>

<h3>Description</h3>

<p>These functions construct different parts of matrix components. They are used
internally. If you are interested in the weights of a model fitted using
rfh please try to use weights.fitrfh on that object.
</p>


<h3>Usage</h3>

<pre><code class="language-R">matU(.V)

matTrace(x)

matB(y, X, beta, re, matV, psi)

matBConst(y, X, beta, matV, psi)

matA(y, X, beta, matV, psi)

matAConst(y, X, matV, psi)

matW(y, X, beta, re, matV, psi)

matWbc(y, reblup, W, samplingVar, c = 1)

matTZ(.nDomains, .nTime)

matTZ1(.nDomains = 10, .nTime = 10)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.V</code></td>
<td>
<p>(Matrix) variance matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>([m|M]atrix) a matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>(numeric) response</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>(Matrix) design matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>(numeric) vector of regression coefficients</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>re</code></td>
<td>
<p>(numeric) vector of random effects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matV</code></td>
<td>
<p>(list of functions) see <code>matVFH</code> for an example</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psi</code></td>
<td>
<p>(function) the influence function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reblup</code></td>
<td>
<p>(numeric) vector with robust best linear unbiased predictions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W</code></td>
<td>
<p>(Matrix) the weighting matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samplingVar</code></td>
<td>
<p>(numeric) the vector of sampling variances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>c</code></td>
<td>
<p>(numeric) scalar</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.nDomains</code></td>
<td>
<p>(integer) number of domains</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.nTime</code></td>
<td>
<p>(integer) number of time periods</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>matU</code> computes U. U is the matrix containing only the diagonal
elements of V. This function returns a list of functions which can be
called to compute specific transformations of U.
</p>
<p><code>matTrace</code> computes the trace of a matrix.
</p>
<p><code>matB</code> computes the matrix B which is used to compute the
weights in the pseudo linearised representation of the REBLUP.
</p>
<p><code>matBConst</code> returns a function with one argument, u, to compute
the matrix B. This function is used internally to compute B in the fixed
point algorithm.
</p>
<p><code>matA</code> computes the matrix A which is used to compute the
weights in the pseudo linearized representation of the REBLUP.
</p>
<p><code>matAConst</code> returns a function with one argument, beta, to
compute the matrix A. This function is used internally to compute A in the
fixed point algorithm for beta.
</p>
<p><code>matW</code> returns a matrix containing the weights as they are
defined for the pseudo linear form, such that <code>matW %*% y</code> is the
REBLUP.
</p>
<p><code>matWbc</code> returns a matrix containing the weights as they are
defined for the pseudo linear form, such that <code>matWbc %*% y</code> is the
bias-corrected REBLUP. <code>c</code> is a multiplyer for the standard deviation.
</p>
<p><code>matTZ</code> constructs the Z matrix in a linear mixed model with
autocorrelated random effects.
</p>
<p><code>matTZ1</code> constructs the Z1 matrix in a linear mixed model with
autocorrelated random effects.
</p>


<h3>References</h3>

<p>Warnholz, S. (2016): "Small Area Estimaiton Using Robust Extension to Area
Level Models". Not published (yet).
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("grapes", package = "sae")
data("grapesprox", package = "sae")

fitRFH &lt;- rfh(
  grapehect ~ area + workdays - 1,
  data = grapes,
  samplingVar = "var"
)

matV &lt;- variance(fitRFH)

# matU:
matU(matV$V())$U()
matU(matV$V())$sqrt()
matU(matV$V())$sqrtInv()

# matB (and matA + matW accordingly):
matB(
  fitRFH$y,
  fitRFH$x,
  fitRFH$coefficients,
  fitRFH$re,
  matV,
  function(x) psiOne(x, k = fitRFH$k)
)

matBConst(
  fitRFH$y,
  fitRFH$x,
  fitRFH$coefficients,
  matV,
  function(x) psiOne(x, k = fitRFH$k)
)(fitRFH$re)

# construcors for 'Z' in linear mixed models
matTZ(2, 3)
matTZ1(2, 3)
</code></pre>


</div>