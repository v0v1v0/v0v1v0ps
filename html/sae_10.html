<div class="container">

<table style="width: 100%;"><tr>
<td>eblupSFH</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> EBLUPs based on a spatial Fay-Herriot model.</h2>

<h3>Description</h3>

<p>This function gives small area estimators based on a spatial Fay-Herriot model, where area effects follow a SAR(1) process. Fitting method can be chosen between REML and ML.
</p>


<h3>Usage</h3>

<pre><code class="language-R">eblupSFH(formula, vardir, proxmat, method = "REML", MAXITER = 100, 
         PRECISION = 0.0001, data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class <code>formula</code> (or one that can be coerced to that class): 
a symbolic description of the model to be fitted. The variables included in <code>formula</code>
must have a length equal to the number of domains <code>D</code>. Details of model specification are given under Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vardir</code></td>
<td>
<p>vector containing the <code>D</code> sampling variances of direct estimators for each domain. 
The values must be sorted as the variables in <code>formula</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proxmat</code></td>
<td>
<p><code>D*D</code> proximity matrix or data frame with values in the interval <code>[0,1]</code> containing the proximities between the row and column domains. The rows add up to 1. The rows and columns of this matrix must be sorted as the elements in <code>formula</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>type of fitting method, to be chosen between <code>"REML"</code> or <code>"ML"</code>. Default value is <code>REML</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MAXITER</code></td>
<td>
<p>maximum number of iterations allowed for the Fisher-scoring algorithm. Default value is <code>100</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PRECISION</code></td>
<td>
<p>convergence tolerance limit for the Fisher-scoring algorithm. Default value is <code>0.0001</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>optional data frame containing the variables named in <code>formula</code> and <code>vardir</code>. By default the variables are taken from the environment from which <code>eblupSHF</code> is called.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A typical model has the form response ~ terms where response is the (numeric) response vector and terms is a series of terms which specifies a linear predictor for response. A terms specification of the form first + second indicates all the terms in first together with all the terms in second with duplicates removed. 
</p>
<p>A formula has an implied intercept term. To remove this use either y ~ x - 1 or y ~ 0 + x. See <code>formula</code> 
for more details of allowed formulae.  
</p>


<h3>Value</h3>

<p>The function returns a list with the following objects:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>eblup</code></td>
<td>
<p>vector with the values of the estimators for the domains.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>a list containing the following objects:
</p>

<ul>
<li>
<p><code>method</code>: type of fitting method applied (<code>"REML"</code> or <code>"ML"</code>).
</p>
</li>
<li>
<p><code>convergence</code>: a logical value equal to <code>TRUE</code> if Fisher-scoring algorithm converges in less than <code>MAXITER</code> iterations.
</p>
</li>
<li>
<p><code>iterations</code>: number of iterations performed by the Fisher-scoring algorithm.
</p>
</li>
<li>
<p><code>estcoef</code>: a data frame with the estimated model coefficients in the first column (<code>beta</code>), 
their asymptotic standard errors in the second column (<code>std.error</code>), 
the <code class="reqn">t</code> statistics in the third column <code>(tvalue)</code> and the p-values of the significance 
of each coefficient in last column <code>(pvalue)</code>.    
</p>
</li>
<li>
<p><code>refvar</code>: estimated random effects variance.
</p>
</li>
<li>
<p><code>spatialcorr</code>: estimated spatial correlation parameter.    
</p>
</li>
<li>
<p><code>goodness</code>: vector containing three goodness-of-fit measures: loglikehood, AIC and BIC.
</p>
</li>
</ul>
</td>
</tr>
</table>
<p>In case that <code>formula</code>, <code>vardir</code> or <code>proxmat</code> contain NA values a message is printed and no action is done.
</p>


<h3>Author(s)</h3>

<p>Isabel Molina, Monica Pratesi and Nicola Salvati.</p>


<h3>References</h3>

 
<p>- Small Area Methods for Poverty and Living Conditions Estimates (SAMPLE), funded by European Commission, Collaborative Project 217565, Call identifier FP7-SSH-2007-1.
</p>
<p>- Molina, I., Salvati, N. and Pratesi, M. (2009). Bootstrap for estimating the MSE of the Spatial EBLUP. Computational Statistics 24, 441-458.
</p>
<p>- Petrucci, A. and Salvati, N. (2006). Small area estimation for spatial correlation in watershed erosion assessment.
Journal of Agricultural, Biological and Environmental Statistics 11, 169-182.
</p>
<p>- Pratesi, M. and Salvati, N. (2008). Small area estimation: the EBLUP estimator based on spatially correlated random area effects. 
Statistical Methods &amp; Applications 17, 113-141.
</p>


<h3>See Also</h3>

<p><code>mseSFH</code>, <code>npbmseSFH</code>, <code>pbmseSFH</code> </p>


<h3>Examples</h3>

<pre><code class="language-R">data(grapes)       # Load data set
data(grapesprox)   # Load proximity matrix 

# Fit Spatial Fay-Herriot model using ML method
resultML &lt;- eblupSFH(grapehect ~ area + workdays - 1, var, grapesprox,
                     method="ML", data=grapes)
resultML

# Fit Spatial Fay-Herriot model using REML method
resultREML &lt;- eblupSFH(grapehect ~ area + workdays - 1, var, grapesprox,
                       data=grapes)
resultREML
</code></pre>


</div>