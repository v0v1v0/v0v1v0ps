<div class="container">

<table style="width: 100%;"><tr>
<td>sim_joint_data_set</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate Individuals from a Joint Survival and Marker Model</h2>

<h3>Description</h3>

<p>Simulates individuals from the following model
</p>
<p style="text-align: center;"><code class="reqn">\vec U_i \sim N^{(K)}(\vec 0, \Psi)</code>
</p>

<p style="text-align: center;"><code class="reqn">\vec Y_{ij} \mid \vec U_i = \vec u_i \sim N^{(r)}(\vec \mu_i(s_{ij}, \vec u_i), \Sigma)</code>
</p>

<p style="text-align: center;"><code class="reqn">h(t \mid \vec u) = \exp(\vec\omega^\top\vec b(t) + \vec\delta^\top\vec z_i +
  \vec 1^\top(diag(\vec \alpha) \otimes \vec x_i^\top)vec(\Gamma) +
  \vec 1^\top(diag(\vec \alpha) \otimes \vec g(t)^\top)vec(B) +
  \vec 1^\top(diag(\vec \alpha) \otimes \vec m(t)^\top)\vec u)</code>
</p>

<p>with
</p>
<p style="text-align: center;"><code class="reqn">\vec\mu_i(s, \vec u) = (I \otimes \vec x_i^\top)vec(\Gamma) + \left(I \otimes \vec g(s)^\top\right)vec(B) + \left(I \otimes \vec m(s)^\top\right) \vec u</code>
</p>

<p>where <code class="reqn">h(t \mid \vec u)</code> is the conditional hazard function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim_joint_data_set(
  n_obs,
  B,
  Psi,
  omega,
  delta,
  alpha,
  sigma,
  gamma,
  b_func,
  m_func,
  g_func,
  r_z,
  r_left_trunc,
  r_right_cens,
  r_n_marker,
  r_x,
  r_obs_time,
  y_max,
  use_fixed_latent = TRUE,
  m_func_surv = m_func,
  g_func_surv = g_func,
  gl_dat = get_gl_rule(30L),
  tol = .Machine$double.eps^(1/4)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n_obs</code></td>
<td>
<p>integer with the number of individuals to draw.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>coefficient matrix for time-varying fixed effects.
Use <code>NULL</code> if there is no effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Psi</code></td>
<td>
<p>the random effects' covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omega</code></td>
<td>
<p>numeric vector with coefficients for the baseline hazard.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>coefficients for fixed effects in the log hazard.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>numeric vector with association parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>the noise's covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>coefficient matrix for the non-time-varying fixed effects.
Use <code>NULL</code> if there is no effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b_func</code></td>
<td>
<p>basis function for the baseline hazard like <code>poly</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m_func</code></td>
<td>
<p>basis function for <code>U</code> like <code>poly</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>g_func</code></td>
<td>
<p>basis function for <code>B</code> like <code>poly</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_z</code></td>
<td>
<p>generator for the covariates in the log hazard. Takes an
integer for the individual's id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_left_trunc</code></td>
<td>
<p>generator for the left-truncation time.
Takes an integer for the individual's id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_right_cens</code></td>
<td>
<p>generator for the right-censoring time. Takes an
integer for the individual's id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_n_marker</code></td>
<td>
<p>function to generate the number of observed markers.
Takes an integer for the individual's id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_x</code></td>
<td>
<p>generator for the covariates in for the markers. Takes an
integer for the individual's id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_obs_time</code></td>
<td>
<p>function to generate the observations times given the
number of observed markers. Takes an
integer for the number of markers and an integer
for the individual's id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y_max</code></td>
<td>
<p>maximum survival time before administrative censoring.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_fixed_latent</code></td>
<td>
<p>logical for whether to include the
<code class="reqn">\vec 1^\top(diag(\vec \alpha) \otimes \vec x_i^\top)vec(\Gamma)</code>
term in the log hazard. Useful if derivatives of
the latent mean should be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m_func_surv</code></td>
<td>
<p>basis function for <code>U</code> like <code>poly</code>
in the log hazard. Can be different from
<code>m_func</code>. Useful if derivatives of the latent
mean should be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>g_func_surv</code></td>
<td>
<p>basis function for <code>B</code> like <code>poly</code>
in the log hazard. Can be different from
<code>g_func</code>. Useful if derivatives of the latent
mean should be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gl_dat</code></td>
<td>
<p>Gaussâ€“Legendre quadrature data.
See <code>get_gl_rule</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>convergence tolerance passed to <code>uniroot</code>.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p>See the examples on Github at
<a href="https://github.com/boennecd/SimSurvNMarker/tree/master/inst/test-data">https://github.com/boennecd/SimSurvNMarker/tree/master/inst/test-data</a>
or this vignette
<code>vignette("SimSurvNMarker", package = "SimSurvNMarker")</code>.
</p>
<p><code>sim_marker</code> and <code>surv_func_joint</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#####
# example with polynomial basis functions
b_func &lt;- function(x){
  x &lt;- x - 1
  cbind(x^3, x^2, x)
}
g_func &lt;- function(x){
  x &lt;- x - 1
  cbind(x^3, x^2, x)
}
m_func &lt;- function(x){
  x &lt;- x - 1
  cbind(x^2, x, 1)
}

# parameters
delta &lt;- c(-.5, -.5, .5)
gamma &lt;- matrix(c(.25, .5, 0, -.4, 0, .3), 3, 2)
omega &lt;- c(1.4, -1.2, -2.1)
Psi &lt;- structure(c(0.18, 0.05, -0.05, 0.1, -0.02, 0.06, 0.05, 0.34, -0.25,
                   -0.06, -0.03, 0.29, -0.05, -0.25, 0.24, 0.04, 0.04,
                   -0.12, 0.1, -0.06, 0.04, 0.34, 0, -0.04, -0.02, -0.03,
                   0.04, 0, 0.1, -0.08, 0.06, 0.29, -0.12, -0.04, -0.08,
                   0.51), .Dim = c(6L, 6L))
B &lt;- structure(c(-0.57, 0.17, -0.48, 0.58, 1, 0.86), .Dim = 3:2)
sig &lt;- diag(c(.6, .3)^2)
alpha &lt;- c(.5, .9)

# generator functions
r_n_marker &lt;- function(id)
  # the number of markers is Poisson distributed
  rpois(1, 10) + 1L
r_obs_time &lt;- function(id, n_markes)
  # the observations times are uniform distributed
  sort(runif(n_markes, 0, 2))
r_z &lt;- function(id)
  # return a design matrix for a dummy setup
  cbind(1, (id %% 3) == 1, (id %% 3) == 2)
r_x &lt;- r_z # same covariates for the fixed effects
r_left_trunc &lt;- function(id)
  # no left-truncation
  0
r_right_cens &lt;- function(id)
  # right-censoring time is exponentially distributed
  rexp(1, rate = .5)

# simulate
gl_dat &lt;- get_gl_rule(30L)
y_max &lt;- 2
n_obs &lt;- 100L
set.seed(1)
dat &lt;- sim_joint_data_set(
  n_obs = n_obs, B = B, Psi = Psi, omega = omega, delta = delta,
  alpha = alpha, sigma = sig, gamma = gamma, b_func = b_func,
  m_func = m_func, g_func = g_func, r_z = r_z, r_left_trunc = r_left_trunc,
  r_right_cens = r_right_cens, r_n_marker = r_n_marker, r_x = r_x,
  r_obs_time = r_obs_time, y_max = y_max)

# checks
stopifnot(
  NROW(dat$survival_data) == n_obs,
  NROW(dat$marker_data) &gt;= n_obs,
  all(dat$survival_data$y &lt;= y_max))

</code></pre>


</div>