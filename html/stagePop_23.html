<div class="container">

<table style="width: 100%;"><tr>
<td>popModel</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>popModel</h2>

<h3>Description</h3>

<p>Run the core model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">popModel(
  numSpecies,
  numStages,
  numStrains = rep(1, numSpecies),
  timeVec,
  speciesNames,
  stageNames,
  rateFunctions = defaultRateFunctions,
  ICs,
  timeDependLoss = rep(TRUE, numSpecies),
  timeDependDuration = rep(FALSE, numSpecies),
  solverOptions = list(),
  checkForNegs = TRUE,
  ntol = 0.01,
  plotFigs = TRUE,
  saveFig = FALSE,
  figType = "eps",
  figName = "stagePopFig",
  sumOverStrains = TRUE,
  plotStrainsFig = TRUE,
  saveStrainsFig = FALSE,
  strainsFigType = "eps",
  strainsFigName = "strainFig"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>numSpecies</code></td>
<td>
<p>Number of species (integer)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numStages</code></td>
<td>
<p>Number of life-stages in each species (vector)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numStrains</code></td>
<td>
<p>Number of strains in each species (vector). Default is 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeVec</code></td>
<td>
<p>Vector of times the solution should be output out e.g. seq(1,10,0.1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>speciesNames</code></td>
<td>
<p>A vector of strings containing the name for each species.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stageNames</code></td>
<td>
<p>A list of n vectors (where n is the number of species) containing the names of each stage for each species.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rateFunctions</code></td>
<td>
<p>A list of rate functions to use. See <code>RateFunctions</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ICs</code></td>
<td>
<p>is a list of matrices containing the initial conditions for every stage and strain of each species. These must be zero for all stages apart from the reproductive stage (usually the last stage). Each species has a matrix with the number of columns equal to the number of strains in that species and the number of rows equal to the number of stages in that species. E.g. for 2 species, the first with 2 strains and 3 stages, the second with 1 strain and 1 stage, then for zero starting conditions: ICs=list(matrix(0,ncol=2,nrow=3),matrix(0,ncol=1,nrow=1)). Due to the restrictions on initial conditions, it is recommended that more complicated initial conditions are defined through immigration rates in immigrationFunc</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeDependLoss</code></td>
<td>
<p>A vector specifying TRUE/FALSE for each species. If a species has any time dependent per capita death or emigration rates, the entry in the vector must be TRUE. The default is TRUE for each species.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeDependDuration</code></td>
<td>
<p>A vector specifying TRUE/FALSE for each species. If a species has any time dependent stage durations the entry is TRUE for that species. The default is FALSE for each species.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>solverOptions</code></td>
<td>
<p>Options for the DDE solver. A list containing 'DDEsolver' (can be 'deSolve' or 'PBS'), 'tol' (max error tolerance for DDE solver), 'hbsize' (history buffer size), 'method' (method for DDE solver), 'atol' (absolute tolerance (deSolve only)) and 'dt' (maximum initial timestep (PBS only)). Default is solverOptions=list(DDEsolver='PBS',tol=1e-7,hbsize=1e3,method='lsoda',atol=1e-7,dt=0.1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>checkForNegs</code></td>
<td>
<p>If TRUE the function checkSolution is called and the solution for each variable, x, is checked for negative values that are greater in magnitude than ntol*max(x). If negative values occur then the solution is incorect and either the problem is incorrectly specified or the tolerances in the DDE solver need to be smaller. The default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntol</code></td>
<td>
<p>This controls the tolerance on the warning given for negative values when checkSolution is called. The default is 0.01 i.e. negative values whose magnitude is less than 1 percent of the max value of the variable are allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotFigs</code></td>
<td>
<p>If TRUE, results will be automatically plotted during the model run. The default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveFig</code></td>
<td>
<p>Choose to save the figure (TRUE or FALSE). Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>figType</code></td>
<td>
<p>Figure format can be 'eps', 'tiff' or 'png'. Default is 'eps'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>figName</code></td>
<td>
<p>filepath to save figure to. Default is 'stagePopFig'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sumOverStrains</code></td>
<td>
<p>If any of the species contain multiple strains then if this is TRUE the output is given as the sum over all the strains in the species. If this is FALSE then the time series for each strain will be in the output. Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotStrainsFig</code></td>
<td>
<p>If any of the species contain multiple strains then if this is TRUE these will be plotted. Default is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveStrainsFig</code></td>
<td>
<p>If any of the species contain multiple strains then if this is TRUE the figures for the strains will be saveed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strainsFigType</code></td>
<td>
<p>If any of the species contain multiple strains and if saveStrainsFig=TRUE then this is used to choose the type of file the figure is saved as (choose from 'eps', 'png' and 'tiff'). Default is 'eps'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strainsFigName</code></td>
<td>
<p>If any of the species contain multiple strains and if saveStrainsFig=TRUE then this is used to choose the name of file the figure is saved as. Default is created by paste('strainFig',SpeciesName[i]).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The default solver options are:
</p>
<p><code>list('DDEsolver'='deSolve','tol'=1e-7,'hbsize'=1e3,'method'=lsoda,'atol'=1e-7,'dt'=0.1)</code>
</p>
<p>but these may be changed by use of the <code>solverOptions</code>
parameter. Please see <code>SolverOptions</code> for details of this
parameter.
</p>


<h3>Value</h3>

<p>The model output is a matrix where rows are points in time and the columns are the state variables. These are named according to the species names and stage names supplied in inputs; the prefixes 'prob', 'dur' and 'dot' refer to the probability of survival through the stage, the duration of the stage and the rate of change of the variable. 'prob' type variables only appear if the per capita death (or emigration) rate is variable in time and 'dur' only appears if the stage duration is variable in time.
</p>


<h3>Examples</h3>

<pre><code class="language-R">rateFuncs=list(
  reproFunc=function(x,time,species,strain){
   v=10*x$flies['adults',1]*exp(-x$flies['adults',1]/100)
   return(max(v,0))
 },
 deathFunc=function(stage,x,time,species,strain){
   a=c(0.05,0.1,0.1); return(a[stage])
 },
 durationFunc=function(stage,x,time,species,strain){
   a=c(5,10); return(a[stage])
 },
 immigrationFunc=function(stage,x,time,species,strain){
   v=0
   if (stage==3 &amp; time&lt;1){v=100}; return(v)},
 emigrationFunc=function(stage,x,time,species,strain){return(0)}
)

modelOutput = popModel(
 numSpecies=1,
 numStages=3,
 ICs=list(matrix(0,nrow=3,ncol=1)),
 timeVec=seq(0,100,0.5),
 timeDependLoss=FALSE,
 timeDependDuration=FALSE,
 rateFunctions=rateFuncs,
 solverOptions=list(DDEsolver='PBS',tol=1e-4,hbsize=1e4,dt=0.01),
 stageNames=list(c('eggs','larvae','adults')),
 speciesNames=c('flies'),
 plotFigs=FALSE #change this to TRUE to see graphical output
 )
</code></pre>


</div>