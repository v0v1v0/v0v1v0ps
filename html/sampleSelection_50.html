<div class="container">

<table style="width: 100%;"><tr>
<td>selection</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Heckman-style selection and treatment effect models</h2>

<h3>Description</h3>

<p>This is the frontend for estimating Heckman-style selection
models either with
one or two outcomes (also known as generalized tobit models).  It
supports binary outcomes and interval outcomes in the single-outcome case.
It also supports normal-distribution based treatment effect models.
</p>
<p>For model specification and more details, see Toomet and Henningsen
(2008) and the included vignettes “Sample Selection Models”,
“Interval Regression with Sample Selection”, and
“All-Normal Treatment Effects”.
</p>


<h3>Usage</h3>

<pre><code class="language-R">selection(selection, outcome, data = sys.frame(sys.parent()),
   weights = NULL, subset, method = "ml",
   type = NULL,
   start = NULL,
   boundaries = NULL,
   ys = FALSE, xs = FALSE, yo = FALSE, xo = FALSE,
   mfs = FALSE, mfo = FALSE,
   printLevel = print.level, print.level=0,
   ...)

heckit( selection, outcome, data = sys.frame(sys.parent()),
   method = "2step", ... )

treatReg(selection, outcome,
   data=sys.frame(sys.parent()),
   mfs=TRUE, mfo=TRUE,
   ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>selection</code></td>
<td>
<p>formula, the selection equation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome</code></td>
<td>
<p>the outcome equation(s).  Either a single equation (for
tobit 2 models), or a list of two equations (tobit 5 models).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame, list or environment (or object
coercible by <code>as.data.frame</code> to a data frame) containing the
variables in the model.  If not found in <code>data</code>, the
variables are taken from <code>environment(formula)</code>, typically
the environment from which <code>selection</code> is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>an optional vector of ‘prior weights’ 
to be used in the fitting process. Should be NULL or a numeric vector.
Weights are currently only supported in type-2 models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>an optional index vector specifying a subset of
observations to be used in the fitting process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>how to estimate the model.  Either <code>"ml"</code> for Maximum
Likelihood, <code>"2step"</code> for 2-step estimation,
or <code>"model.frame"</code> for returning the model frame (only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>model type.  <code>NULL</code> will automatically detect the
type, but one may also manually determine it.  Numeric ‘2’ and ‘5’ are
tobit-2 and tobit-5 models respectively, and character “treatment” is treatment
effect model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>vector, initial values for the ML estimation.  If
<code>start</code> does not have names, names are constructed based on the
model frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boundaries</code></td>
<td>
<p>an optional vector of boundaries of the intervals
of the dependent variable of the outcome equation
for sample selection models with interval regression
of the outcome equation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ys, yo, xs, xo, mfs, mfo</code></td>
<td>
<p>logicals.  If true, the response (<code>y</code>),
model matrix (<code>x</code>) or the model frame (<code>mf</code>)
of the selection (<code>s</code>) or outcome
(<code>o</code>) equation(s) are returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>printLevel, print.level</code></td>
<td>
<p>integer.  Various debugging information, higher
value gives more information.  The preferred option is ‘printLevel’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional parameters for the corresponding fitting
functions <code>tobit2fit</code>, <code>tobit5fit</code>,
<code>heckit2fit</code>, <code>heckit5fit</code>,
and <code>tobit2Bfit</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The dependent variable of of the selection equation
(specified by argument <code>selection</code>) must have exactly
two levels (e.g., 'FALSE' and 'TRUE', or '0' and '1').
By default the levels are sorted in increasing order
('FALSE' is before 'TRUE', and '0' is before '1').
If the dependent variable of the outcome equation
(specified by argument <code>outcome</code>) has exactly two levels,
this variable is modelled as a binary variable.
If argument <code>boundaries</code> is specified,
the outcome equation is estimated as interval regression model
and the dependent variable of the outcome equation
must be a categorical (factor) variable
or a variable of strictly positive integer values,
whereas the vector specified by argument <code>boundaries</code>
must have one more element than the number of levels
or the largest integer, respectively.
In all other cases, it is assumed
that the dependent variable of the outcome equation is continuous
and an ordinary sample selection model is estimated. 
</p>
<p>For tobit-2 (sample selection) models,
only those observations are included in the second step estimation
(argument 'outcome'),
where the dependent variable variable of the selection equation
equals the second element of its levels (e.g., 'TRUE' or '1').  
</p>
<p>For tobit-5 (switching regression) models,
in the second step the first outcome equation
(first element of argument 'outcome') is estimated
only for those observations,
where the dependent variable of the selection equation
equals the first element of its levels (e.g., 'FALSE' or '0').
The second outcome equation is estimated
only for those observations,
where this variable equals the second element of its levels
(e.g., 'TRUE' or '1').
</p>
<p>Treatment effect models are a version of tobit-5 models where the two
outcomes are “participation” and “non-participation”.
<code>treatReg</code>
takes an equal set of explanatory variables for both of these choices
and assumes that the corresponding parameters are equal.  In typical
treatment effect model the selection outcome variable (participation
decision) is included as an explanatory variable for the outcome.
If this is not done, <code>treatReg</code> amounts to estimating two
equations with correlated error structure.
</p>
<p><code>NA</code>-s are allowed in the data.  These are ignored if the
corresponding outcome is unobserved, otherwise observations which
contain <code>NA</code> (either in selection or outcome) are
removed.
</p>
<p>These selection models assume a known (multivariate normal)
distribution
of error terms.  Because of this, the instruments (exclusion
restrictions) are not necessary.  However, if no instruments are
supplied, the results are based solely on the assumption on
multivariate normality.  This may or may not be an appropriate
assumption for a particular problem.  Note also that standard errors
tend to be large without a strong
exclusion restriction.
</p>
<p>If argument <code>method</code> is equal to <code>"ml"</code> (the default),
the estimation is done by the maximum likelihood method,
where the Newton-Raphson algorithm is used by default.
Argument <code>maxMethod</code> (see <code>tobit2fit</code>) 
can be used to chose other algorithms for the maximisation 
of the (log) likelihood function.
</p>
<p>If argument <code>method</code> is equal to <code>"ml"</code> (the default)
and argument <code>start</code> is <code>NULL</code> (the default),
the starting values for the maximum-likelihood (ML) estimation
of a tobit-2 or tobit-5 model
are obtained by an initial two-step estimation of this model.
</p>
<p>The two-step estimation of interval-regression models with sample-selection
has not yet been implemented.
If no starting values for a maximum-likelihood (ML) estimation
of an interval-regression model with sample-selection
are specified (i.e., argument <code>start</code> is <code>NULL</code>, the default),
starting values are obtained by an initial estimation of a tobit-2 model,
where the dependent variable of the outcome equation
is set to the mid points of the boudaries of the intervals.
By default, the starting values are obtained
by a maximum-likelihood (ML) estimation of the tobit-2 model,
whereas the starting values
for the maximum-likelihood (ML) estimation of the tobit-2 model
are obtained by a 2-step estimation of the tobit-2 model.
If argument <code>start</code> is set to <code>"2step"</code>,
the starting values for the maximum-likelihood (ML) estimation
of an interval-regression model with sample-selection
are directly obtained by a 2-step estimation of the tobit-2 model
(i.e., without a subsequent ML estimation of the tobit-2 model).
</p>
<p>Methods that can be applied to objects returned by <code>selection()</code>
are described on the help page <code>selection-methods</code>.
</p>


<h3>Value</h3>

<p>'selection' returns an object of class "selection".
If the model estimated by Maximum Likelihood (argument method = "ml"),
this object is a list, which has all the components of a 'maxLik' object, and in
addition the elements 'twoStep', 'start, 'param', 'termS', 'termO',
'outcomeVar', and if requested 'ys', 'xs', 'yo', 'xo', 'mfs', and 'mfo'.
If a tobit-2 (sample selection) model is estimated by the
two-step method (argument method = "2step"),
the returned object is a list with components
'probit', 'coefficients', 'param', 'vcov', 'lm', 'sigma', 'rho',
'invMillsRatio', and 'imrDelta'.
If a tobit-5 (switching regression) model is estimated by the
two-step method (argument method = "2step"),
the returned object is a list with components
'coefficients', 'vcov', 'probit', 'lm1', 'lm2', 'rho1', 'rho2',
'sigma1', 'sigma2', 'termsS', 'termsO', 'param',
and if requested 'ys', 'xs', 'yo', 'xo', 'mfs', and 'mfo'.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>probit</code></td>
<td>
<p>object of class 'probit' that contains the results of the
1st step (probit estimation) (only for two-step estimations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>twoStep</code></td>
<td>
<p>(only if initial values not given)
results of the 2-step estimation, used for initial values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>initial values for ML estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>termsS, termsO</code></td>
<td>
<p>terms for the selection and outcome equation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ys, xs, yo, xo, mfs, mfo</code></td>
<td>
<p>response, matrix and frame of the
selection- and outcome equations (as a list of two for the latter).
NULL, if not requested.  The
response is represented internally as 0/1 integer vector with 0
denoting either the unobservable outcome (tobit 2) or the first
selection (tobit 5).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>estimated coefficients, the complete model.
coefficient for the Inverse Mills ratio is treated as a parameter
(<code class="reqn">=\varrho \sigma</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcov</code></td>
<td>
<p>variance covariance matrix of the estimated coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param</code></td>
<td>
<p>a list with following components: <code>index</code>, a list of
numeric vectors: where in the <code>coef</code> the component are
located;
<code>oIntercept</code>, a logical: whether the outcome equation includes
intercept;
<code>N0, N1</code>, integer, number of observations with unobserved and
observed outcomes;
<code>nObs</code>, integer, number of valid observations;
<code>nParam</code>, integer, number of the parameters in the model (not
all are independent);
<code>df</code>, integer, degrees of freedom.  Note this is not equal to
<code>nObs - nParam</code> because of the parameters are not independent
in all the cases;
<code>levels</code> levels for the response of the selection equation.
<code>levels[1]</code> corresponds to the outcome 1, <code>levels[2]</code> to
the outcome 2.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lm, lm1, lm2</code></td>
<td>
<p>objects of class 'lm' that contain the results
of the 2nd step estimation(s) of the outcome equation(s).
Note: the standard errors of this
estimation are biased, because they do not account for the
estimation of <code class="reqn">\gamma</code> in the 1st step estimation
(the correct standard errors are returned by <code>summary</code> and they
are contained in <code>vcov</code> component).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma, sigma1, sigma2</code></td>
<td>
<p>the standard error(s)
of the error terms of the outcome equation(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho, rho1, rho2</code></td>
<td>
<p>the estimated correlation coefficient(s)
between the error term of the selection equation
and the outcome equation(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>invMillsRatio</code></td>
<td>
<p>the inverse Mills Ratios calculated from the results of
the 1st step probit estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imrDelta</code></td>
<td>
<p>the <code class="reqn">\delta</code>s calculated from the inverse Mills Ratios and
the results of the 1st step probit estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcomeVar</code></td>
<td>
<p>character string indicating whether the dependent variable
of the outcome equation is <code>"continuous"</code> or <code>"binary"</code>.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The 2-step estimate of 'rho' may be outside of the
<code class="reqn">[-1,1]</code> interval.  In that case the standard errors of
invMillsRatio may be meaningless.
</p>


<h3>Author(s)</h3>

<p>Arne Henningsen,
Ott Toomet <a href="mailto:otoomet@ut.ee">otoomet@ut.ee</a></p>


<h3>References</h3>

<p>Cameron, A. C. and Trivedi, P. K. (2005)
<em>Microeconometrics: Methods and Applications</em>,
Cambridge University Press.
</p>
<p>Greene, W. H. (2003)
<em>Econometric Analysis, Fifth Edition</em>, Prentice Hall.
</p>
<p>Heckman, J. (1976)
The common structure of statistical models of
truncation, sample selection and limited dependent
variables and a simple estimator for such models,
<em>Annals of Economic and Social Measurement</em>,
5(4), p. 475-492.
</p>
<p>Johnston, J. and J. DiNardo (1997)
<em>Econometric Methods, Fourth Edition</em>, McGraw-Hill.
</p>
<p>Lee, L., G. Maddala and R. Trost (1980)
Asymetric covariance matrices of two-stage probit and two-stage tobit
methods for simultaneous equations models with selectivity.
<em>Econometrica</em>, 48, p. 491-503.
</p>
<p>Petersen, S., G. Henningsen and A. Henningsen (2017)
<em>Which Households Invest in Energy-Saving Home Improvements?
Evidence From a Danish Policy Intervention</em>.
Unpublished Manuscript.
Department of Management Engineering, Technical University of Denmark.
</p>
<p>Toomet, O. and A. Henningsen, (2008)
Sample Selection Models in R: Package sampleSelection.
<em>Journal of Statistical Software</em> 27(7),
<a href="https://www.jstatsoft.org/v27/i07/">https://www.jstatsoft.org/v27/i07/</a>
</p>
<p>Wooldridge, J. M. (2003)
<em>Introductory Econometrics: A Modern Approach, 2e</em>, Thomson South-Western.
</p>


<h3>See Also</h3>

<p><code>summary.selection</code>, <code>selection-methods</code>,
<code>probit</code>, <code>lm</code>,
and <code>Mroz87</code> and <code>RandHIE</code>
for further examples.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Greene( 2003 ): example 22.8, page 786
data( Mroz87 )
Mroz87$kids  &lt;- ( Mroz87$kids5 + Mroz87$kids618 &gt; 0 )
# Two-step estimation
summary( heckit( lfp ~ age + I( age^2 ) + faminc + kids + educ,
   wage ~ exper + I( exper^2 ) + educ + city, Mroz87 ) )
# ML estimation
summary( selection( lfp ~ age + I( age^2 ) + faminc + kids + educ,
   wage ~ exper + I( exper^2 ) + educ + city, Mroz87 ) )

## Example using binary outcome for selection model.
## We estimate the probability of womens' education on their
## chances to get high wage (&gt; $5/hr in 1975 USD), using PSID data
## We use education as explanatory variable
## and add age, kids, and non-work income as exclusion restrictions.
data(Mroz87)
m &lt;- selection(lfp ~ educ + age + kids5 + kids618 + nwifeinc,
   wage &gt;= 5 ~ educ, data = Mroz87 )
summary(m)


## example using random numbers
library( "mvtnorm" )
nObs &lt;- 1000
sigma &lt;- matrix( c( 1, -0.7, -0.7, 1 ), ncol = 2 )
errorTerms &lt;- rmvnorm( nObs, c( 0, 0 ), sigma )
myData &lt;- data.frame( no = c( 1:nObs ), x1 = rnorm( nObs ), x2 = rnorm( nObs ),
   u1 = errorTerms[ , 1 ], u2 =  errorTerms[ , 2 ] )
myData$y &lt;- 2 + myData$x1 + myData$u1
myData$s &lt;- ( 2 * myData$x1 + myData$x2 + myData$u2 - 0.2 ) &gt; 0
myData$y[ !myData$s ] &lt;- NA
myOls &lt;- lm( y ~ x1, data = myData)
summary( myOls )
myHeckit &lt;- heckit( s ~ x1 + x2, y ~ x1, myData, print.level = 1 )
summary( myHeckit )

## example using random numbers with IV/2SLS estimation
library( "mvtnorm" )
nObs &lt;- 1000
sigma &lt;- matrix( c( 1, 0.5, 0.1, 0.5, 1, -0.3, 0.1, -0.3, 1 ), ncol = 3 )
errorTerms &lt;- rmvnorm( nObs, c( 0, 0, 0 ), sigma )
myData &lt;- data.frame( no = c( 1:nObs ), x1 = rnorm( nObs ), x2 = rnorm( nObs ),
   u1 = errorTerms[ , 1 ], u2 = errorTerms[ , 2 ], u3 = errorTerms[ , 3 ] )
myData$w &lt;- 1 + myData$x1 + myData$u1
myData$y &lt;- 2 + myData$w + myData$u2
myData$s &lt;- ( 2 * myData$x1 + myData$x2 + myData$u3 - 0.2 ) &gt; 0
myData$y[ !myData$s ] &lt;- NA
myHeckit &lt;- heckit( s ~ x1 + x2, y ~ w, data = myData )
summary( myHeckit )  # biased!
myHeckitIv &lt;- heckit( s ~ x1 + x2, y ~ w, data = myData, inst = ~ x1 )
summary( myHeckitIv ) # unbiased

## tobit-5 example
N &lt;- 500
   library(mvtnorm)
   vc &lt;- diag(3)
   vc[lower.tri(vc)] &lt;- c(0.9, 0.5, 0.6)
   vc[upper.tri(vc)] &lt;- vc[lower.tri(vc)]
   eps &lt;- rmvnorm(N, rep(0, 3), vc)
   xs &lt;- runif(N)
   ys &lt;- xs + eps[,1] &gt; 0
   xo1 &lt;- runif(N)
   yo1 &lt;- xo1 + eps[,2]
   xo2 &lt;- runif(N)
   yo2 &lt;- xo2 + eps[,3]
   a &lt;- selection(ys~xs, list(yo1 ~ xo1, yo2 ~ xo2))
   summary(a)

## tobit2 example
   vc &lt;- diag(2)
   vc[2,1] &lt;- vc[1,2] &lt;- -0.7
   eps &lt;- rmvnorm(N, rep(0, 2), vc)
   xs &lt;- runif(N)
   ys &lt;- xs + eps[,1] &gt; 0
   xo &lt;- runif(N)
   yo &lt;- (xo + eps[,2])*(ys &gt; 0)
   a &lt;- selection(ys~xs, yo ~xo)
   summary(a)

## Example for treatment regressions
## Estimate the effect of treatment on income
## selection outcome: treatment participation, logical (treatment)
## selection explanatory variables: age, education (years)
##   unemployment in 1974, 1975, race
## outcome: log real income 1978
## outcome explanatory variables: treatment, age, education, race.
## unemployment variables are treated as exclusion restriction
data(Treatment, package="Ecdat")
a &lt;- treatReg(treat~poly(age,2) + educ + u74 + u75 + ethn,
              log(re78)~treat + poly(age,2) + educ + ethn,
              data=Treatment)
print(summary(a))
</code></pre>


</div>