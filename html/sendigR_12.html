<div class="container">

<table style="width: 100%;"><tr>
<td>getFindingsSubjAge</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add the subject age at finding time - and optionally extract the set of
findings within a specified range of age.</h2>

<h3>Description</h3>

<p>Returns a data table with the set of findings rows included in the
<code>findings</code> where the age of subjects at finding time is within the
interval specified in <code>fromAge</code> to <code>fromAge</code>.<br>
If the <code>fromAge</code> and <code>fromAge</code> are empty (null, na or empty
string), all rows from <code>findings</code> are returned.
</p>


<h3>Usage</h3>

<pre><code class="language-R">getFindingsSubjAge(
  dbToken,
  findings,
  animalList,
  fromAge = NULL,
  toAge = NULL,
  inclUncertain = FALSE,
  noFilterReportUncertain = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dbToken</code></td>
<td>
<p>Mandatory<br>
Token for the open database connection (see <code>initEnvironment</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>findings</code></td>
<td>
<p>Mandatory, data.table.<br>
A table with the set of input finding rows to process.<br>
The table must include at least columns named
</p>

<ul>
<li> <p><code>STUDYID</code>
</p>
</li>
<li> <p><code>USUBJID</code>
</p>
</li>
<li> <p><code>DOMAIN</code>
</p>
</li>
<li> <p><code>[domain]SEQ</code>
</p>
</li>
<li> <p><code>[domain]DY</code>
</p>
</li>
<li> <p><code>[domain]DTC</code>
</p>
</li>
</ul>
<p>where <code>[domain]</code> is the name of the actual findings domain - e.g. <code>LBSEQ</code>, <code>LBDY</code>
and <code>LBDTC</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>animalList</code></td>
<td>
<p>Mandatory, data.table.<br>
A data with the set of animals included in the <code>findings</code> table
(may contain more animals than included in <code>findings</code>).<br>
The data set must contain at least these columns returned by the function getControlSubj
</p>

<ul>
<li> <p><code>STUDYID</code>
</p>
</li>
<li> <p><code>USUBJID</code>
</p>
</li>
<li> <p><code>RFSTDTC</code>
</p>
</li>
<li> <p><code>DM_AGEDAYS</code>
</p>
</li>
<li> <p><code>NO_AGE_MSG</code>
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fromAge</code></td>
<td>
<p>Optional, character <br>
The start of age interval to extract.<br>
Must be in a string in this format:<br><code>[value][age unit]</code> where <code>[age unit]</code> is one of
</p>

<ul>
<li> <p><code>d, day, days</code>
</p>
</li>
<li> <p><code>w, week, weeks</code>
</p>
</li>
<li> <p><code>m, month, months</code>
</p>
</li>
<li> <p><code>y, year, years</code>
</p>
</li>
</ul>
<p>The unit is case-insensitive, space(s) between age value and unit is
allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>toAge</code></td>
<td>
<p>Optional. character <br>
The start of age interval to extract.<br>
Must be in a string in in the same format as described for <code>fromAge</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inclUncertain</code></td>
<td>
<p>Mandatory, boolean.<br>
Only relevant if the <code>fromAge</code> and/or <code>toAge</code> is/are not empty.<br>
Indicates whether finding rows for which the age at finding time cannot be
confidently identified, shall be included or not in the output data table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noFilterReportUncertain</code></td>
<td>
<p>Optional, boolean.<br>
Only relevant if the <code>fromAge</code> and <code>toAge</code> are empty.<br>
Indicates if the reason should be included if the age at finding time cannot
be confidently decided for an animal.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In both situation, the subject age at finding time is calculated into an
additional column <code>AGEDAYS</code> for each row in <code>findings</code> combined
with the the additional input data.table <code>animalList</code> using this
algorithm:
</p>

<ul>
<li>
<p> Determine the number of study days between study start and findings
</p>

<ul>
<li>
<p> if <code>findings.[domain]DY</code> is populated
</p>

<ul>
<li>
<p> If <code>findings.[domain]DY &gt; 0</code> then use
<code>findings.[domain]DY - 1</code>
</p>
</li>
<li>
<p> Else use <code>findings.[domain]DY</code>
</p>
</li>
</ul>
</li>
<li>
<p> Else If <code>findings.[domain]DTC</code> is populated compute
<code>animalList.RFSTDTC â€“ findings.[domain]DTC</code> in days<br> where
<code>animalList.RFSTDTC</code> is each subject's reference start date
(<code>DM.RFSTDTC</code>)
</p>
</li>
</ul>
</li>
<li>
<p> Animal age at time of finding is then calculated as
<code>animalList.AGEDAYS + [study days between study start and
        findings]</code><br>
where <code>animalList.AGEDAYS</code> is the  subject age at reference
start date(calculated during extraction of control subjects in
<code>getControlSubj</code>.
</p>
</li>
<li>
<p> For pooled findings rows - i.e. POOLID is populated instead of
USUBJID - the animal age at time of finding is calculated per animal
included in the each pool and finding.
</p>

<ul>
<li>
<p> If all calculated ages are equal within a pool and finding,
the calculated age is populated for this pool/finding.
</p>
</li>
<li>
<p> If all calculated ages are within the same time internal
(2 days) within a pool and finding, the minimum calculated age
plus 1 day is populated for this pool/finding.
</p>
</li>
</ul>
</li>
</ul>
<p>If both <code>fromAge</code> and <code>toAge</code> values are specified - all the rows
from the input table <code>findings</code> where value of the calculated
<code>AGEDYAS</code> is within the interval of the specified start/end age interval
are returned - including the values equal to the start/end age values.<br>
If only a <code>fromAge</code> value is specified - all the rows from the input
table <code>findings</code> where value of <code>AGEDYAS</code> equal to or greater than
the input age are returned.<br>
If only a <code>toAge</code> value is specified - all the rows from input table
<code>findings</code> where value of AGEDAYS is equal to or less than the input age
are extracted and returned.
The input age value(s) is/are converted to days before extraction of rows
from the input data tables using the input value(s) as filter - using this
conversion:
</p>

<ul>
<li> <p><code>DAYS</code>
</p>
</li>
<li> <p><code>WEEKS   : value * 7</code>
</p>
</li>
<li> <p><code>MONTHS  : value * 365/12</code>
</p>
</li>
<li> <p><code>YEARS   : value * 365</code>
</p>
</li>
</ul>
<p>If input parameter <code>inclUncertain=TRUE</code>, findings rows where the age at
finding time cannot be confidently identified are included in the output set.
These uncertain situations are identified and reported (in column
UNCERTAIN_MSG):
</p>

<ul>
<li>
<p> No age at reference time  has been calculated for subject
(<code>animalList.AGEDAYS</code>)
</p>
</li>
<li>
<p> Reference start time  is missing or contains invalid ISO8601 date
value for subject (<code>animalList.RFSTDTC</code>).
</p>
</li>
<li>
<p> Missing <code>[domain]DY</code> value and missing or invalid ISO8601 date
<code>[domain]DTC</code> value for finding
</p>
</li>
<li>
<p> For pooled findings:
</p>

<ul>
<li>
<p> More than two days between minimum and maximum of
<code>animalList.AGEDAYS</code> for the set of animals in a pool.
</p>
</li>
<li>
<p> Different values in <code>animalList.RFSTDTC</code> for the set of
animals in a pool.
</p>
</li>
</ul>
</li>
</ul>
<p>The same checks are performed and reported in column <code>NOT_VALID_MSG</code> if
<code>fromAge</code> and <code>fromAge</code> are empty and <code>noFilterReportUncertain
= TRUE</code>.
</p>


<h3>Value</h3>

<p>The function returns a data.table with columns in this order:
</p>

<ul>
<li>
<p> All columns contained in the <code>findings</code> input table (original
order except optional <code>UNCERTAIN_MSG</code> and <code>NOT_VALID_MSG</code>)
</p>
</li>
<li> <p><code>AGEDAYS</code>        (character)<br>
The subject age at finding time calculated in days. Is <code>NA</code> if thge age
cannot be confidently calculated.
</p>
</li>
<li> <p><code>UNCERTAIN_MSG</code>  (character)<br>
Included when parameter <code>inclUncertain=TRUE</code>.<br>
In case the age at finding time cannot be confidently matched during the
filtering of data, the column contains an indication of the reason.<br>
If any uncertainties have been identified for individual subjects included in
pools for pooled finding rows, one  message for is reported per pool/finding.<br>
Is NA for rows where the age at finding time can be confidently matched.<br>
A non-empty <code>UNCERTAIN_MSG</code> value generated by this function is merged with
non-empty <code>UNCERTAIN_MSG</code> values which may exist in the input set of findings
specified in <code>findings</code> - separated by '|'.
</p>
</li>
<li> <p><code>NOT_VALID_MSG</code> (character)<br>
Included when parameter <code>noFilterReportUncertain=TRUE</code>.<br>
In case the age at finding time cannot be confidently calculated, the column
contains an indication of the reason.<br>
Is NA for rows where age at finding time can be confidently calculated.<br>
A non-empty <code>NOT_VALID_MSG</code> value generated by this function is merged with
non-empty <code>NOT_VALID_MSG</code> values which may exist in the input set of findings
<code>findings</code> - separated by '|'.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Extract LB rows for the animals at age between 8 and 12 weeks at finding
# time - include uncertain rows
getFindingsSubjAge(dbToken = db,
                   findings = lb,
                   animalList = animals,
                   fromAge = '8w',
                   toAge = '12w',
                   inclUncertain = TRUE)
# No filtering, just add AGEDAYS to FW rows - do not include messages when
# the AGEDAYS cannot be confidently identified
getFindingsSubjAge(dbToken = db, findings = fw,  animalList = animals,
                   noFilterReportUncertain = FALSE)

## End(Not run)

</code></pre>


</div>