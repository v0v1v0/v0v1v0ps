<div class="container">

<table style="width: 100%;"><tr>
<td>checkResiduals</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Residual dispersion test for topic number</h2>

<h3>Description</h3>

<p>Computes the multinomial dispersion of the STM residuals as in Taddy (2012)
</p>


<h3>Usage</h3>

<pre><code class="language-R">checkResiduals(stmobj, documents, tol = 0.01)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>stmobj</code></td>
<td>
<p>An <code>STM</code> model object for which to compute residuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>documents</code></td>
<td>
<p>The documents corresponding to <code>stmobj</code> as in
<code>stm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>The tolerance parameter for calculating the degrees of freedom.
Defaults to 1/100 as in Taddy(2012)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function implements the residual-based diagnostic method of Taddy
(2012).  The basic idea is that when the model is correctly specified the
multinomial likelihood implies a dispersion of the residuals:
<code class="reqn">\sigma^2=1</code>.  If we calculate the sample dispersion and the value is
greater than one, this implies that the number of topics is set too low,
because the latent topics are not able to account for the overdispersion. In
practice this can be a very demanding criterion, especially if the documents
are long.  However, when coupled with other tools it can provide a valuable
perspective on model fit. The function is based on the Taddy 2012 paper as well as code
found in maptpx package.
</p>
<p>Further details are available in the referenced paper, but broadly speaking
the dispersion is derived from the mean of the squared adjusted residuals.
We get the sample dispersion by dividing by the degrees of freedom
parameter.  In estimating the degrees of freedom, we follow Taddy (2012) in
approximating the parameter <code class="reqn">\hat{N}</code> by the number of expected counts
exceeding a tolerance parameter.  The default value of 1/100 given in the
Taddy paper can be changed by setting the <code>tol</code> argument.
</p>
<p>The function returns the estimated sample dispersion (which equals 1 under
the data generating process) and the p-value of a chi-squared test where the
null hypothesis is that <code class="reqn">\sigma^2=1</code> vs the alternative <code class="reqn">\sigma^2
&gt;1</code>. As Taddy notes and we echo, rejection of the null 'provides a very
rough measure for evidence in favor of a larger number of topics.'
</p>


<h3>References</h3>

<p>Taddy, M. 'On Estimation and Selection for Topic Models'.
AISTATS 2012, JMLR W&amp;CP 22
</p>


<h3>Examples</h3>

<pre><code class="language-R">
#An example using the Gadarian data.  From Raw text to fitted model.
temp&lt;-textProcessor(documents=gadarian$open.ended.response,metadata=gadarian)
meta&lt;-temp$meta
vocab&lt;-temp$vocab
docs&lt;-temp$documents
out &lt;- prepDocuments(docs, vocab, meta)
docs&lt;-out$documents
vocab&lt;-out$vocab
meta &lt;-out$meta
set.seed(02138)
#maximum EM iterations set very low so example will run quickly.  
#Run your models to convergence!
mod.out &lt;- stm(docs, vocab, 3, prevalence=~treatment + s(pid_rep), data=meta,
               max.em.its=5)
checkResiduals(mod.out, docs)
</code></pre>


</div>