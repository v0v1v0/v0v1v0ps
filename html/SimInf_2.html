<div class="container">

<table style="width: 100%;"><tr>
<td>abc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Approximate Bayesian computation</h2>

<h3>Description</h3>

<p>Approximate Bayesian computation
</p>


<h3>Usage</h3>

<pre><code class="language-R">abc(
  model,
  priors = NULL,
  npart = NULL,
  ninit = NULL,
  distance = NULL,
  tolerance = NULL,
  ...,
  verbose = getOption("verbose", FALSE),
  post_gen = NULL
)

## S4 method for signature 'SimInf_model'
abc(
  model,
  priors = NULL,
  npart = NULL,
  ninit = NULL,
  distance = NULL,
  tolerance = NULL,
  ...,
  verbose = getOption("verbose", FALSE),
  post_gen = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>The <code>SimInf_model</code> object to generate data from.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priors</code></td>
<td>
<p>The priors for the parameters to fit. Each prior is
specified with a formula notation, for example, <code>beta ~
uniform(0, 1)</code> specifies that beta is uniformly distributed
between 0 and 1. Use <code>c()</code> to provide more than one
prior, for example, <code>c(beta ~ uniform(0, 1), gamma ~
normal(10, 1))</code>. The following distributions are supported:
<code>gamma</code>, <code>normal</code> and <code>uniform</code>. All parameters
in <code>priors</code> must be only in either <code>gdata</code> or
<code>ldata</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npart</code></td>
<td>
<p>An integer <code>(&gt;1)</code> specifying the number of
particles to approximate the posterior with.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ninit</code></td>
<td>
<p>Specify a positive integer (&gt;<code>npart</code>) to
adaptively select a sequence of tolerances using the algorithm
of Simola and others (2021). The initial tolerance is
adaptively selected by sampling <code>ninit</code> draws from the
prior and then retain the <code>npart</code> particles with the
smallest distances. Note there must be enough initial
particles to satisfactorily explore the parameter space, see
Simola and others (2021). If the <code>tolerance</code> parameter is
specified, then <code>ninit</code> must be <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distance</code></td>
<td>
<p>A function for calculating the summary statistics
for a simulated trajectory. For each particle, the function
must determine the distance and return that information. The
first argument, <code>result</code>, passed to the <code>distance</code>
function is the result from a <code>run</code> of the model with one
trajectory attached to it. The second argument,
<code>generation</code>, to <code>distance</code> is an integer with the
generation of the particle(s). Further arguments that can
passed to the <code>distance</code> function comes from <code>...</code>
in the <code>abc</code> function. Depending on the underlying model
structure, data for one or more particles have been generated
in each call to <code>distance</code>. If the <code>model</code> only
contains one node and all the parameters to fit are in
<code>ldata</code>, then that node will be replicated and each of
the replicated nodes represent one particle in the trajectory
(see ‘Examples’). On the other hand if the model
contains multiple nodes or the parameters to fit are contained
in <code>gdata</code>, then the trajectory in the <code>result</code>
argument represents one particle. The function can return a
numeric matrix (number of particles <code class="reqn">\times</code> number of
summary statistics). Or, if the distance contains one summary
statistic, a numeric vector with the length equal to the
number of particles. Note that when using adaptive tolerance
selection, only one summary statistic can be used, i.e., the
function must return a matrix (number of particles
<code class="reqn">\times</code> 1) or a numeric vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>
<p>A numeric matrix (number of summary statistics
<code class="reqn">\times</code> number of generations) where each column contains
the tolerances for a generation and each row contains a
sequence of gradually decreasing tolerances. Can also be a
numeric vector if there is only one summary statistic. The
tolerance determines the number of generations of ABC-SMC to
run. If the <code>ninit</code> parameter is specified, then
<code>tolerance</code> must be <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments to be passed to <code>fn</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>prints diagnostic messages when <code>TRUE</code>. The
default is to retrieve the global option <code>verbose</code> and
use <code>FALSE</code> if it is not set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>post_gen</code></td>
<td>
<p>An optional function that, if non-NULL, is applied
after each completed generation. The function must accept one
argument of type <code>SimInf_abc</code> with the current state of
the fitting process. This function can be useful to, for
example, save and inspect intermediate results.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>SimInf_abc</code> object.
</p>


<h3>References</h3>

<p>T. Toni, D. Welch, N. Strelkowa, A. Ipsen, and M. P. H. Stumpf. Approximate Bayesian computation scheme for parameter inference and model selection in dynamical systems. <em>Journal of the Royal Society Interface</em> <strong>6</strong>, 187–202, 2009. <a href="https://doi.org/10.1098/rsif.2008.0172">doi:10.1098/rsif.2008.0172</a>
</p>
<p>U. Simola, J. Cisewski-Kehe, M. U. Gutmann, J. Corander. Adaptive Approximate Bayesian Computation Tolerance Selection. <em>Bayesian Analysis</em>, <strong>16</strong>(2), 397–423, 2021. doi: 10.1214/20-BA1211
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
## Let us consider an SIR model in a closed population with N = 100
## individuals of whom one is initially infectious and the rest are
## susceptible. First, generate one realisation (with a specified
## seed) from the model with known parameters \code{beta = 0.16} and
## \code{gamma = 0.077}. Then, use \code{abc} to infer the (known)
## parameters from the simulated data.
model &lt;- SIR(u0 = data.frame(S = 99, I = 1, R = 0),
             tspan = 1:100,
             beta = 0.16,
             gamma = 0.077)

## Run the SIR model and plot the number of infectious.
set.seed(22)
infectious &lt;- trajectory(run(model), "I")$I
plot(infectious, type = "s")

## The distance function to accept or reject a proposal. Each node
## in the simulated trajectory (contained in the 'result' object)
## represents one proposal.
distance &lt;- function(result, ...) {
    ## Extract the time-series of infectious in each node as a
    ## data.frame.
    sim &lt;- trajectory(result, "I")

    ## Split the 'sim' data.frame by node and calculate the sum of the
    ## squared distance at each time-point for each node.
    dist &lt;- tapply(sim$I, sim$node, function(sim_infectious) {
        sum((infectious - sim_infectious)^2)
    })

    ## Return the distance for each node. Each proposal will be
    ## accepted or rejected depending on if the distance is less than
    ## the tolerance for the current generation.
    dist
}

## Fit the model parameters using ABC-SMC and adaptive tolerance
## selection. The priors for the parameters are specified using a
## formula notation. Here we use a uniform distribtion for each
## parameter with lower bound = 0 and upper bound = 1. Note that we
## use a low number particles here to keep the run-time of the example
## short. In practice you would want to use many more to ensure better
## approximations.
fit &lt;- abc(model = model,
           priors = c(beta ~ uniform(0, 1), gamma ~ uniform(0, 1)),
           npart = 100,
           ninit = 1000,
           distance = distance,
           verbose = TRUE)

## Print a brief summary.
fit

## Display the ABC posterior distribution.
plot(fit)

## End(Not run)
</code></pre>


</div>