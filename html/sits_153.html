<div class="container">

<table style="width: 100%;"><tr>
<td>sits_mixture_model</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multiple endmember spectral mixture analysis</h2>

<h3>Description</h3>

<p>Create a multiple endmember spectral mixture analyses fractions
images. We use the non-negative least squares (NNLS) solver to calculate the
fractions of each endmember. The NNLS was implemented by Jakob
Schwalb-Willmann in RStoolbox package (licensed as GPL&gt;=3).
</p>


<h3>Usage</h3>

<pre><code class="language-R">sits_mixture_model(
  data,
  endmembers,
  ...,
  rmse_band = TRUE,
  multicores = 2,
  progress = TRUE
)

## S3 method for class 'sits'
sits_mixture_model(
  data,
  endmembers,
  ...,
  rmse_band = TRUE,
  multicores = 2,
  progress = TRUE
)

## S3 method for class 'raster_cube'
sits_mixture_model(
  data,
  endmembers,
  ...,
  rmse_band = TRUE,
  memsize = 4,
  multicores = 2,
  output_dir,
  progress = TRUE
)

## S3 method for class 'derived_cube'
sits_mixture_model(data, endmembers, ...)

## S3 method for class 'tbl_df'
sits_mixture_model(data, endmembers, ...)

## Default S3 method:
sits_mixture_model(data, endmembers, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A sits data cube or a sits tibble.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>endmembers</code></td>
<td>
<p>Reference spectral endmembers.
(see details below).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Parameters for specific functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rmse_band</code></td>
<td>
<p>A boolean indicating whether the error associated
with the linear model should be generated.
If true, a new band with errors for each pixel
is generated using the root mean square
measure (RMSE). Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>multicores</code></td>
<td>
<p>Number of cores to be used for generate the
mixture model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>Show progress bar? Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>memsize</code></td>
<td>
<p>Memory available for the mixture model (in GB).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_dir</code></td>
<td>
<p>Directory for output images.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>endmembers</code> parameter should be a tibble, csv or
a shapefile. <code>endmembers</code> parameter must have the following columns:
<code>type</code>, which defines the endmembers that will be
created and the columns corresponding to the bands that will be used in the
mixture model. The band values must follow the product scale.
For example, in the case of sentinel-2 images the bands should be in the
range 0 to 1. See the <code>example</code> in this documentation for more details.
</p>


<h3>Value</h3>

<p>In case of a cube, a sits cube with the fractions of each endmember
will be returned. The sum of all fractions is restricted
to 1 (scaled from 0 to 10000), corresponding to the abundance of
the endmembers in the pixels.
In case of a tibble sits, the time series will be returned with the
values corresponding to each fraction.
</p>


<h3>Author(s)</h3>

<p>Felipe Carvalho, <a href="mailto:felipe.carvalho@inpe.br">felipe.carvalho@inpe.br</a>
</p>
<p>Felipe Carlos,   <a href="mailto:efelipecarlos@gmail.com">efelipecarlos@gmail.com</a>
</p>
<p>Rolf Simoes,     <a href="mailto:rolf.simoes@inpe.br">rolf.simoes@inpe.br</a>
</p>
<p>Gilberto Camara, <a href="mailto:gilberto.camara@inpe.br">gilberto.camara@inpe.br</a>
</p>
<p>Alber Sanchez,   <a href="mailto:alber.ipia@inpe.br">alber.ipia@inpe.br</a>
</p>


<h3>References</h3>

<p><code>RStoolbox</code> package (https://github.com/bleutner/RStoolbox/)
</p>


<h3>Examples</h3>

<pre><code class="language-R">if (sits_run_examples()) {
    # Create a sentinel-2 cube
    s2_cube &lt;- sits_cube(
        source = "AWS",
        collection = "SENTINEL-2-L2A",
        tiles = "20LKP",
        bands = c("B02", "B03", "B04", "B8A", "B11", "B12", "CLOUD"),
        start_date = "2019-06-13",
        end_date = "2019-06-30"
    )
    # create a directory to store the regularized file
    reg_dir &lt;- paste0(tempdir(), "/mix_model")
    dir.create(reg_dir)
    # Cube regularization for 16 days and 160 meters
    reg_cube &lt;- sits_regularize(
        cube = s2_cube,
        period = "P16D",
        res = 160,
        roi = c(
            lon_min = -65.54870165,
            lat_min = -10.63479162,
            lon_max = -65.07629670,
            lat_max = -10.36046639
        ),
        multicores = 2,
        output_dir = reg_dir
    )

    # Create the endmembers tibble
    em &lt;- tibble::tribble(
        ~class, ~B02, ~B03, ~B04, ~B8A, ~B11, ~B12,
        "forest", 0.02, 0.0352, 0.0189, 0.28, 0.134, 0.0546,
        "land", 0.04, 0.065, 0.07, 0.36, 0.35, 0.18,
        "water", 0.07, 0.11, 0.14, 0.085, 0.004, 0.0026
    )

    # Generate the mixture model
    mm &lt;- sits_mixture_model(
        data = reg_cube,
        endmembers = em,
        memsize = 4,
        multicores = 2,
        output_dir = tempdir()
    )
}

</code></pre>


</div>