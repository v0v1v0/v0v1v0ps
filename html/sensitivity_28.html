<div class="container">

<table style="width: 100%;"><tr>
<td>shapleyPermEx</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimation of Shapley effects by examining all permutations of inputs 
(Agorithm of Song et al, 2016), in cases of independent or dependent inputs</h2>

<h3>Description</h3>

<p><code>shapleyPermEx</code> implements the Monte Carlo estimation of
the Shapley effects (Owen, 2014) and their standard errors by examining all
permutations of inputs (Song et al., 2016; Iooss and Prieur, 2019). It also 
estimates full first order and independent total Sobol' indices 
(Mara et al., 2015). The function also allows the estimations of all these 
sensitivity indices in case of dependent inputs. The total cost of this 
algorithm is <code class="reqn">Nv + d! \times (d-1) \times No \times Ni</code> 
model evaluations. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">shapleyPermEx(model = NULL, Xall, Xset, d, Nv, No, Ni = 3, colnames = NULL, ...)
## S3 method for class 'shapleyPermEx'
tell(x, y = NULL, return.var = NULL, ...)
## S3 method for class 'shapleyPermEx'
print(x, ...)
## S3 method for class 'shapleyPermEx'
plot(x, ylim = c(0, 1), ...)
## S3 method for class 'shapleyPermEx'
ggplot(data, mapping = aes(), ylim = c(0, 1), title = NULL,
                 ..., environment = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a function, or a model with a <code>predict</code> method,
defining the model to analyze.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xall</code></td>
<td>
<p>Xall(n) is a function to generate a n-sample of a d-dimensional 
input vector (following the required joint distribution).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xset</code></td>
<td>
<p>Xset(n, Sj, Sjc, xjc) is a function to generate a n-sample of 
a d-dimensional input vector corresponding to the indices in Sj conditional 
on the input values xjc with the index set Sjc (following the required joint 
distribution).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>number of inputs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Nv</code></td>
<td>
<p>Monte Carlo sample size to estimate the output variance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>No</code></td>
<td>
<p>Outer Monte Carlo sample size to estimate the expectation 
of the conditional variance of the model output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ni</code></td>
<td>
<p>Inner Monte Carlo sample size to estimate the 
conditional variance of the model output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colnames</code></td>
<td>
<p>Optional: A vector containing the names of the inputs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a list of class <code>"shapleyPermEx"</code> storing the state of the
sensitivity study (parameters, data, estimates).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a list of class <code>"shapleyPermEx"</code> storing the state of the
sensitivity study (parameters, data, estimates).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a vector of model responses.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.var</code></td>
<td>
<p>a vector of character strings giving further
internal variables names to store in the output object <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>y-coordinate plotting limits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>a title of the plot with ggplot() function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapping</code></td>
<td>
<p>Default list of aesthetic mappings to use for plot. If not specified, 
must be supplied in each layer added to the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>environment</code></td>
<td>
<p>[Deprecated] Used prior to tidy evaluation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>any other arguments for <code>model</code> which are passed
unchanged each time it is called.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function requires R package "gtools".
</p>
<p>The default values Ni = 3 is the optimal one obtained by the theoretical
analysis of Song et al., 2016.
</p>
<p>The computations of the standard errors (and then the confidence intervals)
come from Iooss and prieur (2019). Based on the outer Monte carlo loop 
(calculation of expectation of conditional variance), the variance of the 
Monte carlo estimate is divided by No. The standard error is then averaged 
over the exact permutation loop. The confidence intervals at 95% correspond 
to +- 1.96 standard deviations.
</p>


<h3>Value</h3>

<p><code>shapleyPermEx</code> returns a list of class <code>"shapleyPermEx"</code>, containing
all the input arguments detailed before, plus the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a <code>data.frame</code> containing the design of experiments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the response used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p>the estimation of the ouput mean.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>V</code></td>
<td>
<p>the estimation of the ouput variance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Shapley</code></td>
<td>
<p>the estimations of the Shapley effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SobolS</code></td>
<td>
<p>the estimations of the full first-order Sobol' indices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SobolT</code></td>
<td>
<p>the estimations of the independent total sensitivity Sobol' indices.</p>
</td>
</tr>
</table>
<p>Users can ask more ouput variables with the argument <code>return.var</code>
(for example, the list of permutations <code>perms</code>).
</p>


<h3>Author(s)</h3>

<p>Bertrand Iooss, Eunhye Song, Barry L. Nelson, Jeremy Staum 
</p>


<h3>References</h3>

<p>B. Iooss and C. Prieur, 2019, <em>Shapley effects for sensitivity analysis with 
correlated inputs: comparisons with Sobol' indices, numerical estimation and 
applications</em>, International Journal for Uncertainty Quantification, 9, 493–514.
</p>
<p>T. Mara, S. Tarantola, P. Annoni, 2015, <em>Non-parametric methods for global 
sensitivity analysis of model output with dependent inputs</em>, Environmental
Modeling &amp; Software 72, 173–183.
</p>
<p>A.B. Owen, 2014, <em>Sobol' indices and Shapley value</em>, SIAM/ASA 
Journal of Uncertainty Quantification, 2, 245–251.
</p>
<p>A.B. Owen and C. Prieur, 2016, <em>On Shapley value for measuring importance
of dependent inputs</em>, SIAM/ASA Journal of Uncertainty Quantification, 5, 986–1002.
</p>
<p>E. Song, B.L. Nelson, and J. Staum, 2016, <em>Shapley effects for 
global sensitivity analysis: Theory and computation</em>, SIAM/ASA Journal 
of Uncertainty Quantification, 4, 1060–1083.
</p>


<h3>See Also</h3>

<p><code>shapleyPermRand, shapleyLinearGaussian,  shapleySubsetMc, shapleysobol_knn</code>, <code>lmg</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">


##################################
# Test case : the Ishigami function (3 uniform independent inputs)
# See Iooss and Prieur (2019)

library(gtools)

d &lt;- 3
Xall &lt;- function(n) matrix(runif(d*n,-pi,pi),nc=d)
Xset &lt;- function(n, Sj, Sjc, xjc) matrix(runif(n*length(Sj),-pi,pi),nc=length(Sj))

x &lt;- shapleyPermEx(model = ishigami.fun, Xall=Xall, Xset=Xset, d=d, Nv=1e4, No = 1e3, Ni = 3)
print(x)
plot(x)

library(ggplot2)
ggplot(x)

##################################
# Test case : Linear model (3 Gaussian inputs including 2 dependent)
# See Iooss and Prieur (2019)

library(ggplot2)
library(gtools)
library(mvtnorm) # Multivariate Gaussian variables
library(condMVNorm) # Conditional multivariate Gaussian variables

modlin &lt;- function(X) apply(X,1,sum)

d &lt;- 3
mu &lt;- rep(0,d)
sig &lt;- c(1,1,2)
ro &lt;- 0.9
Cormat &lt;- matrix(c(1,0,0,0,1,ro,0,ro,1),d,d)
Covmat &lt;- ( sig %*% t(sig) ) * Cormat

Xall &lt;- function(n) mvtnorm::rmvnorm(n,mu,Covmat)

Xset &lt;- function(n, Sj, Sjc, xjc){
  if (is.null(Sjc)){
    if (length(Sj) == 1){ rnorm(n,mu[Sj],sqrt(Covmat[Sj,Sj]))
    } else{ mvtnorm::rmvnorm(n,mu[Sj],Covmat[Sj,Sj])}
  } else{ condMVNorm::rcmvnorm(n, mu, Covmat, dependent.ind=Sj, given.ind=Sjc, 
                                X.given=xjc)}}

x &lt;- shapleyPermEx(model = modlin, Xall=Xall, Xset=Xset, d=d, Nv=1e4, 
                    No = 1e3, Ni = 3)
print(x)
ggplot(x)


</code></pre>


</div>