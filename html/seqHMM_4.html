<div class="container">

<table style="width: 100%;"><tr>
<td>build_lcm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Build a Latent Class Model</h2>

<h3>Description</h3>

<p>Function <code>build_lcm</code> is a shortcut for constructing a latent class model
as a restricted case of an <code>mhmm</code> object.
</p>


<h3>Usage</h3>

<pre><code class="language-R">build_lcm(
  observations,
  n_clusters,
  emission_probs,
  formula = NULL,
  data = NULL,
  coefficients = NULL,
  cluster_names = NULL,
  channel_names = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>observations</code></td>
<td>
<p>An <code>stslist</code> object (see <code>seqdef</code>) containing
the sequences, or a list of such objects (one for each channel).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_clusters</code></td>
<td>
<p>A scalar giving the number of clusters/submodels
(not used if starting values for model parameters are given with <code>emission_probs</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emission_probs</code></td>
<td>
<p>A matrix containing emission probabilities for each class by rows,
or in case of multichannel data a list of such matrices.
Note that the matrices must have dimensions k x s where k is the number of
latent classes and s is the number of unique symbols (observed states) in the
data. Emission probabilities should follow the ordering of the alphabet of
observations (<code>alphabet(observations)</code>, returned as <code>symbol_names</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Optional formula of class <code>formula</code> for the
mixture probabilities. Left side omitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing the variables used in the formula.
Ignored if no formula is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>An optional <code class="reqn">k x l</code> matrix of regression coefficients for
time-constant covariates for mixture probabilities, where <code class="reqn">l</code> is the number
of clusters and <code class="reqn">k</code> is the number of covariates. A logit-link is used for
mixture probabilities. The first column is set to zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster_names</code></td>
<td>
<p>A vector of optional names for the classes/clusters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>channel_names</code></td>
<td>
<p>A vector of optional names for the channels.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Object of class <code>mhmm</code> with the following elements:
</p>

<dl>
<dt><code>observations</code></dt>
<dd>
<p>State sequence object or a list of such containing the data.</p>
</dd>
<dt><code>transition_probs</code></dt>
<dd>
<p>A matrix of transition probabilities.</p>
</dd>
<dt><code>emission_probs</code></dt>
<dd>
<p>A matrix or a list of matrices of emission probabilities.</p>
</dd>
<dt><code>initial_probs</code></dt>
<dd>
<p>A vector of initial probabilities.</p>
</dd>
<dt><code>coefficients</code></dt>
<dd>
<p>A matrix of parameter coefficients for covariates (covariates in rows, clusters in columns).</p>
</dd>
<dt><code>X</code></dt>
<dd>
<p>Covariate values for each subject.</p>
</dd>
<dt><code>cluster_names</code></dt>
<dd>
<p>Names for clusters.</p>
</dd>
<dt><code>state_names</code></dt>
<dd>
<p>Names for hidden states.</p>
</dd>
<dt><code>symbol_names</code></dt>
<dd>
<p>Names for observed states.</p>
</dd>
<dt><code>channel_names</code></dt>
<dd>
<p>Names for channels of sequence data</p>
</dd>
<dt><code>length_of_sequences</code></dt>
<dd>
<p>(Maximum) length of sequences.</p>
</dd>
<dt><code>n_sequences</code></dt>
<dd>
<p>Number of sequences.</p>
</dd>
<dt><code>n_symbols</code></dt>
<dd>
<p>Number of observed states (in each channel).</p>
</dd>
<dt><code>n_states</code></dt>
<dd>
<p>Number of hidden states.</p>
</dd>
<dt><code>n_channels</code></dt>
<dd>
<p>Number of channels.</p>
</dd>
<dt><code>n_covariates</code></dt>
<dd>
<p>Number of covariates.</p>
</dd>
<dt><code>n_clusters</code></dt>
<dd>
<p>Number of clusters.</p>
</dd>
</dl>
<h3>See Also</h3>

<p><code>fit_model</code> for estimating model parameters;
<code>summary.mhmm</code> for a summary of a mixture model;
<code>separate_mhmm</code> for organizing an <code>mhmm</code> object into a list of
separate <code>hmm</code> objects; and <code>plot.mhmm</code> for plotting
mixture models.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Simulate observations from two classes
set.seed(123)
obs &lt;- seqdef(rbind(
  matrix(sample(letters[1:3], 500, TRUE, prob = c(0.1, 0.6, 0.3)), 50, 10),
  matrix(sample(letters[1:3], 200, TRUE, prob = c(0.4, 0.4, 0.2)), 20, 10)
))

# Initialize the model
set.seed(9087)
model &lt;- build_lcm(obs, n_clusters = 2)

# Estimate model parameters
fit &lt;- fit_model(model)

# How many of the observations were correctly classified:
sum(summary(fit$model)$most_probable_cluster == rep(c("Class 2", "Class 1"), times = c(500, 200)))

############################################################
## Not run: 
# LCM for longitudinal data

# Define sequence data
data("mvad", package = "TraMineR")
mvad_alphabet &lt;- c(
  "employment", "FE", "HE", "joblessness", "school",
  "training"
)
mvad_labels &lt;- c(
  "employment", "further education", "higher education",
  "joblessness", "school", "training"
)
mvad_scodes &lt;- c("EM", "FE", "HE", "JL", "SC", "TR")
mvad_seq &lt;- seqdef(mvad, 17:86,
  alphabet = mvad_alphabet, states = mvad_scodes,
  labels = mvad_labels, xtstep = 6
)

# Initialize the LCM with random starting values
set.seed(7654)
init_lcm_mvad1 &lt;- build_lcm(
  observations = mvad_seq,
  n_clusters = 2, formula = ~male, data = mvad
)

# Own starting values for emission probabilities
emiss &lt;- rbind(rep(1 / 6, 6), rep(1 / 6, 6))

# LCM with own starting values
init_lcm_mvad2 &lt;- build_lcm(
  observations = mvad_seq,
  emission_probs = emiss, formula = ~male, data = mvad
)

# Estimate model parameters (EM algorithm with random restarts)
lcm_mvad &lt;- fit_model(init_lcm_mvad1,
  control_em = list(restart = list(times = 5))
)$model

# Plot the LCM
plot(lcm_mvad, interactive = FALSE, ncol = 2)

###################################################################

# Binomial regression (comparison to glm)

require("MASS")
data("birthwt")

model &lt;- build_lcm(
  observations = seqdef(birthwt$low), emission_probs = diag(2),
  formula = ~ age + lwt + smoke + ht, data = birthwt
)
fit &lt;- fit_model(model)
summary(fit$model)
summary(glm(low ~ age + lwt + smoke + ht, binomial, data = birthwt))


# Multinomial regression (comparison to multinom)

require("nnet")

set.seed(123)
n &lt;- 100
X &lt;- cbind(1, x1 = runif(n, 0, 1), x2 = runif(n, 0, 1))
coefs &lt;- cbind(0, c(-2, 5, -2), c(0, -2, 2))
pr &lt;- exp(X %*% coefs) + rnorm(n * 3)
pr &lt;- pr / rowSums(pr)
y &lt;- apply(pr, 1, which.max)
table(y)

model &lt;- build_lcm(
  observations = seqdef(y), emission_probs = diag(3),
  formula = ~ x1 + x2, data = data.frame(X[, -1])
)
fit &lt;- fit_model(model)
summary(fit$model)
summary(multinom(y ~ x1 + x2, data = data.frame(X[, -1])))

## End(Not run)
</code></pre>


</div>