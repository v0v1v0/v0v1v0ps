<div class="container">

<table style="width: 100%;"><tr>
<td>PLIsuperquantile_multivar</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Perturbed-Law based sensitivity Indices (PLI) for superquantile 
and simultaneous perturbations of 2 inputs</h2>

<h3>Description</h3>

<p>PLIquantile_multivar computes the Perturbed-Law based Indices (PLI) for superquantile
and simultaneous perturbations of the means of 2 inputs, 
estimated by a Monte Carlo method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">PLIsuperquantile_multivar(order,x,y,inputs,deltasvector,InputDistributions,
  samedelta=TRUE, percentage=TRUE,nboot=0,conf=0.95,bootsample=TRUE,bias=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>the order of the quantile to estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the matrix of simulation points coordinates, 
one column per variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the vector of model outputs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inputs</code></td>
<td>
<p>the vector of the two inputs' indices for which
the indices will be computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deltasvector</code></td>
<td>
<p>a vector containing the values of the perturbed means
for which the indices will be computed. Warning: if samedelta=FALSE, 
deltasvector has to be the vector of deltas (mean perturbations)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>InputDistributions</code></td>
<td>
<p>a list of list. Each list contains, as a list,
the name of the distribution to be used and the parameters.
Implemented cases so far (for a mean perturbation): 
Gaussian, Uniform, Triangle, Left Trucated Gaussian, 
Left Truncated Gumbel. Using Gumbel requires the package <code>evd</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samedelta</code></td>
<td>
<p>a boolean used with the value "MOY" for type. 
</p>

<ul>
<li>
<p> If it is set at TRUE, the mean perturbation will be the same for all  
the variables. 
</p>
</li>
<li>
<p> If not, the mean perturbation will be new_mean = mean+sigma*delta 
where mean, sigma are parameters defined in InputDistributions and 
delta is a value of deltasvector.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>percentage</code></td>
<td>
<p>a boolean that defines the formula used for the PLI.
</p>

<ul>
<li>
<p> If it is set at FALSE, the initially proposed formula is used
(see Sueur et al., 2017).
</p>
</li>
<li>
<p> If not (set as TRUE), the PLI is given in percentage of variation 
of the superquantile (see Iooss et al., 2021).
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboot</code></td>
<td>
<p>the number of bootstrap replicates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf</code></td>
<td>
<p>the confidence level for bootstrap confidence intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bootsample</code></td>
<td>
<p>If TRUE, the uncertainty about the original quantile estimation
is taken into account in the PLI confidence intervals (see Iooss et al., 2021). 
If FALSE, standard confidence intervals are computed for the PLI.
It mainly changes the CI at small delta values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bias</code></td>
<td>
<p>defines the version of PLI-superquantile:
</p>

<ul>
<li>
<p> If it is set at "TRUE", it gives the mean of outputs above the perturbed 
quantile (alternative formula)
</p>
</li>
<li>
<p> If it is set at "FALSE", it gives the mean of perturbed outputs above the 
perturbed quantile (original formula)
</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function does not allow perturbations on the variance of the inputs' distributions.
</p>


<h3>Value</h3>

<p><code>PLIsuperquantile_multivar</code> returns a list of matrices 
(delta twist of input 1 (in rows) vs. delta twist of input 2 (in columns)) 
containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>PLI</code></td>
<td>
<p>the PLI.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PLICIinf</code></td>
<td>
<p>the bootstrap lower confidence interval values of the PLI.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PLICIsup</code></td>
<td>
<p>the bootstrap upper confidence interval values of the PLI.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantile</code></td>
<td>
<p>the perturbed quantile.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantileCIinf</code></td>
<td>
<p>the bootstrap lower confidence interval values of the perturbed superquantile.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantileCIsup</code></td>
<td>
<p>the bootstrap upper confidence interval values of the perturbed superquantile.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Bertrand Iooss
</p>


<h3>References</h3>

<p>T. Delage, R. Sueur and B. Iooss, 2018, <em>Robustness analysis of epistemic uncertainties 
propagation studies in LOCA assessment thermal-hydraulic model</em>, 
ANS Best Estimate Plus Uncertainty International Conference (BEPU 2018), Lucca, Italy, May 13-19, 2018.
</p>
<p>B. Iooss, V. Verges and V. Larget, 2022, <em>BEPU robustness analysis via perturbed law-based 
sensitivity indices</em>, Proceedings of the Institution of Mechanical Engineers, 
Part O: Journal of Risk and Reliability, 236:855-865.
</p>
<p>P. Lemaitre, E. Sergienko, A. Arnaud, N. Bousquet, F. Gamboa and B. Iooss, 2015, 
<em>Density modification based reliability sensitivity analysis</em>, Journal of Statistical 
Computation and Simulation, 85:1200-1223. 
</p>
<p>R. Sueur, N. Bousquet, B. Iooss and J. Bect, 2016,
<em>Perturbed-Law based sensitivity Indices for sensitivity analysis in structural reliability</em>,
Proceedings of the SAMO 2016 Conference, Reunion Island, France, December 2016.
</p>
<p>R. Sueur, B. Iooss and T. Delage, 2017,
<em>Sensitivity analysis using perturbed-law based indices for quantiles and application to an industrial case</em>, 
10th International Conference on Mathematical Methods in Reliability (MMR 2017), Grenoble, France, July 2017.
</p>


<h3>See Also</h3>

<p><code>PLI, PLIquantile, PLIsuperquantile, PLIquantile_multivar</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">

# Model: 3D function 

distribution = list()
for (i in 1:3) distribution[[i]]=list("norm",c(0,1))
N = 10000
X = matrix(0,ncol=3,nrow=N)
for(i in 1:3) X[,i] = rnorm(N,0,1)
Y = 2 * X[,1] + X[,2] + X[,3]/2
alpha &lt;- 0.95
nboot &lt;- 20 # put nboot=200 for consistency

q95 = quantile(Y,alpha)
sq95a &lt;- mean(Y*(Y&gt;q95)/(1-alpha)) ; sq95b &lt;- mean(Y[Y&gt;q95])
  
v_delta = seq(-1,1,1/10) 
toto12 = PLIsuperquantile_multivar(alpha,X,Y,c(1,2),deltasvector=v_delta,
    InputDistributions=distribution,samedelta=TRUE,bias=FALSE)
toto = PLIsuperquantile(alpha,X,Y,deltasvector=v_delta,InputDistributions=distribution,
    type="MOY",samedelta=TRUE,nboot=0,bias=FALSE)

par(mar=c(4,5,1,1))
plot(v_delta,diag(toto12$PLI),,ylim=c(-1,1),xlab=expression(delta),
    ylab=expression(hat(PLI[i*delta])),pch=16,cex=1.5,col="blue")
points(v_delta,toto$PLI[,1],col="darkgreen",pch=15,cex=1.5)
points(v_delta,toto$PLI[,2],col="black",pch=19,cex=1.5)
points(v_delta,toto$PLI[,3],col="red",pch=17,cex=1.5)
abline(h=0,lty=2)
legend(-1,1.,legend=c("X1","X2","X3","X1X2"),col=c("darkgreen","black","red","blue"),
    pch=c(15,19,17,16),cex=1.5)

# with bootstrap (put in comment because too long for the CRAN tests)

v_delta = seq(-1,1,2/10) 

toto12 = PLIsuperquantile_multivar(alpha,X,Y,c(1,2),deltasvector=v_delta,
    InputDistributions=distribution,samedelta=TRUE,nboot=nboot,bootsample=FALSE,bias=FALSE)
toto = PLIsuperquantile(alpha,X,Y,deltasvector=v_delta,InputDistributions=distribution,
    type="MOY",samedelta=TRUE,nboot=nboot,bootsample=FALSE,bias=FALSE)

par(mar=c(4,5,1,1))
plot(v_delta,diag(toto12$PLI),ylim=c(-1,1),xlab=expression(delta),
    ylab=expression(hat(PLI[i*delta])),pch=16,cex=1.5,col="blue")
points(v_delta,toto$PLI[,1],col="darkgreen",pch=15,cex=1.5)
points(v_delta,toto$PLI[,2],col="black",pch=19,cex=1.5)
points(v_delta,toto$PLI[,3],col="red",pch=17,cex=1.5)
lines(v_delta,diag(toto12$PLICIinf),col="blue")
lines(v_delta,diag(toto12$PLICIsup),col="blue")
lines(v_delta,toto$PLICIinf[,2],col="black")
lines(v_delta,toto$PLICIsup[,2],col="black")
lines(v_delta,toto$PLICIinf[,1],col="darkgreen")
lines(v_delta,toto$PLICIsup[,1],col="darkgreen")
lines(v_delta,toto$PLICIinf[,3],col="red")
lines(v_delta,toto$PLICIsup[,3],col="red")
abline(h=0,lty=2)
legend(-1,1,legend=c("X1","X2","X3","X1X2"),col=c("darkgreen","black","red","blue"),
    pch=c(15,19,17,16),cex=1.5)

###################################################		
# another visualizations by using the plotrix, 
# viridisLite, lattice and grid packages (from Vanessa Verges)

library(plotrix)
parameters = list(colors=c("darkgreen","black","red"),symbols=c(15,19,17))
par(mar=c(4,5,1,1),xpd=TRUE)
plotCI(v_delta,diag(toto12$PLI),ui=diag(toto12$PLICIsup),li=diag(toto12$PLICIinf),
       xlab=expression(delta),ylab=expression(hat(PLI[i*delta])),
       main=bquote("PLI-superquantile (N ="~.(N) ~ ","~alpha~"="~.(alpha)~
       ") on "~X[1]~"and"~X[2]~"of Y="~2*X[1] + X[2] + X[3]/2),
       cex=1.5,col="blue",pch=16)
for (i in 1:3){
  plotCI(v_delta,toto$PLI[,i],ui=toto$PLICIsup[,i],li=toto$PLICIinf[,i],
         cex=1.5,col=parameters$colors[i],pch=parameters$symbols[i],
         add=TRUE)
}
abline(h=0,lty=2)
legend("topleft",legend=c("X1","X2","X3","X1X2"),
        col=c(parameters$colors,"blue"),pch=c(parameters$symbols,16),cex=1.5)

# Visu of all the PLIs (at any paired combinations of deltas)

library(viridisLite)
library(lattice)
library(grid)

colnames(toto12$PLI) = round(v_delta,2)
rownames(toto12$PLI) = round(v_delta,2)
coul = viridis(100)
levelplot(toto12$PLI,col.regions=coul,main=bquote(hat(PLI)[superquantile[~X[1]~X[2]]]),
          xlab=bquote(delta[X~.(1)]),ylab=bquote(delta[X~.(2)]))


</code></pre>


</div>