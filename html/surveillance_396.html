<div class="container">

<table style="width: 100%;"><tr>
<td>knox</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Knox Test for Space-Time Interaction
</h2>

<h3>Description</h3>

<p>Given temporal and spatial distances as well as corresponding critical
thresholds defining what “close” means, the function
<code>knox</code> performs Knox (1963, 1964) test for space-time interaction.
The corresponding p-value can be calculated either by the Poisson
approximation or by a Monte Carlo permutation approach (Mantel, 1967)
with support for parallel computation via <code>plapply</code>.
There is a simple <code>plot</code>-method showing a <code>truehist</code> of
the simulated null distribution together with the expected and observed
values.
This implementation of the Knox test is due to Meyer et al. (2016).
</p>


<h3>Usage</h3>

<pre><code class="language-R">knox(dt, ds, eps.t, eps.s, simulate.p.value = TRUE, B = 999, ...)

## S3 method for class 'knox'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dt,ds</code></td>
<td>

<p>numeric vectors containing temporal and spatial distances, respectively.
Logical vectors indicating temporal/spatial closeness may also be
supplied, in which case <code>eps.t</code>/<code>eps.s</code> is ignored.
To test for space-time interaction in a single point pattern of <code class="reqn">n</code>
events, these vectors should be of length <code class="reqn">n*(n-1)/2</code> and
contain the pairwise event distances (e.g., the lower triangle of
the distance matrix, such as in <code>"dist"</code> objects).
Note that there is no special handling of matrix input, i.e.,
if <code>dt</code> or <code>ds</code> are matrices, all elements are used
(but a warning is given if a symmetric matrix is detected).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps.t,eps.s</code></td>
<td>

<p>Critical distances defining closeness in time and space,
respectively. Distances lower than or equal to the critical distance
are considered “"close"”.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simulate.p.value</code></td>
<td>

<p>logical indicating if a Monte Carlo permutation test should be
performed (as per default). Do not forget to set the
<code>.Random.seed</code> via an extra <code>.seed</code> argument if
reproducibility is required (see the ... arguments below).
If <code>simulate.p.value = FALSE</code>, the Poisson approximation is
used (but see the note below).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>

<p>number of permutations for the Monte Carlo approach.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>arguments configuring <code>plapply</code>:
<code>.parallel</code>, <code>.seed</code>, and <code>.verbose</code>.
By default, no parallelization is performed (<code>.parallel = 1</code>),
and a progress bar is shown (<code>.verbose = TRUE</code>).<br>
For the <code>plot</code>-method, further arguments passed to
<code>truehist</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>an object of class <code>"knox"</code> as returned by the
<code>knox</code> test.
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>an object of class <code>"knox"</code> (inheriting from <code>"htest"</code>),
which is a list with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a character string indicating the type of test
performed, and whether the Poisson approximation or Monte Carlo
simulation was used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data.name</code></td>
<td>
<p>a character string giving the supplied <code>dt</code> and
<code>ds</code> arguments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>the number of close pairs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameter</code></td>
<td>
<p>if <code>simulate.p.value = TRUE</code>, the number
<code>B</code> of permutations, otherwise the <code>lambda</code> parameter of
the Poisson distribution, i.e., the same as <code>null.value</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.value</code></td>
<td>
<p>the p-value for the test. In case
<code>simulate.p.value = TRUE</code>, the p-value from the Poisson
approximation is still attached as an attribute <code>"Poisson"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>the character string <code>"greater"</code> (this is a
one-sided test).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null.value</code></td>
<td>
<p>the expected number of close pairs in the absence of
space-time interaction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>table</code></td>
<td>
<p>the contingency table of <code>dt &lt;= eps.t</code> and
<code>ds &lt;= eps.s</code>.</p>
</td>
</tr>
</table>
<p>The <code>plot</code>-method invisibly returns <code>NULL</code>.
</p>
<p>A <code>toLatex</code>-method exists, which generates LaTeX code for the
contingency table associated with the Knox test.
</p>


<h3>Note</h3>

<p>The Poisson approximation works well if the proportions of close
pairs in both time and space are small (Kulldorff and Hjalmars,
1999), otherwise the Monte Carlo permutation approach is
recommended.
</p>


<h3>Author(s)</h3>

<p>Sebastian Meyer
</p>


<h3>References</h3>

<p>Knox, G. (1963):
Detection of low intensity epidemicity: application to cleft lip and palate.
<em>British Journal of Preventive &amp; Social Medicine</em>, <b>17</b>, 121-127.
</p>
<p>Knox, E. G. (1964):
The detection of space-time interactions.
<em>Journal of the Royal Statistical Society. Series C (Applied
Statistics)</em>, <b>13</b>, 25-30.
</p>
<p>Kulldorff, M. and Hjalmars, U. (1999):
The Knox method and other tests for space-time interaction.
<em>Biometrics</em>, <b>55</b>, 544-552.
</p>
<p>Mantel, N. (1967):
The detection of disease clustering and a generalized regression approach.
<em>Cancer Research</em>, <b>27</b>, 209-220.
</p>
<p>Meyer, S., Warnke, I., Rössler, W. and Held, L. (2016):
Model-based testing for space-time interaction using point processes:
An application to psychiatric hospital admissions in an urban area.
<em>Spatial and Spatio-temporal Epidemiology</em>, <b>17</b>, 15-25.
<a href="https://doi.org/10.1016/j.sste.2016.03.002">doi:10.1016/j.sste.2016.03.002</a>.
Eprint: <a href="https://arxiv.org/abs/1512.09052">https://arxiv.org/abs/1512.09052</a>.
</p>


<h3>See Also</h3>

<p>The function <code>mantel.randtest</code> in package <span class="pkg">ade4</span>
implements Mantel's (1967) space-time interaction test, i.e., using
the Pearson correlation between the spatial and temporal distances of
all event pairs as the test statistic, and assessing statistical
significance using a Monte Carlo permutation approach as with
<code>simulate.p.value</code> here in the <code>knox</code> function.
To combine information from different scales <code>eps.t</code> and
<code>eps.s</code> while also handling edge effects, the space-time
K-function test available via <code>stKtest</code> can be used.
Function <code>epitest</code> tests epidemicity in a
<code>"twinstim"</code> point process model.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("imdepi")
imdepiB &lt;- subset(imdepi, type == "B")

## Perform the Knox test using the Poisson approximation
knoxtest &lt;- knox(
    dt = dist(imdepiB$events$time), eps.t = 30,
    ds = dist(coordinates(imdepiB$events)), eps.s = 50,
    simulate.p.value = FALSE
)
knoxtest
## The Poisson approximation works well for these data since
## the proportion of close pairs is rather small (204/56280).

## contingency table in LaTeX
toLatex(knoxtest)


## Obtain the p-value via a Monte Carlo permutation test,
## where the permutations can be computed in parallel
## (using forking on Unix-alikes and a cluster on Windows, see ?plapply)
knoxtestMC &lt;- knox(
    dt = dist(imdepiB$events$time), eps.t = 30,
    ds = dist(coordinates(imdepiB$events)), eps.s = 50,
    simulate.p.value = TRUE, B = 99,  # limited here for speed
    .parallel = 2, .seed = 1, .verbose = FALSE
)
knoxtestMC
plot(knoxtestMC)
</code></pre>


</div>