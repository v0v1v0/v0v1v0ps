<div class="container">

<table style="width: 100%;"><tr>
<td>SAM_weight</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculating Mixture Weight of SAM Priors</h2>

<h3>Description</h3>

<p>The <code>SAM_weight</code> function is designed to calculate the mixture
weight of the SAM priors according to the degree of prior-data
conflicts (<em>Yang, et al., 2023</em>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">SAM_weight(if.prior, theta.h, method.w, prior.odds, data, delta, ...)

## S3 method for class 'betaMix'
SAM_weight(if.prior, theta.h, method.w, prior.odds, data, delta, n, r, ...)

## S3 method for class 'normMix'
SAM_weight(
  if.prior,
  theta.h,
  method.w,
  prior.odds,
  data,
  delta,
  m,
  n,
  sigma,
  ...
)

## S3 method for class 'gammaMix'
SAM_weight(if.prior, theta.h, method.w, prior.odds, data, delta, u, w, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>if.prior</code></td>
<td>
<p>Informative prior constructed based on historical data,
represented (approximately) as a mixture of conjugate distributions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta.h</code></td>
<td>
<p>Estimate of the treatment effect based on historical data.
If missing, the default value is set to be the posterior mean estimate from
<code>if.prior</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method.w</code></td>
<td>
<p>Methods used to determine the mixture weight for SAM priors.
The default method is "LRT" (Likelihood Ratio Test), the alternative option
is "PPR" (Posterior Probability Ratio). See Details section for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.odds</code></td>
<td>
<p>The prior probability of <code class="reqn">H_0</code> being true compared to
the prior probability of <code class="reqn">H_1</code> being true using PPR method. The default
value is 1. See Details section for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data of the control arm from the current trial, see Methods
section for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>Clinically significant difference used for the SAM prior.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters required for different endpoints.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Number of subjects in the control arm for continuous endpoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>Number of responses in the control arm for binary endpoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>Mean estimate in the control arm for continuous endpoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>Standard deviation in the control arm for continuous endpoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>Number of events in the control arm for time-to-event endpoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>Total observed time in the control arm for time-to-event endpoint.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>SAM prior is constructed by mixing an informative prior
<code class="reqn">\pi_1(\theta)</code>, constructed based on historical data, with a
non-informative prior <code class="reqn">\pi_0(\theta)</code> using the mixture weight
<code class="reqn">w</code> determined by <code>SAM_weight</code> function to achieve the
degree of prior-data conflict (<em>Schmidli et al., 2015, Yang et al., 2023</em>).
</p>
<p>Let <code class="reqn">\theta</code> and <code class="reqn">\theta_h</code> denote the treatment effects
associated with the current arm data <code class="reqn">D</code> and historical data <code class="reqn">D_h</code>,
respectively. Let <code class="reqn">\delta</code> denote the clinically significant difference
such that if <code class="reqn">|\theta_h - \theta| \ge \delta</code>, then <code class="reqn">\theta_h</code> is
regarded as clinically distinct from <code class="reqn">\theta</code>, and it is therefore
inappropriate to borrow any information from <code class="reqn">D_h</code>. Consider two
hypotheses:
</p>
<p style="text-align: center;"><code class="reqn">H_0: \theta = \theta_h, ~ H_1: \theta = \theta_h + \delta ~ or ~  \theta = \theta_h - \delta.</code>
</p>

<p><code class="reqn">H_0</code> represents that <code class="reqn">D_h</code> and <code class="reqn">D</code> are consistent (i.e.,
no prior-data conflict) and thus information borrowing is desirable,
whereas <code class="reqn">H_1</code> represents that the treatment effect of <code class="reqn">D</code>
differs from <code class="reqn">D_h</code> to such a degree that no information should be
borrowed.
</p>
<p>The SAM prior uses the likelihood ratio test (LRT) statistics <code class="reqn">R</code> to
quantify the degree of prior-data conflict and determine the extent of
information borrowing.
</p>
<p style="text-align: center;"><code class="reqn">R = P(D | H_0, \theta_h) / P(D | H_1, \theta_h) = P(D | \theta = \theta_h) / \max(P(D | \theta = \theta_h + \delta), P(D | \theta = \theta_h - \delta)) ,</code>
</p>

<p>where <code class="reqn">P(D | \cdot)</code> denotes the likelihood function. An alternative
Bayesian choice is the posterior probability ratio (PPR):
</p>
<p style="text-align: center;"><code class="reqn">R = P(D | H_0, \theta_h) / P(D | H_1, \theta_h) = P(H_0) / P( H_1) \times BF, </code>
</p>

<p>where <code class="reqn">P(H_0)</code> and <code class="reqn">P(H_1)</code> is the prior probabilities of <code class="reqn">H_0</code>
and <code class="reqn">H_1</code> being true. <code class="reqn">BF</code> is the Bayes Factor that in this case
is the same as the LRT.
</p>
<p>The SAM prior, denoted as <code class="reqn">\pi_{sam}(\theta)</code>, is then defined
as a mixture of an informative prior <code class="reqn">\pi_1(\theta)</code>, constructed
based on <code class="reqn">D_h</code> and a non-informative prior <code class="reqn">\pi_0(\theta)</code>:
</p>
<p style="text-align: center;"><code class="reqn">\pi_{sam}(\theta) = w\pi_1(\theta) + (1-w)\pi_0(\theta),</code>
</p>

<p>where the mixture weight <code class="reqn">w</code> is calculated as:
</p>
<p style="text-align: center;"><code class="reqn">w = R / (1 + R).</code>
</p>

<p>As the level of prior-data conflict increases, the likelihood ratio
<code class="reqn">R</code> decreases, resulting in a decrease in the weight <code class="reqn">w</code>
assigned to the informative prior and thus a decrease in information
borrowing. As a result, <code class="reqn">\pi_{sam}(\theta)</code> is data-driven and
has the ability to self-adapt the information borrowing based on the
degree of prior-data conflict.
</p>


<h3>Value</h3>

<p>The mixture weight of the SAM priors.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>SAM_weight(betaMix)</code>: The function calculates the mixture weight of SAM
priors for beta mixture distribution. The input <code>data</code> can be patient-level
data (i.e., a vector of 0 and 1 representing the response status of each
patient) or summary statistics (i.e., the number of patients and the number
of responses).
</p>
</li>
<li> <p><code>SAM_weight(normMix)</code>: The function calculates the mixture weight of SAM
priors for normal mixture distribution. The input <code>data</code> should be
a vector of patient-level observations. The input <code>data</code> can be
patient-level data (i.e., a vector of continuous response of each
patient) or summary statistics (i.e., the mean estimate, number of subjects,
and the standard deviation in the control arm).
</p>
</li>
<li> <p><code>SAM_weight(gammaMix)</code>: The function calculates the mixture weight of SAM
priors for gamma mixture distribution. The input <code>data</code> can be
patient-level data (i.e., a matrix with the first row as the censoring
indicator and the second row recording the observed time) or summary
statistics (i.e., the number of uncensored observations <code>u</code> and
total observed time <code>w</code>).
</p>
</li>
</ul>
<h3>References</h3>

<p>Yang P, Zhao Y, Nie L, Vallejo J, Yuan Y.
SAM: Self-adapting mixture prior to dynamically borrow information from
historical data in clinical trials. <em>Biometrics</em> 2023; 00, 1â€“12.
https://doi.org/10.1111/biom.13927
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(123)
## Examples for binary endpoints
## Example 1: no prior-data conflict
## Suppose that the informative prior constructed based on historical data is
## beta(40, 60)
prior.historical &lt;- mixbeta(c(1, 40, 60))
## Data of control arm
data.control     &lt;- rbinom(60, size = 1, prob = 0.42)
## Calculate the mixture weight of the SAM prior
wSAM &lt;- SAM_weight(if.prior = prior.historical,
                   delta = 0.15,        ## Clinically significant difference
                   data = data.control  ## Control arm data
                   )
print(wSAM)

## Example 2: in the presence of prior-data conflict, where the current data
## has 12 responses in 60 patients
wSAM &lt;- SAM_weight(if.prior = prior.historical,
                   delta = 0.15,    ## Clinically significant difference
                   ## Methods to determine mixture weight for the SAM priors
                   ## by Posterior Probability Ratio
                   method.w = 'PPR',
                   ## Prior odds of favoring no prior-data conflicts to
                   ## the presence of prior-data conflict
                   prior.odd = 1/9,
                   n = 60,          ## Number of patients in the control arm
                   r = 12           ## Number of responses in the control arm
                   )
print(wSAM)

## Example 3: in the presence of prior-data conflict, where the current data
## has 12 responses in 60 patients
wSAM &lt;- SAM_weight(if.prior = prior.historical,
                   delta = 0.15, ## Clinically significant difference
                   n = 60,       ## Number of patients in the control arm
                   r = 12        ## Number of responses in the control arm
                   )
print(wSAM)

## Examples for continuous endpoints
## Example 1: no prior-data conflict
## Suppose that the informative prior constructed from historical data is
## N(0, 3)
sigma      &lt;- 3
prior.mean &lt;- 0
prior.se   &lt;- sigma/sqrt(100)
prior.historical &lt;- mixnorm(c(1, prior.mean, prior.se), sigma = sigma)
## Data of the control arm
data.control     &lt;- rnorm(80, mean = 0, sd = sigma)
wSAM &lt;- SAM_weight(if.prior = prior.historical,
                   delta = 0.3 * sigma,    ## Clinically significant difference
                   data = data.control     ## Control arm data
                   )
print(wSAM)

## Example 2: in the presence of prior-data conflict, where the current data
## has mean of 0.5
data.control     &lt;- rnorm(80, mean = 1, sd = sigma)
wSAM  &lt;- SAM_weight(if.prior = prior.historical,
                    delta = 0.3 * sigma,    ## Clinically significant difference
                    data = data.control     ## Control arm data
                    )
print(wSAM)

## Examples for survival endpoints
## Example 1: no prior-data conflict
## Suppose the survival times from historical data follows exp(1) distribution
## with random censoring time follows U(0.5, 5) distribution
T_hi &lt;- rexp(100, rate = 1)
C_hi &lt;- runif(100, min = 0.5, max = 5)
## Indicators of the uncensored events
delta_hi &lt;- as.numeric(T_hi &lt; C_hi)
## Observed survival times from historical data
U_hi     &lt;- T_hi
U_hi[delta_hi == 0] &lt;- C_hi[delta_hi == 0]
## Construct the informative prior based on simulated historical data
prior.historical &lt;- mixgamma(c(1, sum(delta_hi), sum(U_hi)),
                             param = 'ab', likelihood = 'exp')
## Suppose the survival times from control data follows exp(0.95) distribution
## with random censoring time follows U(0.5, 5) distribution
T_ci &lt;- rexp(100, rate = 0.95)
C_ci &lt;- runif(100, min = 0.5, max = 5)
## Indicators of the uncensored events
delta_ci &lt;- as.numeric(T_ci &lt; C_ci)
## Observed survival times from control data
U_ci     &lt;- T_ci
U_ci[delta_ci == 0] &lt;- C_ci[delta_ci == 0]
## Data of the control arm
data.control     &lt;- rbind(sum(delta_ci), sum(U_ci))
wSAM &lt;- SAM_weight(if.prior = prior.historical,
                   delta = 0.2,            ## Clinically significant difference
                   data = data.control     ## Control arm data
                   )
print(wSAM)

## Example 2: in the presence of prior-data conflict, where the current survival
## times follows exp(2) distribution with random censoring time follows U(0.5, 5)
## distribution
T_ci &lt;- rexp(100, rate = 2)
C_ci &lt;- runif(100, min = 0.5, max = 5)
## Indicators of the uncensored events
delta_ci &lt;- as.numeric(T_ci &lt; C_ci)
## Observed survival times from control data
U_ci     &lt;- T_ci
U_ci[delta_ci == 0] &lt;- C_ci[delta_ci == 0]
## Data of the control arm
data.control     &lt;- rbind(sum(delta_ci), sum(U_ci))
wSAM  &lt;- SAM_weight(if.prior = prior.historical,
                    delta = 0.2,            ## Clinically significant difference
                    data = data.control     ## Control arm data
                    )
print(wSAM)

</code></pre>


</div>