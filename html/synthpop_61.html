<div class="container">

<table style="width: 100%;"><tr>
<td>utility.tab</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Tabular utility</h2>

<h3>Description</h3>

<p>Produces tables from observed and synthesised data and calculates
utility measures to compare them with their expectation if the
synthesising model is correct.
</p>
<p>It can be also used with synthetic data NOT created by <code>syn()</code>,
but then an additional parameter <code>cont.na</code> might need to be provided.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'synds'
utility.tab(object, data, vars = NULL, ngroups = 5,
            useNA = TRUE, max.table = 1e6,
            print.tables = length(vars) &lt; 4,
            print.stats = c("pMSE", "S_pMSE", "df"),
            print.zdiff = FALSE, print.flag = TRUE,
            digits = 4, k.syn = FALSE, ...)

## S3 method for class 'data.frame'
utility.tab(object, data, vars = NULL, cont.na = NULL,
            ngroups = 5, useNA = TRUE, max.table = 1e6,
            print.tables = length(vars) &lt; 4,
            print.stats = c("pMSE", "S_pMSE", "df"),
            print.zdiff = FALSE, print.flag = TRUE,
            digits = 4, k.syn = FALSE, ...)

## S3 method for class 'list'
utility.tab(object, data, vars = NULL, cont.na = NULL,
            ngroups = 5, useNA = TRUE, max.table = 1e6,
            print.tables = length(vars) &lt; 4,
            print.stats = c("pMSE", "S_pMSE", "df"),
            print.zdiff = FALSE, print.flag = TRUE,
            digits = 4, k.syn = FALSE, ...)


## S3 method for class 'utility.tab'
print(x, print.tables = NULL,
      print.zdiff = NULL, print.stats = NULL,
      digits = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object of class <code>synds</code>, which stands for 'synthesised
data set'. It is typically created by function <code>syn()</code> or
<code>syn.strata()</code> and it includes <code>object$m</code> number of synthesised
data set(s), as well as <code>object$syn</code> the synthesised data set,
if <code>m = 1</code>, or a list of <code>m</code> such data sets. Alternatively,
when data are synthesised not using <code>syn()</code>, it can be a data frame
with a synthetic data set or a list of data frames with synthetic data sets,
all created from the same original data with the same variables and the same
method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the original (observed) data set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>a single string or a vector of strings with the names of
variables to be used to form the table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cont.na</code></td>
<td>
<p>a named list of codes for missing values for continuous
variables if different from the <code>R</code> missing data code <code>NA</code>.
The names of the list elements must correspond to the variables names for
which the missing data codes need to be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.table</code></td>
<td>
<p>a maximum table size. You could try increasing the default 
value, but memory problems are likely.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ngroups</code></td>
<td>
<p>if numerical (non-factor) variables are included they will be
classified into this number of groups to form tables. Classification is
performed using <code>classIntervals()</code> function for <code>n = ngroups</code>.
By default, <code>style = "quantile"</code> to get appropriate groups for skewed
data. Problems for variables with a small number of unique values are handled
by selecting only unique values of breaks. Arguments of <code>classIntervals()</code>
may be, however, specified in the call to <code>utility.tab()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useNA</code></td>
<td>
<p>determines if NA values are to be included in tables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.tables</code></td>
<td>
<p>a logical value that determines if tables of observed and
synthesised data are to be printed. By default tables are printed if they 
have up to three dimensions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.stats</code></td>
<td>
<p>a single string or a vector of strings that determines
which utility measures to print. Must be a selection from:  
<code>"VW"</code>, <code>"FT"</code>,<code>"JSD"</code>, <code>"SPECKS"</code>, <code>"WMabsDD"</code>, 
<code>"U"</code>, <code>"G"</code>, <code>"pMSE"</code>, <code>"PO50"</code>, <code>"MabsDD"</code>, 
<code>"dBhatt"</code>,  <code>"S_VW"</code>, <code>"S_FT"</code>, <code>"S_JSD"</code>, 
<code>"S_WMabsDD"</code>, <code>"S_G"</code>, <code>"S_pMSE"</code>, <code>"df"</code>, <code>dfG</code>. 
If <code>print.stats = "all"</code>, all of these will be printed. For more 
information see the details section below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.zdiff</code></td>
<td>
<p>a logical value that determines if tables of Z scores for
differences between observed and expected are to be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.flag</code></td>
<td>
<p>a logical value that determines if messages are to be printed 
during computation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>an integer indicating the number of decimal places for printing
statistics, <code>tab.zdiff</code> and mean results for <code>m &gt; 1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k.syn</code></td>
<td>
<p>a logical indicator as to whether the sample size itself has
been synthesised. The default value is <code>FALSE</code>, which will apply
to synthetic data created by synthpop.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional parameters; can be passed to classIntervals() function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an object of class <code>utility.tab</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Forms tables of observed and synthesised values for the variables
specified in <code>vars</code>. Several utility measures are calculated from the cells
of the tables, as described below. Details of all of these measures can be found 
in Raab et al. (2021). If the synthesising model is correct the measures
<code>VW</code>, <code>FT</code>, <code>G</code> and <code>JSD</code> should have chi-square distributions 
with <code>df</code> degrees of freedom for large samples. Standardised versions of each 
measure are available (e.g. <code>S_VW</code> for <code>VW</code>, where <code>S_VW = VW/df</code>) 
that will have an expected value of <code>1</code> if the synthesising model is correct. 
Four other measures are calculated by considering the table as a prediction model. 
The propensity score mean-squared error <code>pMSE</code>, and from a comparison of 
propensity scores for the synthetic and original data the Kolmogorov-Smirnov 
statistic <code>SPECKS</code> and the Wilcoxon rank-sum statistic <code>U</code> and also 
the percentage of the observations correctly predicted in the combined tables over 
50%(<code>PO50</code>) where the majority of observations in each grouping are in 
agreement with category (real or synthetic) of the observation. The first of these 
<code>pMSE</code> is identical except for a constant to <code>VW</code>. No expected values are 
computed for the last three of these measures, but they can be obtained by replication 
from <code>utility.gen()</code>. 
Three further measures are calulated from the tables. The mean absolute difference 
in distributions: firstly <code>MabsDD</code>, the avarage absolute difference in the 
proportions of original and synthetic data from all the cells in the table. 
Secondly a weighted version of this measure <code>WMabsDD</code> where the weights are 
proportional to the inverse of the variance of the absolute differences so that 
this measure can be standardised by its expected value, <code>df</code>. Finally the 
Bhattacharyya distances <code>BhattD</code> derived from the overlap of the histograms 
of the original and synthetic data sets. 
</p>


<h3>Value</h3>

<p>An object of class <code>utility.tab</code> which is a list with the following
components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>number of synthetic data sets in object, i.e. <code>object$m</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>VW</code></td>
<td>
<p>a vector with <code>object$m</code> values for the Voas Williamson
utility measure.; linearly related to <code>pMSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FT</code></td>
<td>
<p>a vector with <code>object$m</code> values for the Freeman-Tukey
utility measure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>JSD</code></td>
<td>
<p>a vector with <code>object$m</code> values for the Jensen-Shannaon 
divergence for comparing the tables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SPECKS</code></td>
<td>
<p>a vector with <code>object$m</code> values for the Kolmogorov-Smirnov 
statistic for comparing the propensity scores for the original and synthetic 
data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>WMabsDD</code></td>
<td>
<p>a vector with <code>object$m</code> values of the weighted mean 
absolute difference in distributions for original and synthetic data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>U</code></td>
<td>
<p>a vector with <code>object$m</code> values of the Wilcoxon statistic 
comparing the propensity scores for the original and synthetic data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>G</code></td>
<td>
<p>a vector with <code>object$m</code> values for the adjusted likelihood 
ratio utility measure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pMSE</code></td>
<td>
<p>a vector with <code>object$m</code> values of the propensity score 
mean-squared error; linearly related to <code>VW</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PO50</code></td>
<td>
<p>a vector with <code>object$m</code> values of the percentage over 
50% of observations correctly predicted from the propensity scores 
linearly related to <code>SPECKS</code> and <code>MabsDD</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MabsDD</code></td>
<td>
<p>a vector with <code>object$m</code> values of the mean absolute 
difference in distributions for original and synthetic data linearly 
related to <code>SPECKS</code> and <code>PO50</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dBhatt</code></td>
<td>
<p>a vector with <code>object$m</code> values of the Bhattacharyya 
distances between the synthetic and original data, linearly related to 
the square root of <code>FT</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_VW</code></td>
<td>
<p><code>VW/df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_FT</code></td>
<td>
<p><code>FT/df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_JSD</code></td>
<td>
 <p><code>JSD</code>/df.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_WMabsDD</code></td>
<td>
<p>WMabsDD/df.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_G</code></td>
<td>
<p><code>G/df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S_pMSE</code></td>
<td>
<p>standardised measure from <code>pMSE</code>, identical to <code>S_VW</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>a vector of degrees of freedom for the chi-square tests which equal
to the number of cells in the tables with any observed or
synthesised counts minus one when <code>k.syn == FALSE</code> or equal to the
the number of cells when <code>k.syn == TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dfG</code></td>
<td>
<p>degrees of freedom used in standardising <code>G</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nempty</code></td>
<td>
<p>a vector of length <code>object$m</code> with number of cells
not contributing to the statistics.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tab.obs</code></td>
<td>
<p>a table from the observed data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tab.syn</code></td>
<td>
<p>a table or a list of <code>m</code> tables from the synthetic data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tab.zdiff</code></td>
<td>
<p>a table or a list of <code>m</code> tables of Z statistics for
differences between observed and synthesised cells of the tables. Large
absolute values indicate a large contribution to lack-of-fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>an integer indicating the number of decimal places
for printing statistics, <code>tab.zdiff</code> and mean results for <code>m &gt; 1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.tables</code></td>
<td>
<p>a logical value that determines if tables of observed and
synthesised are to be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.stats</code></td>
<td>
<p>a single string or a vector of strings with utility measures
to be printed out.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.zdiff</code></td>
<td>
<p>a logical value that determines if tables of  Z scores for
differences between observed and expected are to be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>number of observation in the original dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k.syn</code></td>
<td>
<p>a logical indicator as to whether the sample size itself has
been synthesised.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Nowok, B., Raab, G.M and Dibben, C. (2016). synthpop: Bespoke
creation of synthetic data in R. <em>Journal of Statistical Software</em>,
<b>74</b>(11), 1-26. <a href="https://doi.org/10.18637/jss.v074.i11">doi:10.18637/jss.v074.i11</a>.
</p>
<p>Raab, G.M., Nowok, B. and Dibben, C. (2021). Assessing, visualizing and 
improving the utility of synthetic data. Available from 
<a href="https://arxiv.org/abs/2109.12717">https://arxiv.org/abs/2109.12717</a>.
</p>
<p>Read, T.R.C. and Cressie, N.A.C. (1988) <em>Goodness–of–Fit Statistics for
Discrete Multivariate Data</em>, Springer–Verlag, New York.
</p>
<p>Voas, D. and Williamson, P. (2001) Evaluating goodness-of-fit measures for
synthetic microdata. <em>Geographical and Environmental Modelling</em>,
<b>5</b>(2), 177-200.
</p>


<h3>See Also</h3>

<p><code>utility.gen</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">ods &lt;- SD2011[1:1000, c("sex", "age", "marital", "nofriend")]

s1 &lt;- syn(ods, m = 10, cont.na = list(nofriend = -8))
utility.tab(s1, ods, vars = c("marital", "sex"), print.stats = "all")

s2 &lt;- syn(ods, m = 1, cont.na = list(nofriend = -8))
u2 &lt;- utility.tab(s2, ods, vars = c("marital", "age", "sex"), ngroups = 3)
print(u2, print.tables = TRUE, print.zdiff = TRUE)

### synthetic data provided as 'data.frame'
utility.tab(s2$syn, ods, vars = c("marital", "nofriend"), ngroups = 3,
            print.tables = TRUE, cont.na = list(nofriend = -8), digits = 4)
</code></pre>


</div>