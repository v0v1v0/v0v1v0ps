<div class="container">

<table style="width: 100%;"><tr>
<td>SpatDensReg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian Nonparametric Spatially Smoothed Density Estimation</h2>

<h3>Description</h3>

<p>This function provides a Bayesian nonparametric density estimator that changes smoothly in space. The estimator is built from the predictive rule for a marginalized Polya tree (PT), modified so that observations are spatially weighted by their distance from the location of interest.
</p>


<h3>Usage</h3>

<pre><code class="language-R">SpatDensReg(formula, data, na.action, prior=NULL, state=NULL,
            mcmc=list(nburn=3000, nsave=2000, nskip=0, ndisplay=500),
            permutation=TRUE, fix.theta=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a formula expression with the response returned by the <code>Surv</code> function in the <code>survival</code> package. It supports right-censoring, left-censoring, interval-censoring, and mixtures of them. Note: for survival data, the input response should be log survival times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame in which to interpret the variables named in the <code>formula</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>a missing-data filter function, applied to the <code>model.frame</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>
<p>a list giving the prior information. The list includes the following parameter: <code>maxL</code> an integer giving the maximum level of Polya trees, (<code>a0</code>, <code>b0</code>) parameters of the gamma prior for the precision parameter alpha, (<code>theta0</code>, <code>V0</code>) mean and variance of the normal prior for the centering distribution parameter vector theta, <code>phiq0</code> the prior probability of phi=0, <code>phib0</code> the rate parameter of the exponential prior of phi. The function itself provides all default priors. See Hanson, Zhou, and de Carvalho (2018).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state</code></td>
<td>
<p>a list giving the current value of the parameters. If <code>NULL</code>, all values are provided based on the centering parametric model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc</code></td>
<td>
<p>a list giving the MCMC parameters. The list must include the following elements: <code>nburn</code> an integer giving the number of burn-in scans, <code>nskip</code> an integer giving the thinning interval, <code>nsave</code> an integer giving the total number of scans to be saved, <code>ndisplay</code> an integer giving the number of saved scans to be displayed on screen (the function reports on the screen when every <code>ndisplay</code> iterations have been carried out).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>permutation</code></td>
<td>
<p>flag to indicate whether a random data permutation will be implemented in the beginning of each iterate; default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix.theta</code></td>
<td>
<p>flag to indicate whether the centering distribution parameters theta=(location, log(scale)) are fixed; default is <code>TRUE</code> indicating fixed.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The <code>SpatDensReg</code> object is a list containing at least the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>modelname</code></td>
<td>

<p>the name of the fitted model
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>terms</code></td>
<td>

<p>the <code>terms</code> object used
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>

<p>the matched call
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>

<p>the list of hyperparameters used in all priors. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc</code></td>
<td>

<p>the list of MCMC parameters used 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>

<p>the number of row observations used in fitting the model
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>

<p>the number of columns in the model matrix
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Surv</code></td>
<td>

<p>the <code>Surv</code> object used 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>

<p>the n by p design matrix
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>

<p>the 2 by nsave matrix of posterior samples for location and log(scale) involved in the centering distribution of Polya tree prior. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>

<p>the vector of posterior samples for the phi parameter in the marginal PT definition. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>

<p>the vector of posterior samples for the precision parameter alpha in the PT prior. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxL</code></td>
<td>

<p>the truncation level used in the PT prior. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Surv.cox.snell</code></td>
<td>

<p>the <code>Surv</code> object used for Cox-Snell residual plot. This is not recommended for frailty models, for which please use the function <code>cox.snell.survregbayes</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratetheta</code></td>
<td>

<p>the acceptance rate in the posterior sampling of theta vector involved in the centering distribution
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratec</code></td>
<td>

<p>the acceptance rate in the posterior sampling of precision parameter alpha involved in the PT prior
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratephi</code></td>
<td>

<p>the acceptance rate in the posterior sampling of phi parameter 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial.values</code></td>
<td>

<p>the list of initial values used for the parameters 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BF</code></td>
<td>

<p>the Bayes factor for comparing the spatial model vs. the exchangeable model
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Haiming Zhou and Timothy Hanson
</p>


<h3>References</h3>

<p>Hanson, T., Zhou, H., and de Carvalho, V. (2018). Bayesian nonparametric spatially smoothed density estimation. In <em>New Frontiers of Biostatistics and Bioinformatics</em> (pp 87-105). Springer.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Simulated data
rm(list=ls())
library(survival)
library(spBayesSurv)
library(coda)

## True conditional density
fiofy_x = function(y, x){
  0.5*dnorm(y, -x, 1)+0.5*dnorm(y, x, 1);
}

## Generate data
n = 200;
x = runif(n, 0, 3)
y = rep(0, n);
uu = runif(n);
for(i in 1:n){
  if(uu[i]&lt;0.5){
    y[i] = rnorm(1, -x[i], 1);
  }else{
    y[i] = rnorm(1, x[i], 1);
  }
}

## right censored 
y1=y;y2=y;
Centime = runif(n, 2, 4); 
delta = (y&lt;=Centime) +0 ; 
length(which(delta==0))/n; ## censoring rate
rcen = which(delta==0);
y1[rcen] = Centime[rcen];
y2[rcen] = NA;
## make a data frame
## Method 1: in the interval-censoring notation: 
## y1 is the left endpoint and y2 is the right endpoint.
## This way we could use Surv(y1, y2, type="interval2")
## Method 2: Because we have right-censored data, 
## we could use y1 as the observed survival times and delta as the indicator. 
## This way we could use Surv(y1, delta). This is the same as above. 
d = data.frame(y1=y1, y2=y2, x=x, delta=delta); 

##-------------fit the model-------------------##
# MCMC parameters
nburn=50; nsave=50; nskip=0;
# Note larger nburn, nsave and nskip should be used in practice.
mcmc=list(nburn=nburn, nsave=nsave, nskip=nskip, ndisplay=50);
prior = list(maxL=4, phiq0=0);
# Note please set 0&lt;phiq0&lt;1 for a valid Bayes factor of testing 
# spatial model vs. exchangeable model.
# If the Bayes factor is not needed, setting phiq0=0 will speed up 
# the computing time about seven times. 
state = list(alpha=1);
ptm&lt;-proc.time()
res1 = SpatDensReg(formula = Surv(y1, delta)~x, data=d, 
                   prior=prior, state=state, mcmc=mcmc, permutation = TRUE, 
                   fix.theta=FALSE);
## Or equivalently formula = Surv(y1, y2, type="interval2") can also be used.
sfit=summary(res1); sfit
systime1=proc.time()-ptm; systime1;
traceplot(mcmc(res1$theta[1,]))
traceplot(mcmc(res1$theta[2,]))
traceplot(mcmc(res1$alpha))
traceplot(mcmc(res1$phi))

## plots
ygrid = seq(-6, 6,length.out=100);
xpred = data.frame(x=c(0,1,2,3)); 
plot(res1, xnewdata=xpred, ygrid=ygrid);
</code></pre>


</div>