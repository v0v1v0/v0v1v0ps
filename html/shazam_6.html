<div class="container">

<table style="width: 100%;"><tr>
<td>calcBaseline</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate the BASELINe PDFs (including for regions that include CDR3 and FWR4)</h2>

<h3>Description</h3>

<p><code>calcBaseline</code> calculates the BASELINe posterior probability density 
functions (PDFs) for sequences in the given Change-O <code>data.frame</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">calcBaseline(
  db,
  sequenceColumn = "clonal_sequence",
  germlineColumn = "clonal_germline",
  testStatistic = c("local", "focused", "imbalanced"),
  regionDefinition = NULL,
  targetingModel = HH_S5F,
  mutationDefinition = NULL,
  calcStats = FALSE,
  nproc = 1,
  cloneColumn = NULL,
  juncLengthColumn = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>db</code></td>
<td>
<p><code>data.frame</code> containing sequence data and annotations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sequenceColumn</code></td>
<td>
<p><code>character</code> name of the column in <code>db</code> 
containing input sequences.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>germlineColumn</code></td>
<td>
<p><code>character</code> name of the column in <code>db</code> 
containing germline sequences.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testStatistic</code></td>
<td>
<p><code>character</code> indicating the statistical framework 
used to test for selection. One of 
<code>c("local", "focused", "imbalanced")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regionDefinition</code></td>
<td>
<p>RegionDefinition object defining the regions
and boundaries of the Ig sequences.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>targetingModel</code></td>
<td>
<p>TargetingModel object. Default is  HH_S5F.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mutationDefinition</code></td>
<td>
<p>MutationDefinition object defining replacement
and silent mutation criteria. If <code>NULL</code> then 
replacement and silent are determined by exact 
amino acid identity. Note, if the input data.frame 
already contains observed and expected mutation frequency 
columns then mutations will not be recalculated and this
argument will be ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calcStats</code></td>
<td>
<p><code>logical</code> indicating whether or not to calculate the 
summary statistics <code>data.frame</code> stored in the 
<code>stats</code> slot of a Baseline object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nproc</code></td>
<td>
<p>number of cores to distribute the operation over. If 
<code>nproc=0</code> then the <code>cluster</code> has already been
set and will not be reset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cloneColumn</code></td>
<td>
<p><code>character</code> name of the column in <code>db</code> 
containing clonal identifiers. Relevant only for 
when regionDefinition includes CDR and FWR4 (else
this value can be <code>NULL</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>juncLengthColumn</code></td>
<td>
<p><code>character</code> name of the column in <code>db</code> 
containing the junction length. Relevant only for 
when regionDefinition includes CDR and FWR4 (else
this value can be <code>NULL</code>)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Calculates the BASELINe posterior probability density function (PDF) for 
sequences in the provided <code>db</code>. 
</p>
<p><strong>Note</strong>: Individual sequences within clonal groups are not, strictly speaking, 
independent events and it is generally appropriate to only analyze selection 
pressures on an effective sequence for each clonal group. For this reason,
it is strongly recommended that the input <code>db</code> contains one effective 
sequence per clone. Effective clonal sequences can be obtained by calling 
the collapseClones function.
</p>
<p>If the <code>db</code> does not contain the 
required columns to calculate the PDFs (namely mu_count &amp; mu_expected)
then the function will:
</p>

<ol>
<li>
<p>  Calculate the numbers of observed mutations.
</p>
</li>
<li>
<p>  Calculate the expected frequencies of mutations and modify the provided 
<code>db</code>. The modified <code>db</code> will be included as part of the 
returned <code>Baseline</code> object.
</p>
</li>
</ol>
<p>The <code>testStatistic</code> indicates the statistical framework used to test for selection. 
E.g.
</p>

<ul>
<li>   <p><code>local</code> = CDR_R / (CDR_R + CDR_S).
</p>
</li>
<li>   <p><code>focused</code> = CDR_R / (CDR_R + CDR_S + FWR_S).
</p>
</li>
<li>   <p><code>imbalanced</code> = CDR_R + CDR_S / (CDR_R + CDR_S + FWR_S + FRW_R).
</p>
</li>
</ul>
<p>For <code>focused</code> the <code>regionDefinition</code> must only contain two regions. If more 
than two regions are defined the <code>local</code> test statistic will be used.
For further information on the frame of these tests see Uduman et al. (2011).
</p>


<h3>Value</h3>

<p>A Baseline object containing the modified <code>db</code> and BASELINe 
posterior probability density functions (PDF) for each of the sequences.
</p>


<h3>References</h3>


<ol>
<li>
<p>  Hershberg U, et al. Improved methods for detecting selection by mutation 
analysis of Ig V region sequences. 
Int Immunol. 2008 20(5):683-94.
</p>
</li>
<li>
<p>  Uduman M, et al. Detecting selection in immunoglobulin sequences. 
Nucleic Acids Res. 2011 39(Web Server issue):W499-504.
</p>
</li>
<li>
<p>  Yaari G, et al. Models of somatic hypermutation targeting and substitution based
on synonymous mutations from high-throughput immunoglobulin sequencing data.
Front Immunol. 2013 4(November):358.
</p>
</li>
</ol>
<h3>See Also</h3>

<p>See Baseline for the return object.
See groupBaseline and summarizeBaseline for further processing.
See plotBaselineSummary and plotBaselineDensity for plotting results.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load and subset example data
data(ExampleDb, package="alakazam")
db &lt;- subset(ExampleDb, c_call == "IGHG" &amp; sample_id == "+7d")

# Collapse clones
db &lt;- collapseClones(db, cloneColumn="clone_id", 
                     sequenceColumn="sequence_alignment",
                     germlineColumn="germline_alignment_d_mask",
                     method="thresholdedFreq", minimumFrequency=0.6,
                     includeAmbiguous=FALSE, breakTiesStochastic=FALSE)
 
# Calculate BASELINe
baseline &lt;- calcBaseline(db, 
                         sequenceColumn="clonal_sequence",
                         germlineColumn="clonal_germline", 
                         testStatistic="focused",
                         regionDefinition=IMGT_V,
                         targetingModel=HH_S5F,
                         nproc=1)
                         
</code></pre>


</div>