<div class="container">

<table style="width: 100%;"><tr>
<td>multistagevariance</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Expected variance after selection after k stages selection</h2>

<h3>Description</h3>

<p>This function uses the algorithm described by Tallis (1961) to calculate the variance after multi-stage selection.
The variance among candidates of y in the selected area <code class="reqn">\textbf{S}_{Q}</code> is defined as the second central moment, <code class="reqn">\psi_n(y)=E(Y^2|\textbf{S}_{Q}) - \left[E(Y|\textbf{S}_{Q})\right]^2</code>,
where
<code class="reqn">
E(Y^2|\textbf{S}_{Q})  = \alpha^{-1} \int_{-\infty} ^\infty \int_{q_{1}}^\infty...\int_{q_{n}}^\infty  y^2\, \phi_{n+1}(\textbf{x}^{*}; \bm{\Sigma}^{*}) \, d \textbf{x}^*</code>
</p>


<h3>Usage</h3>

<pre><code class="language-R">multistagevariance(Q, corr, alg, Vg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Q</code></td>
<td>
<p>are the coordinates of the truncation points, which are the output of the function multistagetp that we are going to introduce.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corr</code></td>
<td>
<p>is the correlation matrix of y and X, which is introduced in the function multistagecorr. The correlation matrix must be symmetric and positive-definite. If the estimated correlation matrix is negative-definite, it must be adjusted before using this function. Before starting the calculations, it is recommended to check the correlation matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alg</code></td>
<td>
<p>is used to switch between two algorithms. If <code>alg = GenzBretz()</code>, which is by default, the quasi-Monte Carlo algorithm from Genz et al. (2009, 2013), will be used. If <code>alg = Miwa()</code>, the program will use the Miwa algorithm (Mi et al., 2009), which is an analytical solution of the MVN integral. Miwa's algorithm has higher accuracy (7 digits) than quasi-Monte Carlo algorithm (5 digits). However, its computational speed is slower. We recommend to use the Miwa algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Vg</code></td>
<td>
<p>correspond to the genetic variance or variance of the GCA effects. The default value is 1</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The output is the value of <code class="reqn">\psi_n(y|\textbf{S}_{Q})</code>.
</p>


<h3>Note</h3>

<p> No further notes
</p>


<h3>Author(s)</h3>

<p>Xuefei Mi
</p>


<h3>References</h3>

<p>A. Genz and F. Bretz. Computation of Multivariate Normal and t Probabilities. Lecture Notes in Statistics, Vol. 195, Springer-Verlag, Heidelberg, 2009.
</p>
<p>A. Genz, F. Bretz, T. Miwa, X. Mi, F. Leisch, F. Scheipl and T. Hothorn. mvtnorm: Multivariate normal and t distributions. R package version 0.9-9995, 2013.
</p>
<p>G.M. Tallis. Moment generating function of truncated multi-normal distribution. J. Royal Stat. Soc., Ser. B, 23(1):223-229, 1961.
</p>
<p>X. Mi, T. Miwa and T. Hothorn. Implement of Miwa's analytical algorithm of multi-normal distribution. R Journal, 1:37-39, 2009.
</p>


<h3>See Also</h3>

<p>No link
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# first example

Q =c(0.4308,0.9804,1.8603)

corr=matrix( c(1,       0.3508,0.3508,0.4979,
               0.3508,  1,     0.3016,0.5630,
               0.3508,  0.3016,1,     0.5630,
               0.4979,  0.5630,0.5630,1),
              nrow=4
)


multistagevariance(Q=Q,corr=corr,alg=Miwa)

# time comparsion

var.time.miwa=system.time (var.miwa&lt;-multistagevariance(Q=Q,corr=corr,alg=Miwa))

var.time.bretz=system.time (var.bretz&lt;-multistagevariance(Q=Q,corr=corr))



# second examples


Q= c(0.9674216, 1.6185430)
corr=matrix( c(1,         0.7071068, 0.9354143,
               0.7071068, 1,         0.7559289,
               0.9354143, 0.7559289, 1),
              nrow=3
)


multistagevariance(Q=Q,corr=corr,alg=Miwa)

var.time.miwa=system.time (var.miwa&lt;-multistagevariance(Q=Q, corr=corr, alg=Miwa))

var.time.bretz=system.time (var.bretz&lt;-multistagevariance(Q=Q, corr=corr))




# third examples

 alpha1&lt;- 1/(24)^0.5
 alpha2&lt;- 1/(24)^0.5
 Q=multistagetp(alpha=c(alpha1,alpha2),corr=corr)


corr=matrix( c(1,         0.7071068,0.9354143,
               0.7071068, 1,        0.7559289,
               0.9354143, 0.7559289,1),
              nrow=3
)

multistagevariance(Q=Q, corr=corr, alg=Miwa)

</code></pre>


</div>