<div class="container">

<table style="width: 100%;"><tr>
<td>pcf.ppp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Pair Correlation Function of Point Pattern</h2>

<h3>Description</h3>

<p>Estimates the pair correlation function of
a point pattern using kernel methods.
</p>


<h3>Usage</h3>

<pre><code class="language-R">  ## S3 method for class 'ppp'
pcf(X, ..., r = NULL, kernel="epanechnikov", bw=NULL,
                    stoyan=0.15,
                    correction=c("translate", "Ripley"),
                    divisor = c("r", "d"),
                    var.approx = FALSE,
                    domain=NULL,
                    ratio=FALSE, close=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>

<p>A point pattern (object of class <code>"ppp"</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>

<p>Vector of values for the argument <code class="reqn">r</code> at which <code class="reqn">g(r)</code> 
should be evaluated. There is a sensible default.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel</code></td>
<td>

<p>Choice of smoothing kernel,
passed to <code>density.default</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bw</code></td>
<td>

<p>Bandwidth for smoothing kernel,
passed to <code>density.default</code>.
Either a single numeric value giving the standard deviation of the kernel,
or a character string specifying a bandwidth selection rule
recognised by <code>density.default</code>.
If <code>bw</code> is missing or <code>NULL</code>,
the default value is computed using
Stoyan's rule of thumb: see Details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Other arguments passed to the kernel density estimation 
function <code>density.default</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stoyan</code></td>
<td>

<p>Coefficient for Stoyan's bandwidth selection rule; see Details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correction</code></td>
<td>

<p>Edge correction. A character vector specifying the choice
(or choices) of edge correction. See Details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>divisor</code></td>
<td>

<p>Choice of divisor in the estimation formula:
either <code>"r"</code> (the default) or <code>"d"</code>. See Details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.approx</code></td>
<td>

<p>Logical value indicating whether to compute an analytic
approximation to the variance of the estimated pair correlation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>domain</code></td>
<td>

<p>Optional. Calculations will be restricted to this subset
of the window. See Details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratio</code></td>
<td>

<p>Logical. 
If <code>TRUE</code>, the numerator and denominator of
each edge-corrected estimate will also be saved,
for use in analysing replicated point patterns.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>close</code></td>
<td>

<p>Advanced use only. Precomputed data. See section on Advanced Use.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The pair correlation function <code class="reqn">g(r)</code> 
is a summary of the dependence between points in a spatial point
process. The best intuitive interpretation is the following: the probability
<code class="reqn">p(r)</code> of finding two points at locations <code class="reqn">x</code> and <code class="reqn">y</code>
separated by a distance <code class="reqn">r</code> is equal to
</p>
<p style="text-align: center;"><code class="reqn">
    p(r) = \lambda^2 g(r) \,{\rm d}x \, {\rm d}y
  </code>
</p>

<p>where <code class="reqn">\lambda</code> is the intensity of the point process.
For a completely random (uniform Poisson) process,
<code class="reqn">p(r) = \lambda^2 \,{\rm d}x \, {\rm d}y</code>
so <code class="reqn">g(r) = 1</code>.
Formally, the pair correlation function of a stationary point process
is defined by 
</p>
<p style="text-align: center;"><code class="reqn">
    g(r) = \frac{K'(r)}{2\pi r}
  </code>
</p>

<p>where <code class="reqn">K'(r)</code> is the derivative of <code class="reqn">K(r)</code>, the
reduced second moment function (aka “Ripley's <code class="reqn">K</code> function”)
of the point process. See <code>Kest</code> for information
about <code class="reqn">K(r)</code>.
</p>
<p>For a stationary Poisson process, the
pair correlation function is identically equal to 1. Values
<code class="reqn">g(r) &lt; 1</code> suggest inhibition between points;
values greater than 1 suggest clustering.
</p>
<p>This routine computes an estimate of <code class="reqn">g(r)</code>
by kernel smoothing. 
</p>

<ul>
<li>
<p>If <code>divisor="r"</code> (the default), then the standard
kernel estimator (Stoyan and Stoyan, 1994, pages 284–285)
is used. By default, the recommendations of Stoyan and Stoyan (1994)
are followed exactly. 
</p>
</li>
<li>
<p>If <code>divisor="d"</code> then a modified estimator is used
(Guan, 2007): the contribution from
an interpoint distance <code class="reqn">d_{ij}</code> to the
estimate of <code class="reqn">g(r)</code> is divided by <code class="reqn">d_{ij}</code>
instead of dividing by <code class="reqn">r</code>. This usually improves the
bias of the estimator when <code class="reqn">r</code> is close to zero.
</p>
</li>
</ul>
<p>There is also a choice of spatial edge corrections
(which are needed to avoid bias due to edge effects
associated with the boundary of the spatial window):
</p>

<ul>
<li>
<p>If <code>correction="translate"</code> or <code>correction="translation"</code>
then the translation correction
is used. For <code>divisor="r"</code> the translation-corrected estimate
is given in equation (15.15), page 284 of Stoyan and Stoyan (1994).
</p>
</li>
<li>
<p>If <code>correction="Ripley"</code> or <code>correction="isotropic"</code>
then Ripley's isotropic edge correction
is used. For <code>divisor="r"</code> the isotropic-corrected estimate
is given in equation (15.18), page 285 of Stoyan and Stoyan (1994). 
</p>
</li>
<li>
<p>If <code>correction="none"</code> then no edge correction is used,
that is, an uncorrected estimate is computed. 
</p>
</li>
</ul>
<p>Multiple corrections can be selected. The default is
<code>correction=c("translate", "Ripley")</code>.
</p>
<p>Alternatively <code>correction="all"</code> selects all options;
<code>correction="best"</code> selects the option which has the best
statistical performance; <code>correction="good"</code> selects the option
which is the best compromise between statistical performance and speed
of computation.
</p>
<p>The choice of smoothing kernel is controlled by the 
argument <code>kernel</code> which is passed to <code>density.default</code>.
The default is the Epanechnikov kernel, recommended by
Stoyan and Stoyan (1994, page 285).
</p>
<p>The bandwidth of the smoothing kernel can be controlled by the
argument <code>bw</code>. Bandwidth is defined as the standard deviation
of the kernel; see the documentation for <code>density.default</code>.
For the Epanechnikov kernel with half-width <code>h</code>,
the argument <code>bw</code> is equivalent to <code class="reqn">h/\sqrt{5}</code>.
</p>
<p>Stoyan and Stoyan (1994, page 285) recommend using the Epanechnikov
kernel with support <code class="reqn">[-h,h]</code> chosen by the rule of thumn
<code class="reqn">h = c/\sqrt{\lambda}</code>,
where <code class="reqn">\lambda</code> is the (estimated) intensity of the
point process, and <code class="reqn">c</code> is a constant in the range from 0.1 to 0.2.
See equation (15.16).
If <code>bw</code> is missing or <code>NULL</code>,
then this rule of thumb will be applied.
The argument <code>stoyan</code> determines the value of <code class="reqn">c</code>.
The smoothing bandwidth that was used in the calculation is returned
as an attribute of the final result.
</p>
<p>The argument <code>r</code> is the vector of values for the
distance <code class="reqn">r</code> at which <code class="reqn">g(r)</code> should be evaluated.
There is a sensible default.
If it is specified, <code>r</code> must be a vector of increasing numbers
starting from <code>r[1] = 0</code>, 
and <code>max(r)</code> must not exceed half the diameter of 
the window.
</p>
<p>If the argument <code>domain</code> is given, estimation will be restricted
to this region. That is, the estimate of 
<code class="reqn">g(r)</code> will be based on pairs of points in which the first point lies
inside <code>domain</code> and the second point is unrestricted.
The argument <code>domain</code>
should be a window (object of class <code>"owin"</code>) or something acceptable to
<code>as.owin</code>. It must be a subset of the
window of the point pattern <code>X</code>.
</p>
<p>To compute a confidence band for the true value of the
pair correlation function, use <code>lohboot</code>.
</p>
<p>If <code>var.approx = TRUE</code>, the variance of the
estimate of the pair correlation will also be calculated using
an analytic approximation (Illian et al, 2008, page 234)
which is valid for stationary point processes which are not
too clustered. This calculation is not yet implemented when
the argument <code>domain</code> is given.
</p>


<h3>Value</h3>

<p>A function value table
(object of class <code>"fv"</code>).
Essentially a data frame containing the variables
</p>
<table>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>the vector of values of the argument <code class="reqn">r</code> 
at which the pair correlation function <code class="reqn">g(r)</code> has been  estimated
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theo</code></td>
<td>
<p>vector of values equal to 1,
the theoretical value of <code class="reqn">g(r)</code> for the Poisson process
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trans</code></td>
<td>
<p>vector of values of <code class="reqn">g(r)</code>
estimated by translation correction
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iso</code></td>
<td>
<p>vector of values of <code class="reqn">g(r)</code>
estimated by Ripley isotropic correction
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>v</code></td>
<td>
<p>vector of approximate values of the variance of
the estimate of <code class="reqn">g(r)</code>
</p>
</td>
</tr>
</table>
<p>as required.
</p>
<p>If <code>ratio=TRUE</code> then the return value also has two
attributes called <code>"numerator"</code> and <code>"denominator"</code>
which are <code>"fv"</code> objects
containing the numerators and denominators of each
estimate of <code class="reqn">g(r)</code>.
</p>
<p>The return value also has an attribute <code>"bw"</code> giving the
smoothing bandwidth that was used.
</p>


<h3>Advanced Use</h3>

<p>To perform the same computation using several different bandwidths <code>bw</code>,
it is efficient to use the argument <code>close</code>.
This should be the result of <code>closepairs(X, rmax)</code>
for a suitably large value of <code>rmax</code>, namely
<code>rmax &gt;= max(r) + 3 * bw</code>.
</p>


<h3>Author(s)</h3>

<p>Adrian Baddeley <a href="mailto:Adrian.Baddeley@curtin.edu.au">Adrian.Baddeley@curtin.edu.au</a>, Rolf Turner <a href="mailto:rolfturner@posteo.net">rolfturner@posteo.net</a> and Ege Rubak <a href="mailto:rubak@math.aau.dk">rubak@math.aau.dk</a>
and Martin Hazelton <a href="mailto:Martin.Hazelton@otago.ac.nz">Martin.Hazelton@otago.ac.nz</a>.
</p>


<h3>References</h3>

<p>Guan, Y. (2007)
A least-squares cross-validation bandwidth selection approach in pair
correlation function estimation.
<em>Statistics and Probability Letters</em> <b>77</b> (18) 1722–1729.
</p>
<p>Illian, J., Penttinen, A., Stoyan, H. and Stoyan, D. (2008)
<em>Statistical Analysis and Modelling of Spatial Point Patterns.</em>
Wiley.
</p>
<p>Stoyan, D. and Stoyan, H. (1994)
<em>Fractals, random shapes and point fields:
methods of geometrical statistics.</em>
John Wiley and Sons.
</p>


<h3>See Also</h3>

<p><code>Kest</code>,
<code>pcf</code>,
<code>density.default</code>,
<code>bw.stoyan</code>,
<code>bw.pcf</code>,
<code>lohboot</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">  X &lt;- simdat
  
  p &lt;- pcf(X)
  plot(p, main="pair correlation function for X")
  # indicates inhibition at distances r &lt; 0.3

  pd &lt;- pcf(X, divisor="d")

  # compare estimates
  plot(p, cbind(iso, theo) ~ r, col=c("blue", "red"),
         ylim.covers=0, main="", lwd=c(2,1), lty=c(1,3), legend=FALSE)
  plot(pd, iso ~ r, col="green", lwd=2, add=TRUE)
  legend("center", col=c("blue", "green"), lty=1, lwd=2,
         legend=c("divisor=r","divisor=d"))

  # calculate approximate variance and show POINTWISE confidence bands
  pv &lt;- pcf(X, var.approx=TRUE)
  plot(pv, cbind(iso, iso+2*sqrt(v), iso-2*sqrt(v)) ~ r)
</code></pre>


</div>