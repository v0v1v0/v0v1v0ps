<div class="container">

<table style="width: 100%;"><tr>
<td>shapley</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Decomposition of squared Mahalanobis distance using Shapley values.</h2>

<h3>Description</h3>

<p>The <code>shapley</code> function computes a <code class="reqn">p</code>-dimensional vector containing the decomposition of the
squared Mahalanobis distance of <code>x</code> (with respect to <code>mu</code> and <code>Sigma</code>)
into outlyingness contributions of the individual variables (Mayrhofer and Filzmoser 2022).
The value of the <code class="reqn">j</code>-th coordinate of this vector represents the
average marginal contribution of the <code class="reqn">j</code>-th variable to the squared Mahalanobis distance of
the individual observation <code>x</code>.<br>
If <code>cells</code> is provided, Shapley values of <code>x</code> are computed with respect to a local reference point,
that is based on a cellwise prediction of each coordinate, using the information of the regular cells of <code>x</code>, see (Mayrhofer and Filzmoser 2022).<br>
If <code>x</code> is a <code class="reqn">n \times p</code> matrix, a <code class="reqn">n \times p</code> matrix is returned, containing the decomposition for each row.
</p>


<h3>Usage</h3>

<pre><code class="language-R">shapley(
  x,
  mu = NULL,
  Sigma = NULL,
  inverted = FALSE,
  method = "cellMCD",
  check = TRUE,
  cells = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data vector with <code class="reqn">p</code> entries or data matrix with <code class="reqn">n \times p</code> entries containing only numeric entries.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>Either <code>NULL</code> (default) or mean vector of <code>x</code>. If NULL, <code>method</code> is used for parameter estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma</code></td>
<td>
<p>Either <code>NULL</code> (default) or covariance matrix <code class="reqn">p \times p</code> of <code>x</code>. If NULL, <code>method</code> is used for parameter estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inverted</code></td>
<td>
<p>Logical. If <code>TRUE</code>, <code>Sigma</code> is supposed to contain the inverse of the covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Either "cellMCD" (default) or "MCD". Specifies the method used for parameter estimation if <code>mu</code> and/or <code>Sigma</code> are not provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>
<p>Logical. If <code>TRUE</code> (default), inputs are checked before running the function
and an error message is returned if one of the inputs is not as expected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cells</code></td>
<td>
<p>Either <code>NULL</code> (default) or a vector/matrix of the same dimension as <code>x</code>,
indicating the outlying cells. The matrix must contain only zeros and ones, or <code>TRUE</code>/<code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>A <code class="reqn">p</code>-dimensional vector (or a <code class="reqn">n \times p</code> matrix) containing the Shapley values (outlyingness-scores) of <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu_tilde</code></td>
<td>
<p>A <code class="reqn">p</code>-dimensional vector (or a <code class="reqn">n \times p</code> matrix) containing the
alternative reference points based on the regular cells of the original observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>non_centrality</code></td>
<td>
<p>The non-centrality parameters for the Chi-Squared distribution, given by <code>mahlanobis(mu_tilde, mu, Sigma)</code></p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Mayrhofer M, Filzmoser P (2022).
“Multivariate outlier explanations using Shapley values and Mahalanobis distances.”
<a href="https://doi.org/10.48550/ARXIV.2210.10063">doi:10.48550/ARXIV.2210.10063</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Without outlying cells as input in the 'cells' argument#'
# Single observation
p &lt;- 5
mu &lt;- rep(0,p)
Sigma &lt;- matrix(0.9, p, p); diag(Sigma) = 1
Sigma_inv &lt;- solve(Sigma)
x &lt;- c(0,1,2,2.3,2.5)
shapley(x, mu, Sigma)
phi &lt;- shapley(x, mu, Sigma_inv, inverted = TRUE)
plot(phi)

# Multiple observations
library(MASS)
set.seed(1)
n &lt;- 100; p &lt;- 10
mu &lt;- rep(0,p)
Sigma &lt;- matrix(0.9, p, p); diag(Sigma) = 1
X &lt;- mvrnorm(n, mu, Sigma)
X_clean &lt;- X
X[sample(1:(n*p), 100, FALSE)] &lt;- rep(c(-5,5),50)
call_shapley &lt;- shapley(X, mu, Sigma)
plot(call_shapley, subset = 20)


## Giving outlying cells as input in the 'cells' argument
# Single observation
p &lt;- 5
mu &lt;- rep(0,p)
Sigma &lt;- matrix(0.9, p, p); diag(Sigma) = 1
Sigma_inv &lt;- solve(Sigma)
x &lt;- c(0,1,2,2.3,2.5)
call_shapley &lt;- shapley(x, mu, Sigma_inv, inverted = TRUE,
method = "cellMCD", check = TRUE, cells = c(1,1,0,0,0))
plot(call_shapley)

# Multiple observations
library(MASS)
set.seed(1)
n &lt;- 100; p &lt;- 10
mu &lt;- rep(0,p)
Sigma &lt;- matrix(0.9, p, p); diag(Sigma) = 1
X &lt;- mvrnorm(n, mu, Sigma)
X_clean &lt;- X
X[sample(1:(n*p), 100, FALSE)] &lt;- rep(c(-5,5),50)
call_shapley &lt;- shapley(X, mu, Sigma, cells = (X_clean - X)!=0)
plot(call_shapley, subset = 20)
</code></pre>


</div>