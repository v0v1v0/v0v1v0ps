<div class="container">

<table style="width: 100%;"><tr>
<td>CRAN</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Test if running as CRAN
</h2>

<h3>Description</h3>

<p>This function allows package developers to run tests 
themselves that should not run on CRAN or with 
<code>"R CMD check --as-cran"</code> because of compute 
time constraints with <code>CRAN</code> tests.
</p>


<h3>Usage</h3>

<pre><code class="language-R">CRAN(CRAN_pattern, n_R_CHECK4CRAN)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>CRAN_pattern</code></td>
<td>

<p>a regular expressions to apply to the names of 
<code>Sys.getenv()</code> to identify possible 
<code>CRAN</code> parameters.  Defaults to 
<code>Sys.getenv('_CRAN_pattern_')</code> if available 
and <code>'^_R_'</code> if not.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_R_CHECK4CRAN</code></td>
<td>

<p>Assume this is <code>CRAN</code> if at least 
<code>n_R_CHECK4CRAN</code> elements of 
<code>Sys.getenv()</code> have names matching 
x.  Defaults to
<code>Sys.getenv('_n_R_CHECK4CRAN_')</code> if 
available and 5 if not.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The "Writing R Extensions" manual says that 
<code>"R CMD check"</code> can be customized 
"by setting environment variables 
<code>_R_CHECK_*_:</code>, as described in" the 
Tools section of the "R Internals" manual.
</p>
<p><code>'R CMD check'</code> was tested with 
R 3.0.1 under Fedora 18 Linux and with
<code>Rtools 3.0</code> from April 16, 2013 under 
Windows 7.  With the <code>'--as-cran'</code>
option, 7 matches were found;  without it, 
only 3 were found.  These numbers were 
unaffected by the presence or absence of the 
'â€“timings' parameter.  On this basis, the 
default value of <code>n_R_CHECK4CRAN</code> was 
set at 5.
</p>
<p>1.  <code>x. &lt;- Sys.getenv()</code>
</p>
<p>2.  Fix <code>CRAN_pattern</code> and 
<code>n_R_CHECK4CRAN</code> if missing.
</p>
<p>3.  Let <code>i</code> be the indices of 
<code>x.</code> whose names match all the patterns 
in the vector <code>x.</code>
</p>
<p>4.  Assume this is <code>CRAN</code> if 
<code>length(i) &gt;= n_R_CHECK4CRAN</code>.
</p>


<h3>Value</h3>

<p>a logical scalar with attributes 
<code>'Sys.getenv'</code> containing the 
results of <code>Sys.getenv()</code> and 
'matches' containing <code>i</code> per step 
3 above.
</p>


<h3>Author(s)</h3>

<p>Spencer Graves (copied from the 
<code>fda</code> package)
</p>


<h3>See Also</h3>

<p><code>Sys.getenv</code>
<code>skip_on_cran</code>, which uses 
["the NOT_CRAN env var set by devtools and friends"](https://testthat.r-lib.org/reference/skip.html).  This 
<code>CRAN</code> function does NOT require a user to 
set any environment variable. 
</p>


<h3>Examples</h3>

<pre><code class="language-R">




cran &lt;- CRAN()
str(cran)
gete &lt;- attr(cran, 'Sys.getenv')
(ngete &lt;- names(gete))

iget &lt;- grep('^_', names(gete))
gete[iget]

#\dontrun is sometimes run on CRAN.  See
#https://github.com/ThinkR-open/prepare-for-cran
#accessed 2021-06-14
if (interactive()) {
if(CRAN()){
  stop('CRAN')
} else {
  stop('NOT CRAN')
}
}
</code></pre>


</div>