<div class="container">

<table style="width: 100%;"><tr>
<td>stepp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Analyze survival or competing risks data
</h2>

<h3>Description</h3>

<p>This method will be deprecated in the future.  Please use S4 classes (stmodelCI, stmodelKM) 
and corresponding constructors (stepp.CI and stepp.KM) for future development.
</p>
<p>A method to explore the treatment-effect interactions in either survival or competing risks data
arising from two treatment arms of a clinical trial. A permutation distribution approach
to inference is implemented, based on permuting covariate values within each treatment group. 
The statistical significance of observed heterogeneity of treatment effects is calculated using 
permutation tests:<br><br>
1) for the maximum difference between each subpopulation effect and the overall population 
treatment effect or supremum based test statistic; <br>
2) for the difference between each subpopulation effect and the overall population treatment 
effect, which resembles the chi-square statistic. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">  stepp(trttype, coltrt, coltime, colcens=0, coltype=0, covar, trts, 
        patspop, minpatspop, timest, noperm)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>trttype</code></td>
<td>
<p>type of analysis methods to use: "KM" for Kaplan-Maier and "CI" for Cumulative Incidence</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coltrt</code></td>
<td>
<p>the treatment variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coltime</code></td>
<td>
<p>the time to event variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colcens</code></td>
<td>
<p>the censoring variable. If specified, the KM method will be used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coltype</code></td>
<td>
<p>variable with distinct codes for different causes of failure where coltype=0 for censored observations; 
coltype=1 for event of interest; coltype=2 for other causes of failure. If specified, the cumulative incidence method will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar</code></td>
<td>
<p>the covariate of interest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trts</code></td>
<td>
<p>a vector containing the codes for the 2 treatment arms, 1st and 2nd treatment arms, respectively</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>patspop</code></td>
<td>
<p>larger parameter(r2) for subpopulation construction that determines how many patients are in each subpopulation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minpatspop</code></td>
<td>
<p>smaller parameter(r1) for subpopulation construction that determines the largest number of patients in common among consecutive subpopulations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timest</code></td>
<td>
<p>timepoint to estimate survival</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noperm</code></td>
<td>
<p>the desired number of permutations; must be 0 or above</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A statistical method to explore treatment by covariate interactions in survival or competing risks data arising from two 
treatment arms of a clinical trial. The method is based on constructing overlapping subpopulations 
of patients with respect to a covariate of interest, and in observing the pattern of the treatment 
effects estimated across subpopulations. A plot of these treatment effects is called STEPP, or 
Subpopulation Treatment Effect Pattern Plot. STEPP uses the permutation distribution based approach
for inference.
</p>
<p>One can explore the window parameters without invoking the permutation analysis by setting noperm 
to 0.  In that case, pvalue and the covarance matrix will not be available.
</p>
<p>We acknowledge Robert J. Gray for permitting us to use the cmprsk package. 
</p>


<h3>Value</h3>

<p>stepp does all the computation and anlaysis but does not generate any Subpopulation Treatment Effect
Pattern Plot (STEPP).  A steppes object is returned and the user can use stepp_summary, stepp_print,
or stepp_plot to display the information and to generate the plots for further analysis. 
</p>


<h3>Warning </h3>

<p>This function together with other old functions will be depreciated in the future.  A new set of S4 classes are
implemented to replace old interfaces.  Please use them for future development.
</p>
<p>A few tips to keep in mind:
</p>
<p>The variables coltrt, coltime, coltype, and covar must be numeric. No formatting allowed.
</p>
<p>If you receive the error "Error in solve.default(sigma): system is computationally singular; reciprocal condition number = 0" then we recommend changing the seed by re-running stepp. If this error persists after several runs, then the program cannot provide reliable results. Please try modifying your choices of the two parameters minpatspop(r1) and patspop(r2) that define the subpopulation.
</p>
<p>The number of permutations specified in noperm, the sample size, and the number of subpopulations generated will affect how long stepp takes to execute. The results are stable if 2500 or more permutations are specified. Furthermore, varying the number of subpopulations will affect inference.
</p>
<p>The time point selected to estimate survival in timest must be in the same units (e.g., months) as the coltime variable.
</p>
<p>The order of the treatments in the vector trts must be in the same order in the vector tlegend. 
</p>


<h3>Note</h3>

<p>STEPP is an exploratory tool, with graphical features that make it easy for clinicians to interpret 
the results of the analysis. Positive results should prompt the need 
for confirmation from other datasets investigating similar treatment comparisons. It should also be 
clear that STEPP is not meant to estimate specific cutpoints in the range of values of the covariate 
of interest, but rather to provide some indication on ranges of values where treatment effect might 
have a particular behavior.
</p>
<p>STEPP considers the case in which the subpopulations are constructed according to a sliding window 
pattern. The larger parameter (patspop) determines how many patients are in each subpopulation, and 
the smaller parameter (minpatspop) determines the largest number of patients in common among 
consecutive subpopulations. A minimum of 80-100 patients should be in each subpopulation, 
but that is not strictly necessary. The difference (patspop-minpatspop) is the approximate number of 
patients replaced between any two subsequent subpopulations, and can be used to determine the number 
of subpopulations once patspop is fixed. The choice of the values of the parameters patspop and 
minpatspop to be used does change the appearance of the plot and the corresponding p-value. It is 
probably reasonable to experiment with a few combinations to ensure that the significance (or lack 
of significance) is stable with respect to that choice.
</p>
<p>For best results, consider implementing 2500 permutations of the covariate (vector of subpopulations)
to obtain a rich distribution in which to draw inference. 
</p>


<h3>Author(s)</h3>

<p>Ann Lazar, Wai-ki Yip, David Zahrieh, Bernard Cole, Marco Bonetti, Richard Gelber
</p>


<h3>References</h3>

<p>Bonetti M, Gelber RD. Patterns of treatment effects in subsets of patients in clinical trials. Biostatistics 2004; 5(3):465-481.
</p>
<p>Bonetti M, Zahrieh D, Cole BF, Gelber RD. A small sample study of the STEPP approach to assessing treatment-covariate interactions in survival data. Statistics in Medicine 2009; 28(8):1255-68. 
</p>
<p>Lazar AA, Cole BF, Bonetti M, Gelber RD.  Evaluation of treatment-effect heterogeneity using biomarkers measured on a
continuous scale: subpopulation treatment effect pattern plot.  Journal of Clinical Oncology, 2010; 28(29): 4539-4544.
</p>


<h3>See Also</h3>

<p><code>stwin</code>,     <code>stsubpop</code>,  <code>stmodelKM</code>, 
<code>stmodelCI</code>, <code>steppes</code>,   <code>stmodel</code>, 
<code>stepp.win</code>,        <code>stepp.subpop</code>,     <code>stepp.KM</code>,
<code>stepp.CI</code>,                                         
<code>stepp.test</code>,       <code>estimate</code>,         <code>generate</code>,
</p>
<p>Old functions to be deprecated: stepp_summary, stepp_print, stepp_plot, analyze.KM.stepp and analyze.CumInc.stepp. 
</p>


<h3>Examples</h3>

<pre><code class="language-R">#GENERATE TREATMENT VARIABLE:
n &lt;- 1000		# set the sample size
mu &lt;- 0			# set the mean and sd of the covariate
sigma &lt;- 1

beta0 &lt;- log(-log(0.5)) # set the intercept for the log hazard
beta1 &lt;- -0.2		# set the slope on the covariate
beta2 &lt;- 0.5		# set the slope on the treatment indicator
beta3 &lt;- 0.7		# set the slope on the interaction

prob2 &lt;- 0.2		# set the proportion type 2 events
cprob &lt;- 0.3		# set the proportion censored

set.seed(7775432) 	# set the random number seed
covariate &lt;- rnorm(n,mean=mu,sd=sigma)	# generate the covariate values
Txassign &lt;- rbinom(n,1,0.5)		# generate the treatment indicator
x3 &lt;- covariate*Txassign		# compute interaction term
					# compute the hazard for type 1 event
lambda1 &lt;- exp(beta0+beta1*covariate+beta2*Txassign+beta3*x3)
lambda2 &lt;- prob2*lambda1/(1-prob2)	# compute the hazard for the type 2 event
					# compute the hazard for censoring time
lambda0 &lt;- cprob*(lambda1+lambda2)/(1-cprob)
t1 &lt;- rexp(n,rate=lambda1)		# generate the survival time for type 1 event
t2 &lt;- rexp(n,rate=lambda2)		# generate the survival time for type 2 event
t0 &lt;- rexp(n,rate=lambda0)		# generate the censoring time
time &lt;- pmin(t0,t1,t2)			# compute the observed survival time
type &lt;- rep(0,n)
type[(t1 &lt; t0)&amp;(t1 &lt; t2)] &lt;- 1
type[(t2 &lt; t0)&amp;(t2 &lt; t1)] &lt;- 2

# Call stepp to analyze the data
# Warning: In this example, the permutations have been set to 0 to allow the stepp function
# to finish in a short amount of time.  IT IS RECOMMEND TO USE AT LEAST 2500 PERMUTATIONS TO 
# PROVIDE STABLE RESULTS.
steppCI &lt;- stepp("CI", coltrt=Txassign, trts=c(0,1), coltime=time, coltype=type, 
  covar=covariate, patspop=300, minpatspop=200, timest=1.0, noperm=0)

stepp_summary(steppCI)
stepp_print(steppCI)
stepp_plot(steppCI, 
  ncex=0.70,legendy=30,pline=-2.5,color=c("red", "black"),
  xlabel="Subpopulations by Median Age",ylabel="4-year Cancer Relapse",
  tlegend=c("Treatment A", "Treatment B"), nlas=3,pointwise=FALSE)
</code></pre>


</div>