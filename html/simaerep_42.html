<div class="container">

<table style="width: 100%;"><tr>
<td>sim_ur_scenarios</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate Under-Reporting Scenarios</h2>

<h3>Description</h3>

<p>Use with simulated portfolio data to generate under-reporting
stats for specified scenarios.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim_ur_scenarios(
  df_portf,
  extra_ur_sites = 3,
  ur_rate = c(0.25, 0.5),
  r = 1000,
  poisson_test = FALSE,
  prob_lower = TRUE,
  parallel = FALSE,
  progress = TRUE,
  site_aggr_args = list(),
  eval_sites_args = list(),
  check = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df_portf</code></td>
<td>
<p>dataframe as returned by <code>sim_test_data_portfolio</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extra_ur_sites</code></td>
<td>
<p>numeric, set maximum number of additional
under-reporting sites, see details Default: 3</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ur_rate</code></td>
<td>
<p>numeric vector, set under-reporting rates for scenarios
Default: c(0.25, 0.5)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>integer, denotes number of simulations, default = 1000</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>poisson_test</code></td>
<td>
<p>logical, calculates poisson.test pvalue</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob_lower</code></td>
<td>
<p>logical, calculates probability for getting a lower value</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>logical, use parallel processing see details, Default: FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>logical, show progress bar, Default: TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>site_aggr_args</code></td>
<td>
<p>named list of parameters passed to
<code>site_aggr</code>, Default: list()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eval_sites_args</code></td>
<td>
<p>named list of parameters passed to
<code>eval_sites</code>, Default: list()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>
<p>logical, perform data check and attempt repair with</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function will apply under-reporting scenarios to each site.
Reducing the number of AEs by a given under-reporting (ur_rate) for all
patients at the site and add the corresponding under-reporting statistics.
Since the under-reporting probability is also affected by the number of
other sites that are under-reporting we additionally calculate
under-reporting statistics in a scenario where additional under reporting
sites are present. For this we use the median number of patients per site
at the study to calculate the final number of patients for which we lower
the AEs in a given under-reporting scenario. We use the furrr package to
implement parallel processing as these simulations can take a long time to
run. For this to work we need to specify the plan for how the code should
run, e.g. plan(multisession, workers = 18)
</p>


<h3>Value</h3>

<p>dataframe with the following columns:
</p>

<dl>
<dt><strong>study_id</strong></dt>
<dd>
<p>study identification</p>
</dd>
<dt><strong>site_number</strong></dt>
<dd>
<p>site identification</p>
</dd>
<dt><strong>n_pat</strong></dt>
<dd>
<p>number of patients at site</p>
</dd>
<dt><strong>n_pat_with_med75</strong></dt>
<dd>
<p>number of patients at site with visit_med75</p>
</dd>
<dt><strong>visit_med75</strong></dt>
<dd>
<p>median(max(visit)) * 0.75</p>
</dd>
<dt><strong>mean_ae_site_med75</strong></dt>
<dd>
<p>mean AE at visit_med75 site level</p>
</dd>
<dt><strong>mean_ae_study_med75</strong></dt>
<dd>
<p>mean AE at visit_med75 study level</p>
</dd>
<dt><strong>n_pat_with_med75_study</strong></dt>
<dd>
<p>number of patients at site with
visit_med75 at study excl site</p>
</dd>
<dt><strong>extra_ur_sites</strong></dt>
<dd>
<p>additional sites
with under-reporting patients</p>
</dd>
<dt><strong>frac_pat_with_ur</strong></dt>
<dd>
<p>ratio of
patients in study that are under-reporting</p>
</dd>
<dt><strong>ur_rate</strong></dt>
<dd>
<p>under-reporting rate</p>
</dd>
<dt><strong>pval</strong></dt>
<dd>
<p>p-value as
returned by <code>poisson.test</code></p>
</dd>
<dt><strong>prob_low</strong></dt>
<dd>
<p>bootstrapped probability for having mean_ae_site_med75
or lower</p>
</dd> <dt><strong>pval_adj</strong></dt>
<dd>
<p>adjusted p-values</p>
</dd>
<dt><strong>prob_low_adj</strong></dt>
<dd>
<p>adjusted bootstrapped probability for having
mean_ae_site_med75 or lower</p>
</dd> <dt><strong>pval_prob_ur</strong></dt>
<dd>
<p>probability
under-reporting as 1 - pval_adj, poisson.test (use as benchmark)</p>
</dd>
<dt><strong>prob_low_prob_ur</strong></dt>
<dd>
<p>probability under-reporting as 1 -
prob_low_adj, bootstrapped (use)</p>
</dd>
</dl>
<h3>See Also</h3>

<p><code>sim_test_data_study</code>
<code>get_config</code>
<code>sim_test_data_portfolio</code>
<code>sim_ur_scenarios</code>
<code>get_portf_perf</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
df_visit1 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit1$study_id &lt;- "A"

df_visit2 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.2, ur_rate = 0.1)

df_visit2$study_id &lt;- "B"

df_visit &lt;- dplyr::bind_rows(df_visit1, df_visit2)

df_site_max &lt;- df_visit %&gt;%
  dplyr::group_by(study_id, site_number, patnum) %&gt;%
  dplyr::summarise(max_visit = max(visit),
            max_ae = max(n_ae),
            .groups = "drop")

df_config &lt;- get_config(df_site_max)

df_config

df_portf &lt;- sim_test_data_portfolio(df_config)

df_portf

df_scen &lt;- sim_ur_scenarios(df_portf,
                            extra_ur_sites = 2,
                            ur_rate = c(0.5, 1))


df_scen

df_perf &lt;- get_portf_perf(df_scen)

df_perf

</code></pre>


</div>