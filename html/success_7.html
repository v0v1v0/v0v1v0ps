<div class="container">

<table style="width: 100%;"><tr>
<td>bernoulli_cusum</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Risk-adjusted Bernoulli CUSUM</h2>

<h3>Description</h3>

<p>This function can be used to construct a risk-adjusted Bernoulli
CUSUM chart for survival data.
It requires the specification of one of the following combinations of parameters
as arguments to the function:
</p>

<ul>
<li> <p><code>glmmod</code> &amp; <code>theta</code>
</p>
</li>
<li> <p><code>p0</code> &amp; <code>theta</code>
</p>
</li>
<li> <p><code>p0</code> &amp; <code>p1</code>
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">bernoulli_cusum(data, followup, glmmod, theta, p0, p1, h, stoptime, assist,
  twosided = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>data.frame</code> containing the following named columns for each subject:
</p>

<dl>
<dt>
<code>entrytime</code>:</dt>
<dd>
<p>time of entry into study (numeric);</p>
</dd>
<dt>
<code>survtime</code>:</dt>
<dd>
<p>time from entry until event (numeric);</p>
</dd>
<dt>
<code>censorid</code>:</dt>
<dd>
<p>censoring indicator (0 = right censored, 1 = observed)
(integer);</p>
</dd>
</dl>
<p> and optionally additional covariates used for risk-adjustment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>followup</code></td>
<td>
<p>The value of the follow-up time to be used to determine event time.
Event time will be equal to <code>entrytime + followup</code> for each subject.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glmmod</code></td>
<td>
<p>Generalized linear regression model used for risk-adjustment as produced by
the function <code>glm()</code>. Suggested: <br><code>glm(as.formula("(survtime &lt;= followup) &amp; (censorid == 1) ~ covariates"), data = data)</code>. <br>
Alternatively, a list containing the following elements:
</p>

<dl>
<dt>
<code>formula</code>:</dt>
<dd>
<p>a <code>formula()</code> in the form <code>~ covariates</code>;</p>
</dd>
<dt>
<code>coefficients</code>:</dt>
<dd>
<p>a named vector specifying risk adjustment coefficients
for covariates. Names must be the same as in <code>formula</code> and colnames of <code>data</code>.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>The <code class="reqn">\theta</code> value used to specify the odds ratio
<code class="reqn">e^\theta</code> under the alternative hypothesis.
If <code class="reqn">\theta &gt;= 0</code>, the chart will try to detect an increase
in hazard ratio (upper one-sided). If <code class="reqn">\theta &lt; 0</code>,
the chart will look for a decrease in hazard ratio (lower one-sided).
Note that </p>
<p style="text-align: center;"><code class="reqn">p_1 = \frac{p_0 e^\theta}{1-p_0 +p_0 e^\theta}.</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p0</code></td>
<td>
<p>The baseline failure probability at <code>entrytime + followup</code> for individuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p1</code></td>
<td>
<p>The alternative hypothesis failure probability at <code>entrytime + followup</code> for individuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>(optional): Control limit to be used for the procedure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stoptime</code></td>
<td>
<p>(optional): Time after which the value of the chart should no longer be determined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assist</code></td>
<td>
<p>(optional): Output of the function <code>parameter_assist()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>twosided</code></td>
<td>
<p>(optional): Should a two-sided Bernoulli CUSUM be constructed?
Default is <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The Bernoulli CUSUM chart is given by
</p>
<p style="text-align: center;"><code class="reqn">S_n = \max(0, S_{n-1} + W_n),</code>
</p>
<p> where
</p>
<p style="text-align: center;"><code class="reqn">W_n = X_n \ln \left( \frac{p_1 (1-p_0)}{p_0(1-p_1)}  \right) + \ln \left( \frac{1-p_1}{1-p_0} \right)</code>
</p>

<p>and <code class="reqn">X_n</code> is the outcome of the <code class="reqn">n</code>-th (chronological) subject in the data. In terms of the Odds Ratio:
</p>
<p style="text-align: center;"><code class="reqn">W_n = X_n \ln \left( e^\theta  \right) + \ln \left( \frac{1}{1-p_0 + e^\theta p_0} \right)</code>
</p>

<p>For a risk-adjusted procedure (when <code>glmmod</code> is specified), a patient specific baseline failure probability <code class="reqn">p_{0i}</code> is modelled using logistic regression first.
Instead of the standard practice of displaying patient numbering on the
x-axis, the time of outcome is displayed.
</p>


<h3>Value</h3>

<p>An object of class <code>bercusum</code> containing:
</p>

<ul>
<li> <p><code>CUSUM</code>: A <code>data.frame</code> containing the following named columns:
</p>

<dl>
<dt>
<code>time</code>:</dt>
<dd>
<p>times at which chart is constructed;</p>
</dd>
<dt>
<code>value</code>:</dt>
<dd>
<p>value of the chart at corresponding times;</p>
</dd>
<dt>
<code>numobs</code>:</dt>
<dd>
<p>number of observations at corresponding times.</p>
</dd>
</dl>
</li>
<li> <p><code>call</code>: the call used to obtain output;
</p>
</li>
<li> <p><code>glmmod</code>: coefficients of the <code>glm()</code> used
for risk-adjustment, if specified;
</p>
</li>
<li> <p><code>stopind</code>: indicator for whether the chart was stopped by the
control limit.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Daniel Gomon
</p>


<h3>See Also</h3>

<p><code>plot.bercusum</code>, <code>runlength.bercusum</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#We consider patient outcomes 100 days after their entry into the study.
followup &lt;- 100
#Determine a risk-adjustment model using a generalized linear model.
#Outcome (failure within 100 days) is regressed on the available covariates:
exprfitber &lt;- as.formula("(survtime &lt;= followup) &amp; (censorid == 1)~ age + sex + BMI")
glmmodber &lt;- glm(exprfitber, data = surgerydat, family = binomial(link = "logit"))
#Construct the Bernoulli CUSUM on the 1st hospital in the data set.
bercus &lt;- bernoulli_cusum(data = subset(surgerydat, unit == 1), glmmod = glmmodber,
 followup = followup, theta = log(2))
#Plot the Bernoulli CUSUM
plot(bercus)
</code></pre>


</div>