<div class="container">

<table style="width: 100%;"><tr>
<td>read.msc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Read a MSC archive file into a data.frame</h2>

<h3>Description</h3>

<p>Reads a Meteorological Service of Canada (<abbr><span class="acronym">MSC</span></abbr>) digital
archive files (HLY and DLY formats) into a data.frame.
</p>


<h3>Usage</h3>

<pre><code class="language-R">read.msc(file, flags = FALSE, add.elem, format, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>file name (with path, if not in <code>getwd</code>); it
can also be a <code>connection</code>, such as
<code>bzfile</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flags</code></td>
<td>
<p><code>logical</code> return the flags with the
<code>data.frame</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.elem</code></td>
<td>
<p>either a <code>data.frame</code> or a
<code>list</code> with additional elements not found in this
function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>format</code></td>
<td>
<p>parameter ignored and will be removed in a future release</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p><code>logical</code> verbose output, such as number of
stations, elements, records and years in the archive file</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function currently reads in HLY (hourly) and DLY (daily) archive
formats. This is automatically detected. The other formats, FIF
(fifteen-minute) and MLY (monthly), are not currently supported.
</p>
<p>The input file can include multiple stations and multiple elements
(measured variables). The multiple stations are deciphered through
the <code>id</code> column, and the multiple variables appear as columns to
the output data frame.
</p>
<p>This function currently only reads a limited number of elements,
however additional elements can be used by editing two lines in the R
source for this function.
</p>


<h3>Value</h3>

<p>Returns a <code>data.frame</code> object with the following minimum
fields:
</p>

<dl>
<dt>
<code>id</code>:</dt>
<dd>
<p><code>factor</code> used to distinguish multiple
stations within a single data frame</p>
</dd>
<dt>
<code>year</code>:</dt>
<dd>
<p><code>integer</code> year</p>
</dd>
<dt>
<code>yday</code>:</dt>
<dd>
<p><code>integer</code> day of year; 1–365 or 1–366</p>
</dd>
<dt>
<code>date</code>:</dt>
<dd>
<p><code>Date</code>, useful for plotting a continuous
time-series</p>
</dd>
<dt>
<code>datetime</code>:</dt>
<dd>
<p><code>POSIXct</code>, includes date and time
info, only included if <code>file</code> is in HLY archive format</p>
</dd>
<dt>
<code>element</code>:</dt>
<dd>
<p><code>numeric</code>, with
<code>attributes</code> set for <code>units</code> and
<code>long.name</code>; these can be changed using <code>attr</code> on
<code>dat$varname</code></p>
</dd>
<dt>
<code>flag</code>:</dt>
<dd>
<p><code>factor</code>; included if <code>flags=TRUE</code></p>
</dd>
</dl>
<p>The are as many <code>element</code> columns for each element found in the
archive file, such as:
</p>

<table>
<tr>
<td style="text-align: right;">
    <b>alias</b> </td>
<td style="text-align: left;"> <b>name</b> </td>
<td style="text-align: left;"> <b>long.name</b> </td>
<td style="text-align: left;"> <b>units</b>
</td>
</tr>
<tr>
<td style="text-align: right;">
    1   </td>
<td style="text-align: left;"> <code>t_max</code>  </td>
<td style="text-align: left;"> daily maximum temperature </td>
<td style="text-align: left;">
          °C </td>
</tr>
<tr>
<td style="text-align: right;">
    2   </td>
<td style="text-align: left;"> <code>t_min</code>  </td>
<td style="text-align: left;"> daily minimum temperature </td>
<td style="text-align: left;">
          °C </td>
</tr>
<tr>
<td style="text-align: right;">
    3   </td>
<td style="text-align: left;"> <code>t_mean</code> </td>
<td style="text-align: left;"> daily mean temperature </td>
<td style="text-align: left;">
          °C </td>
</tr>
<tr>
<td style="text-align: right;">
    10  </td>
<td style="text-align: left;"> <code>rain</code>   </td>
<td style="text-align: left;"> total rainfall </td>
<td style="text-align: left;"> mm </td>
</tr>
<tr>
<td style="text-align: right;">
    11  </td>
<td style="text-align: left;"> <code>snow</code>   </td>
<td style="text-align: left;"> total snowfall </td>
<td style="text-align: left;"> mm </td>
</tr>
<tr>
<td style="text-align: right;">
    12  </td>
<td style="text-align: left;"> <code>precip</code> </td>
<td style="text-align: left;"> total precipitation </td>
<td style="text-align: left;"> mm </td>
</tr>
<tr>
<td style="text-align: right;">
    13  </td>
<td style="text-align: left;"> <code>snow_d</code> </td>
<td style="text-align: left;"> snow on the ground </td>
<td style="text-align: left;"> cm </td>
</tr>
<tr>
<td style="text-align: right;">
    ... </td>
<td style="text-align: left;"> ... </td>
<td style="text-align: left;"> <em>other elements</em> </td>
<td style="text-align: left;"> <em>optional</em>
  </td>
</tr>
</table>
<p>Additional elements (or variables) can be added by specifying the
<code>element</code> variable, and their units can be set using, for
example, <code>attr(dat$var, "units") &lt;- "cm"</code>.
</p>
<p>Units are in common metric units: ‘mm’ for precipitation-related
measurements, ‘cm’ for snow depth, and
‘?C’ for temperature. The <code>flag</code> columns are
a single character <code>factor</code>, described in the <abbr><span class="acronym">MSC</span></abbr>
Archive documentation. Units are added to each column using, for example
<code>attr(dat$precip, "units") &lt;- "mm"</code>.
</p>


<h3>Author(s)</h3>

<p>Mike Toews</p>


<h3>Source</h3>

<p>Climate data can be requested from <abbr><span class="acronym">MSC</span></abbr>, or can be obtained
directly from the Canadian Daily Climate Data (<abbr><span class="acronym">CDCD</span></abbr>)
CD-ROMs, which are available for a free download (procedure described
in <code>A1128551.DLY</code>).
</p>


<h3>References</h3>

<p><a href="https://web.archive.org/web/20130625230337/http://climate.weatheroffice.gc.ca/prods_servs/documentation_index_e.html">https://web.archive.org/web/20130625230337/http://climate.weatheroffice.gc.ca/prods_servs/documentation_index_e.html</a> (archived) Technical Documentation - Documentation for the Digital Archive of Canadian Climatological Data (Surface) Identified By Element
</p>
<p><code style="white-space: pre;">⁠http://climate.weatheroffice.gc.ca/prods_servs/index_e.html#cdcd⁠</code> (dead link) CDCD CD-ROM download location
</p>


<h3>See Also</h3>

<p><code>mscstn</code>, <code>mksub</code>, <code>mkseas</code>,
<code>A1128551.DLY</code></p>


<h3>Examples</h3>

<pre><code class="language-R">fname &lt;- system.file("extdata", "A1128551.DLY", package="seas")
print(fname)
dat &lt;- read.msc(fname)
print(head(dat))

seas.temp.plot(dat)
year.plot(dat)

# Show how to convert from daily to monthly data
dat$yearmonth &lt;- factor(paste(format(dat$date, "%Y-%m"), 15, sep="-"))
mlydat &lt;- data.frame(date=as.Date(levels(dat$yearmonth)))
mlydat$year &lt;- factor(format(mlydat$date, "%Y"))
mlydat$month &lt;- mkseas(mlydat, "mon")

# means for temperature data
mlydat$t_max &lt;- as.numeric(
    tapply(dat$t_max, dat$yearmonth, mean, na.rm=TRUE))
mlydat$t_min &lt;- as.numeric(
    tapply(dat$t_min, dat$yearmonth, mean, na.rm=TRUE))
mlydat$t_mean &lt;- as.numeric(
    tapply(dat$t_mean, dat$yearmonth, mean, na.rm=TRUE))

# sums for precipitation-related data
mlydat$rain &lt;- as.numeric(
    tapply(dat$rain, dat$yearmonth, sum, na.rm=TRUE))
mlydat$snow &lt;- as.numeric(
    tapply(dat$snow, dat$yearmonth, sum, na.rm=TRUE))
mlydat$precip &lt;- as.numeric(
    tapply(dat$precip, dat$yearmonth, sum, na.rm=TRUE))
print(head(mlydat), 12)

# Show how to convert from a HLY file into daily summaries
## Not run: 
hlydat &lt;- read.msc(bzfile("HLY11_L1127800.bz2"), flags=TRUE)
hlydat$date &lt;- factor(hlydat$date)

# sum the solar radiation for each day to find the 'total daily'
sumdat &lt;- tapply(hlydat$solar, hlydat$date, sum, na.rm=TRUE)
dlydat &lt;- data.frame(date=as.Date(names(sumdat)),
                     solar=as.numeric(sumdat))

# sum the number of hours without measurements
sumdat &lt;- tapply(hlydat$solar, hlydat$date,
                 function(v)(24 - sum(!is.na(v))))
dlydat$na &lt;- as.integer(sumdat)

# quality control to remove days with less than 4 hours missing
Summerland &lt;- dlydat[dlydat$na &lt; 4,]

attr(Summerland$solar, "units") &lt;- "W/(m^2*day)"
attr(Summerland$solar, "long.name") &lt;- "Daily total global solar radiation"
seas.var.plot(Summerland, var="solar", col="yellow", width=5)

## End(Not run)
</code></pre>


</div>