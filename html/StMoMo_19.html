<div class="container">

<table style="width: 100%;"><tr>
<td>fit.StMoMo</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit a Stochastic Mortality Model</h2>

<h3>Description</h3>

<p>Fit a Stochastic Mortality Model to a given data set. The fitting is done 
using package <code>gnm</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'StMoMo'
fit(object, data = NULL, Dxt = NULL, Ext = NULL,
  ages = NULL, years = NULL, ages.fit = NULL, years.fit = NULL,
  oxt = NULL, wxt = NULL, start.ax = NULL, start.bx = NULL,
  start.kt = NULL, start.b0x = NULL, start.gc = NULL, verbose = TRUE,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object of class <code>"StMoMo"</code> defining the stochastic
mortality model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional object of type StMoMoData containing information on
deaths and exposures to be used for fitting the model. This is typically created 
with  function <code>StMoMoData</code>. If this is not provided then the fitting 
data is taken from arguments, <code>Dxt</code>, <code>Ext</code>, <code>ages</code>, <code>years</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Dxt</code></td>
<td>
<p>optional matrix of deaths data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ext</code></td>
<td>
<p>optional matrix of observed exposures of the same dimension of 
<code>Dxt</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ages</code></td>
<td>
<p>optional vector of ages corresponding to rows of <code>Dxt</code> and 
<code>Ext</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>years</code></td>
<td>
<p>optional vector of years corresponding to rows of <code>Dxt</code> and 
<code>Ext</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ages.fit</code></td>
<td>
<p>optional vector of ages to include in the fit. Must be a 
subset of <code>ages</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>years.fit</code></td>
<td>
<p>optional vector of years to include in the fit. Must be a 
subset of <code>years</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oxt</code></td>
<td>
<p>optional matrix/vector or scalar of known offset to be used in fitting
the model. This can be used to specify any a priori known component to be added to 
the predictor during fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wxt</code></td>
<td>
<p>optional matrix of 0-1 weights to be used in the fitting process. 
This can be used, for instance, to zero weight some cohorts in the data.
See <code>genWeightMat</code> which is a helper function for defining 
weighting matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.ax</code></td>
<td>
<p>optional vector with starting values for <code class="reqn">\alpha_x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.bx</code></td>
<td>
<p>optional matrix with starting values for <code class="reqn">\beta_x^{(i)}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.kt</code></td>
<td>
<p>optional matrix with starting values for <code class="reqn">\kappa_t^{(i)}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.b0x</code></td>
<td>
<p>optional vector with starting values for <code class="reqn">\beta_x^{(0)}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.gc</code></td>
<td>
<p>optional vector with starting values for <code class="reqn">\gamma_c</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical value. If <code>TRUE</code> progress indicators are 
printed as the model is fitted. Set <code>verbose = FALSE</code> to silent the 
fitting and avoid progress messages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to be passed to or from other methods. This can be 
used to control the fitting parameters of <code>gnm</code>. See 
<code>gnm</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Fitting is done using function <code>gnm</code> within package 
<code>gnm</code>. This is equivalent to minimising (maximising) the deviance 
(log-likelihood) of the  model. Ages and years in the data should be of 
type numeric. Data points with zero exposure are assigned a zero weight 
and are ignored in the fitting process. Similarly, <code>NA</code> are assigned a
zero weight and ignored in the fitting process. Parameter estimates can be 
plotted using function <code>plot.fitStMoMo</code>.
</p>


<h3>Value</h3>

<p>A list with class <code>"fitStMoMo"</code> with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p> the object of class <code>"StMoMo"</code> defining the fitted 
stochastic mortality model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ax</code></td>
<td>
<p> vector with the fitted values of the static age function 
<code class="reqn">\alpha_x</code>. If the model does not have a static age function or 
failed to fit this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bx</code></td>
<td>
<p> matrix with the values of the period age-modulating functions 
<code class="reqn">\beta_x^{(i)}, i=1, ..., N</code>. If the <code class="reqn">i</code>-th age-modulating 
function is non-parametric (e.g. as in the Lee-Carter model) 
<code>bx[, i]</code> contains the estimated values. If the model does not have 
any age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to 
<code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kt</code></td>
<td>
<p> matrix with the values of the fitted period indexes 
<code class="reqn">\kappa_t^{(i)}, i=1, ..., N</code>. <code>kt[i, ]</code> contains the estimated 
values of the <code class="reqn">i</code>-th period index. If the model does not have any 
age-period terms (i.e. <code class="reqn">N=0</code>) or failed to fit this is set to 
<code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b0x</code></td>
<td>
<p> vector with the values of the cohort age-modulating function 
<code class="reqn">\beta_x^{(0)}</code>. If the age-modulating function is non-parametric 
<code>b0x</code> contains the estimated values. If the model does not have a 
cohort effect or failed to fit this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc</code></td>
<td>
<p> vector with the fitted cohort index <code class="reqn">\gamma_{c}</code>.
If the model does not have a cohort effect or failed to fit this is set
to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p> StMoMoData object provided for fitting the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Dxt</code></td>
<td>
<p> matrix of deaths used in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ext</code></td>
<td>
<p> matrix of exposures used in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oxt</code></td>
<td>
<p> matrix of known offset values used in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wxt</code></td>
<td>
<p> matrix of 0-1 weights used in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ages</code></td>
<td>
<p> vector of ages used in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>years</code></td>
<td>
<p> vector of years used in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cohorts</code></td>
<td>
<p> vector of cohorts used in the fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fittingModel</code></td>
<td>
<p> output from the call to <code>gnm</code> used to fit the 
model. If the fitting failed to converge this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loglik</code></td>
<td>
<p> log-likelihood of the model. If the fitting failed to 
converge this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviance</code></td>
<td>
<p> deviance of the model. If the fitting failed to 
converge this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npar</code></td>
<td>
<p> effective number of parameters in the model. If the fitting
failed to converge this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nobs</code></td>
<td>
<p> number of observations in the model fit. If the fitting
failed to converge this is set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fail</code></td>
<td>
 <p><code>TRUE</code> if a model could not be fitted and 
<code>FALSE</code> otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conv</code></td>
<td>
 <p><code>TRUE</code> if the model fitting converged and 
<code>FALSE</code> if it didn't.</p>
</td>
</tr>
</table>
<p>@seealso <code>StMoMoData</code>, <code>genWeightMat</code>, 
<code>plot.fitStMoMo</code>, <code>EWMaleData</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">   

# Lee-Carter model only for older ages
LCfit &lt;- fit(lc(), data = EWMaleData, ages.fit = 55:89)
plot(LCfit)

# Use arguments Dxt, Ext, ages, years to pass fitting data
LCfit &lt;- fit(lc(), Dxt = EWMaleData$Dxt, Ext = EWMaleData$Ext, 
             ages = EWMaleData$ages, years = EWMaleData$years, 
             ages.fit = 55:89)
plot(LCfit)

# APC model weigthing out the 3 first and last cohorts
wxt &lt;- genWeightMat(EWMaleData$ages,  EWMaleData$years, clip = 3)
APCfit &lt;- fit(apc(), data = EWMaleData, wxt = wxt)
plot(APCfit, parametricbx = FALSE, nCol = 3)

# Set verbose = FALSE for silent fitting
APCfit &lt;- fit(apc(), data = EWMaleData,  wxt = wxt, 
              verbose = FALSE)
## Not run: 
  # Poisson Lee-Carter model with the static age function set to  
  # the mean over time of the log-death rates
  constLCfix_ax &lt;- function(ax, bx, kt, b0x, gc, wxt, ages){  
    c1 &lt;- sum(bx, na.rm = TRUE)
    bx &lt;- bx / c1
    kt &lt;- kt * c1  
    list(ax = ax, bx = bx, kt = kt, b0x = b0x, gc = gc)  
  }  
  LCfix_ax &lt;- StMoMo(link = "log", staticAgeFun = FALSE, 
                     periodAgeFun = "NP", constFun =  constLCfix_ax)
  LCfix_axfit &lt;- fit(LCfix_ax, data= EWMaleData, 
                     oxt = rowMeans(log(EWMaleData$Dxt / EWMaleData$Ext)))
  plot(LCfix_axfit)

## End(Not run)
</code></pre>


</div>