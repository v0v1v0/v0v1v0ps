<div class="container">

<table style="width: 100%;"><tr>
<td>batch</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Run a block of code as part of a batch</h2>

<h3>Description</h3>

<p>This function is useful for sharing data or objects between
simulation replicates. Essentially, it allows simulation replicates to be
divided into “batches”; all replicates in a given batch will then share a
certain set of objects. A common use case for this is a simulation that
involves using multiple methods to analyze a shared dataset, and
repeating this process over a number of dataset replicates. See the <a href="https://avi-kenny.github.io/SimEngine/articles/advanced-functionality.html#using-the-batch-function">Advanced Functionality</a>
vignette for a detailed overview of how this function is used.
</p>


<h3>Usage</h3>

<pre><code class="language-R">batch(code)
</code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>code</code></td>
<td>
<p>A block of code enclosed by curly braces {}; see examples.</p>
</td>
</tr></table>
<h3>Examples</h3>

<pre><code class="language-R">sim &lt;- new_sim()
create_data &lt;- function(n, mu) { rnorm(n=n, mean=mu) }
est_mean &lt;- function(dat, type) {
  if (type=="est_mean") { return(mean(dat)) }
  if (type=="est_median") { return(median(dat)) }
}
sim %&lt;&gt;% set_levels(n=c(10,100), mu=c(3,5), est=c("est_mean","est_median"))
sim %&lt;&gt;% set_config(
  num_sim = 2,
  batch_levels = c("n","mu"),
  return_batch_id = TRUE
)
sim %&lt;&gt;% set_script(function() {
  batch({
    dat &lt;- create_data(n=L$n, mu=L$mu)
  })
  mu_hat &lt;- est_mean(dat=dat, type=L$est)
  return(list(
    "mu_hat" = round(mu_hat,2),
    "dat_1" = round(dat[1],2)
  ))
})
sim %&lt;&gt;% run()
sim$results[order(sim$results$batch_id),]
</code></pre>


</div>