<div class="container">

<table style="width: 100%;"><tr>
<td>shap.plot.dependence</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>SHAP dependence plot and interaction plot, optional to be colored by a
selected feature</h2>

<h3>Description</h3>

<p>This function by default makes a simple dependence plot with feature values
on the x-axis and SHAP values on the y-axis, optional to color by another
feature. It is optional to use a different variable for SHAP values on the
y-axis, and color the points by the feature value of a designated variable.
Not colored if <code>color_feature</code> is not supplied. If <code>data_int</code> (the
SHAP interaction values dataset) is supplied, it will plot the interaction
effect between <code>y</code> and <code>x</code> on the y-axis. Dependence plot is easy
to make if you have the SHAP values dataset from <code>predict.xgb.Booster</code>
or <code>predict.lgb.Booster</code>.
It is not necessary to start with the long format data, but since that is
used for the summary plot, we just continue to use it here.
</p>


<h3>Usage</h3>

<pre><code class="language-R">shap.plot.dependence(
  data_long,
  x,
  y = NULL,
  color_feature = NULL,
  data_int = NULL,
  dilute = FALSE,
  smooth = TRUE,
  size0 = NULL,
  add_hist = FALSE,
  add_stat_cor = FALSE,
  alpha = NULL,
  jitter_height = 0,
  jitter_width = 0,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data_long</code></td>
<td>
<p>the long format SHAP values from <code>shap.prep</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>which feature to show on x-axis, it will plot the feature value</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>which shap values to show on y-axis, it will plot the SHAP value of
that feature. y is default to x, if y is not provided, just plot the SHAP
values of x on the y-axis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_feature</code></td>
<td>
<p>which feature value to use for coloring, color by the
feature value. If "auto", will select the feature "c" minimizing the
variance of the shap value given x and c, which can be viewed as a
heuristic for the strongest interaction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_int</code></td>
<td>
<p>the 3-dimention SHAP interaction values array. if <code>data_int</code>
is supplied, y-axis will plot the interaction values of y (vs. x).
<code>data_int</code> is obtained from either <code>predict.xgb.Booster</code> or
<code>shap.prep.interaction</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dilute</code></td>
<td>
<p>a number or logical, dafault to TRUE, will plot
<code>nrow(data_long)/dilute</code> data. For example, if dilute = 5 will plot
20% of the data. As long as dilute != FALSE, will plot at most half the
data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth</code></td>
<td>
<p>optional to add a <em>loess</em> smooth line, default to TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size0</code></td>
<td>
<p>point size, default to 1 if nobs&lt;1000, 0.4 if nobs&gt;1000</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_hist</code></td>
<td>
<p>whether to add histogram using <code>ggMarginal</code>, default to
TRUE. But notice the plot after adding histogram is a <code>ggExtraPlot</code> object
instead of <code>ggplot2</code> so cannot add <code>geom</code> to that anymore. Turn the
histogram off if you wish to add more <code>ggplot2</code> geoms</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_stat_cor</code></td>
<td>
<p>add correlation and p-value from <code>ggpubr::stat_cor</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>point transparancy, default to 1 if nobs&lt;1000 else 0.6</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jitter_height</code></td>
<td>
<p>amount of vertical jitter (see hight in <code>geom_jitter</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jitter_width</code></td>
<td>
<p>amount of horizontal jitter (see width in <code>geom_jitter</code>). Use values close to 0, e.g. 0.02</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional parameters passed to <code>geom_jitter</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>be default a <code>ggplot2</code> object, based on which you could add more geom
layers.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># **SHAP dependence plot**

# 1. simple dependence plot with SHAP values of x on the y axis
shap.plot.dependence(data_long = shap_long_iris, x="Petal.Length",
                     add_hist = TRUE, add_stat_cor = TRUE)

# 2. can choose a different SHAP values on the y axis
shap.plot.dependence(data_long = shap_long_iris, x="Petal.Length",
                           y = "Petal.Width")

# 3. color by another feature's feature values
shap.plot.dependence(data_long = shap_long_iris, x="Petal.Length",
                           color_feature = "Petal.Width")

# 4. choose 3 different variables for x, y, and color
shap.plot.dependence(data_long = shap_long_iris, x="Petal.Length",
                           y = "Petal.Width", color_feature = "Petal.Width")

# Optional to add hist or remove smooth line, optional to plot fewer data (make plot quicker)
shap.plot.dependence(data_long = shap_long_iris, x="Petal.Length",
                     y = "Petal.Width", color_feature = "Petal.Width",
                     add_hist = TRUE, smooth = FALSE, dilute = 3)

# to make a list of plot
plot_list &lt;- lapply(names(iris)[2:3], shap.plot.dependence, data_long = shap_long_iris)

# **SHAP interaction effect plot **

# To get the interaction SHAP dataset for plotting, need to get `shap_int` first:
mod1 = xgboost::xgboost(
  data = as.matrix(iris[,-5]), label = iris$Species,
  gamma = 0, eta = 1, lambda = 0,nrounds = 1, verbose = FALSE, nthread = 1)
# Use either:
data_int &lt;- shap.prep.interaction(xgb_mod = mod1,
                                  X_train = as.matrix(iris[,-5]))
# or:
shap_int &lt;- predict(mod1, as.matrix(iris[,-5]),
                    predinteraction = TRUE)

# if data_int is supplied, y axis will plot the interaction values of y (vs. x)
shap.plot.dependence(data_long = shap_long_iris,
                           data_int = shap_int_iris,
                           x="Petal.Length",
                           y = "Petal.Width",
                           color_feature = "Petal.Width")
</code></pre>


</div>