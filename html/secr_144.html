<div class="container">

<table style="width: 100%;"><tr>
<td>secr.design.MS</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Construct Detection Model Design Matrices and Lookups </h2>

<h3>Description</h3>

<p>Internal functions used by <code>secr.fit</code>. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">
secr.design.MS (capthist, models, timecov = NULL, sessioncov = NULL, 
    groups = NULL, hcov = NULL, dframe = NULL, naive = FALSE, CL = FALSE,
    keep.dframe = FALSE, full.dframe = FALSE, ignoreusage = FALSE, contrasts = NULL, ...)

make.lookup (tempmat)

insertdim (x, dimx, dims) 

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>capthist</code></td>
<td>
 <p><code>capthist</code> object </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>models</code></td>
<td>
<p> list of formulae for parameters of detection </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timecov</code></td>
<td>
<p> optional dataframe of values of time (occasion-specific) covariate(s). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sessioncov</code></td>
<td>
<p> optional dataframe of values of session-specific covariate(s). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups</code></td>
<td>
<p> optional vector of one or more variables with which to
form groups. Each element should be the name of a factor variable in
the <code>covariates</code> attribute of <code>capthist</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hcov</code></td>
<td>
<p> character name of an individual (capthist) covariate for known class
membership in h2 models</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dframe</code></td>
<td>
<p> optional data frame of design data for detection parameters </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>naive</code></td>
<td>
<p> logical if TRUE then modelled detection probability is for a naive animal (not caught previously); if FALSE then detection probability is contingent on individual's history of detection </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CL</code></td>
<td>
<p> logical; TRUE for model to be fitted by maximizing the conditional likelihood </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.dframe</code></td>
<td>
<p>logical; if TRUE the dataframe of design data is
included in the output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>full.dframe</code></td>
<td>
<p>logical; if FALSE then padding rows are purged from
output dframe (ignored if <code>keep.dframe = FALSE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignoreusage</code></td>
<td>
<p>logical; if TRUE any usage attribute of traps(capthist)
is ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrasts</code></td>
<td>
<p>contrast specification as for <code>model.matrix</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p> other arguments passed to the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> function
<code>model.matrix</code> </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tempmat</code></td>
<td>
<p>matrix for which row lookup required</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of character, numeric or factor values </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dimx</code></td>
<td>
<p>vector of notional dimensions for x to fill in target array</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dims</code></td>
<td>
<p>vector of notional dimensions of target array</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These are internal <span class="pkg">secr</span> functions that you are unlikely ever to
use. 
</p>
<p>Each real parameter is notionally different for each unique combination
of session, individual, occasion, detector and latent class, i.e., for <code class="reqn">R</code>
sessions, <code class="reqn">n</code> individuals, <code class="reqn">S</code> occasions, <code class="reqn">K</code> detectors and <code class="reqn">M</code> latent classes 
there are <em>potentially</em> <code class="reqn">R \times n \times S \times K \times M</code> different values. Actual models always predict a <em>much</em> reduced set
of distinct values, and the number of rows in the design matrix is
reduced correspondingly; a parameter index array allows these to
retrieved for any combination of session, individual, occasion and
detector.
</p>
<p>The <code>keep.dframe</code> option is provided for the rare occasions that a
user may want to check the data frame that is an intermediate step in
computing each design matrix with <code>model.matrix</code> (i.e. the
data argument of <code>model.matrix</code>).
</p>
<p>... may be used to pass <code>contrasts.arg</code> to <code>model.matrix</code>. 
</p>


<h3>Value</h3>

<p>For <code>secr.design.MS</code>, a list with the components
</p>
<table>
<tr style="vertical-align: top;">
<td><code>designMatrices</code></td>
<td>
<p> list of reduced design matrices, one for each
real detection parameter </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameterTable</code></td>
<td>
<p> index to row of the reduced design matrix for
each real detection parameter; dim(parameterTable) = c(uniquepar, np),
where uniquepar is the number of unique combinations of paramater
values (uniquepar &lt; <code class="reqn">RnSKM</code>) and np is the number of parameters in
the detection model. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PIA</code></td>
<td>
<p> Parameter Index Array - index to row of parameterTable for
a given session, animal, occasion and detector; dim(PIA) =
c(R,n,S,K,M) </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p> number of sessions</p>
</td>
</tr>
</table>
<p>If <code>models</code> is empty then all components are NULL except for PIA
which is an array of 1's (M set to 1).  
</p>
<p>Optionally (<code>keep.dframe = TRUE</code>) -
</p>
<table>
<tr style="vertical-align: top;">
<td><code>dframe</code></td>
<td>
<p> dataframe of design data, one column per covariate, one
row for each c(R,n,S,K,M). For multi-session models n, S, and K
refer to the maximum across sessions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>validdim</code></td>
<td>
<p> list giving the valid dimensions (n, S, K, M) before padding</p>
</td>
</tr>
</table>
<p>For <code>make.lookup</code>, a list with components
</p>
<table>
<tr style="vertical-align: top;">
<td><code>lookup</code></td>
<td>
<p> matrix of unique rows</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index</code></td>
<td>
<p> indices in lookup of the original rows</p>
</td>
</tr>
</table>
<p>For <code>insertdim</code>, a vector with length prod(dims) containing the 
values replicated according to dimx.
</p>


<h3>See Also</h3>

 <p><code>D.designdata</code>, <code>model.matrix</code> </p>


<h3>Examples</h3>

<pre><code class="language-R">secr.design.MS (captdata, models = list(g0 = ~b))$designMatrices
secr.design.MS (captdata, models = list(g0 = ~b))$parameterTable

## peek at design data constructed for learned response model
head(captdata)
temp &lt;- secr.design.MS (captdata, models = list(g0 = ~b),
    keep.dframe = TRUE)
a1 &lt;- temp$dframe$animal == 1 &amp;  temp$dframe$detector %in% 8:10
temp$dframe[a1,]

## ... and trap specific learned response model
temp &lt;- secr.design.MS (captdata, models = list(g0 = ~bk),
    keep.dframe = TRUE)
a1 &lt;- temp$dframe$animal == 1 &amp;  temp$dframe$detector %in% 8:10
temp$dframe[a1,]

## place values 1:6 in different dimensions
insertdim(1:6, 1:2, c(2,3,6))
insertdim(1:6, 3, c(2,3,6))

</code></pre>


</div>