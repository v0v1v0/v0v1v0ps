<div class="container">

<table style="width: 100%;"><tr>
<td>fitSpectraSMC</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit the model using Sequential Monte Carlo (SMC).</h2>

<h3>Description</h3>

<p>Fit the model using Sequential Monte Carlo (SMC).
</p>


<h3>Usage</h3>

<pre><code class="language-R">fitSpectraSMC(
  wl,
  spc,
  peakWL,
  lPriors,
  conc = rep(1, nrow(spc)),
  npart = 10000,
  rate = 0.9,
  minESS = npart/2,
  destDir = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>wl</code></td>
<td>
<p>Vector of <code>nwl</code> wavenumbers at which the spetra are observed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spc</code></td>
<td>
<p><code>n_y * nwl</code> Matrix of observed Raman spectra.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>peakWL</code></td>
<td>
<p>Vector of locations for each peak (cm^-1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lPriors</code></td>
<td>
<p>List of hyperparameters for the prior distributions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conc</code></td>
<td>
<p>Vector of <code>n_y</code> nanomolar (nM) dye concentrations for each observation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npart</code></td>
<td>
<p>number of SMC particles to use for the importance sampling distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate</code></td>
<td>
<p>the target rate of reduction in the effective sample size (ESS).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minESS</code></td>
<td>
<p>minimum effective sample size, below which the particles are resampled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>destDir</code></td>
<td>
<p>destination directory to save intermediate results (for long-running computations)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a List containing weighted parameter values, known as particles:
</p>

<dl>
<dt><code>weights</code></dt>
<dd>
<p>Vector of importance weights for each particle.</p>
</dd>
<dt><code>beta</code></dt>
<dd>
<p><code>npart * npeaks</code> Matrix of regression coefficients for the amplitudes.</p>
</dd>
<dt><code>scale</code></dt>
<dd>
<p><code>npart * npeaks</code> Matrix of scale parameters.</p>
</dd>
<dt><code>sigma</code></dt>
<dd>
<p>Vector of <code>npart</code> standard deviations.</p>
</dd>
<dt><code>alpha</code></dt>
<dd>
<p><code>bl.knots * n_y * npart</code> Array of spline coefficients for the baseline.</p>
</dd>
<dt><code>basis</code></dt>
<dd>
<p>A dense <code>nwl * bl.knots</code> Matrix containing the values of the basis functions.</p>
</dd>
<dt><code>expFn</code></dt>
<dd>
<p><code>npart * nwl</code> Matrix containing the spectral signature.</p>
</dd>
<dt><code>ess</code></dt>
<dd>
<p>Vector containing the effective sample size (ESS) at each SMC iteration.</p>
</dd>
<dt><code>logEvidence</code></dt>
<dd>
<p>Vector containing the logarithm of the model evidence (marginal likelihood).</p>
</dd>
<dt><code>accept</code></dt>
<dd>
<p>Vector containing the Metropolis-Hastings acceptance rate at each SMC iteration.</p>
</dd>
<dt><code>sd.mh</code></dt>
<dd>
<p><code>niter * 2npeaks</code> Matrix of random walk MH bandwidths at each SMC iteration..</p>
</dd>
</dl>
<h3>References</h3>

<p>Chopin (2002) "A Sequential Particle Filter Method for Static Models," Biometrika 89(3): 539â€“551,
doi: <a href="https://doi.org/10.1093/biomet/89.3.539">10.1093/biomet/89.3.539</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">wavenumbers &lt;- seq(200,600,by=10)
spectra &lt;- matrix(nrow=1, ncol=length(wavenumbers))
peakLocations &lt;- c(300,500)
peakAmplitude &lt;- c(10000,4000)
peakScale &lt;- c(10, 15)
signature &lt;- weightedLorentzian(peakLocations, peakScale, peakAmplitude, wavenumbers)
baseline &lt;- 1000*cos(wavenumbers/200) + 2*wavenumbers
spectra[1,] &lt;- signature + baseline + rnorm(length(wavenumbers),0,200)
lPriors &lt;- list(scale.mu=log(11.6) - (0.4^2)/2, scale.sd=0.4, bl.smooth=10^11, bl.knots=20,
                beta.mu=5000, beta.sd=5000, noise.sd=200, noise.nu=4)
## Not run: 
result &lt;- fitSpectraSMC(wavenumbers, spectra, peakLocations, lPriors, npart=500)

## End(Not run)
</code></pre>


</div>