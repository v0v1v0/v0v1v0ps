<div class="container">

<table style="width: 100%;"><tr>
<td>early.delta.test</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Estimate and test the early treatment effect
</h2>

<h3>Description</h3>

<p>Estimates the early treatment effect estimate and provides two versions of the standard error; tests the null hypothesis that this treatment effect is equal to 0 </p>


<h3>Usage</h3>

<pre><code class="language-R">early.delta.test(Axzero, Adeltazero, Aszero, Bxzero, Bdeltazero, Bszero, Bxone, 
Bdeltaone, Bsone, t, landmark, perturb = T, extrapolate = T, transform = F)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Axzero</code></td>
<td>


<p>observed event times in the control group in  Study A
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Adeltazero</code></td>
<td>


<p>event/censoring indicators in the control group in Study A
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Aszero</code></td>
<td>


<p>surrogate marker values in the control group in Study A, NA for individuals not observable at the time the surrogate marker was measured
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Bxzero</code></td>
<td>


<p>observed event times in the control group in  Study B
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Bdeltazero</code></td>
<td>


<p>event/censoring indicators in the control group in Study B
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Bszero</code></td>
<td>


<p>surrogate marker values in the control group in Study B, NA for individuals not observable at the time the surrogate marker was measured
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Bxone</code></td>
<td>


<p>observed event times in the treatment group in  Study B
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Bdeltaone</code></td>
<td>


<p>event/censoring indicators in the treatment group in  Study B
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Bsone</code></td>
<td>


<p>surrogate marker values in the treatment group in Study B, NA for individuals not observable at the time the surrogate marker was measured
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>


<p>time of interest
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>landmark</code></td>
<td>


<p>landmark time of interest, t0
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perturb</code></td>
<td>


<p>TRUE or FALSE; indicates whether the standard error estimate obtained using perturbation resampling should be calculated
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extrapolate</code></td>
<td>


<p>TRUE or FALSE; indicates whether local constant extrapolation should be used, default is TRUE
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform</code></td>
<td>


<p>TRUE or FALSE; indicates whether a transformation should be used, default is FALSE.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Assume there are two randomized studies of a treatment effect, a prior study (Study A) and a current study (Study B). Study A was completed up to some time t, while Study B was stopped at time <code class="reqn">t_0&lt;t</code>. In both studies, a surrogate marker was measured at time <code class="reqn">t_0</code> for individuals still observable at <code class="reqn">t_0</code>. Let <code class="reqn">G</code> be the binary treatment indicator with <code class="reqn">G=1</code> for treatment and <code class="reqn">G=0</code> for control and we assume throughout that subjects are randomly assigned to a treatment group at baseline. Let <code class="reqn">T_K^{(1)}</code> and <code class="reqn">T_K^{(0)}</code> denote the time of the primary outcome of interest, death for example, under the treatment and under the control, respectively, in Study K. Let <code class="reqn">S_K^{(1)}</code> and <code class="reqn">S_K^{(0)}</code> denote the surrogate marker measured at time <code class="reqn">t_0</code> under the treatment and the control, respectively, in Study K.
</p>
<p>The treatment effect quantity of interest, <code class="reqn">\Delta_K(t)</code>, is the difference in survival rates by time <code class="reqn">t</code> under treatment versus control,
</p>
<p style="text-align: center;"><code class="reqn"> \Delta_K(t)=E\{ I(T_K^{(1)}&gt;t)\} - E\{I(T_K^{(0)}&gt;t)\} = P(T_K^{(1)}&gt;t) - P(T_K^{(0)}&gt;t)</code>
</p>

<p>where <code class="reqn">t&gt;t_0</code>. Here, we estimate an early treatment effect quantity using surrogate marker information defined as, 
</p>
<p style="text-align: center;"><code class="reqn">\Delta_{EB}(t,t_0) = P( T_B^{(1)} &gt; t_0) \int r(t|s,t_0) dF_B^{(1)} (s|t_0) - P( T_B^{(0)} &gt; t_0) \int r(t|s,t_0) dF_B^{(0)} (s|t_0)</code>
</p>

<p>where <code class="reqn">r(t|s,t_0) = P(T_{A}^{(0)} &gt; t | T_{A}^{(0)} &gt; t_0, S_{A}^{(0)}=s)</code> and <code class="reqn">F_B^{(g)}(s|t_0) = P(S_B^{(g)} \le s \mid T_B^{(g)} &gt; t_0)</code>.
</p>
<p>To test the null hypothesis that <code class="reqn">\Delta_B(t) = 0</code>, we test the null hypothesis <code class="reqn">\Delta_{EB}(t,t_0) = 0</code> using the test statistic </p>
<p style="text-align: center;"><code class="reqn">Z_{EB}(t,t_0) = \sqrt{n_B}\frac{\hat{\Delta}_{EB}(t,t_0)}{\hat{\sigma}_{EB}(t,t_0)}</code>
</p>

<p>where <code class="reqn">\hat{\Delta}_{EB}(t,t_0)</code> is a consistent estimate of <code class="reqn">\Delta_{EB}(t,t_0)</code> and <code class="reqn">\hat{\sigma}_{EB}(t,t_0)</code> is the estimated standard error of <code class="reqn">\sqrt{n_B}\{\hat{\Delta}_{EB}(t,t_0)-\Delta_{EB}(t, t_0)\}.</code>  We reject the null hypothesis when <code class="reqn">|Z_{EB}(t,t_0) | &gt; \Phi^{-1}(1-\alpha/2)</code> where <code class="reqn">\alpha</code> is the Type 1 error rate. 
</p>
<p>To obtain <code class="reqn">\hat{\Delta}_{EB}(t,t_0)</code>, we use 
</p>
<p style="text-align: center;"><code class="reqn">  \hat{\Delta}_{EB}(t,t_0) = n_{B1}^{-1} \sum_{i=1}^{n_{B1}} \hat{r}_A^{(0)}(t|S_{Bi}^{(1)}, t_0) \frac{I(X_{Bi}^{(1)} &gt; t_0)}{\hat{W}_{B1}^C(t_0)} -  n_{B0}^{-1} \sum_{i=1}^{n_{B0}} \hat{r}_A^{(0)}(t|S_{Bi}^{(0)}, t_0) \frac{I(X_{Bi}^{(0)} &gt; t_0)}{\hat{W}_{B0}^C(t_0)}</code>
</p>

<p>where <code class="reqn">\hat{W}^C_{k g}(u)</code> is the Kaplan-Meier estimator of <code class="reqn">W_{k g}^{C}(u)=P(C_{k}^{(g)} &gt; u)</code>  and 
<code class="reqn">\hat{r}_A^{(0)}(t|s,t_0) = \exp\{-\hat{\Lambda}_A^{(0)}(t\mid s,t_0) \}</code>, where
</p>
<p style="text-align: center;"><code class="reqn">\hat{\Lambda}_A^{(0)}(t \mid t_0,s) = \int_{t_0}^t \frac{\sum_{i=1}^{n_{A0}} I(X_{Ai}^{(0)}&gt;t_0) K_h\{\gamma(S_{Ai}^{(0)}) - \gamma(s)\}dN_{Ai}^{(0)} (z)}{\sum_{i=1}^{n_{A0}}  K_h\{\gamma(S_{Ai}^{(0)}) - \gamma(s)\} Y_{Ai}^{(0)}(z)}</code>
</p>

<p>is a consistent estimate of <code class="reqn">\Lambda_A^{(0)}(t\mid t_0,s ) =  -\log [r_A^{(0)}(t\mid t_0,s)],</code> <code class="reqn">Y_{Ai}^{(0)}(t) = I(X_{Ai}^{(0)} \geq t)</code>,  <code class="reqn">N_{Ai}^{(0)}(t) = I(X_{Ai}^{(0)} \leq t) \delta_{Ai}^{(0)},  K(\cdot)</code> is a smooth symmetric density function, <code class="reqn">K_h(x) = K(x/h)/h</code> and <code class="reqn">\gamma(\cdot)</code> is a given monotone transformation function.  For the bandwidth <code class="reqn">h</code>, we require the standard undersmoothing assumption of <code class="reqn">h=O(n_g^{-\gamma})</code> with <code class="reqn">\gamma \in (1/4,1/2)</code> in order to eliminate the impact of the bias of the conditional survival function on the resulting estimator.
</p>
<p>The quantity <code class="reqn">\hat{\sigma}_{EB}(t,t_0)</code> is obtained using either a closed form expression under the null or a perturbation resampling approach. If a confidence interval is desired, perturbation resampling is required.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>delta.eb</code></td>
<td>
<p>The estimate early treatment effect, <code class="reqn">\hat{\Delta}_{EB}(t,t_0)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.closed</code></td>
<td>
<p>The standard error estimate of the early treatment effect using the closed form expression under the null.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z.closed</code></td>
<td>
<p>The test statistic using the closed form standard error expression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.value.closed</code></td>
<td>
<p>The p-value using the closed form standard error expression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.closed.norm</code></td>
<td>
<p>The confidence interval for the early treatment effect, using a normal approximation and using the closed form standard error expression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.perturb</code></td>
<td>
<p>The standard error estimate of the early treatment effect using perturbation resampling, if perturb = T.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z.perturb</code></td>
<td>
<p>The test statistic using the perturbed standard error estimate, if perturb = T.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.value.perturb</code></td>
<td>
<p>The p-value using the perturbed standard error estimate, if perturb = T.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.perturb.norm</code></td>
<td>
<p>The confidence interval for the early treatment effect, using a normal approximation and using the perturbed standard error expression, if perturb = T.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta.eb.CI</code></td>
<td>
<p>The confidence interval for the early treatment effect, using the quantiles of the perturbed estimates, if perturb = T.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>


<p>Layla Parast
</p>


<h3>References</h3>


<p>Parast L, Cai T, Tian L (2019). Using a Surrogate Marker for Early Testing of a Treatment Effect. Biometrics, 75(4):1253-1263.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(dataA)
data(dataB)
early.delta.test(Axzero = dataA$x0, Adeltazero = dataA$delta0, Aszero = dataA$s0, 
Bxzero = dataB$x0, Bdeltazero = dataB$delta0, Bszero = dataB$s0, Bxone = dataB$x1, 
Bdeltaone = dataB$delta1, Bsone = dataB$s1, t=1, landmark=0.5, perturb = FALSE, 
extrapolate = TRUE)

early.delta.test(Axzero = dataA$x0, Adeltazero = dataA$delta0, Aszero = dataA$s0, 
Bxzero = dataB$x0, Bdeltazero = dataB$delta0, Bszero = dataB$s0, Bxone = dataB$x1, 
Bdeltaone = dataB$delta1, Bsone = dataB$s1, t=0.75, landmark=0.5, perturb = FALSE, 
extrapolate = TRUE)


early.delta.test(Axzero = dataA$x0, Adeltazero = dataA$delta0, Aszero = dataA$s0, 
Bxzero = dataB$x0, Bdeltazero = dataB$delta0, Bszero = dataB$s0, Bxone = dataB$x1, 
Bdeltaone = dataB$delta1, Bsone = dataB$s1, t=1, landmark=0.5, perturb = TRUE, 
extrapolate = TRUE)	


</code></pre>


</div>