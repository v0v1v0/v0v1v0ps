<div class="container">

<table style="width: 100%;"><tr>
<td>genMixedCellProp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate training and test cell type composition matrices</h2>

<h3>Description</h3>

<p>Generate training and test cell type composition matrices for the simulation
of mixed transcriptional profiles with known cell composition using
single-cell expression profiles. The resulting
<code>PropCellTypes</code> object will contain all the information
needed to simulate new mixed transcriptional profiles. Note this function
does not simulate the mixed profiles, this task is performed by the
<code>simMixedProfiles</code> or <code>trainDeconvModel</code> functions
(see Documentation).
</p>


<h3>Usage</h3>

<pre><code class="language-R">genMixedCellProp(
  object,
  cell.ID.column,
  cell.type.column,
  num.sim.spots,
  n.cells = 50,
  train.freq.cells = 3/4,
  train.freq.spots = 3/4,
  proportion.method = c(0, 0, 1),
  prob.sparity = 1,
  min.zero.prop = NULL,
  balanced.type.cells = TRUE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p><code>SpatialDDLS</code> object with
<code>single.cell.real</code> slot and, optionally, with <code>single.cell.simul</code>
slot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cell.ID.column</code></td>
<td>
<p>Name or column number corresponding to cell names in
cells metadata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cell.type.column</code></td>
<td>
<p>Name or column number corresponding to cell types in
cells metadata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num.sim.spots</code></td>
<td>
<p>Number of mixed profiles to be simulated. It is
recommended to adjust this number according to the number of available
single-cell profiles.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.cells</code></td>
<td>
<p>Specifies the number of cells to be randomly selected and
combined to generate the simulated mixed profiles. By default, it is set to
50 It controls the level of noise present in the simulated data, as it
determines how many single-cell profiles will be combined to produce each
spot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>train.freq.cells</code></td>
<td>
<p>Proportion of cells used to simulate training mixed
transcriptional profiles (3/4 by default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>train.freq.spots</code></td>
<td>
<p>Proportion of mixed transcriptional profiles to be
used for training, relative to the total number of simulated spots
(<code>num.sim.spots</code>). The default value is 3/4.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proportion.method</code></td>
<td>
<p>Vector with three elements that controls the
proportion of simulated proportions generated by each method: random
sampling of a Dirichlet distribution, "pure" spots (1 cell type), and spots
generated from a random sampling of a Dirichlet distribution but with a
specified number of different cell types (determined by
<code>min.zero.prop</code>), respectively. By default, all samples are generated
by the last method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob.sparity</code></td>
<td>
<p>It only affects the proportions generated by the first
method (Dirichlet distribution). It determines the probability of having
missing cell types in each simulated spot, as opposed to a mixture of all
cell types. A higher value for this parameter will result in more sparse
simulated samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.zero.prop</code></td>
<td>
<p>This parameter controls the minimum number of cell types
that will be absent in each simulated spot. If <code>NULL</code> (by default),
this value will be half of the total number of different cell types, but
increasing it will result in more spots composed of fewer cell types. This
helps to create more sparse proportions and cover a wider range of
situations during model training.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>balanced.type.cells</code></td>
<td>
<p>Boolean indicating whether training and test cells
will be split in a balanced way considering cell types (<code>TRUE</code> by
default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Show informative messages during the execution (<code>TRUE</code> by
default).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>First, the single-cell profiles are randomly divided into two subsets, with
2/3 of the data for training and 1/3 for testing. The default setting for
this ratio can be changed using the <code>train.freq.cells</code> parameter. Next,
a total of <code>num.sim.spots</code> mixed proportions are simulated using a
Dirichlet distribution. This simulation takes into account the probability of
missing cell types in each spot, which can be adjusted using the
<code>prob.sparity</code> parameter. For each mixed sample, <code>n.cells</code>
single-cell profiles are randomly selected and combined to generate the
simulated mixed sample. In addition to the Dirichlet-based proportions, pure
spots (containing only one cell type) and spots containing a specified number
of different cell types (determined by the <code>min.zero.prop</code> parameter)
are also generated in order to cover situations with only a few cell types
present. The proportion of simulated spots generated by each method can be
controlled using the <code>proportion.method</code> parameter. To visualize the
distribution of cell type proportions generated by each method, the
<code>showProbPlot</code> function can be used.
</p>


<h3>Value</h3>

<p>A <code>SpatialDDLS</code> object with <code>prob.cell.types</code>
slot containing a <code>list</code> with two <code>PropCellTypes</code>
objects (training and test). For more information about the structure of
this class, see <code>?PropCellTypes</code>.
</p>


<h3>See Also</h3>

<p><code>simMixedProfiles</code> <code>PropCellTypes</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(123)
sce &lt;- SingleCellExperiment::SingleCellExperiment(
  assays = list(
    counts = matrix(
      rpois(100, lambda = 5), nrow = 40, ncol = 30,
      dimnames = list(paste0("Gene", seq(40)), paste0("RHC", seq(30)))
    )
  ),
  colData = data.frame(
    Cell_ID = paste0("RHC", seq(30)),
    Cell_Type = sample(x = paste0("CellType", seq(4)), size = 30,
                       replace = TRUE)
  ),
  rowData = data.frame(
    Gene_ID = paste0("Gene", seq(40))
  )
)

SDDLS &lt;- createSpatialDDLSobject(
  sc.data = sce,
  sc.cell.ID.column = "Cell_ID",
  sc.gene.ID.column = "Gene_ID",
  sc.filt.genes.cluster = FALSE,
  project = "Simul_example"
)
SDDLS &lt;- genMixedCellProp(
  object = SDDLS,
  cell.ID.column = "Cell_ID",
  cell.type.column = "Cell_Type",
  num.sim.spots = 10,
  train.freq.cells = 2/3,
  train.freq.spots = 2/3,
  verbose = TRUE
)
  
</code></pre>


</div>