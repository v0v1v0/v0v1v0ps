<div class="container">

<table style="width: 100%;"><tr>
<td>seqICP</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Sequential Invariant Causal Prediction</h2>

<h3>Description</h3>

<p>Estimates the causal parents S of the target variable Y using invariant causal prediction and fits a linear model of the form <br> Y = a X^S + N.
</p>


<h3>Usage</h3>

<pre><code class="language-R">seqICP(X, Y, test = "decoupled", par.test = list(grid = c(0,
  round(nrow(X)/2), nrow(X)), complements = FALSE, link = sum, alpha = 0.05, B =
  100, permutation = FALSE), model = "iid", par.model = list(pknown = FALSE,
  p = 0, max.p = 10), max.parents = ncol(X), stopIfEmpty = TRUE,
  silent = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>matrix of predictor variables. Each column corresponds to
one predictor variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>vector of target variable, with length(Y)=nrow(X).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test</code></td>
<td>
<p>string specifying the hypothesis test used to test for
invariance of a parent set S (i.e. the null hypothesis
H0_S). The following tests are available: "decoupled",
"combined", "trend", "variance", "block.mean", "block.variance",
"block.decoupled", "smooth.mean", "smooth.variance",
"smooth.decoupled" and "hsic".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par.test</code></td>
<td>
<p>parameters specifying hypothesis test. The
following parameters are available: <code>grid</code>,
<code>complements</code>, <code>link</code>, <code>alpha</code>, <code>B</code> and
<code>permutation</code>. The parameter <code>grid</code> is an increasing
vector of gridpoints used to construct enviornments for change
point based tests. If the parameter <code>complements</code> is 'TRUE'
each environment is compared against its complement if it is
'FALSE' all environments are compared pairwise. The parameter
<code>link</code> specifies how to compare the pairwise test
statistics, generally this is either max or sum. The parameter
<code>alpha</code> is a numeric value in (0,1) indicting the
significance level of the hypothesis test. The parameter
<code>B</code> is an integer and specifies the number of Monte-Carlo
samples (or permutations) used in the approximation of the null
distribution. If the parameter <code>permutation</code> is 'TRUE' a
permuatation based approach is used to approximate the null
distribution, if it is 'FALSE' the scaled residuals approach is
used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>string specifying the underlying model class. Either
"iid" if Y consists of independent observations or "ar" if Y has
a linear time dependence structure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par.model</code></td>
<td>
<p>parameters specifying model. The following
parameters are available: <code>pknown</code>, <code>p</code> and
<code>max.p</code>. If <code>pknown</code> is 'FALSE' the number of lags will be
determined by comparing all fits up to <code>max.p</code> lags using
the AIC criterion. If <code>pknown</code> is 'TRUE' the procedure will fit
<code>p</code> lags.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.parents</code></td>
<td>
<p>integer specifying the maximum size for
admissible parents. Reducing this below the number of predictor
variables saves computational time but means that the confidence
intervals lose their coverage property.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stopIfEmpty</code></td>
<td>
<p>if ‘TRUE’, the procedure will stop computing
confidence intervals if the empty set has been accepted (and
hence no variable can have a signicificant causal
effect). Setting to ‘TRUE’ will save computational time in these
cases, but means that the confidence intervals lose their
coverage properties for values different to 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>If 'FALSE', the procedure will output progress
notifications consisting of the currently computed set S
together with the p-value resulting from the null hypothesis
H0_S</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function can be applied to two types of models<br>
(1) a linear model (model="iid")<br> Y_i = a X_i^S + N_i<br> with iid noise N_i and <br>
(2) a linear autoregressive model (model="ar")<br> Y_t = a_0 X_t^S + ... + a_p (Y_(t-p),X_(t-p)) + N_t<br> with iid noise N_t.
</p>
<p>For both models the invariant prediction procedure is applied
using the hypothesis test specified by the <code>test</code> parameter
to determine whether a candidate model is invariant. For further
details see the references.
</p>


<h3>Value</h3>

<p>object of class 'seqICP' consisting of the following
elements
</p>
<table>
<tr style="vertical-align: top;">
<td><code>parent.set</code></td>
<td>
<p>vector of the estimated causal parents.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test.results</code></td>
<td>
<p>matrix containing the result from each
individual test as rows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>list of all the sets that were
tested. The position within the list corresponds to the index in
the first column of the test.results matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.values</code></td>
<td>
<p>p-value for being not included in the set of true
causal parents. (If a p-value is smaller than alpha, the
corresponding variable is a member of parent.set.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>vector of coefficients resulting from a
regression based on the estimated parent set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stopIfEmpty</code></td>
<td>
<p>a boolean value indicating whether computations
stop as soon as intersection of accepted sets is empty.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelReject</code></td>
<td>
<p>a boolean value indicating if the whole model was
rejected (the p-value of the best fitting model is too low).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pknown</code></td>
<td>
<p>a boolean value indicating whether the number of
lags in the model was known. Only relevant if model was set to
"ar".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>significance level at which the hypothesis tests were performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.var</code></td>
<td>
<p>number of predictor variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>either "iid" or "ar" depending on which model was selected.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Niklas Pfister and Jonas Peters
</p>


<h3>References</h3>

<p>Pfister, N., P. Bühlmann and J. Peters (2017).
Invariant Causal Prediction for Sequential Data. ArXiv e-prints (1706.08058).
</p>
<p>Peters, J., P. Bühlmann, and N. Meinshausen (2016).
Causal inference using invariant prediction: identification and confidence intervals.
Journal of the Royal Statistical Society, Series B (with discussion) 78 (5), 947–1012.
</p>


<h3>See Also</h3>

<p>The function <code>seqICP.s</code> allows to perform
hypothesis test for individual sets S. For non-linear
models the functions <code>seqICPnl</code> and
<code>seqICPnl.s</code> can be used.
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1)

# environment 1
na &lt;- 140
X1a &lt;- 0.3*rnorm(na)
X3a &lt;- X1a + 0.2*rnorm(na)
Ya &lt;- -.7*X1a + .6*X3a + 0.1*rnorm(na)
X2a &lt;- -0.5*Ya + 0.5*X3a + 0.1*rnorm(na)

# environment 2
nb &lt;- 80
X1b &lt;- 0.3*rnorm(nb)
X3b &lt;- 0.5*rnorm(nb)
Yb &lt;- -.7*X1b + .6*X3b + 0.1*rnorm(nb)
X2b &lt;- -0.5*Yb + 0.5*X3b + 0.1*rnorm(nb)

# combine environments
X1 &lt;- c(X1a,X1b)
X2 &lt;- c(X2a,X2b)
X3 &lt;- c(X3a,X3b)
Y &lt;- c(Ya,Yb)
Xmatrix &lt;- cbind(X1, X2, X3)

# Y follows the same structural assignment in both environments
# a and b (cf. the lines Ya &lt;- ... and Yb &lt;- ...).
# The direct causes of Y are X1 and X3.
# A linear model considers X1, X2 and X3 as significant.
# All these variables are helpful for the prediction of Y.
summary(lm(Y~Xmatrix))

# apply seqICP to the same setting
seqICP.result &lt;- seqICP(X = Xmatrix, Y,
par.test = list(grid = seq(0, na + nb, (na + nb)/10), complements = FALSE, link = sum,
alpha = 0.05, B =100), max.parents = 4, stopIfEmpty=FALSE, silent=FALSE)
summary(seqICP.result)
# seqICP is able to infer that X1 and X3 are causes of Y
</code></pre>


</div>