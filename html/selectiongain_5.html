<div class="container">

<table style="width: 100%;"><tr>
<td>multistageoptimum.nlm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function for optimizing n-stage selection with the NLM algorithm for a given correlation matrix</h2>

<h3>Description</h3>

<p>This function is used to calculate the maximum of <code class="reqn">\Delta G</code> with given correlation matrix by non-linear minimization algorithm.
</p>


<h3>Usage</h3>

<pre><code class="language-R">multistageoptimum.nlm(corr, Vg, ini.value, 
Budget, CostProd, CostTest, 
Nf, iterlim, alg, N.upper, N.lower)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>corr</code></td>
<td>
<p>is the correlation matrix of y and X, which is introduced in function multistagecorr. The correlation matrix must be symmetric and positive-definite. Before starting the calculations, the user is recommended to check the correlation matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Vg</code></td>
<td>
<p>is genotypic variance <code class="reqn">\delta_y^2</code>. The default value is 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ini.value</code></td>
<td>
<p>is a vector, which stores the number of candidates in each stage for the algorithm to begin with. As default, it will use <code class="reqn">N=\{N_1,N_2,...,N_n\}=\{a+1,...,a+n\}</code>, where a is defined as <code class="reqn">(N.upper+N.lower)/4</code></p>
</td>
</tr>
</table>
<p>.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Budget</code></td>
<td>
<p>contains the value of total budget.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CostProd</code></td>
<td>
<p> contains the initial costs of producing or providing a candidate in each stage</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CostTest</code></td>
<td>
<p> contains a vector with length n reflecting the cost of evaluating a candidate in the tests performed at stage i, i=1,...,n. The cost might vary in different stages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Nf</code></td>
<td>
<p> is the number of finally selected candidates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterlim</code></td>
<td>
<p>is the maximum number of iterations to be executed before the Newton algorithm is terminated. By default it is equal to 20. If the <code class="reqn">\texttt{Budget}</code> increases 10 times for making the selection, the value of <code class="reqn">\texttt{iterlim}</code> has to be increased <code class="reqn">lg(10)</code> times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alg</code></td>
<td>
<p>is used to switch between two algorithms. If <code>alg = GenzBretz()</code>, which is by default, the quasi-Monte Carlo algorithm from Genz et al. (2009, 2013), will be used. If <code>alg = Miwa()</code>, the program will use the Miwa algorithm (Mi et al., 2009), which is an analytical solution of the MVN integral. Miwa's algorithm has higher accuracy (7 digits) than quasi-Monte Carlo algorithm (5 digits). However, its computational speed is slower. We recommend the user to use Miwa algorithm of this parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N.upper</code></td>
<td>
<p> is the vector of up limits of number of candidates X.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N.lower</code></td>
<td>
<p>is the vector of low limits of number of candidates X.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The output of this function is a vector similar as in multistageoptimal.grid(). However, the optimal number of candidates in each stage determined by the NLM algorithm is clearly not an integer, because the function uses a numerical algorithm, which depends on derivatives. 
</p>


<h3>Note</h3>

<p> no further comment
</p>


<h3>Author(s)</h3>

<p> Xuefei Mi</p>


<h3>References</h3>

<p>A. Genz and F. Bretz. Computation of Multivariate Normal and t Probabilities. Lecture Notes in Statistics, Vol. 195, Springer-Verlag, Heidelberg, 2009.
</p>
<p>A. Genz, F. Bretz, T. Miwa, X. Mi, F. Leisch, F. Scheipl and T. Hothorn. mvtnorm: Multivariate normal and t distributions. R package version 0.9-9995, 2013.
</p>
<p>G.M. Tallis. Moment generating function of truncated multi-normal distribution. J. Royal Stat. Soc., Ser. B, 23(1):223-229, 1961.
</p>
<p>H.F. Utz. Mehrstufenselektion in der Pflanzenzuechtung (in German). Doctor thesis, University Hohenheim, 1969.
</p>
<p>W.G. Cochran. Improvement by means of selection. In J. Neyman (ed.) Proc. 2nd Berkeley Symp. on Mathematical Statistics and Probability. University of California Press, Berkeley., 1951.
</p>
<p>X. Mi, T. Miwa and T. Hothorn. Implement of Miwa's analytical algorithm of multi-normal distribution, R Journal, 1:37-39, 2009.
</p>


<h3>See Also</h3>

<p> selectiongain() </p>


<h3>Examples</h3>

<pre><code class="language-R">
 VCGCAandError=c(0.40,0.20,0.20,0.40,2.00)
 VCSCA=c(0.20,0.10,0.10,0.20)

corr = multistagecor (maseff=0.40,
  VGCAandE=VCGCAandError,  VSCA=VCSCA, T=c(1,1,5),
  L=c(1,3,8), Rep=c(1,1,1))

# the time of nlm have to be controled in 5 s, so this example will not be uploaded into cran

#multistageoptimum.nlm( corr=corr, Vg=0.4,
#Budget=1021, CostProd=c(0.5,0,0),CostTest=c(0.5,6,40), Nf=10,
# N.upper=c(600,120,20), N.lower=rep(5,3))


</code></pre>


</div>