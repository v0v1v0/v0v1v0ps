<div class="container">

<table style="width: 100%;"><tr>
<td>runMultiTraitGwas</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Perform multi-trait GWAS</h2>

<h3>Description</h3>

<p><code>runMultiTraitGwas</code> performs multi-trait or multi-environment Genome
Wide Association mapping on phenotypic and genotypic data contained in a
<code>gData</code> object.
</p>


<h3>Usage</h3>

<pre><code class="language-R">runMultiTraitGwas(
  gData,
  trials = NULL,
  traits = NULL,
  covar = NULL,
  snpCov = NULL,
  kin = NULL,
  kinshipMethod = c("astle", "IBS", "vanRaden", "identity"),
  GLSMethod = c("single", "multi"),
  estCom = FALSE,
  useMAF = TRUE,
  MAF = 0.01,
  MAC = 10,
  genomicControl = FALSE,
  fitVarComp = TRUE,
  covModel = c("unst", "pw", "fa"),
  VeDiag = TRUE,
  maxIter = 2e+05,
  mG = 1,
  mE = 1,
  Vg = NULL,
  Ve = NULL,
  thrType = c("bonf", "fixed", "small", "fdr"),
  alpha = 0.05,
  LODThr = 4,
  nSnpLOD = 10,
  pThr = 0.05,
  rho = 0.4,
  sizeInclRegion = 0,
  minR2 = 0.5,
  parallel = FALSE,
  nCores = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>gData</code></td>
<td>
<p>An object of class <code>gData</code> containing at least <code>map</code>,
<code>markers</code> and <code>pheno</code>. The latter should not contain missing
values. Multi-trait or multi-environment GWAS is performed for all variables
in <code>pheno</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trials</code></td>
<td>
<p>A vector specifying the environment on which to run GWAS.
This can be either a numeric index or a character name of a list item in
<code>pheno</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>traits</code></td>
<td>
<p>A vector of traits on which to run GWAS. These can be either
numeric indices or character names of columns in <code>pheno</code>. If
<code>NULL</code>, GWAS is run on all traits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar</code></td>
<td>
<p>An optional vector of covariates taken into account when
running GWAS. These can be either numeric indices or character names of
columns in <code>covar</code> in <code>gData</code>. If <code>NULL</code>, no covariates are
used. An intercept is included automatically (and should not be assigned as
covariate). SNP-covariates should be assigned using the snpCov parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>snpCov</code></td>
<td>
<p>An optional character vector of SNP-names to be included as
covariates. SNP-names should match those used in <code>gData</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kin</code></td>
<td>
<p>An optional kinship matrix or list of kinship matrices. These
matrices can be from the <code>matrix</code> class as defined in the base package
or from the <code>dsyMatrix</code> class, the class of symmetric matrices in the
Matrix package.<br>
If <code>GLSMethod</code> = "single" then one matrix should be provided, if
<code>GLSMethod</code> = "multi", a list of chromosome specific matrices of length
equal to the number of chromosomes in <code>map</code> in <code>gData</code>.<br>
If <code>NULL</code> then matrix <code>kinship</code> in <code>gData</code> is used. <br>
If both <code>kin</code> is provided and <code>gData</code> contains a matrix
<code>kinship</code> then <code>kin</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kinshipMethod</code></td>
<td>
<p>An optional character indicating the method used for
calculating the kinship matrix(ces). Currently "astle" (Astle and Balding,
2009), "IBS", "vanRaden" (VanRaden, 2008), and "identity" are supported.
If a kinship matrix is supplied either in <code>gData</code> or in parameter
<code>kin</code>, <code>kinshipMethod</code> is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>GLSMethod</code></td>
<td>
<p>A character string indicating the method used to estimate
the marker effects. Either <code>single</code> for using a single kinship matrix,
or <code>multi</code> for using chromosome specific kinship matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estCom</code></td>
<td>
<p>Should the common SNP-effect model be fitted? If <code>TRUE</code>
not only the SNP-effects but also the common SNP-effect and QTL x E effect
are estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useMAF</code></td>
<td>
<p>Should the minor allele frequency be used for selecting SNPs
for the analysis. If <code>FALSE</code>, the minor allele count is used instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MAF</code></td>
<td>
<p>The minor allele frequency (MAF) threshold used in GWAS. A
numerical value between 0 and 1. SNPs with MAF below this value are not taken
into account in the analysis, i.e. p-values and effect sizes are put to
missing (<code>NA</code>). Ignored if <code>useMAF</code> is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MAC</code></td>
<td>
<p>A numerical value. SNPs with minor allele count below this value
are not taken into account for the analysis, i.e. p-values and effect sizes
are set to missing (<code>NA</code>). Ignored if <code>useMAF</code> is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>genomicControl</code></td>
<td>
<p>Should genomic control correction as in Devlin and
Roeder (1999) be applied?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitVarComp</code></td>
<td>
<p>Should the variance components be fitted? If <code>FALSE</code>,
they should be supplied in <code>Vg</code> and <code>Ve</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covModel</code></td>
<td>
<p>A character string indicating the covariance model for the
genetic background (Vg) and residual effects (Ve); see details.
Either <code>unst</code> for unstructured for both Vg and
Ve (as in Zhou and Stephens (2014)), <code>pw</code> for unstructered for both Vg
and Ve (pairwise, as in Furlotte and Eskin (2013)) or <code>fa</code> for
factor-analytic for both Vg and Ve.<br>
Ignored if <code>fitVarComp</code> = <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>VeDiag</code></td>
<td>
<p>Should there be environmental correlations if covModel = "unst"
or "pw"? If traits are measured on the same individuals, put <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxIter</code></td>
<td>
<p>An integer for the maximum number of iterations. Only used
when <code>covModel = "fa"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mG</code></td>
<td>
<p>An integer. The order of the genetic part of the factor analytic
model. Only used when <code>covModel = "fa"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mE</code></td>
<td>
<p>An integer. The order of the environmental part of the factor
analytic model. Only used when <code>covModel = "fa"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Vg</code></td>
<td>
<p>An optional matrix with genotypic variance components. <code>Vg</code>
should have row and column names corresponding to the column names of
<code>gData$pheno</code>. It may contain additional rows and columns which will be
ignored. Ignored if fitVarComp = <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ve</code></td>
<td>
<p>An optional matrix with environmental variance components.
<code>Ve</code> should have row names column names corresponding to the column
names of <code>gData$pheno</code>. It may contain additional rows and columns
which will be ignored. Ignored if fitVarComp = <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thrType</code></td>
<td>
<p>A character string indicating the type of threshold used for
the selection of candidate loci. Either <code>bonf</code> for using the
Bonferroni threshold, a LOD-threshold of <code class="reqn">-log10(alpha/p)</code>, where p is
the number of markers and alpha can be specified in <code>alpha</code>,
<code>fixed</code> for a self-chosen fixed LOD-threshold, specified in
<code>LODThr</code> or <code>small</code>, the LOD-threshold is chosen such as the SNPs
with the <code>nSnpLOD</code> smallest p-values are selected. <code>nSnpLOD</code> can
be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>A numerical value used for calculating the LOD-threshold for
<code>thrType</code> = "bonf" and the significant p-Values for <code>thrType</code> =
"fdr".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LODThr</code></td>
<td>
<p>A numerical value used as a LOD-threshold when
<code>thrType</code> = "fixed".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nSnpLOD</code></td>
<td>
<p>A numerical value indicating the number of SNPs with the
smallest p-values that are selected when <code>thrType</code> = "small".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pThr</code></td>
<td>
<p>A numerical value just as the cut off value for p-Values for
<code>thrType</code> = "fdr".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>A numerical value used a the minimum value for SNPs to be
considered correlated when using <code>thrType</code> = "fdr".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sizeInclRegion</code></td>
<td>
<p>An integer. Should the results for SNPs close to
significant SNPs be included? If so, the size of the region in centimorgan
or base pairs. Otherwise 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minR2</code></td>
<td>
<p>A numerical value between 0 and 1. Restricts the SNPs included
in the region close to significant SNPs to only those SNPs that are in
sufficient Linkage Disequilibrium (LD) with the significant snp, where LD
is measured in terms of <code class="reqn">R^2</code>. If for example <code>sizeInclRegion</code> =
200000 and <code>minR2</code> = 0.5, then for every significant SNP also those SNPs
whose LD (<code class="reqn">R^2</code>) with the significant SNP is at least 0.5 AND which are
at most 200000 away from this significant snp are included. Ignored if
<code>sizeInclRegion</code> = 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Should the computation of variance components be done in
parallel? Only used if <code>covModel = "pw"</code>. A parallel computing
environment has to be setup by the user.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nCores</code></td>
<td>
<p>A numerical value indicating the number of cores to be used by
the parallel part of the algorithm. If <code>NULL</code> the number of cores used
will be equal to the number of cores available on the machine - 1.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>GWAS</code>.
</p>


<h3>Details</h3>

<p>runMultiTraitGwas estimates the effect of a SNP in
different trials or on different traits, one SNP at a time. Genetic
and residual covariances are fitted only once, for a model without SNPs.
Following the diagonalization scheme of Zhou and Stephens (2014), the
following model is fit
</p>
<p><code class="reqn">Y = \left(\begin{array}{c} Y_1 \\ \vdots \\ Y_p\end{array}\right) =
\left(\begin{array}{c} X_1\gamma_1 \\ \vdots \\ X_p\gamma_p\end{array}\right)
+ \left(\begin{array}{c} x_1\beta_1 \\ \vdots \\ x_p\beta_p\end{array}\right)
+ \left(\begin{array}{c} G_1 \\ \vdots \\ G_p\end{array}\right) +
\left(\begin{array}{c} E_1 \\ \vdots \\ E_p\end{array}\right)</code>
</p>
<p>where <code class="reqn">Y</code> is a <code class="reqn">np \times 1</code> vector of phenotypic values for <code class="reqn">n</code>
genotypes and <code class="reqn">p</code> traits or trials. <code class="reqn">x</code> is the <code class="reqn">n \times 1</code>
vector of scores for the marker under consideration, and <code class="reqn">X</code> the
<code class="reqn">n \times q</code> design matrix for the other covariates. By default only a
trait (environment) specific intercept is included. The vector of genetic
background effects
(<code class="reqn">\left(\begin{array}{c}G_1 \\ \vdots \\ G_p\end{array}\right)</code>) is
Gaussian with zero mean and covariance <code class="reqn">V_g \otimes K</code>, where <code class="reqn">V_g</code>
is a <code class="reqn">p \times p</code> matrix of genetic (co)variances, and <code class="reqn">K</code> an
<code class="reqn">n \times n</code> kinship matrix. Similarly, the residual errors
(<code class="reqn">\left(\begin{array}{c}E_1 \\ \vdots \\ E_p\end{array}\right)</code>)
have covariance <code class="reqn">V_e \otimes I_n</code>, for a <code class="reqn">p \times p</code> matrix
<code class="reqn">V_e</code> of residual (co)variances.
</p>


<h3>Hypotheses for the SNP-effects</h3>

<p>For each SNP, the null-hypothesis <code class="reqn">\beta_1 = \dots = \beta_p = 0</code> is
tested, using the likelihood ratio test (LRT) described in Zhou and
Stephens (2014). If <code>estCom = TRUE</code>, additional tests for a common
effect and for QTL x E are performed, using the parameterization
<code class="reqn">\beta_j = \alpha + \alpha_j (1 \leq j \leq p)</code>.
As in Korte et al (2012), we use likelihood ratio tests, but not restricted
to the bivariate case. For the common effect, we fit the reduced
model <code class="reqn">\beta_j = \alpha</code>, and test if <code class="reqn">\alpha = 0</code>.
For QTL-by-environment interaction, we test if <code class="reqn">\alpha_1 = \dots =
\alpha_p = 0</code>.
</p>


<h3>Models for the genetic and residual covariance</h3>

<p><code class="reqn">V_g</code> and <code class="reqn">V_e</code> can be provided by the user
(<code>fitVarComp = FALSE</code>);
otherwise one of the following models is used, depending on covModel.
If <code>covModel = "unst"</code>, an unstructured model is assumed, as in Zhou and
Stephens (2014): <code class="reqn">V_g</code> and <code class="reqn">V_e</code> can be any positive-definite matrix,
requiring a total of <code class="reqn">p(p + 1)/2</code> parameters per matrix.
If <code>covModel = "fa"</code>, a factor-analytic model is fitted using an
EM-algorithm, as in Millet et al (2016). <code class="reqn">V_g</code> and <code class="reqn">V_e</code> are assumed
to be of the form <code class="reqn">W W^t + D</code>, where <code class="reqn">W</code> is a <code class="reqn">p \times m</code> matrix
of factor loadings and <code class="reqn">D</code> a diagonal matrix with trait or environment
specific values. <code class="reqn">m</code> is the order of the model, and the parameters
<code>mG</code> and <code>mE</code> specify the order used for respectively <code class="reqn">V_g</code>
and <code class="reqn">V_e</code>. <code>maxIter</code> sets the maximum number of iterations used
in the EM-algorithm.
Finally, if <code>covModel = "pw"</code>, <code class="reqn">V_g</code> and <code class="reqn">V_e</code> are estimated
'pairwise', as in Furlotte and Eskin (2015). Looping over pairs of traits
or trials <code class="reqn">1 \leq j &lt; k \leq p</code>,
<code class="reqn">V_g[j,k] = V_g[k,j]</code> and <code class="reqn">V_e[j,k] = V_e[k,j]</code>
are estimated assuming a bivariate mixed model. The diagonals of
<code class="reqn">V_g</code> and <code class="reqn">V_e</code> are fitted assuming univariate mixed models. If the
resulting <code class="reqn">V_g</code> or <code class="reqn">V_e</code> is not positive-definite, they are
replaced by the nearest positive-definite matrix.
In case <code>covModel = "unst"</code> or <code>"pw"</code> it is possible to assume
that <code class="reqn">V_e</code> is diagonal (<code>VeDiag = TRUE</code>)
</p>


<h3>References</h3>

<p>Dahl et al. (2013). Network inference in matrix-variate Gaussian
models with non-independent noise. arXiv preprint arXiv:1312.1622.
</p>
<p>Furlotte, N.A. and Eskin, E. (2015). Efficient multiple-trait
association and estimation of genetic correlation using the matrix-variate
linear mixed model. Genetics, May 2015, Vol.200-1, p. 59-68.
</p>
<p>Korte et al. (2012). A mixed-model approach for genome-wide
association studies of correlated traits in structured populations.
Nature Genetics, 44(9), 1066–1071. <a href="https://doi.org/10.1038/ng.2376">doi:10.1038/ng.2376</a>
</p>
<p>Millet et al. (2016). Genome-wide analysis of yield in Europe:
allelic effects as functions of drought and heat scenarios. Plant Physiology,
pp.00621.2016. <a href="https://doi.org/10.1104/pp.16.00621">doi:10.1104/pp.16.00621</a>
</p>
<p>Thoen et al. (2016). Genetic architecture of plant stress
resistance: multi-trait genome-wide association mapping. New Phytologist,
213(3), 1346–1362. <a href="https://doi.org/10.1111/nph.14220">doi:10.1111/nph.14220</a>
</p>
<p>Zhou, X. and Stephens, M. (2014). Efficient multivariate linear
mixed model algorithms for genome-wide association studies. Nature Methods,
February 2014, Vol. 11, p. 407–409.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## First create a gData object.
## See the vignette for a detailed description.
## Here we use the gData object included in the package

## Run multi-trait GWAS
## Use a factor analytic model to estimate variance components.

mtg0 &lt;- runMultiTraitGwas(gDataDropsRestr,
                         trial = "Mur13W",
                         covModel = "fa")


## Plot the results.
## For details on the different plots see plot.GWAS

plot(mtg0, plotType = "qq")
plot(mtg0, plotType = "manhattan")
plot(mtg0, plotType = "qtl", yThr = 3.5)


## Run multi-trait GWAS
## Use a pairwise model to estimate variance components.
## Estimate common effects and set a fixed threshold for significant SNPs

mtg1 &lt;- runMultiTraitGwas(gDataDropsRestr,
                         trial = "Mur13W",
                         covModel = "pw",
                         estCom = TRUE,
                         thrType = "fixed",
                         LODThr = 3)


## Run multi-trait GWAS
## Use an unstructured model to estimate variance components.
## Identify the 5 SNPs with smallest p-values as significant SNPs.
## Compute the kinship matrix using the vanRaden method.

mtg2 &lt;- runMultiTraitGwas(gDataDropsRestr,
                         trial = "Mur13W",
                         kinshipMethod = "vanRaden",
                         covModel = "unst",
                         thrType = "small",
                         nSnpLOD = 5)


</code></pre>


</div>