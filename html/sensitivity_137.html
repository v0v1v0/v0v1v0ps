<div class="container">

<table style="width: 100%;"><tr>
<td>qosa</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Quantile-oriented sensitivity analysis</h2>

<h3>Description</h3>

 <p><code>qosa</code> implements the estimation of first-order quantile-oriented sensitivity indices 
as defined in Fort et al. (2016) with a kernel-based estimator of conditonal probability density functions 
closely related to the one proposed by Maume-Deschamps and Niang (2018). 
<code>qosa</code> also supports a kernel-based estimation of Sobol first-order indices (i.e. Nadaraya-Watson).
</p>


<h3>Usage</h3>

<pre><code class="language-R">qosa(model = NULL, X1, X2 = NULL, type = "quantile", alpha = 0.1, split.sample = 2/3, 
nsample = 1e4, nboot = 0, conf = 0.95, ...)
## S3 method for class 'qosa'
tell(x, y = NULL, ...)
## S3 method for class 'qosa'
print(x, ...)
## S3 method for class 'qosa'
plot(x, ylim = c(0, 1), ...)
## S3 method for class 'qosa'
ggplot(data, mapping = aes(), ylim = c(0, 1), ..., environment
                 = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a function, or a model with a <code>predict</code> method, defining the model to analyze.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X1</code></td>
<td>
<p>a random sample of the inputs used for the estimation of conditional probability density functions. 
If <code>X2</code> is NULL, <code>X1</code> is split in two samples, with the first <code>split.sample</code> proportion of observations assigned to <code>X1</code> and the rest to <code>X2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X2</code></td>
<td>
<p>a random sample of the inputs used to evaluate the conditional probability density functions. 
If NULL, it is constructed with the last <code>(1-split.sample)</code> proportion of observations from <code>X1</code>, see above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>a string specifying which first-order sensitivity indices must be estimated: quantile-oriented indices (<code>type="quantile"</code>) 
or Sobol' indices (<code>type="mean"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>if <code>type="quantile"</code> the quantile level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split.sample</code></td>
<td>
<p>if <code>X2=NULL</code> the proportion of observations from <code>X1</code> assigned 
to the estimation of conditional probability density functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsample</code></td>
<td>
<p>the number of samples from the conditional probability density functions used 
to estimate the conditional quantiles (if <code>type="quantile"</code>) or the conditional means (if <code>type="mean"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboot</code></td>
<td>
<p>the number of bootstrap replicates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf</code></td>
<td>
<p>the confidence level for confidence intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a list of class <code>"sobolrank"</code> storing the state of the
sensitivity study (parameters, data, estimates).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a list of class <code>"sobolrank"</code> storing the state of the
sensitivity study (parameters, data, estimates).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a vector of model responses.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>y-coordinate plotting limits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapping</code></td>
<td>
<p>Default list of aesthetic mappings to use for plot. If not specified, 
must be supplied in each layer added to the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>environment</code></td>
<td>
<p>[Deprecated] Used prior to tidy evaluation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>any other arguments for <code>model</code> which are passed
unchanged each time it is called.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Quantile-oriented sensitivty indices were defined as a special case of sensitivity indices based on contrast functions in Fort et al. (2016).
The estimator used by <code>qosa</code> follows closely the one proposed by Maume-Deschamps &amp; Niang (2018). 
The only difference is that Maume-Deschamps and Niang (2018) use the following kernel-based estimate of the conditional cumulative distribution function:
</p>
<p style="text-align: center;"><code class="reqn">\hat{F}(y\Vert X=x) = \frac{ \sum_{i=1}^n K_{h_x}(x - X_i) \bold{1}\{Y_i&lt; y\}}{\sum_{i=1}^n K_{h_x}(x - X_i)}</code>
</p>

<p>whereas we use
</p>
<p style="text-align: center;"><code class="reqn">\hat{F}(y\vert X=x) = \frac{ \sum_{i=1}^n K_{h_x}(x - X_i) \int_{-\infty}^y K_{h_y}(t - Y_i)dt} {\sum_{i=1}^n K_{h_x}(x - X_i)},</code>
</p>

<p>meaning that <code class="reqn">\bold{1}\{Y_i&lt; y\}</code> is replaced by <code class="reqn">\int_{-\infty}^y K_{h_y}(t - Y_i)dt = \Phi (\frac{y-Y_i}{h_y})</code> where <code class="reqn">\Phi</code> 
is the cumulative distribution function of the standard normal distribution (since kernel <code class="reqn">K</code> is Gaussian). 
The two definitions thus coincide when <code class="reqn">h_y \rightarrow 0</code>. Our formula arises from a kernel density estimator of the joint pdf with a diagonal bandwidth. 
In a future version, it will be genralized to a general bandwidth matrix for improved performance.
</p>


<h3>Value</h3>

<p><code>qosa</code> returns a list of class <code>"qosa"</code>, containing all
the input arguments detailed before, plus the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a <code>data.frame</code> containing the design of experiments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X1</code></td>
<td>
<p>a <code>data.frame</code> containing the design of experiments used for the estimation of conditional probability density functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a <code>data.frame</code> containing the design of experiments used for the evaluation of conditional probability density functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a vector of model responses.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>the estimations of the Sobol' sensitivity indices.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Sebastien Da Veiga
</p>


<h3>References</h3>

<p>Fort, J. C., Klein, T., and Rachdi, N. (2016). New sensitivity analysis subordinated to a contrast. Communications in Statistics-Theory and Methods, 45(15), 4349-4364.
</p>
<p>Maume-Deschamps, V., and Niang, I. (2018). Estimation of quantile oriented sensitivity indices. Statistics &amp; Probability Letters, 134, 122-127.
</p>


<h3>Examples</h3>

<pre><code class="language-R"> 
library(ks)
library(ggplot2)
library(boot)

# Test case : difference of two exponential distributions (Fort et al. (2016))
# We use two samples with different sizes
n1 &lt;- 5000
X1 &lt;- data.frame(matrix(rexp(2 * n1,1), nrow = n1))
n2 &lt;- 1000
X2 &lt;- data.frame(matrix(rexp(2 * n2,1), nrow = n2))
Y1 &lt;- X1[,1] - X1[,2]
Y2 &lt;- X2[,1] - X2[,2]
x &lt;- qosa(model = NULL, X1, X2, type = "quantile", alpha = 0.1)
tell(x,c(Y1,Y2))
print(x)
ggplot(x)

# Test case : difference of two exponential distributions (Fort et al. (2016))
# We use only one sample
n &lt;- 1000 # put n=10000 for more consistency
X &lt;- data.frame(matrix(rexp(2 * n,1), nrow = n))
Y &lt;- X[,1] - X[,2]
x &lt;- qosa(model = NULL, X1 = X, type = "quantile", alpha = 0.7)
tell(x,Y)
print(x)
ggplot(x)

# Test case : the Ishigami function
# We estimate first-order Sobol' indices (by specifying 'mean')
# Next lines are put in comment because too long fro CRAN tests
#n &lt;- 5000 
#nboot &lt;- 50 
#X &lt;- data.frame(matrix(-pi+2*pi*runif(3 * n), nrow = n))
#x &lt;- qosa(model = ishigami.fun, X1 = X, type = "mean", nboot = nboot)
#print(x)
#ggplot(x)


</code></pre>


</div>