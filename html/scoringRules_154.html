<div class="container">

<table style="width: 100%;"><tr>
<td>scores_sample_multiv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multivariate Scoring Rules for Simulated Forecast Distributions</h2>

<h3>Description</h3>

<p>Compute multivariate scores of the form <code class="reqn">S(y, dat)</code>, where <code class="reqn">S</code> is a
proper scoring rule, <code class="reqn">y</code> is a d-dimensional realization vector and 
<code class="reqn">dat</code> is a simulated sample of multivariate forecasts. Three scores
are available: The energy score, a score based on a Gaussian kernel 
(mmds_sample, see details below) and the variogram score of order <code class="reqn">p</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">es_sample(y, dat, w = NULL)

mmds_sample(y, dat, w = NULL)

vs_sample(y, dat, w = NULL, w_vs = NULL, p = 0.5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>realized values (numeric vector of length d).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>
<p>numeric matrix of data
(columns are simulation draws from multivariate forecast distribution).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>numeric vector of weights for forecast draws (length equal to number of columns of <code>dat</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w_vs</code></td>
<td>
<p>numeric matrix of weights for <code>dat</code> used in the variogram
score. This matrix must be square and symmetric, with all elements being non-negative.
If no weights are specified, constant weights (with all elements of <code>w_vs</code> 
equal to one) are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>order of variogram score. Standard choices include <code class="reqn">p = 1</code> and
<code class="reqn">p = 0.5</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In the input matrix <code>dat</code> each column is expected to represent a sample
from the multivariate forecast distribution, the number of rows of <code>dat</code>
thus has to match the length of the observation vector <code>y</code>, and the
number of columns of <code>dat</code> is the number of simulated samples.
</p>
<p>In es_sample and mmds_sample it is possible to specify a vector <code>w</code> of weights 
attached to each forecast draw (i.e. each column of matrix <code>dat</code>). These
weights are analogous to the input <code>w</code> in crps_sample. 
</p>
<p>In vs_sample it is possible to specify a matrix <code>w_vs</code> of
non-negative weights that allow to emphasize or downweight pairs of
component combinations based on subjective expert decisions. <code>w_vs</code> is a
square, symmetric matrix with dimensions equal to the length of the input vector
<code>y</code>, and the entry in the <code class="reqn">i</code>-th row and <code class="reqn">j</code>-th column of
<code>w_vs</code> corresponds to the weight assigned to the combination of the
corresponding <code class="reqn">i</code>-th and <code class="reqn">j</code>-th component. A small example is provided below. 
For details and further examples, see Scheuerer and Hamill (2015).
</p>
<p>The ‘MMD score’ in mmds_sample is a kernel scoring rule as described in 
Gneiting and Raftery (2007, Section 5). As for all other scores, 
we use a negative orientation, such that a smaller score corresponds to a better
forecast. We use a Gaussian kernel with standard deviation 1. This kernel is
the same as the one obtained by setting <code>rbfdot(sigma = .5)</code> in the 
R package kernlab (Karatzoglou et al., 2004). The naming prefix ‘MMD’ is 
motivated by the machine learning literature on two sample testing 
(e.g. Gretton et al., 2012), where this type of kernel function is popular.
</p>


<h3>Value</h3>

<p>Value of the score. <em>A lower score indicates a better forecast.</em>
</p>


<h3>Author(s)</h3>

<p>Maximiliane Graeter, Sebastian Lerch, Fabian Krueger
</p>


<h3>References</h3>

<p><em>Energy score</em>
</p>
<p>Gneiting, T., Stanberry, L.I., Grimit, E.P., Held, L. and
N.A. Johnson (2008):
'Assessing probabilistic forecasts of multivariate quantities, with an
application to ensemble predictions of surface winds',
TEST, 17, 211-235. <a href="https://doi.org/10.1007/s11749-008-0114-x">doi:10.1007/s11749-008-0114-x</a>
</p>
<p><em>MMD score</em>
</p>
<p>Gneiting, T. and A.E. Raftery (2007):
‘Strictly proper scoring rules, prediction and estimation’,
Journal of the American Statistical Association 102, 359-378. <a href="https://doi.org/10.1198/016214506000001437">doi:10.1198/016214506000001437</a>
</p>
<p>Gretton, A., Borgwardt, K. M., Rasch, M. J., Schölkopf, B. and
A. Smola (2012): ‘A kernel two-sample test’, Journal of' Machine 
Learning Research, 13, 723-773.
</p>
<p>Karatzoglou, A., Smola, A., Hornik, K. and A. Zeileis (2004). 
kernlab - An S4 Package for Kernel Methods in R. Journal of Statistical 
Software 11, 1-20. <a href="https://doi.org/10.18637/jss.v011.i09">doi:10.18637/jss.v011.i09</a> 
</p>
<p><em>Variogram-based proper scoring rules</em>
</p>
<p>Scheuerer, M. and T.M. Hamill (2015):
'Variogram-based proper scoring rules for probabilistic forecasts of
multivariate quantities',
Monthly Weather Review, 143, 1321-1334. <a href="https://doi.org/10.1175/mwr-d-14-00269.1">doi:10.1175/mwr-d-14-00269.1</a>
</p>


<h3>See Also</h3>

<p><code>scores_sample_multiv_weighted</code> for weighted versions of the scoring rules documented here.
</p>


<h3>Examples</h3>

<pre><code class="language-R">d &lt;- 10  # number of dimensions
m &lt;- 50  # number of samples from multivariate forecast distribution

# parameters for multivariate normal example
mu0 &lt;- rep(0, d)
mu &lt;- rep(1, d)
S0 &lt;- S &lt;- diag(d)
S0[S0==0] &lt;- 0.2
S[S==0] &lt;- 0.1

# generate samples from multivariate normal distributions
obs &lt;- drop(mu0 + rnorm(d) %*% chol(S0))
fc_sample &lt;- replicate(m, drop(mu + rnorm(d) %*% chol(S)))

# compute Energy Score
es_sample(y = obs, dat = fc_sample)

# in the univariate case, Energy Score and CRPS are the same
# illustration: Evaluate forecast sample for the first variable
es_sample(y = obs[1], dat = fc_sample[1, , drop = FALSE])
crps_sample(y = obs[1], dat = fc_sample[1, ])

# illustration of observation weights for Energy Score
# example: equal weights for first half of draws; zero weights for other draws
w &lt;- rep(c(1, 0), each = .5*m)/(.5*m)
es_sample(y = obs, dat = fc_sample, w = w)

# weighting matrix for variogram score
# note that, unlike for w, weights in w_vs refer to dimensions 
# (rows of dat) rather than draws (cols of dat)
w_vs &lt;- outer(1:d, 1:d, function(x, y) .5^abs(x-y))

vs_sample(y = obs, dat = fc_sample) 
vs_sample(y = obs, dat = fc_sample, w_vs = w_vs) 
vs_sample(y = obs, dat = fc_sample, w_vs = w_vs, p = 1)


</code></pre>


</div>