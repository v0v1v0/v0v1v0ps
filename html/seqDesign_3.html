<div class="container">

<table style="width: 100%;"><tr>
<td>monitorTrial</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Group Sequential Monitoring of Simulated Efficacy Trials for the Event of Potential Harm, Non-Efficacy, and High Efficacy</h2>

<h3>Description</h3>

<p><code>monitorTrial</code> applies a group sequential monitoring procedure to data-sets generated by <code>simTrial</code>, which may result in modification or termination of each simulated trial.
</p>


<h3>Usage</h3>

<pre><code class="language-R">monitorTrial(dataFile, stage1, stage2, harmMonitorRange,
  harmMonitorAlpha = 0.05, alphaPerTest = NULL,
  nonEffStartMethod = c("FKG", "fixed", "?", "old"),
  nonEffStartParams = NULL, nonEffInterval,
  nonEffIntervalUnit = c("counts", "time"), lowerVEnoneff = NULL,
  upperVEnoneff, highVE, stage1VE, lowerVEuncPower = NULL, alphaNoneff,
  alphaHigh, alphaStage1, alphaUncPower = NULL,
  estimand = c("combined", "cox", "cuminc"), laggedMonitoring = FALSE,
  lagTime, saveFile = NULL, saveDir = NULL, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataFile</code></td>
<td>
<p>if <code>saveDir = NULL</code>, a list returned by <code>simTrial</code>; otherwise a name (character string) of an <code>.RData</code> file created by <code>simTrial</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage1</code></td>
<td>
<p>the final week of stage 1 in a two-stage trial</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage2</code></td>
<td>
<p>the final week of stage 2 in a two-stage trial, i.e., the maximum follow-up time</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>harmMonitorRange</code></td>
<td>
<p>a 2-component numeric vector specifying the range of the pooled number of infections (pooled over the placebo and vaccine arm accruing infections the fastest) over which the type I error rate, specified in <code>harmMonitorAlpha</code>, will be spent (per vaccine arm). Note that <code>harmMonitorRange</code> does not specify a range for which potential-harm stopping boundaries will be computed; instead, it specifies when potential-harm monitoring will start, and the range over which <code>harmMonitorAlpha</code> will be spent.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>harmMonitorAlpha</code></td>
<td>
<p>a numeric value (0.05 by default) specifying the overall type I error rate for potential-harm monitoring (per vaccine arm). To turn off potential-harm monitoring, set <code>harmMonitorAlpha</code> equal to 0.00001.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alphaPerTest</code></td>
<td>
<p>a per-test nominal/unadjusted alpha level for potential-harm monitoring. If <code>NULL</code>, a per-test alpha level is calculated that yields a cumulative alpha of <code>harmMonitorAlpha</code> at the end of <code>harmMonitorRange</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonEffStartMethod</code></td>
<td>
<p>a character string specifying the method used for determining when non-efficacy monitoring is to start. The default method of Freidlin, Korn, and Gray (2010) ("<code>FKG</code>") calculates the minimal pooled infection count (pooled over the placebo and vaccine arm accruing infections the fastest) such that a hazard-ratio-based VE point estimate of 0% would result in declaring non-efficacy, i.e., the upper bound of the two-sided (1-<code>alphaNoneff</code>) x 100% confidence interval for VE based on the asymptotic variance of the log-rank statistic is (barely) below the non-efficacy threshold specified as component <code>upperVEnonEff</code> in the list <code>nonEffStartParams</code>. If this list component is left unspecified, the argument <code>upperVEnonEff</code> is used as the non-efficacy threshold. The alternative method ("<code>fixed</code>") starts non-efficacy monitoring at a fixed pooled infection count (pooled over the placebo and vaccine arm accruing infections the fastest) specified by component <code>N1</code> in the list <code>nonEffStartParams</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonEffStartParams</code></td>
<td>
<p>a list with named components specifying parameters required by <code>nonEffStartMethod</code> (<code>NULL</code> by default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonEffInterval</code></td>
<td>
<p>a numeric value (a number of infections or a number of weeks) specifying the interval between two adjacent non-efficacy interim analyses</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonEffIntervalUnit</code></td>
<td>
<p>a character string specifying whether intervals between two adjacent non-efficacy interim analyses should be event-driven (default option "<code>counts</code>") or calendar time-driven (option "<code>time</code>")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lowerVEnoneff</code></td>
<td>
<p>specifies criterion 1 for declaring non-efficacy: the lower bound of the two-sided (1-<code>alphaNoneff</code>) x 100% confidence interval(s) for the VE estimand(s) lie(s) below <code>lowerVEnoneff</code> (typically set equal to 0). If <code>NULL</code> (default), this criterion is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upperVEnoneff</code></td>
<td>
<p>specifies criterion 2 for declaring non-efficacy: the upper bound of the two-sided (1-<code>alphaNoneff</code>) x 100% confidence interval(s) for the VE estimand(s) lie(s) below <code>upperVEnoneff</code> (typically a number in the 0–0.5 range)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>highVE</code></td>
<td>
<p>specifies a criterion for declaring high-efficacy: the lower bound of the two-sided (1-<code>alphaHigh</code>) x 100% confidence interval for the VE estimand lies above <code>highVE</code> (typically a number in the 0.5–1 range). To turn off high efficacy monitoring, set <code>highVE</code> equal to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage1VE</code></td>
<td>
<p>specifies a criterion for advancement of a treatment's evaluation into Stage 2: the lower bound of the two-sided (1-<code>alphaStage1</code>) x 100% confidence interval for the VE estimand lies above <code>stage1VE</code> (typically set equal to 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lowerVEuncPower</code></td>
<td>
<p>a numeric vector with each component specifying a one-sided null hypothesis H0: VE(0–<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVEuncPower</code> x 100%. Unconditional power (i.e., accounting for sequential monitoring) to reject each H0 is calculated, where the rejection region is defined by the lower bound of the two-sided (1-<code>alphaUncPower</code>) x 100% confidence interval for the VE estimand being above the respective component of <code>lowerVEuncPower</code> (typically values in the 0–0.5 range).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alphaNoneff</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used for non-efficacy monitoring</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alphaHigh</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used for high efficacy monitoring</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alphaStage1</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used for determining whether a treatment's evaluation advances into Stage 2</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alphaUncPower</code></td>
<td>
<p>one minus the nominal confidence level of the two-sided confidence interval used to test one-sided null hypotheses H0: VE(0-<code>stage1</code>) <code class="reqn">\le</code> <code>lowerVEuncPower</code> x 100% against alternative hypotheses H1: VE(0–<code>stage1</code>) <code class="reqn">&gt;</code> <code>lowerVEuncPower</code> x 100%. The same nominal confidence level is applied for each component of <code>lowerVEuncPower</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimand</code></td>
<td>
<p>a character string specifying the choice of VE estimand(s) used in non- and high efficacy monitoring, advancement rule for Stage 2, and unconditional power calculations. Three options are implemented: (1) the ‘pure’ Cox approach (<code>"cox"</code>), where VE is defined as 1-hazard ratio (treatment/control) and estimated by the maximum partial likelihood estimator in the Cox model; (2) the ‘pure’ cumulative incidence-based approach (<code>"cuminc"</code>), where VE is defined as 1-cumulative incidence ratio (treatment/control) and estimated by the transformation of the Nelson-Aalen estimator for the cumulative hazard function; and (3) the combined approach (<code>"combined"</code>), where both aforementioned VE estimands are used for non-efficacy monitoring while the cumulative VE estimand is used for all other purposes. Only the first three characters are necessary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>laggedMonitoring</code></td>
<td>
<p>a logical value (<code>FALSE</code> by default) indicating whether "per-protocol" non-efficacy monitoring should additionally be conducted for events occurring after <code>lagTime</code> weeks as a more conservative non-efficacy monitoring approach. If <code>TRUE</code> and <code>estimand = "combined"</code>, the cumulative VE estimand is considered only for non-efficacy monitoring.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lagTime</code></td>
<td>
<p>a time point (in weeks) defining the per-protocol VE estimand, i.e., VE(<code>lagTime</code>–<code>stage1</code>). This VE estimand is also used in "per-protocol" non-efficacy monitoring if <code>laggedMonitoring</code> equals <code>TRUE</code>. It is typically chosen as the date of the last immunization or the date of the visit following the last immunization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveFile</code></td>
<td>
<p>a character string specifying the name of the output <code>.RData</code> file. If <code>NULL</code> (default), a default file name will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveDir</code></td>
<td>
<p>a character string specifying a path for <code>dataFile</code>. If supplied, the output is also saved as an <code>.RData</code> file in this directory; otherwise the output is returned as a list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical value indicating whether information on the output directory, file name, and monitoring outcomes should be printed out (default is <code>TRUE</code>)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>All time variables use week as the unit of time. Month is defined as 52/12 weeks.
</p>
<p>Potential harm monitoring starts at the <code>harmMonitorRange[1]</code>-th infection pooled over the placebo group and the vaccine regimen that accrues infections the fastest. The potential harm analyses continue at each additional infection until the first interim analysis for non-efficacy. The monitoring is implemented with exact one-sided binomial tests of H0: <code class="reqn">p \le p0</code> versus H1: <code class="reqn">p &gt; p0</code>, where <code class="reqn">p</code> is the probability that an infected participant was assigned to the vaccine group, and <code class="reqn">p0</code> is a fixed constant that represents the null hypothesis that an infection is equally likely to be assigned vaccine or placebo. Each test is performed at the same prespecified nominal/unadjusted alpha-level (<code>alphaPerTest</code>), chosen based on simulations such that, for each vaccine regimen, the overall type I error rate by the <code>harmMonitorRange[2]</code>-th arm-pooled infection (i.e., the probability that the potential harm boundary is reached when the vaccine is actually safe, <code class="reqn">p = p0</code>) equals <code>harmMonitorAlpha</code>.
</p>
<p>Non-efficacy is defined as evidence that it is highly unlikely that the vaccine has a beneficial effect measured as VE(0–<code>stage1</code>) of <code>upperVEnoneff</code> x 100% or more. The non-efficacy analyses for each vaccine regimen will start at the first infection (pooled over the vaccine and placebo arm) determined by <code>nonEffStartMethod</code>. Stopping for non-efficacy will lead to a reported two-sided (1-<code>alphaNoneff</code>) x 100% CI for VE(0–<code>stage1</code>) with, optionally, the lower confidence bound below <code>lowerVEnoneff</code> and the upper confidence bound below <code>upperVEnoneff</code>, where <code>estimand</code> determines the choice of the VE(0–<code>stage1</code>) estimand. This approach is similar to the inefficacy monitoring approach of Freidlin, Korn, and Gray (2010). If <code>estimand = "combined"</code>, stopping for non-efficacy will lead to reported (1-<code>alphaNoneff</code>) x 100% CIs for both VE parameters with, optionally, lower confidence bounds below <code>lowerVEnoneff</code> and upper confidence bounds below <code>upperVEnoneff</code>. If <code>laggedMonitoring = TRUE</code>, stopping for non-efficacy will lead to reported (1-<code>alphaNoneff</code>) x 100% CIs for both VE(0–<code>stage1</code>) and VE(<code>lagTime</code>–<code>stage1</code>) with, optionally, lower confidence bounds below <code>lowerVEnoneff</code> and upper confidence bounds below <code>upperVEnoneff</code>.
</p>
<p>High efficacy monitoring allows early detection of a highly protective vaccine if there is evidence that VE(0–<code>stage2</code>) <code class="reqn">&gt;</code> <code>highVE</code> x 100%. It is synchronized with non-efficacy monitoring during Stage 1, and a single high-efficacy interim analysis during Stage 2 is conducted halfway between the end of Stage 1 and the end of the trial. While monitoring for potential harm and non-efficacy restricts to <code>stage1</code> infections, monitoring for high efficacy counts all infections during <code>stage1</code> or <code>stage2</code>, given that early stopping for high efficacy would only be warranted under evidence for durability of the efficacy.
</p>
<p>The following principles and rules are applied in the monitoring procedure:
</p>

<ul>
<li>
<p> Exclude all follow-up data from the analysis post-unblinding (and include all data pre-unblinding).
</p>
</li>
<li>
<p> The monitoring is based on modified ITT analysis, i.e., all subjects documented to be free of the study endpoint at baseline are included and analyzed according to the treatment assigned by randomization, ignoring how many vaccinations they received (only pre-unblinding follow-up included).
</p>
</li>
<li>
<p> If a vaccine hits the harm boundary, immediately discontinue vaccinations and accrual into this vaccine arm, and unblind this vaccine arm (continue post-unblinded follow-up until the end of Stage 1 for this vaccine arm).  
</p>
</li>
<li>
<p> If a vaccine hits the non-efficacy boundary, immediately discontinue vaccinations and accrual into this vaccine arm, keep blinded and continue follow-up until the end of Stage 1 for this vaccine arm. 
</p>
</li>
<li>
<p> If and when the last vaccine arm hits the non-efficacy (or harm) boundary, discontinue vaccinations and accrual into this vaccine arm, and unblind (the trial is over, completed in Stage 1).
</p>
</li>
<li>
<p> Stage 1 for the whole trial is over on the earliest date of the two events: (1) all vaccine arms have hit the harm or non-efficacy boundary; and (2) the last enrolled subject in the trial reaches the final <code>stage1</code> visit.
</p>
</li>
<li>
<p> Continue blinded follow-up until the end of Stage 2 for each vaccine arm that reaches the end of <code>stage1</code> with a positive efficacy (as defined by <code>stage1VE</code>) or high efficacy (as defined by <code>highVE</code>) result.
</p>
</li>
<li>
<p> If at least one vaccine arm reaches the end of <code>stage1</code> with a positive efficacy or high efficacy result, continue blinded follow-up in the placebo arm until the end of Stage 2.
</p>
</li>
<li>
<p> Stage 2 for the whole trial is over on the earliest date of the two events: (1) all subjects in the placebo arm and each vaccine arm that registered efficacy or high efficacy in <code>stage1</code> have failed or been censored; and (2) all subjects in the placebo arm and each vaccine arm that registered efficacy or high efficacy in <code>stage1</code> have completed the final <code>stage2</code> visit.
</p>
</li>
</ul>
<p>The above rules have the following implications:
</p>

<ul>
<li>
<p> If a vaccine hits the non-efficacy boundary but Stage 1 for the whole trial is not over, then one includes in the analysis all follow-up through the final <code>stage1</code> visit for that vaccine regimen, including all individuals accrued up through the date of hitting the non-efficacy boundary (which will be the total number accrued to this vaccine arm).
</p>
</li>
<li>
<p> If a vaccine hits the harm boundary, all follow-up information through the date of hitting the harm boundary is included for this vaccine; no follow-up data are included after this date.
</p>
</li>
<li>
<p> If and when the last vaccine arm hits the non-efficacy (or harm) boundary, all follow-up information through the date of hitting the non-efficacy (or harm) boundary is included for this vaccine; no follow-up data are included after this date.
</p>
</li>
</ul>
<h3>Value</h3>

<p>If <code>saveDir</code> (and, optionally <code>saveFile</code>) is specified, the output list (named <code>out</code>) is saved as an <code>.RData</code> file in <code>saveDir</code> (the path to <code>saveDir</code> is printed); otherwise it is returned. The output object is a list of length equal to the number of simulated trials, each of which is a list of length equal to the number of treatment arms, each of which is a list with (at least) the following components:
</p>

<ul>
<li> <p><code>boundHit</code>: a character string stating the monitoring outcome in this treatment arm, i.e., one of <code>"Harm"</code>, <code>"NonEffInterim"</code>, <code>"NonEffFinal"</code>, <code>"Eff"</code>, or <code>"HighEff"</code>. The first four outcomes can occur in Stage 1, whereas the last outcome can combine data over Stage 1 and Stage 2.
</p>
</li>
<li> <p><code>stopTime</code>: the time of hitting a stopping boundary since the first subject enrolled in the trial
</p>
</li>
<li> <p><code>stopInfectCnt</code>: the pooled number of infections at <code>stopTime</code>
</p>
</li>
<li> <p><code>summObj</code>: a <code>data.frame</code> containing summary information from each non-/high efficacy interim analysis
</p>
</li>
<li> <p><code>finalHRci</code>: the final CI for the hazard ratio, available if <code>estimand!="cuminc"</code> and there is at least 1 infection in each arm
</p>
</li>
<li> <p><code>firstNonEffCnt</code>: the number of infections that triggered non-efficacy monitoring (if available)
</p>
</li>
<li> <p><code>totInfecCnt</code>: the total number of <code>stage1</code> (<code>stage2</code> if <code>boundHit = "HighEff"</code>) infections
</p>
</li>
<li> <p><code>totInfecSplit</code>: a table with the numbers of <code>stage1</code> (<code>stage2</code> if <code>boundHit = "HighEff"</code>) infections in the treatment and control arm
</p>
</li>
<li> <p><code>lastExitTime</code>: the time between the first subject's enrollment and the last subject's exiting from the trial
</p>
</li>
</ul>
<h3>References</h3>

<p>Freidlin B., Korn E. L., and Gray R. (2010), A general inefficacy interim monitoring rule for randomized clinical trials. <em>Clinical Trials</em> 7(3):197-208.
</p>


<h3>See Also</h3>

<p><code>simTrial</code>, <code>censTrial</code>, and <code>rankTrial</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">simData &lt;- simTrial(N=c(1000, rep(700, 2)), aveVE=seq(0, 0.4, by=0.2), 
                    VEmodel="half", vePeriods=c(1, 27, 79), enrollPeriod=78, 
                    enrollPartial=13, enrollPartialRelRate=0.5, dropoutRate=0.05, 
                    infecRate=0.04, fuTime=156, 
                    visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)),
                    missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=5, 
                    stage1=78, randomSeed=300)
   
monitorData &lt;- monitorTrial(dataFile=simData, stage1=78, stage2=156, 
                            harmMonitorRange=c(10,100), alphaPerTest=NULL, 
                            nonEffStartMethod="FKG", nonEffInterval=20, 
                            lowerVEnoneff=0, upperVEnoneff=0.4, highVE=0.7, 
                            stage1VE=0, lowerVEuncPower=0, alphaNoneff=0.05,
                            alphaHigh=0.05, alphaStage1=0.05, alphaUncPower=0.05,
                            estimand="cuminc", lagTime=26)
   
### alternatively, to save the .RData output file (no '&lt;-' needed):
###
### simTrial(N=c(1400, rep(1000, 2)), aveVE=seq(0, 0.4, by=0.2), VEmodel="half", 
###          vePeriods=c(1, 27, 79), enrollPeriod=78, enrollPartial=13, 
###          enrollPartialRelRate=0.5, dropoutRate=0.05, infecRate=0.04, fuTime=156, 
###          visitSchedule=c(0, (13/3)*(1:4), seq(13*6/3, 156, by=13*2/3)), 
###          missVaccProb=c(0,0.05,0.1,0.15), VEcutoffWeek=26, nTrials=30, 
###          stage1=78, saveDir="./", randomSeed=300)
###
### monitorTrial(dataFile=
###              "simTrial_nPlac=1400_nVacc=1000_1000_aveVE=0.2_0.4_infRate=0.04.RData", 
###              stage1=78, stage2=156, harmMonitorRange=c(10,100), alphaPerTest=NULL, 
###              nonEffStartMethod="FKG", nonEffInterval=20, lowerVEnoneff=0, 
###              upperVEnoneff=0.4, highVE=0.7, stage1VE=0, lowerVEuncPower=0, 
###              alphaNoneff=0.05, alphaHigh=0.05, alphaStage1=0.05, alphaUncPower=0.05, 
###              estimand="cuminc", lagTime=26, saveDir="./")

</code></pre>


</div>