<div class="container">

<table style="width: 100%;"><tr>
<td>Step</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Define the operation applied on declared data.</h2>

<h3>Description</h3>

<p>The step of the startR workflow after declaring data by Start() call. It 
identifies the operation (i.e., function) and the target and output 
dimensions of data array for the function. Ideally, it expects the dimension
name to be in the same order as the one requested in the Start() call. 
If a different order is specified, startR will reorder the subset dimension 
to the expected order for this function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Step(
  fun,
  target_dims,
  output_dims,
  use_libraries = NULL,
  use_attributes = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>A function in R format defining the operation to be applied to the 
data declared by a Start() call. It should only work on the essential 
dimensions rather than all the data dimensions. Since the function will be
called numerous times through all the non-essential dimensions, it is 
recommended to keep them as light as possible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_dims</code></td>
<td>
<p>A vector for single input array or a list of vectors for 
multiple input arrays indicating the names of the dimensions 'fun' to be 
applied along.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_dims</code></td>
<td>
<p>A vector for single returned array or a list of vectors 
for multiple returned arrays indicating the dimension names of the function
output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_libraries</code></td>
<td>
<p>A vector of character string indicating the R library 
names to be used in 'fun'. Only used when the jobs are run on HPCs; if the 
jobs are run locally, load the necessary libraries by <code>library()</code>
directly. The default value is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_attributes</code></td>
<td>
<p>One or more lists of vectors of character string 
indicating the data attributes to be used in 'fun'. The list name should be
consistent with the list name of 'data' in AddStep(). The default value is 
NULL.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A closure that contains all the objects assigned. It serves as the
input of Addstep().
</p>


<h3>Examples</h3>

<pre><code class="language-R"> data_path &lt;- system.file('extdata', package = 'startR')
 path_obs &lt;- file.path(data_path, 'obs/monthly_mean/$var$/$var$_$sdate$.nc')
 sdates &lt;- c('200011', '200012')
 data &lt;- Start(dat = list(list(path = path_obs)),
               var = 'tos',
               sdate = sdates,
               time = 'all',
               latitude = 'all',
               longitude = 'all',
               return_vars = list(latitude = 'dat', 
                                  longitude = 'dat', 
                                  time = 'sdate'),
               retrieve = FALSE)
 fun &lt;- function(x) {
           lat = attributes(x)$Variables$dat1$latitude
           weight = sqrt(cos(lat * pi / 180))
           corrected = Apply(list(x), target_dims = "latitude",
                             fun = function(x) {x * weight})
         }
 step &lt;- Step(fun = fun,
              target_dims = 'latitude',
              output_dims = 'latitude',
              use_libraries = c('multiApply'),
              use_attributes = list(data = "Variables"))
 wf &lt;- AddStep(data, step)

</code></pre>


</div>