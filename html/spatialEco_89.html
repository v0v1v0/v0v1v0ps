<div class="container">

<table style="width: 100%;"><tr>
<td>raster.downscale</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Raster Downscale</h2>

<h3>Description</h3>

<p>Downscales a raster to a higher resolution raster using
a robust regression
</p>


<h3>Usage</h3>

<pre><code class="language-R">raster.downscale(
  x,
  y,
  scatter = FALSE,
  full.res = FALSE,
  residuals = FALSE,
  se = FALSE,
  p = 0.95,
  uncertainty = c("none", "prediction", "confidence")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A terra SpatRaster object representing independent variable(s)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A terra SpatRaster object representing dependent variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scatter</code></td>
<td>
<p>(FALSE/TRUE) Optional scatter plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>full.res</code></td>
<td>
<p>(FALSE/TRUE) Use full resolution of x (see notes)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>(FALSE/TRUE) Output raster residual error raster,
at same resolution as y</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>(FALSE/TRUE) Output standard error raster, using prediction or
confidence interval</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>The confidence/prediction interval (default is 95%)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uncertainty</code></td>
<td>
<p>Output uncertainty raster(s) of confidence or prediction interval,
at same resolution as y. Options are c("none", "prediction", "confidence")</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function uses a robust regression, fit using an M-estimation with Tukey's biweight
initialized by a specific S-estimator, to downscale a raster based on higher-resolution
or more detailed raster data specified as covariate(s). You can optionally output residual
error, standard error and/or uncertainty rasters. However, please note that when choosing
the type of uncertainty, using a confidence interval (uncertainty around the mean predictions)
when you should be using the prediction interval (uncertainty around a single values) will
greatly underestimate the uncertainty in a given predicted value (Bruce &amp; Bruce 2017).
The full.res = TRUE option uses the x data to sample y rather than y to sample x. THis makes
the problem much more computationally and memory extensive and should be used with caution.
There is also the question of pseudo-replication (sample redundancy) in the dependent variable.
Statistically speaking one would expect to capture the sample variation of x by sampling at the
frequency of y thus supporting the downscaling estimate. Note that if uncertainty is not defined
the prediction interval for standard error defaults to "confidence" else is the same output as
uncertainty (eg., prediction or confidence).
</p>


<h3>Value</h3>

<p>A list object containing:
</p>

<ul>
<li>
<p> downscale - downscaled terra SpatRaster object
</p>
</li>
<li>
<p> model - MASS rlm model object
</p>
</li>
<li>
<p> MSE - Mean Square Error
</p>
</li>
<li>
<p> AIC - Akaike information criterion
</p>
</li>
<li>
<p> parm.ci - Parameter confidence intervals
</p>
</li>
<li>
<p> residuals - If residuals = TRUE, a SpatRaster of the residual error
</p>
</li>
<li>
<p> uncertainty - If pred.int = TRUE, SpatRaster's of the lower/upper prediction intervals
</p>
</li>
<li>
<p> std.error - If se = TRUE, SpatRaster's of the standard error
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Jeffrey S. Evans  <a href="mailto:jeffrey_evans@tnc.org">jeffrey_evans@tnc.org</a>
</p>


<h3>References</h3>

<p>Bruce, P., &amp; A. Bruce. (2017). Practical Statistics for Data Scientists. Oâ€™Reilly Media.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
if (require(geodata, quietly = TRUE)) {
library(terra)
library(geodata)

# Download example data (requires geodata package)
elev &lt;- elevation_30s(country="SWZ", path=tempdir())
slp &lt;- terrain(elev, v="slope")
tmax &lt;- worldclim_country(country="SWZ", var="tmax", path=tempdir())
  tmax &lt;- crop(tmax[[1]], ext(elev))

# Downscale temperature
x=c(elev,slp)
  names(x) &lt;- c("elev","slope")
y=tmax
  names(y) &lt;- c("tmax")

tmax.ds &lt;- raster.downscale(x, y, scatter=TRUE, residuals = TRUE,
                            uncertainty = "prediction", se = TRUE)
	
  # plot prediction and parameters	
  opar &lt;- par(no.readonly=TRUE)
    par(mfrow=c(2,2))
      plot(tmax, main="Temp max")
      plot(x[[1]], main="elevation")
      plot(x[[2]], main="slope")
      plot(tmax.ds$downscale, main="Downscaled Temp max")
  par(opar)

  # Plot residual error and raw prediction +/- intervals
  opar &lt;- par(no.readonly=TRUE)
    par(mfrow=c(2,2))
      plot(tmax.ds$std.error, main="Standard Error")
      plot(tmax.ds$residuals, main="residuals")
      plot(tmax.ds$uncertainty[[1]], 
	       main="lower prediction interval")
      plot(tmax.ds$uncertainty[[2]], 
	       main="upper prediction interval")
  par(opar)
  
  # plot prediction uncertainty
  opar &lt;- par(no.readonly=TRUE)
    par(mfrow=c(2,1))
      plot(tmax.ds$downscale - tmax.ds$uncertainty[[1]], 
	       main="lower prediction interval")
      plot(tmax.ds$downscale - tmax.ds$uncertainty[[2]], 
	       main="upper prediction interval")  
  par(opar)  

} else { 
  cat("Please install geodata package to run example", "\n")
}

</code></pre>


</div>