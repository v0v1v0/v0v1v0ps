<div class="container">

<table style="width: 100%;"><tr>
<td>changept</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Change-Point Estimation using Shape-Restricted Splines</h2>

<h3>Description</h3>

<p>'changept' is used to estimate the location of the change-point in the underlying mean curve of a scatterplot and the curve as well using shape-restricted B-splines. The change-point falls in one of the three categories: a mode, an inflection point and a jump point.</p>


<h3>Usage</h3>

<pre><code class="language-R">changept(formula, family = gaussian(), data = NULL, k = NULL, knots = NULL, 
fir = FALSE, q = 3, pnt = FALSE, pen = 0, arp = FALSE, ci = FALSE, nloop = 1e+3, 
constr = TRUE, param = TRUE, gcv = FALSE, spl = NULL, dmat = NULL, x1 = NULL, xn = NULL)</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A formula object which gives a symbolic description of the model to be fitted. It has the form "response ~ predictor". The response is a vector of length <code class="reqn">n</code> and it is from one of the three exponential families: Gaussian, Poisson and binomial. The predictor is a nonparametrically modelled variable with a shape restriction. The user is supposed to indicate the relationship between the underlying mean curve <code class="reqn">\bold{f_m(x)}</code> and the predictor <code class="reqn">\bold{x}</code> in the following way:
</p>
<p>Assume that <code class="reqn">\bold{f_m(x)}</code> is the underlying mean curve and <code class="reqn">\bold{x}</code>  is the predictor: 
</p>

<ul>
<li>
<p>tp(x, sh = 1): 
<code class="reqn">\bold{f_m(x)}</code> is unimodal (increasing-decreasing) with a mode at <code class="reqn">m</code>. See <code>tp</code> for more details.

</p>
</li>
<li>
<p>ip(x, sh = 1): <code class="reqn">\bold{f_m(x)}</code> is convex-concave with an inflection point at <code class="reqn">m</code>. See <code>ip</code> for more details.

</p>
</li>
<li>
<p>jp(x,  trd1 = -1, trd2 = -1, up = TRUE): <code class="reqn">\bold{f_m(x)}</code> has a jump point at <code class="reqn">m</code> and smooth otherwise. It is non-increasing in a subinterval which is made of two consecutive knots and contains the jump point <code class="reqn">m</code>. <code class="reqn">t_{p} \leq m \leq t_{p+1}, p=1,\ldots,k-1</code> and <code class="reqn">k</code> is the number of knots. See <code>jp</code> for more details.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p> A parameter indicating the error distribution and link function to be used in the model. It can be a character string naming a family function or the result of a call to a family function. This is borrowed from the <b>glm</b> routine in the stats package. There are three families used in changept: Gaussian, Poisson and binomial.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An optional data frame, list or environment containing the variables in the model. The default is data = NULL.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>The number of knots. When it is NULL, <code class="reqn">k</code> will be determined inside the changept routine according to the length of the predictor <code class="reqn">\bold{x}</code>; otherwise, the user-defined <code class="reqn">k</code> is used to create the knots. The default is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>The knots used to smoothly constrain a predictor. When it is NULL, a vector of knots will be created inside the changept routine; otherwise, the user-defined knots are used. The default is NULL. If both k and knots are defined by the user, only the knots parameter will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fir</code></td>
<td>
<p>The parameter is used only when the change-point is an inflection point. When fir is TRUE, the estimated curve is constrained to be increasing at two end points. This is useful given the a priori information that the underlying mean curve is increasing over the whole interval, e.g., a growth curve. The default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>The degree of penalty. It can be <code class="reqn">1</code>, <code class="reqn">2</code> or <code class="reqn">3</code>. The default is <code class="reqn">q = 3</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pnt</code></td>
<td>
<p>Logical flag indicating if or not penalized B-splines are used. When pnt is TRUE, penalized B-splines are used; otherwise, unpenalized B-splines are used. The default is pnt = FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pen</code></td>
<td>
<p>The penalty term when penalized B-splines are used. It can only be a non-negative real number. When the user chooses penalized B-splines, the penalty term is determined inside the main routine if it is not defined by the user; otherwise, the user-defined value is used. The default is pen = <code class="reqn">0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>arp</code></td>
<td>
<p>Logical flag indicating if or not the error term is from a stationary autoregressive process of order <code class="reqn">p</code>, where <code class="reqn">p\in\{1,2,3,4\}</code>.  When arp is TRUE, the error term is assumed to follow an AR(p) process; otherwise, it is assumed to be Gaussian. The default is arp = FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>Logical flag. If ci is TRUE, a <code class="reqn">95\%</code> bootstrap confidence interval of <code class="reqn">m</code> will be delivered. The default is ci = FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nloop</code></td>
<td>
<p>The number of simulations used to get a bootstrap confidence interval for the change-point <code class="reqn">m</code> when ci is TRUE. The default is nloop = 1e+3. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constr</code></td>
<td>
<p>Logical flag. It is used when <code class="reqn">m</code> is a jump point. If constr is FALSE, no shape constraint is imposed on the estimated curve; otherwise, a shape constraint is imposed on the estimated curve in a subinterval which is made of two consecutive knots and contains the jump point <code class="reqn">m</code>. <code class="reqn">t_{p} \leq m \leq t_{p+1}, p=1,\ldots,k-1</code> and <code class="reqn">k</code> is the number of knots. See <code>jp</code> for more details. The default is constr = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param</code></td>
<td>
<p>Logical flag indicating if or not parametric bootstrapping is used. When param is TRUE,  parametric bootstrapping is used; otherwise, nonparametric bootstrapping is used. The default is param = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gcv</code></td>
<td>
<p>Logical flag indicating if or not the penalty term may be chosen through generalized cross-validation (GCV) methods when pen = TRUE. The default is gcv = FALSE. See Meyer, M.C. (2012) Constrained Penalized Splines. <em>Canadian Journal of Statistics <b>40(1)</b></em>, 190–206 for more details.</p>
</td>
</tr>
</table>
<table>
<tr style="vertical-align: top;">
<td><code>spl</code></td>
<td>
<p>This parameter is of no interest to the user.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dmat</code></td>
<td>
<p>This parameter is of no interest to the user.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x1</code></td>
<td>
<p>This parameter is of no interest to the user.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xn</code></td>
<td>
<p>This parameter is of no interest to the user.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Given a scatterplot of <code class="reqn">(x_i, y_i)</code>, <code class="reqn">i = 1,\ldots,n</code>, where <code class="reqn">\bold{x}</code> is the predictor and <code class="reqn">\bold{y}</code> is the response which could be Gaussian, Poisson and binomial. The underlying mean curve in this scatterplot is denoted as <code class="reqn">\bold{f_m(x)}</code>, where <code class="reqn">\bold{f_m(x)}</code> is a smooth curve with a change-point <code class="reqn">m</code> which falls in one of the three categories:
</p>

<ul>
<li>
<p>a mode in a unimodal smooth curve
</p>
</li>
<li>
<p>an inflection point in a convex-concave (concave-convex) smooth curve
</p>
</li>
<li>
<p>a jump point in an otherwise smooth curve.
</p>
<p>For the unimodal case, quadratic B-splines are used; for the inflection-point case, cubic B-splines are used; for the jump-point case, quadratic B-splines along with two extra basis functions, i.e., the ramp basis function and the jump basis function are used.  The ramp basis function ensures that the slope of the estimated mean curve on the left of the jump point could be different from that on the right of the jump point. The jump basis function ensures that the estimated mean curve has an upward or downward jump.
</p>
<p>In each case,  the user can choose unpenalized or penalized regression. For the unimodal case, the penalized regression is strongly suggested for its smoothness and robustness in terms of the number and the placement of knots, especially when the response is binomial; for the jump-point case, the user can choose to make a shape-restricted fit or not by setting the parameter constr to be TRUE or FALSE. If constr is TRUE, a jump point will be detected and the monotonicity of the 
mean curve will be constrained in a subinterval which is made of two consecutive knots and contains the jump point <code class="reqn">m</code>; otherwise, a jump point will be detected without any shape restriction on the mean curve. 
</p>
<p>A parametrically modelled categorical covariate can be included in the model for the unimodal case and the jump-point case. However, it cannot be included in the model for the inflection-point case if the response is binomial, since the problem of estimating an inflection point is not well-defined then. 
</p>
<p>In addition, the user can get a <code class="reqn">95\%</code> bootstrap confidence interval of <code class="reqn">m</code> by setting the logical parameter ci to be TRUE. The default number of simulations to get such a confidence interval is 1e+3, which is defined by the parameter nloop. The genetic routine <b>plot</b> can be used to show some estimated results including <code class="reqn">\hat{f}_{\hat{m}}</code>, <code class="reqn">\hat{m}</code> and a <code class="reqn">95\%</code> bootstrap confidence interval of <code class="reqn">m</code> if it is available. 
</p>
<p>See references cited in this section for more details.
</p>
</li>
</ul>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>chpt</code></td>
<td>
<p>The estimated change-point <code class="reqn">\hat{m}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>The knots used in the regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fhat</code></td>
<td>
<p>The estimated mean curve <code class="reqn">\hat{f}_{\hat{m}}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fhat_x</code></td>
<td>
<p>The estimated mean curve <code class="reqn">\hat{f}_{\hat{m}}</code> in the constrained predictor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fhat_eta</code></td>
<td>
<p>The estimated systematic component given that the response is binomial or Poisson and the change-point is a mode or a jump point.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fhat_eta_x</code></td>
<td>
<p>The estimated systematic component in the constrained predictor given that the response is binomial or Poisson and the change-point is a mode or a jump point.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coefs</code></td>
<td>
<p>The estimated coefficients of the B-spline basis functions for the shape-restricted predictor and the matrix whose columns represent the parametrically modelled categorical covariate if the user includes any in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zcoefs</code></td>
<td>
<p>The estimated coefficients of the matrix whose columns represent the parametrically modelled categorical covariate if the user includes any in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cibt</code></td>
<td>
<p>A <code class="reqn">95\%</code> bootstrap confidence interval of <code class="reqn">m</code> given that the parameter ci is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>categ</code></td>
<td>
<p>The category of the change-point to be estimated. Three categories are included, i.e., a mode, an inflection point and a jump point.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sh</code></td>
<td>
<p>The sh parameter defined in the symbolic routine <code>tp</code> or <code>ip</code> in a changept formula.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The shape-restricted predictor vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>The response vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xnm</code></td>
<td>
<p>The name of the shape-restricted predictor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>znm</code></td>
<td>
<p>The name of the parametrically modelled categorical covariate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ynm</code></td>
<td>
<p>The name of the response variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m_i</code></td>
<td>
<p>The centering value for the ramp edge in the jump-point case.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pos</code></td>
<td>
<p>The position of the knot <code class="reqn">t_p</code> such that <code class="reqn">t_{p} \leq m \leq t_{p+1}, p=1,\ldots,k-1</code> and <code class="reqn">k</code> is the number of knots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sub</code></td>
<td>
<p>The subinterval in which constrained regression is made for the jump-point case. It is of the form <code class="reqn">[t_{p}, t_p+1]</code>. <code class="reqn">t_{p} \leq m \leq t_{p+1}, p=1,\ldots,k-1</code> and <code class="reqn">k</code> is the number of knots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>The family parameter in a changept formula.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wt.iter</code></td>
<td>
<p>Logical flag indicating if or not iteratively re-weighted cone projections may be used. If the response is Gaussian, then wt.iter = FALSE; if the response is binomial or Poisson, then wt.iter = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zmat</code></td>
<td>
<p>A matrix whose columns represent the parametrically modelled categorical covariate if the user includes any in the model. The user can choose to include a constant vector in it or not. It must be of full column rank.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vals</code></td>
<td>
<p>A vector storing the smallest value of each categorical variable defined as a factor(matrix).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>is_fac</code></td>
<td>
<p>Logical flag showing if a categorical variable is a factor(matrix) or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zid</code></td>
<td>
<p>A vector keeping track of the position of the categorical variable in a changept formula.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zid1</code></td>
<td>
<p>A vector keeping track of the beginning position of the levels(columns) of the categorical variable defined as a factor(matrix).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zid2</code></td>
<td>
<p>A vector keeping track of the end position of the levels(columns) of the categorical variable defined as a factor(matrix).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tms</code></td>
<td>
<p>The terms object extracted by the generic function <b>terms</b> from a changept fit. See the official help page (<a href="http://stat.ethz.ch/R-manual/R-patched/library/stats/html/terms.html">http://stat.ethz.ch/R-manual/R-patched/library/stats/html/terms.html</a>) of the <b>terms</b> function for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>msbt</code></td>
<td>
<p>A bootstrap distribution of <code class="reqn">m</code> given that the parameter ci is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bmat</code></td>
<td>
<p>A matrix whose columns are the B-spline basis functions for the shape-restricted predictor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>The estimated vector of autoregressive coefficients when the error term is assumed to follow an AR(p) process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sig</code></td>
<td>
<p>The estimated variance of the white noise of the error term when the error term is assumed to follow an AR(p) process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aics</code></td>
<td>
<p>A matrix of AIC values delivered when the error term is assumed to follow an AR(p) process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>The penalty term chosen when penalized B-splines are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>edfc</code></td>
<td>
<p>The constrained effective degrees of freedom in the final fit when penalized B-splines are used.</p>
</td>
</tr>
</table>
<table>
<tr style="vertical-align: top;">
<td><code>edfs</code></td>
<td>
<p>A vector of unconstrained effective degrees of freedom when penalized B-splines are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lams</code></td>
<td>
<p>A vector of penalty terms corresponding to a vector of unconstrained effective degrees of freedom when penalized B-splines are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phisbt</code></td>
<td>
<p>The bootstrap distribution of the vector of estimated autoregressive coefficients when the error term is assumed to follow an AR(p) process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigsbt</code></td>
<td>
<p>The bootstrap distribution of the estimated variance of the white noise of the error term when the error term is assumed to follow an AR(p) process.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Xiyue Liao and Mary C Meyer
</p>


<h3>References</h3>

<p>Meyer, M. C. (2008) Inference using shape-restricted regression splines. <em>Annals of Applied Statistics <b>2(3)</b></em>, 1013–1033.
</p>
<p>Meyer, M.C. (2012) Constrained Penalized Splines. <em>Canadian Journal of Statistics <b>40(1)</b></em>, 190–206. 
</p>
<p>Meyer, M. C. (2013b) A simple new algorithm for quadratic programming with applications in statistics. <em>Communications in Statistics <b>42(5)</b></em>, 1126–1139.  
</p>
<p>Liao, X. and M. C. Meyer (2014) coneproj: An R package for the primal or dual cone projections with routines for constrained regression. <em>Journal of Statistical Software <b>61(12)</b></em>, 1–22.
</p>
<p>Wang, H., Meyer, M.C., and Opsomer, J.D. (2013) Constrained Spline Regression in the Presence of AR(p) Errors. <em>Journal of Nonparametic Statistics <b>25(4)</b></em>, 809–827. 
</p>


<h3>See Also</h3>

<p><code>tp</code>, <code>ip</code>, <code>jp</code></p>


<h3>Examples</h3>

<pre><code class="language-R">  # Example 1: the response is normal 
  # the underlying mean curve has an inflection point at .5 and it is concave-convex
  n = 100
  inflect = .5
  x = seq(1/n, 1, length = n)
  
  set.seed(123)
  y = 50 * (x - inflect)^3 + rnorm(n, sd = 1)
  ans = changept(y ~ ip(x, sh = -1))

  plot(ans)

  # Example 2: the response is binomial
  # the underlying mean curve has an inflection point at .5 and it is convex-concave
  n = 100
  x = seq(1/n, 1, length = n)
  mu = exp(8 * x - 4) / (1 + exp(8 * x - 4))

  set.seed(123)
  y = rbinom(n, size = 1, prob = mu)
  ans = changept(y ~ ip(x), family = binomial())

  plot(ans)

  # Example 3: the response is normal
  # the underlying mean curve is unimodal with a mode at .5
  n = 100
  SD = .1
  x = seq(1/n, 1, length = n)
  mode = .5

  set.seed(123)
  y = -6 * (x - .5)^2 + rnorm(n, sd = SD)
  ans = changept(y ~ tp(x))

  plot(ans)

  # Example 4: the response is binomial
  # the underlying mean curve is unimodal with a mode at .5
  n = 200
  x = seq(1/n, 1, length = n)
  mu = .9 - 2.5 * (x - .5)^2

  set.seed(123)
  y = rbinom(n, size = 1, prob = mu)
  ans = changept(y ~ tp(x), family = binomial(), k = 10, pnt = TRUE)

  plot(ans)

  # Example 5: 
  library(datasets)
  # Nile River Data Set: Nile river flow is the response
  # an abrupt downward jump in the river flow occurred around the year 1898
  # the river flow is non-decreasing on both sides of the jump point
  data(Nile)
  yrs = 1871:1970
  ans = changept(Nile ~ jp(yrs, up = FALSE, trd1 = 1, trd2 = 1), data = Nile)

  plot(ans)

</code></pre>


</div>