<div class="container">

<table style="width: 100%;"><tr>
<td>pi.add</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Position index addition</h2>

<h3>Description</h3>

<p>Add new raster objects based on position index values.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pi.add(
  attTbl,
  ngbList,
  rNumb = FALSE,
  RO,
  mainPI = NULL,
  secPI = NULL,
  add.mPI = NULL,
  add.sPI = NULL,
  cond.filter = NULL,
  min.N = NULL,
  plot = FALSE,
  r = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>attTbl</code></td>
<td>
<p>data.frame, the attribute table returned by the function
<code>attTbl</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ngbList</code></td>
<td>
<p>list, the list of neighborhoods returned by the function
<code>ngbList</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rNumb</code></td>
<td>
<p>logic, the neighborhoods of the argument <code>ngbList</code> are
identified by cell numbers (<code>rNumb=FALSE</code>) or by row numbers
(<code>rNumb=TRUE</code>) (see <code>ngbList</code>). It is advised to use row
numbers for large rasters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RO</code></td>
<td>
<p>column name, the name of the column with the raster object IDs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mainPI</code></td>
<td>
<p>column name, the name of the column with main position index
values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>secPI</code></td>
<td>
<p>column name, the name of the column with secondary position
index values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.mPI</code></td>
<td>
<p>numeric, threshold of main position index values. Cells with
values above the threshold are flagged as cells potentially being part of
new raster objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.sPI</code></td>
<td>
<p>numeric, threshold of secondary position index values. Cells
with values above the threshold flagged as cells potentially being part of
new raster objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cond.filter</code></td>
<td>
<p>character string, defines what cells have to be considered
by the function the arguments. Test cell absolute conditions can be used
(see <code>conditions</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.N</code></td>
<td>
<p>numeric, the minimum number of cells a raster object has to have
to be included in the function output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>logic, plot the results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>single or multi-layer raster of the class <code>SpatRaster</code> (see
<code>help("rast", terra)</code>) used to compute the attribute table. Required
only if <code>plot = TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>New raster objects are added based on position index values. Two
different position indices can be passed to the function (<code>mainPI</code> and
<code>secPI</code>).
</p>

<ul>
<li>
<p> Input raster objects are assigned to the same class to flag cells that
are part of raster objects;
</p>
</li>
<li>
<p> Cells with values above <code>mainPI</code> <strong>OR</strong> above <code>mainPI</code> are
flagged as cells potentially being part of new raster objects;
</p>
</li>
<li>
<p> If not connected to any of the existing raster objects, the groups of
cells above position index values are assigned to new raster objects.
</p>
</li>
<li>
<p> Only raster objects with at least as many cells as specified by the
argument <code>min.N</code> are included in the function output.
</p>
</li>
<li>
<p> If both <code>mainPI</code> and <code>secPI</code> are equal to <code>NULL</code>, the
function will exclusively filter raster objects based on their size
(<code>min.N</code>).
</p>
</li>
</ul>
<h3>Value</h3>

<p>The function returns a class vector with raster objects IDs. The
vector has length equal to the number of rows of the attribute table. NA
values are assigned to cells that do not belong to any raster object.
</p>


<h3>Note</h3>

<p>Raster objects are added only if they do not share any border with
input raster objects.
</p>


<h3>See Also</h3>

<p><code>attTbl()</code>, <code>ngbList()</code>, <code>rel.pi()</code>, <code>pi.sgm()</code>, <code>conditions()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># DUMMY DATA
######################################################################################
# LOAD LIBRARIES
library(scapesClassification)
library(terra)

# LOAD THE DUMMY RASTER
r &lt;- list.files(system.file("extdata", package = "scapesClassification"),
                pattern = "dummy_raster\\.tif", full.names = TRUE)
r &lt;- terra::rast(r)

# COMPUTE THE ATTRIBUTE TABLE
at &lt;- attTbl(r, "dummy_var")

# COMPUTE THE LIST OF NEIGBORHOODS
nbs &lt;- ngbList(r, attTbl=at)

################################################################################
# COMPUTE RASTER OBJECTS
################################################################################
at$RO[at$dummy_var==8] &lt;- 1
at$RO &lt;- cond.4.nofn(at, nbs, classVector = at$RO, class=1, nbs_of = 1,
                     cond = "dummy_var &lt; dummy_var[] &amp; dummy_var &gt; 2")

# One raster object
unique(at$RO)

################################################################################
# POSITION INDEX
################################################################################
at$PI &lt;- (at$dummy_var - mean(at$dummy_var))/stats::sd(at$dummy_var)

################################################################################
# POSITION INDEX ADDITION
################################################################################
RO1 &lt;- pi.add(at, nbs,
              RO = "RO",     # Raster objects
              mainPI = "PI", # PI addition layer
              add.mPI = 1,   # add disjoint objects with PI values &gt; 1
              plot = FALSE, r = r)

################################################################################
# PLOT
################################################################################
# Convert class vectors to raster
r_RO  &lt;- cv.2.rast(r = r, classVector = at$RO)
r_RO1 &lt;- cv.2.rast(r = r, classVector = RO1)

# Plot
oldpar &lt;- par(mfrow = c(1,2))
m &lt;- c(4.5, 0.5, 2, 3.2)

terra::plot(r_RO, type="classes", main="Raster objects - Input", mar=m,
            plg=list(x=1, y=1, cex=0.9))

terra::plot(r_RO1, type="classes", main="Raster objects - Output", mar=m,
            plg=list(x=1, y=1, cex=0.9))
text(xyFromCell(r,at$Cell), as.character(round(at$PI,2)),
cex = 0.8) # visualize relPI
text(0.01, 1, "Add on PI &gt;= 1", adj=c(0,0), cex = 0.8)
par(oldpar)

# Two raster object
unique(RO1)
</code></pre>


</div>