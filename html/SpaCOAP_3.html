<div class="container">

<table style="width: 100%;"><tr>
<td>SpaCOAP</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit the SpaCOAP model</h2>

<h3>Description</h3>

<p>Fit the spatial covariate-augmented overdispersed Poisson factor model
</p>


<h3>Usage</h3>

<pre><code class="language-R">SpaCOAP(
  X_count,
  Adj_sp,
  H,
  Z = matrix(1, nrow(X_count), 1),
  offset = rep(0, nrow(X_count)),
  rank_use = 5,
  q = 15,
  epsELBO = 1e-08,
  maxIter = 30,
  verbose = TRUE,
  add_IC_inter = FALSE,
  seed = 1,
  algo = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X_count</code></td>
<td>
<p>a count matrix, the observed count matrix with shape n-by-p.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Adj_sp</code></td>
<td>
<p>a sparse matrix, the weighted adjacency matrix;</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>H</code></td>
<td>
<p>a n-by-d matrix, the covariate matrix with low-rank regression coefficient matrix;</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>an optional matrix, the fixed-dimensional covariate matrix with control variables; default as a full-one column vector if there is no additional covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>an optional vector, the offset for each unit; default as full-zero vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rank_use</code></td>
<td>
<p>an optional integer, specify the rank of the regression coefficient matrix; default as 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>an optional string, specify the number of factors; default as 15.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsELBO</code></td>
<td>
<p>an optional positive vlaue, tolerance of relative variation rate of the envidence lower bound value, defualt as '1e-8'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxIter</code></td>
<td>
<p>the maximum iteration of the VEM algorithm. The default is 30.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical value, whether output the information in iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_IC_inter</code></td>
<td>
<p>a logical value, add the identifiability condition in iterative algorithm or add it after algorithm converges; default as FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>an integer, set the random seed in initialization, default as 1;</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>algo</code></td>
<td>
<p>an optional integer taking value 1 0r 2, select the algorithm used, default as 1, representing variational EM algorithm.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>None
</p>


<h3>Value</h3>

<p>return a list including the following components:
</p>

<ul>
<li> <p><code>F</code> - the predicted factor matrix; 
</p>
</li>
<li> <p><code>B</code> - the estimated loading matrix; 
</p>
</li>
<li> <p><code>bbeta</code> - the estimated low-rank large coefficient matrix; 
</p>
</li>
<li> <p><code>alpha0</code> - the estimated regression coefficient matrix corresponing to Z;
</p>
</li>
<li> <p><code>invLambda</code> - the inverse of the estimated variances of error;
</p>
</li>
<li> <p><code>eta</code> - the estimated spatial autocorrelation parameter;
</p>
</li>
<li> <p><code>S</code> - the approximated posterior covariance for each row of F;
</p>
</li>
<li> <p><code>ELBO</code> -  the ELBO value when algorithm stops;
</p>
</li>
<li> <p><code>ELBO_seq</code> - the sequence of ELBO values.
</p>
</li>
<li> <p><code>time_use</code> - the running time in model fitting of SpaCOAP;
</p>
</li>
</ul>
<h3>References</h3>

<p>Liu W, Zhong Q. High-dimensional covariate-augmented overdispersed poisson factor model. Biometrics. 2024 Jun;80(2):ujae031.
</p>


<h3>See Also</h3>

<p>None
</p>


<h3>Examples</h3>

<pre><code class="language-R">width &lt;- 20; height &lt;- 15; p &lt;- 100
d &lt;- 20; k &lt;- 3; q &lt;- 6; r &lt;- 3
datlist &lt;- gendata_spacoap(width=width, height=height, p=p, d=20, k=k, q=q, rank0=r)
fitlist &lt;- SpaCOAP(X_count=datlist$X, Adj_sp = datlist$Adj_sp, 
H= datlist$H, Z = datlist$Z, q=6, rank_use=3)
str(fitlist)
</code></pre>


</div>