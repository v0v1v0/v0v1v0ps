<div class="container">

<table style="width: 100%;"><tr>
<td>eigensound</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Sound waves onto morphometric data</h2>

<h3>Description</h3>

<p><code>eigensound</code> is the main feature of <code>SoundShape</code> package. For each <code>".wav"</code> file on a given folder, the fuction will compute spectrogram data and acquire semilandmarks using a 3D representation of sound (<code>analysis.type = "threeDshape"</code>), allowing its users to acquire, and simultaneously store point coordinates (i.e. semilandmarks) as an R object, and/or in TPS format – the native file format of James Rohlf’s TPS series (Rohlf, 2015).
</p>
<p>Moreover, <code>eigensound</code> also allow its user to export 2D and 3D spectrogram images (<code>plot.exp = TRUE</code>) that are helpful during the protocol for error verification and for illustrative purposes (see Rocha &amp; Romano <em>in prep</em>). Alternativaly, <code>eigensound</code> feature the option of acquiring semilandmarks as the cross-correlation between energy quantiles and a curve of relative amplitude from 2D spectrograms (<code>analysis.type = "twoDshape"</code>; see <code>Details</code> section).
</p>


<h3>Usage</h3>

<pre><code class="language-R">eigensound(
  analysis.type = NULL,
  wav.at = NULL,
  store.at = wav.at,
  dBlevel = 25,
  flim = c(0, 10),
  tlim = c(0, 1),
  x.length = 80,
  y.length = 60,
  log.scale = TRUE,
  back.amp = 35,
  add.points = FALSE,
  add.contour = TRUE,
  lwd = 1,
  EQ = c(0.05, 0.15, 0.3, 0.5, 0.7, 0.85, 0.95),
  mag.time = 1,
  f = 44100,
  wl = 512,
  ovlp = 70,
  plot.exp = TRUE,
  plot.as = "jpeg",
  plot.type = "surface",
  rotate.Xaxis = 60,
  rotate.Yaxis = 40,
  TPS.file = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>analysis.type</code></td>
<td>
<p>type of analysis intended. If <code>analysis.type = "threeDshape"</code>, semilandmarks are acquired from spectrogram data using a 3D representation of sound (same as in MacLeod et al., 2013). If <code>analysis.type = "twoDshape"</code> and <code>add.points = TRUE</code>, semilandmarks are acquired using energy quantiles and a 2D curve of relative amplitude. By default: <code>analysis.type = NULL</code> (i.e. method must be specified before the analysis).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wav.at</code></td>
<td>
<p>filepath to the folder where <code>".wav"</code> files are stored. Should be presented between quotation marks. By default: <code>wav.at = NULL</code> (i.e. user must specify the filepath to <code>".wav"</code> files)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>store.at</code></td>
<td>
<p>filepath to the folder where spectrogram plots and <code>tps</code> file will be stored. Should be presented between quotation marks. By default: <code>store.at = wav.at</code> (i.e. store outputs in the same folder as <code>".wav"</code> files)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dBlevel</code></td>
<td>
<p>absolute amplitude value to be used as relative amplitude contour, which will serve as reference for semilandmark acquisition in both <code>analysis.type = "threeDshape"</code> and <code>"twoDshape"</code>. By default: <code>dBlevel = 25</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flim</code></td>
<td>
<p>modifications of the frequency limits (Y-axis). Vector with two values in kHz. By default: <code>flim = c(0, 10)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tlim</code></td>
<td>
<p>modifications of the time limits (X-axis). Vector with two values in seconds. By default: <code>tlim = c(0, 1)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x.length</code></td>
<td>
<p>only applies when <code>analysis.type = "threeDshape"</code>. Length of sequence (i.e. number of cells per side on sound window) to be used as sampling grid coordinates on the time (X-axis).  By default: <code>x.length = 80</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y.length</code></td>
<td>
<p>only applies when <code>analysis.type = "threeDshape"</code>. Length of sequence (i.e. number of cells per side on sound window) to be used as sampling grid coordinates on the frequency (Y-axis). By default: <code>y.length = 60</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log.scale</code></td>
<td>
<p>only applies when <code>analysis.type = "threeDshape"</code>. A logical. If <code>TRUE</code>, <code>eigensound</code> will use a logarithmic scale on the time (X-axis), which is recommeded when the analyzed sounds present great variation on this axis (e.g. emphasize short duration sounds). If <code>FALSE</code>, a linear scale is used instead (same as MacLeod et al., 2013). By default: <code>log.scale = TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>back.amp</code></td>
<td>
<p>only applies when <code>analysis.type = "twoDshape"</code> and  <code>plot.exp = TRUE</code>. Absolute amplitude value to be used as background in the 2D spectrogram plot. By default: <code>back.amp = 35</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.points</code></td>
<td>
<p>only applies when <code>analysis.type = "twoDshape"</code>. A logical. If <code>TRUE</code>, <code>eigensound</code> will compute semilandmarks acquired by cross-correlation between energy quantiles (i.e. <code>EQ</code>) and a curve of relative amplitude (i.e. <code>dBlevel</code>). If <code>plot.exp = TRUE</code>, semilandmarks will be included in spectrogram plots. By default: <code>add.points = FALSE</code> (see <code>Details</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.contour</code></td>
<td>
<p>only applies when <code>analysis.type = "twoDshape"</code> and  <code>plot.exp = TRUE</code>. A logical. If <code>TRUE</code>, exported spectrogram plots will include the curves of relative amplitude at the level specified by <code>dBlevel</code>. By default: <code>add.contour = TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd</code></td>
<td>
<p>only applies when <code>plot.exp = TRUE</code> and <code>add.contour = TRUE</code>. The line width for the curves of relative amplitude at the level specified by <code>dBlevel</code>. Same as in <code>par</code>. By default: <code>lwd = 1</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EQ</code></td>
<td>
<p>only applies when <code>analysis.type = "twoDshape"</code> and <code>add.points = TRUE</code>. A vector of energy quantiles intended (with <code>0 &lt; EQ &lt; 1</code>). By default: <code>EQ = c(0.05, 0.15, 0.3, 0.5, 0.7, 0.85, 0.95)</code> <strong>Note:</strong> When dealing with narrow banded calls, consider reducing the number of quantiles to prevent errors in the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mag.time</code></td>
<td>
<p>only applies when <code>analysis.type = "twoDshape"</code>. Optional argument for magnifying the time coordinates (X-axis). This is sometimes desired for small sound windows (e.g. less than 1 s), in which the time coordinates will be on a different scale than that of frequency coordinates. In those cases, it is recommended to include <code>mag.time = 10</code> or <code>mag.time = 100</code>, depending on the lenght of sound window. By default: <code>mag.time = 1</code> (i.e. no magnification is performed)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>sampling frequency of <code>Wave</code>'s for the analysis (in Hz). By default: <code>f = 44100</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wl</code></td>
<td>
<p>length of the window for the analysis. By default: <code>wl = 512</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ovlp</code></td>
<td>
<p>overlap between two successive windows (in %) for increased spectrogram resolution. By default: <code>ovlp = 70</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.exp</code></td>
<td>
<p>a logical. If <code>TRUE</code>, for each <code>".wav"</code> file on the folder indicated by <code>wav.at</code>, <code>eigensound</code> will store a spectrogram image on the folder indicated by <code>store.at</code>. Depending on the <code>analysis.type</code>, plots may consist of 2D or 3D spectrogram images. By default: <code>plot.exp = TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.as</code></td>
<td>
<p>only applies when <code>plot.exp = TRUE</code>. <code>plot.as = "jpeg"</code> will generate compressed images for quick inspection of semilandmarks; <code>plot.as = "tiff"</code> or <code>"tif"</code> will generate uncompressed high resolution images that can be edited and used for publication. By default: <code>plot.as = "jpeg"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.type</code></td>
<td>
<p>only applies when <code>analysis.type = "threeDshape"</code> and  <code>plot.exp = TRUE</code>. <code>plot.type = "surface"</code> will produce simplified 3D sound surfaces from the calculated semilandmarks (same output employed by MacLeod et al., 2013); <code>plot.type = "points"</code> will produce 3D graphs with semilandmarks as points. By default: <code>plot.type = "surface"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rotate.Xaxis</code></td>
<td>
<p>only applies when <code>analysis.type = "threeDshape"</code> and  <code>plot.exp = TRUE</code>. Rotation of the X-axis. Same as <code>theta</code> from <code>persp3D</code> (<code>plot3D</code> package). By default: <code>rotate.Xaxis = 60</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rotate.Yaxis</code></td>
<td>
<p>only applies when <code>analysis.type = "threeDshape"</code> and  <code>plot.exp = TRUE</code>. Rotation of the Y-axis. Same as <code>phi</code> from <code>persp3D</code> (<code>plot3D</code> package). By default: <code>rotate.Yaxis = 40</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TPS.file</code></td>
<td>
<p>Desired name for the <code>tps</code> file containing semilandmark coordinates. Should be presented between quotation marks. <strong>Note:</strong> Whenever <code>analysis.type = "twoDshape"</code>, it will only work if <code>add.points = TRUE</code>. By default: <code>TPS.file = NULL</code> (i.e. prevents <code>eigensound</code> from creating a <code>tps</code> file)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When <code>analysis.type = "twoDshape"</code> and <code>add.points = TRUE</code>, <code>eigensound</code> will compute semilandmarks acquired by cross-correlation between energy quantiles (i.e. <code>EQ</code>) and a curve of relative amplitude (i.e. <code>dBlevel</code>). However, this is often subtle and prone to incur in errors (e.g. bad alignment of acoustic units; inappropriate X and Y coordinates for the sound window; narrow banded calls). Therefore, a more robust protocol of error verification is achieved using <code>add.points = FALSE</code> and <code>add.contour = TRUE</code> (default), which allow for quick verification of acoustic units alignment and the shape of each curve of relative amplitude (specified by <code>dBlevel</code>).
</p>


<h3>Note</h3>

<p>In order to store the results from <code>eigensound</code> function and proceed with the Geometric Morphometric steps of the analysis (e.g. <code>geomorph</code> package; Adams et al., 2017), one can simultaneosly assign the function's output to an <code>R</code> object and/or store them as a <code>tps</code> file to be used by numerous softwares of geometric analysis of shape, such as the TPS series (Rohlf, 2015).
</p>
<p>Additionally, one may also export 2D or 3D plots as <code>jpeg</code> (compressed image) or <code>tiff</code> (uncompressed image) file formats, which can be edited for publication purposes.
</p>


<h3>Author(s)</h3>

<p>Pedro Rocha
</p>


<h3>References</h3>

<p>Adams, D. C., M. L. Collyer, A. Kaliontzopoulou &amp; Sherratt, E. (2017) <em>Geomorph: Software for geometric morphometric analyses</em>. R package version 3.0.5. https://cran.r-project.org/package=geomorph.
</p>
<p>MacLeod, N., Krieger, J. &amp; Jones, K. E. (2013). Geometric morphometric approaches to acoustic signal analysis in mammalian biology. <em>Hystrix, the Italian Journal of Mammalogy, 24</em>(1), 110-125.
</p>
<p>Rocha, P. &amp; Romano, P. (2021) The shape of sound: A new <code>R</code> package that crosses the bridge between Bioacoustics and Geometric Morphometrics. <em>Methods in Ecology and Evolution, 12</em>(6), 1115-1121.
</p>
<p>Rohlf, F.J. (2015) The tps series of software. <em>Hystrix 26</em>, 9-12.
</p>


<h3>See Also</h3>

<p><code>align.wave</code>, <code>geomorph</code>, <code>seewave</code>
</p>
<p>Useful links:
</p>

<ul>
<li>
<p><a href="https://github.com/p-rocha/SoundShape">https://github.com/p-rocha/SoundShape</a>
</p>
</li>
<li>
<p>Report bugs at <a href="https://github.com/p-rocha/SoundShape/issues">https://github.com/p-rocha/SoundShape/issues</a></p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">library(seewave)
library(tuneR)

# Create temporary folder to store ".wav" files
wav.at &lt;- file.path(base::tempdir(), "eigensound")
if(!dir.exists(wav.at)) dir.create(wav.at)

# Create temporary folder to store results
store.at &lt;- file.path(base::tempdir(), "eigensound-output")
if(!dir.exists(store.at)) dir.create(store.at)

# Cut acoustic units from original Wave
cut.cuvieri &lt;- cutw(cuvieri, f=44100, from=0, to=0.9, output = "Wave")
cut.centralis &lt;- cutw(centralis, f=44100, from=0, to=0.9, output = "Wave")
cut.kroyeri &lt;- cutw(kroyeri, f=44100, from=0.2, to=1.1, output = "Wave")

# Export ".wav" files containing acoustic units and store on previosly created folder
writeWave(cut.cuvieri, filename = file.path(wav.at, "cut.cuvieri.wav"), extensible = FALSE)
writeWave(cut.centralis, filename = file.path(wav.at, "cut.centralis.wav"), extensible = FALSE)
writeWave(cut.kroyeri, filename = file.path(wav.at, "cut.kroyeri.wav"), extensible = FALSE)



# Create 2D spectrograms using analysis.type = "twoDshape"
eigensound(analysis.type = "twoDshape", flim=c(0, 4), tlim=c(0, 0.8),
           plot.exp=TRUE, wav.at = wav.at, store.at = store.at)

# Create 3D spectrograms using analysis.type = "threeDshape" and store point coordinates
eig.data &lt;- eigensound(analysis.type = "threeDshape", plot.exp=TRUE,
              wav.at = wav.at, store.at = store.at, flim=c(0, 4), tlim=c(0, 0.8))


</code></pre>


</div>