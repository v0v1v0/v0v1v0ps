<div class="container">

<table style="width: 100%;"><tr>
<td>as.spam.listw</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Spatial neighbour sparse representation</h2>

<h3>Description</h3>

<p>Interface between Matrix class objects and weights lists. The <code>as.spam.listw</code> method converts a <code>"listw"</code> object to a sparse matrix as defined in the <span class="pkg">spam</span> package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">as.spam.listw(listw)
listw2U_spam(lw)
listw2U_Matrix(lw)
as_dgRMatrix_listw(listw)
as_dsTMatrix_listw(listw)
as_dsCMatrix_I(n)
as_dsCMatrix_IrW(W, rho)
Jacobian_W(W, rho)
powerWeights(W, rho, order=250, X, tol=.Machine$double.eps^(3/5))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>listw, lw</code></td>
<td>
<p>a <code>listw</code> object from for example <code>nb2listw</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W</code></td>
<td>
<p>a <code>dsTMatrix</code> object created using <code>as_dsTMatrix_listw</code> from a symmetric <code>listw</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>spatial regression coefficient</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>length of diagonal for identity matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>Power series maximum limit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>A numerical matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>Tolerance for convergence of power series</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Roger Bivand <a href="mailto:Roger.Bivand@nhh.no">Roger.Bivand@nhh.no</a></p>


<h3>See Also</h3>

<p><code>nb2listw</code></p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
require(sf, quietly=TRUE)
columbus &lt;- st_read(system.file("shapes/columbus.gpkg", package="spData")[1], quiet=TRUE)
#require(spdep, quietly=TRUE)
col.gal.nb &lt;- spdep::read.gal(system.file("weights/columbus.gal", package="spData")[1])
col.listw &lt;- spdep::nb2listw(col.gal.nb)
if (require("spam", quietly=TRUE)) {
  col.sp &lt;- as.spam.listw(col.listw)
  str(col.sp)
}
suppressMessages(nyadjmat &lt;- as.matrix(foreign::read.dbf(system.file(
 "misc/nyadjwts.dbf", package="spData")[1])[-1]))
nyadjlw &lt;- spdep::mat2listw(nyadjmat)
listw_NY &lt;- spdep::nb2listw(nyadjlw$neighbours, style="B")
W_C &lt;- as(listw_NY, "CsparseMatrix")
W_R &lt;- as(listw_NY, "RsparseMatrix")
W_S &lt;- as(listw_NY, "symmetricMatrix")
n &lt;- nrow(W_S)
I &lt;- Diagonal(n)
rho &lt;- 0.1
c(determinant(I - rho * W_S, logarithm=TRUE)$modulus)
sum(log(1 - rho * eigenw(listw_NY)))
nW &lt;- - W_S
nChol &lt;- Cholesky(nW, Imult=8)
n * log(rho) + (2 * c(determinant(update(nChol, nW, 1/rho))$modulus))

## End(Not run)
nb7rt &lt;- spdep::cell2nb(7, 7, torus=TRUE)
x &lt;- matrix(sample(rnorm(500*length(nb7rt))), nrow=length(nb7rt))
lw &lt;- spdep::nb2listw(nb7rt)
if (FALSE) {
# Only needed in some simulation settings where the input and
# output distributions must agree in all but autocorrelation
e &lt;- eigenw(lw)
x &lt;- apply(x, 2, scale)
st &lt;- apply(x, 2, function(x) shapiro.test(x)$p.value)
x &lt;- x[, (st &gt; 0.2 &amp; st &lt; 0.8)]
x &lt;- apply(x, 2, function(v) residuals(spautolm(v ~ 1, listw=lw,
 method="eigen", control=list(pre_eig=e, fdHess=FALSE))))
x &lt;- apply(x, 2, scale)
}
W &lt;- as(lw, "CsparseMatrix")
system.time(e &lt;- invIrM(nb7rt, rho=0.98, method="solve", feasible=NULL) %*% x)
system.time(ee &lt;- powerWeights(W, rho=0.98, X=x))
str(attr(ee, "internal"))
all.equal(e, as(ee, "matrix"), check.attributes=FALSE)
## Not run: 
system.time(ee &lt;- powerWeights(W, rho=0.9, X=x))
system.time(ee &lt;- powerWeights(W, rho=0.98, order=1000, X=x))
all.equal(e, as(ee, "matrix"), check.attributes=FALSE)
nb60rt &lt;- spdep::cell2nb(60, 60, torus=TRUE)
W &lt;- as(spdep::nb2listw(nb60rt), "CsparseMatrix")
set.seed(1)
x &lt;- matrix(rnorm(dim(W)[1]), ncol=1)
system.time(ee &lt;- powerWeights(W, rho=0.3, X=x))
str(as(ee, "matrix"))
obj &lt;- errorsarlm(as(ee, "matrix")[,1] ~ 1, listw=spdep::nb2listw(nb60rt), method="Matrix")
coefficients(obj)

## End(Not run)
</code></pre>


</div>