<div class="container">

<table style="width: 100%;"><tr>
<td>get_matrix</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Extract matrices from a fit
</h2>

<h3>Description</h3>

<p><code>get_matrix</code> is a first attempt at a unified extractor of various matrices from a fit. All augmented matrices follow (Henderson's) block order (upper blocks: X,Z; lower blocks: 0,I).
<code>get_ZALMatrix</code> returns the design matrix for the random effects <code class="reqn">v</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">get_matrix(object, which="model.matrix", augmented=TRUE, ...)
get_ZALMatrix(object, force_bind=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An object of class <code>HLfit</code>, as returned by the fitting functions in <code>spaMM</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>augmented</code></td>
<td>
<p>Boolean; whether to return a matrix for all model coefficients (augmented matrix for fixed-effects coefficients and random-effect predictions) or a matrix only for fixed effects. Not operative for all <code>which</code> values (currently only for <code>which="left_ginv"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which</code></td>
<td>
<p>Which element to extract. For <code>"model.matrix"</code>, the design matrix for fixed effects (similarly to <code>stats::model.matrix</code>); for <code>"ZAL"</code>, the design matrix for random effects (same as <code>get_ZALMatrix()</code>), while  <code>"ZA"</code> and  <code>"L"</code> may return these two factors (detailed in <code>random-effects</code>); for <code>"AugX"</code>, the (unweighted) augmented design matrix of the least-square problem; for <code>"hat_matrix"</code>, the projection matrix that gives model predictions from the (augmented) response vector; for <code>"left_ginv"</code>, the pseudo-inverse that gives the model coefficients from the (augmented) response vector. See Details for further definitions and options for functions of the augmented design matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>force_bind</code></td>
<td>
<p>Boolean; with the non-default value <code>FALSE</code>, the function may return an object of class <code>ZAXlist</code>, which is poorly documented and for development purposes only. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments that may be needed in some future versions of <code>spaMM</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>(Given the pain that it is to write maths in R documentation files, readers are gently asked to be tolerant about any imperfections of the following).
</p>
<p>Model coefficients estimates of a (weighted) linear model can be written as <b>(X'WX)</b><code class="reqn">^{-1}</code><b>X'Wy</b> where <b>X</b> is the design matrix for fixed effects, <b>W</b> a diagonal weight matrix, and <b>y</b> the response vector. In a linear mixed model, the same expression holds in terms of Henderson's augmented design matrix, of an augmented (still diagonal) weight matrix, and of an augmented response vector. For GLMMs and hierarchical GLMs generally, the solution of each step of the iteratively reweighted least squares algorithm again has the same expression in terms of appropriately defined augmented matrices and vectors.  
</p>
<p><code>get_matrix</code> returns, for given values of the <code>which</code> argument, the following matrices from the model fit:<br><code>"AugX"</code>: <b>X</b>;<br><code>"wei_AugX"</code>: <b>WX</b>;<br><code>"wAugX"</code>: <code class="reqn">\sqrt{}</code>(<b>W</b>)<b>X</b>;<br><code>"left_ginv"</code>: <b>(X'WX)</b><code class="reqn">^{-1}</code><b>X'W</b> (the name stems from the fact that it is generalized inverse, denoted <b>X</b><code class="reqn">^-</code>, since <b>X</b><b>X</b><code class="reqn">^-</code><b>X</b>=<b>X</b>, and it is a left one, since <b>X</b><code class="reqn">^-</code><b>X</b> is an identity matrix when <b>X</b> has full rank);<br><code>"hat_matrix"</code>: <b>XX</b><code class="reqn">^-</code>=<b>X </b><b>(X'WX)</b><code class="reqn">^{-1}</code><b>X'W</b>;<br><code>"fixef_left_ginv"</code>: same as <code>"left_ginv"</code> but for the fixed-effect design matrix only (not to be confused with the corresponding block of <code>"left_ginv"</code>);<br><code>"beta_v_cov"</code>: joint covariance matrix of estimates/predictions of fixed-effect coefficients and random effects (the <b>v</b> in <code>random-effects</code>). 
<code>"v_condcov"</code>: covariance matrix of predictions of random effects (the <b>v</b> in <code>random-effects</code>) given fixed-effect coefficients. 
</p>


<h3>Value</h3>

<p>A matrix, possibly in <code>sparseMatrix</code> format.
</p>


<h3>See Also</h3>

<p><code>vcov</code> for the variance-covariance matrix of the fixed-effects coefficients, and <code>Corr</code> for correlation matrices of random effects.
</p>


</div>