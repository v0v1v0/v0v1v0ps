<div class="container">

<table style="width: 100%;"><tr>
<td>update_PACKAGES</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>update existing package repository</h2>

<h3>Description</h3>

<p>Update an existing repository by reading the PACKAGES
file and only processing built package tarballs which do not
match existing entries.
</p>
<p><code>update_PACKAGES</code> can be much faster than
<code>write_PACKAGES</code> for small-moderate changes to large
repository indexes.
</p>


<h3>Usage</h3>

<pre><code class="language-R">update_PACKAGES(
  dir = ".",
  fields = NULL,
  type = c("source", "mac.binary", "win.binary"),
  verbose = dryrun,
  unpacked = FALSE,
  subdirs = FALSE,
  latestOnly = TRUE,
  addFiles = FALSE,
  strict = TRUE,
  dryrun = FALSE,
  logfun = message,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dir</code></td>
<td>
<p>See <code>write_PACKAGES</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fields</code></td>
<td>
<p>See <code>write_PACKAGES</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>See <code>write_PACKAGES</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Should informative messages be displayed throughout
the proccess. Defaults to the value of <code>dryrun</code> (whose
own default is <code>FALSE</code>) NOT passed to <code>write_PACKAGES</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unpacked</code></td>
<td>
<p>See <code>write_PACKAGES</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subdirs</code></td>
<td>
<p>See <code>write_PACKAGES</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>latestOnly</code></td>
<td>
<p>See <code>write_PACKAGES</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addFiles</code></td>
<td>
<p>See <code>write_PACKAGES</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strict</code></td>
<td>
<p>logical. Should 'strict mode' be used when checking
existing PACKAGES entries. See details. Defaults to
<code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dryrun</code></td>
<td>
<p>logical. Should should the necessary updates be
calculated but NOT applied. (default <code>FALSE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logfun</code></td>
<td>
<p>function. If <code>verbose</code> is <code>TRUE</code>, the
function to be used to emit the informative messages. Defaults
to <code>message</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to <code>write_PACKAGES</code> -  e.g., the relatively new
rds_compress argument.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Throughout this section, <em>package tarball</em> is taken to mean a tarball
file in <code>dir</code> whose name can be interpreted as
<code>&lt;package&gt;_&lt;version&gt;.&lt;ext&gt;</code> (or that is pointed to by the <code>File</code>
field of an existing PACKAGES entry). <em>Novel package tarballs</em> are
those which do not match an existing <code>PACKAGES</code> file entry.
</p>
<p><code>update_PACKAGES</code> avoids (re)processing package tarballs in cases where
a <code>PACKAGES</code> file entry already exists and appears to remain valid. The
logic for detecting still-valid entries is as follows:
</p>
<p>Currently <code>update_PACKAGES</code> calls directly down to
<code>write_PACKAGES</code> (and thus no speedup should be expected)
if any of the following conditions hold:
</p>

<ul>
<li>
<p> No <code>PACKAGES</code> file exists under <code>dir</code>
</p>
</li>
<li> <p><code>unpacked</code> is <code>TRUE</code>
</p>
</li>
<li> <p><code>subdirs</code> is anything other than <code>FALSE</code>
</p>
</li>
<li> <p><code>fields</code> is not <code>NULL</code> and one or more specified fields
are not present in the existing <code>PACKAGES</code> file
</p>
</li>
</ul>
<p>All package tarballs whose last modify times are later than that
of the existing PACKAGES file are considered novel and no attempt
is made to identify or retain any corresponding <code>PACKAGES</code>
entries. Similarly, all <code>PACKAGES</code> entries which have no
corresponding package tarball are definitionally invalid.
</p>
<p>When <code>strict = TRUE</code>, <code>PACKAGES</code> entries which appear to
match a package tarball are confirmed via MD5 checksum; those that
pass are retained as valid. All novel package tarballs are fully
proccessed by the standard <code>write_PACKAGES</code> machinery, and
the resulting entries are added. Finally, if <code>latestOnly =
TRUE</code>, package-version pruning is performed across the entries.
</p>
<p>When <code>strict = FALSE</code>, package tarballs are assumed to encode
correct metadata in their filenames. <code>PACKAGES</code> entries which
appear to match a package tarball are retained as valid (No MD5sum
checking occurs). If <code>latestOnly = TRUE</code>, package-version
pruning across the full set of retained entries and novel package
tarballs <em>before</em> the processing of the novel tarballs, at
significant computational and time savings in some
situations. After the optional pruning, any relevant novel package
tarballs are processed via <code>write_PACKAGES</code> and added to the
set of retained entries.
</p>
<p>After the above process concludes, the final database of
<code>PACKAGES</code> entries is written to all three PACKAGES files,
overwriting the existing files.
</p>


<h3>Value</h3>

<p>Called for its side-effect of updating a package repository index
<code>PACKAGES</code> file and siblings.
</p>


<h3>Note</h3>

<p>While both strict and nonstrict modes offer speedups when
updating small percentages of large repositories, non-strict
mode is <em>much</em> faster and is recommended in situations where the
assumptions it makes are safe.
</p>
<p>For versions of R <code>3.6.0</code> and later, use <code>tools::update_PACKAGES</code>,
which was adapted from this fuction, instead.
</p>


<h3>Author(s)</h3>

<p>Gabriel Becker
</p>


<h3>See Also</h3>

<p>write_PACKAGES
</p>


</div>