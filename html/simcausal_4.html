<div class="container">

<table style="width: 100%;"><tr>
<td>add.action</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Define and Add Actions (Interventions)</h2>

<h3>Description</h3>

<p>Define and add new action (intervention) to the existing DAG object. Use either syntax <code>DAG +</code> <code>action(name = ,nodes = )</code> or <code>add.action((DAG = ,name = ,nodes = )</code>. Both give identical results, see the examples in the vignette and below for details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">add.action(DAG, name, nodes, ..., attr = list())

action(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>DAG</code></td>
<td>
<p>DAG object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>Unique name of the action</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodes</code></td>
<td>
<p>A list of node objects that defines the action on the DAG (replaces the distributions of the corresponding nodes in DAG)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional named attributes defining / indexing the action</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>attr</code></td>
<td>
<p>Additional named attributes defining / indexing the action</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In addition to the action name and list of action nodes, both of these functions accept arbitrary named attributes (as additional arguments which must be given a name).
This additional attributes can be used to simplify specification of dynamic regimes (actions that depend on the past observed covariates).
</p>
<p>The formula of the intervention node is allowed to contain undefined variables, as long as those are later defined as a named argument to <code>action</code>. 
</p>
<p>In Example 2 below, <code>node("A",..., mean = ifelse(W1 &gt;= theta, 1, 0))</code>, 
defines the mean of the node "A" as a function of some undefined variable <code>theta</code>, setting <code>A</code> to 1 if the baseline node <code>W1</code> is above or equal to <code>theta</code> and 0 vice versa.
One specifies actual values of <code>theta</code> while defining a new action, possible creating a series of actions, each indexed by a different value of <code>theta</code>.
A new action can be defined with <code>D&lt;-D+action("A1th0.1", nodes=actN, theta=0.1)</code>.
</p>
<p>Note that any name can be used in place of <code>theta</code>. This attribute variable can appear anywhere inside the node distribution formula.
Finally, the attribute variable can also be time varying and, just like with DAG nodes, can be indexed by square bracket notation, <code>theta[t]</code>. See Example 3 for defining time-varying attributes.
</p>


<h3>Value</h3>

<p>A modified <code>DAG</code> object with the added action
</p>


<h3>Examples</h3>

<pre><code class="language-R">#---------------------------------------------------------------------------------------
# EXAMPLE 1: Showing two equivalent ways of defining an action for a simple DAG
#---------------------------------------------------------------------------------------

D &lt;- DAG.empty()
D &lt;- D + node(name="W1", distr="rbern", prob=plogis(-0.5))
D &lt;- D + node(name="W2", distr="rbern", prob=plogis(-0.5 + 0.5*W1))
D &lt;- D + node(name="A", distr="rbern", prob=plogis(-0.5 + 0.5*W1+ 0.5*W2))
Dset &lt;- set.DAG(D)

# Syntax '+ action': define two actions, intervening on node "A", imputing order
Dset &lt;- Dset + action("A0", nodes=node("A", distr="rbern", prob=0))
Dset &lt;- Dset + action("A1", nodes=node("A", distr="rbern", prob=1))

# Equivalent syntax 'add.action': define two actions, intervening on node "A"
Dset &lt;- add.action(Dset, "A0", nodes=node("A", distr="rbern", prob=0))
Dset &lt;- add.action(Dset, "A1", nodes=node("A", distr="rbern", prob=1))

#---------------------------------------------------------------------------------------
# EXAMPLE 2: Adding named attributes that define (index) the action.
# Define intervention on A that is conditional on W1 crossing some threshold theta
#---------------------------------------------------------------------------------------

# Redefining node W1 as uniform [0,1]
D &lt;- DAG.empty()
D &lt;- D + node(name="W1", distr="runif", min=0, max=1)
D &lt;- D + node(name="W2", distr="rbern", prob=plogis(-0.5 + 0.5*W1))
D &lt;- D + node(name="A", distr="rbern", prob=plogis(-0.5 + 0.5*W1+ 0.5*W2))
Dset &lt;- set.DAG(D)

# Define a node that is indexed by unknown variable theta
actN &lt;- node("A",distr="rbern",prob=ifelse(W1 &gt;= theta,1,0))
# Define 3 actions for theta=0.1, 0.5, 0.9
Dset &lt;- Dset + action("A1th0.1", nodes = actN, theta = 0.1)
Dset &lt;- Dset + action("A1th0.5", nodes = actN, theta = 0.5)
Dset &lt;- Dset + action("A1th0.9", nodes = actN, theta = 0.9)

# Simulate 50 observations per each action above
simfull(A(Dset), n=50)

#---------------------------------------------------------------------------------------
# EXAMPLE 3: Time-varying action attributes for longitudinal DAG
#---------------------------------------------------------------------------------------
# Define longitudinal data structure over 6 time-points t=(0:5) with survival outcome "Y"
t_end &lt;- 5
D &lt;- DAG.empty()
D &lt;- D + node("L2", t=0, distr="rbern", prob=0.05)
D &lt;- D + node("L1", t=0, distr="rbern", prob=ifelse(L2[0]==1,0.5,0.1))
D &lt;- D + node("A1", t=0, distr="rbern", prob=ifelse(L1[0]==1, 0.5, 0.1))
D &lt;- D + node("Y",  t=0, distr="rbern",
                prob=plogis(-6.5 + L1[0] + 4*L2[0] + 0.05*I(L2[0]==0)), EFU=TRUE)
D &lt;- D + node("L2", t=1:t_end, distr="rbern", prob=ifelse(A1[t-1]==1, 0.1, 0.9))
D &lt;- D + node("A1", t=1:t_end, distr="rbern",
              prob=ifelse(A1[t-1]==1, 1, ifelse(L1[0]==1 &amp; L2[0]==0, 0.3, 0.5)))
D &lt;- D + node("Y",  t=1:t_end, distr="rbern", prob=plogis(-6.5+L1[0]+4*L2[t]), EFU=TRUE)
D &lt;- set.DAG(D)

#---------------------------------------------------------------------------------------
# Dynamic actions indexed by constant value of parameter theta={0,1})
#---------------------------------------------------------------------------------------
# Define time-varying node A1: sets A1 to 1 if L2 at t is &gt;= theta
actN_A1 &lt;- node("A1",t=0:t_end, distr="rbern", prob=ifelse(L2[t] &gt;= theta,1,0))

# Define two actions, indexed by fixed values of theta={0,1}
D_act &lt;- D + action("A1_th0", nodes=actN_A1, theta=0)
D_act &lt;- D_act + action("A1_th1", nodes=actN_A1, theta=1)

# Simulate 50 observations for per each action above
simfull(simcausal::A(D_act), n=50)

#---------------------------------------------------------------------------------------
# Dynamic actions indexed by time-varying parameter theta[t]
#---------------------------------------------------------------------------------------
# This defines an action node with threshold theta varying in time (note syntax theta[t])
actN_A1 &lt;- node("A1",t=0:t_end, distr="rbern", prob=ifelse(L2[t] &gt;= theta[t],1,0))

# Now define 3 actions that are indexed by various values of theta over time
D_act &lt;- D + action("A1_th_const0", nodes=actN_A1, theta=rep(0,(t_end+1)))
D_act &lt;- D_act + action("A1_th_var1", nodes=actN_A1, theta=c(0,0,0,1,1,1))
D_act &lt;- D_act + action("A1_th_var2", nodes=actN_A1, theta=c(0,1,1,1,1,1))

# Simulate 50 observations for per each action above
simfull(simcausal::A(D_act), n=50)
</code></pre>


</div>