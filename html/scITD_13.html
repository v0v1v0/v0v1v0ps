<div class="container">

<table style="width: 100%;"><tr>
<td>form_tensor</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Form the pseudobulk tensor as preparation for running the tensor decomposition.</h2>

<h3>Description</h3>

<p>Form the pseudobulk tensor as preparation for running the tensor decomposition.
</p>


<h3>Usage</h3>

<pre><code class="language-R">form_tensor(
  container,
  donor_min_cells = 5,
  norm_method = "trim",
  scale_factor = 10000,
  vargenes_method = "norm_var",
  vargenes_thresh = 500,
  batch_var = NULL,
  scale_var = TRUE,
  var_scale_power = 0.5,
  custom_genes = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>container</code></td>
<td>
<p>environment Project container that stores sub-containers
for each cell type as well as results and plots from all analyses</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>donor_min_cells</code></td>
<td>
<p>numeric Minimum threshold for number of cells per
donor (default=5)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>norm_method</code></td>
<td>
<p>character The normalization method to use on the pseudobulked
count data. Set to 'regular' to do standard normalization of dividing by
library size. Set to 'trim' to use edgeR trim-mean normalization, whereby counts
are divided by library size times a normalization factor. (default='trim')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale_factor</code></td>
<td>
<p>numeric The number that gets multiplied by fractional counts
during normalization of the pseudobulked data (default=10000)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vargenes_method</code></td>
<td>
<p>character The method by which to select highly variable
genes from each cell type. Set to 'anova' to select genes by anova. Set to
'norm_var' to select the top genes by normalized variance or 'norm_var_pvals'
to select genes by significance of their overdispersion (default='norm_var')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vargenes_thresh</code></td>
<td>
<p>numeric The threshold to use in variable gene selection.
For 'anova' and 'norm_var_pvals' this should be a p-value threshold. For 'norm_var' this
should be the number of most variably expressed genes to select from each cell
type (default=500)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batch_var</code></td>
<td>
<p>character A batch variable from metadata to remove (default=NULL)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale_var</code></td>
<td>
<p>logical TRUE to scale the gene expression variance across donors
for each cell type. If FALSE then all genes are scaled to unit variance across
donors for each cell type. (default=TRUE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var_scale_power</code></td>
<td>
<p>numeric Exponent of normalized variance that is
used for variance scaling. Variance for each gene
is initially set to unit variance across donors (for a given cell type).
Variance for each gene is then scaled by multiplying the unit scaled values
by each gene's normalized variance (where the effect of the mean-variance
dependence is taken into account) to the exponent specified here.
If NULL, uses var_scale_power from container$experiment_params. (default=.5)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>custom_genes</code></td>
<td>
<p>character A vector of genes to include in the tensor.
Overrides the default gene selection if not NULL. (default=NULL)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical Set to TRUE to print out progress (default=TRUE)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The project container with a list of tensor data added in the
container$tensor_data slot.
</p>


<h3>Examples</h3>

<pre><code class="language-R">test_container &lt;- form_tensor(test_container, donor_min_cells=0,
norm_method='trim', scale_factor=10000, vargenes_method='norm_var', vargenes_thresh=500,
scale_var = TRUE, var_scale_power = 1.5)
</code></pre>


</div>