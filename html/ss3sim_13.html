<div class="container">

<table style="width: 100%;"><tr>
<td>change_data</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Change the data that is available as output from an SS operating model.</h2>

<h3>Description</h3>

<p><code>change_data</code> alters the data structure for a data list as read in by
<code>SS_readdat</code>, for use in preparing the data file for an SS
operating model. Original data is removed and dummy data is added, as
specified, to the SS <code>.dat</code> file. This causes SS to produce expected
values (OM "truth") when the operating model is run, from which data can be
sampled.  For each data type altered, <code>change_data</code> will add data for
the fleets and years given; potentially adding many rows of redundant data.
Currently, <code>.dat</code> files with multiple sexes cannot be manipulated with
<code>change_data</code>. <code>calculate_data_units</code> is used internally in
<code>ss3sim_base</code> to create a superset of fleets and years from
sample arguments, and <code>clean_data</code> to strip out unused data after
<code>change_data</code> is called (see examples below). <code>change_data</code> is
called internally automatically, but can also be used by an <span class="pkg">ss3sim</span> user
to manipulate data as a case, or to prepare a new OM for use in a simulation.
See the vignette for more details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">change_data(dat_list, outfile = NULL, fleets, years, types,
  age_bins = NULL, len_bins = NULL, pop_binwidth = NULL,
  pop_minimum_size = NULL, pop_maximum_size = NULL,
  lcomp_constant = NULL, tail_compression = NULL, nsex = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dat_list</code></td>
<td>
<p>An SS data list object as read in from
<code>SS_readdat</code> in the <span class="pkg">r4ss</span> package. Make sure
you select option <code>section=2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outfile</code></td>
<td>
<p>A character string specifying the file name to use
when writing the information to the disk. The string must include
the proper file extension. No file is written using the default value
of <code>NULL</code>, which leads to increased speed because writing the 
file takes time and computing resources.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fleets</code></td>
<td>
<p>A numeric vector of fleets</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>years</code></td>
<td>
<p>A numeric vector of years</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>types</code></td>
<td>
<p>A vector that can take combinations of the following entries:
<code>"index"</code>, <code>"len"</code>, <code>"age"</code>, <code>"cal"</code>, <code>"mla"</code>.
<code>types</code> controls what data structures the function acts on, with
<code>"index"</code> changing indices/CPUE, <code>"len"</code> augmenting the length
composition data, <code>"age"</code> augmenting the age composition, <code>"cal"</code>
augmenting the conditional age at length, and <code>"mla"</code> augmenting the
mean length at age data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>age_bins</code></td>
<td>
<p>*A numeric vector of age bins to use. If left as <code>NULL</code>
then the age bin structure will be taken from the OM.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>len_bins</code></td>
<td>
<p>*A numeric vector of length bins to use. If left as
<code>NULL</code> then the length bin structure will be taken from the OM.
For conditional age-at-length (CAAL) data, the last value provided to
<code>len_bins</code> will be used for Lbin_lo and -1 will be used for Lbin_hi
for the largest length bin category, i.e., row of CAAL data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop_binwidth</code></td>
<td>
<p>*Population length bin width. Note that this value must
be smaller than the bin width specified in length composition data
<code>len_bins</code> or SS will fail (see notes in the SS manual).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop_minimum_size</code></td>
<td>
<p>*Population minimum length bin value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop_maximum_size</code></td>
<td>
<p>*Population maximum length bin value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lcomp_constant</code></td>
<td>
<p>*A new robustification constant for length composition
data to be used. Must be a numeric value, as a proportion. For example 0.1
means 10 percent. See the SS manual for further information. A <code>NULL</code>
value indicates no action resulting in using the current value, and a value
of 0 will throw an error since that leads to an error when zeroes exist in
the data. Instead use a very small value like <code>1e-07</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tail_compression</code></td>
<td>
<p>*A new tail compression value to be used in SS. Must
be a numeric value, as a proportion. For example 0.1 means 10 percent. See
the SS manual for further information. A <code>NULL</code> value indicates no
action, a negative value indicates to SS to ignore it (not use that
feature).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsex</code></td>
<td>
<p>An integer value of 1 or 2 specifying the number of sexes in the
model. If 1, then females are the only included sex. This information can be
found in the data file for a given model and dictates how the composition
data are structured.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The robustification constant is added to both the observed and
expected proportions of length composition data, before being normalized
internally. It is designed to help stabilize the model, but is unclear how
and when to use it for optimal effect. The same value is used for all
length data.
</p>


<h3>Value</h3>

<p>An invisible data list, and a file is written to the disk if an
entry other than <code>NULL</code> is provided for <code>outfile</code>.
</p>


<h3>Which arguments to specifiy in case files</h3>

<p>All function argument descriptions that start with an asterisk (*) will be passed
through the case files to <code>run_ss3sim</code>. If one of these arguments
is not specified in a case file, then a value of <code>NULL</code> will be passed,
which may or may not be an appropriate value. Other arguments will be ignored
if specified.
</p>


<h3>Author(s)</h3>

<p>Cole Monnahan, Ian Taylor, Sean Anderson, Kelli Johnson
</p>


<h3>See Also</h3>

<p><code>sample_lcomp</code>, <code>sample_agecomp</code>
</p>
<p>Other change functions: <code>change_em_binning</code>,
<code>change_e</code>, <code>change_f_par</code>,
<code>change_f</code>, <code>change_o</code>,
<code>change_retro</code>, <code>change_tv</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">d &lt;- system.file("extdata", package = "ss3sim")
fleets &lt;- 1:2
years &lt;- c(5, 10, 15)
types &lt;- c("len", "age")
file_in &lt;- r4ss::SS_readdat(file.path(d, "models", "cod-om", "codOM.dat"),
  version = NULL, verbose = FALSE)

# Basic test with just length data, default bins:
out &lt;- change_data(file_in, outfile = NULL, types = "len",
  years = years, fleets = fleets)
print(out$lbin_vector)
print(out$lencomp)

# Change the length bins:
out &lt;- change_data(file_in, outfile = NULL, types = "len",
  years = years, fleets = fleets, len_bins = 3:6)
out$lbin_vector
out$lencomp

# Change the population length bins:
out &lt;- change_data(file_in, outfile = NULL, types = "len",
  years = years, fleets = fleets, pop_binwidth = 1, pop_minimum_size = 5,
  pop_maximum_size = 210)
out$binwidth
out$maximum_size
out$minimum_size
</code></pre>


</div>