<div class="container">

<table style="width: 100%;"><tr>
<td>gxeVarComp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Mixed model analysis of GxE table of means</h2>

<h3>Description</h3>

<p>This function fits a mixed model best fitting to the data in a TD object.
The exact model fitted is determined by both the structure of the genotype by
environment table of observations and the chosen parameters.<br><br>
Six different types of models can be fitted depending on the structure of
the environments in the data. These models are described in the table below,
together with the function parameters used in <code>gxeVarComp</code> to fit the model.</p>

<table>
<tr>
<td style="text-align: left;">
   Structure of environments </td>
<td style="text-align: left;"> Model </td>
<td style="text-align: left;"> Function parameters </td>
</tr>
<tr>
<td style="text-align: left;">
   Environments correspond to trials </td>
<td style="text-align: left;"> <strong>trait</strong> = trial + <strong>genotype + genotype:trial</strong> </td>
<td style="text-align: left;">  </td>
</tr>
<tr>
<td style="text-align: left;">
   Trials form a factorial structure of locations x years </td>
<td style="text-align: left;"> <strong>trait</strong> = year + location + year:location + <strong>genotype + genotype:year + genotype:location + genotype:year:location</strong> </td>
<td style="text-align: left;"> <code>locationYear = TRUE</code> </td>
</tr>
<tr>
<td style="text-align: left;">
   Trials are nested within year </td>
<td style="text-align: left;"> <strong>trait</strong> = year + year:trial + <strong>genotype + genotype:year + genotype:year:trial</strong> </td>
<td style="text-align: left;"> <code>nestingFactor = "year"</code> </td>
</tr>
<tr>
<td style="text-align: left;">
   Trials are nested within locations </td>
<td style="text-align: left;"> <strong>trait</strong> = location + location:trial + <strong>genotype + genotype:location + genotype:location:trial</strong> </td>
<td style="text-align: left;"> <code>nestingFactor = "loc"</code> </td>
</tr>
<tr>
<td style="text-align: left;">
   Trials correspond to locations within regions across years </td>
<td style="text-align: left;"> <strong>trait</strong> = region + region:location + year + region:year + region:location:year + <strong>genotype + genotype:region + genotype:region:location + genotype:year + genotype:region:year + genotype:region:location:year</strong> </td>
<td style="text-align: left;"> <code>regionLocationYear = TRUE</code> </td>
</tr>
<tr>
<td style="text-align: left;">
   Trials are nested within scenarios </td>
<td style="text-align: left;"> <strong>trait</strong> = scenario + scenario:trial + <strong>genotype + genotype:scenario + genotype:scenario:trial</strong> </td>
<td style="text-align: left;"> <code>nestingFactor = "scenario"</code> </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>In the models above the random part of the model is printed bold.<br>
For data in the form of GxE means, the last random term in all models above
will become a residual term. If the GxE means are provided together with
weights, then a residual term will be added to the models above.<br><br>
The function first fits a model where all model terms are included as fixed
terms. Based on the ANOVA table of this model, terms in the fixed part of the
model that are likely to give a problem when fitting the mixed model are
removed because of the reduced connectivity and number of available
observations to estimate that model term. Also a warning is printed if the
mean sum of squares for a model term points to a possible zero variance
component in the mixed model.<br><br>
Then a model is fitted where all model terms are included as random terms.
Based on the variance components in this model the percentage of variance
explained by each of the model components is determined. The percentages of
variance are printed in the model summary, together with the variance
components. The latter are presented on a standard deviation scale.<br><br>
Finally a mixed model is fitted as specified in the overview above. Based on
this mixed model variance components can be computed using <code>vc</code>,
heritabilies can be computed using <code>herit</code> and predictions can be
made using <code>predict.varComp</code>. Predictions of genotypic
performance can be made at the level of individual trials, or for groups of
trials by using <code>predictLevel</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gxeVarComp(
  TD,
  trials = names(TD),
  trait,
  engine = c("lme4", "asreml"),
  locationYear = FALSE,
  nestingFactor = NULL,
  regionLocationYear = FALSE,
  useWt = FALSE,
  diagnostics = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>TD</code></td>
<td>
<p>An object of class <code>TD</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trials</code></td>
<td>
<p>A character string specifying the trials to be analyzed. If
not supplied, all trials are used in the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trait</code></td>
<td>
<p>A character string specifying the trait to be analyzed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>engine</code></td>
<td>
<p>A character string specifying the engine used for modeling.
Either "lme4" or "asreml".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locationYear</code></td>
<td>
<p>Should a model be fitted assuming a factorial structure
of locations x years?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nestingFactor</code></td>
<td>
<p>A character string specifying a column in TD specifying
the nesting structure of the trials.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regionLocationYear</code></td>
<td>
<p>Should a model be fitted assuming locations within
regions across years?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useWt</code></td>
<td>
<p>Should the model be fitted using weights? Doing so requires a
column wt in the data. If <code>useWt = FALSE</code>, the default, and the data
contains no replicates, the last model term will be dropped and used as
homogeneous residual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diagnostics</code></td>
<td>
<p>Should diagnostics on missing combinations of model
variables be printed?</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>varComp</code>, a list containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>fitMod</code></td>
<td>
<p>The fitted model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modDat</code></td>
<td>
<p>A data.frame containing the data used when fitting the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nestingFactor</code></td>
<td>
<p>A name of the variable used as nesting variable in the
model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useLocYear</code></td>
<td>
<p>A boolean specifying if a model containing location x year
interaction was fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fullRandVC</code></td>
<td>
<p>A data.frame containing the variance components for the
fully random model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aovFullMixedMod</code></td>
<td>
<p>A data.frame containing the ANOVA table for the fully
fixed model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>engine</code></td>
<td>
<p>The engine used for fitting the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diagTabs</code></td>
<td>
<p>A list of data.frame, one for each random model term,
containing the missing combinations in the data for that term.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p>Other Mixed model analysis: 
<code>CRDR()</code>,
<code>correlations()</code>,
<code>diagnostics()</code>,
<code>herit()</code>,
<code>plot.varComp()</code>,
<code>predict.varComp()</code>,
<code>vc()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Fit a mixed model.
geVarComp &lt;- gxeVarComp(TD = TDMaize, trait = "yld")

## Summarize results.
summary(geVarComp)

## Plot the standard deviations.
plot(geVarComp)

## Generate predictions
pred &lt;- predict(geVarComp, predictLevel = "trial")
head(pred)

</code></pre>


</div>