<div class="container">

<table style="width: 100%;"><tr>
<td>lpm2_kdtree</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Local Pivotal Method 
</h2>

<h3>Description</h3>

<p>The local pivotal method provides a way to perform balanced sampling.  This
implementation replace linear searches in lpm2, with k-d trees.  K-d trees
are binary trees used to effectively search high dimensional spaces, and 
reduce the average computational complexity of lpm2 from O(N^2) to 
O(N log(N)).  Both nearest neighbor and approximate nearest neighbor 
searching algorithms are provided.
</p>


<h3>Usage</h3>

<pre><code class="language-R">
  lpm2_kdtree(
     prob,
     x, 
     m=40,
     algorithm = "kdtree", 
     maxCheck = 4,
     termDist = 0.1,
     inOrder = FALSE,
     resample = 1,
     probTree = FALSE,
     returnTree = FALSE,
     returnBounds = FALSE
     ) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>prob</code></td>
<td>

<p>An array of length N such that the sum of prob is equal to the sample size,
where the N is the number of rows of <code>x</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>A matrix of N rows and p columns, each row is assumed to be a sampling unit. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>

<p>Max leaf size used as a terminal condition for building the k-d tree. When
probTree is <code>FALSE</code>, <code>m</code> is the number of rows of <code>x</code> held within
each leaf node.  When probTree is <code>TRUE</code>, <code>m</code> is the sum of the
probability held within each node.  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>algorithm</code></td>
<td>

<p>The algorithm used to search the k-d tree.  The algorithms include "kdtree",
"kdtree-count", and "kdtree-dist".  The "kdtree" algorithm reproduces the
lpm2 using a k-d tree for nearest neighbor search.  "kdtree-count" and 
"kdtree-dist" use approximate nearest neighor searches based on number of
nodes to check and minimal sufficient distance respectfully.  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxCheck</code></td>
<td>

<p>A positive integer scalar parameter only used when the algorithm "kdtree-count"
is specified.  This parameter is the maximum number of non-empty leaf nodes 
to check for a nearest neighbor.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>termDist</code></td>
<td>

<p>A positive valued scalar parameter only used when the algorithm "kdtree-dist"
is specified.  This parameter specifies a minimal sufficient distance to be 
considered a nearest neighbor.  No tie handling is performed; the first 
nearest neighbor found will be used. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inOrder</code></td>
<td>

<p>A boolean value, <code>TRUE</code> will return results in order of selection.
<code>FALSE</code> will return in order of index.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resample</code></td>
<td>

<p>The number of samples to return. Resampling builds the k-d tree exactly once
for all samples.  Each sample will be a distinct column in a matrix.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probTree</code></td>
<td>

<p>A boolean value, <code>TRUE</code> will split the k-d tree based on the weighted
median, using the values in <code>prob</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnTree</code></td>
<td>

<p>A boolean value, <code>TRUE</code> will return the node assigment.  This assignment
will be appended to a returned list.. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnBounds</code></td>
<td>

<p>A boolean value, <code>TRUE</code> will return the bounds for each node assigment.  
These bounds will be appended to a returned list. 
</p>
</td>
</tr>
</table>
<h3>Value</h3>

 
<p>A vector of selected indexes from the matrix x. If using default values for <code>inOrder</code>, 
<code>resample</code>, and <code>algorithm</code>, the results identical to the lpm2 function when no 
ties exist in the distance function exist.  <code>inOrder=TRUE</code> will return results in order 
of selection, and <code>resample &gt; 1</code> will return a matrix with each set of samples returned
as a column vector.  
</p>
<p>A list is returned includiing this vector if returnTree or returnBounds is set to TRUE.
</p>


<h3>Author(s)</h3>

<p>Jonathan Lisic
</p>


<h3>References</h3>

<p>Lisic, L. and Cruze, N. (2016). Local Pivotal Methods for Large Surveys. In 
proceedings, ICES V, Geneva Switzerland 2016. 
</p>


<h3>Examples</h3>

<pre><code class="language-R">

N &lt;- 1000
n &lt;- 100
x &lt;- cbind( runif(N), runif(N)) 

set.seed(100)
Cprog &lt;- proc.time()
sampled &lt;- lpm2_kdtree( rep(n/N,N), x)
print("lpm2_kdtree running time")
print(proc.time() - Cprog) 

</code></pre>


</div>