<div class="container">

<table style="width: 100%;"><tr>
<td>bayes_cluster</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian Cluster Detection Method</h2>

<h3>Description</h3>

<p>Implementation of the Bayesian Cluster detection model of Wakefield and Kim (2013) for a study region with <code>n</code> areas. The prior and posterior probabilities of each of the <code>n.zones</code> single zones being a cluster/anti-cluster are estimated using Markov chain Monte Carlo. Furthermore, the posterior probability of k clusters/anti-clusters is computed.
</p>


<h3>Usage</h3>

<pre><code class="language-R">bayes_cluster(
  y,
  E,
  population,
  sp.obj,
  centroids,
  max.prop,
  shape,
  rate,
  J,
  pi0,
  n.sim.lambda,
  n.sim.prior,
  n.sim.post,
  burnin.prop = 0.1,
  theta.init = vector(mode = "numeric", length = 0)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>vector of length <code>n</code> of the observed number of disease in each area</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p>vector of length <code>n</code> of the expected number of disease in each area</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>population</code></td>
<td>
<p>vector of length <code>n</code> of the population in each area</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sp.obj</code></td>
<td>
<p>an object of class SpatialPolygons</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>centroids</code></td>
<td>
<p><code style="white-space: pre;">⁠n x 2⁠</code> table of the (x,y)-coordinates of the area centroids.  The coordinate system must be grid-based</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.prop</code></td>
<td>
<p>maximum proportion of the study region's population each single zone can contain</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape</code></td>
<td>
<p>vector of length 2 of narrow/wide shape parameter for gamma prior on relative risk</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate</code></td>
<td>
<p>vector of length 2 of narrow/wide rate parameter for gamma prior on relative risk</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>J</code></td>
<td>
<p>maximum number of clusters/anti-clusters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi0</code></td>
<td>
<p>prior probability of no clusters/anti-clusters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.sim.lambda</code></td>
<td>
<p>number of importance sampling iterations to estimate lambda</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.sim.prior</code></td>
<td>
<p>number of MCMC iterations to estimate prior probabilities associated with each single zone</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.sim.post</code></td>
<td>
<p>number of MCMC iterations to estimate posterior probabilities associated with each single zone</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burnin.prop</code></td>
<td>
<p>proportion of MCMC samples to use as burn-in</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta.init</code></td>
<td>
<p>Initial configuration used for MCMC sampling</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>List containing
return(list(
prior.map=prior.map,
post.map=post.map,
pk.y=pk.y))
</p>
<table>
<tr style="vertical-align: top;">
<td><code>prior.map</code></td>
<td>
<p>A list containing, for each area: 1) <code>high.area</code> the prior probability of cluster membership, 2) <code>low.area</code> anti-cluster membership, and 3) <code>RR.est.area</code> smoothed prior estimates of relative risk</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>post.map</code></td>
<td>
<p>A list containing, for each area: 1) <code>high.area</code> the posterior probability of cluster membership, 2) <code>low.area</code> anti-cluster membership, and 3) <code>RR.est.area</code> smoothed posterior estimates of the relative risk</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pk.y</code></td>
<td>
<p>posterior probability of k clusters/anti-clusters given y for k=0,...,J</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Albert Y. Kim
</p>


<h3>References</h3>

<p>Wakefield J. and Kim A.Y. (2013) A Bayesian model for cluster detection.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Note for the NYleukemia example, 4 census tracts were completely surrounded 
## by another unique census tract; when applying the Bayesian cluster detection 
## model in [bayes_cluster()], we merge them with the surrounding 
## census tracts yielding `n=277` areas.

## Load data and convert coordinate system from latitude/longitude to grid
data(NYleukemia)
sp.obj &lt;- NYleukemia$spatial.polygon
population &lt;- NYleukemia$data$population
cases &lt;- NYleukemia$data$cases
centroids &lt;- latlong2grid(NYleukemia$geo[, 2:3])

## Identify the 4 census tract to be merged into their surrounding census tracts 
remove &lt;- NYleukemia$surrounded
add &lt;- NYleukemia$surrounding

## Merge population and case counts and geographical objects accordingly
population[add] &lt;- population[add] + population[remove]
population &lt;- population[-remove]
cases[add] &lt;- cases[add] + cases[remove]
cases &lt;- cases[-remove]
sp.obj &lt;-
  SpatialPolygons(sp.obj@polygons[-remove], proj4string=CRS("+proj=longlat +ellps=WGS84"))
centroids &lt;- centroids[-remove, ]

## Set parameters
y &lt;- cases
E &lt;- expected(population, cases, 1)
max.prop &lt;- 0.15
shape &lt;- c(2976.3, 2.31)
rate &lt;- c(2977.3, 1.31)
J &lt;- 7
pi0 &lt;- 0.95
n.sim.lambda &lt;- 10^4
n.sim.prior &lt;- 10^5
n.sim.post &lt;- 10^5

## (Uncomment first) Compute output
#output &lt;- bayes_cluster(y, E, population, sp.obj, centroids, max.prop, 
#  shape, rate, J, pi0, n.sim.lambda, n.sim.prior, n.sim.post)
#plotmap(output$prior.map$high.area, sp.obj)
#plotmap(output$post.map$high.area, sp.obj)
#plotmap(output$post.map$RR.est.area, sp.obj, log=TRUE)
#barplot(output$pk.y, names.arg=0:J, xlab="k", ylab="P(k|y)")    
</code></pre>


</div>