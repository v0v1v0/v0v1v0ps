<div class="container">

<table style="width: 100%;"><tr>
<td>Sequential-package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Analysis Support, Critical Values, Power, Time to Signal and Sample Size for Sequential Analysis with Poisson and Binomial Data.</h2>

<h3>Description</h3>

<p><code>Sequential</code> is designed for continuous and group sequential analysis, where statistical hypothesis testing is conducted repeatedly
on accumulating data that gradually increases the sample size. This is different from standard statistical analysis, where a single analysis is performed
using a fixed sample size. It is possible to analyze either Poisson type data or binomial 0/1 type data. For binomial data, it is possible to incorporate an
off-set term to account for variable matching ratios. For Poisson data, the critical value is based on a Wald-type upper boundary, which is flat on the scale
of the log-likelihood ratio, and on a predetermined maximum sample size. Alternatively, it is also possible to apply a user defined alpha spending function
in order to specify non-flat signaling thresholds. For group sequential analyses, there are functions for pre-specified group sizes and for the situation when
the group sizes are not known a priori. It is also possible to perform mixed continuous/group sequential analysis, where, for example, there is at first a big
batch of data that arrives in one group, followed by continuous sequential analysis. All results are exact, based on iterative numerical calculations, rather
than asymptotic theory or computer simulations. In the <code>Sequential</code> package, there are functions to calculate critical values, statistical power,
expected time to signal, and expected sample size at the end of the sequential analyses whether the null hypothesis was rejected or not.
For example, for any desired power, relative risk and alpha level, the package can calculate the required upper limit on the sample size (maximum length of surveillance),
the critical value needed, and the corresponding expected time to signal when the null hypothesis is rejected.</p>


<h3>Details</h3>


<table>
<tr>
<td style="text-align: left;">
Package: </td>
<td style="text-align: left;"> Sequential</td>
</tr>
<tr>
<td style="text-align: left;">
Type: </td>
<td style="text-align: left;"> Package</td>
</tr>
<tr>
<td style="text-align: left;">
Version: </td>
<td style="text-align: left;"> 4.3.3</td>
</tr>
<tr>
<td style="text-align: left;">
Date: </td>
<td style="text-align: left;"> 2024-02-20</td>
</tr>
<tr>
<td style="text-align: left;">
License: </td>
<td style="text-align: left;"> GPL 2</td>
</tr>
<tr>
<td style="text-align: left;">
LazyLoad: </td>
<td style="text-align: left;"> yes</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
Index: </td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>Performance.Threshold.Binomial</code> </td>
<td style="text-align: left;"> Power, Expected Time to Signal, Expected</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Sample Size and Alpha Spending for User Defined Threshold</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> with Binomial Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Performance.Threshold.CondPoisson</code> </td>
<td style="text-align: left;"> Power, Expected Time to Signal, Expected</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Sample Size and Alpha Spending for User Defined Threshold</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> with Conditional Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Performance.Threshold.Poisson</code> </td>
<td style="text-align: left;"> Power, Expected Time to Signal, Expected</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Sample Size and Alpha Spending for User Defined Threshold</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> with Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Analyze.Binomial</code> </td>
<td style="text-align: left;"> Function to Conduct Group Sequential Analyses for Binomial</td>
</tr>
<tr>
<td style="text-align: left;">
                                           </td>
<td style="text-align: left;"> Data When the Goup Sizes are not Known a Priori.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>AnalyzeSetUp.Binomial</code> </td>
<td style="text-align: left;"> Function to Set Up the Input Parameters Before Using the</td>
</tr>
<tr>
<td style="text-align: left;">
                                                </td>
<td style="text-align: left;"> <code>Analyze.Binomial</code> Function for the First Time.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Analyze.wBinomial</code> </td>
<td style="text-align: left;"> Function for group sequential analyses of multiple</td>
</tr>
<tr>
<td style="text-align: left;">
                                           </td>
<td style="text-align: left;"> weighted binomial endpoints.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>AnalyzeSetUp.wBinomial</code> </td>
<td style="text-align: left;"> Function to set up input parameters before using the</td>
</tr>
<tr>
<td style="text-align: left;">
                                                </td>
<td style="text-align: left;"> <code>Analyze.wBinomial</code> function for the first time.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Analyze.Poisson</code> </td>
<td style="text-align: left;"> Function to Conduct Group Sequential Analyses for Poisson</td>
</tr>
<tr>
<td style="text-align: left;">
                                           </td>
<td style="text-align: left;"> Data When the Goup Sizes are not Known a Priori.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>AnalyzeSetUp.Poisson</code> </td>
<td style="text-align: left;"> Function to Set Up the Input Parameters Before Using the</td>
</tr>
<tr>
<td style="text-align: left;">
                                                </td>
<td style="text-align: left;"> <code>Analyze.Poisson</code> Function for the First Time.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Analyze.CondPoisson</code> </td>
<td style="text-align: left;"> Function to Conduct Group Sequential Analyses for Conditional</td>
</tr>
<tr>
<td style="text-align: left;">
                                           </td>
<td style="text-align: left;"> Poisson Data When the Goup Sizes are not Known a Priori.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>AnalyzeSetUp.CondPoisson</code> </td>
<td style="text-align: left;"> Function to Set Up the Input Parameters Before Using the</td>
</tr>
<tr>
<td style="text-align: left;">
                                                </td>
<td style="text-align: left;"> <code>Analyze.CondPoisson</code> Function for the First Time.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>ConfidenceInterval.Binomial</code> </td>
<td style="text-align: left;"> Confidence interval for the relative risk following</td>
</tr>
<tr>
<td style="text-align: left;">
                                                      </td>
<td style="text-align: left;"> a sequential test with binomial data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>CV.Binomial</code> </td>
<td style="text-align: left;"> Critical Values for Group and Continuous Sequential</td>
</tr>
<tr>
<td style="text-align: left;">
                                     </td>
<td style="text-align: left;"> Analysis with Binomial Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>CV.Poisson</code> </td>
<td style="text-align: left;"> Critical Values for Group and Continuous Sequential</td>
</tr>
<tr>
<td style="text-align: left;">
                                     </td>
<td style="text-align: left;"> Analysis with Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>CV.CondPoisson</code> </td>
<td style="text-align: left;"> Critical Values for Continuous Sequential CMaxSPRT for</td>
</tr>
<tr>
<td style="text-align: left;">
                                     </td>
<td style="text-align: left;"> Limited Information from Historical Cohort Using</td>
</tr>
<tr>
<td style="text-align: left;">
                                     </td>
<td style="text-align: left;"> Conditional Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Optimal.Binomial</code> </td>
<td style="text-align: left;"> Optimal alpha spending for continuous and group sequential</td>
</tr>
<tr>
<td style="text-align: left;">
                                     </td>
<td style="text-align: left;"> analysis with binomial data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Performance.Binomial</code>  </td>
<td style="text-align: left;"> Power, Expected Time to Signal and Expected Sample Size</td>
</tr>
<tr>
<td style="text-align: left;">
                                               </td>
<td style="text-align: left;"> for Group and Continuous Sequential Analysis with</td>
</tr>
<tr>
<td style="text-align: left;">
                                               </td>
<td style="text-align: left;"> Binomial Data.</td>
</tr>
<tr>
<td style="text-align: left;"> 
<code>Performance.Poisson</code>  </td>
<td style="text-align: left;"> Power, Expected Time to Signal and Expected Sample Size</td>
</tr>
<tr>
<td style="text-align: left;">
                                               </td>
<td style="text-align: left;"> for Continuous Sequential Analysis with</td>
</tr>
<tr>
<td style="text-align: left;"> 
                                                </td>
<td style="text-align: left;"> Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Performance.CondPoisson</code>  </td>
<td style="text-align: left;"> Power, Expected Time to Signal and Expected Sample</td>
</tr>
<tr>
<td style="text-align: left;">
                                               </td>
<td style="text-align: left;"> Size for Continuous Sequential CMaxSPRT Using</td>
</tr>
<tr>
<td style="text-align: left;"> 
                                                </td>
<td style="text-align: left;"> Limited Information from Historical Cohort</td>
</tr>
<tr>
<td style="text-align: left;">
                                                 </td>
<td style="text-align: left;"> with Conditional Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>SampleSize.Binomial</code>  </td>
<td style="text-align: left;"> Sample Size Calculation for Continuous Sequential Analysis with</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Binomial Data.</td>
</tr>
<tr>
<td style="text-align: left;">                              
<code>SampleSize.Poisson</code>  </td>
<td style="text-align: left;"> Sample Size Calculation for Continuous Sequential Testing with</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>SampleSize.CondPoisson</code>  </td>
<td style="text-align: left;"> Sample Size Calculation for Continuous Sequential CMaxSPRT with</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Performance.AlphaSpend.Binomial</code> </td>
<td style="text-align: left;"> Power, Expected Time to Signal, Expected</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Sample Size and Threshold for User Defined Alpha Spending </td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> with Binomial Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Performance.AlphaSpend.CondPoisson</code> </td>
<td style="text-align: left;"> Power, Expected Time to Signal, Expected</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Sample Size and Threshold for User Defined</td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Alpha Spending with Conditional Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
<code>Performance.AlphaSpend.Poisson</code> </td>
<td style="text-align: left;"> Power, Expected Time to Signal, Expected</td>
</tr>
<tr>
<td style="text-align: left;">
                                            </td>
<td style="text-align: left;"> Sample Size and Threshold for User Defined </td>
</tr>
<tr>
<td style="text-align: left;">
                                              </td>
<td style="text-align: left;"> Alpha Spending with Poisson Data.</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>Overview</h3>

<p>Most of the sequential analysis methods found in the literature are based on asymptotic results. In contrast,
this package contains functions for the exact calculation of critical values, statistical power, expected time
to signal when the null is rejected and the maximum sample size needed when the null is not rejected. This is done for
Poisson and binomial type data with a Wald-type upper boundary, which is flat with respect to the likelihood ratio function,
and a predetermined upper limit on the sample size. For a desired statistical power, it is also possible to calculate the latter.
The motivation for this package is post-market near real-time drug and vaccine safety surveillance, where the goal is to detect rare
but serious safety problems as early as possible, in many cases after only a hand full of adverse events. The package can also be used
in other application areas, such as clinical trials.
</p>
<p>A tutorial paper by Silva et al. (2021) explains the main features of the package up to version 3.3.1, where sequential test designing and
real data analyses are dicussed in more details. 
</p>
<p>The basis for this package is the Maximized Sequential Probability Ratio Test (MaxSPRT) statistic (Kulldorff et al., 2011), which is a variant of
Wald's Sequential Probability Ratio Test (SPRT) (Wald, 1945,47). MaxSPRT uses a composite alternative hypothesis, and upper boundary to reject the
null hypothesis when there are more events than expected, no lower boundary, and an upper limit on the sample size at which time the sequential
analyses end without rejecting the null. MaxSPRT was developed for post-market vaccine safety surveillance as part of the Vaccine Safety Datalink
project run by the Centers for Disease Control and Prevention.
</p>
<p>In this package, all critical values, alpha spending strategies, statistical power, expected time to
signal and required sample size to achieve a certain power, are obtained exactly to whatever decimal precision desired,
using iterative numerical calculations. None of the results are based on asymptotic theory or computer simulations.
</p>
<p><b>Poisson Data</b>
</p>
<p>To start, consider continuous sequential analysis for Poisson data. Let <code class="reqn">C_t</code> be the random variable that counts the number of events up to time t.
Suppose that, under the null hypothesis, <code class="reqn">C_t</code> has a Poisson distribution with mean <code class="reqn">\mu_t</code>, where <code class="reqn">\mu_t</code> is a known function reflecting the population at risk.
Under the alternative hypothesis, suppose that <code class="reqn">C_t</code> has a Poisson distribution with mean RR<code class="reqn">\mu_t</code>, where "RR" is the unknown increased relative risk due to the vaccine.
The MaxSPRT statistic defined in terms of the log likelihood ratio is given by: </p>
<p style="text-align: center;"><code class="reqn">LLR_t=(\mu_t-c_t)+c_t \log{c_t/\mu_t},</code>
</p>
<p> when <code class="reqn">c_t</code> is at least <code class="reqn">\mu_t</code>, and <code class="reqn">LLR_t =0</code>, otherwise.
For continuous sequential analysis, the test statistic, <code class="reqn">LLR_t</code>, is monitored at all times <code class="reqn">t \in (0,T]</code>, where <code class="reqn">T</code>= SampleSize. SampleSize is defined
a priori by the user in order to achieve the desired statistical power, which can be calculated using the <code>SampleSize.Poisson</code> function.
The sequential analysis ends, and <code class="reqn">H_0</code> is rejected if, and when, <code class="reqn">LLR_t \geq CV</code>, where CV is calculated using the <code>CV.Poisson</code> function.
If <code class="reqn">\mu_t</code>= SampleSize, the sequential analysis ends without rejecting the null hypothesis. To calculate other important performance metrics, such as the expected time to signal when
the null hypothesis is rejected, use the <code>Performance.Poisson</code>, <code>Performance.Threshold.Poisson</code> and <code>Performance.AlphaSpend.Poisson</code> functions.
These functions also work for group sequential analysis when the group sizes are fixed a priori.
For with fixed and/or unpredictable group sizes, see the function <code>Analyze.Poisson</code>. 
</p>
<p>If the first event occurs sufficiently early, the sequential analysis may end with the null hypothesis rejected after a single event. There is an option
to require a minimum number of observed events, <code class="reqn">c_t</code>= M, before the null can be rejected.
Setting M in the range [3,6] is often a good choice (Kulldorff and Silva, 2012). If there is a delay until the sequential analysis starts,
but it continuous continuously thereafter, there is an option for that as well, requiring a minimum number <code class="reqn">\mu_t</code>= D of expected events before the null can be rejected.
</p>
<p>With continuous sequential analysis, investigators can repeatedly analyze the data as often as they want, ensuring that the overall probability of falsely
rejecting the null hypothesis at any time during the analysis is controlled at the desired nominal significance level (Wald, 1945, 1947). Continuous sequential
methods are suitable for real-time or near real-time monitoring. When data is only analyzed intermittently, group sequential methods are used instead
(Chin, 2012; Cook and DeMets, 2007; Xia, 2007; Friedman et al., 2010; Ghosh and Sen, 1991; Jennison and Turnbull, 2000; Mukhopadhyay and Silva, 2002; Whitehead, 1997).
The data is then analyzed at regular or irregular discrete time intervals after a certain amount of data is accessible. Group sequential statistical methods are commonly used in
clinical trials, where a trial may be stopped early due to either efficacy or unexpected adverse events (Jennison and Turnbull, 2000). 
</p>
<p>The same test statistic, <code class="reqn">LLR_t</code>, is used for group sequential analyses (Silva and Kulldorff, 2012). The times when <code class="reqn">LLR_t</code> is evaluated can be defined in several ways,
using regular or irregular time intervals that are referenced by calendar period, sample size or some scale involving the distribution of the data. For Poisson data,
the group sequential analysis must be conducted with equal size groups, with a constant expected number of adverse events between looks at the accumulating data.
In another words, <code class="reqn">LLR_t</code> is compared against CV whenever <code class="reqn">\mu_t</code> is a multiple of SampleSize/Looks, where 'Looks' is the total number of looks at the data.
</p>
<p><b>Binomial Data</b>
</p>
<p>The MaxSPRT method can also be applied to binomial/Bernoulli data. Let <code class="reqn">n</code> denote the total number of events that has been observed in a sequential monitoring
up to a certain moment in time. Suppose that these n events are categorized as cases and controls. For example, cases may be adverse events happening
to a person taking drug A, while controls may be the same adverse event happening to someone in a matched set of individuals taking drug B. As another example,
in a self-control sequential analysis, cases may be adverse events happening during the 1-28 days following vaccination, while controls are the same adverse events
happening 29-56 days after vaccination. 
</p>
<p>Let <code class="reqn">C_t</code> to denote the number of cases among the n events, and assume that <code class="reqn">C_t</code> follows a binomial distribution with success probability equal to <code class="reqn">p</code>, where <code class="reqn">p = 1=(1 + z)</code>,
and z is the matching ratio between the occurrence of a case and of a control under the null hypothesis. For example, if the probability of having a case (instead of a control)
is <code class="reqn">p = 1=(1 + z) = 0.5</code>, then z=1 (1:1 matching ratio), or, <code class="reqn">p = 0.25</code> for z=3 (1:3 matching ratio), etc.
</p>
<p>The MaxSPRT statistic (Kulldorff et al., 2011) for a continuous binomial surveillance is:
</p>
<p style="text-align: center;"><code class="reqn">LR_n=\frac{(c_n/n)^{c_n}\left[(n-c_n)/n\right]^{n-c_n}}{\left[1/(1+z)\right]^{c_n}\left[z/(1+z)\right]^{n-c_n}},</code>
</p>

<p>if <code class="reqn">z c_n/(n-c_n)&gt;1</code>, and <code class="reqn">LR_n= 1</code> otherwise.
</p>
<p>The monitoring is continued until either there is a signal rejecting the null hypothesis <code class="reqn">(LR_n &gt; CV)</code>
or until <code class="reqn">n=N</code>, which indicates that the null is not to be rejected. To perform the calculations, use the
<code>CV.Binomial</code>, <code>SampleSize.Binomial</code>, <code>Performance.Binomial</code>, <code>Performance.Threshold.Binomial</code> and <code>Performance.AlphaSpend.Binomial</code> functions
for continuous and group sequential fashions. For group sequential analysis, the group sizes are fixed a priori.
For fixed and/or unpredictable group sizes, see the function <code>Analyze.Binomial</code>.
</p>
<p>The main assumptions behind the method above are: (i) the monitoring is truly performed in a continuous fashion; (ii) the matching ratio (z) is constant for all of the n events,
and (iii) it uses a Wald type rejection boundary that is flat in terms of the likelihood function. Relaxing these assumptions, Fireman et al. (2013) developed exact sequential
analysis for group sequential data with varying matching ratios, and for any user specified alpha rejection plan.
</p>
<p><b>Multiple Weighted Binomial Endpoints</b>
</p>
<p>When there are multiple different outcomes, one can use weights reflecting practical interpretations, such as an outcome
severity in comparison to the others. For example, for two different outcomes, the first with weight w, and the second with weight 1.
This way, a single event of the first outcome is equivalent to w outcomes of the second type. This type of analysis is treated by Silva et al (2019).
To run the analysis with multiple weighted binary endpoints with fixed and/or unpredictable group sizes, see the function <code>Analyze.wBinomial</code>. 
</p>
<p><b>Conditional Poisson data with limited information from historical cohort - CMaxSPRT</b>
</p>
<p>In Poisson MaxSPRT, the expected mean <code class="reqn">\mu_t</code> is assumed to be a known function reflecting the baseline adverse event risk
in the absence of the exposure of interest. In practice, it is estimated with historical data and the uncertainty associated with
the estimated counts may or may not have a non-negligible impact on the performance of the sequential analysis method.
Li and Kulldorff (Li and Kulldorff, 2010) showed in their simulation study that uncertainty in the estimated baseline means can be
ignored when the total number of events in the historical data is at least 5 times the specified upper limit <code class="reqn">T</code>. Otherwise, it
is recommended to implement a statistical procedure that takes in account the variation from the historical data, i.e. a procedure that
conditionates the likelihood function of the historical Poisson data, here simply called "conditional Poisson data". For this, the
Conditional Maximized Sequential Probabilit Ratio Test (CMaxSPRT) to account for variation in both the historical and surveillance cohorts.
</p>
<p>Let <code class="reqn">c</code> and <code class="reqn">V</code> denote the total number of events and the cumulative person-time in the historical data, let <code class="reqn">P_k</code> denote the
cumulative person-time observed in the surveillance population when the <code class="reqn">k</code>th event occurred. The CMaxSPRT statistic defined in terms
of the log likelihood ratio is given by </p>
<p style="text-align: center;"><code class="reqn">U_k=clog(\frac{c(1+P_k/V)}{c+k})+klog(\frac{k(1+P_k/V)}{P_k/V(c+k)}),</code>
</p>
<p> when <code class="reqn">k/c&gt;P_k/V</code>,
and <code class="reqn">U_k=0,</code> otherwise. In the original publication (Li and Kulldorff, 2010), the method was introduced as a continuous sequential analytic
approach with the upper limit defined in terms of the maximum number of observed events, i.e., <code class="reqn">k \leq K</code>, and the critical value calculated
via a Monte Carlo approach. A large number of Monte Carlo simulations (e.g., 10 million) might be needed to calculate the critical values with
a reasonable precision. 
</p>
<p>In Silva et al. (2019a), the method was extended i) with another option of defining the surveillance length in terms of
the maximum cumulative person-time divided by the total cumulative person-time in the historical cohort, i.e., <code class="reqn">P_k/V \le T</code>, ii) with an exact
calculation of the critical values for both surveillance length definitions, and iii) for group sequential analysis with data updated and analyzed
intermittently instead of continuously. The exact critical values are calculated using the interval havling method to solve for the root of a complex,
non-linear equation such that the overall Type I error rate is preserved at the nominal level. As <code class="reqn">K</code> increases, the computing time for the exact
critical values increases exponentially. 
</p>
<p>Silva et al. (2019a) also proposed two approximation methods to calculate the critical values that require
substantially less computing time. One approch may overestimate the critical values and thus is referred to as the conservative approach as it may
yield lower-than-nominal Type I error rates; the other approach may underestmate the critical values and thus is referred to as the liberal approach
as it may yield higher-than-nominal Type I error rates. The recommendation is to use the exact approach when <code class="reqn">K</code> is small (e.g., 10),
use the conservative approach when <code class="reqn">K</code> is medium or large but <code class="reqn">c</code> is small, and use the liberal approach when <code class="reqn">c</code> is medium (e.g., 50)
or large. Exact calculations for selected tuning parameters show that the three approaches yield very similar results when <code class="reqn">K</code> and <code class="reqn">c</code> are reasonably large.
</p>
<p>For calculating critical values for a Wald type rejection boundary, use the <code>CV.CondPoisson</code> function. For statistical power,
expected time to signal, expected time of surveillance, and maximum sample size requirements, use the
<code>Performance.CondPoisson</code>, <code>Performance.Threshold.CondPoisson</code>, <code>Performance.AlphaSpend.CondPoisson</code>, and <code>SampleSize.CondPoisson</code> functions.
For fixed and/or unpredictable group sizes, see the function <code>Analyze.CondPoisson</code>.
</p>
<p><b>Alpha spending function for unpredictable group sizes</b>
</p>
<p>The alpha spending function specifies the cumulative amount, <code class="reqn">F_{\alpha}(t)</code>, of Type I error probability related to each of the possible values of <code class="reqn">n</code>.
Thus, at the end of the monitoring the alpha spending corresponds to a value smaller than or equal to the overall amount of Type I error probability defined for
the overall nominal significance level, <code class="reqn">\alpha</code>.
</p>
<p>Denote the single probability of rejecting the null hypothesis at the <code class="reqn">j</code>-th test by <code class="reqn">\alpha_j</code>. Then, the alpha spending at test <code class="reqn">i</code> is given by
<code class="reqn">F_{\alpha}(t_i)=\sum_{j=1}^{i}\alpha_j \leq \alpha</code>.
</p>
<p>There is a vast number of proposals for choosing the shape of the alpha spending function.
Jennison and Turnbull (2000) present a rich discussion about this topic. They dedicated a special attention to the alpha spending of the form:
<code class="reqn">F_{\alpha}(t)=\alpha t^{\rho}</code>, where <code class="reqn">\rho&gt;0</code>, and <code class="reqn">t</code> represents a fraction of the maximum length of surveillance. 
</p>
<p>A new aproach for alpha spending selection is the optimal solution, introduced by Silva and Kulldorff (2020).
The optimal solution is based on exact calculations through linear programing, and it is operated through the function <code>Optimal.Binomial</code>.
</p>
<p>For MaxSPRT with Poisson data, Silva (2018b) presents a rule of thumb for a near-optimal alpha spending shape. Likewise, Silva et al. (2019b) discuss
the choice of alpha spending shapes for CMaxSPRT.
</p>
<p>To run continuous or group sequential analysis with an user defined alpha spending function, and/or, when the group sizes are not known a prior,
<code>Analyze.Binomial</code>, <code>Analyze.wBinomial</code> (for multiple weighted binomial endpoints), <code>Analyze.Poisson</code>, and <code>Analyze.CondPoisson</code> should be used for binomial and Poisson, and conditional Poisson data, respectively. 
These functions work differently than the other functions mentioned above.
Those other functions are designed to be used before the start of the sequential analysis, in order to determine what the maximum sample size
and critical value should be. Once the sequential analysis is under way, the test statistic is then calculated using a hand calculator or an
excel spread sheet, and compared with the critical value. The functions <code>Analyze.Binomial</code>, <code>Analyze.Poisson</code>, and <code>Analyze.CondPoisson</code> work very differently, in that they are run at each look at
the accumulating data, whenever a new group of data arrives, and it is meant to perform the test itself, i.e., there is no need to use hand calculators or
excel spread sheets or any other auxiliar code. The results and conclusions, including a descriptive table and illustrative graphics, are automatically
provided after running <code>Analyze.Binomial</code>, <code>Analyze.wBinomial</code>, <code>Analyze.Poisson</code>, or <code>Analyze.CondPoisson</code>.
</p>
<p>Important: before using these functions, though, it is necessary to first run the
functions <code>AnalyzeSetup.Binomial</code>, <code>AnalyzeSetup.wBinomial</code>, <code>AnalyzeSetup.Poisson</code>, or <code>AnalyzeSetup.CondPoisson</code> once in order to set everything up for the sequential analysis.
</p>


<h3>Comparison with Other R Packages for Sequential Analysis</h3>

<p>The R  <code>Sequential</code> package is designed for sequential analysis where statistical hypothesis testing is performed using gradually accumulating data.
It is not designed for quality control problems, where a process is monitored over time to detect an emerging problem due to a sudden increase in the excess risk.
Although the methods for sequential analysis and quality control may seem similar, as they both analyze gradually accumulating data, they are actually very different
in both their purpose and design. Under the sequential hypothesis testing approach, the objective is to quickly determine if there is some intrinsic excess risk,
with the assumption that this risk does not change over time. For example, we may want to know if drug A is better than drug B, and there is no reason to believe
that the behavior of the drugs change over time. In the quality control setting, the objective is instead to detect a possible change in a stochastic process that
may occur in the future, and to detect that change as soon as possible after it occurs. For example, the heart of a hospital patient is beating as it should, but if
there is a sudden deterioration, the alarm should sound as soon as possible without generating a lot of false alarms. This package is only meant for sequential analysis
of the former type, and it should not be used for quality control type problems. For quality control type analyses, there are other R packages available,
such as <code>graphicsQC</code>, <code>IQCC</code>, <code>MetaQC</code>, <code>MSQC</code>, <code>qcc</code>, and <code>qcr</code>.
</p>
<p>In a number of ways, the R Sequential package differs from other R packages for sequential analyses. Historically, most sequential analysis has been conducted
using asymptotic statistical theory, and that is also what is used in the <code>gsDesign</code>, <code>ldbounds</code>, <code>PwrGSD</code>, <code>seqDesign</code>, <code>seqmon</code>, and <code>sglr</code> R packages.
In contrast, the R Sequential package is based on exact results, using iterative numerical calculations, rather than using asymptotic theory or computer simulations.
</p>
<p>With this package, it is only possible to analyze binomial/Bernoulli, Poisson, or conditional Poisson data. For other probability distributions, such as normal or exponential data,
other R packages should be consulted, such as <code>GroupSeq</code> or <code>SPRT</code>. Moreover, all functions in this package uses a one-sided upper bound to reject the null hypothesis,
while the analyses end without rejecting the null when an upper limit on the sample size is reached. For two sided sequential analysis, or other types of rejection
boundaries, other R packages must be used, such as e.g. <code>ldbounds</code> and <code>Binseqtest</code>. Finally, in this package, there are functions for both continuous
and group sequential analysis, and it is also possible to analyze situations where some of the data arrives continuously while other parts of the data arrives in groups.
Most other R packages are exclusively designed for group sequential analysis, but there are some that also do continuous sequential analysis, such as <code>Binseqtest</code> and <code>SPRT</code>,
but <code>Binseqtest</code> is only for binomial data type, and <code>SPRT</code> is for simple alternative hypothis, while <code>Sequential</code> can be used for binomial and Poisson data and is meant to
composite alternative hypothesis. The present package offers the possibility to calculate the expected time to signal through the <code>Performance.Poisson</code>, <code>Performance.G.Poisson</code>,
<code>Performance.Binomial</code>, <code>Performance.G.Binomial</code>, and Performance.CondPoisson functions, which is not offered by the other packages cited above.
Another important advantage of the <code>Sequential</code> package is the possibility of eliciting, through exact calculations, the minimum sample size needed to
accomplish with target statistical powers through the functions <code>SampleSize.Poisson</code>, <code>SampleSize.CondPoisson</code>, and <code>SampleSize.Binomial</code>.     
</p>


<h3>Acknowledgements</h3>

<p>Development of the R Sequential package has been funded and supported by:<br>
-	Food and Drug Administration, USA, through the Mini-Sentinel Project (v1.0,1.1,2.0).<br>
-	National Institute of General Medical Sciences, NIH, USA, through grant number R01GM108999 (v2.0 to 3.1).<br>
-	Federal University of Ouro Preto (UFOP), through contract under internal UFOP's resolution CEPE 4600 (v2.0 to 3.1).<br>
-	National Council of Scientific and Technological Development (CNPq), Brazil, process number 301391/2019-0. (v3.1 to v4.3).<br>
-     National Council of Scientific and Technological Development (CNPq), Brazil, process number 302882/2022-7. (v4.3.1).<br>
-	Support Foundation to Minas Gerais State Research-Fapemig, Brazil, grant numbers PQ-00787-21 and RED-00133-21. (v3.1 to v4.3). <br>
-	Bank for Development of the Minas Gerais State (BDMG), Brazil (v1.0).<br><br>
Feedback from users is greatly appreciated. Very valuable suggestions concerning the R Sequential package have been received from various individuals, including:<br>
-	Ron Berman, University of California Berkeley.<br>
-	Claudia Coronel-Moreno, Harvard Pilgrim Health Care Institute.<br>
-	Bruce Fireman, Kaiser Permanente Northern California.<br>
-	Josh Gagne, Harvard Medical School and Brigham and Women's Hospital.<br>
-	Ned Lewis, Kaiser Permanente Northern California.<br>
-	Judith Maro, Harvard Medical School and Harvard Pilgrim Health Care Institute.<br>
-	Azadeh Shoaibi, Food and Drug Administration.<br>
-	Katherine Yih, Harvard Medical School and Harvard Pilgrim Health Care Institute.<br>
-     Jie Tang, Clinical biostatistics, Janssen R and D US, Johnson and Johnson LLC.<br>
-	Tuomo A. Nieminen, The National Institute for Health and Welfare (THL), Finland.<br>
-	Andreia Leite, Department of Infectious Disease Epidemiology, London School of Hygiene and Tropical Medicine.<br> 
-	Laura Hou, Harvard Pilgrim Health Care Institute, Boston, USA.<br>
-	Abdurrahman Abdurrob, Division of Pharmacoepidemiology and Pharmacoeconomics, Department of Medicine, Brigham and Women's Hospital and Harvard Medical School.<br>
-	Kirk Snyder, Information Management Services, Inc.<br>
-     Joselito M. Montalban, Active Living, Population and Public Health Branch, Winnipeg, Manitoba, Canada.<br> 
-     Sarah Spruin and Vaccine Safety Surveillance, Public Health Agency of Canada.<br>
-     Lola Adewale, Stateam LLC, New Jersey, United States.<br>
-	Lian Lin, Ph.D., Director, Safety Statistics, Stats and Programming, Moderna.<br></p>


<h3>Version History of the R Sequential Package</h3>

<p>Version 1.1, February 2013<br>
Exact sequential analysis for Poisson data:<br>
-	Exact continuous sequential analysis.<br>
-	Exact group sequential analysis with pre-defined and constant groups sizes.<br>
-	Wald type rejection boundary.<br>
-	Statistical power, expected time to signal and sample size calculations.<br>
-	User guide.<br><br>
Version 1.2,  January 2014<br>
-	Improved code structure and efficiency.<br>
-	More extensive user guide. <br><br>
Version 2.0, June 2015<br>
Exact sequential analysis for binomial data:<br>
-	Continuous sequential analysis.<br>
-	Group sequential analysis with pre-defined group sizes.<br>
-	Group sequential analysis with unpredictable group sizes, not specified a priori.<br>
-	Fixed or variable binomial probabilities (matching ratios).<br>
-	User specified alpha spending function.<br> 
-	Statistical power, expected time to signal and sample size calculations.<br>
-	Updated user guide.<br><br>
Version 2.0.1, June 2015<br>
-       Correction of bugs in <code>CV.Poisson</code> function. <br>
-       Updated user guide.<br><br>
Version 2.0.2, Octuber 2015<br>
-       Improved user guide.<br><br>
Version 2.1, May 2016<br>
Exact sequential analysis for Poisson data:<br>
-	Group sequential analysis with unpredictable group sizes, not specified a priori.<br>
-	User specified alpha spending function.<br>
-	Mixed group-continuous sequential analysis.<br>
-	Statistical power, expected time to signal and sample size calculations for non-constant groups sizes.<br>
Other:<br>
-	Directory address parameter in AnalyzeSetUp functions.<br>
-	Probability parameter in binomial functions.<br>
-	Updated user guide.<br><br>
Version 2.1.1, June 2016<br>
-	Correction of bugs in Poisson functions.<br>
-	Updated user guide.<br><br>
Version 2.2, July 2016<br>
-	Critical Value, Performance, and SampleSize calculations for CMaxSPRT with Poisson data.<br>
-	Updated user guide.<br><br>
Version 2.2.1, September 2016<br>
-     Correction of bugs in <code>CV.Poisson</code> and <code>CV.G.Poisson</code> functions. <br>
-     Updated user guide.<br><br>
Version 2.3, Dec 2016<br>
-     Correction of bugs in the <code>SampleSize.Binomial</code> function.<br>
-	Improvement of SampleSize functions for considering vectors for the input parameters R and power.<br>
-	Inclusion of the new functions <code>AnalyzeSetUp.CondPoisson</code> and <code>Analyze.CondPoisson</code>.<br>
-     Updated user guide.<br><br>
Version 2.3.1, Feb 2017<br>
-     Correction of bugs in <code>Analyze.Binomial</code> and <code>AnalyzeSetUp.Poisson</code> functions.<br>
-	Adjustment on the relative risk estimation method for <code>Analyze.Binomial</code> function.<br>
-     Updated user guide.<br><br>
Version 2.3.2, Aug 2017<br>
-     Correction of bugs in <code>Analyze.Binomial</code>.<br>
-     Updated user guide.<br><br>
Version 3.0, Jan 2019<br>
-     Functions <code>Optimal.Binomial</code> and <code>Analyze.wBinomial</code>.<br>
-     Updated user guide.<br><br>
Version 3.0.1, Feb 2019<br>
-     Updated user guide.<br><br>
Version 3.1, Sept 2019<br>
-      New Functions <code>Performance.Threshold.Binomial</code>, <code>Performance.Threshold.CondPoisson</code>,<br><code>Performance.Threshold.Poisson</code>, <code>Performance.AlphaSpend.Binomial</code>,<br><code>Performance.AlphaSpend.CondPoisson</code>, <code>Performance.AlphaSpend.Poisson</code>.<br>
-     Implemented two-tailed testing for the functions: <code>CV.Poisson</code>, <code>Performance.Poisson</code>,<br><code>SampleSize.Poisson</code>, <code>Analyze.wBinomial</code>, <code>Optimal.Binomial</code>,<br><code>Performance.Threshold.Binomial</code>, <code>Performance.AlphaSpend.Binomial</code>,<br><code>Performance.Threshold.Poisson</code>.<br>
-     Updated user guide.<br>
-	Concatenation of functions for continuous and group fashions for critical values and performance.<br><br>
Version 3.2, Nov 2020<br>
-     Function <code>Analyze.Binomial</code> improved for fixed-width and fixed-accuracy confidence intervals,<br>
-     Function <code>Performance.AlphaSpend.Binomial</code> improved for new inputs having lower and upper alpha spending in two tailed testing,<br>
-     Correction of bugs in <code>Analyze.Poisson</code> and <code>CV.Poisson</code> functions,<br>
-     Updated user guide.<br><br>
Version 3.2.1, Dec 2020<br>
-     Correction of bugs in the <code>Analyze.Poisson</code> function,<br>
-     Updated user guide.<br><br>
Version 3.3, Feb 2021<br>
-     Optimized <code>Analyze.Poisson</code> function for running three times faster than earlier versions.<br>
-     Updated user guide.<br><br>
Version 3.3.1, Feb 2021<br>
-     Adjusted <code>Analyze.Binomial</code> function for a flexible H0:R&lt;=R0 under the null hypothesis.<br>
-     Updated user guide.<br><br>
Version 3.3.2, Aug 2021<br>
-     Adjusted functions: <code>Analyze.Poisson</code>, <code>AnalyzeSetUp.Poisson</code>, <code>Performance.AlphaSpend.Poisson</code>, and <code>SampleSize.Poisson</code> for the surveillance of COVID-19 vaccination.<br>
-     Updated user guide.<br><br>
Version 3.3.3, Aug 2021<br>
-     Adjusted <code>Performance.AlphaSpend.Poisson</code> function.<br>
-     Updated user guide.<br><br>
Version 3.4, Sept 2021<br>
-     Adjusted <code>Analyze.Poisson</code> function.<br>
-     Updated user guide.<br><br>
Version 4.0, Sept 2021<br>
-     New function <code>ConfidenceInterval.Binomial</code>, adjusted <code>Analyze.wBinomial</code> and new parameter R0 for <code>Analyze.Poisson</code> and <code>Performance.AlphaSpend.Poisson</code>.<br>
-     Updated user guide.<br><br>
Version 4.1, Oct 2021<br>
-     Adjusted <code>SampleSize.Poisson</code>.<br>
-     Updated user guide.<br><br>
Version 4.2, Feb 2022<br>
-     Adjusted <code>AnalyzeSetUp.Poisson</code>.<br>
-     Updated user guide.<br><br>
Version 4.3, April 2022<br>
-     Adjusted <code>Analyze.Binomial</code> for bugs on the relative risk estimate under variable matching ratio.<br>
-     Updated user guide.<br><br>
Version 4.3.1, Octuber 2023<br>
-	Updated reference for the bounded-length confidence interval following sequential analysis with binary data.<br><br>
Version 4.3.2, Dec 2023<br>
-	Correction of bugs in the Analyze.CondPoisson function.<br><br>
Version 4.3.3, Feb 2024<br>
-	Updated user guide.<br><br></p>


<h3>Author(s)</h3>

<p> Ivair Ramos Silva, Martin Kulldorff.<br>
Maintainer: Ivair Ramos Silva &lt;ivair@ufop.edu.br&gt;
</p>


<h3>References</h3>

<p>Chin R. (2012), Adaptive and Flexible Clinical Trials, Boca Raton, FL: Chapman and Hall/CRC.
</p>
<p>Cook TD, DeMets DL. (2007), Introduction to Statistical Methods for Clinical Trials: Chapman and Hall/CRC Texts in Statistical Science. 
</p>
<p>Fireman B, et al. (2013), Exact sequential analysis for binomial data with timevarying probabilities. Manuscript in Preparation.
</p>
<p>Friedman LM, Furberg CD, DeMets D. (2010), Fundamentals of Clinical Trials, 4th ed.: Springer. 
</p>
<p>Ghosh BK, Sen PK. (1991), Handbook of Sequential Analysis, New York: MARCEL DEKKER, Inc. 
</p>
<p>Ghosh M, Mukhopadhyay N, Sen PK. (2011), Sequential Estimation: Wiley.
</p>
<p>Jennison C, Turnbull B. (2000), Group Sequential Methods with Applications to Clinical
Trials, London: Chapman and Hall/CRC.
</p>
<p>Kulldorff M, Davis RL, Kolczak M, Lewis E, Lieu T, Platt R. (2011), A Maximized Sequential Probability Ratio Test for Drug and Safety Surveillance. Sequential Analysis, 30: 58–78.
</p>
<p>Kulldorff M, Silva IR. (2015), Continuous Post-market Sequential Safety Surveillance with Minimum Events to Signal. REVSTAT Statistical Journal, 15(3): 373–394.
</p>
<p>Li L, Kulldorff M. (2010), A conditional maximized sequential probability ratio test for Pharmacovigilance. Statistics in Medicine, 29 (2), 284–295. 
</p>
<p>Mukhopadhyay N, Silva BM. (2002), Sequential Methods and Their Applications, 1th ed.: Chapman and Hall/CRC. 
</p>
<p>Silva IR, Kulldorff M. (2015), Continuous versus Group Sequential Analysis for Vaccine and Drug Safety Surveillance. Biometrics, 71 (3), 851–858.
</p>
<p>Silva IR, Maro J, Kulldorff M. (2021), Exact sequential test for clinical trials and post-market drug and vaccine safety surveillance with Poisson and binary data. Statistics in Medicine, 40(22), 4890–4913.
</p>
<p>Silva IR, Kulldorff M, Yih W. Katherine. (2020), Optimal alpha spending for sequential analysis with binomial data. Journal of the Royal Statistical Society Series B, 82(4) p. 1141–1164.
</p>
<p>Silva IR, Gagne J, Najafzadeh M, Kulldorff M. (2020), Exact Sequential Analysis for Multiple Weighted Binomial Endpoints. Statistics in Medicine, 39(3), 340–351.
</p>
<p>Silva IR, Li L, Kulldorff M. (2019a), Exact conditional maximized sequential probability ratio test adjusted for covariates. Sequential Analysis, 38(1), 115–133.
</p>
<p>Silva IR. (2018a), Type I Error Probability Spending for Post-Market Drug and Vaccine Safety Surveillance with Binomial Data. Statistics in Medicine, 15;37(1), 107–118.
</p>
<p>Silva IR. (2018b), Type I Error Probability Spending for Post-Market Drug and Vaccine Safety Surveillance With Poisson Data. Methodol Comput Appl Probab, 20(2), 739–750.
</p>
<p>Silva IR, Lopes LM, Dias P, Yih WK. (2019b), Alpha Spending for Historical Versus Surveillance Poisson Data With CMaxSPRT. Statistics in Medicine, 38(12), 2126–2138. 
</p>
<p>Silva IR, Montalban, J. (2023), The person-time ratio distribution for the exact monitoring of adverse events: Historical vs surveillance Poisson data, Statistics in Medicine, 42(18), 3283–3301.
</p>
<p>Silva IR, Oliveira, F. (2023), Matching ratio and sample size for optimal sequential testing with binomial data, Statistical Methods in Medical Research, DOI: 10.1177/0962280223117603.
</p>
<p>Silva IR, Zhuang, Y. (2022), Bounded-width confidence interval following optimal sequential analysis of adverse events with binary data, Statistical Methods in Medical Research, 31(12), 2323–2337.
</p>
<p>Xia Qi. (2007), A Procedure for Group Sequential Comparative Poisson Trials. Journal of Biopharmaceutical Statistics, 17, 869–881. 
</p>
<p>Wald A. (1945), Sequential Tests of Statistical Hypotheses, Annals of Mathematical Statistics, 16, 117–186.
</p>
<p>Wald A. (1947), Sequential Analysis. New York: John Wiley and Sons.
</p>
<p>Whitehead J. (1997), The Design and Analysis of Sequential Clinical Trials, 2th ed.: Wiley.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Critical value for continuous sequential analyses for Poisson Data.
## Maximum sample size = 10, alpha = 0.05 and minimum number of events = 3:

cvt&lt;- CV.Poisson(SampleSize=10,D=0,M=3,alpha=0.05)

## Statistical power and the expected time to signal for relative risk RR=2:

result&lt;- Performance.Poisson(SampleSize=10,D=0,M=3,cv=cvt,RR=2)

# And if you type:
result

# Then you will see the following:
#          Power ESignalTime ESampleSize
#     [1,] 0.7329625    4.071636    5.654732

</code></pre>


</div>