<div class="container">

<table style="width: 100%;"><tr>
<td>doPS</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Generate the Inverse Probability Treatment Weights
</h2>

<h3>Description</h3>

<p><code>doPS</code> calculates the unstabilized and stabilized inverse probability treatment weights (IPW) for average treatment effect using propensity score. The propensity score is calculated by <code>twang</code> package using the boosted logistic regression.
</p>


<h3>Usage</h3>

<pre><code class="language-R">doPS(data,Trt,Trt.name,VARS.,logistic = FALSE,w=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>The dataset, includes treatment assignment as well as covariates.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Trt</code></td>
<td>

<p>The name of the treatment variable in the dataset.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Trt.name</code></td>
<td>

<p>The treated group name of the treatment variable in the dataset.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>VARS.</code></td>
<td>

<p>The vector of the name of potential confounding variables in the dataset.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logistic</code></td>
<td>

<p>A logical value indicating whether use logistic regression (TRUE) or non-parametric boosted tree (FALSE).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>

<p>Optional sampling weights.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The treatment variable should only contain 2 levels of treatment, and one should be viewed as treated group and another is control group.
</p>
<p>For stabilized weights:
</p>
<p>For the treated individuals, we assign the IPW: w = Pr(T=1)/Pr(T=1|X=x), for control individuals, the stabilized weight is: w = (1-Pr(T=1))/(1-Pr(T=1|X=x)).
</p>


<h3>Value</h3>

<p>doPS returns an object of class "PS".
An object of class "PS" is a list containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Data</code></td>
<td>
<p>A new dataset which excludes all the missing value on the potential confounders from input data, add the propensity score and IPW into the new dataset.
</p>

<dl>
<dt>ps_ate</dt>
<dd>
<p>The estimated propensity scores with estimand of interest as ATE.</p>
</dd>
<dt>ipw_ate_unstab</dt>
<dd>
<p>Unstabilized ipw calculated from ps_ate.</p>
</dd>
<dt>ipw_ate_stab</dt>
<dd>
<p>Stabilized ipw calculated from ps_ate.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ps</code></td>
<td>
<p>an object of class <code>ps</code>, See the help for ps for details of the ps class.
</p>
</td>
</tr>
</table>
<h3>See Also</h3>

 <p><code>ps</code> </p>


<h3>Examples</h3>

<pre><code class="language-R">n &lt;- 500
set.seed(1234)
Cens = runif(n,0.7,0.9)
set.seed(1234)
OUT1 &lt;- sim_cox_msm_semicmrsk(beta1 = 1,beta2 = 1,beta3 = 0.5,
                              sigma_2 = 1,
                              alpha0 = 0.5, alpha1 = 0.1, alpha2 = -0.1, alpha3 = -0.2,
                              n=n, Cens = Cens)
data_test &lt;- OUT1$data0

## Get the PS weights
vars &lt;- c("Z1","Z2","Z3")
ps1 &lt;- doPS(data = data_test,
            Trt = "A",
            Trt.name = 1,
            VARS. = vars,
            logistic = TRUE,w=NULL)
w &lt;- ps1$Data$ipw_ate_stab
</code></pre>


</div>