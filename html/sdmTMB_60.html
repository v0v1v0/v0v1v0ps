<div class="container">

<table style="width: 100%;"><tr>
<td>sdmTMB_simulate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate from a spatial/spatiotemporal model</h2>

<h3>Description</h3>

<p><code>sdmTMB_simulate()</code> uses TMB to simulate <em>new</em> data given specified parameter
values. <code>simulate.sdmTMB()</code>, on the other hand, takes an <em>existing</em> model fit
and simulates new observations and optionally new random effects.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sdmTMB_simulate(
  formula,
  data,
  mesh,
  family = gaussian(link = "identity"),
  time = NULL,
  B = NULL,
  range = NULL,
  rho = NULL,
  sigma_O = NULL,
  sigma_E = NULL,
  sigma_Z = NULL,
  phi = NULL,
  tweedie_p = NULL,
  df = NULL,
  threshold_coefs = NULL,
  fixed_re = list(omega_s = NULL, epsilon_st = NULL, zeta_s = NULL),
  previous_fit = NULL,
  seed = sample.int(1e+06, 1),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A <em>one-sided</em> formula describing the fixed-effect structure.
Random intercepts are not (yet) supported. Fixed effects should match
the corresponding <code>B</code> argument vector of coefficient values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing the predictors described in <code>formula</code> and
the time column if <code>time</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mesh</code></td>
<td>
<p>Output from <code>make_mesh()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>Family as in <code>sdmTMB()</code>. Delta families are not supported.
Instead, simulate the two component models separately and combine.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>The time column name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>A vector of beta values (fixed-effect coefficient values).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>range</code></td>
<td>
<p>Parameter that controls the decay of spatial correlation. If a
vector of length 2, <code>share_range</code> will be set to <code>FALSE</code> and the spatial
and spatiotemporal ranges will be unique.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>Spatiotemporal correlation between years; should be between -1 and
1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma_O</code></td>
<td>
<p>SD of spatial process (Omega).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma_E</code></td>
<td>
<p>SD of spatiotemporal process (Epsilon).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma_Z</code></td>
<td>
<p>SD of spatially varying coefficient field (Zeta).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>Observation error scale parameter (e.g., SD in Gaussian).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tweedie_p</code></td>
<td>
<p>Tweedie p (power) parameter; between 1 and 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>Student-t degrees of freedom.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold_coefs</code></td>
<td>
<p>An optional vector of threshold coefficient values
if the <code>formula</code> includes <code>breakpt()</code> or <code>logistic()</code>. If <code>breakpt()</code>,
these are slope and cut values. If <code>logistic()</code>, these are the threshold at
which the function is 50% of the maximum, the threshold at which the
function is 95% of the maximum, and the maximum. See the model description
vignette for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed_re</code></td>
<td>
<p>A list of optional random effects to fix at specified
(e.g., previously estimated) values. Values of <code>NULL</code> will result
in the random effects being simulated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>previous_fit</code></td>
<td>
<p>(<strong>Deprecated</strong>; please use <code>simulate.sdmTMB()</code>).
An optional previous <code>sdmTMB()</code> fit to pull parameter values.
Will be over-ruled by any non-NULL specified parameter arguments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Seed number.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Any other arguments to pass to <code>sdmTMB()</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A data frame where:
</p>

<ul>
<li>
<p> The 1st column is the time variable (if present).
</p>
</li>
<li>
<p> The 2nd and 3rd columns are the spatial coordinates.
</p>
</li>
<li> <p><code>omega_s</code> represents the simulated spatial random effects (only if present).
</p>
</li>
<li> <p><code>zeta_s</code> represents the simulated spatial varying covariate field (only if present).
</p>
</li>
<li> <p><code>epsilon_st</code> represents the simulated spatiotemporal random effects (only if present).
</p>
</li>
<li> <p><code>eta</code> is the true value in link space
</p>
</li>
<li> <p><code>mu</code> is the true value in inverse link space.
</p>
</li>
<li> <p><code>observed</code> represents the simulated process with observation error.
</p>
</li>
<li>
<p> The remaining columns are the fixed-effect model matrix.
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>simulate.sdmTMB()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">  set.seed(123)

  # make fake predictor(s) (a1) and sampling locations:
  predictor_dat &lt;- data.frame(
    X = runif(300), Y = runif(300),
    a1 = rnorm(300), year = rep(1:6, each = 50)
  )
  mesh &lt;- make_mesh(predictor_dat, xy_cols = c("X", "Y"), cutoff = 0.1)

  sim_dat &lt;- sdmTMB_simulate(
    formula = ~ 1 + a1,
    data = predictor_dat,
    time = "year",
    mesh = mesh,
    family = gaussian(),
    range = 0.5,
    sigma_E = 0.1,
    phi = 0.1,
    sigma_O = 0.2,
    seed = 42,
    B = c(0.2, -0.4) # B0 = intercept, B1 = a1 slope
  )
  head(sim_dat)

  if (require("ggplot2", quietly = TRUE)) {
    ggplot(sim_dat, aes(X, Y, colour = observed)) +
      geom_point() +
      facet_wrap(~year) +
      scale_color_gradient2()
  }

  # fit to the simulated data:
  fit &lt;- sdmTMB(observed ~ a1, data = sim_dat, mesh = mesh, time = "year")
  fit
</code></pre>


</div>