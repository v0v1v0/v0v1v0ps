<div class="container">

<table style="width: 100%;"><tr>
<td>vario.fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
vario.fit
</h2>

<h3>Description</h3>

<p>Fit model to the empirical variogram
</p>


<h3>Usage</h3>

<pre><code class="language-R">vario.fit (vario, bins, weights = rep(1, length(vario)),
                       type = c("spherical", "gaussian", "nugget", "linear", 
                       "exponential", "sill", "periodic", "hole"),
                       start.vals = list(c0 = 0, c1 = max(vario), 
                                          a = max(bins)/4, b=0.1, c=0.1),
                       control = list(maxit=10000)) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>vario</code></td>
<td>
<p>Empirical variogram from <code>emp.vario</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins</code></td>
<td>
<p>Bins or lag distances from <code>emp.vario</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Vector of weights of the same length as <code>vario</code>. If <code>weights</code> is a vector 
containing the number of points in each distance bin, the model will be fit via 
weighted least squares with the weights corresponding to the proportion of points
within each bin (i.e., weights sum to 1). Default is a vector of weights equal to 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of variogram model to fit to the data. Default is <code>spherical</code>. 
Other options are <code>gaussian</code>, <code>nugget</code>, <code>linear</code>, <code>exponential</code>, 
<code>sill</code>, <code>periodic</code>, and <code>hole</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.vals</code></td>
<td>
<p>Named list containing the start values for the variogram model: 
<code>c0</code>: nugget, <code>c1</code>: sill, <code>a</code>: spatial range; <code>b</code>: slope; 
<code>c</code>: frequency</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>optional parameter for the <code>optim</code> function. 
See <code>?optim</code> for details</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Return a named list containing the following variables:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>vario </code></td>
<td>
<p>Empirical variogram values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins </code></td>
<td>
<p>Empirical variogram bins/lag distances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AIC </code></td>
<td>
<p>AIC score of the model fit: <code class="reqn">AIC=nlog\left(\frac{SSE}{n}\right)+2p</code>
where <code class="reqn">n</code> is the number of points in the variogram, <code class="reqn">SSE=\sum{(\hat{x}_{i}-x_{i}})^2</code>,
and <code class="reqn">p</code> is the number of parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RMSE </code></td>
<td>
<p>Root Mean Square Error of the model fit: <code class="reqn">\sqrt{\frac{SSE}{n}}</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params </code></td>
<td>
<p>Named list containing the best model parameter estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit </code></td>
<td>
<p>Predicted variogram values from the model fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nls.success </code></td>
<td>
<p>did <code>nls</code> succeed?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convergence </code></td>
<td>
<p>did <code>nls</code> or <code>optim</code> converge?</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>Selecting proper initial values is critical for fitting a reasonable model to the 
empirical variogram. If these values are off, <code>nls</code> will fail and fall-back
functions will be used to determine the best parameter values that minimize the 
Root Mean Square Error (RMSE).
</p>


<h3>Author(s)</h3>

<p>Tarik C. Gouhier (tarik.gouhier@gmail.com)
</p>


<h3>See Also</h3>

<p><code>vario, vario.func</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load data
data(pisco.data)
# Environmental variogram
d=subset(pisco.data, subset=year==2000, select=c("latitude", "longitude", "upwelling"))
semiv=vario(data=d)
plot(semiv, xlab="Lag distance (km)")
mod.sph=vario.fit(semiv$vario, semiv$mean.bin.dist)
# Weighted least squares fit based on the number of points
mod.exp=vario.fit(semiv$vario, semiv$mean.bin.dist, 
                  weights=semiv$npoints/sum(semiv$npoints), 
                  type="expo")
mod.gau=vario.fit(semiv$vario, semiv$mean.bin.dist, type="gauss")
mod.lin=vario.fit(semiv$vario, semiv$mean.bin.dist, type="lin")
lines(semiv$mean.bin.dist, mod.sph$fit, col="red")
lines(semiv$mean.bin.dist, mod.exp$fit, col="black")
lines(semiv$mean.bin.dist, mod.gau$fit, col="blue")
lines(semiv$mean.bin.dist, mod.lin$fit, col="green")
legend(x="topleft", legend=paste(c("Spherical AIC:", "Exponential AIC:", 
                                   "Gaussian AIC:", "Linear AIC:"), 
                                   c(format(mod.sph$AIC, dig=2), 
                                   format(mod.exp$AIC, dig=2), 
                                   format(mod.gau$AIC, dig=2), 
       format(mod.lin$AIC, dig=2))), lty=1, col=c("red", "black", "blue", "green"), 
       bty="n")

# Correlogram
cover=subset(pisco.data, subset=year==2000, 
             select=c("latitude", "longitude", "mussel_abund"))
moran=vario(data=cover, type="moran")
mod.hol=vario.fit(moran$vario, moran$mean.bin.dist, 
                  type="hole", start.vals=list(c0=0.6, a=25, c1=0.01))
mod.per=vario.fit(moran$vario, moran$mean.bin.dist, type="period",
                  start.vals=list(a=1, b=3, c=0))
mod.lin=vario.fit(moran$vario, moran$mean.bin.dist, type="linear")
plot(moran, xlab="Lag distance (km)", ylim=c(-0.6, 0.8))
lines(moran$mean.bin.dist, mod.per$fit, col="red")
lines(moran$mean.bin.dist, mod.hol$fit, col="black")
lines(moran$mean.bin.dist, mod.lin$fit, col="blue")
legend(x="topleft", legend=paste(c("Periodic AIC:", "Hole AIC:", 
                                   "Linear AIC:"), 
                                   c(format(mod.per$AIC, dig=2), 
                                   format(mod.hol$AIC, dig=2), 
                                   format(mod.lin$AIC, dig=2))), 
                                   lty=1, col=c("red", "black", "blue"), bty="n")
</code></pre>


</div>