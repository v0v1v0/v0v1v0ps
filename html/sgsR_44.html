<div class="container">

<table style="width: 100%;"><tr>
<td>sample_ahels</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Adapted Hypercube Evaluation of a Legacy Sample (ahels)</h2>

<h3>Description</h3>

<p>Perform the adapted Hypercube Evaluation of a Legacy Sample (ahels) algorithm using
existing site data and raster metrics. New samples are allocated based on quantile ratios between
the existing sample and covariate dataset.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sample_ahels(
  mraster,
  existing,
  nQuant = 10,
  nSamp = NULL,
  threshold = 0.9,
  tolerance = 0,
  matrices = NULL,
  plot = FALSE,
  details = FALSE,
  filename = NULL,
  overwrite = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mraster</code></td>
<td>
<p>spatRaster. ALS metrics raster.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>existing</code></td>
<td>
<p>sf 'POINT'.  Existing plot network.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nQuant</code></td>
<td>
<p>Numeric. Number of quantiles to divide covariates and samples into. Quantiles that do not
cover at least 1 percent of the area of interest will be excluded and be returned as <code>NA</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nSamp</code></td>
<td>
<p>Numeric. Maximum number of new samples to allocate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>Numeric. Sample quantile ratio threshold. After the threshold <code>default = 0.9</code> is reached,
no additional samples will be added. Values close to 1 can cause the algorithm to continually loop.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>
<p>Numeric. Allowable tolerance (&lt;= 0.1 (10
added until the <code>1 - tolerance</code> density is reached. If <code>threshold</code> is used, samples will be added until the
<code>threshold - tolerance</code> value is reached. This parameter allows the user to define a buffer around desired quantile densities
to permit the algorithm to not add additional samples if quantile density is very close to 1, or user-defined <code>threshold</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matrices</code></td>
<td>
<p>List. Quantile and covariance matrices generated from <code>calculate_pop(mraster = mraster, nQuant = nQuant)</code>.
Both <code>mraster</code> &amp; <code>nQuant</code> inputs must be the same to supply the covariance matrix. Supplying the matrix allows users
with very large <code>mrasters</code> to pre-process the covariance matrix to avoid longer sampling processing times. If <code>matrices</code> is
provided, the <code>nQuant</code> parameter is ignored and taken from the covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>Logical. Plots samples of type <code>existing</code> (if provided; crosses) and <code>new</code> (circles) along with <code>mraster</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>details</code></td>
<td>
<p>Logical. If <code>FALSE</code> (default) output is sf object of
systematic samples. If <code>TRUE</code> returns a list of sf objects where <code>tessellation</code>
is the tessellation grid for sampling, and <code>samples</code> are the systematic samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>Character. Path to write output samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>Logical. Choice to overwrite existing <code>filename</code> if it exists.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns sf point object with existing samples and supplemental samples added by the ahels algorithm.
</p>


<h3>Note</h3>

<p>Messages in the algorithm will state that samples have been added to under-represented quantiles. The number between
square brackets that follow represent the matrix row and column respectively that can be printed using <code>details = TRUE</code>.
</p>
<p>In some cases, generally when a single metric is used as <code>mraster</code>, sampling ratios all be &gt;= 1 before the
<code>nSamp</code> number of samples are allocated. The algorithm will stop in this scenario.
</p>
<p>Special thanks to Dr. Brendan Malone for the original implementation of this algorithm.
</p>


<h3>Author(s)</h3>

<p>Tristan R.H. Goodbody
</p>


<h3>References</h3>

<p>Malone BP, Minasny B, Brungard C. 2019. Some methods to improve the utility of conditioned Latin hypercube sampling. PeerJ 7:e6451 DOI 10.7717/peerj.6451
</p>


<h3>See Also</h3>

<p>Other sample functions: 
<code>sample_balanced()</code>,
<code>sample_clhs()</code>,
<code>sample_existing()</code>,
<code>sample_nc()</code>,
<code>sample_srs()</code>,
<code>sample_strat()</code>,
<code>sample_sys_strat()</code>,
<code>sample_systematic()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#--- Load raster and existing plots---#
r &lt;- system.file("extdata", "mraster.tif", package = "sgsR")
mr &lt;- terra::rast(r)

e &lt;- system.file("extdata", "existing.shp", package = "sgsR")
e &lt;- sf::st_read(e)

sample_ahels(
  mraster = mr,
  existing = e,
  plot = TRUE
)

#--- supply quantile and covariance matrices ---#
mat &lt;- calculate_pop(mraster = mr)

sample_ahels(
  mraster = mr,
  existing = e,
  matrices = mat,
  nSamp = 300
)

## End(Not run)
</code></pre>


</div>