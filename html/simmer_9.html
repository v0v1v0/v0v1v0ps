<div class="container">

<table style="width: 100%;"><tr>
<td>batch</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Batch/Separate Arrivals</h2>

<h3>Description</h3>

<p>Activities for collecting a number of arrivals before they can continue processing
and splitting a previously established batch.
</p>


<h3>Usage</h3>

<pre><code class="language-R">batch(.trj, n, timeout = 0, permanent = FALSE, name = "", rule = NULL,
  ..., tag)

separate(.trj, ..., tag)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.trj</code></td>
<td>
<p>the trajectory object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>batch size, accepts a numeric or a callable object (a function)
which must return a numeric.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeout</code></td>
<td>
<p>set an optional timer which triggers batches every
<code>timeout</code> time units even if the batch size has not been fulfilled,
accepts a numeric or a callable object (a function) which must return a
numeric (0 = disabled).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>permanent</code></td>
<td>
<p>if <code>TRUE</code>, batches cannot be split.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>optional string. Unnamed batches from different <code>batch</code>
activities are independent. However, if you want to feed arrivals from
different trajectories into a same batch, you need to specify a common name
across all your <code>batch</code> activities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rule</code></td>
<td>
<p>an optional callable object (a function) which will be applied to
every arrival to determine whether it should be included into the batch, thus
it must return a boolean.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>unused.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tag</code></td>
<td>
<p>activity tag name to perform named rollbacks (see
<code>rollback</code>) or just to better identify your activities.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns the trajectory object.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## unnamed batch with a timeout
traj &lt;- trajectory() %&gt;%
  log_("arrived") %&gt;%
  batch(2, timeout=5) %&gt;%
  log_("in a batch") %&gt;%
  timeout(5) %&gt;%
  separate() %&gt;%
  log_("leaving")

simmer() %&gt;%
  add_generator("dummy", traj, at(0:2)) %&gt;%
  run() %&gt;% invisible

## batching based on some dynamic rule
traj &lt;- trajectory() %&gt;%
  log_("arrived") %&gt;%
  # always FALSE -&gt; no batches
  batch(2, rule=function() FALSE) %&gt;%
  log_("not in a batch") %&gt;%
  timeout(5) %&gt;%
  separate() %&gt;%
  log_("leaving")

simmer() %&gt;%
  add_generator("dummy", traj, at(0:2)) %&gt;%
  run() %&gt;% invisible

## named batch, shared across trajectories
traj0 &lt;- trajectory() %&gt;%
  log_("arrived traj0") %&gt;%
  batch(2, name = "mybatch")

traj1 &lt;- trajectory() %&gt;%
  log_("arrived traj1") %&gt;%
  timeout(1) %&gt;%
  batch(2, name = "mybatch") %&gt;%
  log_("in a batch") %&gt;%
  timeout(2) %&gt;%
  separate() %&gt;%
  log_("leaving traj1")

simmer() %&gt;%
  add_generator("dummy0", traj0, at(0)) %&gt;%
  add_generator("dummy1", traj1, at(0)) %&gt;%
  run() %&gt;% invisible

</code></pre>


</div>