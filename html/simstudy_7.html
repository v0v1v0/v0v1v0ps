<div class="container">

<table style="width: 100%;"><tr>
<td>addCorGen</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create multivariate (correlated) data - for general distributions</h2>

<h3>Description</h3>

<p>Create multivariate (correlated) data - for general distributions
</p>


<h3>Usage</h3>

<pre><code class="language-R">addCorGen(
  dtOld,
  nvars = NULL,
  idvar = "id",
  rho = NULL,
  corstr = NULL,
  corMatrix = NULL,
  dist,
  param1,
  param2 = NULL,
  cnames = NULL,
  method = "copula",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dtOld</code></td>
<td>
<p>The data set that will be augmented. If the data set includes a
single record per id, the new data table will be created as a "wide" data set.
If the original data set includes multiple records per id, the new data set will
be in "long" format.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nvars</code></td>
<td>
<p>The number of new variables to create for each id. This is only applicable
when the data are generated from a data set that includes one record per id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>idvar</code></td>
<td>
<p>String variable name of column represents individual level id for correlated
data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>Correlation coefficient, -1 &lt;= rho &lt;= 1. Use if corMatrix is not provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corstr</code></td>
<td>
<p>Correlation structure of the variance-covariance matrix
defined by sigma and rho. Options include "cs" for a compound symmetry structure
and "ar1" for an autoregressive structure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corMatrix</code></td>
<td>
<p>Correlation matrix can be entered directly. It must be symmetrical and
positive semi-definite. It is not a required field; if a matrix is not provided, then a
structure and correlation coefficient rho must be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>A string indicating "normal", "binary", "poisson" or "gamma".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param1</code></td>
<td>
<p>A string that represents the column in dtOld that contains the parameter
for the mean of the distribution. In the case of the uniform distribution the column
specifies the minimum.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param2</code></td>
<td>
<p>A string that represents the column in dtOld that contains a possible second
parameter for the distribution. For the normal distribution, this will be the variance;
for the gamma distribution, this will be the dispersion; and for the uniform distribution,
this will be the maximum.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cnames</code></td>
<td>
<p>Explicit column names. A single string with names separated
by commas. If no string is provided, the default names will be V#, where #
represents the column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Two methods are available to generate correlated data. (1) "copula" uses
the multivariate Gaussian copula method that is applied to all other distributions; this
applies to all available distributions. (2) "ep" uses an algorithm developed by
Emrich and Piedmonte (1991).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>May include additional arguments that have been deprecated and are
no longer used.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The original data table can come in one of two formats: a single row
per <strong>idvar</strong> (where data are <em>ungrouped</em>) or multiple rows per <strong>idvar</strong> (in which
case the data are <em>grouped</em> or clustered). The structure of the arguments
depends on the format of the data.
</p>
<p>In the case of <em>ungrouped</em> data, there are two ways to specify the number of
correlated variables and the covariance matrix. In approach (1),
<strong>nvars</strong> needs to be specified along with <strong>rho</strong> and <strong>corstr</strong>.
In approach (2), <strong>corMatrix</strong> may be specified by identifying a single square
<em>n</em> x <em>n</em> covariance matrix. The number of new variables generated for each
record will be <em>n</em>. If <strong>nvars</strong>, <strong>rho</strong>,
<strong>corstr</strong>, and <strong>corMatrix</strong> are all specified, the data will be
generated based on the information provided in the covariance matrix alone.
In both (1) and (2), the data will be returned in a wide format.
</p>
<p>In the case of <em>grouped</em> data, where there are <em>G</em> groups, there are also two
ways to proceed. In both cases,
the number of new variables to be generated may vary by group, and will be determined by the
number of records in each group, <code class="reqn">n_i, i \in \{1,...,G\}</code> (i.e., the number of records that share the same
value of <em>idvar</em>). <strong>nvars</strong> is not used in grouped data.
In approach (1), the arguments <strong>rho</strong> and <strong>corstr</strong> may both be specified
to determine the structure of the covariance
matrix. In approach (2), the argument <strong>corMatrix</strong> may be specified.
<strong>corMatrix</strong> can be a single matrix with dimensions <code class="reqn">n \ \text{x} \ n</code> if
<code class="reqn">n_i = n</code> for all <em>i</em>. However, if the sample sizes of each group vary
(i.e., <code class="reqn">n_i \ne n_j</code> for some groups <em>i</em> and <em>j</em>), <strong>corMatrix</strong> must be a list
of covariance matrices with a length <em>G</em>; each
covariance matrix in the list will have dimensions
<code class="reqn">n_i \ \text{x} \ n_i, \ i \in \{1,...,G\}</code>. In the case of <em>grouped</em> data, the
new data will be returned in <em>long</em> format (i.e., one new column only).
</p>


<h3>Value</h3>

<p>Original data.table with added column(s) of correlated data
</p>


<h3>References</h3>

<p>Emrich LJ, Piedmonte MR. A Method for Generating High-Dimensional
Multivariate Binary Variates. The American Statistician 1991;45:302-4.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Ungrouped data

cMat &lt;- genCorMat(nvars = 4, rho = .2, corstr = "ar1", nclusters = 1)

def &lt;-
  defData(varname = "xbase", formula = 5, variance = .4, dist = "gamma") |&gt;
  defData(varname = "lambda", formula = ".5 + .1*xbase", dist = "nonrandom", link = "log") |&gt;
  defData(varname = "n", formula = 3, dist = "noZeroPoisson")

dd &lt;- genData(101, def, id = "cid")

## Specify with nvars, rho, and corstr

addCorGen(
  dtOld = dd, idvar = "cid", nvars = 3, rho = .7, corstr = "cs",
  dist = "poisson", param1 = "lambda"
)

## Specify with covMatrix

addCorGen(
  dtOld = dd, idvar = "cid", corMatrix = cMat,
  dist = "poisson", param1 = "lambda"
)

# Grouped data

cMats &lt;- genCorMat(nvars = dd$n, rho = .5, corstr = "cs", nclusters = nrow(dd))

dx &lt;- genCluster(dd, "cid", "n", "id")

## Specify with nvars, rho, and corstr

addCorGen(
  dtOld = dx, idvar = "cid", rho = .8, corstr = "ar1", dist = "poisson", param1 = "xbase"
)

## Specify with covMatrix

addCorGen(
 dtOld = dx, idvar = "cid", corMatrix = cMats, dist = "poisson", param1 = "xbase"
)

</code></pre>


</div>