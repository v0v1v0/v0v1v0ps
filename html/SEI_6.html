<div class="container">

<table style="width: 100%;"><tr>
<td>get_pit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate probability integral transform values</h2>

<h3>Description</h3>

<p>Function to estimate the cumulative distribution function (CDF)
from a set of observations, and return the corresponding probability integral
transform (PIT) values.
</p>


<h3>Usage</h3>

<pre><code class="language-R">get_pit(
  x_ref,
  x_new = x_ref,
  dist = "empirical",
  preds_ref = NULL,
  preds_new = preds_ref,
  method = "mle",
  return_fit = FALSE,
  lower = -Inf,
  upper = Inf,
  cens = "none",
  n_thres = 10,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x_ref</code></td>
<td>
<p>numeric vector from which to estimate the CDF.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_new</code></td>
<td>
<p>numeric vector from which to calculate the PIT values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>character string specifying the distribution to be fit to the data;
one of <code>'empirical'</code>, <code>'kde'</code>, <code>'norm'</code>, <code>'lnorm'</code>, <code>'logis'</code>, <code>'llogis'</code>,
<code>'exp'</code>, <code>'gamma'</code>, and <code>'weibull'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>preds_ref</code></td>
<td>
<p>data frame of predictor variables on which the estimated distribution
should depend, corresponding to the reference observations <code>x_ref</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>preds_new</code></td>
<td>
<p>data frame of predictor variables on which the estimated distribution
should depend, corresponding to the new observations <code>x_new</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A character string coding for the fitting method: 
<code>"mle"</code> for 'maximum likelihood estimation', <code>"mme"</code> for 'moment matching estimation', 
<code>"qme"</code> for 'quantile matching estimation', <code>"mge"</code> for 'maximum goodness-of-fit estimation'
and <code>"mse"</code> for 'maximum spacing estimation'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_fit</code></td>
<td>
<p>logical specifying whether to return parameters and goodness-of-fit
statistics for the distribution fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower, upper</code></td>
<td>
<p>numeric values specifying the lower and upper bounds at which the
values in <code>x_ref</code> and <code>x_new</code> are censored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens</code></td>
<td>
<p>method used to deal with censoring of the PIT values; either a string
(<code>'none'</code>, <code>'normal'</code> or <code>'prob'</code>), corresponding to common choices, or a custom numeric value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_thres</code></td>
<td>
<p>minimum number of data points required to estimate the distribution;
default is 10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments to be passed to <code>fitdist</code> or
<code>gamlss</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><strong>Continuous data</strong>
</p>
<p>If <code class="reqn">X</code> is a continuous random variable with cumulative distribution function (CDF)
<code class="reqn">F</code>, then the probability integral transform (PIT) <code class="reqn">F(X)</code> is uniformly distributed
between 0 and 1. Given a vector <code class="reqn">x_{1}, \dots, x_{n}</code> of realisations of <code class="reqn">X</code>,
<code>get_pit</code> produces an estimate <code class="reqn">\hat{F}</code> of the CDF <code class="reqn">F</code>, and returns a
vector of PIT values corresponding to another set of realisations <code class="reqn">z_{1}, \dots, z_{N}</code>,
</p>
<p style="text-align: center;"><code class="reqn">\hat{F}(z_{1}), \dots, \hat{F}(z_{n}).</code>
</p>

<p><code>x_ref</code> contains the values <code class="reqn">x_{1}, \dots, x_{n}</code> from which the CDF estimate
<code class="reqn">\hat{F}</code> is obtained. <code>x_new</code> contains the values <code class="reqn">z_{1}, \dots, z_{n}</code>
from which the PIT values <code class="reqn">\hat{F}(z_{1}), \dots, \hat{F}(z_{n})</code> are calculated.
By default, <code>x_ref</code> and <code>x_new</code> are the same, so that the PIT values are
calculated in-sample.
</p>
<p>To estimate the distribution, <code>get_pit</code> calls <code>fit_dist</code>. The arguments
<code>dist</code>, <code>method</code> and <code>n_thres</code> are
documented in detail in the corresponding help page.
</p>
<p>To check that the chosen distribution adequately fits the data, the argument
<code>return_fit = TRUE</code> can be used to return the estimated parameters of the
distribution, as well as properties of the fit such as the AIC and a p-value
for the Kolmogorov-Smirnov goodness-of-fit test.
</p>
<p><strong>Non-stationary distributions</strong>
</p>
<p>The estimated distribution can also be non-stationary, by depending on some predictor variables or covariates.
These predictors can be included via the arguments <code>preds_ref</code> and <code>preds_new</code>,
which should be data frames with a separate column for each predictor, and with
numbers of rows equal to the lengths of <code>x_ref</code> and <code>x_new</code>, respectively.
In this case, a Generalized Additive Model for Location, Scale, and Shape (GAMLSS) is
fit to <code>x_ref</code> using the predictors in <code>preds_ref</code>.
The PIT values corresponding to <code>x_new</code> are then calculated by applying the
estimated distribution with predictors <code>preds_new</code>.
If a non-stationary distribution is to be estimated, both <code>preds_ref</code> and
<code>preds_new</code> must be provided. By default, <code>preds_new</code> is assumed to be
the same as <code>preds_ref</code>, to align with <code>x_new</code> being the same as <code>x_ref</code>.
</p>
<p><strong>Censored data</strong>
</p>
<p>If the random variable <code class="reqn">X</code> is not continuous, the PIT will not be uniformly distributed.
A relevant case is when <code class="reqn">X</code> is censored. For example, precipitation is censored below
at zero. This results in several PIT values being equal to <code class="reqn">F(0)</code>. The <code>lower</code>
and <code>upper</code> arguments to <code>get_pit</code> allow the user to specify the lower and upper
bounds at which the data is censored; the default is <code>lower = -Inf</code> and <code>upper = Inf</code>,
i.e. there is no censoring.
</p>
<p>If the PIT values are used to construct standardised indices, this censoring can lead to
unintuitive index values.
To deal with censored data, it has been proposed to map the PIT values of the censored
values to a different constant <code class="reqn">c</code>; see references. For example, for precipitation, the PIT
values would become
</p>
<p style="text-align: center;"><code class="reqn">F(X) \quad \text{if} \quad X &gt; 0,</code>
</p>

<p style="text-align: center;"><code class="reqn">c \quad \text{if} \quad X = 0.</code>
</p>

<p>The constant <code class="reqn">c</code> can be chosen so that the PIT values satisfy some desired property.
For example, if <code class="reqn">F(X)</code> is uniformly distributed between 0 and 1, then it has mean equal
to <code class="reqn">1/2</code>. Hence, <code class="reqn">c</code> could be chosen such that the mean of the PIT values of the
censored distribution are equal to <code class="reqn">1/2</code>.
Alternatively, if <code class="reqn">F(X)</code> is uniformly distributed between 0 and 1, then
the transformed PIT value <code class="reqn">\Phi^{-1}(F(X))</code> (where <code class="reqn">\Phi^{-1}</code> is the quantile function
of the standard normal distribution) follows a standard normal distribution, and therefore
has mean equal to 0. The constant <code class="reqn">c</code> could therefore be chosen such that the mean of the
transformed PIT values of the censored distribution are equal to 0.
</p>
<p>The argument <code>cens</code> in <code>get_pit</code> can be used to treat censored data. <code>cens</code>
can be one of four options: a single numeric value containing the value <code class="reqn">c</code> at which to
assign the PIT values of the censored realisations; the string <code>'none'</code> if no censoring
is to be performed; the string <code>'prob'</code> if <code class="reqn">c</code>
is to be chosen automatically so that the mean of the PIT values is equal to <code class="reqn">1/2</code>;
or the string <code>'normal'</code> if <code class="reqn">c</code> is to be chosen automatically so that the mean of
the transformed PIT values is equal to 0. If the data is censored both above and below,
then <code>cens</code> must be a numeric vector of length two, specifying the values to assign
the realisations that are censored both below and above.
</p>
<p>When the data is censored, <code>dist</code> corresponds to the distribution used to estimate the
uncensored realisations, e.g. positive precipitations. The probability of being at the boundary
points is estimated using the relative frequency of censored observations in <code>x_ref</code>.
</p>


<h3>Value</h3>

<p>A vector of PIT values if <code>return_fit = FALSE</code>, or, if <code>return_fit = TRUE</code>,
a list containing the estimated distribution function (<code>F_x</code>), its parameters
(<code>params</code>), and properties of the fit such as the AIC and
Kolmogorov-Smirnov goodness-of-fit statistic (<code>fit</code>). If the estimated distribution
function depends on covariates, then the <code>gamlss</code> model fit is returned as the
parameters.
</p>


<h3>Author(s)</h3>

<p>Sam Allen, Noelia Otero
</p>


<h3>References</h3>

<p>Rigby, R. A., &amp; Stasinopoulos, D. M. (2005):
‘Generalized additive models for location, scale and shape’,
<em>Journal of the Royal Statistical Society Series C: Applied Statistics</em> 54, 507-554.
<a href="https://doi.org/10.1111/j.1467-9876.2005.00510.x">doi:10.1111/j.1467-9876.2005.00510.x</a>
</p>
<p>Stagge, J. H., Tallaksen, L. M., Gudmundsson, L., Van Loon, A. F., &amp; Stahl, K. (2015):
‘Candidate distributions for climatological drought indices (SPI and SPEI)’,
<em>International Journal of Climatology</em> 35, 4027-4040.
<a href="https://doi.org/10.1002/joc.4267">doi:10.1002/joc.4267</a>
</p>
<p>Allen, S. &amp; N. Otero (2023):
‘Calculating standardised indices using SEI’,
<em>EarthArXiv pre-print</em>.
<a href="https://doi.org/10.31223/X5GM4G">doi:10.31223/X5GM4G</a>
</p>


<h3>See Also</h3>

<p><code>fit_dist</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">N &lt;- 1000
shape &lt;- 3
rate &lt;- 2

x_ref &lt;- rgamma(N, shape, rate)
x_new &lt;- rgamma(N, shape, rate)

# empirical distribution
pit &lt;- get_pit(x_ref, x_new)
hist(pit)

# gamma distribution
pit &lt;- get_pit(x_ref, x_new, dist = "gamma", return_fit = TRUE)
hist(pit$pit)

hist(x_ref, breaks = 30, probability = TRUE)
lines(seq(0, 10, 0.01), dgamma(seq(0, 10, 0.01), pit$params[1], pit$params[2]), col = "blue")


# weibull distribution
pit &lt;- get_pit(x_ref, x_new, dist = "weibull", return_fit = TRUE)
hist(pit$pit)

hist(x_ref, breaks = 30, probability = TRUE)
lines(seq(0, 10, 0.01), dweibull(seq(0, 10, 0.01), pit$params[1], pit$params[2]), col = "blue")


# exponential distribution
pit &lt;- get_pit(x_ref, x_new, dist = "exp", return_fit = TRUE)
hist(pit$pit)

hist(x_ref, breaks = 30, probability = TRUE)
lines(seq(0, 10, 0.01), dexp(seq(0, 10, 0.01), pit$params[1]), col = "blue")


# gamma distribution with censoring
x_ref &lt;- c(x_ref, numeric(N))
pit &lt;- get_pit(x_ref, dist = "gamma", lower = 0, cens = "prob")
hist(pit)
mean(pit) # = 1/2
mean(qnorm(pit)) # != 0

pit &lt;- get_pit(x_ref, dist = "gamma", lower = 0, cens = "normal")
hist(qnorm(pit))
mean(pit) # != 1/2
mean(qnorm(pit)) # = 0


## normal distribution with trend in mean
x &lt;- seq(-10, 20, length.out = N)
x_ref &lt;- rnorm(N, x + shape, 2)
plot(x_ref)
preds &lt;- data.frame(t = x)

pit &lt;- get_pit(x_ref, preds_ref = preds, dist = "norm")
hist(pit)

## normal distribution with trend in mean and standard deviation
x_ref &lt;- rnorm(N, x + shape, exp(x/10))
plot(x_ref)
preds &lt;- data.frame(t = x)

pit &lt;- get_pit(x_ref, preds_ref = preds, dist = "norm", sigma.formula = ~ .)
hist(pit)
# sigma.formula is an optional argument in the gamlss::gamlss function


</code></pre>


</div>