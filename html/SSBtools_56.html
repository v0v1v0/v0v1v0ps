<div class="container">

<table style="width: 100%;"><tr>
<td>HierarchiesAndFormula2ModelMatrix</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Model matrix representing crossed hierarchies according to a formula</h2>

<h3>Description</h3>

<p>How to cross the hierarchies are defined by a formula. The formula is automatically simplified when totals are involved.
</p>


<h3>Usage</h3>

<pre><code class="language-R">HierarchiesAndFormula2ModelMatrix(
  data,
  hierarchies,
  formula,
  inputInOutput = TRUE,
  makeColNames = TRUE,
  crossTable = FALSE,
  total = "Total",
  simplify = TRUE,
  hierarchyVarNames = c(mapsFrom = "mapsFrom", mapsTo = "mapsTo", sign = "sign", level =
    "level"),
  unionComplement = FALSE,
  removeEmpty = FALSE,
  reOrder = TRUE,
  sep = "-",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Matrix or data frame with data containing codes of relevant variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hierarchies</code></td>
<td>
<p>List of hierarchies, which can be converted by <code>AutoHierarchies</code>.
Thus, the variables can also be coded by <code>"rowFactor"</code> or <code>""</code>, which correspond to using the categories in the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A model formula</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inputInOutput</code></td>
<td>
<p>Logical vector (possibly recycled) for each element of hierarchies.
TRUE means that codes from input are included in output. Values corresponding to <code>"rowFactor"</code> or <code>""</code> are ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>makeColNames</code></td>
<td>
<p>Colnames included when TRUE (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crossTable</code></td>
<td>
<p>Cross table in output when TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>total</code></td>
<td>
<p>Vector of total codes (possibly recycled) used when running <code>Hrc2DimList</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simplify</code></td>
<td>
<p>When TRUE (default) the model can be simplified when total codes are found in the hierarchies (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hierarchyVarNames</code></td>
<td>
<p>Variable names in the hierarchy tables as in <code>HierarchyFix</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unionComplement</code></td>
<td>
<p>Logical vector (possibly recycled) for each element of hierarchies.
When TRUE, sign means union and complement instead of addition or subtraction.
Values corresponding to <code>"rowFactor"</code> and <code>"colFactor"</code> are ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>removeEmpty</code></td>
<td>
<p>When TRUE, empty columns (only zeros) are not included in output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reOrder</code></td>
<td>
<p>When TRUE (default) output codes are ordered in a way similar to a usual model matrix ordering.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep</code></td>
<td>
<p>String to separate when creating column names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Extra unused parameters</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A sparse model matrix or a list of two elements (model matrix and cross table)
</p>


<h3>Author(s)</h3>

<p>Ã˜yvind Langsrud
</p>


<h3>See Also</h3>

<p><code>ModelMatrix</code>, <code>Hierarchies2ModelMatrix</code>, <code>Formula2ModelMatrix</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Create some input
z &lt;- SSBtoolsData("sprt_emp_withEU")
ageHier &lt;- SSBtoolsData("sprt_emp_ageHier")
geoDimList &lt;- FindDimLists(z[, c("geo", "eu")], total = "Europe")[[1]]

# Shorter function name
H &lt;- HierarchiesAndFormula2ModelMatrix

# Small dataset example. Two dimensions.
s &lt;- z[z$geo == "Spain", ]
geoYear &lt;- list(geo = geoDimList, year = "")
m &lt;- H(s, geoYear, ~geo * year, inputInOutput = c(FALSE, TRUE))
print(m, col.names = TRUE)
attr(m, "total")     # Total code 'Europe' is found
attr(m, "startCol")  # Two model terms needed

# Another model and with crossTable in output
H(s, geoYear, ~geo + year, crossTable = TRUE)

# Without empty columns  
H(s, geoYear, ~geo + year, crossTable = TRUE, removeEmpty = TRUE)

# Three dimensions
ageGeoYear &lt;- list(age = ageHier, geo = geoDimList, year = "allYears")
m &lt;- H(z, ageGeoYear, ~age * geo + geo * year)
head(colnames(m))
attr(m, "total")
attr(m, "startCol")

# With simplify = FALSE
m &lt;- H(z, ageGeoYear, ~age * geo + geo * year, simplify = FALSE)
head(colnames(m))
attr(m, "total")
attr(m, "startCol")

# Compute aggregates
m &lt;- H(z, ageGeoYear, ~geo * age, inputInOutput = c(TRUE, FALSE, TRUE))
t(m) %*% z$ths_per

# Without hierarchies. Only factors.
ageGeoYearFactor &lt;- list(age = "", geo = "", year = "")
t(H(z, ageGeoYearFactor, ~geo * age + year:geo))
</code></pre>


</div>