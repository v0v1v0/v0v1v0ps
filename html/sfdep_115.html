<div class="container">

<table style="width: 100%;"><tr>
<td>st_nb_apply</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Apply a function to neighbors</h2>

<h3>Description</h3>

<p>Sometimes one may want to create custom lag variables or create some other neighborhood level metric that may not be defined yet. This <code>st_nb_apply()</code> enables you to apply a function to each observation's (xi) neighbors (xij).
</p>


<h3>Usage</h3>

<pre><code class="language-R">st_nb_apply(x, nb, wt, .f, suffix = "dbl", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A vector that will be used for neighbor xij values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nb</code></td>
<td>
<p>A neighbor list object as created by <code>st_neighbors()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wt</code></td>
<td>
<p>A weights list as created by <code>st_weights()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.f</code></td>
<td>
<p>A function definition. There are three default objects that can be used inside of the function definition:
</p>

<ul>
<li> <p><code>.xij</code>: neighbor values of <code>x</code> for the ith observation. This is simply the subset of x based on the corresponding <code>nb</code> list values for each element.
</p>
</li>
<li> <p><code>.nb</code>: neighbor positions.
</p>
</li>
<li> <p><code>.wt</code>: neighbor weights value.
</p>
</li>
</ul>
<p>If any of these three function arguments are omitted from <code>.f</code>, dots (<code>...</code>) must be supplied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>suffix</code></td>
<td>
<p>The <code>map</code> variant to use. Options are "dbl", "int", "lgl", "chr", "list".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to pass to <code>.f</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The below example calculates the spatial lag using <code>st_nb_apply()</code> and <code>st_lag()</code> to illustrate how we can apply functions to neighbors.
</p>
<p>Currently questioning the use case. <code>find_xj()</code> is now exported and may negate the need for this function.
</p>


<h3>Value</h3>

<p>a vector or list of with same length as <code>x</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">if (requireNamespace("dplyr", quietly = TRUE)) {
library(magrittr)
guerry %&gt;%
  dplyr::transmute(
    nb = st_contiguity(geometry),
    wt = st_weights(nb),
    lag_apply = st_nb_apply(
      crime_pers, nb, wt,
      .f = function(.xij, .wt, ...) sum(.xij *.wt)
    ),
    lag = st_lag(crime_pers, nb, wt)
  )
}
</code></pre>


</div>