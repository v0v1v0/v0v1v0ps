<div class="container">

<table style="width: 100%;"><tr>
<td>speedglm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting Generalized Linear Models for Large Data Sets</h2>

<h3>Description</h3>

<p><code>speedglm</code> and <code>speedglm.wfit</code> fit GLMs to medium-large 
data sets, that is those storable into the R memory. The highest performances, in terms of computation time,
are obtained when R is linked against an optimized BLAS, such as ATLAS. The function <code>shglm</code> 
is for a data set stored into a file of size greater than the available memory, and takes as 
argument a function to manipulate connections. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'data.frame':
speedglm(formula,data,family=gaussian(),weights=NULL,start=NULL,
         etastart=NULL,mustart=NULL,offset=NULL,maxit=25, k=2, 
         sparse=NULL,set.default=list(), trace=FALSE,
         method=c('eigen','Cholesky','qr'), model=FALSE, y=FALSE, 
         fitted=FALSE,...)

## S3 method for class 'matrix':       
speedglm.wfit(y, X, intercept=TRUE, weights=NULL,row.chunk=NULL,
              family=gaussian(), start=NULL, etastart=NULL,
              mustart=NULL, offset=NULL, acc=1e-08, maxit=25, k=2,
              sparselim=.9,camp=.01, eigendec=TRUE, tol.values=1e-7,
              tol.vectors=1e-7, tol.solve=.Machine$double.eps,
              sparse=NULL,method = c('eigen','Cholesky','qr'), 
              trace=FALSE,...)
              
## S3 method for class 'function':              
shglm(formula, datafun, family = gaussian(), weights.fo = NULL, start = NULL, 
      etastart = NULL, mustart = NULL, offset = NULL, maxit = 25, k = 2, 
      chunksize = 5000, sparse = NULL, trace = FALSE, all.levels = FALSE,
      set.default = list(),...)
     
</code></pre>


<h3>Arguments</h3>

<p>Most of arguments are the same of glm or bigglm 
but with some difference.     
</p>
<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>the same of <code>glm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datafun</code></td>
<td>
<p>a function which uses connections. See the example below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>the same of <code>glm</code>, but it must be specified with brackets.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>the same of <code>glm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>the same of <code>glm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights.fo</code></td>
<td>
<p>weights for the response. It must be specified as a formula 
(see the example below).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>etastart</code></td>
<td>
<p>the same of <code>glm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mustart</code></td>
<td>
<p>the same of <code>glm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>the same of <code>glm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>the same of <code>glm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>the same of <code>x</code> in <code>glm.fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the same of <code>glm</code> and <code>glm.fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>the same of <code>glm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>numeric, the penalty per parameter to be used; the default k = 2 is
the classical AIC.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>logical. Do you want to be informed about the model estimation 
progress?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparse</code></td>
<td>
<p>logical. Is the model matrix sparse? By default is NULL, so a 
quickly sample survey will be made.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunksize</code></td>
<td>
<p>an integer indicates the number of rows of the data file to 
read at time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all.levels</code></td>
<td>
<p>logical, are all factor's levels present in each data chunk?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>set.default</code></td>
<td>
<p>a list in which to specify the below parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparselim</code></td>
<td>
<p>a real in the interval [0, 1]. It indicates the minimal 
proportion of zeroes in the data matrix X in order to consider X as sparse.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>camp</code></td>
<td>
<p>see the function is.sparse.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eigendec</code></td>
<td>
<p>logical. Do you want to check the rank of X? You may set it to 
false if you are sure that X is full rank.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>row.chunk</code></td>
<td>
<p>an integer, see the function cp for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>acc</code></td>
<td>
<p>tolerance to be used for the estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol.solve</code></td>
<td>
<p>see the function solve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol.values</code></td>
<td>
<p>see the function control.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol.vectors</code></td>
<td>
<p>see the function control.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>the method chosen to detect for singulatity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>logical. If TRUE the model frame will be returned. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted</code></td>
<td>
<p>logical. If TRUE the fitted values will be returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further optional arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function <code>shglm</code> works like
<code>biglm</code>, but it checks for singularity and does not impose restrictions on 
factors. Since during the IWLS estimation <code>shglm</code> uses repeated accesses to 
data file stored, for example, into the hard disk, the estimation time could be very long. 
Unlike from <code>glm</code> or <code>biglm</code>, the functions of class 'speedglm' do not use 
the QR decomposition, but directly solve the equations in the form of Iterative(-ly) (Re-)Weighted Least Squares (IWLS). 
The memory size of an object of class 'speedglm' is <code class="reqn">O(p^2)</code>, where <code class="reqn">p</code> is the number of covariates, unless one or more of argument <code>model</code>, <code>y</code> and <code>fitted</code> are set to TRUE. If an optimized BLAS 
is not installed, an attempt to speed up calculations might be done by setting <code>row.chunk</code> 
to some value, usually less than 1000, in <code>set.default</code>. See the function cp for details.<br>
If the model matrix is (very) sparse, the package <code>Matrix</code> could be used.
Note that if method 'qr' is chosen, then the qr decomposition will not be applied on matrix X, as in <code>lm</code>, 
but on X'WX.   
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>the estimated coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logLik</code></td>
<td>
<p>the log likelihood of the fitted model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>the number of iterations of IWLS used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>the maximal value of tolerance reached.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convergence</code></td>
<td>
<p>a logical value which indicates if convergence was reached.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>the family object used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link</code></td>
<td>
<p>the link function used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>the degrees of freedom of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>XTX</code></td>
<td>
<p>the product X'X (weighted, if the case).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dispersion</code></td>
<td>
<p>the estimated dispersion parameter of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ok</code></td>
<td>
<p>the set of column indeces of the model matrix where the model has
been fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rank</code></td>
<td>
<p>the rank of the model matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RSS</code></td>
<td>
<p>the estimated residual sum of squares of the fitted model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aic</code></td>
<td>
<p>the estimated Akaike Information Criterion.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparse</code></td>
<td>
<p>a logical value which indicates if the model matrix is sparse.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviance</code></td>
<td>
<p>the estimated deviance of the fitted model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nulldf</code></td>
<td>
<p>the degrees of freedom of the null model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nulldev</code></td>
<td>
<p>the estimated deviance of the null model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ngoodobs</code></td>
<td>
<p>the number of non-zero weighted observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>the number of observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>a logical value which indicates if an intercept has been used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>terms</code></td>
<td>
<p>the terms object used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>Either NULL or, if <code>model</code> was previously set to TRUE, the model frame. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Either NULL or, if <code>y</code> was previously set to TRUE, the response variable. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linear.predictors</code></td>
<td>
<p>Either NULL or, if <code>fitted</code> was previously set to TRUE, the fitted values. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>the model offset.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>All the above functions make an object of class 'speedglm'.<br>
In the current package version, arguments <code>start</code>, <code>mustart</code> and <code>etastart</code> of function <code>shglm</code> have been disabled. 
These will be restored in future.</p>


<h3>Author(s)</h3>

<p> Marco Enea. Ronen Meiri contributed with method 'qr'</p>


<h3>References</h3>

<p>Enea, M. (2009) Fitting Linear Models and Generalized Linear Models with large data sets in R.
In <em>book of short papers, conference on “Statistical Methods for the analysis of large data-sets”,
Italian Statistical Society</em>, Chieti-Pescara, 23-25 September 2009, 411-414. ISBN:978-88-6129-425-7<br></p>
<p>Bates, D. (2009) Comparing Least Square Calculations. Technical report. <br></p>
<p>Lumley, T. (2009) biglm: bounded memory linear and generalized linear models. <em>R package version 0.7</em>.
<a href="https://CRAN.R-project.org/package=biglm">https://CRAN.R-project.org/package=biglm</a>.
</p>


<h3>See Also</h3>

 <p>speedlm, bigglm, glm </p>


<h3>Examples</h3>

<pre><code class="language-R">

# The following comparison among glm(), bigglm() and speedglm() cannot be considered rigorous 
# and exhaustive, but it is only to give an idea of the computation time. 
# It may take a long time.
library(biglm)
n&lt;-10000
k&lt;-70
y &lt;- rgamma(n,1.5,1)
x &lt;-round( matrix(rnorm(n*k),n,k),digits=3)
colnames(x) &lt;-paste("s",1:k,sep = "")
da&lt;- data.frame(y,x)
fo &lt;- as.formula(paste("y~",paste(paste("s",1:k,sep=""),collapse="+")))   

system.time(m1 &lt;- glm(fo,data=da,family=Gamma(log)))
system.time(m2 &lt;- bigglm(fo,data=da,family=Gamma(log)))
system.time(m3 &lt;- speedglm(fo,data=da,family=Gamma(log)))

# You may also try speedglm when R is linked against an optimized BLAS,
# otherwise try to run the following function. In some computers, it is
# faster for large data sets.
system.time(m4 &lt;- speedglm(fo,data=da,family=Gamma(log),set.default=list(row.chunk=50)))

##################

## An example of function using a connection to an out-memory file  
## This is a slightly modified version of the function from the bigglm's help page 
 make.data&lt;-function(filename, chunksize,...){       
     conn&lt;-NULL
     function(reset=FALSE){
     if(reset){
       if(!is.null(conn)) close(conn)
       conn&lt;&lt;-file(filename,open="r")
     } else{
       rval&lt;-read.table(conn, nrows=chunksize,...)
       if ((nrow(rval)==0)) {
            close(conn)
            conn&lt;&lt;-NULL
            rval&lt;-NULL
       }
       return(rval)
     }
  }
}


# data1 is a small toy dataset
data(data1)
tmp_data1&lt;-tempfile("data1",fileext=".txt")
write.table(data1,tmp_data1,row.names=FALSE,col.names=FALSE)

da&lt;-make.data(tmp_data1,chunksize=50,col.names=c("y","fat1","x1","x2"))

# Caution! make sure to close the connection once you have run command #1
da(reset=TRUE) #1: opens the connection to "data1.txt"
da(reset=FALSE) #2: reads the first 50 rows (out of 100) of the dataset
da(reset=FALSE) #3: reads the second 50 rows (out of 100) of the dataset
da(reset=FALSE) #4: is NULL: this latter command closes the connection

# fat1 is a factor with four levels                                    
b1&lt;-shglm(y~factor(fat1)+x1,weights=~I(x2^2),datafun=da,family=Gamma(log))
b2&lt;-bigglm(y~factor(fat1)+x1,weights=~I(x2^2),data=da,family=Gamma(log))
summary(b1) 
summary(b2) 

</code></pre>


</div>