<div class="container">

<table style="width: 100%;"><tr>
<td>make_interim_MP</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Make a custom management procedure (MP)</h2>

<h3>Description</h3>

<p>Function operator that creates a management procedure (MP) by combining an assessment model (function of class <code>Assess</code>) with
a harvest control rule (function of class <code>HCR</code>). The resulting function can then be tested in closed-loop simulation via
<code>MSEtool::runMSE()</code>.
</p>

<ul>
<li>
<p> Use <code>make_MP</code> to specify constant TAC between assessments; the frequency of
assessments is specified in <code>OM@interval</code>.
</p>
</li>
<li>
<p> Use <code>make_projection_MP</code> to set catches according to a schedule set by projections,
specify assessment frequency in argument <code>assessment_interval</code> and ensure that <code>OM@interval &lt;- 1</code>.
</p>
</li>
<li>
<p> Use <code>make_interim_MP</code> to use an interim procedure to adjust the TAC between
assessments using an index (Huynh et al. 2020), with the frequency of assessments specified in argument <code>assessment_interval</code> when
making the MP; ensure that <code>OM@interval &lt;- 1</code>.
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">make_interim_MP(
  .Assess = "SCA",
  .HCR = "HCR_MSY",
  AddInd = "VB",
  assessment_interval = 5,
  type = c("buffer", "mean", "loess", "none"),
  type_par = NULL,
  diagnostic = c("min", "full", "none"),
  ...
)

make_projection_MP(
  .Assess = "SCA",
  .HCR = "HCR_MSY",
  assessment_interval = 5,
  Ftarget = expression(Assessment@FMSY),
  proj_args = list(process_error = 1, p_sim = 1),
  diagnostic = c("min", "full", "none"),
  ...
)

make_MP(.Assess, .HCR, diagnostic = c("min", "full", "none"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.Assess</code></td>
<td>
<p>Assessment model, a function of class <code>Assess</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.HCR</code></td>
<td>
<p>Harvest control rule, a function of class <code>HCR</code>. Currently not used in projection MPs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AddInd</code></td>
<td>
<p>A vector of integers or character strings indicating the indices to be used in the assessment model.
Integers assign the index to the corresponding index in Data@AddInd, "B" (or 0) represents total biomass in Data@Ind,
"VB" represents vulnerable biomass in Data@VInd, and "SSB" represents spawning stock biomass in Data@SpInd. For the interim
procedure, the function will use the first index in <code>AddInd</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assessment_interval</code></td>
<td>
<p>The time interval for when the assessment model is applied (number of years). In all other years, the
interim procedure is applied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>How the index is used to calculate the TAC in the interim procedure. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type_par</code></td>
<td>
<p>A control parameter for the interim procedure. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diagnostic</code></td>
<td>
<p>A character string describing if any additional diagnostic information from the
assessment models will be collected during the closed-loop simulation. <code>"min"</code> (minimal) will collect information
on convergence (default) and <code>"full"</code> will also collect the model estimates of biomass and F generated by <code>.Assess</code>.
<code>"none"</code> skips this step.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to be passed to <code>.Assess</code> and <code>.HCR</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ftarget</code></td>
<td>
<p>An expression that the MP will evaluate to identify the F used in the projection. See projection and example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proj_args</code></td>
<td>
<p>Additional arguments for projection.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>make_interim_MP</code> creates an MP that runs the interim procedure (updating the TAC according to index observations in between periodic
assessment intervals. <strong>Always ensure to set:</strong> <code>OM@interval &lt;- 1</code>. The assessment frequency is specified in argument
<code>assessment_interval</code>.
</p>
<p>In the year when the assessment is applied, the TAC is set by fitting the model and then running the harvest control rule. Between assessments,
the TAC is updated as
</p>
<p style="text-align: center;"><code class="reqn">
\textrm{TAC}_{y+1} = C_{\textrm{ref}} (I_y + b \times s)/(I_{\textrm{ref}} + b \times s)
</code>
</p>

<p>where <code>Cref</code> is the TAC calculated from the most recent assessment, <code>Iref</code> is the value of the index when <code>Cref</code> was calculated
(see Equations 6 and 7 of Huynh et al. 2020). The value of <code>I_y</code> depends on <code>type</code>, with <code>b</code> and <code>s</code> equal zero unless
<code>type = "buffer"</code>:
</p>

<ul>
<li> <p><code>"buffer"</code> - <code>I_y</code> is the most recent index with <code>b</code> is specifed by <code>type_par</code> (default = 1), and <code>s</code> is
the standard deviation of index residuals from the most recent assessment.
</p>
</li>
<li> <p><code>"mean"</code> - <code>I_y</code> is the mean value of the index over the most recent <code>type_par</code> years (default = 3).
</p>
</li>
<li> <p><code>"loess"</code> - <code>I_y</code> is the most recent index predicted by a loess smoother applied over the entire time series of the index.
Use <code>type_par</code> to adjust the <code>span</code> parameter (default = 0.75).
</p>
</li>
<li> <p><code>"none"</code> - <code>I_y</code> is the most recent index. Index values are not adjusted in the interim procedure.
</p>
</li>
</ul>
<h3>Value</h3>

<p>A function of class <code>MP</code>.
</p>


<h3>References</h3>

<p>Huynh et al. 2020. The interim management procedure approach for assessed stocks: Responsive management advice and lower assessment
frequency. Fish Fish. 21:663â€“679. <a href="https://doi.org/10.1111/faf.12453">doi:10.1111/faf.12453</a>
</p>


<h3>See Also</h3>

<p>HCR_ramp HCR_MSY diagnostic retrospective_AM
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Interim MPs
MP_buffer_5 &lt;- make_interim_MP(assessment_interval = 5)
MP_buffer_10 &lt;- make_interim_MP(assessment_interval = 10)
OM &lt;- MSEtool::testOM
OM@interval &lt;- 1

MSE &lt;- MSEtool::runMSE(OM, MPs = c("MP_buffer_5", "MP_buffer_10")) 

# A statistical catch-at-age model with a 40-10 control rule
SCA_40_10 &lt;- make_MP(SCA, HCR40_10)

# An SCA that will produce convergence diagnostics
SCA_40_10 &lt;- make_MP(SCA, HCR40_10, diagnostic = "min")

# MP with an SCA that uses a Ricker stock-recruit function.
SCA_Ricker &lt;- make_MP(SCA, HCR_MSY, SR = "Ricker")
show(SCA_Ricker)


# TAC is calculated annually from triennial assessments with projections between
# assessments with F = 0.75 FMSY
# Projections by default assume no process error.
OM &lt;- MSEtool::testOM
OM@interval &lt;- 1
pMP &lt;- make_projection_MP(SCA, assessment_interval = 3, 
                          Ftarget = expression(0.75 * Assessment@FMSY),
                          proj_args = list(process_error = 1))


</code></pre>


</div>