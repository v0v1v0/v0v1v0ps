<div class="container">

<table style="width: 100%;"><tr>
<td>SampleSize_SMARTp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Sample size calculation under a clustered SMART design for non-surgical treatment of chronic periodontitis</h2>

<h3>Description</h3>

<p>Sample size calculations to detect desired DTR effects, which includes (<code class="reqn">i</code>) a single regime, (<code class="reqn">ii</code>) difference between two regimes, and (<code class="reqn">iii</code>) a specific regime is the best,
based on CAL changes under the proposed clustered, two-stage, SMART trial given type I and type II error rates
</p>


<h3>Usage</h3>

<pre><code class="language-R">SampleSize_SMARTp(mu, st1, dtr, regime, pow, a, rho, tau, sigma1,
                  lambda, nu, sigma0, Num, p_i, c_i, a0, b0, cutoff)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>Mean matrix, where row represents each treatment path from the SMART design diagram (see Xu <em>et al.</em>, 2019), and
column represents each unit (i.e. tooth) within a cluster (i.e. mouth)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>st1</code></td>
<td>
<p>Stage-1 treatment matrix, where rows represent the corresponding stage-1 treatments,
the 1st column includes the number of treatment options for the responder, the 2nd
column include the numbers of treatment options for the non-responder, the 3rd column
are the response rates, and the 4th column includes the row numbers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dtr</code></td>
<td>
<p>Matrix of dimension (# of DTRs X 4), the 1st column represents the DTR numbers, the 2nd
column represents the treatment path number of responders for the corresponding DTRs in the
1st column, the 3rd column represents the corresponding treatment path number of the non-responders
for the corresponding DTRs in the 1st column, while the 4th column represents
the corresponding initial treatment</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regime</code></td>
<td>
<p>Treatment regime vector. For detecting regime 1 as the best, use c(1, 2, 3, 4, 5, 6, 7, 8). Similarly, if regime 2 is the best, use c(2, 1, 3, 4, 5, 6, 7, 8), and so on</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pow</code></td>
<td>
<p>Power or 1 - Type II error rate, default is 0.8</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>Type I error rate, default is 0.05</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>Association parameter of the CAR model, default is 0.975</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>Variance parameter of the CAR model, default is 0.85</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma1</code></td>
<td>
<p>Standard deviation of the residual for the continuous outcome <code class="reqn">Y_{it}</code>, default is 0.95</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>Skewness parameter of the residual for the continuous outcome <code class="reqn">Y_{it}</code>, default is 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nu</code></td>
<td>
<p>The degrees of freedom parameter of the residual for <code class="reqn">Y_{it}</code>, default is Inf</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma0</code></td>
<td>
<p>Standard deviation of the residual for the binary outcome <code class="reqn">M_{it}</code>, default is 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Num</code></td>
<td>
<p>Iteration size to estimate variance of <code class="reqn">\bar{Y}_i</code>, default is 100000</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_i</code></td>
<td>
<p>The expected proportion of available teeth for subject <code class="reqn">i</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>c_i</code></td>
<td>
<p>The average Pearson correlation coefficient between <code class="reqn">Y_{it}</code> and <code class="reqn">M_{it}</code> over the 28 teeth</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a0</code></td>
<td>
<p>Intercept parameter in the probit model for the binary <code class="reqn">M_{it}</code>, default is -1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b0</code></td>
<td>
<p>Slope parameter corresponding to the spatial random effect in the probit model for binary <code class="reqn">M_{it}</code>, default is 0.5; note that <code class="reqn">a_0</code> and <code class="reqn">b_0</code> can be determined given <code class="reqn">p_i</code> and <code class="reqn">c_i</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>Cut-off value of the binary outcome regression, default is 0</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>SampleSize_SMARTp computes the sample size required to detect the dynamic treatment regime (DTR)
(Murphy, 2005, <em>Statistics in Medicine</em>) effects in a study comparing non-surgical treatments of chronic periodontitis, via the sequential multiple
assignment randomized trial (SMART) design, with two-stages.
</p>
<p>Outcome measures (i.e. change in CAL) are continuous and clustered (i.e. tooth within a subjectâ€™s mouth,
where each subject/mouth is a cluster) with non-random missingness captured via a shared parameter setting, specified in
Reich and Bandyopadhyay (2010, <em>Annals of Applied Statistics</em>). Each cluster sub-unit has a binary missingness indicator, which is
associated to its corresponding change of CAL through a joint model. The covariance structure within a cluster
is captured by the conditionally autoregressive (CAR) structure (Besag et al, 1991).
</p>
<p>The DTR effect can be detected based on either a single treatment regime, or the difference between two
treatment regimes (with or without sharing initial treatments), or when one regime is considered the best among others. The mean and variance of the CAL change for
each DTR can be estimated by the inverse probability weighting method via method of moments.
</p>
<p>Note that the first three inputs "mu", "st1" and "dtr" define the SMART design in term of matrices. From
Xu <em>et al.</em> (2019+, Under Review), stage-1 includes two treatments, e.g., treatments "3" and "8". Participants who respond to the
stage-1 treatment will receive same treatment at stage-2, while non-responders will be randomly allocated to
other treatments, i.e. non-responders who received treatment "3" at stage-1 will be randomly allocated to
treatments "4"-"7" at stage-2, while non-responders receiving treatment "8" at stage-1 will be randomly
allocated to treatments "4"-"7" at stage-2.
</p>
<p>There are 8 treatment regimes for this design. They are 1 (treatment "3" at stage-1 and treatment "3" at stage-
2 if responder, otherwise treatment "4"), 2 (treatment "3" at stage-1 and treatment "3" at stage-2 if responder,
otherwise treatment "5"), 3 (treatment "3" at stage-1 and treatment "3" at stage-2 if responder, otherwise
treatment "6"), 4 (treatment "3" at stage-1 and treatment "3" at stage-2 if responder, otherwise treatment "7"),
5 (treatment "8" at stage-1 and treatment "8" at stage-2 if responder, otherwise treatment "4"), 6 (treatment "8" at
stage-1 and treatment "8" at stage-2 if responder, otherwise treatment "5"), 7 (treatment "8" at stage-1 and
treatment "8" at stage-2 if responder, otherwise treatment "6") and 8 (treatment "8" at stage-1 and treatment
"8" at stage-2 if responder, otherwise treatment "7"). See Figure 2 in Xu <em>et al.</em> (2019+, Under Review)
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>the estimated sample size</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Del</code></td>
<td>
<p>effect size</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Del_std</code></td>
<td>
<p>standardized effect size</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ybar</code></td>
<td>
<p>the estimated regime means corresponding to "regime"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma</code></td>
<td>
<p>the CAR covariance matrix corresponding to the latent <code class="reqn">Q_{it}</code>; see Xu <em>et al.</em> (2019+, Under Review)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sig.dd</code></td>
<td>
<p>N*the variance or covariance matrix of the estimated regime means corresponding to "regime"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sig.e.sq</code></td>
<td>
<p>N*the variance or covariance matrix of the difference between first and rest of estimated regime means corresponding to "regime", sig.e.sq = sig.dd if the element number of "regime" is one</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_st1</code></td>
<td>
<p>the randomization probability of stage-1 for each treatment path</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_st2</code></td>
<td>
<p>the randomization probability of stage-2 for each treatment path</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res</code></td>
<td>
<p>a vector with binary indicators represent responses or non-responses that corresponds to a treatment path</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ga</code></td>
<td>
<p>the response rates of initial treatments corresponding to each treatment path</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initr</code></td>
<td>
<p>column matrix with dimension = the number of treatment paths, the elements are the corresponding row number of st1</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Jing Xu, Dipankar Bandyopadhyay, Douglas Azevedo, Bibhas Chakraborty
</p>


<h3>References</h3>

<p>Besag, J., York, J. &amp; Mollie, A. (1991) <em>"Bayesian image restoration, with two applications in spatial statistics
(with discussion)"</em>, Annals of the Institute of Statistical Mathematics 43, 159.
</p>
<p>Murphy, S. A. (2005), <em>"An experimental design for the development of adaptive treatment strategies"</em>,
Statistics in Medicine 24, 1455â€“1481.
</p>
<p>Reich, B. &amp; Bandyopadhyay, D. (2010), <em>A latent factor model for spatial data with informative missingness</em>,
The Annals of Applied Statistics 4, 439â€“459.
</p>
<p>Xu, J., Bandyopadhyay, D., Mirzaei, S., Michalowicz, B and Bibhas Chakraborty. (2019+), <em>"SMARTp: A SMART
design for non-surgical treatments of chronic periodontitis with spatially-referenced and non-randomly missing skewed outcomes"</em>, Under Review
</p>


<h3>See Also</h3>

<p>CAR_cov_teeth, MC_var_yibar_mis
</p>


<h3>Examples</h3>

<pre><code class="language-R">m &lt;- 28
pow &lt;- 0.8
a &lt;- 0.05
Num &lt;- 1000
cutoff &lt;- 0
sigma1 &lt;- 0.95
sigma0 &lt;- 1
lambda &lt;- 0
nu &lt;- Inf
b0 &lt;- 0.5
a0 &lt;- -1.0
rho &lt;- 0.975
tau &lt;- 0.85

Sigma &lt;- CAR_cov_teeth(m = m, rho = rho, tau = tau)
p_i &lt;- SMARTp:::pifun(cutoff = cutoff, a0 = a0, b0 = b0,
                     Sigma = Sigma, sigma0 = sigma0)
cit4 &lt;- b0*diag(Sigma)/sqrt((diag(Sigma) +
            (sigma1^2 - 2/pi*sigma1^2*(0^2/(1+0^2))))*(b0^2*diag(Sigma) +
            sigma0^2))
c_i &lt;- mean(cit4)

del1 &lt;- 5
del2 &lt;- 0
del3 &lt;- 0

mu_sim &lt;- matrix(0, 10, m)
mu_sim[2, ] &lt;- rep(del1, m)
mu_sim[4, ] &lt;- rep(del2, m)
mu_sim[7, ] &lt;- rep(del3, m)

st1 &lt;- cbind(c(1, 1), c(4, 4), c(0.25, 0.5), 1:2)

##-- Stage-1 information
dtr &lt;- cbind(1:8, c(rep(1, 4), rep(6, 4)),
             c(2, 3, 4, 5, 7, 8, 9, 10), c(rep(1, 4), rep(2, 4)))

##-- Detecting a single regime, e.g., Regime 1
regime &lt;- 1
SampleSize &lt;- SampleSize_SMARTp(mu = mu_sim, st1 = st1, dtr = dtr,
                                regime = regime,
                                pow = pow, a = a, rho = rho,
                                tau = tau, sigma1 = sigma1, lambda = 0,
                                nu = Inf, sigma0 = sigma0, Num = Num,
                                p_i = p_i, c_i = c_i,
                                cutoff = cutoff)

N &lt;- ceiling(SampleSize$N)
sig.e.sq &lt;- SampleSize$sig.e.sq

sqrt(diag(sig.e.sq)/N)
SampleSize$Del_std
SampleSize$Del
SampleSize$sig.dd
sqrt(diag(SampleSize$sig.dd)/N)
SampleSize$ybar

##-- Now using a0 and b0
SampleSize_SMARTp(mu = mu_sim, st1 = st1, dtr = dtr, regime = regime,
                  pow = pow, a = a, rho = rho,
                  tau = tau, sigma1 = sigma1, lambda = 0, nu = Inf,
                  sigma0 = sigma0, Num = Num, a0 = a0, b0 = b0,
                  cutoff = cutoff)
SampleSize_SMARTp(mu = mu_sim, st1 = st1, dtr = dtr, regime = regime,
                  p_i = p_i, c_i = c_i)

##-- Detecting the difference between two regimes that shares initial treatment,
##-- e.g., Regimes 1 vs 3
regime &lt;- c(1, 3)
SampleSize = SampleSize_SMARTp(mu = mu_sim, st1 = st1, dtr = dtr, regime = regime,
                               pow = pow, a = a, rho = rho,
                               tau = tau, sigma1 = sigma1, lambda = 0, nu = Inf,
                               sigma0 = sigma0, Num = Num, a0 = a0, b0 = b0,
                               cutoff = cutoff)

N &lt;- ceiling(SampleSize$N)
sig.e.sq &lt;- SampleSize$sig.e.sq

sqrt(diag(sig.e.sq)/N)
SampleSize$Del_std
SampleSize$Del
SampleSize$sig.dd

##-- Detecting the difference between two regimes that do not share initial treatment,
##-- e.g., Regimes 1 vs 5
regime &lt;- c(1, 5)

SampleSize &lt;- SampleSize_SMARTp(mu = mu_sim, st1 = st1, dtr = dtr, regime = regime,
                                pow = pow, a = a, rho = rho,
                                tau = tau, sigma1 = sigma1, lambda = 0, nu = Inf,
                                sigma0 = sigma0, Num = Num, a0 = a0, b0 = b0,
                                cutoff = cutoff)

N &lt;- ceiling(SampleSize$N)
sig.e.sq &lt;- SampleSize$sig.e.sq

sqrt(diag(sig.e.sq)/N)
SampleSize$Del_std
SampleSize$Del
SampleSize$sig.dd

##-- Detecting when Regime 1 is the best, e.g., comparing Regimes 1 vs 2, 3, 4, 5, 6, 7 and 8, i.e.
##-- the alternative hypothesis is \mu_{d1}&gt;\mu_{d2} &amp; \mu_{d1}&gt;\mu_{d3} ... &amp; \mu_{d1}&gt;\mu_{d8}
##-- Note that this is a one-side test with Type-1 error rate of 0.025.
regime &lt;- c(1, 2, 3, 4, 5, 6, 7, 8)
##-- To detect Regime 2 is the best, just use regime = c(2, 1, 3, 4, 5, 6, 7, 8), and so on
SampleSize &lt;- SampleSize_SMARTp(mu = mu_sim, st1 = st1, dtr = dtr, regime = regime,
                                pow = pow, a = a, rho = rho,
                                tau = tau, sigma1 = sigma1, lambda = 0, nu = Inf,
                                sigma0 = sigma0, Num = Num, a0 = a0, b0 = b0,
                                cutoff = cutoff)

N &lt;- ceiling(SampleSize$N)
sig.e.sq &lt;- SampleSize$sig.e.sq

sqrt(diag(sig.e.sq)/N)
SampleSize$Del_std
SampleSize$Del
SampleSize$sig.dd

</code></pre>


</div>