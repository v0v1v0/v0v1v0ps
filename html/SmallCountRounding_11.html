<div class="container">

<table style="width: 100%;"><tr>
<td>PLSroundingFits</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Small count rounding with post-processing to expected frequencies</h2>

<h3>Description</h3>

<p>The counts rounded by <code>PLSrounding</code>
Thereafter, based on the publishable rounded data, expected inner cell frequencies are generated by iterative proportional fitting using <code>Mipf</code>.
To ensure that empty cells missing in input data are included in the fitting process, the data is first extended using <code>Extend0</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">PLSroundingFits(
  data,
  freqVar = NULL,
  roundBase = 3,
  hierarchies = NULL,
  formula = NULL,
  dimVar = NULL,
  preAggregate = is.null(freqVar),
  xReturn = FALSE,
  extend0 = TRUE,
  limit = 1e-10,
  viaQR = FALSE,
  iter = 1000,
  eps = 0.01,
  tol = 1e-13,
  reduceBy0 = TRUE,
  reduceByColSums = TRUE,
  reduceByLeverage = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data frame (inner cells)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freqVar</code></td>
<td>
<p>Variable holding counts</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roundBase</code></td>
<td>
<p>Rounding base</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hierarchies</code></td>
<td>
<p>List of hierarchies</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Model formula</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dimVar</code></td>
<td>
<p>Dimensional variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>preAggregate</code></td>
<td>
<p>Aggregation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xReturn</code></td>
<td>
<p>Dummy matrix in output when <code>TRUE</code>. To return crossTable as well, use <code>xReturn = 2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extend0</code></td>
<td>
<p>Data is automatically extended by <code>Extend0</code> when <code>TRUE</code>. Can also be specified as a list meaning parameter <code>varGroups</code> to <code>Extend0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>limit</code></td>
<td>
<p><code>LSfitNonNeg</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>viaQR</code></td>
<td>
<p><code>LSfitNonNeg</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p><code>Mipf</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p><code>Mipf</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p><code>Mipf</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reduceBy0</code></td>
<td>
<p><code>Mipf</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reduceByColSums</code></td>
<td>
<p><code>Mipf</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reduceByLeverage</code></td>
<td>
<p><code>Mipf</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further parameters to <code>PLSrounding</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The seven first parameters is documented in more detail in <code>PLSrounding</code>.
If iterative proportional fitting succeeds, the maximum difference between rounded counts and <code>ipFit</code> is less than input parameter <code>eps</code>.
</p>


<h3>Value</h3>

<p>Output from <code>PLSrounding</code> (class attribute "PLSrounded") with modified versions of <code>inner</code> and <code>publish</code>:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>inner</code></td>
<td>
<p>Extended with more input data variables and with expected frequencies (<code>ipFit</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>publish</code></td>
<td>
<p>Extended with aggregated expected frequencies (<code>ipFit</code>).</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">z &lt;- data.frame(geo  = c("Iceland", "Portugal", "Spain"), 
                eu = c("nonEU", "EU", "EU"),
                year = rep(c("2018","2019"), each = 3),
                freq = c(2,3,7,1,5,6), stringsAsFactors = FALSE)
z4 &lt;- z[-c(1:2), ]

PLSroundingFits(z4, "freq", formula = ~eu * year + geo, extend0 = FALSE)[c("inner", "publish")]
PLSroundingFits(z4, "freq", formula = ~eu * year + geo)[c("inner", "publish")]

my_km2 &lt;- SSBtools::SSBtoolsData("my_km2")

# Default automatic extension (extend0 = TRUE)
PLSroundingFits(my_km2, "freq", 
       formula = ~(Sex + Age) * Municipality * Square1000m + Square250m)[c("inner", "publish")]

# Manual specification to avoid Nittedal combined with another_km
PLSroundingFits(my_km2, "freq", formula = ~(Sex + Age) * Municipality * Square1000m + Square250m, 
       extend0 = list(c("Sex", "Age"), 
       c("Municipality", "Square1000m", "Square250m")))[c("inner", "publish")]
</code></pre>


</div>