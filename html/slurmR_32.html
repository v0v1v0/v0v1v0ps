<div class="container">

<table style="width: 100%;"><tr>
<td>sourceSlurm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Source an R script as a Slurm job</h2>

<h3>Description</h3>

<p>This function sources R scripts using Slurm by creating a batch script file
and submitting it via sbatch.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sourceSlurm(
  file,
  job_name = NULL,
  tmp_path = opts_slurmR$get_tmp_path(),
  rscript_opt = list(vanilla = TRUE),
  plan = "submit",
  ...
)

slurmr_cmd(
  cmd_path,
  cmd_name = "slurmr",
  add_alias = TRUE,
  bashrc_path = "~/.bashrc"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>Character. Path to the R script to source using Slurm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>job_name</code></td>
<td>
<p>Character. Name of the job to be passed to <code>Slurm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tmp_path</code></td>
<td>
<p>Character. Path to the directory where all the data (including
scripts) will be stored. Notice that this path must be accessible by all the
nodes in the network (See opts_slurmR).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rscript_opt</code></td>
<td>
<p>List. Options to be passed to <code>Rscript</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plan</code></td>
<td>
<p>A character scalar. (See the_plan).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further options passed to sbatch.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cmd_path</code></td>
<td>
<p>Character scalar. Path (directory) where to put the command function.
This is usually your home directory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cmd_name</code></td>
<td>
<p>Character scalar. Name of the command (of the file).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_alias, bashrc_path</code></td>
<td>
<p>Logical scalar and character scalar. When
<code>add_alias=TRUE</code> it will modify (or create, if non-existent) the <code>.bashrc</code>
file to add an alias of the same name of <code>cmd_name</code>. The path to <code>.bashrc</code> can be
specified via the <code>bashrc_path</code> option.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>sourceSlurm</code> checks for flags that may be included in the Slurm job file. If
the R script starts with <code style="white-space: pre;">⁠#!/bin/⁠</code> or similar, then <code style="white-space: pre;">⁠#SBATCH⁠</code> flags will be
read from the R script and added to the Slurm job file.
</p>
<p>The function <code>slurmr_cmd</code> writes a simple command that works as a wrapper
of <code>sourceSlurm</code>. In particular, from command line, if the user wants to source an
R script using <code>sourceSlurm</code>, we can either:
</p>
<div class="sourceCode"><pre>$ Rscript -e "slurmR::sourceSlurm('path/to/the/script.R', plan = 'submit')"
</pre></div>
<p>Or, after calling <code>slurmr_cmd</code> from within R, do the following instead
</p>
<div class="sourceCode"><pre>$ ./slurmr path/to/the/script.R
</pre></div>
<p>And, if you used the option <code>add_alias = TRUE</code>, then, after restarting bash,
you can run R scripts with Slurm as follows:
</p>
<div class="sourceCode"><pre>$ slurmr path/to/the/script.R
</pre></div>
<p>The main side effect of this function is that it creates a file named <code>cmd_name</code>
in the directory specified by <code>cmd_path</code>, and, if <code>add_alias = TRUE</code>. it will
create (if not found) or modify (if found) the <code>.bashrc</code> file adding a line
with an alias. For more information on <code>.bashrc</code> see <a href="https://superuser.com/questions/49289">here</a>.
</p>


<h3>Value</h3>

<p>In the case of <code>sourceSlurm</code>, Whatever sbatch returns.
</p>
<p>The function <code>slurmr_cmd</code> returns <code>invisible()</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># In this example we will be sourcing an R script that also has #SBATCH
# flags. Here are the contents
file &lt;- system.file("example.R", package="slurmR")

cat(readLines(file), sep="\n")
# #!/bin/sh
# #SBATCH --account=lc_ggv
# #SBATCH --time=01:00:00
# #SBATCH --mem-per-cpu=4G
# #SBATCH --job-name=Waiting
# Sys.sleep(10)
# message("done.")

# We can directly submit this R script as a job by calling `sourceSlurm`.
# (of course you need Slurm to do this!)
## Not run: 
sourceSlurm(file)

## End(Not run)

# The function will create a bash script that is used later to be submitted to
# the queue using `sbatch`. The resulting file looks something like this
# #!/bin/sh
# #SBATCH --job-name=Waiting
# #SBATCH --output=/home/vegayon/Documents/slurmR/Waiting.out
# #SBATCH --account=lc_ggv
# #SBATCH --time=01:00:00
# #SBATCH --mem-per-cpu=4G
# /usr/lib/R/bin/Rscript --vanilla /usr/local/lib/R/site-library/slurmR/example.R
</code></pre>


</div>