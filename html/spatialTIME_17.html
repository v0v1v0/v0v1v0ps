<div class="container">

<table style="width: 100%;"><tr>
<td>ripleys_k</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate Ripley's K</h2>

<h3>Description</h3>

<p>ripleys_k() calculates the emperical Ripley's K measurement for the cell types specified by mnames in the mIF object. This
is very useful when exploring the spatial clustering of single cell types on TMA cores or ROI spots following proccessing
with a program such as HALO for cell phenotyping.
</p>
<p>In the 'ripleys_k' function, there is the ability to perform permutations in order to assess whether the clustering
of a cell type is significant, or the ability to derive the exact CSR and forgo permutations for much faster sample
processing. Permutations can be helpful if the significance of clustering wasnts to be identified - run 1000 permutations 
and if observed is outside 95-percentile then significant clustering. We, however, recommend using the exact CSR estimate
due to speed.
</p>
<p>Some things to be aware of when computing the exact Ripley's K estimate, if your spatial file is greater than 
the ‘big' size, the edge correction will be converted to ’none' in order to save on resources and compute time. 
Due to the introduction of Whole Slide Imaging (WSI), this can easily be well over 1,000,000 cells, and calculating 
edge correction for these spatial files will not succeed when attempting to force an edge correction on it.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ripleys_k(
  mif,
  mnames,
  r_range = seq(0, 100, 1),
  num_permutations = 50,
  edge_correction = "translation",
  method = "K",
  permute = FALSE,
  keep_permutation_distribution = FALSE,
  workers = 1,
  overwrite = FALSE,
  xloc = NULL,
  yloc = NULL,
  big = 10000
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mif</code></td>
<td>
<p>object of class 'mif' created with 'create_mif'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mnames</code></td>
<td>
<p>cell phenotype markers to calculate Ripley's K for</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_range</code></td>
<td>
<p>radius range (including 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_permutations</code></td>
<td>
<p>number of permutations to use to estimate CSR. If 'keep_perm_dis' is set to FALSE, this will be ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>edge_correction</code></td>
<td>
<p>edge correction method to pass to ‘Kest'. can take one of "translation", "isotropic", "none", or ’border'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>not used currently</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>permute</code></td>
<td>
<p>whether to use CSR estimate or use permutations to determine CSR</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep_permutation_distribution</code></td>
<td>
<p>whether to find mean of permutation distribution or each
permutation calculation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>workers</code></td>
<td>
<p>number of cores to use for calculations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>whether to overwrite the 'univariate_Count' slot within 'mif$derived'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xloc</code></td>
<td>
<p>the location of the center of cells. If left 'NULL', 'XMin', 'XMax', 'YMin', and 'YMax' must be present.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yloc</code></td>
<td>
<p>the location of the center of cells. If left 'NULL', 'XMin', 'XMax', 'YMin', and 'YMax' must be present.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>big</code></td>
<td>
<p>the number of cells at which to flip from an edge correction method other than 'none' to 'none' due to size</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>object of class 'mif'
</p>


<h3>Examples</h3>

<pre><code class="language-R">x &lt;- spatialTIME::create_mif(clinical_data =spatialTIME::example_clinical %&gt;% 
  dplyr::mutate(deidentified_id = as.character(deidentified_id)),
  sample_data = spatialTIME::example_summary %&gt;% 
  dplyr::mutate(deidentified_id = as.character(deidentified_id)),
  spatial_list = spatialTIME::example_spatial,
  patient_id = "deidentified_id", 
  sample_id = "deidentified_sample")
mnames = x$spatial[[1]] %&gt;%
  colnames() %&gt;%
  grep("Pos|CD", ., value =TRUE) %&gt;%
  grep("Cyto|Nucle", ., value =TRUE, invert =TRUE)
x2 = ripleys_k(mif = x, 
  mnames = mnames[1], 
  r_range = seq(0, 100, 1), 
  num_permutations = 100,
  edge_correction = "translation", 
  method = "K", 
  permute = FALSE,
  keep_permutation_distribution =FALSE, 
  workers = 1, 
  overwrite =TRUE)
</code></pre>


</div>