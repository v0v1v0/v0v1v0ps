<div class="container">

<table style="width: 100%;"><tr>
<td>specify.formula</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Specify data-generating mechanisms</h2>

<h3>Description</h3>

<p>Specify the data-generating mechanisms for the
simulation using purrr-style lambda functions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'formula'
specify(x = NULL, ..., .use_names = TRUE, .sep = "_")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>leave this argument blank (NULL); this
argument is a placeholder and can be skipped.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>named <code>purrr</code>-style formula
functions used for generating simulation
variables. <code>x</code> is not recommended as a
name, since it is a formal argument and will
be automatically assumed to be the first
variable (a message will be displayed if
<code>x</code> is used).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.use_names</code></td>
<td>
<p>Whether to use names
generated by the lambda function (TRUE, the
default), or to overwrite them with supplied
names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.sep</code></td>
<td>
<p>Specify the separator for
auto-generating names.  See <em>Column
naming</em>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is always the first command in the
simulation process, to specify the actual
simulated variables, which is then passed to
<code>define</code> to define metaparameters
and then to
<code>generate</code> to
generate the data.
</p>
<p>The <code>...</code> arguments use an efficient
syntax to specify custom functions needed for
generating a simulation, based on the
<code>purrr</code> package.  When producing one
variable, one can provide an expression such as
<code>specify(a = ~ 3 + runif(10))</code>; the
expression is preceded by <code>~</code>, the tilde
operator, and can refer to previous arguments
in <code>specify</code> or to metaparameters in
<code>define</code>. This is called a lambda
function.
</p>
<p>Order matters: arguments are evaluated
sequentially, so later argument can refer to an
earlier one, e.g. <code>specify(a = ~ rnorm(2),
b = ~ a + rnorm(2))</code>.
</p>
<p><code>generate</code>
combines results together into a single tibble
for each simulation, so all lambda functions
should produce the same number of rows.
However, a lambda function can produce multiple
columns.
</p>


<h3>Value</h3>

<p>A <code>simpr_specify</code> object which
contains the functions needed to generate the
simulation; to be passed to
<code>define</code> for defining
metaparameters or, if there are no
metaparameters, directly to
<code>generate</code>
for generating the simulation.
</p>
<p>Also useful is the fact that one can refer to
variables in subsequent arguments.  So, one
could define another variable <code>b</code> that
depends on <code>a</code> very simply, e.g.
<code>specify(a = ~ 3 + runif(10), b = ~ 2 *
  x)</code>.
</p>
<p>Finally, one can also refer to metaparameters
that are to be systematically varied in the
simulation study.  See <code>define</code>
and the examples for more details.
</p>


<h3>Column naming</h3>

<p>Because functions can produce different
numbers of columns, there are several options
for naming columns. If a provided lambda
function produces a single column, the name
given to the argument becomes the name of the
column.  If the lambda function already
produces column names, then the output will
use these names if <code>.use_names = TRUE</code>,
the default. Otherwise, simpr uses the
argument name as a base and auto-numbers the
columns. For instance, if the argument
<code>a</code> generates a two-column matrix and
<code>.sep = "_"</code> (the default) the columns
will be named <code>a_1</code>and <code>a_2</code>.
</p>
<p>Custom names can also be directly provided by
a double-sided formula. The left-hand side
must use <code>c</code> or
<code>cbind</code>, e.g. <code>specify(c(a,
  b) ~ MASS::mvrnorm(5, c(0, 0), Sigma =
  diag(2)))</code>.
</p>


<h3>Note</h3>

<p>This function is an S3 method for
<code>specify</code> from the
<code>generics</code> package.  Because <code>x</code> is
a formal argument of
<code>specify</code>, if you have
a variable in your simulation named <code>x</code>
it will be automatically moved to be the
first variable (with a message).  It is therefore
safest to use any other variable name besides
<code>x</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## specify a variable and generate it in the simulation
single_var = specify(a = ~ 1 + rnorm(5)) %&gt;%
  generate(1) # generate a single repetition of the simulation
single_var

two_var = specify(a = ~ 1 + rnorm(5),
                    b = ~ x + 2) %&gt;%
  generate(1)
two_var

## Generates a_01 through a_10
autonumber_var = specify(a = ~ MASS::mvrnorm(5, rep(0, 10), Sigma = diag(10))) %&gt;%
  generate(1)
autonumber_var

# alternatively, you could use a two-sided formula for names
multi_name = specify(cbind(a, b, c) ~ MASS::mvrnorm(5, rep(0, 3), Sigma = diag(3))) %&gt;%
  generate(1)
multi_name

# Simple example of setting a metaparameter
simple_meta = specify(a = ~ 1 + rnorm(n)) %&gt;%
  define(n = c(5, 10)) %&gt;% # without this line you would get an error!
  generate(1)


simple_meta # has two rows now, one for each value of n
simple_meta$sim[[1]] # n = 5
simple_meta$sim[[2]] # n = 10

</code></pre>


</div>