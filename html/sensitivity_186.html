<div class="container">

<table style="width: 100%;"><tr>
<td>shapleySubsetMc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimation of Shapley effects from data using nearest neighbors method</h2>

<h3>Description</h3>

<p><code>shapleySubsetMc</code> implements the estimation of
the Shapley effects from data using some nearest neighbors method
to generate according to the conditional distributions of the inputs.
It can be used with categorical inputs.
</p>


<h3>Usage</h3>

<pre><code class="language-R">shapleySubsetMc(X,Y, Ntot=NULL, Ni=3, cat=NULL, weight=NULL, discrete=NULL, 
                noise=FALSE)
## S3 method for class 'shapleySubsetMc'
plot(x, ylim = c(0, 1), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a matrix or a dataframe of the input sample</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>a vector of the output sample</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ntot</code></td>
<td>
<p>an integer of the approximate cost wanted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ni</code></td>
<td>
<p>the number of nearest neighbours taken for each point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cat</code></td>
<td>
<p>a vector giving the indices of the input categorical variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>a vector with the same length of <code>cat</code> giving the weight of each
categorical variable in the product distance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>discrete</code></td>
<td>
<p>a vector giving the indices of the input variable that are
real, and not categorical, but that can take several times the same values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noise</code></td>
<td>
<p>logical. If FALSE (the default), the variable Y is a function of X</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a list of class <code>"shapleySubsetMc"</code> storing the state of the
sensitivity study (Shapley effects, cost, names of inputs)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>y-coordinate plotting limits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>any other arguments for plotting</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If <code>weight = NULL</code>, all the categorical variables will have the same weight 1.
</p>
<p>If <code>Ntot = NULL</code>, the nearest neighbours will be compute for all the <code class="reqn">n (2^p-2)</code> points,
where n is the length of the sample. The estimation can be very long with this parameter. 
</p>


<h3>Value</h3>

<p><code>shapleySubsetMc</code> returns a list of class <code>"shapleySubsetMc"</code>, 
containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>shapley</code></td>
<td>
<p>the Shapley effects estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cost</code></td>
<td>
<p>the real total cost of these estimates: the total number of points for which
the nearest neighbours were computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names</code></td>
<td>
<p>the labels of the input variables.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Baptiste Broto
</p>


<h3>References</h3>

<p>B. Broto, F. Bachoc, M. Depecker, 2020, <em>Variance reduction for estimation of 
Shapley effects and adaptation to unknown input distribution</em>, 
SIAM/ASA Journal of Uncertainty Quantification, 8:693-716.
</p>


<h3>See Also</h3>

<p>shapleyPermEx, shapleyPermRand, shapleyLinearGaussian, sobolrank, shapleysobol_knn
</p>


<h3>Examples</h3>

<pre><code class="language-R">

# First example: the linear Gaussian framework

# we generate a covariance matrice Sigma
p &lt;- 4 #dimension
A &lt;- matrix(rnorm(p^2),nrow=p,ncol=p)
Sigma &lt;- t(A)%*%A # it means t(A)%*%A
C &lt;- chol(Sigma)
n &lt;- 500 #sample size (put n=2000 for more consistency)

Z=matrix(rnorm(p*n),nrow=n,ncol=p)
X=Z%*%C # X is a gaussian vector with zero mean and covariance Sigma
Y=rowSums(X) 
Shap=shapleySubsetMc(X=X,Y=Y,Ntot=5000)
plot(Shap)


#Second example: The Sobol model with heterogeneous inputs

p=8 #dimension
A=matrix(rnorm(p^2),nrow=p,ncol=p)
Sigma=t(A)%*%A
C=chol(Sigma)
n=500 #sample size (put n=5000 for more consistency)

Z=matrix(rnorm(p*n),nrow=n,ncol=p)
X=Z

#we create discrete and categorical variables
X[,1]=round(X[,1]/2) 
X[,2]=X[,2]&gt;2
X[,4]=-2*round(X[,4])+4
X[(X[,6]&gt;0 &amp;X[,6]&lt;1),6]=1

cat=c(1,2)  # we choose to take X1 and X2 as categorical variables 
            #   (with the discrete distance)
discrete=c(4,6) # we indicate that X4 and X6 can take several times the same value

Y=sobol.fun(X)
Ntot &lt;- 2000 # put Ntot=20000 for more consistency
Shap=shapleySubsetMc(X=X,Y=Y, cat=cat, discrete=discrete, Ntot=Ntot, Ni=10)

plot(Shap)


</code></pre>


</div>