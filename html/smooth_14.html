<div class="container">

<table style="width: 100%;"><tr>
<td>es</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Exponential Smoothing in SSOE state space model</h2>

<h3>Description</h3>

<p>Function constructs ETS model and returns forecast, fitted values, errors
and matrix of states. It is a wrapper of adam function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">es(y, model = "ZZZ", lags = c(frequency(y)), persistence = NULL,
  phi = NULL, initial = c("optimal", "backcasting", "complete"),
  initialSeason = NULL, ic = c("AICc", "AIC", "BIC", "BICc"),
  loss = c("likelihood", "MSE", "MAE", "HAM", "MSEh", "TMSE", "GTMSE",
  "MSCE"), h = 10, holdout = FALSE, bounds = c("usual", "admissible",
  "none"), silent = TRUE, xreg = NULL, regressors = c("use", "select"),
  initialX = NULL, ...)

es_old(y, model = "ZZZ", persistence = NULL, phi = NULL,
  initial = c("optimal", "backcasting"), initialSeason = NULL,
  ic = c("AICc", "AIC", "BIC", "BICc"), loss = c("likelihood", "MSE",
  "MAE", "HAM", "MSEh", "TMSE", "GTMSE", "MSCE"), h = 10, holdout = FALSE,
  cumulative = FALSE, interval = c("none", "parametric", "likelihood",
  "semiparametric", "nonparametric"), level = 0.95, bounds = c("usual",
  "admissible", "none"), silent = c("all", "graph", "legend", "output",
  "none"), xreg = NULL, regressors = c("use", "select"), initialX = NULL,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Vector or ts object, containing data needed to be forecasted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>The type of ETS model. The first letter stands for the type of
the error term ("A" or "M"), the second (and sometimes the third as well) is for
the trend ("N", "A", "Ad", "M" or "Md"), and the last one is for the type of
seasonality ("N", "A" or "M"). So, the function accepts words with 3 or 4
characters: <code>ANN</code>, <code>AAN</code>, <code>AAdN</code>, <code>AAA</code>, <code>AAdA</code>,
<code>MAdM</code> etc. <code>ZZZ</code> means that the model will be selected based on the
chosen information criteria type. Models pool can be restricted with additive
only components. This is done via <code>model="XXX"</code>. For example, making
selection between models with none / additive / damped additive trend
component only (i.e. excluding multiplicative trend) can be done with
<code>model="ZXZ"</code>. Furthermore, selection between multiplicative models
(excluding additive components) is regulated using <code>model="YYY"</code>. This
can be useful for positive data with low values (for example, slow moving
products). Finally, if <code>model="CCC"</code>, then all the models are estimated
and combination of their forecasts using AIC weights is produced (Kolassa,
2011). This can also be regulated. For example, <code>model="CCN"</code> will
combine forecasts of all non-seasonal models and <code>model="CXY"</code> will
combine forecasts of all the models with non-multiplicative trend and
non-additive seasonality with either additive or multiplicative error. Not
sure why anyone would need this thing, but it is available.
</p>
<p>The parameter <code>model</code> can also be a vector of names of models for a
finer tuning (pool of models). For example, <code>model=c("ANN","AAA")</code> will
estimate only two models and select the best of them.
</p>
<p>Also <code>model</code> can accept a previously estimated ES or ETS (from forecast
package) model and use all its parameters.
</p>
<p>Keep in mind that model selection with "Z" components uses Branch and Bound
algorithm and may skip some models that could have slightly smaller
information criteria.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lags</code></td>
<td>
<p>Defines lags for the corresponding components. All components
count, starting from level, so ETS(M,M,M) model for monthly data will have
<code>lags=c(1,1,12)</code>. However, the function will also accept <code>lags=c(12)</code>,
assuming that the lags 1 were dropped.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>persistence</code></td>
<td>
<p>Persistence vector <code class="reqn">g</code>, containing smoothing
parameters. If <code>NULL</code>, then estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>Value of damping parameter. If <code>NULL</code> then it is estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial</code></td>
<td>
<p>Can be either character or a vector of initial states.
If it is character, then it can be <code>"optimal"</code>, meaning that all initial
states are optimised, or <code>"backcasting"</code>, meaning that the initials of
dynamic part of the model are produced using backcasting procedure (advised
for data with high frequency). In the latter case, the parameters of the
explanatory variables are optimised. This is recommended for ETSX
model. Alternatively, you can set <code>initial="complete"</code> backcasting,
which means that all states (including explanatory variables) are initialised
via backcasting. You can also provide a vector with values for level and trend
components.
If character, then <code>initialSeason</code> will be estimated in the way defined
by <code>initial</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initialSeason</code></td>
<td>
<p>Vector of initial values for seasonal components. If
<code>NULL</code>, they are estimated during optimisation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ic</code></td>
<td>
<p>The information criterion used in the model selection procedure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loss</code></td>
<td>
<p>The type of Loss Function used in optimization. <code>loss</code> can
be: <code>likelihood</code> (assuming Normal distribution of error term),
<code>MSE</code> (Mean Squared Error), <code>MAE</code> (Mean Absolute Error),
<code>HAM</code> (Half Absolute Moment), <code>TMSE</code> - Trace Mean Squared Error,
<code>GTMSE</code> - Geometric Trace Mean Squared Error, <code>MSEh</code> - optimisation
using only h-steps ahead error, <code>MSCE</code> - Mean Squared Cumulative Error.
If <code>loss!="MSE"</code>, then likelihood and model selection is done based
on equivalent <code>MSE</code>. Model selection in this cases becomes not optimal.
</p>
<p>There are also available analytical approximations for multistep functions:
<code>aMSEh</code>, <code>aTMSE</code> and <code>aGTMSE</code>. These can be useful in cases
of small samples.
</p>
<p>Finally, just for fun the absolute and half analogues of multistep estimators
are available: <code>MAEh</code>, <code>TMAE</code>, <code>GTMAE</code>, <code>MACE</code>, <code>TMAE</code>,
<code>HAMh</code>, <code>THAM</code>, <code>GTHAM</code>, <code>CHAM</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>Length of forecasting horizon.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>holdout</code></td>
<td>
<p>If <code>TRUE</code>, holdout sample of size <code>h</code> is taken from
the end of the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bounds</code></td>
<td>
<p>What type of bounds to use in the model estimation. The first
letter can be used instead of the whole word.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>If <code>silent="none"</code>, then nothing is silent, everything is
printed out and drawn. <code>silent="all"</code> means that nothing is produced or
drawn (except for warnings). In case of <code>silent="graph"</code>, no graph is
produced. If <code>silent="legend"</code>, then legend of the graph is skipped.
And finally <code>silent="output"</code> means that nothing is printed out in the
console, but the graph is produced. <code>silent</code> also accepts <code>TRUE</code>
and <code>FALSE</code>. In this case <code>silent=TRUE</code> is equivalent to
<code>silent="all"</code>, while <code>silent=FALSE</code> is equivalent to
<code>silent="none"</code>. The parameter also accepts first letter of words ("n",
"a", "g", "l", "o").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xreg</code></td>
<td>
<p>The vector (either numeric or time series) or the matrix (or
data.frame) of exogenous variables that should be included in the model. If
matrix included than columns should contain variables and rows - observations.
Note that <code>xreg</code> should have number of observations equal either to
in-sample or to the whole series. If the number of observations in
<code>xreg</code> is equal to in-sample, then values for the holdout sample are
produced using es function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regressors</code></td>
<td>
<p>The variable defines what to do with the provided xreg:
<code>"use"</code> means that all of the data should be used, while
<code>"select"</code> means that a selection using <code>ic</code> should be done.
<code>"combine"</code> will be available at some point in future...</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initialX</code></td>
<td>
<p>The vector of initial parameters for exogenous variables.
Ignored if <code>xreg</code> is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other non-documented parameters. For example <code>FI=TRUE</code> will
make the function also produce Fisher Information matrix, which then can be
used to calculated variances of smoothing parameters and initial states of
the model.
Parameters <code>B</code>, <code>lb</code> and <code>ub</code> can be passed via
ellipsis as well. In this case they will be used for optimisation. <code>B</code>
sets the initial values before the optimisation, <code>lb</code> and
<code>ub</code> define lower and upper bounds for the search inside of the
specified <code>bounds</code>. These values should have length equal to the number
of parameters to estimate.
You can also pass two parameters to the optimiser: 1. <code>maxeval</code> - maximum
number of evaluations to carry on; 2. <code>xtol_rel</code> - the precision of the
optimiser. The default values used in es() are <code>maxeval=500</code> and
<code>xtol_rel=1e-8</code>. You can read more about these parameters in the
documentation of nloptr function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cumulative</code></td>
<td>
<p>If <code>TRUE</code>, then the cumulative forecast and prediction
interval are produced instead of the normal ones. This is useful for
inventory control systems.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interval</code></td>
<td>
<p>Type of interval to construct. This can be:
</p>

<ul>
<li> <p><code>"none"</code>, aka <code>"n"</code> - do not produce prediction
interval.
</p>
</li>
<li> <p><code>"parametric"</code>, <code>"p"</code> - use state-space structure of ETS. In
case of mixed models this is done using simulations, which may take longer
time than for the pure additive and pure multiplicative models. This type
of interval relies on unbiased estimate of in-sample error variance, which
divides the sume of squared errors by T-k rather than just T.
</p>
</li>
<li> <p><code>"likelihood"</code>, <code>"l"</code> - these are the same as <code>"p"</code>, but
relies on the biased estimate of variance from the likelihood (division by
T, not by T-k).
</p>
</li>
<li> <p><code>"semiparametric"</code>, <code>"sp"</code> - interval based on covariance
matrix of 1 to h steps ahead errors and assumption of normal / log-normal
distribution (depending on error type).
</p>
</li>
<li> <p><code>"nonparametric"</code>, <code>"np"</code> - interval based on values from a
quantile regression on error matrix (see Taylor and Bunn, 1999). The model
used in this process is e[j] = a j^b, where j=1,..,h.
</p>
</li>
</ul>
<p>The parameter also accepts <code>TRUE</code> and <code>FALSE</code>. The former means that
parametric interval are constructed, while the latter is equivalent to
<code>none</code>.
If the forecasts of the models were combined, then the interval are combined
quantile-wise (Lichtendahl et al., 2013).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>Confidence level. Defines width of prediction interval.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function estimates ETS in a form of the Single Source of Error state space
model of the following type:
</p>
<p style="text-align: center;"><code class="reqn">y_{t} = o_t (w(v_{t-l}) + h(x_t, a_{t-1}) + r(v_{t-l}) \epsilon_{t})</code>
</p>

<p style="text-align: center;"><code class="reqn">v_{t} = f(v_{t-l}) + g(v_{t-l}) \epsilon_{t}</code>
</p>

<p style="text-align: center;"><code class="reqn">a_{t} = F_{X} a_{t-1} + g_{X} \epsilon_{t} / x_{t}</code>
</p>

<p>Where <code class="reqn">o_{t}</code> is the Bernoulli distributed random variable (in case of
normal data it equals to 1 for all observations), <code class="reqn">v_{t}</code> is the state
vector and <code class="reqn">l</code> is the vector of lags, <code class="reqn">x_t</code> is the vector of
exogenous variables. w(.) is the measurement function, r(.) is the error
function, f(.) is the transition function, g(.) is the persistence
function and h(.) is the explanatory variables function. <code class="reqn">a_t</code> is the
vector of parameters for exogenous variables, <code class="reqn">F_{X}</code> is the
<code>transitionX</code> matrix and <code class="reqn">g_{X}</code> is the <code>persistenceX</code> matrix.
Finally, <code class="reqn">\epsilon_{t}</code> is the error term.
</p>
<p>For the details see Hyndman et al.(2008).
</p>
<p>For some more information about the model and its implementation, see the
vignette: <code>vignette("es","smooth")</code>.
</p>
<p>Also, there are posts about the functions of the package smooth on the
website of Ivan Svetunkov:
<a href="https://openforecast.org/category/r-en/smooth/">https://openforecast.org/category/r-en/smooth/</a> - they explain the
underlying models and how to use the functions.
</p>


<h3>Value</h3>

<p>Object of class "adam" is returned. It contains the list of the
following values for classical ETS models:
</p>

<ul>
<li> <p><code>model</code> - type of constructed model.
</p>
</li>
<li> <p><code>formula</code> - mathematical formula, describing interactions between
components of es() and exogenous variables.
</p>
</li>
<li> <p><code>timeElapsed</code> - time elapsed for the construction of the model.
</p>
</li>
<li> <p><code>states</code> - matrix of the components of ETS.
</p>
</li>
<li> <p><code>persistence</code> - persistence vector. This is the place, where
smoothing parameters live.
</p>
</li>
<li> <p><code>phi</code> - value of damping parameter.
</p>
</li>
<li> <p><code>transition</code> - transition matrix of the model.
</p>
</li>
<li> <p><code>measurement</code> - measurement vector of the model.
</p>
</li>
<li> <p><code>initialType</code> - type of the initial values used.
</p>
</li>
<li> <p><code>initial</code> - initial values of the state vector (non-seasonal).
</p>
</li>
<li> <p><code>initialSeason</code> - initial values of the seasonal part of state vector.
</p>
</li>
<li> <p><code>nParam</code> - table with the number of estimated / provided parameters.
If a previous model was reused, then its initials are reused and the number of
provided parameters will take this into account.
</p>
</li>
<li> <p><code>fitted</code> - fitted values of ETS. In case of the intermittent model, the
fitted are multiplied by the probability of occurrence.
</p>
</li>
<li> <p><code>forecast</code> - the point forecast for h steps ahead (by default NA is returned). NOTE
that these do not always correspond to the conditional expectations. See ADAM
textbook, Section 4.4. for details (<a href="https://openforecast.org/adam/ETSTaxonomyMaths.html">https://openforecast.org/adam/ETSTaxonomyMaths.html</a>),
</p>
</li>
<li> <p><code>lower</code> - lower bound of prediction interval. When <code>interval="none"</code>
then NA is returned.
</p>
</li>
<li> <p><code>upper</code> - higher bound of prediction interval. When <code>interval="none"</code>
then NA is returned.
</p>
</li>
<li> <p><code>residuals</code> - residuals of the estimated model.
</p>
</li>
<li> <p><code>errors</code> - trace forecast in-sample errors, returned as a matrix. Only returned when the
multistep losses are used and semiparametric interval is needed.
</p>
</li>
<li> <p><code>s2</code> - variance of the residuals (taking degrees of freedom into account).
This is an unbiased estimate of variance.
</p>
</li>
<li> <p><code>interval</code> - type of interval asked by user.
</p>
</li>
<li> <p><code>level</code> - confidence level for interval.
</p>
</li>
<li> <p><code>cumulative</code> - whether the produced forecast was cumulative or not.
</p>
</li>
<li> <p><code>y</code> - original data.
</p>
</li>
<li> <p><code>holdout</code> - holdout part of the original data.
</p>
</li>
<li> <p><code>xreg</code> - provided vector or matrix of exogenous variables. If <code>regressors="s"</code>,
then this value will contain only selected exogenous variables.
</p>
</li>
<li> <p><code>initialX</code> - initial values for parameters of exogenous variables.
</p>
</li>
<li> <p><code>ICs</code> - values of information criteria of the model. Includes AIC, AICc, BIC and BICc.
</p>
</li>
<li> <p><code>logLik</code> - concentrated log-likelihood of the function.
</p>
</li>
<li> <p><code>lossValue</code> - loss function value.
</p>
</li>
<li> <p><code>loss</code> - type of loss function used in the estimation.
</p>
</li>
<li> <p><code>FI</code> - Fisher Information. Equal to NULL if <code>FI=FALSE</code> or when <code>FI</code>
is not provided at all.
</p>
</li>
<li> <p><code>accuracy</code> - vector of accuracy measures for the holdout sample. In
case of non-intermittent data includes: MPE, MAPE, SMAPE, MASE, sMAE,
RelMAE, sMSE and Bias coefficient (based on complex numbers). In case of
intermittent data the set of errors will be: sMSE, sPIS, sCE (scaled
cumulative error) and Bias coefficient. This is available only when
<code>holdout=TRUE</code>.
</p>
</li>
<li> <p><code>B</code> - the vector of all the estimated parameters.
</p>
</li>
</ul>
<p>If combination of forecasts is produced (using <code>model="CCC"</code>), then a
shorter list of values is returned:
</p>

<ul>
<li> <p><code>model</code>,
</p>
</li>
<li> <p><code>timeElapsed</code>,
</p>
</li>
<li> <p><code>initialType</code>,
</p>
</li>
<li> <p><code>fitted</code>,
</p>
</li>
<li> <p><code>forecast</code>,
</p>
</li>
<li> <p><code>lower</code>,
</p>
</li>
<li> <p><code>upper</code>,
</p>
</li>
<li> <p><code>residuals</code>,
</p>
</li>
<li> <p><code>s2</code> - variance of additive error of combined one-step-ahead forecasts,
</p>
</li>
<li> <p><code>interval</code>,
</p>
</li>
<li> <p><code>level</code>,
</p>
</li>
<li> <p><code>cumulative</code>,
</p>
</li>
<li> <p><code>y</code>,
</p>
</li>
<li> <p><code>holdout</code>,
</p>
</li>
<li> <p><code>ICs</code> - combined ic,
</p>
</li>
<li> <p><code>ICw</code> - ic weights used in the combination,
</p>
</li>
<li> <p><code>loss</code>,
</p>
</li>
<li> <p><code>xreg</code>,
</p>
</li>
<li> <p><code>accuracy</code>.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Ivan Svetunkov, <a href="mailto:ivan@svetunkov.ru">ivan@svetunkov.ru</a>
</p>


<h3>References</h3>


<ul>
<li>
<p> Snyder, R. D., 1985. Recursive Estimation of Dynamic Linear Models.
Journal of the Royal Statistical Society, Series B (Methodological) 47 (2), 272-276.
</p>
</li>
<li>
<p> Hyndman, R.J., Koehler, A.B., Ord, J.K., and Snyder, R.D. (2008)
Forecasting with exponential smoothing: the state space approach,
Springer-Verlag. <a href="https://doi.org/10.1007/978-3-540-71918-2">doi:10.1007/978-3-540-71918-2</a>.
</p>
</li>
</ul>
<ul>
<li>
<p> Svetunkov Ivan and Boylan John E. (2017). Multiplicative
State-Space Models for Intermittent Time Series. Working Paper of
Department of Management Science, Lancaster University, 2017:4 , 1-43.
</p>
</li>
<li>
<p> Teunter R., Syntetos A., Babai Z. (2011). Intermittent demand:
Linking forecasting to inventory obsolescence. European Journal of
Operational Research, 214, 606-615.
</p>
</li>
<li>
<p> Croston, J. (1972) Forecasting and stock control for intermittent
demands. Operational Research Quarterly, 23(3), 289-303.
</p>
</li>
<li>
<p> Syntetos, A., Boylan J. (2005) The accuracy of intermittent demand
estimates. International Journal of Forecasting, 21(2), 303-314.
</p>
</li>
</ul>
<ul><li>
<p> Kolassa, S. (2011) Combining exponential smoothing forecasts using Akaike
weights. International Journal of Forecasting, 27, pp 238 - 251.
</p>
</li></ul>
<ul>
<li>
<p> Taylor, J.W. and Bunn, D.W. (1999) A Quantile Regression Approach to
Generating Prediction Intervals. Management Science, Vol 45, No 2, pp
225-237.
</p>
</li>
<li>
<p> Lichtendahl Kenneth C., Jr., Grushka-Cockayne Yael, Winkler
Robert L., (2013) Is It Better to Average Probabilities or
Quantiles? Management Science 59(7):1594-1611. DOI:
<a href="https://doi.org/10.1287/mnsc.1120.1667">doi:10.1287/mnsc.1120.1667</a>
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>adam, forecast,
ts, sim.es</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# See how holdout and trace parameters influence the forecast
es(BJsales,model="AAdN",h=8,holdout=FALSE,loss="MSE")
es(AirPassengers,model="MAM",h=18,holdout=TRUE,loss="TMSE")

# Model selection example
es(BJsales,model="ZZN",ic="AIC",h=8,holdout=FALSE,bounds="a")

# Model selection. Compare AICc of these two models:
es(AirPassengers,"ZZZ",h=10,holdout=TRUE)
es(AirPassengers,"MAdM",h=10,holdout=TRUE)

# Model selection, excluding multiplicative trend
es(AirPassengers,model="ZXZ",h=8,holdout=TRUE)

# Combination example
es(BJsales,model="CCN",h=8,holdout=TRUE)

# Model selection using a specified pool of models
ourModel &lt;- es(AirPassengers,model=c("ANN","AAM","AMdA"),h=18)

# Produce forecast and prediction interval
forecast(ourModel, h=18, interval="parametric")

# Semiparametric interval example
forecast(ourModel, h=18, interval="semiparametric")

# This will be the same model as in previous line but estimated on new portion of data
es(BJsales,model=ourModel,h=18,holdout=FALSE)

</code></pre>


</div>