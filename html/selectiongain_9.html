<div class="container">

<table style="width: 100%;"><tr>
<td>multistagetp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function for calculating the truncation points</h2>

<h3>Description</h3>

<p> This function calculates the coordinates of the truncation points Q for given selected fractions <code class="reqn">\vec{\alpha}=\{ \alpha_{1},\alpha_{2},...,\alpha_{n} \}</code> and correlation matrix of X. The R function uniroot in core package stats is called internally to solve the truncation point equations. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">multistagetp(alpha,  corr,  alg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p> is probability vector <code class="reqn">\vec{\alpha}</code> for random variable X. In plant breeding, it is also called the selected fraction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corr</code></td>
<td>
<p>is the correlation matrix of y and X, which is introduced in the function multistagecorr. The correlation matrix must be symmetric and positive-definite. If the estimated correlation matrix is negative-definite, it must be adjusted before using this function. Before starting the calculations, it is recommended to check the correlation matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alg</code></td>
<td>
<p>is used to switch between two algorithms. If <code>alg = GenzBretz()</code>, which is by default, the quasi-Monte Carlo algorithm from Genz et al. (2009, 2013), will be used. If <code>alg = Miwa()</code>, the program will use the Miwa algorithm (Mi et al., 2009), which is an analytical solution of the MVN integral. Miwa's algorithm has higher accuracy (7 digits) than quasi-Monte Carlo algorithm (5 digits). However, its computational speed is slower. We recommend to use the Miwa algorithm.</p>
</td>
</tr>
</table>
<h3>Details</h3>

 
<p>This function calculates the non-equi coordinate quantile vector <code class="reqn">Q=\{q_{1},q_{2},...,q_{n}\}</code> for a multivariate normal distribution from a given <code class="reqn">\vec{\alpha}</code>. It can be compared with the function qmvnorm() in R-package <span class="pkg">mvtnorm</span>, which calculates only the equi coordinate quantile  <code class="reqn">q</code> for multi-variate normal distribution from a given <code class="reqn">\vec{\alpha}</code>. The function multistagetp is used by function mulistagegain to calculate the expected gain.
</p>


<h3>Value</h3>

<p>The output is a vector of the coordinates.
</p>


<h3>Note</h3>

<p> When a <code class="reqn">\vec{\alpha}</code> is given, the quantiles are calculated consecutively to satisfy the given <code class="reqn">\vec{\alpha}</code>. The calculation from other direction to <code class="reqn">-\infty</code> of the integral is also possible for qmvnorm().  
</p>


<h3>Author(s)</h3>

<p> Xuefei Mi</p>


<h3>References</h3>

<p>A. Genz and F. Bretz. Computation of Multivariate Normal and t Probabilities. Lecture Notes in Statistics, Vol. 195, Springer-Verlag, Heidelberg, 2009.
</p>
<p>A. Genz, F. Bretz, T. Miwa, X. Mi, F. Leisch, F. Scheipl and T. Hothorn. mvtnorm: Multivariate normal and t distributions. R package version 0.9-9995, 2013.
</p>
<p>X. Mi, T. Miwa and T. Hothorn. Implement of Miwa's analytical algorithm of multi-normal distribution. R Journal, 1:37-39, 2009.
</p>


<h3>See Also</h3>

<p> selectiongain(), qnorm() </p>


<h3>Examples</h3>

<pre><code class="language-R">
# first example

VCGCAandError=c(0.40,0.20,0.20,0.40,2.00)
VCSCA=c(0.20,0.10,0.10,0.20)

corr.matrix = multistagecor(maseff=0.40, VGCAandE=VCGCAandError,
VSCA=VCSCA, T=c(1,1,5), L=c(1,3,8), Rep=c(1,1,1))

N1=4500;N2=919;N3=45;Nf=10

Q=multistagetp(c(N2/N1,N3/N2,Nf/N3),  corr=corr.matrix)

</code></pre>


</div>