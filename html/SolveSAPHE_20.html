<div class="container">

<table style="width: 100%;"><tr>
<td>solve_pH_from_AT</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Solver for the total alkalinity-pH equations</h2>

<h3>Description</h3>

<p>Determines [H+] from Total alkalinity and dissolved total elements in sea water. Universal and robust algorithm from Munhoven (2013) with Newton-
Raphson iterations</p>


<h3>Usage</h3>

<pre><code class="language-R">solve_pH_from_AT(p_alktot, p_dicvar, p_bortot, p_po4tot, p_siltot, 
                 p_nh4tot, p_h2stot, p_so4tot, p_flutot, p_pHscale, p_dicsel,
                 p_askVal=FALSE, p_dissoc, p_temp=18, p_sal=35, p_pres=0, p_hini)</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>p_alktot</code></td>
<td>
<p>Total alkalinity (mol/kg)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_dicvar</code></td>
<td>
<p>Value of a carbonate system related variable : DIC, [CO2*], [HCO3-] or [CO3–] (mol/kg)
</p>
<p>See below parameter p_dicsel</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_bortot</code></td>
<td>
<p>Total boron concentration (mol/kg)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_po4tot</code></td>
<td>
<p>Total phosphate concentration (mol/kg)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_siltot</code></td>
<td>
<p>Total silicate concentration (mol/kg)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_nh4tot</code></td>
<td>
<p>Total ammonia concentration (mol/kg)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_h2stot</code></td>
<td>
<p>Total sulfide concentration (mol/kg)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_so4tot</code></td>
<td>
<p>Total sulphate concentration (mol/kg)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_flutot</code></td>
<td>
<p>Total fluor concentration (mol/kg)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_pHscale</code></td>
<td>
<p>Chosen pH scale: "T" for the total scale, "F" for the free scale and "SWS" for using the seawater scale</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_dicsel</code></td>
<td>
<p>Carbonate variable selector (default = DIC). See parameter p_dicvar above. Values are:
</p>
<p>"DIC"   :   p_dicvar = DIC (Dissolved Inorganic Carbon)
</p>
<p>"CO2"   :   p_dicvar = [CO2*]
</p>
<p>"HCO3"  :   p_dicvar = [HCO3-]
</p>
<p>"CO3"   :   p_dicvar = [CO3–]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_askVal</code></td>
<td>
<p>Optional boolean - set to TRUE if you want this function to return error on alkalinity, along with [H+] concentration value. Default is FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_dissoc</code></td>
<td>
<p>Named list of all dissociation constants. 
The list is optional but, if given, it should contain all members listed below excepted K2_Sil, which is itself optional. 
Member names are :
</p>
<p>K1_DIC  :  First dissociation constant of carbonic acid (mol/kg) on chosen scale
</p>
<p>K2_DIC  :  Second dissociation constant of carbonic acid (mol/kg) on chosen scale
</p>
<p>K_BT    :  Dissociation constant of boric acid (mol/kg) on chosen scale
</p>
<p>K1_PO4  :  First dissociation constant of phosphoric acid (mol/kg) on chosen scale
</p>
<p>K2_PO4  :  Second dissociation constant of phosphoric acid (mol/kg) on chosen scale
</p>
<p>K3_PO4  :  third dissociation constant of phosphoric acid (mol/kg) on chosen scale
</p>
<p>K_Sil   :  First dissociation constant of sillicic acid (mol/kg) on chosen scale
</p>
<p>K2_Sil  :  Second dissociation constant of sillicic acid (mol/kg) on chosen scale. It is optional.
If K2_Sil is absent from the list, then SiO2(OH)2 ion is not considered in the alkalinity equation.
Only SiO(OH)3 ion is.
</p>
<p>K_NH4   :  Dissociation constant of ammonium (mol/kg) on chosen scale
</p>
<p>K_H2S   :  Dissociation constant of hydrogen sulfide (mol/kg) on chosen scale
</p>
<p>K_HSO4  :  Dissociation constant of hydrogen sulfate (mol/kg) on free scale
</p>
<p>K_HF    :  Dissociation constant of hydrogen fluoride (mol/kg) on free scale
</p>
<p>K_H2O   :  Dissociation constant of water (mol/kg) on chosen scale
</p>
<p>Note that all dissociation constants shall be expressed in chosen pH scale except K_HF and K_HSO4 which shall be in free scale.
</p>
<p>If the list is not given, these constants, excepted K2_Sil, will be calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_temp</code></td>
<td>
<p>Temperature in degree Celsius, to compute dissociation constants when p_dissoc is not given</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_sal</code></td>
<td>
<p>Salinity, in pratical salinty unit (psu), to compute dissociation constants when p_dissoc is not given</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_pres</code></td>
<td>
<p>Pressure, in bars, to compute dissociation constants when p_dissoc is not given</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_hini</code></td>
<td>
<p>Optional initial value of [H+] concentration
</p>
<p>If p_dicsel = "CO3", a vector of two initial values are expected since there may be two solutions for pH.
Else, one initial value is expected</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Formulations used when calculating dissociation constants:
</p>

<ul>
<li>
<p>Carbonate if Total pH scale: Luecker et al. (2000) – also Handbook (2007)
</p>
</li>
<li>
<p>Carbonate if SWS or Free pH scale: Millero et al. (1995) – also Handbook (2007)
</p>
</li>
<li>
<p>Boric acid: Dickson (1990, eq. 2  3) – also Handbook (2007, eq. 37)
</p>
</li>
<li>
<p>Phosphoric acid: Yao and Millero (1995)
</p>
</li>
<li>
<p>Silicic acid: Yao and Millero (1995) cited by Millero (1995)
</p>
</li>
<li>
<p>Ammonium: Yao and Millero (1995)
</p>
</li>
<li>
<p>Hydrogen sulfide: Millero et al. (1988) (cited by Millero (1995)
</p>
</li>
<li>
<p>Hydrogen sulfate: Dickson (1990) – also Handbook (2007)
</p>
</li>
<li>
<p>Fluoric acid if Total pH scale: Perez and Fraga (1987)
</p>
</li>
<li>
<p>Fluoric acid if SWS or Free pH scale: Dickson and Riley (1979)
</p>
</li>
<li>
<p>Water: Millero (1995)
</p>
</li>
</ul>
<p>This function does not support vectors as arguments, only scalar values.
</p>


<h3>Value</h3>

<p>If p_dicsel is "CO3", there may be one or two solutions for [H+], else there is only one. In case there are two solutions, both are returned.
</p>

<ul>
<li>
<p> If you set p_askVal to TRUE, the function returns a data frame containing the following columns:
</p>
<p>zh    :    [H+] concentration value(s) in the chosen pH scale
</p>
<p>val   :    Error(s) on total alkalinity, that is the deviation between total alkalinity calculated from [H+] and given total alkalinity
</p>
</li>
<li>
<p> If you set p_askVal to FALSE (default), the function returns only [H+] concentration value(s) in the chosen pH scale.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Guy Munhoven and Jean-Marie Epitalon
</p>


<h3>References</h3>

<p>Munhoven G. Munhoven G. (2013) Mathematics of the total alkalinity-pH equation - pathway
to robust and universal solution algorithms: the SolveSAPHE package v1.0.1. <em>Geoscientif. Model Dev.</em>, 1367-1388
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Compute [H+] from Alkalinity total and DIC, on total pH scale
p_dissoc &lt;- list()
p_dissoc$K1_DIC &lt;- 1.421828e-06
p_dissoc$K2_DIC &lt;- 1.081555e-09
p_dissoc$K_BT   &lt;- 2.526573e-09
p_dissoc$K1_PO4 &lt;- 0.02408434
p_dissoc$K2_PO4 &lt;- 1.076024e-06
p_dissoc$K3_PO4 &lt;- 1.600484e-09
p_dissoc$K_Sil  &lt;- 4.071935e-10
p_dissoc$K_NH4  &lt;- 5.380823e-10
p_dissoc$K_H2S  &lt;- 3.087264e-07
p_dissoc$K_HSO4 &lt;- 0.1003021    # on free scale
p_dissoc$K_HF   &lt;- 0.00176441   # on free scale
p_dissoc$K_H2O  &lt;- 5.97496e-14
solve_pH_from_AT(p_alktot=2.5e-3, p_dicvar=2e-3, p_bortot=0.0004157, p_po4tot=0, p_siltot=0, 
                 p_nh4tot=0, p_h2stot=0, p_so4tot=0.0282, p_flutot=6.832e-05, p_pHscale="T",
                 p_dicsel="DIC", p_dissoc=p_dissoc)

## Giving inital [H+] value and asking for final error on alkalinity, on seawater pH scale
result &lt;- solve_pH_from_AT(p_alktot=0.00234, p_dicvar=0.001936461, p_bortot=0.0004157, p_po4tot=0,
                p_siltot=0, p_nh4tot=0, p_h2stot=0, p_so4tot=0.0282, p_flutot=6.832e-05, 
                p_pHscale="SWS",p_dicsel="DIC", p_dissoc=p_dissoc, p_askVal=TRUE, p_hini=1.e-8)
H &lt;- result$zh
error &lt;- result$val

## Compute [H+] from Alkalinity total and CO3, on total free scale
H &lt;- solve_pH_from_AT(p_alktot=0.00240, p_dicvar=2.775481e-04, p_bortot=0.0004157, p_po4tot=0,
                p_siltot=0, p_nh4tot=0, p_h2stot=0, p_so4tot=0.0282, p_flutot=6.832e-05, 
                p_pHscale="F", p_dicsel="CO3", FALSE, p_dissoc=p_dissoc)
H1 &lt;- H[1]
if (H[2] != 1) print ( c("Second solution : ", H[2]))
</code></pre>


</div>