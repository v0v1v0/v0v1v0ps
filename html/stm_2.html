<div class="container">

<table style="width: 100%;"><tr>
<td>alignCorpus</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Align the vocabulary of a new corpus to an old corpus</h2>

<h3>Description</h3>

<p>Function that takes in a list of documents, vocab and (optionally) metadata
for a corpus of previously unseen documents and aligns them to an old vocabulary. 
Helps preprocess documents for <code>fitNewDocuments</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">alignCorpus(new, old.vocab, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>new</code></td>
<td>
<p>a list (such as those produced by <code>textProcessor</code> or <code>prepDocuments</code>) 
containing a list of documents in <code>stm</code> format, a character vector 
containing the vocabulary and optional a <code>data.frame</code> containing meta data.
These should be labeled <code>documents</code>, <code>vocab</code>,and <code>meta</code> respectively.
This is the new set of unseen documents which will be returned with the vocab renumbered
and all words not appearing in <code>old</code> removed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>old.vocab</code></td>
<td>
<p>a character vector containing the vocabulary that you want to align to.
In general this will be the vocab used in your original stm model fit which from an stm
object called <code>mod</code> can be accessed as <code>mod$vocab</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical indicating whether information about the new corpus should be
printed to the screen. Defaults to <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When estimating topic proportions for previously unseen documents using
<code>fitNewDocuments</code> the new documents must have the same vocabulary
ordered in the same was as the original model.  This function helps with that
process.
</p>
<p>Note: the code is not really built for speed or memory efficiency- if you are trying
to do this with a really large corpus of new texts you might consider building the object
yourself using <span class="pkg">quanteda</span> or some other option.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>documents</code></td>
<td>
<p>A list containing the documents in the stm format.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vocab </code></td>
<td>
<p>Character vector of vocabulary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>meta</code></td>
<td>
<p>Data frame or
matrix containing the user-supplied metadata for the retained documents.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>docs.removed</code></td>
<td>
<p>document indices (corresponding to the original data passed) of
documents removed because they contain no words</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>words.removed</code></td>
<td>
<p>words dropped from <code>new</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tokens.removed</code></td>
<td>
<p>the total number of tokens dropped from the new documents.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wordcounts</code></td>
<td>
<p>counts of times the old vocab appears in the new documents</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop.overlap</code></td>
<td>
<p>length two vector used to populate the message printed by verbose.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>prepDocuments</code> <code>fitNewDocuments</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#we process an original set that is just the first 100 documents
temp&lt;-textProcessor(documents=gadarian$open.ended.response[1:100],metadata=gadarian[1:100,])
out &lt;- prepDocuments(temp$documents, temp$vocab, temp$meta)
set.seed(02138)
#Maximum EM its is set low to make this run fast, run models to convergence!
mod.out &lt;- stm(out$documents, out$vocab, 3, prevalence=~treatment + s(pid_rep), 
              data=out$meta, max.em.its=5)
#now we process the remaining documents
temp&lt;-textProcessor(documents=gadarian$open.ended.response[101:nrow(gadarian)],
                    metadata=gadarian[101:nrow(gadarian),])
#note we don't run prepCorpus here because we don't want to drop any words- we want 
#every word that showed up in the old documents.
newdocs &lt;- alignCorpus(new=temp, old.vocab=mod.out$vocab)
#we get some helpful feedback on what has been retained and lost in the print out.
#and now we can fit our new held-out documents
fitNewDocuments(model=mod.out, documents=newdocs$documents, newData=newdocs$meta,
                origData=out$meta, prevalence=~treatment + s(pid_rep),
                prevalencePrior="Covariate")
</code></pre>


</div>