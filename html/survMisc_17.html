<div class="container">

<table style="width: 100%;"><tr>
<td>COV</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
<b>cov</b>ariance matrix for survival data</h2>

<h3>Description</h3>

<p><b>cov</b>ariance matrix for survival data
</p>


<h3>Usage</h3>

<pre><code class="language-R">COV(x, ...)

## S3 method for class 'ten'
COV(x, ..., reCalc = FALSE)

## S3 method for class 'stratTen'
COV(x, ..., reCalc = FALSE)

## S3 method for class 'numeric'
COV(x, ..., n, ncg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>numeric</code> vector of
<em>number of events</em>, <code class="reqn">e_t</code>.
These are assumed to be ordered by discrete times.
<br>
A method is available for objects of <code>class</code> <code>ten</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments (not implemented).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reCalc</code></td>
<td>
<p>Recalcuate the values?
<br>
If <code>reCalc=FALSE</code> (the default) and the <code>ten</code> object already has
the calculated values stored as an <code>attribute</code>,
the value of the <code>attribute</code> is returned directly.
<br><br><b>â€“Arguments for the numeric method:</b></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p><b>n</b>umber at risk (total).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncg</code></td>
<td>
<p><b>n</b>umber at risk, per <b>c</b>ovariate <b>g</b>roup.
<br>
If there are <code class="reqn">2</code> groups, this can be given as a <code>vector</code> with
the number at risk for group <code class="reqn">1</code>.
<br>
If there are <code class="reqn">\geq 2</code> groups, it is
a <code>matrix</code> with one column for each group.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Gives variance-covariance matrix for comparing survival
data for two or more groups.
<br>
Inputs are vectors corresponding to observations at a set of discrete
time points for right censored data, except for <code class="reqn">n1</code>,
the no. at risk by predictor.
<br>
This should be specified as a vector for one group,
otherwise as a matrix with each column corresponding to a group.
</p>


<h3>Value</h3>

<p>An <code>array</code>.
<br>
The first two dimensions = the number of covariate groups <code class="reqn">K</code>,
<code class="reqn">k = 1, 2, \ldots K</code>.
This is the square matrix below.
<br>
The third dimension is the number of observations
(discrete time points).
<br><br>
To calculate this, we use <code>x</code> (= <code class="reqn">e_t</code> below) and
<code class="reqn">n_1</code>, the number at risk in covariate group <code class="reqn">1</code>.
<br>
Where there are <code class="reqn">2</code> groups, the resulting sparse square matrix
(i.e. the non-diagonal elements are <code class="reqn">0</code>)
at time <code class="reqn">t</code> has diagonal elements:
</p>
<p style="text-align: center;"><code class="reqn">cov_t = - \frac{n_{0t} n_{1t} e_t (n_t - e_t)}{n_t^2(n_t-1)}</code>
</p>

<p>For <code class="reqn">\geq 2</code> groups, the resulting square matrix
has diagonal elements given by:
</p>
<p style="text-align: center;"><code class="reqn">cov_{kkt} = \frac{n_{kt}(n_t - n_{kt}) e_t(n_t - e_t)}{
                         n_t^2(n_t - 1)}</code>
</p>

<p>The off diagonal elements are:
</p>
<p style="text-align: center;"><code class="reqn">cov_{klt} = \frac{-n_{kt} n_{lt} e_t (n_t-e_t) }{
                        n_t^2(n_t-1)}</code>
</p>



<h3>Note</h3>

<p>Where the is just one subject at risk <code class="reqn">n=1</code> at 
the final timepoint, the equations above may produce <code>NaN</code>
due to division by zero. This is converted to <code>0</code> for 
simplicity.
</p>


<h3>See Also</h3>

<p>Called by <code>comp</code>
</p>
<p>The name of the function is capitalized 
to distinguish it from:
<br>
?stats::cov
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Two covariate groups
## K&amp;M. Example 7.2, pg 210, table 7.2 (last column).
## Not run: 
data("kidney", package="KMsurv")
k1 &lt;- with(kidney,
           ten(Surv(time=time, event=delta) ~ type))
COV(k1)[COV(k1) &gt; 0]

## End(Not run)
## Four covariate groups
## K&amp;M. Example 7.6, pg 217.
## Not run: 
data("larynx", package="KMsurv")
l1 &lt;- ten(Surv(time, delta) ~ stage, data=larynx)
rowSums(COV(l1), dims=2)

## End(Not run)
## example of numeric method
## Three covariate groups
## K&amp;M. Example 7.4, pg 212.
## Not run: 
data("bmt", package="KMsurv")
b1 &lt;- asWide(ten(Surv(time=t2, event=d3) ~ group, data=bmt))
rowSums(b1[, COV(x=e, n=n, ncg=matrix(data=c(n_1, n_2, n_3), ncol=3))], dims=2)

## End(Not run)
</code></pre>


</div>