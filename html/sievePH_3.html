<div class="container">

<table style="width: 100%;"><tr>
<td>kernel_sievePHaipw</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nonparametric Kernel-Smoothed Stratified Mark-Specific Proportional Hazards
Model with a Univariate Continuous Mark, Missing-at-Random in Some Failures</h2>

<h3>Description</h3>

<p><code>kernel_sievePH</code> implements estimation methods of Sun and Gilbert (2012)
and hypothesis testing methods of Gilbert and Sun (2015) for a mark-specific
proportional hazards model accommodating that some failures have a missing
mark. The methods allow separate baseline mark-specific hazard functions for
different baseline subgroups. Missing marks are handled via augmented IPW
(AIPW) approach.
</p>


<h3>Usage</h3>

<pre><code class="language-R">kernel_sievePHaipw(
  eventTime,
  eventInd,
  mark,
  tx,
  aux = NULL,
  auxType = NULL,
  zcov = NULL,
  strata = NULL,
  formulaPH = ~tx,
  formulaMiss = NULL,
  formulaAux = NULL,
  tau = NULL,
  tband = NULL,
  hband = NULL,
  nvgrid = 100,
  a = NULL,
  b = NULL,
  ntgrid = NULL,
  nboot = 500,
  seed = NULL,
  maxit = 6
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>eventTime</code></td>
<td>
<p>a numeric vector specifying the observed right-censored
event time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eventInd</code></td>
<td>
<p>a numeric vector indicating the event of interest (1 if
event, 0 if right-censored).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mark</code></td>
<td>
<p>a numeric vector specifying a univariate continuous mark subject
to missingness at random. Missing mark values should be set to <code>NA</code>.
For subjects with <code>eventInd = 0</code>, the value in <code>mark</code> should also
be set to <code>NA</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tx</code></td>
<td>
<p>a numeric vector indicating the treatment group (1 if treatment, 0
if placebo).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aux</code></td>
<td>
<p>a numeric vector specifying a binary or a continuous auxiliary
covariate which may be potentially useful for predicting missingness, i.e,
the probability of missing, and for informing about the distribution of
missing marks. The mark missingness model only requires that the auxiliary
covariates be observed in subjects who experienced the event of interest.
For subjects with <code>eventInd = 0</code>, the value in <code>aux</code> may be set
to <code>NA</code>. If no auxiliary covariate is used, set <code>aux</code> to the
default of <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>auxType</code></td>
<td>
<p>a character string describing the data type of <code>aux</code> if
<code>aux</code> is used. Data types allowed include "binary" and "continuous".
If <code>aux</code> is not used, <code>auxType</code> should be set to the default of
<code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zcov</code></td>
<td>
<p>a data frame with one row per subject specifying possibly
time-dependent covariate(s) (not including <code>tx</code>). If no covariate is
used, <code>zcov</code> should be set to the default of <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata</code></td>
<td>
<p>a numeric vector specifying baseline strata (<code>NULL</code> by
default). If specified, a separate mark-specific baseline hazard is assumed
for each stratum. It also allows the models of the probability of
complete-case and of the mark distribution to differ across strata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formulaPH</code></td>
<td>
<p>a one-sided formula object (on the right side of the
<code>~</code> operator) specifying the linear predictor in the proportional
hazards model. Available variables to be used in the formula include
<code>tx</code> and variable(s) in <code>zcov</code>. By default, <code>formulaPH</code> is
specified as <code>~ tx</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formulaMiss</code></td>
<td>
<p>a one-sided formula object (on the right side of the
<code>~</code> operator) specifying the linear predictor in the logistic
regression model used for predicting the probability of observing the mark.
<code>formulaMiss</code> must be provided for the <code>AIPW</code> method. Available
variables to be used in the formula include <code>eventTime</code>, <code>tx</code>,
<code>aux</code>, and variable(s) in <code>zcov</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formulaAux</code></td>
<td>
<p>a one-sided formula object (on the right side of the
<code>~</code> operator) specifying the variables used for estimating the
conditional distribution of <code>aux</code>. If <code>aux</code> is binary, the
formula specifies the linear predictor in a logistic regression and if
<code>aux</code> is continuous, the formula provides a symbolic description of
variables used in kernel conditional density estimation. <code>formulaAux</code>
is optional for the <code>AIPW</code> estimation procedure. Available variables
to be used in the formula include <code>eventTime</code>, <code>tx</code>, <code>mark</code>,
and variable(s) in <code>zcov</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>a numeric value specifying the duration of study follow-up period.
Failures beyond <code>tau</code> are treated right-censored. There needs to be at
least <code class="reqn">10\%</code> of subjects (as a rule of thumb) remaining uncensored by
<code>tau</code> for the estimation to be stable. By default, <code>tau</code> is set
as the maximum of <code>eventTime</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tband</code></td>
<td>
<p>a numeric value between 0 and <code>tau</code> specifying the
bandwidth of the kernel smoothing function over time. By default,
<code>tband</code> is set as (<code>tau</code>-min(<code>eventTime</code>))/5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hband</code></td>
<td>
<p>a numeric value between 0 and 1 specifying the bandwidth of the
kernel smoothing function over mark. By default, <code>hband</code> is set as
<code class="reqn">4\sigma n^{-1/3}</code> where <code class="reqn">\sigma</code> is the estimated standard
deviation of the observed marks for uncensored failure times and <code class="reqn">n</code> is
the number of subjects in the dataset. Larger bandwidths are recommended
for higher percentages of missing marks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nvgrid</code></td>
<td>
<p>an integer value (100 by default) specifying the number of
equally spaced mark values between the minimum and maximum of the observed
mark for which the treatment effects are evaluated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>a numeric value between the minimum and maximum of observed mark
values specifying the lower bound of the range for testing the null
hypotheses <code class="reqn">H_{10}: HR(v) = 1</code> and <code class="reqn">H_{20}: HR(v)</code> does not depend
on <code class="reqn">v</code>, for <code class="reqn">v \in [a, b]</code>; By default, <code>a</code> is set as
<code>(max(mark) - min(mark))/nvgrid + min(mark)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>a numeric value between the minimum and maximum of observed mark
specifying the upper bound of the range for testing the null hypotheses
<code class="reqn">H_{10}: HR(v) = 1</code> and <code class="reqn">H_{20}: HR(v)</code> does not depend on <code class="reqn">v</code>,
for <code class="reqn">v \in [a, b]</code>; By default, <code>b</code> is set as <code class="reqn">max(mark)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntgrid</code></td>
<td>
<p>an integer value (<code>NULL</code> by default) specifying the number
of equally spaced time points for which the mark-specific baseline hazard
functions are evaluated. If <code>NULL</code>, baseline hazard functions are not
evaluated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboot</code></td>
<td>
<p>number of bootstrap iterations (500 by default) for simulating
the distributions of test statistics. If <code>NULL</code>, the hypotheses tests
are not performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>an integer specifying the random number generation seed for
reproducing the test statistics and p-values. By default, a specific seed
is not set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>Maximum number of iterations to attempt for convergence in
estimation. The default is 6.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>kernel_sievePH</code> analyzes data from a randomized
placebo-controlled trial that evaluates treatment efficacy for a
time-to-event endpoint with a continuous mark. The parameter of interest is
the ratio of the conditional mark-specific hazard functions
(treatment/placebo), which is based on a stratified mark-specific
proportional hazards model. This model assumes no parametric form for the
baseline hazard function nor the treatment effect across different mark
values. For data with missing marks, the estimation procedure leverages
auxiliary predictors of whether the mark is observed and augments the IPW
estimator with auxiliary predictors of the missing mark value.
</p>


<h3>Value</h3>

<p>An object of class <code>kernel_sievePH</code> which can be processed by
<code>summary.kernel_sievePH</code> to obtain or print a summary of the
results. An object of class <code>kernel_sievePH</code> is a list containing the
following components:
</p>

<ul>
<li> <p><code>H10</code>: a data frame with test statistics (first row) and
corresponding p-values (second row) for testing <code class="reqn">H_{10}: HR(v) = 1</code> for v
<code class="reqn">\in [a, b]</code>. Columns <code>TSUP1</code> and <code>Tint1</code> include test
statistics and p-values for testing <code class="reqn">H_{10}</code> vs. <code class="reqn">H_{1a}: HR(v) \neq
1</code> for any v <code class="reqn">\in [a, b]</code> (general alternative). Columns <code>TSUP1m</code>
and <code>Tint1m</code> include test statistics and p-values for testing
<code class="reqn">H_{10}</code> vs. <code class="reqn">H_{1m}: HR(v) \leq 1</code> with strict inequality for some v
in <code class="reqn">[a, b]</code> (monotone alternative). <code>TSUP1</code> and <code>TSUP1m</code> are
based on extensions of the classic Kolmogorov-Smirnov supremum-based test.
<code>Tint1</code> and <code>Tint1m</code> are based on generalizations of the
integration-based Cramer-von Mises test. <code>Tint1</code> and <code>Tint1m</code>
involve integration of deviations over the whole range of the mark. If
<code>nboot</code> is <code>NULL</code>, <code>H10</code> is returned as <code>NULL</code>.
</p>
</li>
<li> <p><code>H20</code>: a data frame with test statistics (first row) and
corresponding p-values (second row) for testing <code class="reqn">H_{20}</code>: HR(v) does not
depend on v <code class="reqn">\in [a, b]</code>. Columns <code>TSUP2</code> and <code>Tint2</code> include
test statistics and p-values for testing <code class="reqn">H_{20}</code> vs. <code class="reqn">H_{2a}</code>: HR
depends on v <code class="reqn">\in [a, b]</code> (general alternative). Columns <code>TSUP2m</code>
and <code>Tint2m</code> include test statistics and p-values for testing
<code class="reqn">H_{20}</code> vs. <code class="reqn">H_{2m}</code>: HR increases as v increases <code class="reqn">\in [a, b]</code>
(monotone alternative). <code>TSUP2</code> and <code>TSUP2m</code> are based on
extensions of the classic Kolmogorov-Smirnov supremum-based test.
<code>Tint2</code> and <code>Tint2m</code> are based on generalizations of the
integration-based Cramer-von Mises test. <code>Tint2</code> and <code>Tint2m</code>
involve integration of deviations over the whole range of the mark. If
<code>nboot</code> is <code>NULL</code>, <code>H20</code> is returned as <code>NULL</code>.
</p>
</li>
<li> <p><code>estBeta</code>: a data frame summarizing point estimates and standard
errors of the mark-specific coefficients for treatment at equally-spaced
values between the minimum and the maximum of the observed mark values.
</p>
</li>
<li> <p><code>cBproc1</code>: a data frame containing equally-spaced mark values in
the column <code>Mark</code>, test processes <code class="reqn">Q^{(1)}(v)</code> for observed data in
the column <code>Observed</code>, and <code class="reqn">Q^{(1)}(v)</code> for <code>nboot</code> independent
sets of normal samples in the columns S1, S2, <code class="reqn">\cdots</code>. If
<code>nboot</code> is <code>NULL</code>, <code>cBproc1</code> is returned as <code>NULL</code>.
</p>
</li>
<li> <p><code>cBproc2</code>: a data frame containing equally-spaced mark values in
the column <code>Mark</code>, test processes <code class="reqn">Q^{(2)}(v)</code> for observed data in
the column <code>Observed</code>, and <code class="reqn">Q^{(2)}(v)</code> for <code>nboot</code> independent
sets of normal samples in the columns S1, S2, <code class="reqn">\cdots</code>. If
<code>nboot</code> is <code>NULL</code>, <code>cBproc2</code> is returned as <code>NULL</code>.
</p>
</li>
<li> <p><code>Lambda0</code>: an array of dimension K x nvgrid x ntgrid for the
kernel-smoothed baseline hazard function <code class="reqn">\lambda_{0k}, k = 1, \dots,
  K</code> where <code class="reqn">K</code> is the number of strata. If <code>ntgrid</code> is <code>NULL</code>
(by default), <code>Lambda0</code> is returned as <code>NULL</code>.</p>
</li>
</ul>
<h3>References</h3>

<p>Gilbert, P. B. and Sun, Y. (2015). Inferences on relative failure
rates in stratified mark-specific proportional hazards models with missing
marks, with application to human immunodeficiency virus vaccine efficacy
trials. <em>Journal of the Royal Statistical Society Series C: Applied
Statistics</em>, 64(1), 49-73.
</p>
<p>Sun, Y. and Gilbert, P. B. (2012). Estimation of stratified mark‐specific
proportional hazards models with missing marks. <em>Scandinavian Journal of
Statistics</em>, 39(1), 34-52.
</p>
<p>Yang, G., Sun, Y., Qi, L., &amp; Gilbert, P. B. (2017). Estimation of
stratified mark-specific proportional hazards models under two-phase
sampling with application to HIV vaccine efficacy trials. <em>Statistics
in biosciences</em>, 9, 259-283.
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(20240410)
beta &lt;- 2.1
gamma &lt;- -1.3
n &lt;- 200
tx &lt;- rep(0:1, each = n / 2)
tm &lt;- c(rexp(n / 2, 0.2), rexp(n / 2, 0.2 * exp(gamma)))
cens &lt;- runif(n, 0, 15)
eventTime &lt;- pmin(tm, cens, 3)
eventInd &lt;- as.numeric(tm &lt;= pmin(cens, 3))
alpha &lt;- function(b){ log((1 - exp(-2)) * (b - 2) / (2 * (exp(b - 2) - 1))) }
mark0 &lt;- log(1 - (1 - exp(-2)) * runif(n / 2)) / (-2)
mark1 &lt;- log(1 + (beta - 2) * (1 - exp(-2)) * runif(n / 2) / (2 * exp(alpha(beta)))) /
  (beta - 2)
mark &lt;- ifelse(eventInd == 1, c(mark0, mark1), NA)
# the true TE(v) curve underlying the data-generating mechanism is:
# TE(v) = 1 - exp{alpha(beta) + beta * v + gamma}

# a binary auxiliary covariate
A &lt;- sapply(exp(-0.5 - 0.2 * mark) / (1 + exp(-0.5 - 0.2 * mark)),
            function(p){ ifelse(is.na(p), NA, rbinom(1, 1, p)) })
linPred &lt;- 1 + 0.4 * tx - 0.2 * A
probs &lt;- exp(linPred) / (1 + exp(linPred))
R &lt;- rep(NA, n)
while (sum(R, na.rm = TRUE) &lt; 10){
  R[eventInd == 1] &lt;- sapply(probs[eventInd == 1],
                             function(p){ rbinom(1, 1, p) })
}
# a missing-at-random mark
mark[eventInd == 1] &lt;- ifelse(R[eventInd == 1] == 1, mark[eventInd == 1], NA)

# AIPW estimation; auxiliary covariate is used (not required)
fit &lt;- kernel_sievePHaipw(eventTime, eventInd, mark, tx, aux = A,
                          auxType = "binary", formulaMiss = ~ eventTime,
                          formulaAux = ~ eventTime + tx + mark,
                          tau = 3, tband = 0.5, hband = 0.3, nvgrid = 20,
                          nboot = 20)

</code></pre>


</div>