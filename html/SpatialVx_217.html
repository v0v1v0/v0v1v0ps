<div class="container">

<table style="width: 100%;"><tr>
<td>metrV</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Binary Location Metric Proposed in Zhu et al. (2011)
</h2>

<h3>Description</h3>

<p>Calculate the metric metrV proposed in Zhu et al (2011), which is a linear combination
of the square root of the sum of squared error between two binary fields, and the
mean error distance (Peli and Malah, 1982); or the difference in mean error distances
between two forecast fields and the verification field, if the comparison is performed
between two forecast models against the same verification field.
</p>


<h3>Usage</h3>

<pre><code class="language-R">metrV(x, ...)

## Default S3 method:
metrV(x, xhat, xhat2 = NULL, thresholds, lam1 = 0.5, lam2 = 0.5, 
    distfun = "distmapfun", a = NULL, verbose = FALSE, ...)

## S3 method for class 'SpatialVx'
metrV(x, time.point = 1, obs = 1, model = 1, lam1 = 0.5, lam2 = 0.5, 
    distfun = "distmapfun", verbose = FALSE, ...)

## S3 method for class 'metrV'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>Either a list object as returned by <code>make.SpatialVx</code> or a matrix representing a verificaiton grid.  For the <code>print</code> method, this is an object returned by <code>metrV</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xhat, xhat2</code></td>
<td>

<p>(xhat2 is optional) matrix representing a forecast grid.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresholds</code></td>
<td>
<p>q X 2 or q X 3 (if <code>xhat</code> is not NULL) matrix giving the thresholds to apply to the verification field (first column) and each forecast field.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lam1</code></td>
<td>

<p>numeric giving the weight to be applied to the square root of the sum of squared errors of binary fields term in metrV.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lam2</code></td>
<td>

<p>numeric giving the weight to be applied to the mean error distance term in metrV.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distfun</code></td>
<td>
<p>character naming a function with which to calculate the shortest distances between each point x in the grid and the set of events.  Default is the Euclidean distance metric (see the help file for <code>locperf</code> for more information). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>list object giving certain information about the verification set.  These are the attributes of the “SpatailVx” object.  May be used here to include information (as attributes of the returned object) that would otherwise not be available to the <code>print</code> method function.  In particular, the components, <code>msg</code>, <code>data.name</code> and <code>qs</code> are printed if available.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.point</code></td>
<td>
<p>numeric or character indicating which time point from the “SpatialVx” verification set to select for analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs, model</code></td>
<td>
<p>numeric indicating which observation/forecast model to select for the analysis.  May have length one or two.  If it has length two, the second value is taken to be the second forecast model (i.e., <code>xhat2</code> in the call to <code>metrV.default</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>logical, should progress information be printed ot the screen.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Optional arguments to the <code>distfun</code> function.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The binary location metric proposed in Zhu et al. (2011) is a linear combination of two measures: the amount of overlap between events in two fields, given by <code>distOV</code> (simply the square root of sum of squared errors between two binary fields), and (if there are events in both fields) the mean error distance described in Peli and Malah (1982); see also Baddeley (1992).  The metric can be computed between a forecast field, M1, and the verificaiton field, V, or it can be compared between two foreast models M1 and M2 with reference to V.  That is,
</p>
<p>metrV(M1,M2) = lam1*distOV(I.M1,I.M2) + lam2*distDV(I.M1,I.M2),
</p>
<p>where I.M1 (I.M2) is the binary field determined by M1 &gt;= threshold (M2 &gt;= threshold), distOV(I.M1,I.M2) = sqrt( sum( (I.M1 - I.M2)^2)), distDV(I.M1,I.M2) = abs(distob(I.V,I.M1) - distob(I.V,I.M2)), where distob(A,B) is the mean error distance between A and B, given by:
</p>
<p>e(A,B) = 1/(N(A))*sqrt( sum( d(x,B)), where the summation is over all the points x corresponding to events in A, and d(x,B) is the minimum of the shortest distance from the point x to each point in B.  e(A,B) is calculated by using the distance transform as calculated by the <code>distmap</code> function from package <code>spatstat</code> for computational efficiency.
</p>
<p>Note that if there are no events in both fields, then by definition, the term distob(A,B) = 0, and if there are no events in one and only one of the two fields, then a large constant (here, the maximum dimension of the field), is returned.  In this way, distob differs from the mean error distance described in Peli and Malah (1982).
</p>
<p>If comparing between the verification field and one forecast model, then the distDV term simplifies to just distob(I.V,I.M1).
</p>
<p>One final note is that Eq (6) that defines <code>distOV</code> in Zhu et al. (2011) is correct (or rather, what is used in the paper).  It is not, as is stated below Eq (6) in Zhu et al. (2011) the root *mean* square error, but rather the root square error.  This function computes Eq (6) as written.
</p>


<h3>Value</h3>

<p>list object of class “metrV” with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>OvsM1</code></td>
<td>
<p>k by 3 matrix whose rows represent thresholds and columns give the component distOV, distob and metrV between the verification field and the forecast model 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OvsM2</code></td>
<td>
<p>If object2 supplied, k by 3 matrix whose rows represent thresholds and columns give the component distOV, distob and metrV between the verification field and the forecast model 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M1vsM2</code></td>
<td>
<p>If object2 supplied, k by 3 matrix whose rows represent thresholds and columns give the component distOV, distob and metrV between model 1 and model 2.</p>
</td>
</tr>
</table>
<p>May also contain attributes as passed by either the a argument or the “SpatialVx” object.
</p>


<h3>Author(s)</h3>

<p>Eric Gilleland
</p>


<h3>References</h3>

<p>Baddeley, A. J. (1992) An error metric for binary images.  In <em>Robust Computer Vision Algorithms</em>, W. Forstner and S. Ruwiedel, Eds., Wichmann, 59–78.
</p>
<p>Peli, T. and Malah, D. (1982) A study on edge detection algorithms.  <em>Computer Graphics and Image Processing</em>, <b>20</b>, 1–21.
</p>
<p>Zhu, M., Lakshmanan, V. Zhang, P. Hong, Y. Cheng, K. and Chen, S. (2011) Spatial verification using a true metric.  <em>Atmos. Res.</em>, <b>102</b>, 408–419, doi:10.1016/j.atmosres.2011.09.004.
</p>


<h3>See Also</h3>

<p><code>distob</code>, <code>distmap</code>, <code>im</code>, <code>solutionset</code>, <code>deltametric</code>, <code>locmeasures2d</code>, <code>make.SpatialVx</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
A &lt;- B &lt;- B2 &lt;- matrix( 0, 10, 12)
A[2,3] &lt;- 3
B[4,7] &lt;- 400
B2[10,12] &lt;- 17
hold &lt;- make.SpatialVx( A, list(B, B2), thresholds = c(0.1, 3.1, 500),
    field.type = "contrived", units = "none",
    data.name = "Example", obs.name = "A",
    model.name = c("B", "B2") )

metrV(hold)

metrV(hold, model = c(1,2) )

## Not run: 

data( "geom000" )
data( "geom001" )

testobj &lt;- make.SpatialVx( geom000, geom001, thresholds = 0,
    projection = TRUE, map = TRUE, loc = ICPg240Locs, loc.byrow = TRUE,
    field.type = "Precipitation", units = "mm/h",
    data.name = "ICP Geometric Cases", obs.name = "geom000",
    model.name = "geom001" )

metrV(testobj)

# compare above to results in Fig. 2 (top right panel)
# of Zhu et al. (2011).  Note that they differ wildly.
# Perhaps because an actual elliptical area is taken in
# the paper instead of finding the values from the fields
# themselves?

## End(Not run)

</code></pre>


</div>