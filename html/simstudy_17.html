<div class="container">

<table style="width: 100%;"><tr>
<td>blockDecayMat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a block correlation matrix</h2>

<h3>Description</h3>

<p>The function genBlockMat() generates correlation matrices that 
can accommodate clustered observations over time where the within-cluster 
between-individual correlation in the same time period can be different from the 
within-cluster between-individual correlation across time periods.The matrix
generated here can be used in function addCorGen().
</p>


<h3>Usage</h3>

<pre><code class="language-R">blockDecayMat(ninds, nperiods, rho_w, r, pattern = "xsection", nclusters = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ninds</code></td>
<td>
<p>The number of units (individuals) in each cluster in each period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperiods</code></td>
<td>
<p>The number periods that data are observed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho_w</code></td>
<td>
<p>The within-period/between-individual correlation coefficient between -1 and 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>The decay parameter if correlation declines over time, and can have values of
"exp" or "prop". See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pattern</code></td>
<td>
<p>A string argument with options "xsection" (default) or "cohort".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nclusters</code></td>
<td>
<p>An integer that indicates the number of matrices that will be generated.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Two general decay correlation structures are currently supported: a *cross-sectional* 
exchangeable structure and a *closed cohort* exchangeable structure. In the *cross-sectional* 
case, individuals or units in each time period are distinct. In the *closed cohort* structure, 
individuals or units are repeated in each time period. The desired structure is specified 
using <code>pattern</code>, which defaults to "xsection" if not specified. 
</p>
<p>This function can generate correlation matrices of different sizes, depending on the 
combination of arguments provided. A single matrix will be generated when 
<code>nclusters == 1</code> (the default), and a list of matrices of matrices will be generated when
<code>nclusters &gt; 1</code>.
</p>
<p>If <code>nclusters &gt; 1</code>, the length of <code>ninds</code> will depend on if sample sizes will vary by cluster
and/or period. There are three scenarios,  and function evaluates the length of <code>ninds</code> to 
determine which approach to take:
</p>

<ul>
<li>
<p>if the sample size is the same for all clusters in all periods, <code>ninds</code> will be
a single value (i.e., length = 1).
</p>
</li>
<li>
<p>if the sample size differs by cluster but is the same for each period within each cluster
each period, then <code>ninds</code> will have a value for each cluster (i.e., length = <code>nclusters</code>). 
</p>
</li>
<li>
<p>if the sample size differs across clusters and across periods within clusters, <code>ninds</code> will have a
value for each cluster-period combination (i.e., length = <code>nclusters x nperiods</code>). This option is
only valid when <code>pattern = "xsection"</code>.
</p>
</li>
</ul>
<p>In addition, <code>rho_w</code> and <code>r</code> can be specified as a single value (in which case they are consistent
across all clusters) or as a vector of length <code>nclusters</code>, in which case either one or 
both of these parameters can vary by cluster.
</p>
<p>See vignettes for more details.
</p>


<h3>Value</h3>

<p>A single correlation matrix of size <code>nvars x nvars</code>, or a list of matrices of potentially
different sizes with length indicated by <code>nclusters</code>.
</p>
<p>A single correlation matrix or a list of matrices of potentially
different sizes with length indicated by <code>nclusters</code>.
</p>


<h3>References</h3>

<p>Li et al. Mixed-effects models for the design and analysis of stepped wedge 
cluster randomized trials: An overview. Statistical Methods in Medical Research. 
2021;30(2):612-639. doi:10.1177/0962280220932962
</p>


<h3>See Also</h3>

<p><code>blockExchangeMat</code> and <code>addCorGen</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">blockDecayMat(ninds = 4, nperiods = 3, rho_w = .8, r = .9)
blockDecayMat(ninds = 4, nperiods = 3, rho_w = .8, r = .9, pattern = "cohort")

blockDecayMat(ninds = 2, nperiods = 3, rho_w = .8, r = .9, pattern = "cohort", nclusters=2)
blockDecayMat(ninds = c(2, 3), nperiods = 3, rho_w = c(.8,0.7), r = c(.9,.8), 
  pattern = "cohort", nclusters=2)
blockDecayMat(ninds = c(2, 3, 4, 4, 2, 1), nperiods = 3, rho_w = .8, r = .9, nclusters=2)

</code></pre>


</div>