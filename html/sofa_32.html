<div class="container">

<table style="width: 100%;"><tr>
<td>design_search</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Search design documents</h2>

<h3>Description</h3>

<p>Search design documents
</p>


<h3>Usage</h3>

<pre><code class="language-R">design_search(
  cushion,
  dbname,
  design,
  view,
  params = list(),
  body = list(),
  as = "list",
  ...
)

design_search_many(cushion, dbname, design, view, queries, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>cushion</code></td>
<td>
<p>A <code>Cushion</code> object. Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dbname</code></td>
<td>
<p>(character) Database name. required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>design</code></td>
<td>
<p>(character) Design document name. this is the design name
without <code style="white-space: pre;">⁠_design/⁠</code>, which is prepended internally. required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>view</code></td>
<td>
<p>(character) a view, same as <code>fxn</code> param in
<code>design_create_()</code>. required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params</code></td>
<td>
<p>query parameters. a named list</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>body</code></td>
<td>
<p>same as <code>params</code>, but if any given, a POST request is
sent (if body non-NULL, <code>params</code> also sent). a named list</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Curl args passed on to <code>HttpClient</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>queries</code></td>
<td>
<p>a list of named lists of queries</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Options to pass to <code>params</code>, <code>body</code>, or <code>queries</code> params</h3>


<ul>
<li>
<p> conflicts (logical) Includes conflicts information in response.
Ignored if include_docs isn't <code>TRUE</code>. Default: <code>FALSE</code>
</p>
</li>
<li>
<p> descending (logical) Return the documents in descending by key
order. Default: <code>FALSE</code>
</p>
</li>
<li>
<p> endkey,end_key (list) Stop returning records when the specified key is
reached. Optional. <code>end_key</code> is an alias for <code>endkey</code>
</p>
</li>
<li>
<p> endkey_docid,end_key_doc_id (character) Stop returning records when
the specified document ID is reached. Requires endkey to be specified for
this to have any effect. Optional. <code>end_key_doc_id</code> is an alias for
<code>endkey_docid</code>
</p>
</li>
<li>
<p> group (logical) Group the results using the reduce function to a
group or single row. Default: <code>FALSE</code>
</p>
</li>
<li>
<p> group_level (integer) Specify the group level to be used. Optional
</p>
</li>
<li>
<p> include_docs (logical) Include the associated document with each
row. Default: <code>FALSE</code>.
</p>
</li>
<li>
<p> attachments (logical) Include the Base64-encoded content of
attachments in the documents that are included if include_docs is
<code>TRUE</code>. Ignored if include_docs isn't <code>TRUE</code>.
Default: <code>FALSE</code>
</p>
</li>
<li>
<p> att_encoding_info (logical) Include encoding information in
attachment stubs if include_docs is <code>TRUE</code> and the particular
attachment is compressed. Ignored if include_docs isn't <code>TRUE</code>.
Default: <code>FALSE</code>.
</p>
</li>
<li>
<p> inclusive_end (logical) Specifies whether the specified end key
should be included in the result. Default: <code>TRUE</code>
</p>
</li>
<li>
<p> key (list) Return only documents that match the specified
key. Optional
</p>
</li>
<li>
<p> keys (list) Return only documents where the key matches one of the
keys specified in the array. Optional
</p>
</li>
<li>
<p> limit (integer) Limit the number of the returned documents to the
specified number. Optional
</p>
</li>
<li>
<p> reduce (logical)  Use the reduction function. Default: <code>TRUE</code>
</p>
</li>
<li>
<p> skip (integer)  Skip this number of records before starting to
return the results. Default: 0
</p>
</li>
<li>
<p> sorted (logical)  Sort returned rows (see Sorting Returned Rows).
Setting this to <code>FALSE</code> offers a performance boost. The total_rows
and offset fields are not available when this is set to <code>FALSE</code>.
Default: <code>TRUE</code>
</p>
</li>
<li>
<p> stale (character) Allow the results from a stale view to be used.
Supported values: ok and update_after. Optional
</p>
</li>
<li>
<p> startkey,start_key (list) Return records starting with the specified
key. Optional. <code>start_key</code> is an alias for startkey
</p>
</li>
<li>
<p> startkey_docid,start_key_doc_id (character) Return records starting
with the specified document ID. Requires startkey to be specified for this
to have any effect. Optional. <code>start_key_doc_id</code> is an alias for
<code>startkey_docid</code>
</p>
</li>
<li>
<p> update_seq (logical) Response includes an update_seq value
indicating which sequence id of the database the view reflects.
Default: <code>FALSE</code>
</p>
</li>
</ul>
<h3>References</h3>

<p>https://docs.couchdb.org/en/latest/api/ddoc/views.html
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

file &lt;- system.file("examples/omdb.json", package = "sofa")
strs &lt;- readLines(file)

## create a database
if ("omdb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="omdb"))
}
db_create(x, dbname='omdb')

## add the documents
invisible(db_bulk_create(x, "omdb", strs))

# Create a view, the easy way, but less flexible
design_create(x, dbname='omdb', design='view1', fxnname="foobar1")
design_create(x, dbname='omdb', design='view2', fxnname="foobar2",
  value="doc.Country")
design_create(x, dbname='omdb', design='view5', fxnname="foobar3",
  value="[doc.Country,doc.imdbRating]")
design_create_(x, dbname='omdb', design='view6', fxnname="foobar4",
  fxn = "function(doc){emit(doc._id,doc.Country)}")

# Search using a view
compact &lt;- function(l) Filter(Negate(is.null), l)
res &lt;- design_search(x, dbname='omdb', design='view2', view ='foobar2')
head(
  do.call(
    "rbind.data.frame",
    Filter(
      function(z) length(z) == 2,
      lapply(res$rows, function(x) compact(x[names(x) %in% c('id', 'value')]))
    )
  )
)

res &lt;- design_search(x, dbname='omdb', design='view5', view = 'foobar3')
head(
  structure(do.call(
    "rbind.data.frame",
    lapply(res$rows, function(x) x$value)
  ), .Names = c('Country', 'imdbRating'))
)

# query parameters
## limit
design_search(x, dbname='omdb', design='view5', view = 'foobar3',
  params = list(limit = 5))
## limit and skip
design_search(x, dbname='omdb', design='view5', view = 'foobar3',
  params = list(limit = 5, skip = 3))
## with start and end keys
### important: the key strings have to be in JSON, so here e.g., 
###  need to add escaped double quotes
res &lt;- design_search(
  cushion = x,
  dbname = 'omdb',
  design = 'view6',
  view = 'foobar4',
  params = list(
    startkey = "\"c25bbf4fef99408b3e1115374a03f642\"",
    endkey = "\"c25bbf4fef99408b3e1115374a040f11\""
  )
)

# POST request
ids &lt;- vapply(db_alldocs(x, dbname='omdb')$rows[1:3], "[[", "", "id")
res &lt;- design_search(x, dbname='omdb', design='view6', view = 'foobar4',
  body = list(keys = ids), verbose = TRUE)
res

# Many queries at once in a POST request
queries &lt;- list(
  list(keys = ids),
  list(limit = 3, skip = 2)
)
design_search_many(x, 'omdb', 'view6', 'foobar4', queries)

## End(Not run)
</code></pre>


</div>