<div class="container">

<table style="width: 100%;"><tr>
<td>lockToFormants</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Lock to formants</h2>

<h3>Description</h3>

<p>Internal soundgen function
</p>


<h3>Usage</h3>

<pre><code class="language-R">lockToFormants(
  pitch,
  specEnv,
  formantSummary,
  rolloffMatrix = NULL,
  lockProb = 0.1,
  minLength = 3,
  plot = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pitch</code></td>
<td>
<p>pitch contour, numeric vector (normally pitch_per_gc)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>specEnv</code></td>
<td>
<p>spectral envelope as returned by getSpectralEnvelope</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formantSummary</code></td>
<td>
<p>matrix of exact formant frequencies (formants in rows,
time in columns)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rolloffMatrix</code></td>
<td>
<p>rolloff matrix as returned by getRolloff</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lockProb</code></td>
<td>
<p>the (approximate) proportion of sound affected by formant
locking</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minLength</code></td>
<td>
<p>the minimum number of consecutive pitch values affected
(shorter segments of formant locking are ignored)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>if TRUE, plots the original and modified pitch contour</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When f0 or another relatively strong harmonic is close to one of the
formants, the pitch contour is modified so as to "lock" it to this formant.
The relevant metric is energy gain (ratio of amplitudes before and after the
adjustment) penalized by the magnitude of the necessary pitch jump (in
semitones) and the amplitude of the locked harmonic relative to f0.
</p>


<h3>Examples</h3>

<pre><code class="language-R">n = 50
pitch = getSmoothContour(len = n, anchors = c(600, 2000, 1900, 400),
  thisIsPitch = TRUE, plot = TRUE)
rolloffMatrix = getRolloff(pitch_per_gc = pitch)
specEnv = getSpectralEnvelope(nr = 512, nc = length(pitch),
  formants = list(f1 = c(800, 1200), f2 = 2000, f3 = c(3500, 3200)),
  lipRad = 0, temperature = .00001, plot = TRUE)
formantSummary = t(data.frame(f1 = c(800, 1200), f2 = c(2000, 2000), f3 = c(3500, 3200)))
pitch2 = soundgen:::lockToFormants(pitch = pitch, specEnv = specEnv,
  rolloffMatrix = rolloffMatrix,
  formantSummary = formantSummary,
  lockProb = .5, minLength = 5, plot = TRUE)
pitch3 = soundgen:::lockToFormants(pitch = pitch, specEnv = specEnv,
  rolloffMatrix = rolloffMatrix,
  formantSummary = formantSummary,
  lockProb = list(time = c(0, .7, 1), value = c(0, 1, 0)),
  minLength = 5, plot = TRUE)
</code></pre>


</div>