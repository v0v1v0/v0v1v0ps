<div class="container">

<table style="width: 100%;"><tr>
<td>design.study</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Power and sample size calculation for designing a future study
</h2>

<h3>Description</h3>

<p>Power and sample size calculation for designing a future study
</p>


<h3>Usage</h3>

<pre><code class="language-R">design.study(Axzero, Adeltazero, Aszero, Axone = NULL, Adeltaone = NULL, Asone = 
NULL, delta.ea = NULL, psi = NULL, R.A.given = NULL, t, landmark, extrapolate = T, 
adjustment = F, n = NULL, power = NULL, pi.1 = 0.5, pi.0 = 0.5, cens.rate, transform = F)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Axzero</code></td>
<td>


<p>observed event times in the control group in  Study A
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Adeltazero</code></td>
<td>


<p>event/censoring indicators in the control group in Study A
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Aszero</code></td>
<td>


<p>surrogate marker values in the control group in Study A, NA for individuals not observable at the time the surrogate marker was measured
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Axone</code></td>
<td>


<p>observed event times in the treatment group in  Study A; optional (user must provide either (1) data from treatment arm in Study A or (2) hypothesized values for delta.ea (or R.A.given)and psi or (3) data from treatment arm in Study A and hypothesized psi (if different from observed treatment effect at t in Study A))
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Adeltaone</code></td>
<td>


<p>event/censoring indicators in the treatment group in Study A; optional (user must provide either (1) data from treatment arm in Study A or (2) hypothesized values for delta.ea (or R.A.given)and psi or (3) data from treatment arm in Study A and hypothesized psi (if different from observed treatment effect at t in Study A))
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Asone</code></td>
<td>


<p>surrogate marker values in the treatment group in Study A, NA for individuals not observable at the time the surrogate marker was measured; optional (user must provide either (1) data from treatment arm in Study A or (2) hypothesized values for delta.ea (or R.A.given) and psi or (3) data from treatment arm in Study A and hypothesized psi (if different from observed treatment effect at t in Study A))
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta.ea</code></td>
<td>


<p>hypothesized value for the early treatment effect at time t0; optional (user must provide either (1) data from treatment arm in Study A or (2) hypothesized values for delta.ea (or R.A.given) and psi or (3) data from treatment arm in Study A and hypothesized psi (if different from observed treatment effect at t in Study A)), if not given then it is assumed that this quantity equals the osberved early treatment effect at time t0 in Study A
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psi</code></td>
<td>


<p>hypothesized value for the treatment effect at time t; optional (user must provide either (1) data from treatment arm in Study A or (2) hypothesized values for delta.ea (or R.A.given) and psi or (3) data from treatment arm in Study A and hypothesized psi (if different from observed treatment effect at t in Study A)), if not given then it is assumed that this quantity equals the osberved treatment effect at time t in Study A
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R.A.given</code></td>
<td>


<p>hypothesized value for the proportion of treatment effect on the primary outcome explained by surrogate information at t0 in Study A; optional (user must provide either (1) data from treatment arm in Study A or (2) hypothesized values for delta.ea (or R.A.given) and psi or (3) data from treatment arm in Study A and hypothesized psi (if different from observed treatment effect at t in Study A))
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>


<p>time of interest
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>landmark</code></td>
<td>


<p>landmark time of interest, t0
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extrapolate</code></td>
<td>


<p>TRUE or FALSE; indicates whether local constant extrapolation should be used, default is TRUE
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjustment</code></td>
<td>


<p>TRUE or FALSE; indicates whether adjustment that is needed when survival past time t is high should be used, default is FALSE if survival past t0 is &lt; 0.90 in both arms arm of Study A, otherwise default is true if survival past t0 is &gt;= 0.90 in either arm of Study A
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>


<p>total sample size for future study (Study B); optional (user needs to provide either n or power)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>power</code></td>
<td>


<p>desired power for testing at time t0 for future study (Study B); optional (user needs to provide either n or power)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi.1</code></td>
<td>


<p>proportion of total sample size in future study (Study B) that would be assigned to the treatment group, default is 0.5
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi.0</code></td>
<td>


<p>proportion of total sample size in future study (Study B) that would be assigned to the treatment group, default is 0.5
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens.rate</code></td>
<td>


<p>censoring in the future study (Study B) is assumed to follow an exponential distribution with censoring rate equal to this specificed value
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform</code></td>
<td>


<p>TRUE or FALSE; indicates whether a transformation should be used, default is FALSE.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Assume information is available on a prior study, Study A, examining the effectiveness of a treatment up to some time of interest, t. The aim is to plan a future study, Study B, that would be conducted only up to time <code class="reqn">t_0&lt;t</code> and a test for a treatment effect would occur at <code class="reqn">t_0</code>. In both studies, we assume a surrogate marker is/will be measured at time <code class="reqn">t_0</code> for individuals still observable at <code class="reqn">t_0</code>. Let <code class="reqn">G</code> be the binary treatment indicator with <code class="reqn">G=1</code> for treatment and <code class="reqn">G=0</code> for control and we assume throughout that subjects are randomly assigned to a treatment group at baseline. Let <code class="reqn">T_K^{(1)}</code> and <code class="reqn">T_K^{(0)}</code> denote the time of the primary outcome of interest, death for example, under the treatment and under the control, respectively, in Study K. Let <code class="reqn">S_K^{(1)}</code> and <code class="reqn">S_K^{(0)}</code> denote the surrogate marker measured at time <code class="reqn">t_0</code> under the treatment and the control, respectively, in Study K.
</p>
<p>The null and alternative hypotheses of interest are:
</p>
<p style="text-align: center;"><code class="reqn">H_0: \Delta_B(t) \equiv P(T_B^{(1)}&gt;t) - P(T_B^{(0)}&gt;t) = 0</code>
</p>

<p style="text-align: center;"><code class="reqn">H_1: \Delta_B(t) = \psi &gt;0</code>
</p>

<p>Here, we plan to test <code class="reqn">H_0</code> in Study B using the test statistic </p>
<p style="text-align: center;"><code class="reqn">Z_{EB}(t,t_0) = \sqrt{n_B}\frac{\hat{\Delta}_{EB}(t,t_0)}{\hat{\sigma}_{EB}(t,t_0)}</code>
</p>
<p> (see early.delta.test documentation). The estimated power at a type I error rate of 0.05 is thus
</p>
<p style="text-align: center;"><code class="reqn"> 1 - \Phi \left\{1.96 - \frac{\sqrt{n_B}\hat{R}_{SA}(t, t_0)\psi  }{ \hat{\sigma}_{EB0}(t,t_0\mid \hat{r}_A^{(0)}, W_{B}^{C})} \right \}</code>
</p>

<p>where <code class="reqn">\hat{R}_{SA}(t,t_0) =\hat{\Delta}_{EA}(t,t_0)/\hat{\Delta}_A(t)</code>, and </p>
<p style="text-align: center;"><code class="reqn">\hat{\Delta}_A(t)=n_{A1}^{-1}\sum_{i=1}^{n_{A1}}\frac{I(X_{Ai}^{(1)}&gt;t)}{\hat{W}_{A1}^C(t)}-n_{A0}^{-1}\sum_{i=1}^{n_{A0}}\frac{I(X_{Ai}^{(0)}&gt;t)}{\hat{W}_{A0}^C(t)},</code>
</p>

<p>and <code class="reqn">\hat{\Delta}_{EA}(t,t_0)</code> is parallel to <code class="reqn">\hat{\Delta}_{EB}(t,t_0)</code> except replacing
<code class="reqn">n_{A0}^{-1} \sum_{i=1}^{n_{A0}} \hat{r}_A^{(0)}(t|S_{Ai}^{(0)}, t_0) \frac{I(X_{Ai}^{(0)} &gt; t_0)}{\hat{W}_{A0}^C(t_0)}</code>
by <code class="reqn">n_{A0}^{-1}\sum_{i=1}^{n_{A0}}\hat{W}_{A0}^C(t)^{-1}I(X_{Ai}^{(0)}&gt;t),</code> and <code class="reqn">\hat{W}^C_{Ag}(\cdot)</code> is the Kaplan-Meier estimator of the survival function for <code class="reqn">C_{A}^{(g)}</code> for <code class="reqn">g=0,1</code>.  In addition, <code class="reqn">\hat{\sigma}_{EB0}(t, t_0| \hat{r}_A^{(0)}, W_{B}^{C})^2 =</code> </p>
<p style="text-align: center;"><code class="reqn">\frac{1}{\pi_{B0}\pi_{B1}}\left[ \frac{\hat\mu_{AB2}^{(0)}(t, t_0, \mid \hat r_A^{(0)})}{W_{B}^{C}(t_0)}-\hat\mu_{AB1}^{(0)}(t, t_0, \mid \hat r_A^{(0)})^2\left\{1+\int_0^{t_0}\frac{\lambda_{B}^{C}(u)du}{\hat{W}_{A0}^{T}(u)W_{B}^{C}(u)}\right\}\right]</code>
</p>
<p> assuming that the survival function of the censoring distribution is <code class="reqn">W_{B}^{C}(t)</code> in both arms, where <code class="reqn">\pi_{Bg}=n_{Bg}/n_B</code> and <code class="reqn">\hat{W}_{A0}^{T}(\cdot)</code> is the Kaplan-Meier estimator of  the survival function of <code class="reqn">T_A^{(0)}</code> based on the observations from Study A, and </p>
<p style="text-align: center;"><code class="reqn">\hat\mu_{ABm}^{(0)}(t, t_0, \mid \hat r_A^{(0)})=n_{A0}^{-1}\sum_{i=1}^{n_{A0}}\frac{\hat{r}_A^{(0)}(t|S_{Ai}^{(0)}, t_0)^mI(X_{Ai}^{(0)}&gt;t_0)}{\hat{W}_{A0}^{C}(t_0)}</code>
</p>
<p> where <code class="reqn">\hat{r}_A^{(0)}(t|s, t_0)</code> is provided in the early.delta.test documentation.
</p>
<p>This can be re-arranged to calculate the sample size needed in Study B to achieve a power of <code class="reqn">100(1-\beta)\%</code>:
</p>
<p style="text-align: center;"><code class="reqn">n_B=\left \{ \hat{\sigma}_{EB0}(t,t_0\mid \hat{r}_A^{(0)},W_{B}^{C}) \left (\frac{1.96 - \Phi^{-1}(\beta)}{\hat{R}_{SA}(t,t_0)\psi } \right ) \right \}^2.</code>
</p>

<p>When the outcome rate is low (i.e., survival rate at t is high), an adjustment to the variance calculation is needed. This is automatically implemented if the survival rate at t in either arm is 0.90 or higher. 
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Total sample size needed for Study B at the given power (if power is provided by user).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>power</code></td>
<td>
<p>Estimated power for Study B at the given sample size (if sample size is provided by user).</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Layla Parast
</p>


<h3>References</h3>

<p>Parast L, Cai T, Tian L (2019). Using a Surrogate Marker for Early Testing of a Treatment Effect. Biometrics, 75(4):1253-1263.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(dataA)
design.study(Axzero = dataA$x0, Adeltazero = dataA$delta0, Aszero = dataA$s0, 
Axone = dataA$x1, Adeltaone = dataA$delta1, Asone = dataA$s1, t=1, landmark=0.5, 
power = 0.80, cens.rate=0.5)

design.study(Axzero = dataA$x0, Adeltazero = dataA$delta0, Aszero = dataA$s0, 
Axone = dataA$x1, Adeltaone = dataA$delta1, Asone = dataA$s1, t=1, landmark=0.5, 
n=2500, cens.rate=0.5)

design.study(Axzero = dataA$x0, Adeltazero = dataA$delta0, Aszero = dataA$s0, 
Axone = dataA$x1, Adeltaone = dataA$delta1, Asone = dataA$s1, t=1, landmark=0.5, 
power = 0.80, cens.rate=0.5, psi = 0.05)
</code></pre>


</div>