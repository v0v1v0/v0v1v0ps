<div class="container">

<table style="width: 100%;"><tr>
<td>predict_parts</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Instance Level Parts of Survival Model Predictions</h2>

<h3>Description</h3>

<p>This function decomposes the model prediction into individual parts, which are attributions of particular variables. The explanations can be made via the SurvLIME and SurvSHAP(t) methods.
</p>


<h3>Usage</h3>

<pre><code class="language-R">predict_parts(explainer, ...)

## S3 method for class 'surv_explainer'
predict_parts(
  explainer,
  new_observation,
  ...,
  N = NULL,
  type = "survshap",
  output_type = "survival",
  explanation_label = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other parameters which are passed to <code>iBreakDown::break_down</code> if <code>output_type=="risk"</code>, or if <code>output_type=="survival"</code> to <code>surv_shap()</code> or <code>surv_lime()</code> functions depending on the selected type</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_observation</code></td>
<td>
<p>a new observation for which prediction need to be explained</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>the number of observations used for calculation of attributions. If <code>NULL</code> (default) all explainer data will be used for SurvSHAP(t) and 100 neigbours for SurvLIME.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>if <code>output_type == "survival"</code> must be either <code>"survshap"</code> or <code>"survlime"</code>, otherwise refer to the <code>DALEX::predict_parts</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_type</code></td>
<td>
<p>either <code>"survival"</code>, <code>"chf"</code> or <code>"risk"</code> the type of survival model output that should be considered for explanations. If <code>"survival"</code> the explanations are based on the survival function. If <code>"chf"</code> the explanations are based on the cumulative hazard function. Otherwise the scalar risk predictions are used by the <code>DALEX::predict_parts</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>explanation_label</code></td>
<td>
<p>a label that can overwrite explainer label (useful for multiple explanations for the same explainer/model)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>"predict_parts_survival"</code> and additional classes depending on the type of explanations. It is a list with the element <code>result</code> containing the results of the calculation.
</p>


<h3>Additional parameters</h3>

<p>There are additional parameters that are passed to internal functions
</p>

<ul>
<li>
<p> for <code>survlime</code>
</p>

<ul>
<li> <p><code>N</code> -  a positive integer, number of observations generated in the neighbourhood
</p>
</li>
<li> <p><code>distance_metric</code> -  character, name of the distance metric to be used, only <code>"euclidean"</code> is implemented
</p>
</li>
<li> <p><code>kernel_width</code> -  a numeric, parameter used for calculating weights, by default it's <code>sqrt(ncol(data)*0.75)</code>
</p>
</li>
<li> <p><code>sampling_method</code> -  character, name of the method of generating neighbourhood, only <code>"gaussian"</code> is implemented
</p>
</li>
<li> <p><code>sample_around_instance</code> -  logical, if the neighbourhood should be generated with the new observation as the center (default), or should the mean of the whole dataset be used as the center
</p>
</li>
<li> <p><code>max_iter</code> -  a numeric, maximal number of iteration for the optimization problem
</p>
</li>
<li> <p><code>categorical_variables</code> -  character vector, names of variables that should be treated as categories (factors are included by default)
</p>
</li>
<li> <p><code>k</code> -  a small positive number &gt; 1, added to chf before taking log, so that weigths aren't negative
</p>
</li>
</ul>
</li>
<li>
<p> for <code>survshap</code>
</p>

<ul>
<li> <p><code>y_true</code> -  a two element numeric vector or matrix of one row and two columns, the first element being the true observed time and the second the status of the observation, used for plotting
</p>
</li>
<li> <p><code>calculation_method</code> -  a character, either <code>"kernelshap"</code> for use of <code>kernelshap</code> library (providing faster Kernel SHAP with refinements) or <code>"exact_kernel"</code> for exact Kernel SHAP estimation
</p>
</li>
<li> <p><code>aggregation_method</code> -  a character, either <code>"mean_absolute"</code> or <code>"integral"</code>, <code>"max_absolute"</code>, <code>"sum_of_squares"</code>
</p>
</li>
</ul>
</li>
</ul>
<h3>References</h3>


<ul>
<li>
<p> [1] Krzyzi≈Ñski, Mateusz, et al. <a href="https://www.sciencedirect.com/science/article/pii/S0950705122013302">"SurvSHAP(t): Time-dependent explanations of machine learning survival models."</a> Knowledge-Based Systems 262 (2023): 110234
</p>
</li>
<li>
<p> [2] Kovalev, Maxim S., et al. <a href="https://www.sciencedirect.com/science/article/pii/S0950705120304044?casa_token=6e9cyk_ji3AAAAAA:tbqo33MsZvNC9nrSGabZdLfPtZTsvsvZTHYQCM2aEhumLI5D46U7ovhr37EaYUhmKZrw45JzDhg">"SurvLIME: A method for explaining machine learning survival models."</a> Knowledge-Based Systems 203 (2020): 106164.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

cph_predict_parts_survshap &lt;- predict_parts(cph_exp, new_observation = veteran[1, -c(3, 4)])
head(cph_predict_parts_survshap$result)
plot(cph_predict_parts_survshap)

cph_predict_parts_survlime &lt;- predict_parts(
    cph_exp,
    new_observation = veteran[1, -c(3, 4)],
    type = "survlime"
)
head(cph_predict_parts_survlime$result)
plot(cph_predict_parts_survlime, type = "local_importance")


</code></pre>


</div>