<div class="container">

<table style="width: 100%;"><tr>
<td>clusterer</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Cluster Analysis Verification
</h2>

<h3>Description</h3>

<p>Perform Cluster Analysis (CA) verifcation per Marzban and Sandgathe (2006).
</p>


<h3>Usage</h3>

<pre><code class="language-R">clusterer(X, Y = NULL, ...)

## Default S3 method:
clusterer(X, Y = NULL, ..., xloc = NULL, xyp = TRUE, threshold = 1e-08, 
    linkage.method = "complete", stand = TRUE, trans = "identity", 
    a = NULL, verbose = FALSE)

## S3 method for class 'SpatialVx'
clusterer(X, Y = NULL, ..., time.point = 1, obs = 1, model = 1, xyp = TRUE, 
    threshold = 1e-08, linkage.method = "complete", stand = TRUE, 
    trans = "identity", verbose = FALSE)

## S3 method for class 'clusterer'
plot(x, ..., mfrow = c(1, 2), col = c("gray", tim.colors(64)), 
    horizontal = FALSE)

## S3 method for class 'summary.clusterer'
plot(x, ...)

## S3 method for class 'clusterer'
print(x, ...)

## S3 method for class 'clusterer'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X,Y</code></td>
<td>
<p><code>clusterer</code> default method, these are m by n matrices giving the verification and forecast fields, resp.
</p>
<p>“SpatialVx” method function, <code>X</code> is an object of class “SpatialVx” and <code>Y</code> is not used (a warning is given if it is not missing and not NULL).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object,x</code></td>
<td>
<p>list object of class “clusterer” as returned by <code>clusterer</code> (or <code>summary.clusterer</code> in the case of <code>plot.summary.clusterer</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xloc</code></td>
<td>
<p>(optional) numeric mn by 2  matrix giving the gridpoint locations.  If NULL, this will be created using 1:m and 1:n.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xyp</code></td>
<td>
<p>logical, should the cluster analysis be performed on the locations and intensities (TRUE) or only the locations (FALSE)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>numeric of length one or two giving the threshold to apply to each field (&gt;=).  If length is two, the first value corresponds to the threshold for the verification field, and the second to the foreast field.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linkage.method</code></td>
<td>
<p>character naming a valid linkage method accepted by <code>hclust</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stand</code></td>
<td>
<p>logical, should the data matrices consisting of <code>xloc</code> and each field first be standardized before performing cluster analysis?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trans</code></td>
<td>
<p>character naming a function to be applied to the field intensities before performing the CA.  Only used if <code>xyp</code> is TRUE.  Default applies no transformation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.point</code></td>
<td>
<p>numeric or character indicating which time point from the “SpatialVx” verification set to select for analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs, model</code></td>
<td>
<p>numeric indicating which observation/forecast model to select for the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>(optional) list giving object attributes associated with a “SpatialVx” class object.  The <code>clusterer</code> method for “SpatialVx” objects calls the default method function, and uses this argument to pass the attributes through to the final returned object, as well as to grab location information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mfrow</code></td>
<td>
<p>mfrow parameter (see help file for <code>par</code>).  If NULL, then the parameter is not re-set.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>color vector for image plots of fields after applying the threshold(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>horizontal</code></td>
<td>
<p>logical, should the image plot color legend be placed horizontally or vertically?  Only for image plot sof the fields.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical, should progress information be printed to the screen?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional arguments to the <code>hclust</code> function.  In the case of the <code>summary</code> method function, <code>z</code> and/or <code>sigma</code> giving a numeric value used to find the cut-off given by median + z*sigma for detemining matched objects (see Marzban and Sandgathe 2006) where defaults of 1 and the standard deviation of minimum inter-cluster distances are used, and <code>silent</code> (logical should information be printed to the screen (FALSE) or not (TRUE); default is to print to the screen.  In the case of the <code>plot</code> method functions, these are optional arguments to the <code>summary</code> method function.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function performs cluster analysis (CA) on positive values from each of two fields in a verification set using the hclust function from package fastcluster.  Inter-cluster distances are computed between each cluster of each field at every level of the CA.  The function clusterer performs CA on both fields, and finds the inter-cluster distances across fields for every possible combination of objects at each iteration of each CA.  The summary method function finishes the analysis by determining hits, misses and false alarms as well as the numbers of clusters.  It also computes CSI for each number of cluster combinations.  This is the verification approach described in Marzban and Sandgathe (2006).
</p>
<p>The <code>plot</code> method function creates a 4 by 2 panel of plots.  The top two plots give image plots of the verification and forecast fields with grid points below the threshold(s) showing zero.  The next two plots are dendrograms as performed by the plot method function for <code>hclust</code> (<code>dendrogram</code>) objects.  The next row gives a histogram of the minimum inter-cluster distances, then box plots showing the hits, misses and false alarms for every possible combination of levels of each CA.  Finally, the bottom two plots show, for each combination of CA level (i.e., numbers of clusters), the CSI and average error (inter-cluster distance) for all matched objects.  These last three plots are the ones made by the plot method for values returned from the <code>summary</code> method function.
</p>
<p><code>print</code> is currently not very useful here, but it prevents printing a big mess to the screen.
</p>


<h3>Value</h3>

<p>A list object of class “clusterer” is returned with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>linkage.method</code></td>
<td>
<p>character vector of length one or two giving the linkage method as passed into the function.  The length is two only if the McQuitty method is chosen in which case this method is used for the CA, but not for the inter-cluster differencs across fields (average is used for that instead).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trans</code></td>
<td>
<p>character naming the transformation function applied to the intensities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>numeric giving the size of the fields.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>numeric of length two giving the threshold applied to each field.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NCo,NCf</code></td>
<td>
<p>numeric vectors giving the number of clusters at each iteration of the CA for the verification and forecast fields, resp.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster.identifiers</code></td>
<td>
<p>a list with components X and Y giving lists of lists identifying specific CA components at each level of the CA for both fields.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>idX,idY</code></td>
<td>
<p>logical vectors describing which grid points were included in the CA for each field (i.e., which grid points were &gt;= threshold and had non-missing values).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster.objects</code></td>
<td>
<p>a list with components X and Y giving the objects returned by hclust for each field.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inter.cluster.dist</code></td>
<td>
<p>a list of list objects with NCf by NCo matrix components giving the inter-cluster distances (between verification and forecast fields) for each iteration of CA for each field.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.intercluster.dists</code></td>
<td>
<p>numeric vector givng the minimum values inter.cluster.dist at each iteration.  Used to determine the cut-off for matched objects.</p>
</td>
</tr>
</table>
<p>The summary method function returns a list with the same components as above, but also the components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>The cut-off value used for determining matches.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>csi,AvgErr</code></td>
<td>
<p>NCo by NCf numeric matrix giving the critical success index (CSI) and average intercluster error (distance) based on matched/un-matched objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>HMF</code></td>
<td>
<p>NCo by NCf by 3 array giving the hits, misses and false alarms based on matched/un-matched objects.</p>
</td>
</tr>
</table>
<p>If the argument a is not NULL, then these are returned as attributes of the returned object.  In the case of “SpatialVx” objects, the attributes are preserved.
</p>
<p>plot and print methods do not return anything.
</p>


<h3>Warning</h3>

<p>Although some effort has been put into making the functions in this package as computationally efficient as possible, there is a lot of bookeeping involved with this approach, and the current functions are probably not as efficient as they could be.  In any case, they will likely be slow for large data sets.  The function can work quickly on large fields if an adequately high threshold is used (e.g., if threshold=10 is replaced for 16 in the not run example below, the function is VERY slow).  Performing the actual cluster analysis on each field is fast because the hclust function from the fastcluster package is used, which works very well.  However, bookeeping after the CA is done employs a lot of loops within loops, which possibly can be made more efficient (and maybe someday will be), but for now...
</p>
<p>If it is desired to simply look at the CA for the two fields, the function hclust from fastcluster can be used, which essentially replaces the hclust function from the stats package with a faster version, but otherwise operates the same as far as what is returned, etc., and the same method functions can be employed.
</p>


<h3>Note</h3>

<p>Contact Caren Marzban, marzban “at”  u.washington.edu, for questions about the method, and Eric Gilleland, ericg “at” ucar.edu, for problems with the code.</p>


<h3>Author(s)</h3>

<p>Eric Gilleland
</p>


<h3>References</h3>

<p>Marzban, C. and Sandgathe, S. (2006) Cluster analysis for verification of precipitation fields.  <em>Wea. Forecasting</em>, <b>21</b>, 824–838.
</p>


<h3>See Also</h3>

<p><code>hclust</code>, <code>hclust</code>, <code>as.dendrogram</code>, <code>cutree</code>, <code>make.SpatialVx</code>, <code>CSIsamples</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data( "UKobs6" )
data( "UKfcst6" )
look &lt;- clusterer(X=UKobs6, Y=UKfcst6, threshold=16, trans="log", verbose=TRUE)
plot( look )

## Not run: 
data( "UKloc" )

# Now, do the same thing, but using a "SpatialVx" object.
hold &lt;- make.SpatialVx( UKobs6, UKfcst6, loc = UKloc, map = TRUE,
    field.type = "Rainfall", units = "mm/h",
    data.name = "Nimrod", obs.name = "obs 6", model.name = "fcst 6" )

look2 &lt;- clusterer(hold, threshold=16, trans="log", verbose=TRUE)
plot( look2 )
# Note that values differ because now we're using the
# actual locations instead of integer indicators of
# positions.

## End(Not run)
</code></pre>


</div>