<div class="container">

<table style="width: 100%;"><tr>
<td>FederatedApproachStage1</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fits the first stage model in the two-stage federated data analysis approach.</h2>

<h3>Description</h3>

<p>The function 'FederatedApproachStage1()' fits the first stage model of the two-stage federated data analysis approach to assess surrogacy.
</p>


<h3>Usage</h3>

<pre><code class="language-R">FederatedApproachStage1(
  Dataset,
  Surr,
  True,
  Treat,
  Trial.ID,
  Min.Treat.Size = 2,
  Alpha = 0.05
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Dataset</code></td>
<td>
<p>A data frame with the correct columns (See Data Format).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Surr</code></td>
<td>
<p>Surrogate endpoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>True</code></td>
<td>
<p>True endpoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Treat</code></td>
<td>
<p>Treatment indicator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Trial.ID</code></td>
<td>
<p>Trial indicator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Min.Treat.Size</code></td>
<td>
<p>The minimum number of patients in each group (control or experimental) that a
trial should contain to be included in the analysis. If the number of patients in a
group of a trial is smaller than the value specified by Min.Treat.Size, the data
of the trial are excluded from the analysis. Default 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Alpha</code></td>
<td>
<p>The <code class="reqn">\alpha</code>-level that is used to determine the confidence intervals around <code class="reqn">R^2_{trial}</code> and <code class="reqn">R^2_{indiv}</code>. Default 0.05.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns an object of class "FederatedApproachStage1()" that can be used to evaluate surrogacy in the second stage model and contains the following elements:
</p>

<ul>
<li>
<p> Results.Stage.1: a data frame that contains the estimated fixed effects and the elements of <code class="reqn">\Sigma_i</code>.
</p>
</li>
<li>
<p> R.i: the variance-covariance matrix of the estimated fixed effects.
</p>
</li>
</ul>
<h3>Model</h3>

<p>The two-stage federated data analysis approach developed by XXX can be used to assess surrogacy in the meta-analytic multiple-trial setting
(Continuous-continuous case), but without the need of sharing data. Instead, each organization conducts separate analyses on their data set
using a so-called "first stage" model. The results of these analyses are then aggregated at a central analysis hub,
where the aggregated results are analyzed using a "second stage" model and the necessary metrics (<code class="reqn">R^2_{trial}</code> and <code class="reqn">R^2_{indiv}</code>)
for the validation of the surrogate endpoint are obtained. This function fits the first stage model, where a linear model is fitted,
allowing estimation of the fixed effects.
</p>


<h3>Data Format</h3>

<p>The data frame must contain the following columns:
</p>

<ul>
<li>
<p> a column with the true endpoint
</p>
</li>
<li>
<p> a column with the surrogate endpoint
</p>
</li>
<li>
<p> a column with the treatment indicator: 0 or 1
</p>
</li>
<li>
<p> a column with the trial indicator
</p>
</li>
<li>
<p> a column with the patient indicator
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Dries De Witte
</p>


<h3>References</h3>

<p>Florez, A. J., Molenberghs G, Verbeke G, Alonso, A. (2019). A closed-form estimator for metaanalysis and surrogate markers evaluation. Journal of Biopharmaceutical Statistics, 29(2) 318-332.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#As an example, the federated data analysis approach can be applied to the Schizo data set
data(Schizo)
Schizo &lt;-  Schizo[order(Schizo$InvestId, Schizo$Id),]
#Create separate datasets for each investigator
Schizo_datasets &lt;- list()

for (invest_id in 1:198) {
Schizo_datasets[[invest_id]] &lt;- Schizo[Schizo$InvestId == invest_id, ]
assign(paste0("Schizo", invest_id), Schizo_datasets[[invest_id]])
}
#Fit the first stage model for each dataset separately
results_stage1 &lt;- list()
invest_ids &lt;- list()
i &lt;- 1
for (invest_id in 1:198) {
  dataset &lt;- Schizo_datasets[[invest_id]]

  skip_to_next &lt;- FALSE
  tryCatch(FederatedApproachStage1(dataset, Surr=CGI, True=PANSS, Treat=Treat, Trial.ID = InvestId,
                                   Min.Treat.Size = 5, Alpha = 0.05),
                                   error = function(e) { skip_to_next &lt;&lt;- TRUE})
  #if the trial does not have the minimum required number, skip to the next
  if(skip_to_next) { next }

  results_stage1[[invest_id]] &lt;- FederatedApproachStage1(dataset, Surr=CGI, True=PANSS, Treat=Treat,
                                                         Trial.ID = InvestId, Min.Treat.Size = 5,
                                                         Alpha = 0.05)
  assign(paste0("stage1_invest", invest_id), results_stage1[[invest_id]])
  invest_ids[[i]] &lt;- invest_id #keep a list of ids with datasets with required number of patients
  i &lt;- i+1
}

invest_ids &lt;- unlist(invest_ids)
invest_ids

#Combine the results of the first stage models
for (invest_id in invest_ids) {
  dataset &lt;- results_stage1[[invest_id]]$Results.Stage.1
  if (invest_id == invest_ids[1]) {
    all_results_stage1&lt;- dataset
 } else {
    all_results_stage1 &lt;- rbind(all_results_stage1,dataset)
  }
}

all_results_stage1 #that combines the results of the first stage models

R.list &lt;- list()
i &lt;- 1
for (invest_id in invest_ids) {
  R &lt;- results_stage1[[invest_id]]$R.i
  R.list[[i]] &lt;- as.matrix(R[1:4,1:4])
  i &lt;- i+1
}

R.list #list that combines all the variance-covariance matrices of the fixed effects

fit &lt;- FederatedApproachStage2(Dataset = all_results_stage1, Intercept.S = Intercept.S,
                               alpha = alpha, Intercept.T = Intercept.T, beta = beta,
                               sigma.SS = sigma.SS, sigma.ST = sigma.ST,
                               sigma.TT = sigma.TT, Obs.per.trial = n,
                               Trial.ID = Trial.ID, R.list = R.list)
summary(fit)

## End(Not run)
</code></pre>


</div>