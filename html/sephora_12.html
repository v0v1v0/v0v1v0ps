<div class="container">

<table style="width: 100%;"><tr>
<td>phenopar_polygon</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Phenological parameters estimation in mass</h2>

<h3>Description</h3>

<p>Estimation of phenological parameters from a set of numeric vectors stored in a RData file. 
Output is saved as a RData file at the destination specified by <code>dirToSave</code>
</p>


<h3>Usage</h3>

<pre><code class="language-R">phenopar_polygon(
  path = NULL,
  product = c("MOD13Q1", "independent"),
  data,
  frequency = 23,
  method = c("OLS", "WLS"),
  sigma = NULL,
  numFreq,
  delta = 0,
  distance,
  samples,
  basis,
  corr = NULL,
  k,
  trace = FALSE,
  numCores = 20,
  dirToSave,
  reportFileBaseName = "phenopar_progress",
  outputFileBaseName = "polygon"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>character with full path of RData file containing numeric vectors to analyze.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>product</code></td>
<td>
<p>character specifying whether dataset is the <code>MOD13Q1</code> product (default) or 
a different one (<code>independent</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>matrix with dataset to analyze. Pertinent when <code>product="independent"</code> only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>frequency</code></td>
<td>
<p>integer giving number of observations per season. Default, 23.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>character. Should <code>OLS</code> or <code>WLS</code> be used for smoothing each
numeric vector in RData file specified in <code>path</code>?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>numeric vector of length equal to <code>frequency</code>. Each entry gives the 
standard deviation of observations acquired at same day of the year. 
Pertinent when <code>method=WLS</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numFreq</code></td>
<td>
<p>integer specifying number of frequencies to use in harmonic regression
model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>numeric. Default, 0. When regression problem is ill-posed, this
parameter allows a simple regularization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distance</code></td>
<td>
<p>character indicating what distance to use in hierarchical clustering.
All distances in <code>tsclust</code> are allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samples</code></td>
<td>
<p>integer with number of samples to draw from smoothed version of numeric
vector to analyze. Used exclusively in Functional Principal Components Analysis (FPCA)-based
regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>basis</code></td>
<td>
<p>list giving numeric basis used in FPCA-based regression. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corr</code></td>
<td>
<p>Default <code>NULL</code>. Object defining correlation structure, can be
numeric vector, matrix or function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>integer, number of principal components used in FPCA-based regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>logical. If <code>TRUE</code>, progress on the hierarchical clustering
is printed on console. Default, <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numCores</code></td>
<td>
<p>integer. How many processing cores can be used?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dirToSave</code></td>
<td>
<p>character. In which directory to save analysis results?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reportFileBaseName</code></td>
<td>
<p>character. What base name should be given to a progress report file? 
Default, <code>phenopar_progress</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outputFileBaseName</code></td>
<td>
<p>character. What base name should be given to the output file? 
Default, <code>polygon</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>At the location specified by <code>dirToSave</code>, a file containing a matrix
with <code>nrow</code> equal to the number of numeric vectors analyzed and 6 columns, is saved. 
The name of this file is:
</p>
<p><code>paste0(tools::file_path_sans_ext(basename(path)), "_phenoparams.RData")</code>.
</p>


<h3>See Also</h3>

<p><code>phenopar</code>, <code>getSpiralPlot</code>, 
<code>tsclust</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
dirOUTPUT &lt;- system.file("data", package = "sephora")
BASIS &lt;- drbasis(n=100, q=2)

polygon_deciduous &lt;- deciduous_polygon
for(i in 1:nrow(polygon_deciduous)){
  polygon_deciduous[i,] &lt;- vecFromData(data=deciduous_polygon, numRow=i)$vec
}

# --- In the following example 'numCores=2' for CRAN
# --- testing purposes only. In a real life example
# --- users are encouraged to set 'numCores' to a number
# --- that reflects the size of their data set as well
# --- as the number of available cores

phenopar_polygon(data=polygon_deciduous,
                 product="independent",
                 numFreq = 3, distance = "dtw2",
                 samples=100, basis=BASIS,
                 k=3, numCores=2,
                 dirToSave=dirOUTPUT,
                 outputFileBaseName = "deciduous")
                 
# --- Auxiliary function to read phenopar_polygon output,
# --- used below to define deciduous_params object                   
LoadToEnvironment &lt;- function(RData, env = new.env()){
                              load(RData, env)
                              return(env)}
                 
# --- colors used in spiralPlot below
cgu &lt;- rgb(173/255,221/255,142/255)
csos &lt;- rgb(120/255,198/255,121/255)
cmat &lt;- rgb(49/255, 163/255,84/255)
csen &lt;- rgb(217/255, 95/255, 14/255)
ceos &lt;- rgb(254/255, 153/255, 41/255)
cdor &lt;- rgb(208/255, 209/255, 230/255)

colores &lt;- c(cgu,csos,cmat,csen,ceos,cdor)

# --- how to get a SpiralPlot
listRDatas &lt;- list.files(path=dirOUTPUT,
                         pattern=".RData",
                         full.names=TRUE)
                         
deciduous_params &lt;- LoadToEnvironment(listRDatas[1])

getSpiralPlot(MAT=deciduous_params$output, 
              LABELS=month.name,
              vp_param=list(width=0.5, height=0.7))
vcd::grid_legend(x=1.215, y=0.125, pch=18, col=colores,
                frame=FALSE,
                labels=c("GU","SoS","Mat","Sen","EoS","Dor"),
                title="Params")
            
# --- cleaning up after work
unlink(paste0(dirOUTPUT, "/deciduous_phenoParams.RData"))
unlink(paste0(dirOUTPUT, "/phenopar_progress.txt"))

</code></pre>


</div>