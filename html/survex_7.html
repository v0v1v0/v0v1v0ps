<div class="container">

<table style="width: 100%;"><tr>
<td>explain_survival</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>A model-agnostic explainer for survival models</h2>

<h3>Description</h3>

<p>Black-box models have vastly different structures. <code>explain_survival()</code>
returns an explainer object that can be further processed for creating
prediction explanations and their visualizations. This function is used to manually
create explainers for models not covered by the <code>survex</code> package. For selected
models the extraction of information can be done automatically. To do
this, you can call the <code>explain()</code> function for survival models from  <code>mlr3proba</code>, <code>censored</code>,
<code>randomForestSRC</code>, <code>ranger</code>, <code>survival</code> packages and any other model
with <code>pec::predictSurvProb()</code> method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">explain_survival(
  model,
  data = NULL,
  y = NULL,
  predict_function = NULL,
  predict_function_target_column = NULL,
  residual_function = NULL,
  weights = NULL,
  ...,
  label = NULL,
  verbose = TRUE,
  colorize = !isTRUE(getOption("knitr.in.progress")),
  model_info = NULL,
  type = NULL,
  times = NULL,
  times_generation = "survival_quantiles",
  predict_survival_function = NULL,
  predict_cumulative_hazard_function = NULL
)

explain(
  model,
  data = NULL,
  y = NULL,
  predict_function = NULL,
  predict_function_target_column = NULL,
  residual_function = NULL,
  weights = NULL,
  ...,
  label = NULL,
  verbose = TRUE,
  colorize = !isTRUE(getOption("knitr.in.progress")),
  model_info = NULL,
  type = NULL
)

## Default S3 method:
explain(
  model,
  data = NULL,
  y = NULL,
  predict_function = NULL,
  predict_function_target_column = NULL,
  residual_function = NULL,
  weights = NULL,
  ...,
  label = NULL,
  verbose = TRUE,
  colorize = !isTRUE(getOption("knitr.in.progress")),
  model_info = NULL,
  type = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>object - a survival model to be explained</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data.frame - data which will be used to calculate the explanations. If not provided, then it will be extracted from the model if possible. It should not contain the target columns. NOTE: If the target variable is present in the <code>data</code> some functionality breaks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p><code>survival::Surv</code> object containing event/censoring times and statuses corresponding to <code>data</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict_function</code></td>
<td>
<p>function taking 2 arguments - <code>model</code> and <code>newdata</code> and returning a single number for each observation - risk score. Observations with higher score are more likely to observe the event sooner.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict_function_target_column</code></td>
<td>
<p>unused, left for compatibility with DALEX</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residual_function</code></td>
<td>
<p>unused, left for compatibility with DALEX</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>unused, left for compatibility with DALEX</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments, passed to <code>DALEX::explain()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label</code></td>
<td>
<p>character - the name of the model. Used to differentiate on visualizations with multiple explainers. By default it's extracted from the 'class' attribute of the model if possible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical, if TRUE (default) then diagnostic messages will be printed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colorize</code></td>
<td>
<p>logical, if TRUE (default) then WARNINGS, ERRORS and NOTES are colorized. Will work only in the R console. By default it is FALSE while knitting and TRUE otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_info</code></td>
<td>
<p>a named list (<code>package</code>, <code>version</code>, <code>type</code>) containing information about model. If <code>NULL</code>, <code>survex</code> will seek for information on its own.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>type of a model, by default <code>"survival"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>times</code></td>
<td>
<p>numeric, a vector of times at which the survival function and cumulative hazard function should be evaluated for calculations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>times_generation</code></td>
<td>
<p>either <code>"survival_quantiles"</code>, <code>"uniform"</code> or <code>"quantiles"</code>. Sets the way of generating the vector of times based on times provided in the <code>y</code> parameter. If <code>"survival_quantiles"</code> the vector contains unique time points out of 50 uniformly distributed survival quantiles based on the Kaplan-Meier estimator, and additional time point being the median survival time (if possible); if <code>"uniform"</code> the vector contains 50 equally spaced time points between the minimum and maximum observed times; if <code>"quantiles"</code> the vector contains unique time points out of 50 time points between 0th and 98th percentiles of observed times. Ignored if <code>times</code> is not <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict_survival_function</code></td>
<td>
<p>function taking 3 arguments <code>model</code>, <code>newdata</code> and <code>times</code>, and returning a matrix whose each row is a survival function evaluated at <code>times</code> for one observation from <code>newdata</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict_cumulative_hazard_function</code></td>
<td>
<p>function taking 3 arguments <code>model</code>, <code>newdata</code> and <code>times</code>, and returning a matrix whose each row is a cumulative hazard function evaluated at <code>times</code> for one observation from <code>newdata</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>It is a list containing the following elements:
</p>

<ul>
<li> <p><code>model</code> - the explained model.
</p>
</li>
<li> <p><code>data</code> - the dataset used for training.
</p>
</li>
<li> <p><code>y</code> - response for observations from <code>data</code>.
</p>
</li>
<li> <p><code>residuals</code> - calculated residuals.
</p>
</li>
<li> <p><code>predict_function</code> - function that may be used for model predictions, shall return a single numerical value for each observation.
</p>
</li>
<li> <p><code>residual_function</code> - function that returns residuals, shall return a single numerical value for each observation.
</p>
</li>
<li> <p><code>class</code> - class/classes of a model.
</p>
</li>
<li> <p><code>label</code> - label of explainer.
</p>
</li>
<li> <p><code>model_info</code> - named list containing basic information about model, like package, version of package and type.
</p>
</li>
<li> <p><code>times</code> - a vector of times, that are used for evaluation of survival function and cumulative hazard function by default
</p>
</li>
<li> <p><code>predict_survival_function</code> - function that is used for model predictions in the form of survival function
</p>
</li>
<li> <p><code>predict_cumulative_hazard_function</code> - function that is used for model predictions in the form of cumulative hazard function
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
library(survival)
library(survex)

cph &lt;- survival::coxph(survival::Surv(time, status) ~ .,
    data = veteran,
    model = TRUE, x = TRUE
)
cph_exp &lt;- explain(cph)

rsf_ranger &lt;- ranger::ranger(survival::Surv(time, status) ~ .,
    data = veteran,
    respect.unordered.factors = TRUE, num.trees = 100, mtry = 3, max.depth = 5
)
rsf_ranger_exp &lt;- explain(rsf_ranger,
    data = veteran[, -c(3, 4)],
    y = Surv(veteran$time, veteran$status)
)

rsf_src &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
rsf_src_exp &lt;- explain(rsf_src)

library(censored, quietly = TRUE)

bt &lt;- parsnip::boost_tree() %&gt;%
    parsnip::set_engine("mboost") %&gt;%
    parsnip::set_mode("censored regression") %&gt;%
    generics::fit(survival::Surv(time, status) ~ ., data = veteran)
bt_exp &lt;- explain(bt, data = veteran[, -c(3, 4)], y = Surv(veteran$time, veteran$status))

###### explain_survival() ######

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran)

veteran_data &lt;- veteran[, -c(3, 4)]
veteran_y &lt;- Surv(veteran$time, veteran$status)
risk_pred &lt;- function(model, newdata) predict(model, newdata, type = "risk")
surv_pred &lt;- function(model, newdata, times) pec::predictSurvProb(model, newdata, times)
chf_pred &lt;- function(model, newdata, times) -log(surv_pred(model, newdata, times))

manual_cph_explainer &lt;- explain_survival(
    model = cph,
    data = veteran_data,
    y = veteran_y,
    predict_function = risk_pred,
    predict_survival_function = surv_pred,
    predict_cumulative_hazard_function = chf_pred,
    label = "manual coxph"
)


</code></pre>


</div>