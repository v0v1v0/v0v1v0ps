<div class="container">

<table style="width: 100%;"><tr>
<td>csv_optique.moodle</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Convertir un fichier CSV en questions Moodle
</h2>

<h3>Description</h3>

<p>Cette fonction permet de convertir un fichier CSV, au format « lecture
optique », en un fichier XML de questions pour Moodle
</p>


<h3>Usage</h3>

<pre><code class="language-R">csv_optique.moodle( fichier.csv,
                    forcer.multiple = FALSE, melanger.reponses = TRUE, 
                    somme.nulle = FALSE,
                    fichier.xml = if ( TRUE == nv.fichier )
                                    gsub( "\\.[Cc][Ss][Vv]$",
                                          ".xml", fichier.csv )
                                  else get( "fichier.xml",
                                            envir = SARP.Moodle.env ),
                    nv.fichier = TRUE,
                    embellir = TRUE, deja.HTML = FALSE,
                    categorie.base = "",
                    dossier.images = ".",
                    sep.images = c( '@@', '@@' ), inserer.images = TRUE,
                    sep.formules = c( '@\\$', '\\$@' ),
                    sep.SMILES = c( '@\\{', '\\}@' ),
                    sep = ";", header = TRUE, quote = '\"', 
                    ... )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fichier.csv</code></td>
<td>

<p>Un vecteur de chaînes de caractères contenant les noms des fichiers
à convertir. Chacun des fichiers est traité indépendamment, mais
avec les mêmes valeurs des options qui suivent.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>forcer.multiple</code></td>
<td>

<p>Si <code>TRUE</code>, les questions sont toujours
considérées comme des réponses à choix multiples (l'étudiant pourra
cocher plusieurs réponses). Sinon, si une seule bonne réponse est
proposée, la question est à choix unique (l'étudiant ne pourra
choisir qu'une seule réponse).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>melanger.reponses</code></td>
<td>

<p>Si <code>TRUE</code>, autorise Moodle à permuter aléatoirement l'ordre des
réponses lorsqu'il pose la question. Sinon, l'ordre du fichier est
tout le temps utilisé.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>somme.nulle</code></td>
<td>

<p>Cette option précise comment gérer les réponses incorrectes du
QCM.  Si <code>FALSE</code>, les réponses incorrectes ont une note nulle.
Si <code>TRUE</code>, les réponses incorrectes se voient attribuer une
note négative telle que la somme de ces notes vaut -1, de sorte que
si l'étudiant coche toutes les cases du QCM, il a 0 (sauf bien sûr
si toutes les cases correspondent à des questions correctes...).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fichier.xml</code></td>
<td>

<p>Le nom du fichier XML à créer ou un fichier XML déjà créé avec
<code>debuter_xml.moodle</code>. Par
défaut, la fonction crée un fichier de même nom que le premier
fichier fourni, en remplaçant l'extension <code>.csv</code> par
<code>.xml</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nv.fichier</code></td>
<td>

<p>Une valeur logique indiquant si l'on veut créer un nouveau fichier
(<code>TRUE</code>) ou utiliser un fichier XML déjà ouvert avec
<code>debuter_xml.moodle</code> (<code>FALSE</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>embellir,deja.HTML</code></td>
<td>

<p>Actuellement inutilisés, prévus pour une version future
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>categorie.base</code></td>
<td>

<p>La catégorie de base à utiliser pour créer les questions. Elle
contiendra toutes les questions du fichier.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dossier.images</code></td>
<td>
<p> Le dossier d'image où trouver les images à
intégrer au fichier XML, ou l'URL de base pour les trouver dans
Moodle (voir <code>definir_dossier.image.moodle</code>). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep.images</code></td>
<td>
<p> Les codes servant à encadrer un nom d'image dans
les textes du fichier CSV. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inserer.images</code></td>
<td>
<p> Si <code>TRUE</code>, les images sont incluses dans
le fichier XML. Sinon, seul le lien est construit. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep.formules</code></td>
<td>
<p> Les codes servant à encadrer une formule
mathématique à convertir grâce à latex dans les textes du fichier
CSV. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep.SMILES</code></td>
<td>
<p> Les codes servant à encadrer un code SMILES à
convertir en formule chimique grâce à openbabel dans les textes du
fichier CSV. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep, header, quote</code></td>
<td>

<p>Options pour <code>read.table</code>, correspondant au format d'un
fichier CSV par défaut lorsqu'il est créé par Libre office ou Excel.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Autres options pour <code>read.table</code>, si nécessaire.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Ces fonctions réalisent la conversion d'un ou plusieurs fichiers CSV
de questions pour Moodle en un fichier XML. Les questions sont
nécessairement des QCM.
</p>
<p>Ce fichier doit être au format utilisé par les lecteurs optiques de
QCM. La première ligne, qui donne le numéro de question, est ignorée,
ainsi que la première colonne.  Chacune des autres colonnes correspond
à une question différente.
</p>
<p>Pour chaque question, la première ligne indique le titre, la suivante
l'énoncé.  Ensuite, les réponses possibles et leur justesse alternent.
</p>
<p><strong>Insérer des images</strong>
</p>
<p>Il est possible de faire référence à une image dans les textes
(énoncés, réponses, commentaires) en encadrant le nom de fichier de
l'image par les séparateurs choisis, par défaut <code>@@</code>. Il est
possible de redimensionner l'image en faisant suivre le nom de l'image
d'un point d'exclamation, puis de la largeur, du caractère x et de la
hauteur.  Attention, il semblerait que Moodle ne déforme pas les
images, quelles que soient les dimensions demandées.  Par défaut,
l'image sera incluse au fichier XML.
</p>
<p>Deux types d'image peuvent être créés au vol : les formules
mathématiques et les formules chimiques. Voir les fonctions
<code>inserer_formule.moodle</code> et
<code>inserer_SMILES.moodle</code> pour plus de détails.
</p>


<h3>Value</h3>

<p>De façon invisible, une liste des data.frames des questions après
traitement de chaque fichier.  Elle n'a guère d'autre intérêt que pour
détecter l'origine d'un problème de conversion.
</p>


<h3>Attention!</h3>

<p>Moodle est assez peu permissif pour les notes
exprimées en pourcentage; en particulier, lorsque ce pourcentage ne
tombe pas juste (33% pour trois bonnes réponses, par exemple), à
cause de l'arrondi il peut rejeter le fichier créé. Dans ce cas,
désactivez l'arrêt en cas d'erreur et demandez l'arrondi à la note la
plus proche pour pouvoir importer les questions.
</p>


<h3>Author(s)</h3>

<p>Emmanuel Curis <a href="mailto:emmanuel.curis@parisdescartes.fr">emmanuel.curis@parisdescartes.fr</a> (sur une idée
de Wilfrid Cariou)
</p>


<h3>See Also</h3>

<p>Les fonctions de base de création de questions pour plus de souplesse,
et en particulier pour créer des questions non gérées par le format de
fichier ci-dessus.
</p>
<p><code>csv.moodle</code> pour convertir un fichier CSV au format
proposé par SARP.moodle, permettant de gérer davantage de sortes de
question.
</p>


<h3>Examples</h3>

<pre><code class="language-R">  # Conversion du fichier d'exemple fourni
  #  (à placer dans le répertoire de travail)
## Not run: 
  csv_optique.moodle( "exemple_optique.csv" )

## End(Not run)
</code></pre>


</div>