<div class="container">

<table style="width: 100%;"><tr>
<td>crepuscule</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute crepuscular time</h2>

<h3>Description</h3>

<p>Calculates the crepuscular time, i.e., the time of dawn or dusk
at a specific geographical location and time.
</p>


<h3>Usage</h3>

<pre><code class="language-R">crepuscule(crds, dateTime, ...)

## S4 method for signature 'sf,POSIXct'
crepuscule(
  crds,
  dateTime,
  solarDep,
  direction = c("dawn", "dusk"),
  POSIXct.out = FALSE
)

## S4 method for signature 'matrix,POSIXct'
crepuscule(
  crds,
  dateTime,
  crs = sf::st_crs(4326),
  solarDep,
  direction = c("dawn", "dusk"),
  POSIXct.out = FALSE
)

## S4 method for signature 'SpatialPoints,POSIXct'
crepuscule(
  crds,
  dateTime,
  solarDep,
  direction = c("dawn", "dusk"),
  POSIXct.out = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>crds</code></td>
<td>
<p>Geographical coordinates. It can be an object of
class <code>sf</code>, <code>matrix</code>, or <code>SpatialPoints</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dateTime</code></td>
<td>
<p>A <code>POSIXct</code> object representing the date and time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments that are passed to methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>solarDep</code></td>
<td>
<p>A numerical value representing the solar depression angle.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>direction</code></td>
<td>
<p>Character, determines whether to calculate the time of sunrise or sunset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>POSIXct.out</code></td>
<td>
<p>Logical, if <code>TRUE</code>, the result is returned as a <code>POSIXct</code> object, otherwise, it is returned as a fraction of a day.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crs</code></td>
<td>
<p>A <code>CRS</code> object representing the coordinate reference system.
Default is <code>sf::st_crs(4326)</code> which denotes WGS84 (World Geodetic System 1984).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Methods are available for different classes of geographical coordinates, including:
</p>

<ul>
<li> <p><code>sf</code>: an object of class <code>sf</code>.
</p>
</li>
<li> <p><code>matrix</code>: An unnamed matrix of coordinates, with each row containing a pair of geographical coordinates in <code>c(lon, lat)</code> order. See the example below.
</p>
</li>
<li> <p><code>SpatialPoints</code>: an object of class <code>SpatialPoints</code>.
Input can consist of one location and at least one <code>POSIXct</code> time, or one <code>POSIXct</code>
time and at least one location. <code>solarDep</code> is recycled as needed.
Do not use the daylight savings time zone string for supplying <code>dateTime</code>, as many OS
will not be able to properly set it to standard time when needed.
</p>
</li>
</ul>
<p>Compared to NOAA’s original Javascript code, the sunrise and sunset estimates from this translation
may differ by +/- 1 minute, based on tests using selected locations spanning the globe.
This translation does not include calculation of prior or next sunrises/sunsets for locations above the Arctic
Circle or below the Antarctic Circle.
</p>


<h4>Solar position calculation</h4>

<p>Details for the calculations are provided by NOAA <a href="https://gml.noaa.gov/grad/solcalc/calcdetails.html">here</a>,
which we repeat below as a reference.
</p>
<p>The calculations in the NOAA Sunrise/Sunset and Solar Position Calculators are based on equations
from Astronomical Algorithms, by Jean Meeus. The sunrise and sunset results are theoretically accurate
to within a minute for locations between +/- 72° latitude, and within 10 minutes outside of those latitudes.
However, due to variations in atmospheric composition, temperature, pressure and conditions, observed values may vary from calculations.
</p>
<p>For the purposes of these calculators the current Gregorian calendar is extrapolated backward through time.
When using a date before 15 October, 1582, you will need to correct for this. The year preceding year 1 in
the calendar is year zero (0). The year before that is -1. The approximations used in these programs are very
good for years between 1800 and 2100. Results should still be sufficiently accurate for the range
from -1000 to 3000. Outside of this range, results may be given, but the potential for error is higher.
</p>



<h4>Atmospheric refraction correction</h4>

<p>For sunrise and sunset calculations, we assume 0.833° of atmospheric refraction.
In the solar position calculator, atmospheric refraction is modeled as:</p>

<table>
<tr>
<td style="text-align: left;">
   Solar Elevation </td>
<td style="text-align: left;"> Approximate Atmospheric Refraction Correction (°) </td>
</tr>
<tr>
<td style="text-align: left;">
   85° to 90° </td>
<td style="text-align: left;"> 0 </td>
</tr>
<tr>
<td style="text-align: left;">
   5° to 85° </td>
<td style="text-align: left;"> <code class="reqn">\frac{1}{3600}\left(\frac{58.1}{\tan(h)} - \frac{0.07}{\tan^3(h)} + \frac{0.000086}{\tan^5(h)}\right)</code> </td>
</tr>
<tr>
<td style="text-align: left;">
   -0.575° to 5° </td>
<td style="text-align: left;"> <code class="reqn">\frac{1}{3600}\left(1735 - 518.2 h + 103.4 h^2 - 12.79 h^3 + 0.711 h^4\right)</code> </td>
</tr>
<tr>
<td style="text-align: left;">
   &lt; -0.575° </td>
<td style="text-align: left;"> <code class="reqn">\frac{1}{3600}\left(\frac{-20.774}{\tan(h)}\right)</code> </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>The effects of the atmosphere vary with atmospheric pressure, humidity and other variables.
Therefore the solar position calculations presented here are approximate. Errors in sunrise
and sunset times can be expected to increase the further away you are from the equator,
because the sun rises and sets at a very shallow angle. Small variations in the atmosphere
can have a larger effect.
</p>



<h3>Value</h3>

<p>data.frame with the time of crepuscular light as a fraction of a day; if POSIXct.out=TRUE returns an additional
POSIXct timestamp column (default = TRUE)
</p>


<h3>References</h3>


<ul>
<li>
<p> Meeus, J. (1991) Astronomical Algorithms. Willmann-Bell, Inc.
</p>
</li>
<li>
<p> NOAA's <a href="https://gml.noaa.gov/grad/solcalc/sunrise.html">sunrise/sunset calculator</a>.
These algorithms include corrections for atmospheric refraction effects.
</p>
</li>
<li>
<p> NOAA's <a href="https://gml.noaa.gov/grad/solcalc/calcdetails.html">solar calculations details</a>
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">#Civil dawn in Ithaca, NY on June 1, 2023

crepuscule(
       matrix(c(-76.4511, 42.4800), nrow = 1),
       as.POSIXct("2023-06-01", tz = "America/New_York"),
       solarDep = 6,
       direction = "dawn",
       POSIXct.out = TRUE
     )

</code></pre>


</div>