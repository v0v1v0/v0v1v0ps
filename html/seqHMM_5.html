<div class="container">

<table style="width: 100%;"><tr>
<td>build_mhmm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Build a Mixture Hidden Markov Model</h2>

<h3>Description</h3>

<p>Function <code>build_mhmm</code> constructs a mixture hidden Markov model object of class <code>mhmm</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">build_mhmm(
  observations,
  n_states,
  transition_probs,
  emission_probs,
  initial_probs,
  formula = NULL,
  data = NULL,
  coefficients = NULL,
  cluster_names = NULL,
  state_names = NULL,
  channel_names = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>observations</code></td>
<td>
<p>An <code>stslist</code> object (see <code>seqdef</code>) containing
the sequences, or a list of such objects (one for each channel).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_states</code></td>
<td>
<p>A numerical vector giving the number of hidden states in each submodel
(not used if starting values for model parameters are given with
<code>initial_probs</code>, <code>transition_probs</code>, or <code>emission_probs</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transition_probs</code></td>
<td>
<p>A list of matrices of transition
probabilities for the submodel of each cluster.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emission_probs</code></td>
<td>
<p>A list which contains matrices of emission probabilities or
a list of such objects (one for each channel) for the submodel of each cluster.
Note that the matrices must have dimensions <code class="reqn">m x s</code> where <code class="reqn">m</code> is the number of
hidden states and <code class="reqn">s</code> is the number of unique symbols (observed states) in the
data. Emission probabilities should follow the ordering of the alphabet of
observations (<code>alphabet(observations)</code>, returned as <code>symbol_names</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial_probs</code></td>
<td>
<p>A list which contains vectors of initial state
probabilities for the submodel of each cluster.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Optional formula of class <code>formula</code> for the
mixture probabilities. Left side omitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing the variables used in the formula.
Ignored if no formula is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>An optional <code class="reqn">k x l</code> matrix of regression coefficients for
time-constant covariates for mixture probabilities, where <code class="reqn">l</code> is the number
of clusters and <code class="reqn">k</code> is the number of covariates. A logit-link is used for
mixture probabilities. The first column is set to zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster_names</code></td>
<td>
<p>A vector of optional names for the clusters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state_names</code></td>
<td>
<p>A list of optional labels for the hidden states. If <code>NULL</code>,
the state names are taken as row names of transition matrices. If this is also <code>NULL</code>,
numbered states are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>channel_names</code></td>
<td>
<p>A vector of optional names for the channels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to <code>simulate_transition_probs</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The returned model contains some attributes such as <code>nobs</code> and <code>df</code>,
which define the number of observations in the  model and the number of estimable
model parameters, used in computing BIC.
When computing <code>nobs</code> for a multichannel model with <code class="reqn">C</code> channels,
each observed value in a single channel amounts to <code class="reqn">1/C</code> observation,
i.e. a fully observed time point for a single sequence amounts to one observation.
For the degrees of freedom <code>df</code>, zero probabilities of the initial model are
defined as structural zeroes.
</p>


<h3>Value</h3>

<p>Object of class <code>mhmm</code> with following elements:
</p>

<dl>
<dt><code>observations</code></dt>
<dd>
<p>State sequence object or a list of such containing the data.</p>
</dd>
<dt><code>transition_probs</code></dt>
<dd>
<p>A matrix of transition probabilities.</p>
</dd>
<dt><code>emission_probs</code></dt>
<dd>
<p>A matrix or a list of matrices of emission probabilities.</p>
</dd>
<dt><code>initial_probs</code></dt>
<dd>
<p>A vector of initial probabilities.</p>
</dd>
<dt><code>coefficients</code></dt>
<dd>
<p>A matrix of parameter coefficients for covariates (covariates in rows, clusters in columns).</p>
</dd>
<dt><code>X</code></dt>
<dd>
<p>Covariate values for each subject.</p>
</dd>
<dt><code>cluster_names</code></dt>
<dd>
<p>Names for clusters.</p>
</dd>
<dt><code>state_names</code></dt>
<dd>
<p>Names for hidden states.</p>
</dd>
<dt><code>symbol_names</code></dt>
<dd>
<p>Names for observed states.</p>
</dd>
<dt><code>channel_names</code></dt>
<dd>
<p>Names for channels of sequence data</p>
</dd>
<dt><code>length_of_sequences</code></dt>
<dd>
<p>(Maximum) length of sequences.</p>
</dd>
<dt><code>n_sequences</code></dt>
<dd>
<p>Number of sequences.</p>
</dd>
<dt><code>n_symbols</code></dt>
<dd>
<p>Number of observed states (in each channel).</p>
</dd>
<dt><code>n_states</code></dt>
<dd>
<p>Number of hidden states.</p>
</dd>
<dt><code>n_channels</code></dt>
<dd>
<p>Number of channels.</p>
</dd>
<dt><code>n_covariates</code></dt>
<dd>
<p>Number of covariates.</p>
</dd>
<dt><code>n_clusters</code></dt>
<dd>
<p>Number of clusters.</p>
</dd>
</dl>
<h3>References</h3>

<p>Helske S. and Helske J. (2019). Mixture Hidden Markov Models for Sequence Data: The seqHMM Package in R,
Journal of Statistical Software, 88(3), 1-32. doi:10.18637/jss.v088.i03
</p>


<h3>See Also</h3>

<p><code>fit_model</code> for fitting mixture Hidden Markov models;
<code>summary.mhmm</code> for a summary of a MHMM; <code>separate_mhmm</code> for
reorganizing a MHMM into a list of separate hidden Markov models; and
<code>plot.mhmm</code> for plotting <code>mhmm</code> objects.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data("biofam3c")

## Building sequence objects
marr_seq &lt;- seqdef(biofam3c$married,
  start = 15,
  alphabet = c("single", "married", "divorced")
)
child_seq &lt;- seqdef(biofam3c$children,
  start = 15,
  alphabet = c("childless", "children")
)
left_seq &lt;- seqdef(biofam3c$left,
  start = 15,
  alphabet = c("with parents", "left home")
)

## Choosing colors
attr(marr_seq, "cpal") &lt;- c("#AB82FF", "#E6AB02", "#E7298A")
attr(child_seq, "cpal") &lt;- c("#66C2A5", "#FC8D62")
attr(left_seq, "cpal") &lt;- c("#A6CEE3", "#E31A1C")

## MHMM with random starting values, no covariates
set.seed(468)
init_mhmm_bf1 &lt;- build_mhmm(
  observations = list(marr_seq, child_seq, left_seq),
  n_states = c(4, 4, 6),
  channel_names = c("Marriage", "Parenthood", "Residence")
)


## Starting values for emission probabilities

# Cluster 1
B1_marr &lt;- matrix(
  c(
    0.8, 0.1, 0.1, # High probability for single
    0.8, 0.1, 0.1,
    0.3, 0.6, 0.1, # High probability for married
    0.3, 0.3, 0.4
  ), # High probability for divorced
  nrow = 4, ncol = 3, byrow = TRUE
)

B1_child &lt;- matrix(
  c(
    0.9, 0.1, # High probability for childless
    0.9, 0.1,
    0.9, 0.1,
    0.9, 0.1
  ),
  nrow = 4, ncol = 2, byrow = TRUE
)

B1_left &lt;- matrix(
  c(
    0.9, 0.1, # High probability for living with parents
    0.1, 0.9, # High probability for having left home
    0.1, 0.9,
    0.1, 0.9
  ),
  nrow = 4, ncol = 2, byrow = TRUE
)

# Cluster 2

B2_marr &lt;- matrix(
  c(
    0.8, 0.1, 0.1, # High probability for single
    0.8, 0.1, 0.1,
    0.1, 0.8, 0.1, # High probability for married
    0.7, 0.2, 0.1
  ),
  nrow = 4, ncol = 3, byrow = TRUE
)

B2_child &lt;- matrix(
  c(
    0.9, 0.1, # High probability for childless
    0.9, 0.1,
    0.9, 0.1,
    0.1, 0.9
  ),
  nrow = 4, ncol = 2, byrow = TRUE
)

B2_left &lt;- matrix(
  c(
    0.9, 0.1, # High probability for living with parents
    0.1, 0.9,
    0.1, 0.9,
    0.1, 0.9
  ),
  nrow = 4, ncol = 2, byrow = TRUE
)

# Cluster 3
B3_marr &lt;- matrix(
  c(
    0.8, 0.1, 0.1, # High probability for single
    0.8, 0.1, 0.1,
    0.8, 0.1, 0.1,
    0.1, 0.8, 0.1, # High probability for married
    0.3, 0.4, 0.3,
    0.1, 0.1, 0.8
  ), # High probability for divorced
  nrow = 6, ncol = 3, byrow = TRUE
)

B3_child &lt;- matrix(
  c(
    0.9, 0.1, # High probability for childless
    0.9, 0.1,
    0.5, 0.5,
    0.5, 0.5,
    0.5, 0.5,
    0.1, 0.9
  ),
  nrow = 6, ncol = 2, byrow = TRUE
)


B3_left &lt;- matrix(
  c(
    0.9, 0.1, # High probability for living with parents
    0.1, 0.9,
    0.5, 0.5,
    0.5, 0.5,
    0.1, 0.9,
    0.1, 0.9
  ),
  nrow = 6, ncol = 2, byrow = TRUE
)

# Starting values for transition matrices
A1 &lt;- matrix(
  c(
    0.80, 0.16, 0.03, 0.01,
    0, 0.90, 0.07, 0.03,
    0, 0, 0.90, 0.10,
    0, 0, 0, 1
  ),
  nrow = 4, ncol = 4, byrow = TRUE
)

A2 &lt;- matrix(
  c(
    0.80, 0.10, 0.05, 0.03, 0.01, 0.01,
    0, 0.70, 0.10, 0.10, 0.05, 0.05,
    0, 0, 0.85, 0.01, 0.10, 0.04,
    0, 0, 0, 0.90, 0.05, 0.05,
    0, 0, 0, 0, 0.90, 0.10,
    0, 0, 0, 0, 0, 1
  ),
  nrow = 6, ncol = 6, byrow = TRUE
)

# Starting values for initial state probabilities
initial_probs1 &lt;- c(0.9, 0.07, 0.02, 0.01)
initial_probs2 &lt;- c(0.9, 0.04, 0.03, 0.01, 0.01, 0.01)

# Birth cohort
biofam3c$covariates$cohort &lt;- cut(biofam3c$covariates$birthyr, c(1908, 1935, 1945, 1957))
biofam3c$covariates$cohort &lt;- factor(
  biofam3c$covariates$cohort,
  labels = c("1909-1935", "1936-1945", "1946-1957")
)

## MHMM with own starting values and covariates
init_mhmm_bf2 &lt;- build_mhmm(
  observations = list(marr_seq, child_seq, left_seq),
  initial_probs = list(initial_probs1, initial_probs1, initial_probs2),
  transition_probs = list(A1, A1, A2),
  emission_probs = list(
    list(B1_marr, B1_child, B1_left),
    list(B2_marr, B2_child, B2_left),
    list(B3_marr, B3_child, B3_left)
  ),
  formula = ~ sex + cohort, data = biofam3c$covariates,
  cluster_names = c("Cluster 1", "Cluster 2", "Cluster 3"),
  channel_names = c("Marriage", "Parenthood", "Residence"),
  state_names = list(
    paste("State", 1:4), paste("State", 1:4),
    paste("State", 1:6)
  )
)

</code></pre>


</div>