<div class="container">

<table style="width: 100%;"><tr>
<td>PLIsuperquantile</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Perturbed-Law based sensitivity Indices (PLI) for superquantile</h2>

<h3>Description</h3>

<p>PLIsuperquantile computes the Perturbed-Law based Indices (PLI) for superquantile, 
which are robustness indices related to a superquantile of a 
model output, estimated by a Monte Carlo method. 
See Iooss et al. (2020).
</p>


<h3>Usage</h3>

<pre><code class="language-R">PLIsuperquantile(order,x,y,deltasvector,InputDistributions,type="MOY",
  samedelta=TRUE, percentage=TRUE,nboot=0,conf=0.95,bootsample=TRUE,bias=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>the order of the superquantile to estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the matrix of simulation points coordinates, 
one column per variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the vector of model outputs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deltasvector</code></td>
<td>
<p>a vector containing the values of delta for which
the indices will be computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>InputDistributions</code></td>
<td>
<p>a list of list. Each list contains, as a list,
the name of the distribution to be used and the parameters.
Implemented cases so far:
</p>

<ul>
<li>
<p> For a mean perturbation: Gaussian, Uniform, Triangle,
Left Trucated Gaussian, Left Truncated Gumbel. Using Gumbel
requires the package <code>evd</code>.
</p>
</li>
<li>
<p> For a variance perturbation: Gaussian, Uniform.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>a character string in which the user will specify the type of 
perturbation wanted. 
The sense of "deltasvector" varies according to the type of perturbation:
</p>

<ul>
<li>
<p> type can take the value "MOY",in which case deltasvector is a 
vector of perturbated means.
</p>
</li>
<li>
<p> type can take the value "VAR",in which case deltasvector is a 
vector of perturbated variances, therefore needs to be positive integers.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samedelta</code></td>
<td>
<p>a boolean used with the value "MOY" for type. 
</p>

<ul>
<li>
<p> If it is set at TRUE, the mean perturbation will be the same for all  
the variables. 
</p>
</li>
<li>
<p> If not, the mean perturbation will be new_mean = mean+sigma*delta 
where mean, sigma are parameters defined in InputDistributions and 
delta is a value of deltasvector.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>percentage</code></td>
<td>
<p>a boolean that defines the formula used for the PLI.
</p>

<ul>
<li>
<p> If it is set at FALSE, the classical formula used in the bibliographical 
references is used.
</p>
</li>
<li>
<p> If not (set as TRUE), the PLI is given in percentage of variation 
of the superquantile (even if it is negative).
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboot</code></td>
<td>
<p>the number of bootstrap replicates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf</code></td>
<td>
<p>the confidence level for bootstrap confidence intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bootsample</code></td>
<td>
<p>If TRUE, the uncertainty about the original quantile estimation
is taken into account in the PLI confidence intervals (see Iooss et al., 2020). 
If FALSE, standard confidence intervals are computed for the PLI.
It mainly changes the CI at small delta values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bias</code></td>
<td>
<p>defines the version of PLI-superquantile:
</p>

<ul>
<li>
<p> If it is set at "TRUE", it gives the mean of outputs above the perturbed 
quantile (alternative formula)
</p>
</li>
<li>
<p> If it is set at "FALSE", it gives the mean of perturbed outputs above the 
perturbed quantile (original formula)
</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>PLIsuperquantile</code> returns a list of matrices (each column corresponds to an input, 
each line corresponds to a twist of amplitude delta) 
containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>PLI</code></td>
<td>
<p>the PLI.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PLICIinf</code></td>
<td>
<p>the bootstrap lower confidence interval values of the PLI.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PLICIsup</code></td>
<td>
<p>the bootstrap upper confidence interval values of the PLI.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>superquantile</code></td>
<td>
<p>the perturbed superquantile.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>superquantileCIinf</code></td>
<td>
<p>the bootstrap lower confidence interval values of the perturbed superquantile.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>superquantileCIsup</code></td>
<td>
<p>the bootstrap upper confidence interval values of the perturbed superquantile.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Bertrand Iooss
</p>


<h3>References</h3>

<p>B. Iooss, V. Verges and V. Larget, 2022, <em>BEPU robustness analysis via perturbed law-based 
sensitivity indices</em>, Proceedings of the Institution of Mechanical Engineers, 
Part O: Journal of Risk and Reliability, 236:855-865.
</p>
<p>P. Lemaitre, E. Sergienko, A. Arnaud, N. Bousquet, F. Gamboa and B. Iooss, 2015, 
<em>Density modification based reliability sensitivity analysis</em>, Journal of Statistical 
Computation and Simulation, 85:1200-1223. 
</p>


<h3>See Also</h3>

<p><code>PLI, PLIquantile, PLIsuperquantile_multivar</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">

# Model: 3D function 

  distribution = list()
	for (i in 1:3) distribution[[i]]=list("norm",c(0,1))
  
# Monte Carlo sampling 

  N = 10000
	X = matrix(0,ncol=3,nrow=N)
	for(i in 1:3) X[,i] = rnorm(N,0,1)
     
	Y = 2 * X[,1] + X[,2] + X[,3]/2
	alpha &lt;- 0.95
	
	q95 = quantile(Y,alpha)
  sq95a &lt;- mean(Y*(Y&gt;q95)/(1-alpha)) ; sq95b &lt;- mean(Y[Y&gt;q95])
	
	nboot=20 # change to nboot=200 for consistency
	
# sensitivity indices with perturbation of the mean 
  
	v_delta = seq(-1,1,1/10) 
	toto = PLIsuperquantile(alpha,X,Y,deltasvector=v_delta,
	  InputDistributions=distribution,type="MOY",samedelta=TRUE,
	  percentage=FALSE,nboot=nboot,bias=TRUE)

# Plotting the PLI
  par(mar=c(4,5,1,1))
	plot(v_delta,toto$PLI[,2],ylim=c(-0.5,0.5),xlab=expression(delta),
		ylab=expression(hat(PLI[i*delta])),pch=19,cex=1.5)
	points(v_delta,toto$PLI[,1],col="darkgreen",pch=15,cex=1.5)
	points(v_delta,toto$PLI[,3],col="red",pch=17,cex=1.5)
	lines(v_delta,toto$PLICIinf[,2],col="black")
	lines(v_delta,toto$PLICIsup[,2],col="black")
	lines(v_delta,toto$PLICIinf[,1],col="darkgreen")
	lines(v_delta,toto$PLICIsup[,1],col="darkgreen")
	lines(v_delta,toto$PLICIinf[,3],col="red")
	lines(v_delta,toto$PLICIsup[,3],col="red")
	abline(h=0,lty=2)
	legend(-1,0.5,legend=c("X1","X2","X3"),
		col=c("darkgreen","black","red"),pch=c(15,19,17),cex=1.5)
  
# Plotting the perturbed superquantiles
  par(mar=c(4,5,1,1))
	plot(v_delta,toto$superquantile[,2],ylim=c(3,7),xlab=expression(delta),
		ylab=expression(hat(q[i*delta])),pch=19,cex=1.5)
	points(v_delta,toto$superquantile[,1],col="darkgreen",pch=15,cex=1.5)
	points(v_delta,toto$superquantile[,3],col="red",pch=17,cex=1.5)
	lines(v_delta,toto$superquantileCIinf[,2],col="black")
	lines(v_delta,toto$superquantileCIsup[,2],col="black")
	lines(v_delta,toto$superquantileCIinf[,1],col="darkgreen")
	lines(v_delta,toto$superquantileCIsup[,1],col="darkgreen")
	lines(v_delta,toto$superquantileCIinf[,3],col="red")
	lines(v_delta,toto$superquantileCIsup[,3],col="red")
	abline(h=q95,lty=2)
	legend(-1,7,legend=c("X1","X2","X3"),
		col=c("darkgreen","black","red"),pch=c(15,19,17),cex=1.5)
		
# Plotting the unbiased PLI in percentage with refined confidence intervals
	toto = PLIsuperquantile(alpha,X,Y,deltasvector=v_delta,
	  InputDistributions=distribution,type="MOY",samedelta=TRUE,percentage=TRUE,
	  nboot=nboot,bootsample=FALSE,bias=FALSE)
	  
  par(mar=c(4,5,1,1))
	plot(v_delta,toto$PLI[,2],ylim=c(-0.4,0.5),xlab=expression(delta),
		ylab=expression(hat(PLI[i*delta])),pch=19,cex=1.5)
	points(v_delta,toto$PLI[,1],col="darkgreen",pch=15,cex=1.5)
	points(v_delta,toto$PLI[,3],col="red",pch=17,cex=1.5)
	lines(v_delta,toto$PLICIinf[,2],col="black")
	lines(v_delta,toto$PLICIsup[,2],col="black")
	lines(v_delta,toto$PLICIinf[,1],col="darkgreen")
	lines(v_delta,toto$PLICIsup[,1],col="darkgreen") 
	lines(v_delta,toto$PLICIinf[,3],col="red")
	lines(v_delta,toto$PLICIsup[,3],col="red")
	abline(h=0,lty=2)
	legend(-1,0.5,legend=c("X1","X2","X3"),
		col=c("darkgreen","black","red"),pch=c(15,19,17),cex=1.5)

##################################################
# another visualization by using the plotCI() fct 
# (from plotrix package) for the CI plotting (from Vanessa Verges)

	library(plotrix)
	parameters = list(colors=c("darkgreen","black","red"),symbols=c(15,19,17),
	  overlay=c(FALSE,TRUE,TRUE))
  par(mar=c(4,5,1,1),xpd=TRUE)
  for (i in 1:3){
  plotCI(v_delta,toto$PLI[,i],ui=toto$PLICIsup[,i],li=toto$PLICIinf[,i],
         cex=1.5,col=parameters$colors[i],pch=parameters$symbols[i],
         add=parameters$overlay[i], xlab="", ylab="")
  }
  title(xlab=expression(delta),ylab=expression(hat(PLI[i*delta])),
      main=bquote("PLI-superquantile (N ="~.(N) ~ ","~alpha~"="~.(alpha)~
      ") of Y="~2*X[1] + X[2] + X[3]/2))
  abline(h=0,lty=2)
  legend("topleft",legend=c("X1","X2","X3"),
          col=parameters$colors,pch=parameters$symbols,cex=1.5)


</code></pre>


</div>