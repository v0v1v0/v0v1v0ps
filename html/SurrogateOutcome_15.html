<div class="container">

<table style="width: 100%;"><tr>
<td>R.q.event</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Calculates the proportion of the treatment effect (the difference in restriced mean survival time at time t) explained by surrogate outcome information observed up to the landmark time
</h2>

<h3>Description</h3>

<p>Calculates the proportion of the treatment effect (the difference in restriced mean survival time at time t) explained by surrogate outcome information observed up to the landmark time; also provides standard error estimate and confidence interval.
</p>


<h3>Usage</h3>

<pre><code class="language-R">R.q.event(xone, xzero, deltaone, deltazero, sone, szero, t, landmark, number = 40, 
transform = FALSE, extrapolate = TRUE, std = FALSE, conf.int = FALSE, 
weight.perturb = NULL, type = "np")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>xone</code></td>
<td>

<p>numeric vector, observed event times for the primary outcome in the treatment group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xzero</code></td>
<td>

<p>numeric vector, observed event times for the primary outcome in the control group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deltaone</code></td>
<td>

<p>numeric vector, event/censoring indicators for the primary outcome in the treatment group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deltazero</code></td>
<td>

<p>numeric vector, event/censoring indicators for the primary outcome in the control group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sone</code></td>
<td>

<p>numeric vector, observed event times for the surrogate outcome in the treatment group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>szero</code></td>
<td>

<p>numeric vector, observed event times for the surrogate outcome in the control group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>

<p>time of interest for treatment effect.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>landmark</code></td>
<td>

<p>landmark time of interest, <code class="reqn">t_0</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number</code></td>
<td>


<p>number of points for RMST calculation, default is 40.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform</code></td>
<td>


<p>TRUE or FALSE; indicates whether a transformation should be used, default is FALSE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extrapolate</code></td>
<td>


<p>TRUE or FALSE; indicates whether local constant extrapolation should be used, default is FALSE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std</code></td>
<td>

<p>TRUE or FALSE; indicates whether standard error estimates should be provided, default is FALSE. Estimates are calculated using perturbation-resampling. Two versions are provided: one that takes the standard deviation of the perturbed estimates (denoted as "sd") and one that takes the median absolute deviation (denoted as "mad"). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>

<p>TRUE or FALSE; indicates whether 95% confidence intervals should be provided. Confidence intervals are calculated using the percentiles of perturbed estimates, default is FALSE. If this is TRUE, standard error estimates are automatically provided.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight.perturb</code></td>
<td>

<p>weights used for perturbation resampling.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>

<p>Type of estimate that should be provided; options are "np" for the nonparametric estimate or "semi" for the semiparametric estimate, default is "np".
</p>
</td>
</tr>
</table>
<h3>Details</h3>


<p>Let <code class="reqn">G \in \{1,0\}</code> be the randomized treatment indicator, <code class="reqn">T</code> denote the time of the primary outcome of interest, and <code class="reqn">S</code> denote the time of the surrogate outcome. We use potential outcomes notation such that <code class="reqn">T^{(G)}</code> and <code class="reqn">S^{(G)}</code> denote the respective times of the primary and surrogate outcomes under treatment G, for <code class="reqn">G \in \{1, 0\}</code>.  In the absence of censoring, we only observe <code class="reqn">(T, S)=(T^{(1)}, S^{(1)})</code> or <code class="reqn">(T^{(0)}, S^{(0)})</code> for each individual depending on whether <code class="reqn">G=1</code> or <code class="reqn">0</code>. Due to censoring, data consist of <code class="reqn">n = n_1 + n_0</code> independent observations <code class="reqn">\{X_{gi}, \delta_{gi}, I(S_{gi}&lt; t_0)I(X_{gi} &gt; t_0),  S_{gi}\wedge t_0 I(X_{gi} &gt; t_0), i=1,...,n_g, g = 1,0\}</code>, where <code class="reqn">X_{gi} = T_{gi}\wedge C_{ gi}</code>, <code class="reqn">\delta_{gi} = I(T_{gi} &lt; C_{gi})</code>, <code class="reqn">C_{gi}</code> denotes the censoring time, <code class="reqn">T_{gi}</code> denotes the time of the primary outcome, <code class="reqn">S_{gi}</code> denotes the time of the surrogate outcome, <code class="reqn">\{(T_{gi}, C_{gi}, S_{gi}), i = 1, ..., n_g\}</code> are identically distributed within treatment group, and <code class="reqn">t_0</code> is the landmark time of interest.
</p>
<p>We define the treatment effect as the difference in restricted mean survival time up to a fixed time <code class="reqn">t</code> under treatment 1 versus under treatment 0,
</p>
<p style="text-align: center;"><code class="reqn"> \Delta(t)=E\{T^{(1)}\wedge t\} - E\{T^{(0)}\wedge t \}</code>
</p>

<p>where <code class="reqn">\wedge</code> indicates the minimum. To define the proportion of treatment effect explained by the surrogate outcome information, let </p>
<p style="text-align: center;"><code class="reqn">Q_{t_0} ^{(g)} =  (Q_{t_01}, Q_{t_02})'=\{S ^{(g)} \wedge t_0I(T ^{(g)} &gt; t_0), T^{(g)} I(T^{(g)} \le t_0)\}',  g=1, 0</code>
</p>

<p>and define the residual treatment effect after accounting for the treatment effect on the surrogate outcome information as:
</p>
<p style="text-align: center;"><code class="reqn"> \Delta_Q(t,t_0) = P ^{(0)}_{t_0,2}\int_0^{t_0} \phi_1(t|t_0,s)dF_0(s) + P^{(0)}_{t_0,3}\psi_1(t|t_0) - P(T ^{(0)}&gt; t_0) \nu_0(t|t_0)</code>
</p>
<p>  where  <code class="reqn">P^{(0)}_{t_0,2} = P(T^{(0)} &gt; {t_0}, S ^{(0)} &lt; t_0)</code> and <code class="reqn"> P^{(0)}_{t_0,3} = P(T^{(0)} &gt; {t_0}, S ^{(0)} &gt; t_0)</code>,  <code class="reqn"> \psi_1(t \mid t_0) = E(T^{(1)}\wedge t \mid  T^{(1)}&gt; t_0, S^{(1)} &gt; t_0)</code>, 
<code class="reqn">\phi_1(t\mid t_0,s) = E(T^{(1)}\wedge t \mid  T ^{(1)}&gt; t_0, S ^{(1)} = s), \quad \nu_0(t|t_0) = E(T ^{(0)} \wedge t | T ^{(0)}&gt; t_0)</code>, and  <code class="reqn">F_0(\cdot\mid t_0)</code> is the cumulative distribution function of <code class="reqn">S^{(0)}</code> conditional on <code class="reqn">T ^{(0)}&gt; t_0</code> and <code class="reqn">S ^{(0)} &lt; t_0</code>. Then, the proportion of treatment effect on the primary outcome that is explained by surrogate information up to <code class="reqn">t_0</code>, <code class="reqn">Q_{t_0}</code>, can be expressed as a contrast between  <code class="reqn">\Delta(t)</code> and <code class="reqn">\Delta_Q(t,t_0)</code>:
</p>
<p style="text-align: center;"><code class="reqn">R_Q(t,t_0) = \{\Delta(t) - \Delta_Q(t,t_0) \} / \Delta(t) = 1-  \Delta_Q(t,t_0) / \Delta(t).</code>
</p>
 
<p>The quantity <code class="reqn"> \Delta(t)</code> is estimated using inverse probability of censoring weights:
</p>
<p style="text-align: center;"><code class="reqn">\hat{\Delta}(t)  = n_1^{-1} \sum_{i=1}^{n_1} \hat{M}_{1i}(t)- n_0^{-1} \sum_{i=1}^{n_0} \hat{M}_{0i}(t)</code>
</p>

<p>where  <code class="reqn">\hat{M}_{gi}(t) = I(X_{gi} &gt; t)t/\hat{W}^C_g(t) +  I(X_{gi} &lt; t)X_{gi}\delta_{gi}/\hat{W}^C_g(X_{gi})</code> and <code class="reqn">\hat{W}^C_g(t)</code> is the Kaplan-Meier estimator of <code class="reqn">P(C_{gi} \ge t).</code> The residual treatment effect <code class="reqn"> \Delta_Q(t,t_0)</code> can be estimated nonparametrically or semi-parametrically. For nonparametric estimation, <code class="reqn"> \psi_{1}(t|t_0)</code> is estimated by <code class="reqn">\hat{\psi}_{1}(t|t_0) = \sum_{i=1}^{n_1}\frac{  { \hat{W}^C_1(t_0)} I(S_{1i}&gt;t_0, X_{1i} &gt; t_0) }{ \sum_{i=1}^{n_1}I(S_{1i}&gt;t_0, X_{1i} &gt; t_0)} \hat{M}_{1i}(t)</code>, and <code class="reqn">\phi_1(t \mid t_0,s) = E(T^{(1)}\wedge t\mid  X^{(1)}&gt; t_0, S ^{(1)} = s)</code> is estimated using a
nonparametric kernel Nelson-Aalen estimator for <code class="reqn">\Lambda_1(t\mid t_0,s ),</code> the cumulative hazard function of <code class="reqn">T^{(1)}</code> conditional on <code class="reqn">S^{(1)}=s</code> and <code class="reqn">T^{(1)}&gt;t_0,</code> as
</p>
<p style="text-align: center;"><code class="reqn">\hat \phi_1(t \mid t_0,s)  = t_0+\int_ {t_0}^t \exp\{-\hat{\Lambda}_1(t\mid t_0,s) \}dt,</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">\hat{\Lambda}_1(t\mid t_0,s) = \int_{t_0}^t \frac{\sum_{i=1}^{n_1} I(X_{1i}&gt;t_0, {S_{1i} &lt; t_0})  K_h\{\gamma(S_{1i}) - \gamma(s)\}dN_{1i}(z)}{\sum_{i=1}^{n_1}  I(X_{1i}&gt;t_0,  {S_{1i} &lt; t_0})  K_h\{\gamma(S_{1i}) - \gamma(s)\} Y_{1i}(z)},</code>
</p>

<p>is a consistent estimate of <code class="reqn">\Lambda_1(t\mid t_0,s ),</code> <code class="reqn">Y_{1i}(t) = I(X_{1i} \geq t)</code>,  <code class="reqn">N_{1i}(t) = I(X_{1i} \leq t) \delta_i,  K(\cdot)</code> is a smooth symmetric density function, <code class="reqn">K_h(x) = K(x/h)/h</code>, <code class="reqn">\gamma(\cdot)</code> is a given monotone transformation function, and <code class="reqn">h=O(n_1^{-\eta})</code> is a specified bandwidth with <code class="reqn">\eta \in (1/2,1/4)</code>.  Finally, we let </p>
<p style="text-align: center;"><code class="reqn">
\hat{\nu}_{0}(t|t_0) = \sum_{i=1}^{n_0}\frac{  {\hat{W}^C_0(t_0)}I(X_{0i} &gt; t_0) }{ \sum_{i=1}^{n_0}I(X_{0i} &gt; t_0)} \hat{M}_{0i}(t).</code>
</p>

<p>We then estimate  <code class="reqn">\Delta_{Q}(t,t_0)</code> as <code class="reqn">\hat{\Delta}_{Q}(t,t_0)</code> defined as
</p>
<p style="text-align: center;"><code class="reqn">
n_0^{-1} \sum_{i=1}^{n_0} \left \{ \frac{I_{t_0,2}(X_{0i}, S_{0i})\hat{\phi}_1(t\mid t_0, S_{0i}) + I_{t_0,3}(X_{0i}, S_{0i})\hat{\psi}_1(t\mid t_0) - I_{t_0}(X_{0i})\hat{\nu}(t|t_0) }{\hat{W}^C_0(t_0)} \right \}</code>
</p>

<p>where <code class="reqn"> I_{t_0,2}(x, s) = I(x &gt; {t_0}, s &lt; t_0)</code> and <code class="reqn"> I_{t_0,3}(x, s) = I(x &gt; {t_0}, s &gt; t_0)</code> and <code class="reqn"> I_{t_0}(x)=I(x &gt; {t_0})</code> and thus, <code class="reqn">\hat{R}_Q(t,t_0) =1- \hat{\Delta}_Q(t,t_0)/\hat{\Delta}(t).</code>
</p>
<p>For the semi-parametric estimate,  <code class="reqn">\hat \phi_1(t| t_0,s)</code> is replaced with an estimate obtained using a landmark Cox proportional hazards model </p>
<p style="text-align: center;"><code class="reqn">P(T^{(1)}&gt; t\mid  T^{(1)}&gt; t_0, S^{(1)} &lt; t_0, S ^{(1)}) = \exp \{ -\Lambda_0(t|t_0)\exp(\beta_0S ^{(1)})\}</code>
</p>

<p>where <code class="reqn">\Lambda_0(t|t_0)</code> is the unspecified baseline cumulative hazard among <code class="reqn">\Omega_{t_0} = \{T^{(1)}&gt; t_0, S^{(1)} &lt; t_0\}</code> and <code class="reqn">\beta_0</code> is unknown. That is, let <code class="reqn">\tilde \phi_1(t| t_0,s) =  t_0+\int_{t_0}^{t}\exp \{ -\hat{\Lambda}_0(t|t_0)\exp(\hat{\beta}s)\} dt,</code>  where <code class="reqn">\hat{\beta}</code> is estimated by fitting a Cox model to the subpopulation <code class="reqn">\Omega_{t_0}</code> with a single predictor <code class="reqn">S</code> and <code class="reqn">\hat{\Lambda}_0(\cdot|t_0)</code> is the corresponding Breslow estimator. Then the semiparametric estimator for
<code class="reqn">\Delta_{Q}(t,t_0)</code> is <code class="reqn">\tilde{\Delta}_{Q}(t,t_0)</code> defined as
</p>
<p style="text-align: center;"><code class="reqn"> n_0^{-1} \sum_{i=1}^{n_0} \left \{ \frac{I_{t_0,2}(X_{0i}, S_{0i})\tilde{\phi}_1(t\mid t_0, S_{0i}) + I_{t_0,3}(X_{0i}, S_{0i})\hat{\psi}_1(t\mid t_0) - I_{t_0}(X_{0i})\hat{\nu}(t|t_0) }{\hat{W}^C_0(t_0)} \right \} </code>
</p>

<p>and <code class="reqn">\tilde{R}_Q(t,t_0) =1- \tilde{\Delta}_Q(t,t_0)/\hat{\Delta}(t).</code>
</p>


<h3>Value</h3>

<p>A list is returned:                
</p>
<table>
<tr style="vertical-align: top;">
<td><code>delta </code></td>
<td>
<p>the estimate, <code class="reqn">\hat{\Delta}(t)</code>, described in delta.estimate documentation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta.q </code></td>
<td>
<p>the estimate, <code class="reqn">\hat{\Delta}_Q(t,t_0)</code>, described above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R.q </code></td>
<td>
<p>the estimate, <code class="reqn">\hat{R}_Q(t,t_0)</code>, described above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta.sd </code></td>
<td>
<p>the standard error estimate of <code class="reqn">\hat{\Delta}(t)</code>; if std = TRUE or conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta.mad </code></td>
<td>
<p>the standard error estimate of <code class="reqn">\hat{\Delta}(t)</code> using the median absolute deviation; if std = TRUE or conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta.q.sd</code></td>
<td>
<p>the standard error estimate of <code class="reqn">\hat{\Delta}_Q(t,t_0)</code>; if std = TRUE or conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta.q.mad</code></td>
<td>
<p>the standard error estimate of <code class="reqn">\hat{\Delta}_Q(t,t_0)</code> using the median absolute deviation; if std = TRUE or conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R.q.sd </code></td>
<td>
<p>the standard error estimate of <code class="reqn">\hat{R}_Q(t,t_0)</code>; if std = TRUE or conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R.q.mad </code></td>
<td>
<p>the standard error estimate of <code class="reqn">\hat{R}_Q(t,t_0)</code> using the median absolute deviation; if std = TRUE or conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int.delta</code></td>
<td>
<p>a vector of size 2; the 95% confidence interval for <code class="reqn">\hat{\Delta}(t)</code> based on sample quantiles of the perturbed values; if conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int.delta.q</code></td>
<td>
<p>a vector of size 2; the 95% confidence interval for <code class="reqn">\hat{\Delta}_Q(t,t_0)</code> based on sample quantiles of the perturbed values; if conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int.R.q</code></td>
<td>
<p>a vector of size 2; the 95% confidence interval for <code class="reqn">\hat{R}_Q(t,t_0)</code> based on sample quantiles of the perturbed values; if conf.int = TRUE.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Layla Parast
</p>


<h3>References</h3>

<p>Parast L, Tian L, and Cai T (2020). Assessing the Value of a Censored Surrogate Outcome. Lifetime Data Analysis, 26(2):245-265.
</p>
<p>Parast, L and Cai, T (2013). Landmark risk prediction of residual life for breast cancer survival. Statistics in Medicine, 32(20), 3459-3471.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(ExampleData)
names(ExampleData)


R.q.event(xone = ExampleData$x1, xzero = ExampleData$x0, deltaone = ExampleData$delta1, 
deltazero = ExampleData$delta0, sone = ExampleData$s1, szero = ExampleData$s0, t = 5, 
landmark=2, type = "np")
R.q.event(xone = ExampleData$x1, xzero = ExampleData$x0, deltaone = ExampleData$delta1, 
deltazero = ExampleData$delta0, sone = ExampleData$s1, szero = ExampleData$s0, t = 5, 
landmark=2, type = "semi")
R.q.event(xone = ExampleData$x1, xzero = ExampleData$x0, deltaone = ExampleData$delta1, 
deltazero = ExampleData$delta0, sone = ExampleData$s1, szero = ExampleData$s0, t = 5, 
landmark=2, type = "np", std = TRUE, conf.int = TRUE)

</code></pre>


</div>