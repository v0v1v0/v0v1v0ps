<div class="container">

<table style="width: 100%;"><tr>
<td>smtl</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>smtl: make model-fitting function</h2>

<h3>Description</h3>

<p>smtl: make model-fitting function
</p>


<h3>Usage</h3>

<pre><code class="language-R">smtl(
  y,
  X,
  study = NA,
  s,
  commonSupp = FALSE,
  warmStart = TRUE,
  lambda_1 = 0,
  lambda_2 = 0,
  lambda_z = 0,
  scale = TRUE,
  maxIter = 10000,
  LocSrch_maxIter = 50,
  messageInd = TRUE,
  model = TRUE,
  independent.regs = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A numeric outcome vector (for multi-task/domain generalization problems) or a numeric outcome matrix (for multi-label problems)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>A matrix of covariates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>study</code></td>
<td>
<p>A vector of integers specifying task (or study/domain) ID. This should be set to NA for Multi-Label problems, but is required for Multi-Task and Domain Generalization problems.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p>An integer specifying the sparsity level</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>commonSupp</code></td>
<td>
<p>A boolean specifying whether to constrain solutions to have a common support</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warmStart</code></td>
<td>
<p>A boolean specifying whether a warm start model is fit internally before the final model. Warm starts improve solution quality but will be slower.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda_1</code></td>
<td>
<p>A numeric vector of ridge penalty hyperparameter values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda_2</code></td>
<td>
<p>A numeric vector of betaBar (to borrow strength across coefficient values) penalty hperparameter values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda_z</code></td>
<td>
<p>A numeric vector zBar (to borrow strength across coefficient supports) penalty hperparameter values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>A boolean specifying whether to center and scale covariates before model fitting (either way coefficient estimates are returned on original scale before centering/scaling)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxIter</code></td>
<td>
<p>An integer specifying the maximum number of coordinate descent iterations before</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LocSrch_maxIter</code></td>
<td>
<p>An integer specifying the number of maximum local search iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>messageInd</code></td>
<td>
<p>A boolean specifying whether to include messages (verbose)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>A boolean indicating whether to return design matrix and outcome vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>independent.regs</code></td>
<td>
<p>A boolean specifying whether to fit independent regressions (instead of multi-task). This ensures there is NO information sharing via active sets or penalties</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list (object of S3 class). </p>
<table>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p> Matrix with coefficient estimates where column j are estimates from task j.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reg_type</code></td>
<td>
<p> String specifying whether model is <code>"multiStudy"</code> denoting that there is a separate design matrix for each task, <code>"multiLabel"</code> where the design matrix is the same 
across tasks and <code>"L0"</code> indicating a single-task regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p> Integer that indicates number of tasks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p> An integer that indicates sparsity level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>commonSupp</code></td>
<td>
<p> Boolean 
indicating of supports are common across tasks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warmStart</code></td>
<td>
<p> A Boolean indicating whether to fit a MTL model as a warm start.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid</code></td>
<td>
<p> A dataframe including grid of hyperparameters that model
is fit on.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxIter</code></td>
<td>
<p> An integer specifying the maximum number of iterations of block CD.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LocSrch_maxIter</code></td>
<td>
<p> An integer specify the maximum number of iterations of local search.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>independent.regs</code></td>
<td>
<p> A boolean indicating whether to make each task independent of each other (no shared active sets).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AS_multiplier</code></td>
<td>
<p> An integer specifying the active set multiplier.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X_train</code></td>
<td>
<p> A Matrix: the design matrix (row concatenated across tasks).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y_train</code></td>
<td>
<p> The outcome vector or matrix.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 

if (identical(Sys.getenv("AUTO_JULIA_INSTALL"), "true")) { ## The examples are quite time consuming
## Do initiation for and automatic installation if necessary

# load package
library(sMTL)
smtl_setup()

#####################################################################################
##### simulate data
#####################################################################################
set.seed(1) # fix the seed to get a reproducible result
K &lt;- 4 # number of datasets 
p &lt;- 100 # covariate dimension
s &lt;- 5 # support size
q &lt;- 7 # size of subset of covariates that can be non-zero for any task
n_k &lt;- 50 # task sample size
N &lt;- n_k * p # full dataset samplesize
X &lt;- matrix( rnorm(N * p), nrow = N, ncol=p) # full design matrix
B &lt;- matrix(1 + rnorm(K * (p+1) ), nrow = p + 1, ncol = K) # betas before making sparse
Z &lt;- matrix(0, nrow = p, ncol = K) # matrix of supports
y &lt;- vector(length = N) # outcome vector

# randomly sample support to make betas sparse
for(j in 1:K)     Z[1:q, j] &lt;- sample( c( rep(1,s), rep(0, q - s) ), q, replace = FALSE )
B[-1,] &lt;- B[-1,] * Z # make betas sparse and ensure all models have an intercept

task &lt;- rep(1:K, each = n_k) # vector of task labels (indices)

# iterate through and make each task specific dataset
for(j in 1:K){
    indx &lt;- which(task == j) # indices of task
    e &lt;- rnorm(n_k)
    y[indx] &lt;- B[1, j] + X[indx,] %*% B[-1,j] + e
    }
    colnames(B) &lt;- paste0("beta_", 1:K)
    rownames(B) &lt;- paste0("X_", 1:(p+1))
    
    print("Betas")
    print(round(B[1:8,],2))
    
#####################################################################################
##### fit Multi-Task Learning Model for Heterogeneous Support
#####################################################################################
  
    mod &lt;- sMTL::smtl(y = y, 
                      X = X, 
                      study = task, 
                      s = 5, 
                      commonSupp = FALSE,
                      lambda_1 = 0.001,
                      lambda_2 = 0,
                      lambda_z = 0.25)
    
    print(round(mod$beta[1:8,],2))
    
    # make predictions
    preds &lt;- sMTL::predict(model = mod, X = X[1:5,])
    
#####################################################################################
##### fit Multi-Task Learning Model for Common Support
#####################################################################################
    library(sMTL)
    sMTL::smtl_setup(path = "/Applications/Julia-1.5.app/Contents/Resources/julia/bin")
    mod &lt;- sMTL::smtl(y = y, 
                      X = X, 
                      study = task, 
                      s = 5, 
                      commonSupp = TRUE,
                      lambda_1 = 0.001,
                      lambda_2 = 0.5)
    
    print(round(mod$beta[1:8,],2))
    }
    
## End(Not run)
    
</code></pre>


</div>