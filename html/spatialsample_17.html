<div class="container">

<table style="width: 100%;"><tr>
<td>spatial_nndm_cv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nearest neighbor distance matching (NNDM) cross-validation</h2>

<h3>Description</h3>

<p>NNDM is a variant of leave-one-out cross-validation which assigns each
observation to a single assessment fold, and then attempts to remove data
from each analysis fold until the nearest neighbor distance distribution
between assessment and analysis folds matches the nearest neighbor distance
distribution between training data and the locations a model will be used to
predict.
Proposed by Milà et al. (2022), this method aims to provide accurate
estimates of how well models will perform in the locations they will actually
be predicting. This method was originally implemented in the CAST package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">spatial_nndm_cv(
  data,
  prediction_sites,
  ...,
  autocorrelation_range = NULL,
  prediction_sample_size = 1000,
  min_analysis_proportion = 0.5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An object of class <code>sf</code> or <code>sfc</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prediction_sites</code></td>
<td>
<p>An <code>sf</code> or <code>sfc</code> object describing the areas to be
predicted. If <code>prediction_sites</code> are all points, then those points are
treated as the intended prediction points when calculating target nearest
neighbor distances. If <code>prediction_sites</code> is a single (multi-)polygon, then
points are sampled from within the boundaries of that polygon. Otherwise,
if <code>prediction_sites</code> is of length &gt; 1 and not made up of points,
then points are sampled from within the bounding box of <code>prediction_sites</code>
and used as the intended prediction points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to <code>sf::st_sample()</code>. Note that the
number of points to sample is controlled by <code>prediction_sample_size</code>; trying
to pass <code>size</code> via <code>...</code> will cause an error.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autocorrelation_range</code></td>
<td>
<p>A numeric of length 1 representing the landscape
autocorrelation range ("phi" in the terminology of Milà et al. (2022)). If
<code>NULL</code>, the default, the autocorrelation range is assumed to be the distance
between the opposite corners of the bounding box of <code>prediction_sites</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prediction_sample_size</code></td>
<td>
<p>A numeric of length 1: the number of points to
sample when <code>prediction_sites</code> is not only composed of points. Note that this
argument is passed to <code>size</code> in <code>sf::st_sample()</code>, meaning that no elements
of <code>...</code> can be named <code>size</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_analysis_proportion</code></td>
<td>
<p>The minimum proportion of <code>data</code> that must
remain after removing points to match nearest neighbor distances. This
function will stop removing data from analysis sets once only
<code>min_analysis_proportion</code> of the original data remains in analysis sets, even
if the nearest neighbor distances between analysis and assessment sets are
still lower than those between training and prediction locations.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note that, as a form of leave-one-out cross-validation, this method can be
rather slow for larger data (and fitting models to these resamples will be
even slower).
</p>


<h3>Value</h3>

<p>A tibble with classes <code>spatial_nndm_cv</code>,  <code>spatial_rset</code>, <code>rset</code>,
<code>tbl_df</code>, <code>tbl</code>, and <code>data.frame</code>. The results include a column for the
data split objects and an identification variable <code>id</code>.
</p>


<h3>References</h3>

<p>C. Milà, J. Mateu, E. Pebesma, and H. Meyer. 2022. "Nearest Neighbour
Distance Matching Leave-One-Out Cross-Validation for map validation." Methods
in Ecology and Evolution 2022:13, pp 1304– 1316.
doi: 10.1111/2041-210X.13851.
</p>
<p>H. Meyer and E. Pebesma. 2022. "Machine learning-based global maps of
ecological variables and the challenge of assessing them."
Nature Communications 13, pp 2208. doi: 10.1038/s41467-022-29838-9.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(ames, package = "modeldata")
ames_sf &lt;- sf::st_as_sf(ames, coords = c("Longitude", "Latitude"), crs = 4326)

# Using a small subset of the data, to make the example run faster:
spatial_nndm_cv(ames_sf[1:100, ], ames_sf[2001:2100, ])

</code></pre>


</div>