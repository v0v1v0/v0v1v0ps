<div class="container">

<table style="width: 100%;"><tr>
<td>HLCor</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Fits a (spatially) correlated mixed model, for given correlation parameters 
</h2>

<h3>Description</h3>

<p>A fitting function acting as a convenient interface for <code>HLfit</code>, constructing the correlation matrix of random effects from the arguments, then estimating fixed effects and dispersion parameters using <code>HLfit</code>. Various arguments are available to constrain the correlation structure, <code>covStruct</code> and <code>distMatrix</code> being the more general ones (for any number of random effects), and <code>adjMatrix</code> and <code>corrMatrix</code> being alternatives to <code>covStruct</code> for a single correlated random effect. <code>uniqueGeo</code> is deprecated.
</p>


<h3>Usage</h3>

<pre><code class="language-R">HLCor(formula, data, family = gaussian(), fixed=NULL, ranPars, distMatrix,
      adjMatrix, corrMatrix, covStruct=NULL,
      method = "REML", verbose = c(inner=FALSE),
      control.dist = list(), weights.form = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>

<p>A <code>predictor</code>, i.e. a formula with attributes (see <code>Predictor</code>), or possibly simply a simple <code>formula</code> if an offset is not required.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed, ranPars</code></td>
<td>

<p>A list of given values for correlation parameters (some of which are mandatory), and possibly also dispersion parameters 
(optional, but passed to HLfit if present). <code>ranPars</code> is the old argument, maintained for back compatibility; <code>fixed</code> is the new argument, uniform across <span class="pkg">spaMM</span> fitting functions. See <code>ranPars</code> for further information.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>The data frame to be analyzed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>A <code>family</code> object describing the distribution of the response variable. See <code>HLfit</code> for further information.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distMatrix</code></td>
<td>

<p><b>Either</b> a distance matrix between geographic locations, forwarded to <code>MaternCorr</code> or <code>CauchyCorr</code>. It overrides the (by default, Euclidean) distance matrix that would otherwise be deduced from the variables in a <code>Matern(.))</code> or <code>Cauchy(.)</code> term; <br><b>or</b> a list of such matrices. The list format is useful when there are several Matern/Cauchy terms, to avoid that all of them are affected by the same <code>distMatrix</code>. <code>NULL</code> list elements may be necessary, e.g.<br><code>distMatrix=list("1"=NULL,"2"=&lt;.&gt;)</code>) when a matrix is specified only for the second random effect.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjMatrix</code></td>
<td>

<p>An single adjacency matrix, used if a random effect of the form<br><code>y ~ adjacency(1|&lt;location index&gt;)</code> is present. See <code>adjacency</code> for further details.
If adjacency matrices are needed for several random effects, use <code>covStruct</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corrMatrix</code></td>
<td>

<p>A matrix <b>C</b> used if a random effect term of the form <code>corrMatrix(1|&lt;stuff&gt;)</code> is present. This allows to analyze non-spatial model by giving for example a matrix of genetic correlations. Each row corresponds to levels of a variable &lt;stuff&gt;. The covariance matrix of the random effects for each level is then <code class="reqn">\lambda</code><b>C</b>, where as usual <code class="reqn">\lambda</code> denotes a variance factor for the random effects (if <b>C</b> is a correlation matrix, then  <code class="reqn">\lambda</code> is the variance, but other cases are possible). See <code>corrMatrix</code> for further details.
If matrices are needed for several random effects, use <code>covStruct</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covStruct</code></td>
<td>

<p>An interface for specifying correlation structures for different types of random effect (<code>corrMatrix</code> or <code>adjacency</code>). See <code>covStruct</code> for details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Character: the fitting method to be used, such as <code>"ML"</code>, <code>"REML"</code> or <code>"PQL/L"</code>. <code>"REML"</code> is the default. Other possible values of <code>HLfit</code>'s <code>method</code> argument are handled.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights.form</code></td>
<td>

<p>Specification of prior weights by a one-sided formula: use <code>weights.form = ~ pw</code> instead of <code>prior.weights = pw</code>. The effect will be the same except that such an argument, known to evaluate to an object of class <code>"formula"</code>, is suitable to enforce safe programming practices (see <code>good-practice</code>).  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>A vector of booleans. <code>inner</code> controls various diagnostic (possibly messy) messages about the iterations. This should be distinguished from the <code>TRACE</code> element, meaningful in <code>fitme</code> or <code>corrHLfit</code> calls. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control.dist</code></td>
<td>

<p>A list of arguments that control the computation of the distance argument of the correlation functions. Possible elements are
</p>

<dl>
<dt>rho.mapping</dt>
<dd>
<p> a set of indices controlling which elements of the <code>rho</code> scale vector scales which dimension(s) of the space in which (spatial) 
correlation matrices of random effects are computed. See same argument in <code>make_scaled_dist</code> for details and examples.</p>
</dd> 
<dt>dist.method</dt>
<dd>
<p><code>method</code> argument of <code>proxy::dist</code> function (by default, <code>"Euclidean"</code>, but see <code>make_scaled_dist</code> for other distances such as spherical ones.)</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Further parameters passed to <code>HLfit</code> or to <code>mat_sqrt</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For approximations of likelihood, see <code>method</code>.  For the possible structures of random effects, see <code>random-effects</code>, but note that <code>HLCor</code> cannot adjust parameters of correlation models (with the exception of conditional autoregressive ones). Any such parameter must be specified by the <code>ranPars</code> argument. More generally, the correlation matrix for random effects can be specified by various combinations of formula terms and other arguments  (see Examples):
</p>

<dl>
<dt>Basic Matérn model</dt>
<dd>
<p><code>Matern(1|&lt;...&gt;)</code>, using the spatial coordinates in <code>&lt;...&gt;</code>. This will construct a correlation matrix according to the Matérn correlation function (see <code>MaternCorr</code>);</p>
</dd>
<dt>Basic Cauchy model</dt>
<dd>
<p><code>Cauchy(1|&lt;...&gt;)</code>, as for Matern (see <code>CauchyCorr</code>);</p>
</dd>
<dt>Same models with given distance matrix</dt>
<dd>
<p>as provided by <code>distMatrix</code> (see Examples);</p>
</dd>
<dt>Given correlation matrix</dt>
<dd>
<p><code>corrMatrix(1|&lt;...&gt;)</code> with <code>corrMatrix</code> argument. See <code>corrMatrix</code> for further details.</p>
</dd>
<dt>CAR model with given adjacency matrix</dt>
<dd>
<p><code>adjacency(1|&lt;...&gt;)</code> with <code>adjMatrix</code>. See <code>adjacency</code> for further details;</p>
</dd>
<dt>AR1 model</dt>
<dd>
<p><code>AR1(1|&lt;...&gt;)</code> See <code>AR1</code> for further details.</p>
</dd> 
</dl>
<h3>Value</h3>

<p>The return value of an <code>HLfit</code> call, with the following additional attributes: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>HLCorcall</code></td>
<td>
<p>the HLCor call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>info.uniqueGeo</code></td>
<td>
<p>Unique geographic locations.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>autoregressive</code> for additional examples, <code>MaternCorr</code>, <code>HLfit</code>, and <code>corrHLfit</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example with an adjacency matrix (autoregressive model):
# see 'adjacency' documentation page

#### Matern correlation using only the Matern() syntax
data("blackcap")
(fitM &lt;- HLCor(migStatus ~ means+ Matern(1|longitude+latitude),data=blackcap,
      method="ML", ranPars=list(nu=0.6285603,rho=0.0544659)))

#### Using the 'distMatrix' argument
data("blackcap")
#
# Build distance matrix (here equivalent to the default one for a Matern() term)
MLdistMat &lt;- as.matrix(proxy::dist(blackcap[,c("latitude","longitude")]))
#
(fitD &lt;- HLCor(migStatus ~ means+ Matern(1|longitude+latitude),data=blackcap,
      distMatrix=MLdistMat, method="ML", ranPars=list(nu=0.6285603,rho=0.0544659)))
# : result here must be equivalent to the one without the distMatrix.
diff(c(logLik(fitM),logLik(fitD)))
</code></pre>


</div>