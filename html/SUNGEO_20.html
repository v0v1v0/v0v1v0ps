<div class="container">

<table style="width: 100%;"><tr>
<td>nesting</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Relative scale and nesting coefficients</h2>

<h3>Description</h3>

<p>Function to calculate relative scale and nesting metrics for changes of support from a source polygon layer to an overlapping (but spatially misaligned) destination polygon layer.
</p>


<h3>Usage</h3>

<pre><code class="language-R">nesting(
  poly_from = NULL,
  poly_to = NULL,
  metrix = "all",
  tol_ = 0.001,
  by_unit = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>poly_from</code></td>
<td>
<p>Source polygon layer. <code>sf</code> object (polygon or multipolygon).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>poly_to</code></td>
<td>
<p>Destination polygon layer. Must have identical CRS to <code>poly_from</code>. <code>sf</code> object (polygon or multipolygon).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metrix</code></td>
<td>
<p>Requested scaling and nesting metrics. See "details". Default is "all". Character string or vector of character strings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol_</code></td>
<td>
<p>Minimum area of polygon intersection, in square meters. Default is 0.001. Numeric.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by_unit</code></td>
<td>
<p>Include a by-unit decomposition of requested nesting metrics (if available)? Default is FALSE. Logical.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Currently supported metrics (<code>metrix</code>) include:
</p>

<ul>
<li>
<p> Relative scale ("rs"). Measures whether a change-of-support (CoS) task is one of aggregation or disaggregation, by calculating the share of source units that are smaller than destination units. Its range is from 0 to 1, where values of 1 indicate pure aggregation (all source units are smaller than destination units) and values of 0 indicate no aggregation (all source units are at least as large as destination units). Values between 0 and 1 indicate a hybrid (i.e. some source units are smaller, others are larger than target units).
</p>
</li>
<li>
<p> Relative nesting ("rn"). Measures how closely source and destination boundaries align, by calculating the share of source units that cannot be split across multiple destination units. Its range is from 0 to 1, where values of 0 indicate no nesting (every source unit can be split across multiple destination units) and values of 1 indicate full nesting (no source unit can be split across multiple destination units).
</p>
</li>
<li>
<p> Relative scale, symmetric ("rs_sym"). Alternative measure of "rs", which ranges from -1 to 1. It calculates a difference between two proportions: the share of source units that is smaller than destination units (i.e. "rs" from standpoint of source units), and the share that is larger (i.e. "rs" from standpoint of destination units). Values of -1 indicate pure disaggregation (all source units are larger than destination units), 1 indicates pure aggregation (all source units are smaller than destination units). Values of 0 indicate that all source units are the same size as target units.
</p>
</li>
<li>
<p> Relative nesting, symmetric ("rn_sym"). Alternative measure of "rn", which ranges from -1 to 1. It calculates a difference between two components: the nesting of source units within destination units (i.e. "rn" from standpoint of source units), and the nesting of destination units within source units (i.e. "rn" from standpoint of destination units. Values of 1 indicate that source units are perfectly nested within destination units; -1 indicates that destination units are perfectly nested within source units.
</p>
</li>
<li>
<p> Relative scale, alternative ("rs_alt"). Alternative measure of "rs", rescaled as a proportion of destination unit area. This measure can take any value on the real line, with positive values indicating aggregation and negative values indicating disaggregation.
</p>
</li>
<li>
<p> Relative nesting, alternative ("rn_alt"). Alternative measure of "rn", which places more weight on areas of maximum overlap. The main difference between this measure and "rn" is its use of the maximum intersection area for each source polygon instead of averaging over the quadratic term. Two sets of polygons are considered nested if one set is completely contained within another, with as few splits as possible. If none or only a sliver of a source polygon area falls outside a single destination polygon, those polygons are "more nested" than a case where half of a source polygon falls in destination polygon A and half falls into another polygon B.
</p>
</li>
<li>
<p> Relative scale, conditional ("rs_nn"). Alternative measure of "rs", calculated for the subset of source units that are not fully nested within destination units.
</p>
</li>
<li>
<p> Relative nesting, conditional ("rn_nn"). Alternative measure of "rn", calculated for the subset of source units that are not fully nested within destination units.
</p>
</li>
<li>
<p> Proportion intact ("p_intact"). A nesting metric that requires no area calculations at all. This measure ranges from 0 to 1, where 1 indicates full nesting (i.e. every source unit is intact/no splits), and 0 indicates no nesting (i.e. no source unit is intact/all are split).
</p>
</li>
<li>
<p> Proportion fully nested ("full_nest"). A stricter version of "p_intact". This measure ranges from 0 to 1, where 1 indicates full nesting (i.e. every source unit is intact/no splits AND falls completely inside the destination layer), and 0 indicates no nesting (i.e. no source unit is both intact and falls inside destination layer).
</p>
</li>
<li>
<p> Relative overlap ("ro"). Assesses extent of spatial overlap between source and destination polygons. This measure is scaled between -1 and 1. Values of 0 indicate perfect overlap (there is no part of source units that fall outside of destination units, and vice versa). Values between 0 and 1 indicate a "source underlap" (some parts of source polygons fall outside of destination polygons; more precisely, a larger part of source polygon area falls outside destination polygons than the other way around). Values between -1 and 0 indicate a "destination underlap" (some parts of destination polygons fall outside of source polygons; a larger part of destination polygon area falls outside source polygons than the other way around). Values of -1 and 1 indicate no overlap (all source units fall outside destination units, and vice versa). This is a theoretical limit only; the function returns an error if there is no overlap.
</p>
</li>
<li>
<p> Gibbs-Martin index of diversification ("gmi"). Inverse of "rn", where values of 1 indicate that every source unit is evenly split across multiple destination units, and 0 indicates that no source unit is split across any destination units.
</p>
</li>
</ul>
<p>It is possible to pass multiple arguments to <code>metrix</code> (e.g. <code>metrix=c("rn","rs")</code>). The default (<code>metrix="all"</code>) returns all of the above metrics.
</p>
<p>The function automatically reprojects source and destination geometries to Lambert Equal Area prior to calculation, with map units in meters.
</p>
<p>Values of <code>tol_</code> can be adjusted to increase or decrease the sensitivity of these metrics to small border misalignments. The default value discards polygon intersections smaller than 0.001 square meters in area.
</p>


<h3>Value</h3>

<p>Named list, with numeric values for each requested metric in <code>metrix</code>. If <code>by_unit==TRUE</code>, last element of list is a data.table, with nesting metrics disaggregated by source unit, where the first column is a row index for the source polygon layer.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Calculate all scale and nesting metrics for two sets of polygons
## Not run: 
data(clea_deu2009)
data(hex_05_deu)
nest_1 &lt;- nesting(
              poly_from = clea_deu2009,
              poly_to = hex_05_deu
              )
nest_1

## End(Not run)

# Calculate just Relative Nesting, in the opposite direction
## Not run: 
nest_2 &lt;- nesting(
              poly_from = hex_05_deu,
              poly_to = clea_deu2009,
              metrix = "rn"
              )
nest_2

## End(Not run)
</code></pre>


</div>