<div class="container">

<table style="width: 100%;"><tr>
<td>simulSM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Simulation of a semi-Markov chain
</h2>

<h3>Description</h3>

<p>Simulation of a semi-Markov chain starting from chosen parameters. This simulation can be parametric or non-parametric, non-censored, censored at the beginning and/or at the end of the sequence, with one or several trajectories. Several parametric distributions are considered (Uniform, Geometric, Poisson, Discrete Weibull and Negative Binomial). 
</p>


<h3>Usage</h3>

<pre><code class="language-R"># parametric case  
simulSM(E, NbSeq, lengthSeq, TypeSojournTime = "fij", init, Ptrans, distr, param, 
laws = NULL, cens.beg = 0, cens.end = 0, File.out = NULL)

# non-parametric case
simulSM(E, NbSeq, lengthSeq, TypeSojournTime = "fij", init, Ptrans, distr = "NP", 
param = NULL, laws, cens.beg = 0, cens.end = 0, File.out = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>

<p>Vector of state space
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NbSeq</code></td>
<td>

<p>Number of simulated sequences  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lengthSeq</code></td>
<td>

<p>Vector containing the lengths of each simulated sequence  (the length of sequences can be different, see details)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TypeSojournTime</code></td>
<td>

<p>Character : must be one of "fij", "fi", "fj", "f" (for more explanations, see Details)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init</code></td>
<td>

<p>Vector of initial distribution of length S, with S = length(E)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ptrans</code></td>
<td>

<p>Matrix of transition probabilities of the embedded Markov chain <code class="reqn">J=(J_m)_{m}</code> (The sum of the probabilities on the same row must be equal to 1. According to semi-Markov model, the probability to stay in the same state is assumed to be equal to 0.)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distr</code></td>
<td>

<p>- "NP" for nonparametric case, laws have to be used, param is useless
</p>
<p>- Matrix of distributions of size SxS if TypeSojournTime is equal to "fij";
</p>
<p>- Vector of distributions of size S if TypeSojournTime is equal to "fi" or "fj";
</p>
<p>- A distribution if TypeSojournTime is equal to "f".
</p>
<p>The distributions to be used in distr must be one of "uniform", "geom", "pois", "dweibull", "nbinom".
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param</code></td>
<td>

<p>- Useless if distr = "NP"
</p>
<p>- Array of distribution parameters of size SxSx2 (2 corresponds to the maximal number of distribution parameters) if TypeSojournTime is equal to "fij";
</p>
<p>- Matrix of distribution parameters of size Sx2 if TypeSojournTime is equal to "fi" or "fj";
</p>
<p>- Vector of distribution parameters of length 2 if TypeSojournTime is equal to "f". 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>laws</code></td>
<td>

<p>- Useless if distr <code class="reqn">\neq</code> "NP"
</p>
<p>- Array of size SxSxKmax if TypeSojournTime is equal to "fij";
</p>
<p>- Matrix of size SxKmax if TypeSojournTime is equal to "fi" or "fj";
</p>
<p>- Vector of length Kmax if the TypeSojournTime is equal to "f". 
</p>
<p>Kmax is the maximum length of the sojourn times. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens.beg</code></td>
<td>

<p>Type of censoring at the beginning of sample paths;  1 (if the first sojourn time is censored) or 0 (if not). All the sequences must be censored in
the same way.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens.end</code></td>
<td>

<p>Type of censoring at the end of sample paths;  1 (if the last sojourn time is censored) or 0 (if not). All the sequences must be censored in
the same way.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>File.out</code></td>
<td>

<p>Name of fasta file to save the sequences;  if File.out = NULL, no file is created.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function simulates a semi-Markov model in the parametric and non-parametric case, 
taking into account the type of sojourn time and the censoring described in references.
</p>
<p>The non-parametric simulation concerns sojourn time distributions defined by the user.
For the parametric simulation, several discrete distributions are considered (see below).
</p>
<p>The difference between the Markov model and the semi-Markov model concerns the modelling of the sojourn time. 
With a Markov chain, the sojourn time distribution is modeled by a Geometric distribution. 
With a semi-Markov chain, the sojourn time can be arbitrarily  distributed.
In this package, the available distribution for a semi-Markov model are:
</p>

<ul>
<li>
<p> Uniform: <code class="reqn">f(x) = 1/n</code> for <code class="reqn">a \le x \le b</code>, with <code class="reqn">n = b-a+1</code>
</p>
</li>
<li>
<p> Geometric: <code class="reqn">f(x) = \theta (1-\theta)^x</code> for <code class="reqn">x = 0, 1, 2,\ldots,n</code>, <code class="reqn">0 &lt; \theta \le 1</code>, with <code class="reqn">n &gt; 0</code> and <code class="reqn">\theta</code> is the probability of success
</p>
</li>
<li>
<p> Poisson: <code class="reqn">f(x) = (\lambda^x exp(-\lambda))/x!</code> for <code class="reqn">x = 0, 1, 2,\ldots,n</code>, with <code class="reqn">n &gt; 0</code> and <code class="reqn">\lambda &gt; 0</code> 
</p>
</li>
<li>
<p> Discrete Weibull of type 1: <code class="reqn">f(x)=q^{(x-1)^{\beta}}-q^{x^{\beta}}, x=1,2,3,\ldots,n</code>, with <code class="reqn">n &gt; 0</code>, <code class="reqn">q</code> is the first parameter and <code class="reqn">\beta</code> is the second parameter
</p>
</li>
<li>
<p> Negative Binomial: <code class="reqn">f(x)=\Gamma(x+\alpha)/(\Gamma(\alpha) x!) (\alpha/(\alpha+\mu))^{\alpha} (\mu/(\alpha+\mu))^x</code>, for <code class="reqn">x = 0, 1, 2,\ldots,n</code>, <code class="reqn">n &gt; 0,\ \Gamma </code> is the gamma function, <code class="reqn">\alpha</code> is the parameter of overdispersion and <code class="reqn">\mu</code> is the mean
</p>
</li>
<li>
<p> Non-parametric
</p>
</li>
</ul>
<p>We define :
</p>

<ul>
<li>
<p> the semi-Markov kernel <code class="reqn">q_{ij}(k) = P( J_{m+1} = j, T_{m+1} - T_{m} = k | J_{m} = i )</code>;
</p>
</li>
<li>
<p> the transition matrix <code class="reqn">(Ptrans(i,j))_{i,j} \in E</code> of the embedded Markov chain <code class="reqn">J = (J_m)_m</code>, <code class="reqn">Ptrans(i,j) = P( J_{m+1} = j | J_m = i )</code>;
</p>
</li>
<li>
<p> the initial distribution, <code class="reqn">init = P(J_1 = i) = P(Y_1 = i)</code>;
</p>
</li>
<li>
<p> the conditional sojourn time distributions <code class="reqn">(f_{ij}(k))_{i,j} \in E,\ k \in N ,\ f_{ij}(k) = P(T_{m+1} - T_m = k | J_m = i, J_{m+1} = j )</code>, f is specified by the argument "param" in the parametric case and by "laws" in the non-parametric case.
</p>
</li>
</ul>
<p>In this package we can choose differents types of sojourn times. Four options are available for the sojourn times
</p>

<ul>
<li>
<p> depending on the present state and on the next state ("fij");
</p>
</li>
<li>
<p> depending only on the present state ("fi");
</p>
</li>
<li>
<p> depending only on the next state ("fj");
</p>
</li>
<li>
<p> depending neither on the current, nor on the next state ("f").
</p>
</li>
</ul>
<p>If  TypeSojournTime is equal to "fij", distr is a matrix (SxS) (e.g., if the row 1 of the 2nd column is "pois", that is to say we go from the first state to the second state following a Poisson distribution). 
If TypeSojournTime is equal to "fi" or "fj", distr must be a vector (e.g., if the first element of vector is "geom", that is to say we go from the first state to any state according to a Geometric distribution). 
If TypeSojournTime is equal to "f", distr must be one of "uniform", "geom", "pois", "dweibull", "nbinom" (e.g., if distr is equal to "nbinom", that is to say that the sojourn times when going from any state to any state follows a Negative Binomial distribution).
For the non-parametric case, distr is equal to "NP" whatever type of sojourn time given.
</p>
<p>If the sequence is censored at the beginning and at the end, cens.beg must be equal to 1 and cens.end must be equal to 1 too. All the sequences must be censored in the same way.
</p>
<p>Moreover, in the non-parametric case TypeSojournTime is equal to "fij" then laws must be an array of size SxSxKmax. 
If distr is equal to "NP" and TypeSojournTime is equal to "fi" or "fj" then laws must be a matrix of size SxKmax. 
If the distr is equal to "NP" and TypeSojournTime is equal to "f" then laws is a vector of length Kmax.
</p>
<p>For the simulation of a non-censored sequence, the length of the sequence can be greater than lengthSeq.
</p>


<h3>Value</h3>

<p>simulSM returns sequences of size lengthSeq or greater
</p>
<p>If File.out is not NULL, a fasta file will be created containing the sequences.
</p>


<h3>Author(s)</h3>

<p>Vlad Stefan Barbu, barbu@univ-rouen.fr <br> Caroline Berard, caroline.berard@univ-rouen.fr <br> Dominique Cellier, dominique.cellier@laposte.net <br> Mathilde Sautreuil, mathilde.sautreuil@etu.univ-rouen.fr <br> Nicolas Vergne, nicolas.vergne@univ-rouen.fr 
</p>


<h3>References</h3>

<p>VS Barbu, C Berard, D Cellier, M Sautreuil and N Vergne (2017), Parametric estimation of semi-Markov chains, submitted
</p>


<h3>See Also</h3>

<p>estimSM, simulMk
</p>


<h3>Examples</h3>

<pre><code class="language-R">alphabet = c("a","c","g","t")
S = length(alphabet)
## creation of the initial distribution
vect.init = c(1/4,1/4,1/4,1/4)
# creation of the transition matrix
Pij = matrix(c(0,0.2,0.3,0.5,0.4,0,0.2,0.4,0.1,0.2,0,0.7,0.8,0.1,0.1,0), nrow = S, 
ncol = S, byrow = TRUE)

################################
## Parametric simulation of a trajectory (of length equal to 50), 
## where the sojourn times depend neither on the present state nor on the next state ("f").
################################
## Simulation of a sequence of length 50
seq50 = simulSM(E = alphabet, NbSeq = 1, lengthSeq = 50, TypeSojournTime = "f", 
                init = vect.init, Ptrans = Pij, distr = "pois", param = 2)
          
      
################################
## Parametric simulation of several trajectories (3 trajectories of length 1000, 
## 10 000 and  2000 respectively),
## where the sojourn times depend on the present state and on the next state ("fij")
## the sojourn time is modelled by different distributions
################################
lengthSeq3 = c(1000, 10000, 2000)
## creation of the distribution matrix
distr.matrix = matrix(c("dweibull", "pois", "geom", "nbinom", "geom", "nbinom", 
"pois", "dweibull", "pois", "pois", "dweibull", "geom", "pois","geom", "geom", 
"nbinom"), nrow = S, ncol = S, byrow = TRUE)
## creation of an array containing the parameters
param1.matrix = matrix(c(0.6,2,0.4,4,0.7,2,5,0.6,2,3,0.6,0.6,4,0.3,0.4,4), 
nrow = S, ncol = S, byrow = TRUE)
param2.matrix = matrix(c(0.8,0,0,2,0,5,0,0.8,0,0,0.8,0,4,0,0,4), nrow = S, 
ncol = S, byrow = TRUE)
param.array = array(c(param1.matrix, param2.matrix), c(S,S,2))
### Simulation of 3 sequences
seq3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, 
TypeSojournTime = "fij", init = vect.init, Ptrans = Pij, distr = distr.matrix, 
param = param.array, File.out = NULL)
                

################################
## Parametric simulation of several trajectories (3 trajectories of length 1000, 
## 10 000 and  2000 respectively),
## where the sojourn times depend only on the present state ("fi.")
## and the sojourn times are modelled by different distributions.
################################
## creation of the distribution matrix
distr.vect = c("dweibull", "pois", "geom", "nbinom")
## creation of an array containing the parameters
param.matrix = matrix(c(0.6,0.8,4,0,0.7,0,5,2), nrow = S, ncol = 2, byrow = TRUE)
### Simulation of 3 sequences without censoring
#seqFi3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, TypeSojournTime = "fi", 
#             init = vect.init, Ptrans = Pij, distr = distr.vect, param = param.matrix,
#             File.out = NULL)
### Simulation of 3 sequences with censoring at the beginning
#seqFi3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, TypeSojournTime = "fi", 
#             init = vect.init, Ptrans = Pij, distr = distr.vect, param = param.matrix, 
#             File.out = NULL, cens.beg = 1, cens.end = 0)
### Simulation of 3 sequences with censoring at the end
#seqFi3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, TypeSojournTime = "fi", 
#             init = vect.init, Ptrans = Pij, distr = distr.vect, param = param.matrix, 
#             File.out = NULL, cens.beg = 0, cens.end = 1)
### Simulation of 3 sequences with censoring at the beginning and at the end
#seqFi3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, TypeSojournTime = "fi", 
#             init = vect.init, Ptrans = Pij, distr = distr.vect, param = param.matrix,
#             File.out = NULL, cens.beg = 1, cens.end = 1)
                
################################
## Non-parametric simulation of several trajectories (3 trajectories of length 1000,  
## 10 000 and  2000 respectively),
## where the sojourn times depend on the present state and on the next state ("fij")
################################
## creation of a matrix corresponding to the conditionnal sojourn time distribution
Kmax = 4 
mat1 = matrix(c(0,0.5,0.4,0.6,0.3,0,0.5,0.4,0.7,0.2,0,0.3,0.4,0.6,0.2,0), nrow = S, 
ncol = S, byrow = TRUE)
mat2 = matrix(c(0,0.2,0.3,0.1,0.2,0,0.2,0.3,0.1,0.4,0,0.3,0.2,0.1,0.3,0), nrow = S, 
ncol = S, byrow = TRUE)
mat3 = matrix(c(0,0.1,0.3,0.1,0.3,0,0.1,0.2,0.1,0.2,0,0.3,0.3,0.3,0.4,0), nrow = S, 
ncol = S, byrow = TRUE)
mat4 = matrix(c(0,0.2,0,0.2,0.2,0,0.2,0.1,0.1,0.2,0,0.1,0.1,0,0.1,0), nrow = S, 
ncol = S, byrow = TRUE)
f &lt;- array(c(mat1,mat2,mat3,mat4), c(S,S,Kmax))
### Simulation of 3 sequences
seqNP3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, TypeSojournTime = "fij", 
                init = vect.init, Ptrans = Pij, laws = f, File.out = NULL)


################################
## Non-parametric simulation of several trajectories (3 trajectories of length 1000, 
## 10 000 and  2000 respectively),
## where the sojourn times depend only on he next state ("fj")
################################
## creation of a matrix corresponding to the conditional sojourn time distributions
Kmax = 6
nparam.matrix = matrix(c(0.2,0.1,0.3,0.2,0.2,0,0.4,0.2,0.1,0,0.2,0.1,
 0.5,0.3,0.15,0.05,0,0,0.3,0.2,0.1,0.2,0.2,0), 
                       nrow = S, ncol = Kmax, byrow = TRUE)
### Simulation of 3 sequences without censoring
#seqNP3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, TypeSojournTime = "fj", 
#                init = vect.init, Ptrans = Pij, laws = nparam.matrix, File.out = NULL)
### Simulation of 3 sequences with censoring at the beginnig 
#seqNP3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, TypeSojournTime = "fj", 
#                init = vect.init, Ptrans = Pij, laws = nparam.matrix, File.out = NULL, 
#                cens.beg = 1, cens.end = 0)
### Simulation of 3 sequences with censoring at the end 
#seqNP3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, TypeSojournTime = "fj", 
#                init = vect.init, Ptrans = Pij, laws = nparam.matrix, File.out = NULL, 
#                cens.beg = 0, cens.end = 1)
### Simulation of 3 sequences with censoring at the beginning and at the end 
#seqNP3 = simulSM(E = alphabet, NbSeq = 3, lengthSeq = lengthSeq3, TypeSojournTime = "fj", 
#                init = vect.init, Ptrans = Pij, laws = nparam.matrix, File.out = NULL, 
#                cens.beg = 1, cens.end = 1)

</code></pre>


</div>