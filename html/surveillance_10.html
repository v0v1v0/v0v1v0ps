<div class="container">

<table style="width: 100%;"><tr>
<td>hhh4_simulate_plot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Plot Simulations from <code>"hhh4"</code> Models
</h2>

<h3>Description</h3>

<p>Arrays of simulated counts from <code>simulate.hhh4</code> can be
visualized as final size boxplots, individual or average time series,
or fan charts (using the <a href="https://CRAN.R-project.org/package=fanplot"><span class="pkg">fanplot</span></a> package).
An <code>aggregate</code>-method is also available.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'hhh4sims'
plot(x, ...)
## S3 method for class 'hhh4sims'
aggregate(x, units = TRUE, time = FALSE, ..., drop = FALSE)

as.hhh4simslist(x, ...)
## S3 method for class 'hhh4simslist'
plot(x, type = c("size", "time", "fan"), ...,
     groups = NULL, par.settings = list())
## S3 method for class 'hhh4simslist'
aggregate(x, units = TRUE, time = FALSE, ..., drop = FALSE)

plotHHH4sims_size(x, horizontal = TRUE, trafo = NULL, observed = TRUE,
                  names = base::names(x), ...)

plotHHH4sims_time(x, average = mean, individual = length(x) == 1,
    conf.level = if (individual) 0.95 else NULL,
    matplot.args = list(), initial.args = list(), legend = length(x) &gt; 1,
    xlim = NULL, ylim = NULL, add = FALSE, ...)

plotHHH4sims_fan(x, which = 1,
    fan.args = list(), observed.args = list(), initial.args = list(),
    means.args = NULL, key.args = NULL, xlim = NULL, ylim = NULL,
    add = FALSE, xaxis = list(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>an object of class <code>"hhh4sims"</code> (as resulting from the
<code>simulate</code>-method for
<code>"hhh4"</code> models if <code>simplify = TRUE</code> was set),
or an <code>"hhh4simslist"</code>, i.e.,
a list of such simulations potentially obtained from different
model fits (using the same simulation period).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>

<p>a character string indicating the summary plot to produce.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>further arguments passed to methods.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups</code></td>
<td>

<p>an optional factor to produce stratified plots by groups of units.
The special setting <code>groups = TRUE</code> is a convenient shortcut
for one plot by unit.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par.settings</code></td>
<td>

<p>a list of graphical parameters for <code>par</code>.
Sensible defaults for <code>mfrow</code>, <code>mar</code> and <code>las</code> will
be applied unless overridden or <code>!is.list(par.settings)</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>horizontal</code></td>
<td>

<p>a logical indicating if the boxplots of the final size distributions
should be horizontal (the default).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trafo</code></td>
<td>

<p>an optional transformation function from the <span class="pkg">scales</span> package, e.g.,
<code>sqrt_trans</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>observed</code></td>
<td>

<p>a logical indicating if a line and axis value for the observed size
of the epidemic should be added to the plot.
Alternatively, a list with graphical parameters can be specified to
modify the default values.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names</code></td>
<td>

<p>a character vector of names for <code>x</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>average</code></td>
<td>

<p>scalar-valued function to apply to the simulated counts at each time point.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>individual</code></td>
<td>

<p>a logical indicating if the individual simulations should be shown as well.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>

<p>a scalar in (0,1), which determines the level of the pointwise
quantiles obtained from the simulated counts at each time point.
A value of <code>NULL</code> disables the confidence interval.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matplot.args</code></td>
<td>

<p>a list of graphical parameters for <code>matlines</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial.args</code></td>
<td>

<p>if a list (of graphical parameters for <code>lines</code>),
a bar for the initial number of cases is added to the plot.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>

<p>a logical, a character vector (providing names for <code>x</code>),
or a list of parameters for <code>legend</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim,ylim</code></td>
<td>

<p>vectors of length 2 determining the axis limits.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add</code></td>
<td>

<p>a logical indicating if the (mean) simulated time series or the fan
chart, respectively, should be added to an existing plot.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which</code></td>
<td>

<p>a single integer or a character string selecting the model in
<code>x</code> for which to produce the fan chart.
This is only relevant if <code>x</code> is a <code>"hhh4simslist"</code> of
simulations from multiple models.
Defaults to the first model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fan.args</code></td>
<td>

<p>a list of graphical parameters for the <code>fan</code>,
e.g., to employ a different <code>colorRampPalette</code> as
<code>fan.col</code>, or to enable contour lines via <code>ln</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>observed.args</code></td>
<td>

<p>if a list (of graphical parameters for <code>lines</code>),
the originally observed counts are added to the plot.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>means.args</code></td>
<td>

<p>if a list (of graphical parameters for <code>lines</code>),
the point forecasts are added to the plot (by default as
a white line within the fan).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key.args</code></td>
<td>

<p>if a list, a color key (in <code>fan</code>'s
<code>"boxfan"</code>-style) is added to the fan chart. The list may
include positioning parameters <code>start</code> (the x-position) and
<code>ylim</code> (the y-range of the color key), <code>space</code> to modify
the width of the boxfan, and <code>rlab</code> to modify the labels.
The color key is disabled by default.
An alternative way of labeling the quantiles is via the argument
<code>ln</code> in <code>fan.args</code>, see the Examples.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xaxis</code></td>
<td>

<p>if a list of arguments for <code>addFormattedXAxis</code>, that
function is used to draw the time axis, otherwise a default x-axis
is drawn.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units</code></td>
<td>

<p>a logical indicating aggregation over units. Can also be a factor
(or something convertible to a factor using <code>as.factor</code>)
to aggregate groups of units.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>

<p>a logical indicating if the counts should be summed over the whole
simulation period.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop</code></td>
<td>

<p>a logical indicating if the unit dimension and the <code>"hhh4sims"</code>
(or <code>"hhh4simslist"</code>) class should be dropped after aggregating
over (groups of) units.
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Sebastian Meyer
</p>


<h3>Examples</h3>

<pre><code class="language-R">### univariate example
data("salmAllOnset")

## fit a hhh4 model to the first 13 years
salmModel &lt;- list(end = list(f = addSeason2formula(~1 + t)),
                  ar = list(f = ~1), family = "NegBin1", subset = 2:678)
salmFit &lt;- hhh4(salmAllOnset, salmModel)

## simulate the next 20 weeks ahead
salmSims &lt;- simulate(salmFit, nsim = 300, seed = 3, subset = 678 + seq_len(20),
                     y.start = observed(salmAllOnset)[678,])

## compare final size distribution to observed value
summary(aggregate(salmSims, time = TRUE))  # summary of simulated values
plot(salmSims, type = "size")

## individual and average simulated time series with a confidence interval
plot(salmSims, type = "time", main = "20-weeks-ahead simulation")

## fan chart based on the quantiles of the simulated counts at each time point
## point forecasts are represented by a white line within the fan
if (requireNamespace("fanplot")) {
    plot(salmSims, type = "fan", main = "20-weeks-ahead simulation",
         fan.args = list(ln = 1:9/10), means.args = list())
}


### multivariate example
data("measlesWeserEms")

## fit a hhh4 model to the first year
measlesModel &lt;- list(
    end = list(f = addSeason2formula(~1), offset = population(measlesWeserEms)),
    ar = list(f = ~1),
    ne = list(f = ~1 + log(pop),
        weights = W_powerlaw(maxlag = 5, normalize = TRUE)),
    family = "NegBin1", subset = 2:52,
    data = list(pop = population(measlesWeserEms)))
measlesFit1 &lt;- hhh4(measlesWeserEms, control = measlesModel)

## use a Poisson distribution instead (just for comparison)
measlesFit2 &lt;- update(measlesFit1, family = "Poisson")

## simulate realizations from these models during the second year
measlesSims &lt;- lapply(X = list(NegBin = measlesFit1, Poisson = measlesFit2),
                      FUN = simulate, nsim = 50, seed = 1, subset = 53:104,
                      y.start = observed(measlesWeserEms)[52,])

## final size of the first model
plot(measlesSims[[1]])

## stratified by groups of districts
mygroups &lt;- factor(substr(colnames(measlesWeserEms), 4, 4))
apply(aggregate(measlesSims[[1]], time = TRUE, units = mygroups), 1, summary)
plot(measlesSims[[1]], groups = mygroups)

## a class and plot-method for a list of simulations from different models
measlesSims &lt;- as.hhh4simslist(measlesSims)
plot(measlesSims)

## simulated time series
plot(measlesSims, type = "time", individual = TRUE, ylim = c(0, 80))

## fan charts
if (requireNamespace("fanplot")) {
    opar &lt;- par(mfrow = c(2,1))
    plot(measlesSims, type = "fan", which = 1, ylim = c(0, 80), main = "NegBin",
         key.args = list())
    plot(measlesSims, type = "fan", which = 2, ylim = c(0, 80), main = "Poisson")
    par(opar)
}
</code></pre>


</div>