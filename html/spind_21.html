<div class="container">

<table style="width: 100%;"><tr>
<td>WRM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Wavelet-revised models (WRMs)</h2>

<h3>Description</h3>

<p>A wavelet-based method to remove spatial autocorrelation
in multiple linear regressions. Wavelet transforms are implemented using
<span class="pkg">waveslim</span> (Whitcher, 2005).
</p>


<h3>Usage</h3>

<pre><code class="language-R">WRM(
  formula,
  family,
  data,
  coord,
  level = 1,
  wavelet = "haar",
  wtrafo = "dwt",
  b.ini = NULL,
  pad = list(),
  control = list(),
  moran.params = list(),
  plot = FALSE,
  customize_plot = NULL
)

## S3 method for class 'WRM'
plot(x, ...)

## S3 method for class 'WRM'
summary(object, ...)

## S3 method for class 'WRM'
predict(object, newdata, sm = FALSE, newcoord = NA, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Model formula. Variable names must match variables in <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p><code>gaussian</code>, <code>binomial</code>, or <code>poisson</code> are supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame with variable names that match the variables specified in <code>formula</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coord</code></td>
<td>
<p>A matrix of two columns with corresponding cartesian
coordinates. Currently only supports integer coordinates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>An integer specifying the degree of wavelet decomposition
</p>

<ul>
<li>
<p>0 - Without autocorrelation removal (equivalent to a GLM)
</p>
</li>
<li>
<p>1 - For best autocorrelation removal
</p>
</li>
<li>
<p>... - Higher integers possible. The limit depends on sample size
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wavelet</code></td>
<td>
<p>Name of wavelet family. <code>haar</code>, <code>d4</code>, and <code>la8</code>.
are possible. <code>haar</code> is the default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wtrafo</code></td>
<td>
<p>Type of wavelet transform. Either <code>dwt</code> or <code>modwt</code>.
<code>dwt</code> is the default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b.ini</code></td>
<td>
<p>Initial parameter values. Default is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pad</code></td>
<td>
<p>A list of parameters for padding wavelet coefficients.
</p>

<ul>
<li>
<p>padform - 0, 1, and 2 are possible.
<code>padform</code> is automatically set to
0 when either <code>level</code>=0 or
a <code>formula</code> including an intercept and a non-gaussian family
</p>

<ul>
<li>
<p>0 - Padding with 0s.
</p>
</li>
<li>
<p>1 - Padding with mean values.
</p>
</li>
<li>
<p>2 - Padding with mirror values.
</p>
</li>
</ul>
</li>
<li>
<p>padzone - Factor for expanding the padding zone
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>a list of parameters for controlling the fitting process.
</p>

<ul>
<li>
<p><code>eps</code> - Positive convergence tolerance. Smaller values of
<code>eps</code> provide better parameter estimates, but also reduce the probability
of the iterations converging. In case of issues with convergence, test larger
values of <code>eps</code>. Default is 10^-5.
</p>
</li>
<li>
<p><code>denom.eps</code> - Default is 10^-20.
</p>
</li>
<li>
<p><code>itmax</code> - Integer giving the maximum number of iterations.
Default is 200.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>moran.params</code></td>
<td>
<p>A list of parameters for calculating Moran's I.
</p>

<ul>
<li>
<p><code>lim1</code> - Lower limit for first bin. Default is 0.
</p>
</li>
<li>
<p><code>increment</code> - Step size for calculating Moran's I. Default is 1.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>A logical value indicating whether to plot autocorrelation of
residuals by distance bin. NOW DEPRECATED in favor of <code>plot.WRM</code> method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>customize_plot</code></td>
<td>
<p>Additional plotting parameters passed to <code>ggplot</code>.
NOW DEPRECATED in favor of <code>plot.WRM</code> method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An object of class <code>GEE</code> or <code>WRM</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Not used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An object of class <code>WRM</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>A data frame containing variables used to make predictions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sm</code></td>
<td>
<p>Logical. Should part of smooth components be included?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newcoord</code></td>
<td>
<p>New coordinates corresponding to observations in <code>newdata</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>WRM can be used to fit linear models for response vectors of different
distributions: <code>gaussian</code>, <code>binomial</code>, or <code>poisson</code>.
As a spatial model, it is a generalized linear model in which the residuals
may be autocorrelated. It corrects for  2-dimensional residual
autocorrelation for regular gridded data sets using the wavelet
decomposition technique. The grid cells are assumed to be square.
Furthermore, this function requires that <strong>all predictor variables
be continuous</strong>.
</p>


<h3>Value</h3>

<p>An object of class <code>WRM</code>. This consists of a list with the
following elements:
</p>

<dl>
<dt><code>call</code></dt>
<dd>
<p>Call</p>
</dd>
<dt><code>formula</code></dt>
<dd>
<p>Model formula</p>
</dd>
<dt><code>family</code></dt>
<dd>
<p>Family</p>
</dd>
<dt><code>coord</code></dt>
<dd>
<p>Coordinates used in the model</p>
</dd>
<dt><code>b</code></dt>
<dd>
<p>Estimate of regression parameters</p>
</dd>
<dt><code>s.e.</code></dt>
<dd>
<p>Standard errors</p>
</dd>
<dt><code>z</code></dt>
<dd>
<p>Depending on the <code>family</code>, either a <em>z</em> or <em>t</em> value</p>
</dd>
<dt><code>p</code></dt>
<dd>
<p><em>p</em>-values</p>
</dd>
<dt><code>fitted</code></dt>
<dd>
<p>Fitted values from the model</p>
</dd>
<dt><code>resid</code></dt>
<dd>
<p>Pearson residuals</p>
</dd>
<dt><code>b.sm</code></dt>
<dd>
<p>Parameter estimates of neglected smooth part</p>
</dd>
<dt><code>fitted.sm</code></dt>
<dd>
<p>Fitted values of neglected smooth part</p>
</dd>
<dt><code>level</code></dt>
<dd>
<p>Selected level of wavelet decomposition</p>
</dd>
<dt><code>wavelet</code></dt>
<dd>
<p>Selected wavelet</p>
</dd>
<dt><code>wtrafo</code></dt>
<dd>
<p>Selected wavelet transformation</p>
</dd>
<dt><code>padzone</code></dt>
<dd>
<p>Selected padding zone expansion factor</p>
</dd>
<dt><code>padform</code></dt>
<dd>
<p>Selected matrix padding type</p>
</dd>
<dt><code>n.eff</code></dt>
<dd>
<p>Effective number of observations</p>
</dd>
<dt><code>AIC</code></dt>
<dd>
<p>Akaike information criterion</p>
</dd>
<dt><code>AICc</code></dt>
<dd>
<p>AIC score corrected for small sample sizes</p>
</dd>
<dt><code>LogLik</code></dt>
<dd>
<p>Log likelihood of the model</p>
</dd>
<dt><code>ac.glm</code></dt>
<dd>
<p>Autocorrelation of GLM residuals</p>
</dd>
<dt><code>ac.wrm</code></dt>
<dd>
<p>Autocorrelation of WRM residuals</p>
</dd>
<dt><code>b.ini</code></dt>
<dd>
<p>Initial parameter values</p>
</dd>
<dt><code>control</code></dt>
<dd>
<p>Control parameters for the fitting process</p>
</dd>
<dt><code>moran.params</code></dt>
<dd>
<p>Parameters for calculating Moran's I</p>
</dd>
<dt><code>pad</code></dt>
<dd>
<p>List of parameters for padding wavelet coefficients</p>
</dd>
<dt><code>plot</code></dt>
<dd>
<p>An object of class <code>ggplot</code> containing information
on the autocorrelation of residuals from the fitted <code>WRM</code> and a
<code>GLM</code></p>
</dd>
</dl>
<h3>Note</h3>

<p>For those interested in multimodel inference approaches, <code>WRM</code> with
<code>level = 1</code> is identical to <code>mmiWMRR</code> with <code>scale = 1</code>.
</p>


<h3>Author(s)</h3>

<p>Gudrun Carl, Sam Levin
</p>


<h3>References</h3>

<p>Carl, G., Kuehn, I. (2010): A wavelet-based extension of generalized
linear models to remove the effect of spatial autocorrelation.
Geographical Analysis 42 (3), 323 - 337
</p>
<p>Whitcher, B. (2005) Waveslim: basic wavelet routines for one-, two-
and three-dimensional signal processing. R package version 1.5.
</p>


<h3>See Also</h3>

<p><code>mmiWMRR</code>, <code>predict.WRM</code>, <code>summary.WRM</code>,
<code>aic.calc</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(musdata)
coords &lt;- musdata[,4:5]

## Not run: 
mwrm &lt;- WRM(musculus ~ pollution + exposure,
            family = "poisson",
            data = musdata,
            coord = coords,
            level = 1)

pred &lt;- predict(mwrm, newdata = musdata)

summary(mwrm)

plot(mwrm)

library(ggplot2)

my_wrm_plot &lt;- mwrm$plot

# increase axis text size
print(my_wrm_plot + ggplot2::theme(axis.text = element_text(size = 15)))


## End(Not run)

</code></pre>


</div>