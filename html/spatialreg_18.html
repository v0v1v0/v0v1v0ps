<div class="container">

<table style="width: 100%;"><tr>
<td>stsls</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generalized spatial two stage least squares</h2>

<h3>Description</h3>

<p>The function fits a spatial lag model by two stage least squares, with the option of adjusting the results for heteroskedasticity.
</p>


<h3>Usage</h3>

<pre><code class="language-R">stsls(formula, data = list(), listw, zero.policy = NULL,
 na.action = na.fail, robust = FALSE, HC=NULL, legacy=FALSE, W2X = TRUE)
## S3 method for class 'Stsls'
impacts(obj, ..., tr, R = NULL, listw = NULL, evalues=NULL,
 tol = 1e-06, empirical = FALSE, Q=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a symbolic description of the model to be fit. The details 
of model specification are given for <code>lm()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame containing the variables in the model. 
By default the variables are taken from the environment which the function 
is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>listw</code></td>
<td>
<p>a <code>listw</code> object created for example by <code>nb2listw</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zero.policy</code></td>
<td>
<p>default NULL, use global option value; if TRUE assign zero to the lagged value of zones without 
neighbours, if FALSE (default) assign NA - causing <code>lagsarlm()</code> to terminate with an error</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>a function (default <code>na.fail</code>), can also be <code>na.omit</code> or <code>na.exclude</code> with consequences for residuals and fitted values - in these cases the weights list will be subsetted to remove NAs in the data. It may be necessary to set zero.policy to TRUE because this subsetting may create no-neighbour observations. Note that only weights lists created without using the glist argument to <code>nb2listw</code> may be subsetted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>robust</code></td>
<td>
<p>default FALSE, if TRUE, apply a heteroskedasticity correction to the coefficients covariances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>HC</code></td>
<td>
<p>default NULL, if <code>robust</code> is TRUE, assigned “HC0”, may take values “HC0” or “HC1” for White estimates or MacKinnon-White estimates respectively</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legacy</code></td>
<td>
<p>the argument chooses between two implementations of the robustness correction: default FALSE - use the estimate of Omega only in the White consistent estimator of the variance-covariance matrix, if TRUE, use the original implementation which runs a GLS using the estimate of Omega, and yields different coefficient estimates as well - see example below</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W2X</code></td>
<td>
<p>default TRUE, if FALSE only WX are used as instruments in the spatial two stage least squares; until release 0.4-60, only WX were used - see example below </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>A spatial regression object created by <code>lagsarlm</code>, <code>lagmess</code> or by <code>lmSLX</code>; in <code>HPDinterval.LagImpact</code>, a LagImpact object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed through to methods in the <span class="pkg">coda</span> package</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tr</code></td>
<td>
<p>A vector of traces of powers of the spatial weights matrix created using <code>trW</code>, for approximate impact measures; if not given, <code>listw</code> must be given for exact measures (for small to moderate spatial weights matrices); the traces must be for the same spatial weights as were used in fitting the spatial regression, and must be row-standardised</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>evalues</code></td>
<td>
<p>vector of eigenvalues of spatial weights matrix for impacts calculations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>If given, simulations are used to compute distributions for the impact measures, returned as <code>mcmc</code> objects; the objects are used for convenience but are not output by an MCMC process</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code>: tolerance (relative to largest variance) for numerical lack of positive-definiteness in the coefficient covariance matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>empirical</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code> (default FALSE): if true, the coefficients and their covariance matrix specify the empirical not population mean and covariance matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q</code></td>
<td>
<p>default NULL, else an integer number of cumulative power series impacts to calculate if <code>tr</code> is given</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The fitting implementation fits a spatial lag model:
</p>
<p style="text-align: center;"><code class="reqn">y = \rho W y + X \beta + \varepsilon</code>
</p>

<p>by using spatially lagged X variables as instruments for the spatially lagged dependent variable.
</p>


<h3>Value</h3>

<p>an object of class "Stsls" containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>coefficient estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>coefficient covariance matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sse</code></td>
<td>
<p>sum of squared errors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>model residuals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>degrees of freedom</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Luc Anselin, Gianfranco Piras and Roger Bivand</p>


<h3>References</h3>

<p>Kelejian, H.H. and I.R. Prucha (1998). A generalized spatial two
stage least squares procedure for estimating a spatial autoregressive
model with autoregressive disturbances. <em>Journal of Real Estate
Finance and Economics</em> 17, 99-121.
</p>
<p>Roger Bivand, Gianfranco Piras (2015). Comparing Implementations of Estimation Methods for Spatial Econometrics. <em>Journal of Statistical Software</em>, 63(18), 1-36. <a href="https://doi.org/10.18637/jss.v063.i18">doi:10.18637/jss.v063.i18</a>.
</p>


<h3>See Also</h3>

<p><code>lagsarlm</code></p>


<h3>Examples</h3>

<pre><code class="language-R">data(oldcol, package="spdep")
#require(spdep, quietly=TRUE)
lw &lt;- spdep::nb2listw(COL.nb)
COL.lag.eig &lt;- lagsarlm(CRIME ~ INC + HOVAL, data=COL.OLD, lw)
summary(COL.lag.eig, correlation=TRUE)
COL.lag.stsls &lt;- stsls(CRIME ~ INC + HOVAL, data=COL.OLD, lw)
(x &lt;- summary(COL.lag.stsls, correlation=TRUE))
coef(x)
W &lt;- as(lw, "CsparseMatrix")
trMatc &lt;- trW(W, type="mult")
loobj1 &lt;- impacts(COL.lag.stsls, R=200, tr=trMatc)
summary(loobj1, zstats=TRUE, short=TRUE)
ev &lt;- eigenw(lw)
loobj2 &lt;- impacts(COL.lag.stsls, R=200, evalues=ev)
summary(loobj2, zstats=TRUE, short=TRUE)
require(coda)
HPDinterval(loobj1)
COL.lag.stslsW &lt;- stsls(CRIME ~ INC + HOVAL, data=COL.OLD, lw, W2X=FALSE)
summary(COL.lag.stslsW, correlation=TRUE)
COL.lag.stslsR &lt;- stsls(CRIME ~ INC + HOVAL, data=COL.OLD, lw,
robust=TRUE, W2X=FALSE)
summary(COL.lag.stslsR, correlation=TRUE)
COL.lag.stslsRl &lt;- stsls(CRIME ~ INC + HOVAL, data=COL.OLD, lw,
robust=TRUE, legacy=TRUE, W2X=FALSE)
summary(COL.lag.stslsRl, correlation=TRUE)
data(boston, package="spData")
gp2a &lt;- stsls(log(CMEDV) ~ CRIM + ZN + INDUS + CHAS + I(NOX^2) + I(RM^2) +
  AGE + log(DIS) + log(RAD) + TAX + PTRATIO + B + log(LSTAT),
 data=boston.c, spdep::nb2listw(boston.soi))
summary(gp2a)
</code></pre>


</div>