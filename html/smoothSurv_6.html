<div class="container">

<table style="width: 100%;"><tr>
<td>derivative.expAD</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Work Function for 'smoothSurvReg', currently nowhere used
</h2>

<h3>Description</h3>

<p>Function to compute derivatives of exp(a) w.r.t. exp(d)
where d stands for a shorter vector of 'a' G-spline coefficients.
</p>


<h3>Usage</h3>

<pre><code class="language-R">derivative.expAD(knots, sdspline, last.three, all = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>

<p>A vector of G-spline knots <code class="reqn">\mu</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdspline</code></td>
<td>

<p>Standard deviation <code class="reqn">\sigma_0</code> of the basis G-spline.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>last.three</code></td>
<td>

<p>Indeces of the three 'a' G-spline coefficients which are
expressed as a function of the remaining (g-3)
'a' G-spline coefficients such that the three constraints
are satisfied.
This must be a vector of length 3 with three different numbers from
<code>1:length(mu)</code>.
Consequently, <code>a[last.three[1]] &lt;- 0</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all</code></td>
<td>

<p>If <code>TRUE</code>, matrix (g - 2) x g (there is one zero column) is returned.
If <code>FALSE</code>, matrix (g - 2) x 2 is returned.
The first row is always an intercept.
See details.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To satisfy the three constraints
</p>
<p style="text-align: center;"><code class="reqn">\sum_{j=1}^g c_j = 1,</code>
</p>

<p style="text-align: center;"><code class="reqn">\sum_{j=1}^g c_j \mu_j = 0,</code>
</p>

<p style="text-align: center;"><code class="reqn">\sum_{j=1}^g c_j \mu_j^2 = 1 - \sigma_0^2</code>
</p>

<p>imposed on the G-spline we use the following parametrization:
</p>
<p style="text-align: center;"><code class="reqn">c_j = \frac{\exp(a_j)}{\sum_{l=1}^{g}\exp(a_l)}, j = 1,\dots, g.</code>
</p>

<p>The constraints can be solved such that <code>a[last.three[1]] = 0</code> and
<code>a[last.three[2:3]]</code> are expressed as a function of
<code>a[-last.three]</code> in the following way:
</p>
<p style="text-align: center;"><code class="reqn">a_{k} = \log\Bigl\{\omega_{0,k} + \sum_{j\neq last.three}\omega_{j,k}\exp(a_j)\Bigr\},%
         \qquad k = last.three[2], last.three[3],</code>
</p>

<p>where <code class="reqn">\omega</code> coefficients are a function of knots and G-spline
standard deviation.
If we denote <code class="reqn">d</code> the vector <code>a[-last.three]</code> this function computes
derivatives of <code class="reqn">\exp(a)</code> w.r.t. <code class="reqn">\exp(d)</code> together
with the intercept term used to compute <code class="reqn">\exp(a)</code> from
<code class="reqn">\exp(d)</code>. This is actually a matrix of <code class="reqn">\omega</code>
coefficients. If we denote it as <code class="reqn">\Omega</code> then
if <code>all == TRUE</code>
</p>
<p style="text-align: center;"><code class="reqn">\exp(a) = \Omega_{1,\cdot}^T +  \Omega_{-1,\cdot}^T\exp(d)</code>
</p>

<p>and if <code>all == FALSE</code>
</p>
<p style="text-align: center;"><code class="reqn">\exp(a[last.three[2:3]]) = \Omega_{1,\cdot}^T +  \Omega_{-1,\cdot}^T\exp(d).</code>
</p>



<h3>Value</h3>

<p>A matrix with <code class="reqn">\omega</code> coefficients.
</p>


<h3>Note</h3>

<p>WARNING: This function is primarily used inside <code>smoothSurvReg</code>.
Consequently, it has very few error checks on its input arguments.
</p>


<h3>Author(s)</h3>

<p>Arnošt Komárek <a href="mailto:arnost.komarek@mff.cuni.cz">arnost.komarek@mff.cuni.cz</a>
</p>


</div>