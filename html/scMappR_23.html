<div class="container">

<table style="width: 100%;"><tr>
<td>scMappR_and_pathway_analysis</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate cellWeighted_Foldchanges, visualize, and enrich.</h2>

<h3>Description</h3>

<p>This function generates cell weighted Fold-changes (cellWeighted_Foldchange), visualizes them in a heatmap, and completes pathway enrichment of cellWeighted_Foldchanges and the bulk gene list using g:ProfileR.
</p>


<h3>Usage</h3>

<pre><code class="language-R">scMappR_and_pathway_analysis(
  count_file,
  signature_matrix,
  DEG_list,
  case_grep,
  control_grep,
  rda_path = "",
  max_proportion_change = -9,
  print_plots = T,
  plot_names = "scMappR",
  theSpecies = "human",
  output_directory = "scMappR_analysis",
  sig_matrix_size = 3000,
  drop_unknown_celltype = TRUE,
  internet = TRUE,
  up_and_downregulated = FALSE,
  gene_label_size = 0.4,
  number_genes = -9,
  toSave = FALSE,
  newGprofiler = TRUE,
  path = NULL,
  deconMethod = "DeconRNASeq",
  rareCT_filter = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>count_file</code></td>
<td>
<p>Normalized (i.e. TPM, RPKM, CPM) RNA-seq count matrix where rows are gene symbols and columns are individuals. Inputted data should be a data.frame or matrix. A character vector to a tsv file where this data can be loaded is also acceptable. Gene symbols from the count file, signature matrix, and DEG list should all match (case sensitive, gene symbol or ensembl, etc.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>signature_matrix</code></td>
<td>
<p>Signature matrix: a gene by cell-type matrix populated with the fold-change of gene expression in cell-type marker "i" vs all other cell-types. Object should be a data.frame or matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>DEG_list</code></td>
<td>
<p>An object with the first column as gene symbols within the bulk dataset (doesn't have to be in signature matrix), second column is the adjusted p-value, and the third the log2FC path to a .tsv file containing this info is also acceptable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>case_grep</code></td>
<td>
<p>A character representing what designates the "cases" (i.e. upregulated is 'case' biased) in the columns of the count file. A numeric vector of the index of "cases" is also acceptable.  Tag in the column name for cases (i.e. samples representing upregulated) OR an index of cases.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control_grep</code></td>
<td>
<p>A character representing what designates the "control" (i.e. downregulated is 'control biased) in the columns of the count file. A numeric vector of the index of "control" is also acceptable.  Tag in the column name for cases (i.e. samples representing upregulated) OR an index of cases.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rda_path</code></td>
<td>
<p>If downloaded, path to where data from scMappR_data is stored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_proportion_change</code></td>
<td>
<p>Maximum cell-type proportion change â€“ may be useful if there are many rare cell-type. Alternatively, if a cell-type is only present in one condition but not the other, it will prevent possible infinite or 0 cwFold-changes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print_plots</code></td>
<td>
<p>Whether boxplots of the estimated CT proportion for the leave-one-out method of CT deconvolution should be printed. The same name of the plots will be completed for top pathways.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_names</code></td>
<td>
<p>The prefix of plot pdf files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theSpecies</code></td>
<td>
<p>human, mouse, or a species directly compatible with gProfileR (i.e. g:ProfileR).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_directory</code></td>
<td>
<p>The name of the directory that will contain output of the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sig_matrix_size</code></td>
<td>
<p>Maximum number of genes in signature matrix for cell-type deconvolution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop_unknown_celltype</code></td>
<td>
<p>Whether or not to remove "unknown" cell-types from the signature matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>internet</code></td>
<td>
<p>Whether you have stable Wifi (T/F).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>up_and_downregulated</code></td>
<td>
<p>Whether you are additionally splitting up/downregulated genes (T/F).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gene_label_size</code></td>
<td>
<p>The size of the gene label on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number_genes</code></td>
<td>
<p>The number of genes to cut-off for pathway analysis (good with many DEGs).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>toSave</code></td>
<td>
<p>Allow scMappR to write files in the current directory (T/F).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newGprofiler</code></td>
<td>
<p>Whether to use gProfileR or gprofiler2 (T/F).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>If toSave == TRUE, path to the directory where files will be saved.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deconMethod</code></td>
<td>
<p>Which RNA-seq deconvolution method to use to estimate cell-type proporitons. Options are "WGCNA", "DCQ", or "DeconRNAseq"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rareCT_filter</code></td>
<td>
<p>option to keep cell-types rarer than 0.1 percent of the population (T/F). Setting to FALSE may lead to false-positives.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function generates cellWeighted_Foldchanges for every cell-type (see deconvolute_and_contextualize), as well as accompanying data such as cell-type proportions with the DeconRNA-seq, WGCNA, or DCQ methods.
Then, it generates heatmaps of all cellWeighted_Foldchanges, cellWeighted_Foldchanges overlapping with the signature matrix, the entire signature matrix, the cell-type preference values from the signature matrix that overlap with inputted differentially expressed genes.
Then, assuming there is available internet, it will complete gProfileR of the reordered cellWeighted_Foldchanges as well as a the ordered list of genes.
This function is a wrapper for deconvolute_and_contextualize and pathway_enrich_internal and the primary function within the package.
</p>


<h3>Value</h3>

<p>List with the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>cellWeighted_Foldchanges</code></td>
<td>
<p>Cellweighted Fold-changes for all differentially expressed genes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>paths</code></td>
<td>
<p>Enriched biological pathways for each cell-type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TFs</code></td>
<td>
<p>Enriched TFs for each cell-type.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">
data(PBMC_example)
bulk_DE_cors &lt;- PBMC_example$bulk_DE_cors
bulk_normalized &lt;- PBMC_example$bulk_normalized
odds_ratio_in &lt;- PBMC_example$odds_ratio_in
case_grep &lt;- "_female"
control_grep &lt;- "_male"
max_proportion_change &lt;- 10
print_plots &lt;- FALSE
theSpecies &lt;- "human"
toOut &lt;- scMappR_and_pathway_analysis(count_file = bulk_normalized, 
                                      signature_matrix = odds_ratio_in, 
                                      DEG_list = bulk_DE_cors, case_grep = case_grep,
                                      control_grep = control_grep, rda_path = "", 
                                      max_proportion_change = 10, print_plots = TRUE, 
                                      plot_names = "tst1", theSpecies = "human", 
                                      output_directory = "tester",
                                      sig_matrix_size = 3000,
                                      up_and_downregulated = FALSE, 
                                      internet = FALSE)



</code></pre>


</div>