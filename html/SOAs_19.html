<div class="container">

<table style="width: 100%;"><tr>
<td>Spattern</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>functions to evaluate stratification properties of (O)SOAs and GSOAs</h2>

<h3>Description</h3>

<p><code>soacheck2D</code> and <code>soacheck3D</code> evaluate 2D and 3D projections,
<code>Spattern</code> calculates the stratification pattern by Tian and Xu (2022),
and <code>dim_wt_tab</code> extracts and formats the <code>dim_wt_tab</code> attribute of <code>Spattern</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Spattern(D, s, maxwt = 4, maxdim = NULL, verbose = FALSE, ...)

dim_wt_tab(pat, dimlim = NULL, wtlim = NULL, ...)

soacheck2D(D, s = 3, el = 3, t = 3, verbose = FALSE)

soacheck3D(D, s = 3, el = 3, t = 3, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>a matrix with factor levels or an object of class <code>SOA</code> or a
data.frame object with numeric columns.<br>
Functions <code>soacheck2D</code> and <code>soacheck3D</code> require levels
that are consecutively numbered (starting with 0 or 1).<br>
Function <code>Spattern</code> also works, if all columns of <code>D</code>
have the same number of unique numeric values; the function will code them using
power contrasts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p>the prime or prime power according to which the array is checked</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxwt</code></td>
<td>
<p>maximum weight to be considered for the pattern (default: 4; see Details);<br>
if the specified limit is larger than <code>maxdim*el</code>,
it is reduced accordingly (where <code>el</code> is such that <code>s^el</code> is the number of levels)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxdim</code></td>
<td>
<p>maximum dimension to be considered for the pattern (default: <code>NULL</code> implies that <code>maxdim</code>=<code>min(maxwt, ncol(D))</code>;
see also Details);<br>
if the specified limit is larger than <code>m=ncol(D)</code>, it is reduced to <code>m</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical; if <code>TRUE</code>, additional information is printed
(for <code>Spattern</code>, status information during run time; for the <code>SOAcheck...</code> functions, confounded pair or triple projections with A2 or A3, respectively, or table of correlations)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>currently not used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pat</code></td>
<td>
<p>an object of class <code>Spattern</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dimlim</code></td>
<td>
<p>integer; limits the returned dimension rows to the
rows from 1 up to <code>dimlim</code>; the bottom margin continues to include all
dimensions that were used in calculating <code>pat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wtlim</code></td>
<td>
<p>integer; limits the returned weight columns to the columns from
1 up to <code>wtlim</code>; the right margin continues to include all weights
that were used in calculating <code>pat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>el</code></td>
<td>
<p>the exponent so that the number of levels of the array is <code>s^el</code>
(if <code>s</code> is not NULL)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>
<p>the strength for which to look (2, 3, or 4), equal to the sum of the
exponents in the stratification dimensions; for example, <code>soacheck2D</code> considers <br>
sxs 2D projections with <code>t=2</code>, <br>
s^2xs and sxs^2 projections with <code>t=3</code>, <br>
and s^3xs, s^2xs^2 and sxs^3 projections with <code>t=4</code>.<br>
If <code>t=4</code> and <code>el=2</code>, property gamma (s^3 x s and s x s^3) is obviously
impossible and will not be part of the checks.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function <code>Spattern</code> calculates the stratification pattern or S pattern
as proposed in Tian and Xu (2022) (under the name space-filling pattern);
the details and the implementation in this function are described in
Groemping (2023b); the function uses the full-factorial-based Helmert contrasts.<br>
Position <code>j</code> in the S pattern shows the imbalance when considering <code>s^j</code>
strata. <code>j</code> is also called the (total) weight. <code>j=1</code> can occur for an
individual column only. <code>j=2</code> can be obtained either for an
<code>s^2</code> level version of an individual column or for the crossing of
<code>s^1</code> level versions of two columns, and so forth.
</p>
<p>Obtaining the entire S pattern
can be computationally demanding. The arguments <code>maxwt</code> and
<code>maxdim</code> limit the effort (choose <code>NULL</code> for no limit):<br><code>maxwt</code> gives an upper limit for the weight <code>j</code> of the previous paragraph;
if <code>NULL</code>, <code>maxwt</code> is set to <code>maxdim*el</code>.<br><code>maxdim</code> limits the number of columns that are considered in combination.<br>
When using a non-null <code>maxdim</code>, pattern entries for <code>j</code> larger than <code>maxdim</code> can be smaller
than if one would not have limited the dimension. Otherwise, dimensionality is unlimited,
which is equivalent to specifying <code>maxdim</code> as the minimum of <code>maxwt</code> and <code>ncol(D)</code>.
</p>
<p><code>Spattern</code> with <code>maxdim=2</code> and <code>maxwt=t</code> can be used as an alternative
to <code>soacheck2D</code>,<br>
and analogously <code>Spattern</code> with <code>maxdim=2</code> and <code>maxwt=t</code> can be used as an alternative
to <code>soacheck3D</code>.
</p>
<p>An <code>Spattern</code> object
object can be post-processed with function <code>dim_wt_tab</code>. That function splits
the S pattern into contributions from effect column groups of different dimensions,
arranged with a row for each dimension and a column for each weight.
If <code>Spattern</code> was called with <code>maxdim=NULL</code> and
<code>maxwt=NULL</code>, the output object shows the GWLP in the right margin and the
S pattern in the bottom margin. If <code>Spattern</code> was called with relevant restrictions
on dimensions (<code>maxdim</code>, default 4) and/or weights (<code>maxwt</code>, default 4),
sums in the margins can be smaller than they would be for unconstrained dimension and
weights.
</p>
<p>Functions <code>soacheck2D</code> and <code>soacheck3D</code> were available before
function <code>Spattern</code>; many of their use cases can now be handled with <code>Spattern</code>
instead. The functions are often fast to yield a <code>FALSE</code> outcome,
but can be very slow to yield a <code>TRUE</code> outcome for larger designs.<br>
The functions inspect 2D and 3D
stratification, respectively. Each column must have <code>s^el</code> levels.
<code>t</code> specifies the degree of balance the functions are asked to look for.
</p>
<p>Function <code>soacheck2D</code>,
</p>

<ul>
<li>
<p> with el=t=2, looks for strength 2 conditions (s^2 levels, sxs balance),
</p>
</li>
<li>
<p> with el=2, t=3, looks for strength 2+ / 3- conditions (s^2 levels, s^2xs balance),
</p>
</li>
<li>
<p> with el=t=3, looks for strength 2* / 3 conditions (s^3 levels, s^2xs balance).
</p>
</li>
<li>
<p> with el=2, t=4, looks for the enhanced strength 2+ / 3-  property alpha (s^2 levels, s^2xs^2 balance).
</p>
</li>
<li>
<p> and with el=3, t=4, looks for strength 3+ / 4 conditions (s^3 levels, s^3xs and s^2xs^2 balance).
</p>
</li>
</ul>
<p>Function <code>soacheck3D</code>,
</p>

<ul>
<li>
<p> with el=2, t=3, looks for strength 3- conditions (s^2 levels, sxsxs balance),
</p>
</li>
<li>
<p> with el=t=3, looks for strength 3 conditions (s^3 levels, sxsxs balance),
</p>
</li>
<li>
<p> and with el=3, t=4, looks for strength 3+ / 4 conditions (s^3 levels, s^2xsxs balance).
</p>
</li>
</ul>
<p>If <code>verbose=TRUE</code>, the functions print the pairs or triples that violate
the projection requirements for 2D or 3D.
</p>


<h3>Value</h3>

<p>Function <code>Spattern</code> returns an object of class <code>Spattern</code>
that is a named vector with attributes:<br>
The attribute <code>call</code> holds the function call
(and thus documents, e.g., limits set on dimension and/or weight).<br>
The attribute <code>dim_wt_tab</code> holds a table of contributions
split out by dimension (rows) and weights (columns), which has class
<code>dim_wt_tab</code> and the further attribute <code>Spattern-class</code>.<br>
Function <code>dim_wt_tab</code> returns the <code>dim_wt_tab</code> attribute of
an object of class <code>Spattern</code>; note that the object contains NA values
for combinations of dimension and weight that cannot occur.
</p>
<p>Function <code>dim_wt_tab</code> postprocesses an <code>Spattern</code> object
and produces a table that holds the S pattern entries
separated by the dimension of the contributing effect column group (rows)
and the weight of the effect column micro group (columns). The margin shows row and
column sums (see Details section for caveats).
</p>


<h3>References</h3>

<p>For full detail, see <code>SOAs-package</code>.
</p>
<p>Groemping (2023a)<br>
Groemping (2023b)<br>
He and Tang (2013)<br>
Shi and Tang (2020)<br>
Tian and Xu (2022)
</p>


<h3>Examples</h3>

<pre><code class="language-R">nullcase &lt;- matrix(0:7, nrow=8, ncol=4)
soacheck2D(nullcase, s=2)
soacheck3D(nullcase, s=2)
Spattern(nullcase, s=2)
Spattern(nullcase, s=2, maxdim=2)
  ## the non-zero entry at position 2 indicates that
  ## soacheck2D does not comply with t=2
(Spat &lt;- Spattern(nullcase, s=2, maxwt=4))
  ## comparison to maxdim=2 indicates that
  ## the contribution to S_4 from dimensions
  ## larger than 2 is 1
## postprocessing Spat
dim_wt_tab(Spat)

## Shi and Tang strength 3+ construction in 7 8-level factors for 32 runs
D &lt;- SOAs_8level(32, optimize=FALSE)

## check for strength 3+ (default el=3 is OK)
## 2D check
soacheck2D(D, s=2, t=4)
## 3D check
soacheck3D(D, s=2, t=4)
## using Spattern (much faster for many columns)
  ## does not have strength 4
  Spattern(D, s=2)
  ## but complies with strength 4 for dim up to 3
  Spattern(D, s=2, maxwt=4, maxdim=3)
  ## inspect more detail
  Spat &lt;- (Spattern(D, s = 2, maxwt=5))
  dim_wt_tab(Spat)
</code></pre>


</div>