<div class="container">

<table style="width: 100%;"><tr>
<td>draft_report</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Automatically Draft a Quarto Report</h2>

<h3>Description</h3>

<p>The <code>draft_report()</code> function takes a raw dataset (<code>data</code>-argument) and the
output from the <code>refine_chapter_overview()</code>-function as the
<code>chapter_structure</code>-argument and outputs a set of pre-populated qmd-files in the
specified <code>path</code>-folder. You can edit, render, and
ultimately publish these as usual with Quarto features in RStudio. See also
<code>{saros.post}</code>-package for post-processing tools.
</p>


<h3>Usage</h3>

<pre><code class="language-R">draft_report(
  data,
  chapter_structure,
  ...,
  path = tempdir(),
  title = "Report",
  authors = NULL,
  authors_col = "author",
  chapter_yaml_file = NULL,
  chapter_qmd_start_section_filepath = NULL,
  chapter_qmd_end_section_filepath = NULL,
  index_filename = "index",
  index_yaml_file = NULL,
  index_qmd_start_section_filepath = NULL,
  index_qmd_end_section_filepath = NULL,
  report_filename = "0_report",
  report_yaml_file = NULL,
  report_qmd_start_section_filepath = NULL,
  report_qmd_end_section_filepath = NULL,
  ignore_heading_for_group = c(".template_name", ".variable_type_dep",
    ".variable_type_indep", ".variable_group_dep", "chapter"),
  replace_heading_for_group = c(.variable_label_suffix_dep = ".variable_name_dep",
    .variable_label_suffix_indep = ".variable_name_indep"),
  prefix_heading_for_group = NULL,
  suffix_heading_for_group = NULL,
  require_common_categories = TRUE,
  combined_report = TRUE,
  attach_chapter_dataset = TRUE,
  auxiliary_variables = NULL,
  serialized_format = c("rds", "qs"),
  max_path_warning_threshold = 260,
  log_file = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p><em>Survey data</em>
</p>
<p><code style="white-space: pre;">⁠obj:&lt;data.frame&gt;|obj:&lt;tbl_df&gt;|obj:&lt;srvyr&gt;⁠</code> // Required
</p>
<p>A data frame (or a srvyr-object) with the columns specified in the
chapter_structure 'dep', etc columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chapter_structure</code></td>
<td>
<p><em>What goes into each chapter and sub-chapter</em>
</p>
<p><code style="white-space: pre;">⁠obj:&lt;data.frame&gt;|obj:&lt;tbl_df&gt;⁠</code> // Required
</p>
<p>Data frame (or tibble, possibly grouped). One row per chapter. Should
contain the columns 'chapter' and 'dep', Optionally 'indep' (independent
variables) and other informative columns as needed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p><em>Dynamic dots</em>
</p>
<p>&lt;<a href="https://rlang.r-lib.org/reference/dyn-dots.html"><code>dynamic-dots</code></a>&gt;
</p>
<p>Arguments forwarded to the corresponding functions that create the elements.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p><em>Output path</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>tempdir()</code> (<code>optional</code>)
</p>
<p>Path to save all output. Defaults to a temporary directory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p><em>Title of report</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>Added automatically to YAML-header of index.qmd and report.qmd-files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>authors</code></td>
<td>
<p><em>Authors of entire report</em>
</p>
<p><code style="white-space: pre;">⁠vector&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>If NULL, infers from <code>chapter_structure[[authors_col]]</code>, and collates for entire report.
If multiple authors per chapter, separate with semicolon. Ensure consistency.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>authors_col</code></td>
<td>
<p><em>Column name for author</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>"author"</code> (<code>optional</code>)
</p>
<p>Only used if it exists. Multiple authors are separated by semicolon (and optionally with a subsequent space).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chapter_yaml_file</code></td>
<td>
<p><em>Path to YAML-file to insert into each chapter qmd-file</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>Path to file used to insert header YAML, in each chapter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chapter_qmd_start_section_filepath, chapter_qmd_end_section_filepath, index_qmd_start_section_filepath, index_qmd_end_section_filepath, report_qmd_start_section_filepath, report_qmd_end_section_filepath, </code></td>
<td>
<p><em>Path to qmd-bit for start/end of each qmd</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>Path to qmd-snippet placed before/after body of all chapter/index/report qmd-files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index_filename</code></td>
<td>
<p><em>Index filename</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>"index.qmd"</code> (<code>optional</code>)
</p>
<p>The name of the main index Quarto file used as landing
page for each report. Will link to a PDF (report.qmd) which collects all chapters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index_yaml_file, report_yaml_file</code></td>
<td>
<p><em>Path to YAML-file to insert into index.qmd and 0_report.qmd respectively</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>Path to file used to insert header YAML, in index and report files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report_filename</code></td>
<td>
<p><em>Report filename</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;character&gt;⁠</code> // <em>default:</em> <code>"0_report.qmd"</code> (<code>optional</code>)
</p>
<p>The name of the main report QMD-file used when compiling a complete report
collecting all chapters in its folder (except itself).
If provided, will be linked to in the index.
If NULL, will generate a filename based on the report title, prefixed with "0_".
To turn off, set <code>pdf=FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore_heading_for_group</code></td>
<td>
<p><em>Ignore heading for group</em>
</p>
<p><code style="white-space: pre;">⁠vector&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>Type of refined chapter_structure data for which to suppress the heading
in the report output. Typically variable_name_dep, variable_name_indep, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replace_heading_for_group</code></td>
<td>
<p><em>Replacing heading for group</em>
</p>
<p><code style="white-space: pre;">⁠named vector&lt;character&gt;⁠</code> // <em>default:</em> <code>c(".variable_label_suffix_dep" = ".variable_name_dep")</code>
</p>
<p>Occasionally, one needs to replace the heading with another piece of information
in the refined chapter_structure. For instance, one may want to organize output
by variable_name_indep, but to display the variable_label_indep instead. Use
the name for the replacement and the value for the original.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix_heading_for_group, suffix_heading_for_group</code></td>
<td>
<p><em>Prefix and suffix headings</em>
</p>
<p><code style="white-space: pre;">⁠vector&lt;named character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>Names are heading_groups, values are the prefixes and suffixes. Note
that prefixes should end with a <code style="white-space: pre;">⁠\n⁠</code> as headings must begin on a new line.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>require_common_categories</code></td>
<td>
<p><em>Check common categories</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;logical&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>Whether to check if all items share common categories.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>combined_report</code></td>
<td>
<p><em>Create a combined report?</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;logical&gt;⁠</code> // <em>default:</em> <code>FALSE</code> (<code>optional</code>)
</p>
<p>Whether to create a qmd file that merges all chapters into
a combined report.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>attach_chapter_dataset</code></td>
<td>
<p><em>Toggle inclusion of chapter-specific datasets in qmd-files</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;logical&gt;⁠</code> // <em>default:</em> <code>FALSE</code>
</p>
<p>Whether to save in each chapter folder an 'Rds'-file with the
chapter-specific dataset, and load it at the top of each QMD-file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>auxiliary_variables</code></td>
<td>
<p><em>Auxiliary variables to be included in datasets</em>
</p>
<p><code style="white-space: pre;">⁠vector&lt;character&gt;⁠</code> // <em>default:</em> <code>NULL</code> (<code>optional</code>)
</p>
<p>Column names in <code>data</code> that should always be included in datasets for
chapter qmd-files, if <code>attach_chapter_dataset=TRUE</code>. Not publicly available.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>serialized_format</code></td>
<td>
<p><em>Serialized format</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;string&gt;⁠</code> // <em>default:</em> <code>"rds"</code>
</p>
<p>Format for serialized data when storing chapter dataset.
One of <code>"rds"</code> (default), <code>"qs"</code> or <code>"fst"</code>.
The latter two requires the respective packages to be installed.
<code>"qs"</code> is usually the fastest and most space efficient, but sets package
dependencies on the report project.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_path_warning_threshold</code></td>
<td>
<p><em>Maximum number of characters in paths warning</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;integer&gt;⁠</code> // <em>default:</em> <code>260</code> (<code>optional</code>)
</p>
<p>Microsoft has set an absolute limit of 260 characters for its Sharepoint/OneDrive
file paths. This will mean that files with cache (hash suffixes are added) will
quickly breach this limit. When set, a warning will be returned if files are found
to be longer than this threshold. Also note that spaces count as three characters
due to its URL-conversion: %20. To avoid test, set to Inf</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log_file</code></td>
<td>
<p><em>Path to log file</em>
</p>
<p><code style="white-space: pre;">⁠scalar&lt;string&gt;⁠</code> // <em>default:</em> <code>"_log.txt"</code> (<code>optional</code>)
</p>
<p>Path to log file. Set to NULL to disable logging.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note that saros treats data as they are stored: numeric,
integer, factor, ordinal, character, and datetime. Currently, only
factor/ordinal and character are implemented.
</p>


<h3>Value</h3>

<p>The <code>path</code>-argument.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
ex_survey_ch_structure &lt;-
  refine_chapter_overview(
    chapter_overview = ex_survey_ch_overview,
    data = ex_survey
  )
index_filepath &lt;-
  draft_report(
    chapter_structure = ex_survey_ch_structure,
    data = ex_survey,
    path = tempdir()
  )

</code></pre>


</div>