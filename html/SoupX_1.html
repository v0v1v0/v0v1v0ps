<div class="container">

<table style="width: 100%;"><tr>
<td>adjustCounts</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Remove background contamination from count matrix</h2>

<h3>Description</h3>

<p>After the level of background contamination has been estimated or specified for a channel, calculate the resulting corrected count matrix with background contamination removed.
</p>


<h3>Usage</h3>

<pre><code class="language-R">adjustCounts(
  sc,
  clusters = NULL,
  method = c("subtraction", "soupOnly", "multinomial"),
  roundToInt = FALSE,
  verbose = 1,
  tol = 0.001,
  pCut = 0.01,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sc</code></td>
<td>
<p>A SoupChannel object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clusters</code></td>
<td>
<p>A vector of cluster IDs, named by cellIDs.  If NULL clusters auto-loaded from <code>sc</code>.  If FALSE, no clusters are used.  See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Method to use for correction.  See details.  One of 'multinomial', 'soupOnly', or 'subtraction'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roundToInt</code></td>
<td>
<p>Should the resulting matrix be rounded to integers?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Integer giving level of verbosity.  0 = silence, 1 = Basic information, 2 = Very chatty, 3 = Debug.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>Allowed deviation from expected number of soup counts.  Don't change this.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pCut</code></td>
<td>
<p>The p-value cut-off used when <code>method='soupOnly'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Passed to expandClusters.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This essentially subtracts off the mean expected background counts for each gene, then redistributes any "unused" counts.  A count is unused if its subtraction has no effect.  For example, subtracting a count from a gene that has zero counts to begin with.
</p>
<p>As expression data is highly sparse at the single cell level, it is highly recommended that clustering information be provided to allow the subtraction method to share information between cells.  Without grouping cells into clusters, it is difficult (and usually impossible) to tell the difference between a count of 1 due to background contamination and a count of 1 due to endogenous expression.  This ambiguity is removed at the cluster level where counts can be aggregated across cells.  This information can then be propagated back to the individual cell level to provide a more accurate removal of contaminating counts.
</p>
<p>To provide clustering information, either set clustering on the SoupChannel object with <code>setClusters</code> or explicitly passing the <code>clusters</code> parameter.  
</p>
<p>If <code>roundToInt=TRUE</code>, this function will round the result to integers.  That is, it will take the floor of the connected value and then round back up with probability equal to the fractional part of the number.
</p>
<p>The <code>method</code> parameter controls how the removal of counts in performed.  This should almost always be left at the default ('subtraction'), which iteratively subtracts counts from all genes as described above.  The 'soupOnly' method will use a p-value based estimation procedure to identify those genes that can be confidently identified as having endogenous expression and removes everything else (described in greater detail below).  Because this method either removes all or none of the expression for a gene in a cell, the correction procedure is much faster.  Finally, the 'multinomial' method explicitly maximises the multinomial likelihood for each cell.  This method gives essentially identical results as 'subtraction' and is considerably slower.
</p>
<p>In greater detail, the 'soupOnly' method is done by sorting genes within each cell by their p-value under the null of the expected soup fraction using a Poisson model.  So that genes that definitely do have a endogenous contribution are at the end of the list with p=0.  Those genes for which there is poor evidence of endogenous cell expression are removed, until we have removed approximately nUMIs*rho molecules.  The cut-off to prevent removal of genes above nUMIs*rho in each cell is achieved by calculating a separate p-value for the total number of counts removed to exceed nUMIs*rho, again using a Poisson model.  The two p-values are combined using Fisher's method and the cut-off is applied to the resulting combined p-value calculated using a chi-squared distribution with 4 degrees of freedom.
</p>


<h3>Value</h3>

<p>A modified version of the table of counts, with background contamination removed.
</p>


<h3>Examples</h3>

<pre><code class="language-R">out = adjustCounts(scToy)
#Return integer counts only
out = adjustCounts(scToy,roundToInt=TRUE)
</code></pre>


</div>