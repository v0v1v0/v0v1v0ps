<div class="container">

<table style="width: 100%;"><tr>
<td>fetchSoilGrids</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Get SoilGrids 2.0 Property Estimates for Points or Spatial Extent</h2>

<h3>Description</h3>

<p>This function obtains <a href="https://soilgrids.org">SoilGrids 2.0</a> properties information (250m raster resolution) given a <code>data.frame</code> containing site IDs, latitudes and longitudes, or a spatial extent (see <code>grid=TRUE</code> argument).
</p>


<h3>Usage</h3>

<pre><code class="language-R">fetchSoilGrids(
  x,
  loc.names = c("id", "lat", "lon"),
  depth_intervals = c("0-5", "5-15", "15-30", "30-60", "60-100", "100-200"),
  variables = c("bdod", "cec", "cfvo", "clay", "nitrogen", "phh2o", "sand", "silt",
    "soc", "ocd", "wv0010", "wv0033", "wv1500"),
  grid = FALSE,
  filename = NULL,
  overwrite = TRUE,
  target_resolution = c(250, 250),
  summary_type = c("Q0.05", "Q0.5", "Q0.95", "mean"),
  endpoint = ifelse(!grid, "https://rest.isric.org/soilgrids/v2.0/properties/query",
    "https://files.isric.org/soilgrids/latest/data/"),
  ...,
  verbose = FALSE,
  progress = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>data.frame</code> containing 3 columns referring to site ID, latitude and longitude. Or a spatial (sf, terra) object for which a bounding box can be calculated when <code>grid=TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loc.names</code></td>
<td>
<p>Optional: Column names referring to site ID, latitude and longitude. Default: <code>c("id", "lat", "lon")</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>depth_intervals</code></td>
<td>
<p>Default: <code>"0-5"</code>, <code>"5-15"</code>, <code>"15-30"</code>, <code>"30-60"</code>, <code>"60-100"</code>, <code>"100-200"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>Default: <code>"bdod"</code>, <code>"cec"</code>, <code>"cfvo"</code>, <code>"clay"</code>, <code>"nitrogen"</code>, <code>"phh2o"</code>, <code>"sand"</code>, <code>"silt"</code>, <code>"soc"</code>, <code>"ocd"</code>, <code>"wv0010"</code>, <code>"wv0033"</code>, <code>"wv1500"</code>. Optionally <code>"ocs"</code> (only for 0 to 30 cm interval).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid</code></td>
<td>
<p>Download subset of SoilGrids Cloud Optimized GeoTIFF? Default: <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>Only used when <code>grid=TRUE</code>. If <code>NULL</code> defaults to an in-memory raster, or temporary file if result does not fit in memory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>Only used when <code>grid=TRUE</code>. Default: <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_resolution</code></td>
<td>
<p>Only used when <code>grid=TRUE</code>. Default: <code>c(250, 250)</code> (250m x 250m pixels)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>summary_type</code></td>
<td>
<p>Only used when <code>grid=TRUE</code>. One or more of <code>"Q0.05"</code>, <code>"Q0.5"</code>, <code>"Q0.95"</code>, <code>"mean"</code>; these are summary statistics that
correspond to 5th, 50th, 95th percentiles, and mean value for selected <code>variables</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>endpoint</code></td>
<td>
<p>Optional: custom API endpoint. Default: <code>"https://rest.isric.org/soilgrids/v2.0/properties/query"</code> when <code>grid=FALSE</code>; <code>"https://files.isric.org/soilgrids/latest/data/"</code> when <code>grid=TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to <code>terra::writeRaster()</code> when <code>grid=TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Print messages? Default: <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>logical, give progress when iterating over multiple requests; Default: <code>FALSE</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>SoilGrids API and maps return values as whole (integer) numbers to minimize the storage space used. These values have conversion factors applied by <code>fetchSoilGrids()</code> to produce conventional units shown in the table below (see Details).
</p>


<h4>Properties</h4>


<table>
<tr>
<td style="text-align: left;">
   Name </td>
<td style="text-align: left;"> Description </td>
<td style="text-align: left;"> Mapped units </td>
<td style="text-align: right;"> Conversion factor </td>
<td style="text-align: left;"> Conventional units </td>
</tr>
<tr>
<td style="text-align: left;">
   bdod </td>
<td style="text-align: left;"> Bulk density of the fine earth fraction </td>
<td style="text-align: left;"> cg/cm^3 </td>
<td style="text-align: right;"> 100 </td>
<td style="text-align: left;"> kg/dm^3 </td>
</tr>
<tr>
<td style="text-align: left;">
   cec </td>
<td style="text-align: left;"> Cation Exchange Capacity of the soil </td>
<td style="text-align: left;"> mmol(c)/kg </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> cmol(c)/kg </td>
</tr>
<tr>
<td style="text-align: left;">
   cfvo </td>
<td style="text-align: left;"> Volumetric fraction of coarse fragments (&gt; 2 mm) </td>
<td style="text-align: left;"> cm^3/dm^3 (vol per mil) </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> cm^3/100cm^3 (vol%) </td>
</tr>
<tr>
<td style="text-align: left;">
   clay </td>
<td style="text-align: left;"> Proportion of clay particles (&lt; 0.002 mm) in the fine earth fraction </td>
<td style="text-align: left;"> g/kg </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> g/100g (%) </td>
</tr>
<tr>
<td style="text-align: left;">
   nitrogen </td>
<td style="text-align: left;"> Total nitrogen (N) </td>
<td style="text-align: left;"> cg/kg </td>
<td style="text-align: right;"> 100 </td>
<td style="text-align: left;"> g/kg </td>
</tr>
<tr>
<td style="text-align: left;">
   phh2o </td>
<td style="text-align: left;"> Soil pH </td>
<td style="text-align: left;"> pH*10 </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> pH </td>
</tr>
<tr>
<td style="text-align: left;">
   sand </td>
<td style="text-align: left;"> Proportion of sand particles (&gt; 0.05 mm) in the fine earth fraction </td>
<td style="text-align: left;"> g/kg </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> g/100g (%) </td>
</tr>
<tr>
<td style="text-align: left;">
   silt </td>
<td style="text-align: left;"> Proportion of silt particles (&gt;= 0.002 mm and &lt;= 0.05 mm) in the fine earth fraction </td>
<td style="text-align: left;"> g/kg </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> g/100g (%) </td>
</tr>
<tr>
<td style="text-align: left;">
   soc </td>
<td style="text-align: left;"> Soil organic carbon content in the fine earth fraction </td>
<td style="text-align: left;"> dg/kg </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> g/kg </td>
</tr>
<tr>
<td style="text-align: left;">
   ocd </td>
<td style="text-align: left;"> Organic carbon density </td>
<td style="text-align: left;"> hg/m^3 </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> kg/m^3 </td>
</tr>
<tr>
<td style="text-align: left;">
   ocs </td>
<td style="text-align: left;"> Organic carbon stocks (0-30cm depth interval only) </td>
<td style="text-align: left;"> t/ha </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> kg/m^2 </td>
</tr>
<tr>
<td style="text-align: left;">
   wv0010 </td>
<td style="text-align: left;"> Volumetric Water Content at 10kPa </td>
<td style="text-align: left;"> 0.1 v% or 1 mm/m </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> volume (%) </td>
</tr>
<tr>
<td style="text-align: left;">
   wv0033 </td>
<td style="text-align: left;"> Volumetric Water Content at 33kPa </td>
<td style="text-align: left;"> 0.1 v% or 1 mm/m </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> volume (%) </td>
</tr>
<tr>
<td style="text-align: left;">
   wv1500 </td>
<td style="text-align: left;"> Volumetric Water Content at 1500kPa </td>
<td style="text-align: left;"> 0.1 v% or 1 mm/m </td>
<td style="text-align: right;"> 10 </td>
<td style="text-align: left;"> volume (%) </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>SoilGrids predictions are made for the six standard depth intervals specified in the GlobalSoilMap IUSS working group and its specifications. The default depth
intervals returned are (in centimeters): <code>"0-5"</code>, <code>"5-15"</code>, <code>"15-30"</code>, <code>"30-60"</code>, <code>"60-100"</code>, <code>"100-200"</code> for the properties <code>"bdod"</code>, <code>"cec"</code>, <code>"cfvo"</code>,
<code>"clay"</code>, <code>"nitrogen"</code>, <code>"phh2o"</code>, <code>"sand"</code>, <code>"silt"</code>, <code>"soc"</code>, <code>"ocd"</code>, <code>"wv0010"</code>, <code>"wv0033"</code>, <code>"wv1500"</code>â€“each with 5th, 50th, 95th, mean and uncertainty values. Soil organic carbon stocks (0-30cm) (<code>variables="ocs"</code>) are returned only for <code>depth_intervals="0-30"</code>. The uncertainty values are the ratio
between the inter-quantile range (90% prediction interval width) and the median : <code>(Q0.95-Q0.05)/Q0.50.</code> All values are converted from "mapped" to "conventional"
based on above table conversion factors. Point data requests are made through <code>"properties/query"</code> endpoint of the <a href="https://www.isric.org/explore/soilgrids/faq-soilgrids">SoilGrids v2.0 REST API</a>.
Please check ISRIC's data policy, disclaimer and citation: <a href="https://www.isric.org/about/data-policy">https://www.isric.org/about/data-policy</a>.
</p>
<p>Find out more information about the SoilGrids and GlobalSoilMap products here:
</p>

<ul>
<li> <p><a href="https://www.isric.org/explore/soilgrids/faq-soilgrids">https://www.isric.org/explore/soilgrids/faq-soilgrids</a>
</p>
</li>
<li> <p><a href="https://www.isric.org/sites/default/files/GlobalSoilMap_specifications_december_2015_2.pdf">https://www.isric.org/sites/default/files/GlobalSoilMap_specifications_december_2015_2.pdf</a>
</p>
</li>
</ul>
<h3>Value</h3>

<p>A <em>SoilProfileCollection</em> or <em>SpatRaster</em> when <code>grid=TRUE</code>. Returns <code>try-error</code> if all requests fail. Any error messages resulting from parsing will be echoed when <code>verbose=TRUE</code>.
</p>


<h3>Author(s)</h3>

<p>Andrew G. Brown
</p>


<h3>References</h3>


<ul>
<li> <p><strong>Common soil chemical and physical properties:</strong>
Poggio, L., de Sousa, L. M., Batjes, N. H., Heuvelink, G. B. M., Kempen, B., Ribeiro, E., and Rossiter, D.: SoilGrids 2.0: producing soil information for the globe with quantified spatial uncertainty, SOIL, 7, 217â€“240, 2021. DOI: <a href="https://doi.org/10.5194/soil-7-217-2021">doi:10.5194/soil-7-217-2021</a>
</p>
</li>
<li> <p><strong>Soil water content at different pressure heads:</strong>
Turek, M.E.,  Poggio, L., Batjes, N. H., Armindo, R. A.,  de Jong van Lier, Q.,  de Sousa, L.M.,  Heuvelink, G. B. M. : Global mapping of volumetric water retention at 100, 330 and 15000 cm suction using the WoSIS database, International Soil and Water Conservation Research, 11-2, 225-239, 2023. DOI: <a href="https://doi.org/10.1016/j.iswcr.2022.08.001">doi:10.1016/j.iswcr.2022.08.001</a>
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
  library(aqp)
  
  your.points &lt;- data.frame(id  = c("A", "B"), 
                           lat = c(37.9, 38.1), 
                           lon = c(-120.3, -121.5), 
                           stringsAsFactors = FALSE)
  x &lt;- try(fetchSoilGrids(your.points))
 
  if (!inherits(x, 'try-error'))
   aqp::plotSPC(x, name = NA, color = "socQ50")
 
  # organic carbon stocks use 0-30cm interval
  y &lt;- try(fetchSoilGrids(your.points[1, ], 
                          depth_interval = c("0-5", "0-30", "5-15", "15-30"),
                          variables = c("soc", "bdod", "ocd", "ocs")))
                          
  # extract horizons from a SoilProfileCollection where horizon 2 overlaps 1, 3, and 4
  h &lt;- aqp::horizons(y)
  
  # "ocs" (organic carbon stock 0-30cm interval)
  h[2, ]
  
  h$thickness_meters &lt;- ((h$hzdepb - h$hzdept) / 100)

  # estimate "ocs" from modeled organic carbon and bulk density in 0-5, 5-15, 15-30 intervals
  #  (sum the product of soc, bdod, and thickness in meters)
  #  (1 gram per cubic decimeter = 1 kilogram per cubic meter)
  sum(h$socmean * h$bdodmean * h$thickness_meters, na.rm = TRUE)
  
  # estimate "ocs" from modeled organic carbon density in 0-5, 5-15, 15-30 intervals
  #  (sum the product of "ocd" and thickness in meters)
  sum(h$ocdmean * h$thickness_meters, na.rm = TRUE)
 

## End(Not run)

</code></pre>


</div>