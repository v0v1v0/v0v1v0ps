<div class="container">

<table style="width: 100%;"><tr>
<td>RGB Space Management</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Manage RGB Spaces</h2>

<h3>Description</h3>

<p>Install/uninstall RGB spaces in a dictionary. 
The dictionary comes with 8 RGB spaces pre-installed.
To query the dictionary, use <code>getRGB()</code> and <code>summaryRGB()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">installRGB( space, scene, display=NULL, OETF=NULL, EOTF=NULL, OOTF=NULL, overwrite=FALSE )
uninstallRGB( space )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>space</code></td>
<td>
<p>name of the RGB space to install or uninstall or query.
After the RGB space is installed,
the string <code>space</code> can be used in the conversion functions,
e.g. <code>RGBfromXYZ()</code> and <code>XYZfromRGB()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scene</code></td>
<td>

<p>the specification of the scene primaries and whitepoint.
There are many options here.
The 1st option is a 4x2 matrix with the CIE xy chromaticities of R,G,B,W in the rows, in that order.
The 2nd option is a list with 2 items: the primaries data and the whitepoint data.
These are described in the section <b>Primaries and Whitepoint Details</b> below.
If <code>scene</code> is <code>NULL</code>, it will duplicate the data from argument <code>display</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>display</code></td>
<td>

<p>the specification of the display primaries and whitepoint.
The options are the same as for argument <code>scene</code>.
If this is <code>NULL</code> (the default), the function will first look at the metadata of the transfer functions.
These built-in transfer functions
- <code>general.OOTF()</code> and <code>general.PODT()</code>  - 
already have this metadata assigned.
If the metadata is not found, it will duplicate the data from argument <code>scene</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OETF</code></td>
<td>

<p>a <code>TransferFunction</code> of dimension 1 or 3.
<br><code>OETF</code> can also be a positive number <code class="reqn">\gamma</code>,
which is then passed to <code>power.OETF()</code> to create the <code>TransferFunction</code>.
This is the classical <code class="reqn">1/\gamma</code> power law.
<br><code>OETF</code> can also be <code>NULL</code>; see section <b>Transfer Function Details</b> for valid combinations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EOTF</code></td>
<td>

<p>a <code>TransferFunction</code> of dimension 1 or 3.
<br><code>EOTF</code> can also be a positive number <code class="reqn">\gamma</code>,
which is then passed to <code>power.EOTF()</code> to create the <code>TransferFunction</code>.
This is the classical <code class="reqn">\gamma</code> power law.
<br><code>EOTF</code> can also be one of these strings:
<code>'sRGB'</code>, <code>'ProPhotoRGB'</code>, <code>'BT.709'</code>,  <code>'BT.2020'</code>, or  <code>'240M'</code>,
which then installs the appropriate special EOTF function.
<br><code>EOTF</code> can also be <code>NULL</code>; see section <b>Transfer Function Details</b> for valid combinations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OOTF</code></td>
<td>

<p>a <code>TransferFunction</code> of dimension 1 or 3.
<br><code>OOTF</code> can also be a positive number <code class="reqn">\gamma</code>,
which is then passed to <code>power.OOTF()</code> to create the <code>TransferFunction</code>.
This is the classical <code class="reqn">\gamma</code> power law.
<br><code>EOTF</code> can also be <code>NULL</code>; see section <b>Transfer Function Details</b> for valid combinations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>

<p>in <code>installRGB()</code>, <code>space</code> is compared with previously installed
RGB space names in case-insensitive way.  
If there is a match, and <code>overwrite</code> is <code>FALSE</code>,
then the installation fails.
If <code>overwrite</code> is <code>TRUE</code>, then the existing space is overwritten.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Both  <code>installRGB()</code> and <code>uninstallRGB()</code> check for matches with existing names.
The matching is full (not partial) and case-insensitive.
So it is impossible to have 2 spaces that differ only in case.
</p>


<h3>Value</h3>

<p><code>installRGB()</code> and <code>uninstallRGB()</code> return <code>TRUE</code> or <code>FALSE</code>.
</p>


<h3>Primaries and Whitepoint Details</h3>

<p>The arguments <code>scene</code> and <code>display</code> can be a list with 2 items: 
<code>primaries</code> and <code>white</code> in that order.
There are 3 options for this list, as given in this table:
</p>

<table>
<tr>
<td style="text-align: center;">
<code>dim(primaries)</code>  </td>
<td style="text-align: center;"> <code>length(white)</code> </td>
<td style="text-align: left;"> Description </td>
</tr>
<tr>
<td style="text-align: center;">
4x2 </td>
<td style="text-align: center;"> 1 </td>
<td style="text-align: left;">  <code>primaries</code> is a 4x2 matrix with CIE xy chromaticities of R,G,B,W in the rows</td>
</tr>
<tr>
<td style="text-align: center;">
3x2 </td>
<td style="text-align: center;"> 2 </td>
<td style="text-align: left;">  <code>primaries</code> is a 3x2 matrix with CIE xy chromaticities of R,G,B in the rows</td>
</tr>
<tr>
<td style="text-align: center;">
3x2 </td>
<td style="text-align: center;"> 3 </td>
<td style="text-align: left;">  <code>primaries</code> is a 3x2 matrix with CIE xy chromaticities of R,G,B in the rows</td>
</tr>
<tr>
<td style="text-align: center;">
</td>
</tr>
</table>
<p>If <code>length(white)</code> is 1, then <code>white</code> is the whitepoint Y.
If <code>length(white)</code> is 2, then <code>white</code> is the whitepoint xy (CIE chromaticity); 
the whitepoint Y is taken to be 1.
If <code>length(white)</code> is 3, <code>white</code> is the whitepoint XYZ (CIE tristimulus).
<br>
The whitepoint is linearly transformed to RGB=(1,1,1).
For better numeric compatibility with standards, xy is recommended.
For better numeric compatibility with <cite>Lindbloom</cite>, XYZ is recommended.
See the <b>Examples</b> below.
</p>


<h3>Transfer Function Details</h3>

<p>The 3 transfer functions - <code>OETF</code>, <code>EOTF</code>, <code>OOTF</code> - can be <code>NULL</code> (the default) or given.
This yields 8 combinations, but only 6 are valid, as given in this table:
</p>

<table>
<tr>
<td style="text-align: center;">
<code>OETF</code> </td>
<td style="text-align: center;"> <code>EOTF</code> </td>
<td style="text-align: center;"> <code>OOTF</code>         </td>
<td style="text-align: left;"> Description </td>
</tr>
<tr>
<td style="text-align: center;">
 given      </td>
<td style="text-align: center;">   given     </td>
<td style="text-align: center;">   given             </td>
<td style="text-align: left;"> INVALID </td>
</tr>
<tr>
<td style="text-align: center;">
 given      </td>
<td style="text-align: center;">   given     </td>
<td style="text-align: center;">   <code>OETF*EOTF</code>  </td>
<td style="text-align: left;"> <code>OOTF</code> is the composition <code>OETF</code> followed by <code>EOTF</code> </td>
</tr>
<tr>
<td style="text-align: center;">
 given      </td>
<td style="text-align: center;">  <code>OETF^-1*OOTF</code>      </td>
<td style="text-align: center;"> given </td>
<td style="text-align: left;"> <code>EOTF</code> is the composition <code>OETF^-1</code> followed by <code>OOTF</code> </td>
</tr>
<tr>
<td style="text-align: center;">
 <code>OOTF*EOTF^-1</code> </td>
<td style="text-align: center;">  given    </td>
<td style="text-align: center;"> given        </td>
<td style="text-align: left;"> <code>OETF</code> is the composition <code>OOTF</code> followed by <code>EOTF^-1</code> </td>
</tr>
<tr>
<td style="text-align: center;"> 
 
given </td>
<td style="text-align: center;">  <code>OETF^-1</code>  </td>
<td style="text-align: center;">  <code>identity.TF</code>  </td>
<td style="text-align: left;"> <code>EOTF</code> is set to <code>OETF^-1</code>, and <code>OOTF</code> is set to the identity </td>
</tr>
<tr>
<td style="text-align: center;"> 
  
 <code>EOTF^-1</code>  </td>
<td style="text-align: center;">  given  </td>
<td style="text-align: center;">  <code>identity.TF</code>  </td>
<td style="text-align: left;"> <code>OETF</code> is set to <code>EOTF^-1</code>, and <code>OOTF</code> is set to the identity </td>
</tr>
<tr>
<td style="text-align: center;"> 

<code>NULL</code> </td>
<td style="text-align: center;"> <code>NULL</code> </td>
<td style="text-align: center;">  given              </td>
<td style="text-align: left;"> INVALID </td>
</tr>
<tr>
<td style="text-align: center;">
<code>NULL</code> </td>
<td style="text-align: center;"> <code>NULL</code> </td>
<td style="text-align: center;"> <code>NULL</code>         </td>
<td style="text-align: left;"> all 3 transfer functions are set to <code>identity.TF</code>.  </td>
</tr>
<tr>
<td style="text-align: center;">
</td>
</tr>
</table>
<p>Think of these 3 functions as forming a triangle.
If all 3 are given, the transfers may be ambiguous, i.e. the triangle may not commute.
If 2 functions are given, the 3rd is computed from those 2.
If only 1 function is given, and it is EOTF or OETF, then it makes sense to make the other one the inverse
of the given one, so that the OOTF is the identity.
If only the OOTF is given, there is no well-defined way to define the other 2.
If none are given, as in the last row,
this might be useful for testing conversion between RGB and XYZ.
</p>


<h3>Warning</h3>

<p>All the RGB spaces are stored in a dictionary.
If <code>installRGB()</code> is successful, the installed space is only in
the dictionary until the end of the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> session.
To make it persist, please put the function call in an <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> script that is executed
after the package is loaded.
<br>
The dictionary comes with 8 RGB spaces pre-installed.
</p>


<h3>References</h3>

<p>Lindbloom, Bruce.
<b>RGB/XYZ Matrices</b>.
<a href="http://brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html">http://brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html</a>
</p>


<h3>See Also</h3>

<p><code>getRGB()</code>,
<code>summaryRGB()</code>
<code>RGBfromXYZ()</code>,
<code>XYZfromRGB()</code>,
<code>TransferFunction</code>,
<code>power.OETF()</code>,
<code>power.EOTF()</code>,
<code>power.OOTF()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#  install native RGB space for NEC PA242W display
prim = matrix( c(0.675,0.316, 0.199,0.715, 0.157,0.026), 3, 2, byrow=TRUE )
installRGB( 'PA242W', scene=NULL, display=list(primaries=prim,white=c(0.95047,1,1.08883)), OETF=2 )

#  install a linear version of sRGB  (OETF=1)
prim    = matrix( c(0.64,0.33,  0.30,0.60, 0.15,0.06), 3, 2, byrow=TRUE )
installRGB( 'linear-sRGB', scene=NULL, display=list(prim,c(0.3127,0.3290)), OETF=1 )

# make plot comparing three EOTFs
plot( getRGB('sRGB')$EOTF, col='black' )
plot( getRGB('linear')$EOTF, col='red', add=TRUE )
plot( getRGB('PA242W')$EOTF, col='blue', add=TRUE )

# Install an RGB space named 'HD+2.4', with encoding from BT.709 and display from BT.1886.
# the OOTF for this space is non-trivial
prim    = matrix( c(0.64,0.33,  0.30,0.60,  0.15,0.06 ), 3, 2, byrow=TRUE )
white   = c( 0.3127, 0.3290 )
installRGB( "HD+2.4", scene=NULL, display=list(prim,white),
                          OETF=(BT.709.EOTF)^-1, EOTF=BT.1886.EOTF(), over=TRUE )

# make plot comparing two OOTFs
plot( getRGB('HD+2.4')$OOTF, col='red')
plot( getRGB('sRGB')$OOTF, col='black', add=TRUE  )
</code></pre>


</div>