<div class="container">

<table style="width: 100%;"><tr>
<td>check_RCMdata</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Rapid Conditioning Model (RCM)</h2>

<h3>Description</h3>

<p>Intended for conditioning operating models for MSEtool. For data-limited stocks, this function can generate a range of potential depletion scenarios inferred from sparse data.
From a historical time series of total catch or effort, and potentially age/length compositions and multiple indices of abundance, the RCM returns a range of values for depletion, selectivity,
unfished recruitment (R0), historical fishing effort, and recruitment deviations for the operating model. This is done by sampling life history parameters
provided by the user and fitting a statistical catch-at-age model (with the predicted catch equal to the observed catch).
Alternatively one can do a single model fit and sample the covariance matrix to generate an operating model with uncertainty based on the model fit.
Either a full catch (conditioned on catch) or effort (conditioned on effort) time series is needed but missing data (as NAs) are allowed for all other data types.
<code>check_RCMdata</code> evaluates whether the inputs in the S4 RCMdata object are correctly formatted.
</p>


<h3>Usage</h3>

<pre><code class="language-R">check_RCMdata(RCMdata, OM, condition = "catch", silent = FALSE)

RCM(OM, data, ...)

## S4 method for signature 'OM,RCMdata'
RCM(
  OM,
  data,
  condition = "catch",
  selectivity = "logistic",
  s_selectivity = NULL,
  LWT = list(),
  comp_like = c("multinomial", "lognormal", "mvlogistic", "dirmult1", "dirmult2"),
  prior = list(),
  max_F = 3,
  cores = 1L,
  integrate = FALSE,
  mean_fit = FALSE,
  drop_nonconv = FALSE,
  drop_highF = FALSE,
  control = list(iter.max = 2e+05, eval.max = 4e+05),
  start = list(),
  map = list(),
  silent = FALSE,
  ...
)

## S4 method for signature 'OM,list'
RCM(
  OM,
  data,
  condition = "catch",
  selectivity = "logistic",
  s_selectivity = NULL,
  LWT = list(),
  comp_like = c("multinomial", "lognormal", "mvlogistic", "dirmult1", "dirmult2"),
  ESS = c(30, 30),
  prior = list(),
  max_F = 3,
  cores = 1L,
  integrate = FALSE,
  mean_fit = FALSE,
  drop_nonconv = FALSE,
  drop_highF = FALSE,
  control = list(iter.max = 2e+05, eval.max = 4e+05),
  start = list(),
  map = list(),
  silent = FALSE,
  ...
)

## S4 method for signature 'OM,Data'
RCM(
  OM,
  data,
  condition = "catch",
  selectivity = "logistic",
  s_selectivity = NULL,
  LWT = list(),
  comp_like = c("multinomial", "lognormal", "mvlogistic", "dirmult1", "dirmult2"),
  ESS = c(30, 30),
  prior = list(),
  max_F = 3,
  cores = 1L,
  integrate = FALSE,
  mean_fit = FALSE,
  drop_nonconv = FALSE,
  drop_highF = FALSE,
  control = list(iter.max = 2e+05, eval.max = 4e+05),
  start = list(),
  map = list(),
  silent = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>RCMdata</code></td>
<td>
<p>An RCMdata object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OM</code></td>
<td>
<p>An object of class MSEtool::OM that specifies natural mortality (M), growth (Linf, K, t0, a, b), stock-recruitment relationship,
steepness, maturity parameters (L50 and L50_95), standard deviation of recruitment variability (Perr), as well as index uncertainty (Iobs).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condition</code></td>
<td>
<p>String to indicate whether the RCM is conditioned on "catch" (where F are estimated parameters), "catch2" (where F is solved internally using Newton's method),
or "effort" (F is proportional to an index series in <code>data@Ehist</code>. Can be fleet specific, in which case some combination of "catch" and "effort" are permissible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>Logical to indicate whether informative messages will be reported to console.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data inputs formatted in a RCMdata (preferred) or MSEtool::Data object.
Use of a list is deprecated. See Data section below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments to pass in for starting values of parameters and fixing parameters. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selectivity</code></td>
<td>
<p>A character vector of length nfleet to indicate <code>"logistic_length"</code>, <code>"dome_length"</code>, <code>"logistic_age"</code>, <code>"dome_age"</code>, or <code>"free"</code> selectivity for each fleet in <code>Chist</code>.
If there is time-varying selectivity, this is a character vector of length nsel_block (see Data section below). "free" indicates independent selectivity parameters for each age,
and additional modifications for fixing selectivity parameters will likely be needed. See Additional arguments section.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s_selectivity</code></td>
<td>
<p>A vector of length nsurvey to indicate the selectivity of the corresponding columns in <code>data$Index</code>. Use <code>"B"</code> for
total biomass, or <code>"SSB"</code> for spawning biomass (by default, "B" is used). Use numbers if the survey selectivity follows a fleet (corresponding to the columns in data$Chist, e.g., 1 = first fleet/column and so on).
If the survey selectivity is otherwise independent of anything else in the model, use <code>"logistic_length"</code>, <code>"dome_length"</code>, <code>"logistic_age"</code>, <code>"dome_age"</code>, or <code>"free"</code> to specify the functional form of selectivity, and
see Additional arguments section for setup of survey selectivity parameters and Articles section for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LWT</code></td>
<td>
<p>A named list of likelihood weights for the RCM. See below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comp_like</code></td>
<td>
<p>A string indicating the statistical distribution for the composition data, either <code>"multinomial"</code> (default), <code>"lognormal"</code>, <code>"mvlogistic"</code> (multivariate logistic),
<code>"dirmult1"</code> (Dirichlet multinomial, linear version), or <code>"dirmult2"</code> (saturating version; see Thorson et al. 2017).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>
<p>A named list for the parameters of any priors to be added to the model. See below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_F</code></td>
<td>
<p>The maximum F for any fleet in the scoping model (higher F's in the model are penalized in the objective function). This argument will also update <code>OM@maxF</code>. See also <code>drop_highF</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Integer for the number of CPU cores (set greater than 1 for parallel processing).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integrate</code></td>
<td>
<p>Logical, whether to treat recruitment deviations as penalized parameters in the likelihood (FALSE) or random effects to be marginalized out of the likelihood (TRUE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean_fit</code></td>
<td>
<p>Logical, whether to run an additional with mean values of life history parameters from the OM.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop_nonconv</code></td>
<td>
<p>Logical, whether to drop non-converged fits of the RCM, including fits where F = NA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop_highF</code></td>
<td>
<p>Logical, whether to drop fits of the RCM where F = <code>max_F</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>A named list of arguments (e.g, max. iterations, etc.) for optimization, to be passed to the control argument of <code>stats::nlminb()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>A list of starting values for the TMB model. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>map</code></td>
<td>
<p>A list of <code>map</code> argument to TMB models to override defaults. See MakeADFun and details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ESS</code></td>
<td>
<p>A vector of length two. A shortcut method to setting the maximum multinomial sample size of the age and length compositions.
Not used when data are provided in a RCMdata object.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Fleet selectivity is fixed to values sampled from <code>OM</code> if no age or length compositions are provided.
</p>
<p>Survey selectivity is estimable only if <code>IAA</code> or <code>IAL</code> is provided. Otherwise, the selectivity should
be mirrored to a fleet (vulnerable biomass selectivity) or indexed to total or spawning biomass (see <code>s_selectivity</code>).
</p>
<p>Parameters that were used in the fitting model are placed in the <code>RCM@OM@cpars</code> list.
</p>
<p>If the operating model <code>OM</code> uses time-varying growth or M, then those trends will be used in the RCM as well.
Non-stationary productivity creates ambiguity in the calculation and interpretation of depletion and MSY reference points.
</p>
<p>The easiest way to turn off time-varying growth/M is by setting: <code>OM@Msd &lt;- OM@Linfsd &lt;- OM@Ksd &lt;- c(0, 0)</code>.
</p>
<p>To play with alternative fits by excluding indices, for example, or other optional data, set the corresponding likelihood weight to zero. The model will still generate the inferred
index but the data won't enter the likelihood. See section on likelihood weights.
</p>


<h3>Value</h3>

<p>An object of class RCModel (see link for description of output).
</p>
<p><code>check_RCMdata</code> returns a list of updated RCMdata object, OM, and StockPars and FleetPars from the Hist object generated
from the OM.
</p>


<h3>Priors</h3>

<p>The following priors can be added as a named list, e.g., <code style="white-space: pre;">⁠prior = list(M = c(0.25, 0.15), h = c(0.7, 0.1)⁠</code>.
For each parameter below, provide a vector of values as described:
</p>

<dl>
<dt><code>R0</code></dt>
<dd>
<p>A vector of length 3. The first value indicates the distribution of the prior: <code>1</code> for lognormal, <code>2</code> for uniform
on <code>log(R0)</code>, <code>3</code> for uniform on R0. If lognormal, the second and third values are the prior mean (in normal space) and SD (in log space).
Otherwise, the second and third values are the lower and upper bounds of the uniform distribution (values in normal space).</p>
</dd>
<dt><code>h</code></dt>
<dd>
<p>A vector of length 2 for the prior mean and SD, both in normal space. Beverton-Holt steepness uses a beta distribution,
while Ricker steepness uses a normal distribution.</p>
</dd>
<dt><code>M</code></dt>
<dd>
<p>A vector of length 2 for the prior mean (in normal space) and SD (in log space). Lognormal prior.</p>
</dd>
<dt><code>q</code></dt>
<dd>
<p>A matrix for nsurvey rows and 2 columns. The first column is the prior mean (in normal space) and the second column
for the SD (in log space). Use <code>NA</code> in rows corresponding to indices without priors.</p>
</dd>
</dl>
<p>See online documentation for more details.
</p>


<h3>Online Documentation</h3>

<p>Several articles are available for RCM:
</p>

<ul>
<li> <p><a href="https://openmse.com/tutorial-rcm/">General overview of approach</a>
</p>
</li>
<li> <p><a href="https://openmse.com/tutorial-rcm-eq/">Mathematical description</a>
</p>
</li>
<li> <p><a href="https://openmse.com/tutorial-rcm-select/">Setup of selectivity settings and index catchability</a> (useful for more data-rich cases)
</p>
</li>
<li> <p><a href="https://openmse.com/features-assessment-models/5-priors/">Description of priors</a>
</p>
</li>
</ul>
<h3>Data</h3>

<p>One of indices, age compositions, or length compositions should be provided in addition to the historical catch or effort. Not all arguments
are needed to run the model (some have defaults, while others are ignored if not applicable depending on the data provided).
</p>
<p>The <code>data</code> variable can be an object of class RCMdata. See help file for description of inputs.
</p>
<p>Alternatively, the <code>data</code> input can be a MSEtool::Data S4 object which will retrieve data from the following slots:
</p>

<dl>
<dt><code>Data@Cat</code></dt>
<dd>
<p>catch series (single fleet with the Data S4 object)</p>
</dd>
<dt><code>Data@Effort</code></dt>
<dd>
<p>effort series</p>
</dd>
<dt><code>Data@CAA</code></dt>
<dd>
<p>fishery age composition</p>
</dd>
<dt>
<code>Data@CAL</code>, <code>Data@CAL_mids</code>
</dt>
<dd>
<p>fishery length composition and corresponding length bins</p>
</dd>
<dt>
<code>Data@Ind</code>, <code>Data@SpInd</code>, <code>Data@VInd</code>, <code>Data@AddInd</code>
</dt>
<dd>
<p>indices of abundance</p>
</dd>
<dt>
<code>Data@CV_Ind</code>, <code>Data@CV_SpInd</code>, <code>Data@CV_VInd</code>, <code>Data@CV_AddInd</code>
</dt>
<dd>
<p>annual coefficients of variation for the corresponding indices
of abundance. CVs will be converted to lognormal standard deviations.</p>
</dd>
<dt><code>Data@ML</code></dt>
<dd>
<p>fishery mean lengths</p>
</dd>
<dt>
<code>Data@AddIndV</code>, <code>Data@AddIndType</code>, <code>Data@AddIunits</code>
</dt>
<dd>
<p>Additional information for indices in <code>Data@AddInd</code>:
selectivity and units (i.e., biomass or abundance).</p>
</dd>
</dl>
<p>There is no slot in the Data S4 object for the equilibrium catch/effort. These can be passed directly in the function call, i.e., <code>RCM(OM, Data, C_eq = C_eq, ...)</code>.
</p>


<h3>Data list</h3>

<p>Use of a list is deprecated. For backwards compatibility, here is the list of supported entries:
</p>

<dl>
<dt><code>Chist</code></dt>
<dd>
<p>A vector of historical catch, should be of length OM@nyears. If there are multiple fleets: a matrix of <code>OM@nyears</code> rows and <code>nfleet</code> columns.
Ideally, the first year of the catch series represents unfished conditions (see also <code>C_eq</code>).</p>
</dd>
<dt><code>C_sd</code></dt>
<dd>
<p>A vector or matrix of standard deviations (lognormal distribution) for the catches in <code>Chist</code>.
If not provided, the default is 0.01. Only used if <code>condition = "catch"</code>.</p>
</dd>
<dt><code>Ehist</code></dt>
<dd>
<p>A vector of historical effort, should be of length <code>OM@nyears</code> (see also <code>E_eq</code>).</p>
</dd>
<dt><code>Index</code></dt>
<dd>
<p>A vector of values of an index (of length <code>OM@nyears</code>). If there are multiple indices: a matrix of historical indices of abundances, with rows
indexing years and columns indexing the index.</p>
</dd>
<dt><code>I_sd</code></dt>
<dd>
<p>A vector or matrix of standard deviations (lognormal distribution) for the indices corresponding to the entries in <code>Index</code>.
If not provided, this function will use values from <code>OM@Iobs</code>.</p>
</dd>
<dt><code>I_type</code></dt>
<dd>
<p>Obsolete as of version 2.0. See <code>s_selectivity</code> argument.</p>
</dd>
<dt><code>CAA</code></dt>
<dd>
<p>Fishery age composition matrix with <code>nyears</code> rows and <code>OM@maxage+1</code> columns. If multiple fleets: an array with dimension:
<code style="white-space: pre;">⁠nyears, OM@maxage, and nfleet⁠</code>.</p>
</dd>
<dt><code>CAL</code></dt>
<dd>
<p>Fishery length composition matrix with nyears rows and columns indexing the length bin. If multiple fleets:
an array with dimension: <code style="white-space: pre;">⁠nyears, length bins, and nfleet⁠</code>.</p>
</dd>
<dt><code>MS</code></dt>
<dd>
<p>A vector of fishery mean size (MS, either mean length or mean weight) observations (length <code>OM@nyears</code>),
or if multiple fleets: matrix of dimension: <code style="white-space: pre;">⁠nyears, nfleet⁠</code>.
Generally, mean lengths should not be used if <code>CAL</code> is also provided, unless mean length and length comps are independently sampled.</p>
</dd>
<dt><code>MS_type</code></dt>
<dd>
<p>A character (either <code>"length"</code> (default) or <code>"weight"</code>) to denote the type of mean size data.</p>
</dd>
<dt><code>MS_cv</code></dt>
<dd>
<p>The coefficient of variation of the observed mean size. If there are multiple fleets, a vector of length <code>nfleet</code>.
Default is 0.2.</p>
</dd>
<dt><code>s_CAA</code></dt>
<dd>
<p>Survey age composition data, an array of dimension <code style="white-space: pre;">⁠nyears, maxage+1, nsurvey⁠</code>.</p>
</dd>
<dt><code>s_CAL</code></dt>
<dd>
<p>Survey length composition data, an array of dimension <code style="white-space: pre;">⁠nyears, length(length_bin), nsurvey⁠</code>.</p>
</dd>
<dt><code>length_bin</code></dt>
<dd>
<p>A vector for the midpoints of the length bins for <code>CAL</code> and <code>s_CAL</code>. All bin widths should be equal in size.</p>
</dd>
<dt><code>C_eq</code></dt>
<dd>
<p>A numeric vector of length <code>nfleet</code> for the equilibrium catch for each fleet in <code>Chist</code> prior to the first year of the operating model.
Zero (default) implies unfished conditions in year one. Otherwise, this is used to estimate depletion in the first year of the data. Alternatively,
if one has a full CAA matrix, one could instead estimate "artificial" rec devs to generate the initial numbers-at-age (and hence initial
depletion) in the first year of the model (see additional arguments).</p>
</dd>
<dt><code>C_eq_sd</code></dt>
<dd>
<p>A vector of standard deviations (lognormal distribution) for the equilibrium catches in <code>C_eq</code>.
If not provided, the default is 0.01. Only used if <code>condition = "catch"</code>.</p>
</dd>
<dt><code>E_eq</code></dt>
<dd>
<p>The equilibrium effort for each fleet in <code>Ehist</code> prior to the first year of the operating model.
Zero (default) implies unfished conditions in year one. Otherwise, this is used to estimate depletion in the first year of the data.</p>
</dd>
<dt><code>abs_I</code></dt>
<dd>
<p>Optional, an integer vector to indicate which indices are in absolute magnitude. Use 1 to set <code>q = 1</code>,
otherwise use 0 to estimate q.</p>
</dd>
<dt><code>I_units</code></dt>
<dd>
<p>Optional, an integer vector to indicate whether indices are biomass based (1) or abundance-based (0).
By default, all are biomass-based.</p>
</dd>
<dt><code>age_error</code></dt>
<dd>
<p>Optional, a square matrix of maxage + 1 rows and columns to specify ageing error. The aa-th column
assigns a proportion of the true age in the a-th row to observed age. Thus, all rows should sum to 1.
Default is an identity matrix (no ageing error).</p>
</dd>
<dt><code>sel_block</code></dt>
<dd>
<p>Optional, for time-varying fleet selectivity (in time blocks), a integer matrix of <code>nyears</code> rows and <code>nfleet</code> columns
to assigns a selectivity function to a fleet for certain years.</p>
</dd>
</dl>
<h3>Additional arguments</h3>

<p>For <code>RCM</code>, additional arguments can be passed to the model via <code>...</code>:
</p>

<dl>
<dt><code>plusgroup</code></dt>
<dd>
<p>Logical for whether the maximum age is a plusgroup or not. By default, TRUE.</p>
</dd>
<dt><code>fix_dome</code></dt>
<dd>
<p>Logical for whether the dome selectivity parameter for fleets is fixed. Used primarily for backwards compatibility,
this is overridden by the <code>map</code> argument.</p>
</dd>
<dt><code>resample</code></dt>
<dd>
<p>Logical, whether the OM conditioning parameters (recruitment, fishing mortality, SSB, selectivity, etc.) are obtained by sampling the Hessian matrix from
a single model fit. By default FALSE. This feature requires identical biological parameters among simulations.</p>
</dd>
<dt><code>pbc_recdev</code></dt>
<dd>
<p>Vector of length nyears. Proportion of the bias correction to apply annually to the recruitment deviations (if estimated).
The bias correction from logspace to normal space is <code>exp(log_rec_dev[y] - 0.5 * pbc_recdev[y] * sigmaR^2)</code>. Default proportion is 1.</p>
</dd>
</dl>
<h3>start</h3>

<p>Starting values can be specified in a named list for the following:
</p>

<dl>
<dt><code>vul_par</code></dt>
<dd>
<p>A matrix of 3 rows and nfleet columns for starting values for fleet selectivity. The three rows correspond
to LFS (length of full selectivity), L5 (length of 5 percent selectivity), and Vmaxlen (selectivity at length Linf). By default,
the starting values are values from the OM object. If any <code>selectivity = "free"</code>, then this matrix needs to be of <code>maxage+1</code> rows where
the row specifies the selectivity at age. See Articles section.</p>
</dd>
<dt><code>ivul_par</code></dt>
<dd>
<p>A matrix of 3 rows and nsurvey columns for starting values for fleet selectivity. Same setup as <code>vul_par</code>. Values in the column are ignored
if <code>s_selectivity</code> is mapped to a fishing fleet (add NA placeholders in that case).
If any <code>s_selectivity = "free"</code>, then this matrix needs to be of <code>maxage+1</code> rows where
the row specifies the selectivity at age.</p>
</dd>
<dt><code>log_rec_dev</code></dt>
<dd>
<p>A numeric vector of length <code>nyears</code> for the starting values of the log-recruitment deviations.</p>
</dd>
<dt><code>log_early_rec_dev</code></dt>
<dd>
<p>A numeric vector of length <code>OM@maxage</code> for the starting values of the recruitment deviations controlling the abundance-at-age in the first year of the model.</p>
</dd>
<dt><code>q</code></dt>
<dd>
<p>A numeric vector of length nsurvey for index catchability. See <a href="https://openmse.com/tutorial-rcm-select/">online article</a> for more information.</p>
</dd>
</dl>
<h3>map</h3>

<p>Parameters can be fixed with the map argument (also a named list, corresponding to the start list). Each
vector or matrix in the map argument will be the same dimension as in the start entry. If an entry is <code>NA</code>, the corresponding parameter is fixed in the model to the starting
value. Otherwise, an integer for each independent parameter, i.e., shared or mirrored parameters get the same integer entry.
</p>

<dl>
<dt><code>vul_par</code></dt>
<dd>
<p>An integer matrix of the same dimension as <code>start$vul_par</code>. By default, selectivity is fixed if there are no age or length composition for that fleet
or survey, otherwise estimated. Unused cells in the <code>start$vul_par</code> matrix should be given NA in the map matrix.</p>
</dd>
<dt><code>ivul_par</code></dt>
<dd>
<p>The map argument for the survey selectivity parameters (same dimension as <code>start$ivul_par</code>). Placeholder parameters should have a map value of NA.</p>
</dd>
<dt><code>log_early_rec_dev</code></dt>
<dd>
<p>A vector of length <code>OM@maxage</code> that indexes which recruitment deviates for the cohorts in the first year of the model are fixed (using NA) or estimated (a separate integer).
By default, no deviates are estimated (all are NA).</p>
</dd>
<dt><code>log_rec_dev</code></dt>
<dd>
<p>A vector of length <code>OM@nyears</code> that indexes which recruitment deviates are fixed (using NA) or estimated (a separate integer).
By default, all these deviates are estimated.</p>
</dd>
<dt><code>q</code></dt>
<dd>
<p>A vector of length <code>nsurvey</code> for index catchability. q should be an estimated parameter when sharing across surveys (perhaps with differing selectivity). Otherwise, it is solved analytically
where individual parameters are independent of other indices. Use <code>RCMdata@abs_I</code> for fixing the catchability to 1. See <a href="https://openmse.com/tutorial-rcm-select/">online article</a> for more information.</p>
</dd>
</dl>
<h3>Likelihood weights</h3>

<p><code>LWT</code> is an optional named list containing the likelihood weights (values &gt;= 0) with the possible options:
</p>

<ul>
<li> <p><code style="white-space: pre;">⁠Chist, CAA, CAL, MS, C_eq⁠</code>: A vector of length nfleet for each.
</p>
</li>
<li> <p><code style="white-space: pre;">⁠Index, IAA, IAL⁠</code>: A vector of length nsurvey for each.
</p>
</li>
</ul>
<p>By default, all likelihood weights are equal to one if not specified by the user.
</p>
<p>Annual multinomial sample sizes for the age and length comps can now be provided directly in the
RCMdata object. For a list or MSEtool::Data object, use the <code>ESS</code> argument.
</p>


<h3>Author(s)</h3>

<p>Q. Huynh
</p>


<h3>References</h3>

<p>Thorson et al. 2017. Model-based estimates of effective sample size in stock assessment models using the Dirichlet-multinomial distribution.
Fish. Res. 192:84-93. <a href="https://doi.org/10.1016/j.fishres.2016.06.005">doi:10.1016/j.fishres.2016.06.005</a>
</p>


<h3>See Also</h3>

<p>plot.RCModel RCModel compare_RCM pcod RCM2MOM posterior
</p>


<h3>Examples</h3>

<pre><code class="language-R"> 
# An example that conditions a Pacific cod operating model. There are 48 simulations, 
# where values of natural mortality and steepness are sampled from distributions. 
# The model is fitted with priors on the index catchability. Maturity and selectivity 
# are knife-edge at the age of 2 years. See online tutorial for more information.

data(pcod) 
mat_ogive &lt;- pcod$OM@cpars$Mat_age[1, , 1]
out &lt;- RCM(OM = pcod$OM, data = pcod$data, 
           condition = "catch", mean_fit = TRUE,
           selectivity = "free", s_selectivity = rep("SSB", ncol(pcod$data@Index)),
           start = list(vul_par = matrix(mat_ogive, length(mat_ogive), 1)),
           map = list(vul_par = matrix(NA, length(mat_ogive), 1),
                      log_early_rec_dev = rep(1, pcod$OM@maxage)),
           prior = pcod$prior)
plot(out, s_name = colnames(pcod$data@Index))

# Alternative OM with age-3 maturity and selectivity instead.
out_age3 &lt;- local({
  pcod$OM@cpars$Mat_age[, 2, ] &lt;- 0
  mat_ogive_age3 &lt;- pcod$OM@cpars$Mat_age[1, , 1]
  RCM(OM = pcod$OM, data = pcod$data, 
      condition = "catch", mean_fit = TRUE,
      selectivity = "free", s_selectivity = rep("SSB", ncol(pcod$data@Index)),
      start = list(vul_par = matrix(mat_ogive_age3, length(mat_ogive_age3), 1)),
      map = list(vul_par = matrix(NA, length(mat_ogive_age3), 1),   
                 log_early_rec_dev = rep(1, pcod$OM@maxage)),
      prior = pcod$prior)
})
  
compare_RCM(out, out_age3, scenario = list(names = c("Age-2 maturity", "Age-3 maturity")),
            s_name = colnames(pcod$data@Index))
             
Hist &lt;- runMSE(out@OM, Hist = TRUE)            
 

</code></pre>


</div>