<div class="container">

<table style="width: 100%;"><tr>
<td>sv_force</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>SHAP Force Plot</h2>

<h3>Description</h3>

<p>Creates a force plot of SHAP values of one observation. If multiple
observations are selected, their SHAP values and predictions are averaged.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sv_force(object, ...)

## Default S3 method:
sv_force(object, ...)

## S3 method for class 'shapviz'
sv_force(
  object,
  row_id = 1L,
  max_display = 6L,
  fill_colors = c("#f7d13d", "#a52c60"),
  format_shap = getOption("shapviz.format_shap"),
  format_feat = getOption("shapviz.format_feat"),
  contrast = TRUE,
  bar_label_size = 3.2,
  show_annotation = TRUE,
  annotation_size = 3.2,
  ...
)

## S3 method for class 'mshapviz'
sv_force(
  object,
  row_id = 1L,
  max_display = 6L,
  fill_colors = c("#f7d13d", "#a52c60"),
  format_shap = getOption("shapviz.format_shap"),
  format_feat = getOption("shapviz.format_feat"),
  contrast = TRUE,
  bar_label_size = 3.2,
  show_annotation = TRUE,
  annotation_size = 3.2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An object of class "(m)shapviz".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed to <code>ggfittext::geom_fit_text()</code>.
For example, <code>size = 9</code> will use fixed text size in the bars and <code>size = 0</code>
will altogether suppress adding text to the bars.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>row_id</code></td>
<td>
<p>Subset of observations to plot, typically a single row number.
If more than one row is selected, SHAP values are averaged, and feature values
are shown only when they are unique.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_display</code></td>
<td>
<p>Maximum number of features (with largest absolute SHAP values)
should be plotted? If there are more features, they will be collapsed to one
feature. Set to <code>Inf</code> to show all features.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fill_colors</code></td>
<td>
<p>A vector of exactly two fill colors: the first for positive
SHAP values, the other for negative ones.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>format_shap</code></td>
<td>
<p>Function used to format SHAP values. The default uses the
global option <code>shapviz.format_shap</code>, which equals to
<code>function(z) prettyNum(z, digits = 3, scientific = FALSE)</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>format_feat</code></td>
<td>
<p>Function used to format numeric feature values. The default uses
the global option <code>shapviz.format_feat</code>, which equals to
<code>function(z) prettyNum(z, digits = 3, scientific = FALSE)</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrast</code></td>
<td>
<p>Logical flag that detemines whether to use white text in dark arrows.
Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bar_label_size</code></td>
<td>
<p>Size of text used to describe bars
(via <code>ggrepel::geom_text_repel()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_annotation</code></td>
<td>
<p>Should "f(x)" and "E(f(x))" be plotted? Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annotation_size</code></td>
<td>
<p>Size of the annotation text (f(x)=... and E(f(x))=...).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>f(x) denotes the prediction on the SHAP scale, while E(f(x)) refers to the
baseline SHAP value.
</p>


<h3>Value</h3>

<p>An object of class "ggplot" (or "patchwork") representing a force plot.
</p>


<h3>Methods (by class)</h3>


<ul>
<li> <p><code>sv_force(default)</code>: Default method.
</p>
</li>
<li> <p><code>sv_force(shapviz)</code>: SHAP force plot for object of class "shapviz".
</p>
</li>
<li> <p><code>sv_force(mshapviz)</code>: SHAP force plot for object of class "mshapviz".
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>sv_waterfall()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">dtrain &lt;- xgboost::xgb.DMatrix(
  data.matrix(iris[, -1]), label = iris[, 1], nthread = 1
)
fit &lt;- xgboost::xgb.train(data = dtrain, nrounds = 20, nthread = 1)
x &lt;- shapviz(fit, X_pred = dtrain, X = iris[, -1])
sv_force(x)
sv_force(x, row_id = 65, max_display = 3, size = 9, fill_colors = 4:5)

# Aggregate over all observations with Petal.Length == 1.4
sv_force(x, row_id = x$X$Petal.Length == 1.4)
</code></pre>


</div>