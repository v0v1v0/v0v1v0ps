<div class="container">

<table style="width: 100%;"><tr>
<td>shap.values</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Get SHAP scores from a trained XGBoost or LightGBM model</h2>

<h3>Description</h3>

<p><code>shap.values</code> returns a list of three objects from XGBoost or LightGBM
model: 1. a dataset (data.table) of SHAP scores. It has the same dimension as
the X_train); 2. the ranked variable vector by each variable's mean absolute
SHAP value, it ranks the predictors by their importance in the model; and 3.
The BIAS, which is like an intercept. The rowsum of SHAP values including the
BIAS would equal to the predicted value (y_hat) generally speaking.
</p>


<h3>Usage</h3>

<pre><code class="language-R">shap.values(xgb_model, X_train)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>xgb_model</code></td>
<td>
<p>an XGBoost or LightGBM model object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X_train</code></td>
<td>
<p>the data supplied to the <code>predict</code> function to get the
prediction. It should be a matrix. Notice that coercing the matrix to a
dense matrix by using <code>as.matrix</code> might lead to wrong behaviors in some
cases. See discussion in issues on this topic.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a list of three elements: the SHAP values as data.table, ranked
mean|SHAP|, and BIAS
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("iris")
X1 = as.matrix(iris[,-5])
mod1 = xgboost::xgboost(
  data = X1, label = iris$Species, gamma = 0, eta = 1,
  lambda = 0, nrounds = 1, verbose = FALSE, nthread = 1)

# shap.values(model, X_dataset) returns the SHAP
# data matrix and ranked features by mean|SHAP|
shap_values &lt;- shap.values(xgb_model = mod1, X_train = X1)
shap_values$mean_shap_score
shap_values_iris &lt;- shap_values$shap_score

# shap.prep() returns the long-format SHAP data from either model or
shap_long_iris &lt;- shap.prep(xgb_model = mod1, X_train = X1)
# is the same as: using given shap_contrib
shap_long_iris &lt;- shap.prep(shap_contrib = shap_values_iris, X_train = X1)

# **SHAP summary plot**
shap.plot.summary(shap_long_iris, scientific = TRUE)
shap.plot.summary(shap_long_iris, x_bound  = 1.5, dilute = 10)

# Alternatives options to make the same plot:
# option 1: from the xgboost model
shap.plot.summary.wrap1(mod1, X = as.matrix(iris[,-5]), top_n = 3)

# option 2: supply a self-made SHAP values dataset
# (e.g. sometimes as output from cross-validation)
shap.plot.summary.wrap2(shap_score = shap_values_iris, X = X1, top_n = 3)
</code></pre>


</div>