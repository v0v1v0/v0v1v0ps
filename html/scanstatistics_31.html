<div class="container">

<table style="width: 100%;"><tr>
<td>scan_eb_negbin</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate the expectation-based negative binomial scan statistic.</h2>

<h3>Description</h3>

<p>Calculate the expectation-based negative binomial scan statistic devised by
Tango et al. (2011).
</p>


<h3>Usage</h3>

<pre><code class="language-R">scan_eb_negbin(
  counts,
  zones,
  baselines = NULL,
  thetas = 1,
  type = c("hotspot", "emerging"),
  n_mcsim = 0,
  gumbel = FALSE,
  max_only = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>counts</code></td>
<td>
<p>Either:
</p>

<ul>
<li>
<p> A matrix of observed counts. Rows indicate time and are ordered
from least recent (row 1) to most recent (row 
<code>nrow(counts)</code>). Columns indicate locations, numbered from 1 
and up. If <code>counts</code> is a matrix, the optional matrix 
arguments <code>baselines</code> and <code>thetas</code> should also be 
specified.
</p>
</li>
<li>
<p> A data frame with columns "time", "location", "count", "baseline",
"theta". See the description of the optional arguments 
<code>baselines</code> and <code>thetas</code> below to see their definition.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zones</code></td>
<td>
<p>A list of integer vectors. Each vector corresponds to a single
zone; its elements are the numbers of the locations in that zone.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baselines</code></td>
<td>
<p>Optional. A matrix of the same dimensions as <code>counts</code>. 
Holds the expected value parameter for each observed count. These 
parameters are typically estimated from past data using e.g. GLM.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thetas</code></td>
<td>
<p>Optional. A matrix of the same dimensions as <code>counts</code>, or 
a scalar. Holds the dispersion parameter of the distribution, which is 
such that if <code class="reqn">\mu</code> is the expected value, the variance is 
<code class="reqn">\mu+\mu^2/\theta</code>. These parameters are typically estimated from past 
data using e.g. GLM. If a scalar is supplied, the dispersion parameter is 
assumed to be the same for all locations and time points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>A string, either "hotspot" or "emerging". If "hotspot", the
relative risk is assumed to be fixed over time. If "emerging", the
relative risk is assumed to increase with the duration of the outbreak.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_mcsim</code></td>
<td>
<p>A non-negative integer; the number of replicate scan
statistics to generate in order to calculate a <code class="reqn">P</code>-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gumbel</code></td>
<td>
<p>Logical: should a Gumbel P-value be calculated? Default is
<code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_only</code></td>
<td>
<p>Boolean. If <code>FALSE</code> (default) the statistic calculated
for each zone and duration is returned. If <code>TRUE</code>, only the largest 
such statistic (i.e. the scan statistic) is returned, along with the 
corresponding zone and duration.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list which, in addition to the information about the type of scan
statistic, has the following components:
</p>

<dl>
<dt>MLC</dt>
<dd>
<p>A list containing the number of the zone of the most likely
cluster (MLC), the locations in that zone, the duration of the 
MLC, and the calculated score. In order, the 
elements of this list are named  <code>zone_number, locations, 
           duration, score</code>.</p>
</dd>
<dt>observed</dt>
<dd>
<p>A data frame containing, for each combination of zone 
and duration investigated, the zone number, duration, and score. 
The table is sorted by score with the top-scoring location on top. 
If <code>max_only = TRUE</code>, only contains a single row 
corresponding to the MLC.</p>
</dd>
<dt>replicates</dt>
<dd>
<p>A data frame of the Monte Carlo replicates of the scan 
statistic (if any), and the corresponding zones and durations.</p>
</dd>
<dt>MC_pvalue</dt>
<dd>
<p>The Monte Carlo <code class="reqn">P</code>-value.</p>
</dd>
<dt>Gumbel_pvalue</dt>
<dd>
<p>A <code class="reqn">P</code>-value obtained by fitting a Gumbel 
distribution to the replicate scan statistics.</p>
</dd>
<dt>n_zones</dt>
<dd>
<p>The number of zones scanned.</p>
</dd>
<dt>n_locations</dt>
<dd>
<p>The number of locations.</p>
</dd>
<dt>max_duration</dt>
<dd>
<p>The maximum duration considered.</p>
</dd>
<dt>n_mcsim</dt>
<dd>
<p>The number of Monte Carlo replicates made.</p>
</dd>
</dl>
<h3>References</h3>

<p>Tango, T., Takahashi, K. &amp; Kohriyama, K. (2011), A space-time scan
statistic for detecting emerging outbreaks, Biometrics 67(1), 106â€“115.
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1)
# Create location coordinates, calculate nearest neighbors, and create zones
n_locs &lt;- 50
max_duration &lt;- 5
n_total &lt;- n_locs * max_duration
geo &lt;- matrix(rnorm(n_locs * 2), n_locs, 2)
knn_mat &lt;- coords_to_knn(geo, 15)
zones &lt;- knn_zones(knn_mat)

# Simulate data
 baselines &lt;- matrix(rexp(n_total, 1/5), max_duration, n_locs)
 thetas &lt;- matrix(runif(n_total, 0.05, 3), max_duration, n_locs)
 counts &lt;- matrix(rnbinom(n_total,  mu = baselines,  size = thetas), 
                  max_duration, n_locs)

# Inject outbreak/event/anomaly
ob_dur &lt;- 3
ob_cols &lt;- zones[[10]]
ob_rows &lt;- max_duration + 1 - seq_len(ob_dur)
counts[ob_rows, ob_cols] &lt;- matrix(
  rnbinom(ob_dur * length(ob_cols), 
          mu = 2 * baselines[ob_rows, ob_cols],
          size = thetas[ob_rows, ob_cols]),
  length(ob_rows), length(ob_cols))
res &lt;- scan_eb_negbin(counts = counts,
                      zones = zones,
                      baselines = baselines,
                      thetas = thetas,
                      type = "hotspot",
                      n_mcsim = 99,
                      max_only = FALSE)
</code></pre>


</div>