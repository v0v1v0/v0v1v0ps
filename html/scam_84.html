<div class="container">

<table style="width: 100%;"><tr>
<td>smooth.construct.mpi.smooth.spec</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Constructor for monotone increasing P-splines in SCAMs
</h2>

<h3>Description</h3>

<p>This is a special method function
for creating smooths subject to a monotone increasing constraint which is built by 
the <code>mgcv</code> constructor function for smooth terms, <code>smooth.construct</code>. 
It is constructed using monotonic P-splines. This smooth is specified via model terms such as 
<code>s(x,k,bs="mpi",m=2)</code>, 
where <code>k</code> denotes the basis dimension and <code>m+1</code> is the order of the B-spline basis.
</p>
<p><code>mpiBy.smooth.spec</code> works similar to <code>mpi.smooth.spec</code> but without applying an identifiability constraint ('zero intercept' constraint). <code>mpiBy.smooth.spec</code> should be used when the smooth term has a numeric <code>by</code> variable  that takes more than one value. In such cases, the smooth terms are fully identifiable without a 'zero intercept' constraint, so they are left unconstrained. This smooth is specified as 
<code>s(x,by=z,bs="mpiBy")</code>. See an example below.
</p>
<p>However  a factor <code>by</code> variable requires identifiability constraints, so <code>s(x,by=fac,bs="mpi")</code> is used in this case.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'mpi.smooth.spec'
smooth.construct(object, data, knots)
## S3 method for class 'mpiBy.smooth.spec'
smooth.construct(object, data, knots)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>A smooth specification object, generated by an <code>s</code> term in a GAM formula.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame or list containing the data required by this term,
with names given by <code>object$term</code>. The <code>by</code> variable is the last element.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>An optional list containing the knots supplied for basis setup.  
If it is <code>NULL</code> then the knot locations are generated automatically.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The constructor is not called directly, but as with <code>gam(mgcv)</code> is used internally. 
</p>
<p>If the knots of the spline are not supplied, then they are placed evenly throughout the covariate values. If the knots are supplied, then the number of supplied knots should be <code>k+m+2</code>, and the range of the middle <code>k-m</code> knots must include all the covariate values.
</p>


<h3>Value</h3>

<p> An object of class <code>"mpi.smooth"</code>, <code>"mpiBy.smooth"</code>. 
</p>


<h3>Author(s)</h3>

 
<p>Natalya Pya &lt;nat.pya@gmail.com&gt;
</p>


<h3>References</h3>

<p>Pya, N. and Wood, S.N. (2015) Shape constrained additive models. Statistics and Computing, 25(3), 543-559
</p>
<p>Pya, N. (2010) Additive models with shape constraints. PhD thesis. University of Bath. Department of Mathematical Sciences
</p>


<h3>See Also</h3>

<p><code>smooth.construct.mpd.smooth.spec</code>,
<code>smooth.construct.cv.smooth.spec</code>,
</p>
<p><code>smooth.construct.cx.smooth.spec</code>,
<code>smooth.construct.mdcv.smooth.spec</code>, 
</p>
<p><code>smooth.construct.mdcx.smooth.spec</code>, 
<code>smooth.construct.micv.smooth.spec</code>, 
</p>
<p><code>smooth.construct.micx.smooth.spec</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"> 
## Monotone increasing P-splines example 
  ## simulating data...
   require(scam)
   set.seed(12)
   n &lt;- 100
   x &lt;- runif(n)*4-1
   f &lt;- 4*exp(4*x)/(1+exp(4*x))
   y &lt;- rpois(n,exp(f))
   dat &lt;- data.frame(x=x,y=y)
 ## fit model ...
   b &lt;- scam(y~s(x,k=15,bs="mpi"),family=poisson(link="log"),
       data=dat)
 ## fit unconstrained model...
   b1 &lt;- scam(y~s(x,k=15,bs="ps"),family=poisson(link="log"),
         data=dat)
 ## plot results ...
   plot(x,y,xlab="x",ylab="y")
   x1 &lt;- sort(x,index=TRUE)
   lines(x1$x,exp(f)[x1$ix])      ## the true function
   lines(x1$x,b$fitted.values[x1$ix],col=2)  ## monotone fit 
   lines(x1$x,b1$fitted.values[x1$ix],col=3) ## unconstrained fit 

## example with supplied knots...
   knots &lt;- list(x=c (-1.5,  -1.2, -.99, -.97, -.7, -.5, -.3, 0, 0.7,  
           0.9,1.1, 1.22,1.5,2.2,2.77,2.93,2.99, 3.2,3.6))
   b2 &lt;- scam(y~s(x,k=15,bs="mpi"),knots=knots, 
          family=poisson(link="log"), data=dat)
   summary(b2)
   plot(b2,shade=TRUE)

## Not run: 
## example with two terms...
   set.seed(0)
   n &lt;- 200
   x1 &lt;- runif(n)*6-3
   f1 &lt;- 3*exp(-x1^2) # unconstrained term
   x2 &lt;- runif(n)*4-1;
   f2 &lt;- exp(4*x2)/(1+exp(4*x2)) # monotone increasing smooth
   f &lt;- f1+f2
   y &lt;- f+rnorm(n)*.7
   dat &lt;- data.frame(x1=x1,x2=x2,y=y)
   knots &lt;- list(x1=c(-4,-3.5,-2.99,-2.7,-2.5,-1.9,-1.1,-.9,-.3,0.3,.8,1.2,1.9,2.3,
2.7,2.99,3.5,4.1,4.5), x2=c(-1.5,-1.2,-1.1, -.89,-.69,-.5,-.3,0,0.7, 
0.9,1.1,1.22,1.5,2.2,2.77,2.99,3.1, 3.2,3.6))
   b3 &lt;- scam(y~s(x1,k=15)+s(x2,bs="mpi", k=15), 
         knots=knots,data=dat)
   summary(b3)
   plot(b3,pages=1,shade=TRUE)
## setting knots for f(x2) only...
   knots &lt;- list(x2=c(-1.5,-1.2,-1.1, -.89,-.69,-.5,-.3,
   0,0.7,0.9,1.1,1.22,1.5,2.2,2.77,2.99,3.1, 3.2,3.6))
   b4 &lt;- scam(y~s(x1,k=15,bs="bs")+s(x2,bs="mpi",k=15),
       knots=knots,data=dat)
   summary(b4)
   plot(b4,pages=1,shade=TRUE)

## 'by' factor example... 
 set.seed(10)
 n &lt;- 400
 x &lt;- runif(n, 0, 1)
 ## all three smooths are increasing...
 f1 &lt;- log(x *5) 
 f2 &lt;-  exp(2*x) - 4
 f3 &lt;-  5* sin(x)
 e &lt;- rnorm(n, 0, 2)
 fac &lt;- as.factor(sample(1:3,n,replace=TRUE))
 fac.1 &lt;- as.numeric(fac==1)
 fac.2 &lt;- as.numeric(fac==2)
 fac.3 &lt;- as.numeric(fac==3)
 y &lt;- f1*fac.1 + f2*fac.2 + f3*fac.3 + e 
 dat &lt;- data.frame(y=y,x=x,fac=fac,f1=f1,f2=f2,f3=f3)
 b5 &lt;- scam(y ~ fac+s(x,by=fac,bs="mpi"),data=dat)  
 plot(b5,pages=1,scale=0,shade=TRUE)
 summary(b5)
 vis.scam(b5,theta=50,color="terrain")

 ## comparing with unconstrained fit...
 b6 &lt;- scam(y ~ fac+s(x,by=fac),data=dat) 
 x11()
 plot(b6,pages=1,scale=0,shade=TRUE)
 summary(b6)
 vis.scam(b6,theta=50,color="terrain")

 ## Note that since in scam() as in mgcv::gam() when using factor 'by' variables, 'centering'
 ## constraints are applied to the smooths, which usually means that the 'by'
 ## factor variable should be included as a parametric term, as well. 


## numeric 'by' variable example...
 set.seed(3)
 n &lt;- 200
 x &lt;- sort(runif(n,-1,2))
 z &lt;- runif(n,-2,3)
 f &lt;- exp(1.3*x)-5
 y &lt;- f*z + rnorm(n)*2
 dat &lt;- data.frame(x=x,y=y,z=z)
 b &lt;- scam(y~s(x,by=z,bs="mpiBy"),data=dat)
 plot(b,shade=TRUE)
 summary(b)
 ## unconstrained fit...
 b1 &lt;- scam(y~s(x,k=15,by=z),data=dat)
 plot(b1,shade=TRUE)
 summary(b1)
 
## End(Not run)
</code></pre>


</div>