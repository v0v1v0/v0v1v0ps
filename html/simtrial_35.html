<div class="container">

<table style="width: 100%;"><tr>
<td>wlr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Weighted logrank test</h2>

<h3>Description</h3>

<p>Weighted logrank test
</p>


<h3>Usage</h3>

<pre><code class="language-R">wlr(data, weight, return_variance = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Dataset that has been cut, generated by <code>sim_pw_surv()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>Weighting functions, such as <code>fh()</code>, <code>mb()</code>, and
<code>early_zero()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_variance</code></td>
<td>
<p>A logical flag that, if <code>TRUE</code>, adds columns
estimated variance for weighted sum of observed minus expected;
see details; Default: <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ul>
<li> <p><code class="reqn">z</code> - Standardized normal Fleming-Harrington weighted logrank test.
</p>
</li>
<li> <p><code class="reqn">i</code> - Stratum index.
</p>
</li>
<li> <p><code class="reqn">d_i</code> - Number of distinct times at which events occurred in
stratum <code class="reqn">i</code>.
</p>
</li>
<li> <p><code class="reqn">t_{ij}</code> - Ordered times at which events in stratum
<code class="reqn">i</code>, <code class="reqn">j = 1, 2, \ldots, d_i</code> were observed;
for each observation, <code class="reqn">t_{ij}</code> represents the time post study entry.
</p>
</li>
<li> <p><code class="reqn">O_{ij.}</code> - Total number of events in stratum <code class="reqn">i</code> that occurred
at time <code class="reqn">t_{ij}</code>.
</p>
</li>
<li> <p><code class="reqn">O_{ije}</code> - Total number of events in stratum <code class="reqn">i</code> in the
experimental treatment group that occurred at time <code class="reqn">t_{ij}</code>.
</p>
</li>
<li> <p><code class="reqn">N_{ij.}</code> - Total number of study subjects in stratum <code class="reqn">i</code>
who were followed for at least duration.
</p>
</li>
<li> <p><code class="reqn">E_{ije}</code> - Expected observations in experimental treatment group
given random selection of <code class="reqn">O_{ij.}</code> from those in
stratum <code class="reqn">i</code> at risk at time <code class="reqn">t_{ij}</code>.
</p>
</li>
<li> <p><code class="reqn">V_{ije}</code> - Hypergeometric variance for <code class="reqn">E_{ije}</code> as
produced in <code>Var</code> from <code>counting_process()</code>.
</p>
</li>
<li> <p><code class="reqn">N_{ije}</code> - Total number of study subjects in
stratum <code class="reqn">i</code> in the experimental treatment group
who were followed for at least duration <code class="reqn">t_{ij}</code>.
</p>
</li>
<li> <p><code class="reqn">E_{ije}</code> - Expected observations in experimental group in
stratum <code class="reqn">i</code> at time <code class="reqn">t_{ij}</code> conditioning on the overall number
of events and at risk populations at that time and sampling at risk
observations without replacement:
</p>
<p style="text-align: center;"><code class="reqn">E_{ije} = O_{ij.} N_{ije}/N_{ij.}</code>
</p>

</li>
<li> <p><code class="reqn">S_{ij}</code> - Kaplan-Meier estimate of survival in combined
treatment groups immediately prior to time <code class="reqn">t_{ij}</code>.
</p>
</li>
<li> <p><code class="reqn">\rho, \gamma</code> - Real parameters for Fleming-Harrington test.
</p>
</li>
<li> <p><code class="reqn">X_i</code> - Numerator for signed logrank test in stratum <code class="reqn">i</code>
</p>
<p style="text-align: center;"><code class="reqn">X_i = \sum_{j=1}^{d_{i}} S_{ij}^\rho(1-S_{ij}^\gamma)(O_{ije}-E_{ije})</code>
</p>

</li>
<li> <p><code class="reqn">V_{ij}</code> - Variance used in denominator for Fleming-Harrington
weighted logrank tests
</p>
<p style="text-align: center;"><code class="reqn">V_i = \sum_{j=1}^{d_{i}} (S_{ij}^\rho(1-S_{ij}^\gamma))^2V_{ij})</code>
</p>

<p>The stratified Fleming-Harrington weighted logrank test is then computed as:
</p>
<p style="text-align: center;"><code class="reqn">z = \sum_i X_i/\sqrt{\sum_i V_i}.</code>
</p>

</li>
</ul>
<h3>Value</h3>

<p>A list containing the test method (<code>method</code>),
parameters of this test method (<code>parameter</code>),
point estimation of the treatment effect (<code>estimation</code>),
standardized error of the treatment effect (<code>se</code>),
Z-score (<code>z</code>), p-values (<code>p_value</code>).
</p>


<h3>Examples</h3>

<pre><code class="language-R">x &lt;- sim_pw_surv(n = 200) |&gt; cut_data_by_event(100)

# Example 1: WLR test with FH wights
x |&gt; wlr(weight = fh(rho = 0, gamma = 1))
x |&gt; wlr(weight = fh(rho = 0, gamma = 1), return_variance = TRUE)

# Example 2: WLR test with MB wights
x |&gt; wlr(weight = mb(delay = 4, w_max = 2))

# Example 3: WLR test with early zero wights
x |&gt; wlr(weight = early_zero(early_period = 4))
</code></pre>


</div>