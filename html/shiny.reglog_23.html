<div class="container">

<table style="width: 100%;"><tr>
<td>login_server</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Login server module</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a>
</p>
<p>This function has become deprecated. New RegLog system is based on RegLogServer R6 class.
</p>
<p>Shiny server module for the optional login/registration system
This function creates a server module to handle other modules of the system: <code>login_UI()</code>, <code>password_reset_UI()</code> and <code>register_UI</code>
It uses database contained in 'googlesheet' file on your 'gdrive' or 'SQLite' database locally to read and write data of the users. You need to create a 'googlesheet' or 'SQLite' using <code>create_gsheet_db()</code> or <code>create_sqlite_db()</code> respectively.
</p>


<h3>Usage</h3>

<pre><code class="language-R">login_server(
  id = "login_system",
  db_method,
  mail_method,
  appname,
  appaddress,
  lang = "en",
  gsheet_file,
  sqlite_db,
  gmailr_user,
  emayili_user,
  emayili_password,
  emayili_host,
  emayili_port,
  custom_txts = NULL,
  use_login_modals = list(UserNotFound = T, WrongPass = T, Success = T)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>the id of the module. Defaults to "login_system" for all of the modules contained within the package. If you plan to use serveral login systems inside your app or for any other reason need to change it, remember to keep consistent id for all elements of module.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>db_method</code></td>
<td>
<p>the character string containing chosen database container, either: <code>"gsheet"</code> (needing installation of 'googlesheets4' package) or <code>"sqlite"</code> (needing installation of 'DBI' and 'RSQLite' packages)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mail_method</code></td>
<td>
<p>the character string containing chosen method of sending emails, either: <code>"gmailr"</code> (needing installation of 'gmailr' package) <code>"emayili"</code> (needing installation of 'emayili' package)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>appname</code></td>
<td>
<p>the character string containing the name of your application (used in automatic e-mails for information purposes)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>appaddress</code></td>
<td>
<p>the character value containing the web address of your application (used in automatic e-mails for information purposes)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lang</code></td>
<td>
<p>specifies the app used language. Accepts "en" or "pl". Defaults to "en"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gsheet_file</code></td>
<td>
<p>the ID of your 'googlesheet' file holding the database. It is contained within URL address of your googlesheet (for: <code>db_method = "gsheet"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sqlite_db</code></td>
<td>
<p>the path to your 'SQLite' database (for: <code>db_method = "sqlite"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gmailr_user</code></td>
<td>
<p>your gmail address (for: <code>db_method = "gmailr"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emayili_user</code></td>
<td>
<p>your email address, also used as login to your email account (for: <code>db_method = "emayili"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emayili_password</code></td>
<td>
<p>password to your email account (for: <code>db_method = "emayili"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emayili_host</code></td>
<td>
<p>host of your email box (for: <code>db_method = "emayili"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emayili_port</code></td>
<td>
<p>port of your email box (for: <code>db_method = "emayili"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>custom_txts</code></td>
<td>
<p>named list containing customized texts. For more details,
see documentation for 'reglog_txt'. Provided list can contain only elements
used by this function, but it is recommended to provide the same list for
every 'shiny.reglog' function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_login_modals</code></td>
<td>
<p>list of logicals indicating if the modalDialog after log-in should be shown. Defaults to named list of logicals:
</p>

<ul>
<li>
<p>UserNotFound = T
</p>
</li>
<li>
<p>WrongPass = T
</p>
</li>
<li>
<p>Success = T
</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The module logic creates a <code>reactiveValues()</code> object with loaded database of users and reset codes stored in <code>session$userData</code>. It allows to cut the reading from database to only one read per loading of the app - unfortunately it makes the app run slowly if the database of users gets very long.
</p>
<p>Registration of new account mails the confirmation e-mail to the end user on provided e-mail.
</p>
<p>Provided e-mail is needed for password reset: 10 digits code is generated and mailed to the user to confirm its identity. Reset code remains valid for 24 hours.
</p>


<h4>Authorization</h4>


<ul>
<li>
<p> When using db_method of "gsheet" you need to authorize access to your google drive outside of the functions (using <code>googlesheets4:gs_auth()</code> with default scopes: <code>"https://www.googleapis.com/auth/spreadsheets"</code>)
</p>
</li>
<li>
<p> When using mail_method of "emayili" you need to allow "less secure apps" to use your mailbox
</p>
</li>
<li>
<p> When using mail_method of "gmailr" you need to authorize access to your gmail box by creating Oauth2 App on 'Google Cloud Platform' and passing it to <code>gmailr::gm_auth_configure()</code> and allowing scopes: <code>"https://www.googleapis.com/auth/gmail.send"</code>
</p>
</li>
</ul>
<h4>Security</h4>


<ul>
<li>
<p> Both passwords and reset codes are hashed with the help of 'scrypt' package for the extra security
</p>
</li>
<li>
<p> gmailr mail_method seems to be more secure if you intend to use 'gmail' account to send emails. 'emayili' is suggested only when using other mailboxes.
</p>
</li>
</ul>
<h3>Value</h3>

<p>reactiveValues() object with three elements:
</p>
<p><code>is_logged</code>, containing boolean describing authorization status
</p>
<p><code>user_id</code>, containing the logged user identification name. When not logged, it contains the timestamp of session start
</p>
<p><code>user_mail</code>, containing the logged user mail. When not logged, it is empty character string of nchar() value 0: ("")
</p>
<p><code>last_state_change</code>, containing string describing last change of login system state. Currently only supports state changes during login procedure
</p>


<h3>See Also</h3>

<p><code>login_UI()</code> for the login window in UI
</p>
<p><code>password_reset_UI()</code> for the password reset window in UI
</p>
<p><code>register_UI()</code> for the registration window in UI
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Only run this example in interactive R sessions

if(interactive()){
  
  #### example of db_method = "sqlite" and mail_method = "emayili"
  
  library(shiny)
  library(shiny.reglog)
  
  # initializing sqlite
  
  sqlite.path &lt;- tempfile(fileext = "sqlite")
  create_sqlite_db(sqlite.path)
  database &lt;- sqlite_get_db(sqlite.path)
  
  # Define UI containing shiny.reglog modules
  ui &lt;- fluidPage(
    
    headerPanel(title = "shiny.reglog test"),
    
    tabsetPanel(
      tabPanel("Values", 
               # table of returned data for active user
               dataTableOutput("active_user_values"),
               # table of session$userData$reactive_db$user_db loaded at the start of session
               dataTableOutput("user_db"),
               # table of session$userData$reactive_db$reset_db loaded at the start of session
               dataTableOutput("reset_db")
      ),
      tabPanel("Login", login_UI()),
      tabPanel("Register", register_UI()),
      tabPanel("Reset Password", password_reset_UI()),
      tabPanel("Logout", logout_button())
      
    )
  )
  
  server &lt;- function(input, output, session) {
    
    # login server with specified methods for database and mailing
    # to run it you need to replace placeholders with your details and 
    # cofigure it for your needs
    
    auth &lt;- login_server(
      db_method = "sqlite",
      mail_method = "emayili",
      appname = "shiny.reglog example",
      appaddress = "not-on-net.com",
      sqlite_db = sqlite.path,
      # arguments below need configuration for your mailing account
      emayili_user = "your_email_address",
      emayili_password = "your_email_password",
      emayili_port = "your_email_box_port",
      emayili_host = "your_email_box_host"
    )
    
    # table of values returned by login_server
    
    output$active_user_values &lt;- renderDataTable({
      data.frame(is_logged = auth$is_logged,
                 user_id = auth$user_id,
                 user_mail = auth$user_mail
      )
    })
    
    # tibbles contained within session$userData$reactive_db
   
    output$user_db &lt;- renderDataTable(
      session$userData$reactive_db$user_db
    )
    
    output$reset_db &lt;- renderDataTable(
      session$userData$reactive_db$reset_db
    )
  }
  
  # Run the application 
  shinyApp(ui = ui, server = server)
  
}

</code></pre>


</div>