<div class="container">

<table style="width: 100%;"><tr>
<td>calcAtmosCorr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Atmospheric correction of remote sensing data</h2>

<h3>Description</h3>

<p>The function computes an atmospheric scattering correction and converts
the sensors digital numbers to reflectances using
</p>

<ul>
<li>
<p> absolute radiance correction
</p>
</li>
<li>
<p> DOS2: a dark object substraction model by Chavez (1996)
</p>
</li>
<li>
<p> DOS4: a dark object substratcion model by Moran et al. (1992)
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">## S4 method for signature 'Satellite'
calcAtmosCorr(x, model = c("DOS2", "DOS4"), esun_method = "RadRef")

## S4 method for signature 'RasterStack'
calcAtmosCorr(x, path_rad, esun, szen, model = c("DOS2", "DOS4"))

## S4 method for signature 'RasterLayer'
calcAtmosCorr(x, path_rad, esun, szen, model = c("DOS2", "DOS4"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Satellite or Raster* object providing the radiance at the sensor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>Model to be used to correct for 1% scattering (DOS2, DOS4).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>esun_method</code></td>
<td>
<p>If x is a Satellite object, name of the method to be used 
to compute <code>esun</code> using one of <code>calcTOAIrradRadRef</code> 
("RadRef"), <code>calcTOAIrradTable</code> ("Table") or 
<code>calcTOAIrradModel</code> ("Model").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path_rad</code></td>
<td>
<p>Path radiance, e.g. returned from 
<code>calcPathRadDOS</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>esun</code></td>
<td>
<p>Actual (i.e. non-normalized) TOA solar irradiance, e.g. returned 
from <code>calcTOAIrradRadRef</code>, <code>calcTOAIrradTable</code> 
or <code>calcTOAIrradModel</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>szen</code></td>
<td>
<p>Sun zenith angle.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If a Satellite object is passed to the function, and if the required
pre-processing has not been performed already, the path radiance is computed 
based on a dark object's scaled count value using 
<code>calcPathRadDOS</code> which will also take care of the TOA solar 
irradiance by calling <code>calcTOAIrradModel</code>, 
<code>calcTOAIrradRadRef</code> or <code>calcTOAIrradTable</code> 
(depending on <code>esun_method</code>) if necessary. The bands' scaled counts are 
converted to radiance using <code>convSC2Rad</code>.
</p>
<p>The radiometric correction is based on a dark object approach using
either the DOS2 (Chavez 1996) or DOS4 (Moran et al. 1992) model.
</p>
<p>The minimum reflectance values for the dark object are identified using the
approximation of Chavez (1988, see <code>calcPathRadDOS</code> for details).
</p>
<p>The estimated values of the solar irradiance required for the path radiance
can be computed by one of <code>calcTOAIrradTable</code> which is used to
get readily published values of ESun, <code>calcTOAIrradRadRef</code> which 
computes ESun based on the actual radiance and reflectance in the scene, or  
<code>calcTOAIrradModel</code> which computes ESun based on  look-up tables 
for the sensor's relative spectral response and solar irradiation spectral data.
</p>
<p>The atmospheric transmittance towards the sensor (Tv) is approximated by 
1.0 (DOS2, Chavez 1996) or Rayleigh scattering (DOS4, Moran et al. 1992).
</p>
<p>The atmospheric transmittance from the sun (Tz) is approximated by the 
cosine of the sun zenith angle (DOS2, Chavez 1996) or again using Rayleigh
scattering (DOS4, Moran et al. 1992).
</p>
<p>The downwelling diffuse irradiance is approximated by 0.0 (DOS2, Chavez 1996)
or the hemispherical integral of the path radiance (DOS4, Moran et al. 1992).
</p>
<p>Equations are taken from Song et al. (2001).
</p>


<h3>Value</h3>

<p>Satellite object with added atmospheric corrected layers
</p>
<p>raster::RasterStack object with atmospheric corrected layers
</p>
<p>raster::RasterLayer object with atmospheric corrected layer
</p>


<h3>References</h3>

<p>Chavez Jr PS (1988) An improved dark-object subtraction technique 
for atmospheric scattering correction of multispectral data. Remote Sensing 
of Environment 24/3, <a href="https://doi.org/10.1016/0034-4257%2888%2990019-3">doi:10.1016/0034-4257(88)90019-3</a>.
</p>
<p>Chavez Jr PS (1996) Image-based atmospheric corrections revisited and
improved. Photogrammetric Engineering and Remote Sensing 62/9,
available online at 
<a href="https://www.researchgate.net/publication/236769129_Image-Based_Atmospheric_Corrections_-_Revisited_and_Improved">https://www.researchgate.net/publication/236769129_Image-Based_Atmospheric_Corrections_-_Revisited_and_Improved</a>
</p>
<p>Goslee SC (2011) Analyzing Remote Sensing Data in R: The landsat 
Package. Journal of Statistical Software,43/4, 1-25, 
<a href="https://doi.org/10.18637/jss.v043.i04">doi:10.18637/jss.v043.i04</a>.
</p>
<p>Moran MS, Jackson RD, Slater PN, Teillet PM (1992) Evaluation of simplified
procedures for retrieval of land surface reflectance factors from satellite
sensor output.Remote Sensing of Environment 41/2-3, 169-184, 
<a href="https://doi.org/10.1016/0034-4257%2892%2990076-V">doi:10.1016/0034-4257(92)90076-V</a>.
</p>
<p>Song C, Woodcock CE, Seto KC, Lenney MP, Macomber SA (2001) Classification 
and Change Detection Using Landsat TM Data: When and How to Correct 
Atmospheric Effects? Remote Sensing of Environment 75/2, 
<a href="https://doi.org/10.1016/S0034-4257%2800%2900169-3">doi:10.1016/S0034-4257(00)00169-3</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">path &lt;- system.file("extdata", package = "satellite")
files &lt;- list.files(path, pattern = glob2rx("LC08*.TIF"), full.names = TRUE)
sat &lt;- satellite(files)
sat_atmos &lt;- calcAtmosCorr(sat, model = "DOS2", esun_method = "RadRef")

bcde &lt;- "B002n"

sat &lt;- calcTOAIrradRadRef(sat, normalize = FALSE)

path_rad &lt;- calcPathRadDOS(x = min(getValues(getSatDataLayer(sat, bcde))),
                           bnbr = getSatLNBR(sat, bcde),
                           band_wls = 
                             data.frame(LMIN = 
                                          getSatLMIN(sat, 
                                                     getSatBCDESolar(sat)), 
                                        LMAX = 
                                          getSatLMAX(sat, 
                                                     getSatBCDESolar(sat))),
                           radm = getSatRADM(sat, getSatBCDESolar(sat)),
                           rada = getSatRADA(sat, getSatBCDESolar(sat)),
                           szen = getSatSZEN(sat, getSatBCDESolar(sat)),
                           esun = getSatESUN(sat, getSatBCDESolar(sat)),
                           model = "DOS2")

sensor_rad &lt;- convSC2Rad(x = getSatDataLayer(sat, bcde), 
                         mult = getSatRADM(sat, bcde), 
                         add = getSatRADA(sat, bcde), getSatSZEN(sat, bcde))

ref_atmos &lt;- calcAtmosCorr(x = sensor_rad,
                           path_rad = path_rad[names(path_rad) == bcde],
                           esun = getSatESUN(sat, bcde),
                           szen = getSatSZEN(sat, bcde), 
                           model = "DOS2")
                           
</code></pre>


</div>