<div class="container">

<table style="width: 100%;"><tr>
<td>dOTC</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>dOTC (dynamical Optimal Transport Correction) method</h2>

<h3>Description</h3>

<p>Perform a multivariate (non stationary) bias correction.
</p>


<h3>Details</h3>

<p>Three random variables are needed, Y0, X0 and X1. The dynamic between X0 and
X1 is estimated, and applied to Y0 to estimate Y1. Finally, OTC is used
between X1 and the Y1 estimated.
</p>


<h3>Super class</h3>

<p><code>SBCK::OTC</code> -&gt; <code>dOTC</code>
</p>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-dOTC-new"><code>dOTC$new()</code></a>
</p>
</li>
<li> <p><a href="#method-dOTC-fit"><code>dOTC$fit()</code></a>
</p>
</li>
<li> <p><a href="#method-dOTC-predict"><code>dOTC$predict()</code></a>
</p>
</li>
<li> <p><a href="#method-dOTC-clone"><code>dOTC$clone()</code></a>
</p>
</li>
</ul>
<hr>
<a id="method-dOTC-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Create a new dOTC object.
</p>


<h5>Usage</h5>

<div class="r"><pre>dOTC$new(
  bin_width = NULL,
  bin_origin = NULL,
  cov_factor = "std",
  ot = SBCK::OTNetworkSimplex$new()
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>bin_width</code></dt>
<dd>
<p>[vector or NULL] A vector of lengths of the cells
discretizing R^numbers of variables. If NULL, it is estimating
during the fit</p>
</dd>
<dt><code>bin_origin</code></dt>
<dd>
<p>[vector or NULL] Coordinate of lower corner of one
cell. If NULL, c(0,...,0) is used</p>
</dd>
<dt><code>cov_factor</code></dt>
<dd>
<p>[string or matrix] Covariance factor to correct the
dynamic transferred between X0 and Y0. For string, available
values are "std" and "cholesky"</p>
</dd>
<dt><code>ot</code></dt>
<dd>
<p>[OTSolver] Optimal Transport solver, default is the network
simplex</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>A new 'dOTC' object.
</p>


<hr>
<a id="method-dOTC-fit"></a>



<h4>Method <code>fit()</code>
</h4>

<p>Fit the bias correction method
</p>


<h5>Usage</h5>

<div class="r"><pre>dOTC$fit(Y0, X0, X1)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>Y0</code></dt>
<dd>
<p>[matrix: n_samples * n_features] Observations in calibration</p>
</dd>
<dt><code>X0</code></dt>
<dd>
<p>[matrix: n_samples * n_features] Model in calibration</p>
</dd>
<dt><code>X1</code></dt>
<dd>
<p>[matrix: n_samples * n_features] Model in projection</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>NULL
</p>


<hr>
<a id="method-dOTC-predict"></a>



<h4>Method <code>predict()</code>
</h4>

<p>Predict the correction
</p>
<p>Note: Only the center of the bins associated to the corrected points are
returned, but all corrections of the form:
&gt;&gt; bw = dotc$bin_width / 2
&gt;&gt; n  = base::prod(base::dim(X1))
&gt;&gt; Z1 = dotc$predict(X1)
&gt;&gt; Z1 = Z1 + t(matrix(stats::runif( n = n min = - bw , max = bw ) , ncol = dim(X1)[1] ))
are equivalent for OTC.
</p>


<h5>Usage</h5>

<div class="r"><pre>dOTC$predict(X1, X0 = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>X1</code></dt>
<dd>
<p>[matrix: n_samples * n_features] Model in projection</p>
</dd>
<dt><code>X0</code></dt>
<dd>
<p>[matrix: n_samples * n_features or NULL] Model in calibration</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>[matrix or list] Return the matrix of correction of X1 if X0 is
NULL, else return a list containing Z1 and Z0,
the corrections of X1 and X0
</p>


<hr>
<a id="method-dOTC-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>dOTC$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>References</h3>

<p>Robin, Y., Vrac, M., Naveau, P., Yiou, P.: Multivariate
stochastic bias corrections with optimal transport, Hydrol. Earth
Syst. Sci., 23, 773â€“786, 2019,
https://doi.org/10.5194/hess-23-773-2019
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Three bivariate random variables (rnorm and rexp are inverted between ref and bias)
XY = SBCK::dataset_gaussian_exp_2d(2000)
X0 = XY$X0 ## Biased in calibration period
Y0 = XY$Y0 ## Reference in calibration period
X1 = XY$X1 ## Biased in projection period

## Bin length
bin_width = c(0.2,0.2)

## Bias correction
## Step 1 : construction of the class dOTC 
dotc = SBCK::dOTC$new( bin_width ) 
## Step 2 : Fit the bias correction model
dotc$fit( Y0 , X0 , X1 )
## Step 3 : perform the bias correction, Z is a list containing
## corrections
Z = dotc$predict(X1,X0) 
Z$Z0 ## Correction in calibration period
Z$Z1 ## Correction in projection period

</code></pre>


</div>