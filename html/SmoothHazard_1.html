<div class="container">

<table style="width: 100%;"><tr>
<td>idm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit an illness-death model</h2>

<h3>Description</h3>

<p>Fit an illness-death model using either a semi-parametric approach
(penalized likelihood with an approximation of the transition intensity
functions by linear combination of M-splines) or a parametric approach
(specifying Weibull distributions on the transition intensities).
Left-truncated, right-censored, and interval-censored data are allowed.
State 0 corresponds to the initial state, state 1 to the transient one,
state 2 to the absorbant one. The allowed transitions are: 0 –&gt; 1, 0 –&gt; 2
and 1 –&gt; 2.
</p>


<h3>Usage</h3>

<pre><code class="language-R">idm(
  formula01,
  formula02,
  formula12,
  data,
  maxiter = 200,
  eps = c(5, 5, 3),
  n.knots = c(7, 7, 7),
  knots = "equidistant",
  CV = FALSE,
  kappa = c(1000000, 500000, 20000),
  method = "Weib",
  conf.int = 0.95,
  print.iter = FALSE,
  subset = NULL,
  na.action = na.fail
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula01</code></td>
<td>
<p>A formula specifying a regression model for the
<code>0 --&gt; 1</code> transition from the initial state to the transient
state of the illness-death model.  The right hand side of the
formula specifies the covariate terms, and the left hand side must
be an event history object as returned by the function <code>Hist</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula02</code></td>
<td>
<p>A formula specifying a regression model for the
<code>0 --&gt; 2</code> transition from the initial state to the absorbing
state. The left hand side must be equal to the left hand side of
<code>formula01</code>. If missing it is set to <code>formula01</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula12</code></td>
<td>
<p>A formula specifying a regression model for the
<code>1 --&gt; 2</code> transition from the transient state to the absorbing
state.  operator is not required. If missing it is set to
<code>formula01</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame in which to interpret the variables of
<code>formula01</code>, <code>formula02</code> and <code>formula12</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>Maximum number of iterations. The default is 200.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>A vector of 3 integers &gt;0 used to define the power of
three convergence criteria: 1. for the regression parameters,
2. for the likelihood, 3. for the second derivatives. The default
is <code>c(5,5,3)</code> which is translated into convergence if the
respective values change less then <code class="reqn">10^{-5}</code> (for regression
parameters and likelihood) and <code class="reqn">10^{-3}</code> for the second
derivatives between two iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.knots</code></td>
<td>
<p>For <code>method="Splines"</code> only, a vector of length
3 specifing the number of knots, one for each transition, for the
M-splines estimate of the baseline intensities in the order <code>0
--&gt; 1</code>, <code>0 --&gt; 2</code>, <code>1 --&gt; 2</code>. The default is c(7,7,7). When <code>knots</code>
are specified as a list this argument is ignored.
The algorithm needs least 5 knots and at most 20 knots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>Argument only active for the penalized likelihood approach <code>method="Splines"</code>.
There are three ways to control the placement of the knots between the smallest and the largest
of all time points:
</p>

<dl>
<dt><code>knots="equidistant"</code></dt>
<dd>
<p>Knots are placed with same distance on the time scale.</p>
</dd>
<dt><code>knots="quantiles"</code></dt>
<dd>
<p>Knots are placed such that the number of observations is roughly the same between knots.</p>
</dd>
<dt>knots=list()</dt>
<dd>
<p>List of 1 or 2 or three vectors. The list elements are the actual placements
(timepoints) of the knots for the M-spline. The list may contain 
one vector of placements for each transition in the order <code>0 --&gt; 1</code>, <code>0 --&gt; 2</code>, <code>1 --&gt; 2</code>.
If only vector is specifified the knots are used for all transitions. If only 2 vectors are specifified, the
knots for the <code>0 --&gt; 1</code> transition are also used for the <code>1 --&gt; 2</code> transition.</p>
</dd>
</dl>
<p>The algorithm needs at least 5 knots and allows no more than 20 knots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CV</code></td>
<td>
<p>Binary variable equals to 1 when search (by approximated
cross validation) of the smoothing parameters <code>kappa</code> and 0
otherwise. Argument for the penalized likelihood approach. The
default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kappa</code></td>
<td>
<p>Argument only active for the penalized likelihood approach <code>method="Splines"</code>.
A vector with 3 positive values (smoothing parameters), one for each transition, in the order 
0 –&gt; 1, 0 –&gt; 2 and 1 –&gt; 2..
If CV=1 these are used as starting values for a cross validation search to optimize kappa.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>type of estimation method: "Splines" for a
penalized likelihood approach with approximation of the transition
intensities by M-splines, "Weib" for a parametric approach with a
Weibull distribution on the transition intensities. Default is
"Weib".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>
<p>Level of confidence pointwise confidence intervals of the transition intensities, i.e.,
a value between 0 and 1, the default is <code>0.95</code>.
The default is also used when <code>conf.int=TRUE</code>.
To avoid computation of confidence intervals, set <code>conf.int</code> to FALSE or NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.iter</code></td>
<td>
<p>boolean parameter. Equals to <code>TRUE</code> to print
the likelihood during the iteration process, <code>FALSE</code>
otherwise. Default is <code>FALSE</code>. This option is not running on
Windows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>expression indicating the subset of the rows of data
to be used in the fit. All observations are included by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>how NAs are treated. The default is first, any
na.action attribute of data, second a na.action setting of options,
and third 'na.fail' if that is unset. The 'factory-fresh' default
is na.omit. Another possible value is NULL.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The estimated parameters are obtained using the robust Marquardt algorithm
(Marquardt, 1963) which is a combination between a Newton-Raphson algorithm
and a steepest descent algorithm.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the call that produced the result.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coef</code></td>
<td>
<p>regression
parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loglik</code></td>
<td>
<p>vector containing the log-likelihood without and
with covariate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cv</code></td>
<td>
<p>vector containing the convergence criteria.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niter</code></td>
<td>
<p>number of iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>converged</code></td>
<td>
<p>integer equal to 1 when
the model converged, 2, 3 or 4 otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelPar</code></td>
<td>
<p>Weibull
parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>number of subjects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>events1</code></td>
<td>
<p>number of events 0
–&gt; 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>events2</code></td>
<td>
<p>number of events 0 –&gt; 2 or 0 –&gt; 1 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NC</code></td>
<td>
<p>vector containing the number of covariates on transitions 0 –&gt; 1,
0 –&gt; 2, 1 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>responseTrans</code></td>
<td>
<p>model response for the 0 –&gt; 1
transition. <code>Hist</code> or <code>Surv</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>responseAbs</code></td>
<td>
<p>model
response for the 0 –&gt; 2 transition. <code>Hist</code> or <code>Surv</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>times for which transition intensities have been evaluated for
plotting. Vector in the Weibull approach. Matrix in the penalized likelihhod
approach for which the colums corresponds to the transitions 0 –&gt; 1, 1 –&gt;
2, 0 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intensity01</code></td>
<td>
<p>matched values of the intensities for
transition 0 –&gt; 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lowerIntensity01</code></td>
<td>
<p>lower confidence intervals for
the values of the intensities for transition 0 –&gt; 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upperIntensity01</code></td>
<td>
<p>upper confidence intervals for the values of the
intensities for transition 0 –&gt; 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intensity02</code></td>
<td>
<p>matched values of
the intensities for transition 0 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lowerIntensity02</code></td>
<td>
<p>lower
confidence intervals for the values of the intensities for transition 0 –&gt;
2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upperIntensity02</code></td>
<td>
<p>upper confidence intervals for the values of the
intensities for transition 0 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intensity12</code></td>
<td>
<p>matched values of
the intensities for transition 1 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lowerIntensity12</code></td>
<td>
<p>lower
confidence intervals for the values of the intensities for transition 1 –&gt;
2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upperIntensity12</code></td>
<td>
<p>upper confidence intervals for the values of the
intensities for transition 1 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RR</code></td>
<td>
<p>vector of relative risks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>V</code></td>
<td>
<p>variance-covariance matrix derived from the Hessian of the log-likelihood 
if using method="Weib" or, from the Hessian of the penalized log-likelihood 
if using method="Splines".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>standart errors of the
regression parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xnames01</code></td>
<td>
<p>names of covariates on 0 –&gt; 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xnames02</code></td>
<td>
<p>names of covariates on 0 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xnames12</code></td>
<td>
<p>names of
covariates on 1 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots01</code></td>
<td>
<p>knots to approximate by M-splines the
intensity of the 0 –&gt; 1 transition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots02</code></td>
<td>
<p>knots to approximate by
M-splines the intensity of the 0 –&gt; 2 transition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots12</code></td>
<td>
<p>knots to
approximate by M-splines the intensity of the 1 –&gt; 2 transition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nknots01</code></td>
<td>
<p>number of knots on transition 0 –&gt; 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nknots02</code></td>
<td>
<p>number of knots on transition 0 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nknots12</code></td>
<td>
<p>number of knots on transition 1 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta01</code></td>
<td>
<p>square root of splines coefficients for transition 0 –&gt; 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta02</code></td>
<td>
<p>square root of splines coefficients for transition 0 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta12</code></td>
<td>
<p>square root of splines coefficients for transition 1 –&gt; 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CV</code></td>
<td>
<p>a binary variable equals to 1 when search of the smoothing
parameters kappa by approximated cross-validation, 1 otherwise. The
default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kappa</code></td>
<td>
<p>vector containing the smoothing parameters for
transition 0 –&gt; 1, 0 –&gt; 2, 1 –&gt; 2 used to estimate the model by the
penalized likelihood approach.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CVcrit</code></td>
<td>
<p>cross validation criteria.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>DoF</code></td>
<td>
<p>degrees of freedom of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>observations
deleted if missing values.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>R: Celia Touraine &lt;Celia.Touraine@isped.u-bordeaux2.fr&gt; Fortran:
Pierre Joly &lt;Pierre.Joly@isped.u-bordeaux2.fr&gt;
</p>


<h3>References</h3>

<p>D. Marquardt (1963). An algorithm for least-squares estimation
of nonlinear parameters.  <em>SIAM Journal of Applied Mathematics</em>,
431-441.
</p>


<h3>See Also</h3>

<p><code>print.idm</code>
<code>summary.idm</code>
<code>predict.idm</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(lava)
library(prodlim)
set.seed(17)
d &lt;- simulateIDM(100)
# right censored data
fitRC &lt;- idm(formula01=Hist(time=observed.illtime,event=seen.ill)~X1+X2,
             formula02=Hist(time=observed.lifetime,event=seen.exit)~X1+X2,
             formula12=Hist(time=observed.lifetime,event=seen.exit)~X1+X2,data=d,
             conf.int=FALSE)
fitRC


set.seed(17)
d &lt;- simulateIDM(300)
fitRC.splines &lt;- idm(formula01=Hist(time=observed.illtime,event=seen.ill)~X1+X2,
             formula02=Hist(time=observed.lifetime,event=seen.exit)~X1+X2,
             formula12=Hist(time=observed.lifetime,event=seen.exit)~1,data=d,
             conf.int=FALSE,method="splines")

# interval censored data
fitIC &lt;- idm(formula01=Hist(time=list(L,R),event=seen.ill)~X1+X2,
             formula02=Hist(time=observed.lifetime,event=seen.exit)~X1+X2,
             formula12=Hist(time=observed.lifetime,event=seen.exit)~X1+X2,data=d,
             conf.int=FALSE)
fitIC



    data(Paq1000)

    # Illness-death model with certif on the 3 transitions
    # Weibull parametrization and likelihood maximization

    fit.weib &lt;- idm(formula02=Hist(time=t,event=death,entry=e)~certif,
                    formula01=Hist(time=list(l,r),event=dementia)~certif,
                    data=Paq1000)

    # Illness-death model with certif on transitions 01 and 02
    # Splines parametrization and penalized likelihood maximization
    fit.splines &lt;-  idm(formula02=Hist(time=t,event=death,entry=e)~certif,
                        formula01=Hist(time=list(l,r),event=dementia)~certif,
                        formula12=~1,
                        method="Splines",
                        data=Paq1000)
    fit.weib
    summary(fit.splines)


</code></pre>


</div>