<div class="container">

<table style="width: 100%;"><tr>
<td>etregrob</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Robust Fit of Endogenous Treatment Model
</h2>

<h3>Description</h3>

<p>Fits the endogenous treatment model using a robust two-stage estimator
</p>


<h3>Usage</h3>

<pre><code class="language-R">etregrob(selection, outcome, data, control = heckitrob.control())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>selection</code></td>
<td>

<p>formula, the selection equation
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome</code></td>
<td>

<p>formula, the outcome equation
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>an optional data frame containing the variables in the model. If not found in data, the variables are taken from <code>environment(formula)</code>, typically the environment from which <code>etregrob</code> is called.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>

<p>a list of parameters for controlling the fitting process. The same list as for sample selection model
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Compute robust two-step estimates of the Endogenous Treatment Model. The robust probit is fitted in the first stage. In the second stage the Mallows type M-estimator is used instead of traditional OLS. The correction for endogeneity is made by means of control function, which is the inverse Mills ratio for a complete sample (see Maddala, 1983, p. 120-122).
The values of the tuning constants and the robustness weights can be modified in <code>heckitrob.control</code>.
</p>


<h3>Value</h3>

<p>Object of class "etregrob".
</p>
<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>a named vector of coefficients</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage1</code></td>
<td>
<p>object of class <code>glmrob</code> that contains robust probit fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage2</code></td>
<td>
<p>object of class <code>rlm</code> that contains second stage robust fit. Note that the standard errors in this object are biased, since they are not corrected for the uncertainty in the first estimation step. Use <code>vcov</code> below</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcov</code></td>
<td>
<p>variance matrix of the second stage</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>the standard error of the error term of the outcome equation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CIMR</code></td>
<td>
<p>inverse Mills ratio for the complete sample</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>method of estimation, currently only "robust two-stage" is implemented</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>converged</code></td>
<td>
<p>logical. Did all the estimators converge?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterations</code></td>
<td>
<p>list containing the numbers of iterations</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The treatment variable is automatically included in the formula for the second estimation step, i.e. one should not add the dependent variable from the selection equation in the formula of the outcome equation.
</p>


<h3>Author(s)</h3>

<p>Mikhail Zhelonkin
</p>


<h3>References</h3>

<p>Maddala G.S. (1983) Limited-Dependent and Qualitative Variables in Econometrics. Cambridge: Cambridge University Press.
</p>
<p>Zhelonkin, M., Ronchetti, E. (2021) Robust Analysis of Sample Selection Models through the R Package ssmrob. <em>Journal of Statistical Software</em>, 99, 4, p. 1-35. doi: <a href="https://doi.org/10.18637/jss.v099.i04">10.18637/jss.v099.i04</a>
</p>


<h3>See Also</h3>

<p><code>glmrob</code>, <code>rlm</code>, <code>ssmrob</code>, <code>heckitrob.control</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(mvtnorm)
set.seed(2)
N &lt;- 3000
beta1 &lt;- c(1.0, 1.0, 0.75)
beta2 &lt;- c(1.5, 1.0, 0.5)
alpha &lt;- 1.25
x1 &lt;- rmvnorm(N, mean = c(0, -1, 1), sigma = diag(c(1, 0.5, 1)))
x2 &lt;- x1 
x2[, 3] &lt;- rnorm(N, 1, 1)
eps &lt;- rmvnorm(N, mean = rep(0, 2), sigma = matrix(c(1, -0.7, -0.7, 1), 2, 2))
x1beta1 &lt;- x1[, 1]*beta1[1] + x1[, 2]*beta1[2] + x1[, 3]*beta1[3]
x2beta2 &lt;- x2[, 1]*beta2[1] + x2[, 2]*beta2[2] + x2[, 3]*beta2[3]
y1 &lt;- ifelse(x1beta1 + eps[, 1] &gt; 0, 1, 0)
y2 &lt;- x2beta2 + alpha*y1 + eps[,2]
etm.ctrl &lt;- heckitrob.control(weights.x1 = "hat", weights.x2 = "covMcd")
etmsim.fit &lt;- etregrob(y1 ~ x1, y2 ~ x2, control = etm.ctrl)
summary(etmsim.fit)
</code></pre>


</div>