<div class="container">

<table style="width: 100%;"><tr>
<td>spLMexact</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Univariate Bayesian spatial linear model</h2>

<h3>Description</h3>

<p>Fits a Bayesian spatial linear model with spatial process
parameters and the noise-to-spatial variance ratio fixed to a value supplied
by the user. The output contains posterior samples of the fixed effects,
variance parameter, spatial random effects and, if required, leave-one-out
predictive densities.
</p>


<h3>Usage</h3>

<pre><code class="language-R">spLMexact(
  formula,
  data = parent.frame(),
  coords,
  cor.fn,
  priors,
  spParams,
  noise_sp_ratio,
  n.samples,
  loopd = FALSE,
  loopd.method = "exact",
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a symbolic description of the regression model to be fit.
See example below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame containing the variables in the model.
If not found in <code>data</code>, the variables are taken from
<code>environment(formula)</code>, typically the environment from which
<code>spLMexact</code> is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>
<p>an <code class="reqn">n \times 2</code> matrix of the observation
coordinates in <code class="reqn">\mathbb{R}^2</code> (e.g., easting and northing).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor.fn</code></td>
<td>
<p>a quoted keyword that specifies the correlation function used
to model the spatial dependence structure among the observations. Supported
covariance model key words are: <code>'exponential'</code> and <code>'matern'</code>.
See below for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priors</code></td>
<td>
<p>a list with each tag corresponding to a parameter name and
containing prior details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spParams</code></td>
<td>
<p>fixed value of spatial process parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noise_sp_ratio</code></td>
<td>
<p>noise-to-spatial variance ratio.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.samples</code></td>
<td>
<p>number of posterior samples to be generated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loopd</code></td>
<td>
<p>logical. If <code>loopd=TRUE</code>, returns leave-one-out predictive
densities, using method as given by <code>loopd.method</code>. Default is
<code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loopd.method</code></td>
<td>
<p>character. Ignored if <code>loopd=FALSE</code>. If <code>loopd=TRUE</code>,
valid inputs are <code>'exact'</code> and <code>'PSIS'</code>. The option <code>'exact'</code> corresponds to
exact leave-one-out predictive densities which requires computation almost
equivalent to fitting the model <code class="reqn">n</code> times. The option <code>'PSIS'</code> is
faster and finds approximate leave-one-out predictive densities using
Pareto-smoothed importance sampling (Gelman <em>et al.</em> 2024).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical. If <code>verbose = TRUE</code>, prints model description.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>currently no additional argument.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Suppose <code class="reqn">\chi = (s_1, \ldots, s_n)</code> denotes the <code class="reqn">n</code>
spatial locations the response <code class="reqn">y</code> is observed. With this function, we
fit a conjugate Bayesian hierarchical spatial model
</p>
<p style="text-align: center;"><code class="reqn">
\begin{aligned}
y \mid z, \beta, \sigma^2 &amp;\sim N(X\beta + z, \delta^2 \sigma^2 I_n), \quad
z \mid \sigma^2 \sim N(0, \sigma^2 R(\chi; \phi, \nu)), \\
\beta \mid \sigma^2 &amp;\sim N(\mu_\beta, \sigma^2 V_\beta), \quad
\sigma^2 \sim \mathrm{IG}(a_\sigma, b_\sigma)
\end{aligned}
</code>
</p>

<p>where we fix the spatial process parameters <code class="reqn">\phi</code> and <code class="reqn">\nu</code>, the
noise-to-spatial variance ratio <code class="reqn">\delta^2</code> and the hyperparameters
<code class="reqn">\mu_\beta</code>, <code class="reqn">V_\beta</code>, <code class="reqn">a_\sigma</code> and <code class="reqn">b_\sigma</code>. We utilize
a composition sampling strategy to sample the model parameters from their
joint posterior distribution which can be written as
</p>
<p style="text-align: center;"><code class="reqn">
p(\sigma^2, \beta, z \mid y) = p(\sigma^2 \mid y) \times
p(\beta \mid \sigma^2, y) \times p(z \mid \beta, \sigma^2, y).
</code>
</p>

<p>We proceed by first sampling <code class="reqn">\sigma^2</code> from its marginal posterior,
then given the samples of <code class="reqn">\sigma^2</code>, we sample <code class="reqn">\beta</code> and
subsequently, we sample <code class="reqn">z</code> conditioned on the posterior samples of
<code class="reqn">\beta</code> and <code class="reqn">\sigma^2</code> (Banerjee 2020).
</p>


<h3>Value</h3>

<p>An object of class <code>spLMexact</code>, which is a list with the
following tags -
</p>

<dl>
<dt>samples</dt>
<dd>
<p>a list of length 3, containing posterior samples of fixed
effects (<code>beta</code>), variance parameter (<code>sigmaSq</code>), spatial effects
(<code>z</code>).</p>
</dd>
<dt>loopd</dt>
<dd>
<p>If <code>loopd=TRUE</code>, contains leave-one-out predictive
densities.</p>
</dd>
<dt>model.params</dt>
<dd>
<p>Values of the fixed parameters that includes
<code>phi</code> (spatial decay), <code>nu</code> (spatial smoothness) and
<code>noise_sp_ratio</code> (noise-to-spatial variance ratio).</p>
</dd>
</dl>
<p>The return object might include additional data used for subsequent
prediction and/or model fit evaluation.
</p>


<h3>Author(s)</h3>

<p>Soumyakanti Pan <a href="mailto:span18@ucla.edu">span18@ucla.edu</a>,<br>
Sudipto Banerjee <a href="mailto:sudipto@ucla.edu">sudipto@ucla.edu</a>
</p>


<h3>References</h3>

<p>Banerjee S (2020). "Modeling massive spatial datasets using a
conjugate Bayesian linear modeling framework." <em>Spatial Statistics</em>, <strong>37</strong>,
100417. ISSN 2211-6753. <a href="https://doi.org/10.1016/j.spasta.2020.100417">doi:10.1016/j.spasta.2020.100417</a>.
</p>
<p>Vehtari A, Simpson D, Gelman A, Yao Y, Gabry J (2024). "Pareto
Smoothed Importance Sampling." <em>Journal of Machine Learning Research</em>,
<strong>25</strong>(72), 1-58. URL <a href="https://jmlr.org/papers/v25/19-556.html">https://jmlr.org/papers/v25/19-556.html</a>.
</p>


<h3>See Also</h3>

<p><code>spLMstack()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># load data
data(simGaussian)
dat &lt;- simGaussian[1:100, ]

# setup prior list
muBeta &lt;- c(0, 0)
VBeta &lt;- cbind(c(1.0, 0.0), c(0.0, 1.0))
sigmaSqIGa &lt;- 2
sigmaSqIGb &lt;- 0.1
prior_list &lt;- list(beta.norm = list(muBeta, VBeta),
                   sigma.sq.ig = c(sigmaSqIGa, sigmaSqIGb))

# supply fixed values of model parameters
phi0 &lt;- 3
nu0 &lt;- 0.75
noise.sp.ratio &lt;- 0.8

mod1 &lt;- spLMexact(y ~ x1, data = dat,
                  coords = as.matrix(dat[, c("s1", "s2")]),
                  cor.fn = "matern",
                  priors = prior_list,
                  spParams = list(phi = phi0, nu = nu0),
                  noise_sp_ratio = noise.sp.ratio,
                  n.samples = 100,
                  loopd = TRUE, loopd.method = "exact")

beta.post &lt;- mod1$samples$beta
z.post.median &lt;- apply(mod1$samples$z, 1, median)
dat$z.post.median &lt;- z.post.median
plot1 &lt;- surfaceplot(dat, coords_name = c("s1", "s2"),
                     var_name = "z_true")
plot2 &lt;- surfaceplot(dat, coords_name = c("s1", "s2"),
                     var_name = "z.post.median")
plot1
plot2
</code></pre>


</div>