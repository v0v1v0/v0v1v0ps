<div class="container">

<table style="width: 100%;"><tr>
<td>shr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit a survival model</h2>

<h3>Description</h3>

<p>Fit a survival model using either a semi-parametric approach (penalized
likelihood with an approximation of the hazard function by linear
combination of M-splines) or a parametric approach (specifying a Weibull
distribution on the hazard function). Left-truncated, right-censored, and
interval-censored data are allowed.
</p>


<h3>Usage</h3>

<pre><code class="language-R">shr(
  formula,
  data,
  eps = c(5, 5, 3),
  n.knots = 7,
  knots = "equidistant",
  CV = FALSE,
  kappa = 10000,
  conf.int = 0.95,
  maxiter = 200,
  method = "Weib",
  print.iter = FALSE,
  na.action = na.omit
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a formula object with the response on the left hand side
and the terms on the right hand side. The
response must be a survival object or Hist object as returned by
the <code>'Surv'</code> or <code>'Hist'</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame in which to interpret the variables named
in the <code>formula</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>a vector of length 3 for the convergence criteria
(criterion for parameters, criterion for likelihood, criterion for
second derivatives). The default is <code>c(5,5,3)</code> and corresponds to
criteria equals to <code>10^{-5}</code>, <code>10^{-5}</code> and <code>10^{-3}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.knots</code></td>
<td>
<p>Argument only active for the penalized likelihood approach <code>method="splines"</code>.
Number of knots for the splines to use to approximate
the hazard function. The default is 7. If <code>knots</code> are given as a vector this argument is ignored.
The algorithm needs least 5 knots and at most 20 knots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>Argument only active for the penalized likelihood approach <code>method="splines"</code>.
There are three ways to control the placement of the knots between the smallest and the largest
of all time points:
</p>

<dl>
<dt><code>knots="equidistant"</code></dt>
<dd>
<p>Knots are placed with same distance on the time scale.</p>
</dd>
<dt><code>knots="quantiles"</code></dt>
<dd>
<p>Knots are placed such that the number of observations is roughly the same between knots.</p>
</dd>
<dt>knots=list()</dt>
<dd>
<p>List of length 3. The list elements are the actual placements
(timepoints) of the knots for the M-spline.</p>
</dd>
</dl>
<p>The algorithm reuqires at least 5 knots and allows no more than 20 knots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CV</code></td>
<td>
<p>binary variable equals to 1 when search (by approximated
cross validation) of the smoothing parameter kappa and 0
otherwise. Argument for the penalized likelihood approach. The
default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kappa</code></td>
<td>
<p>Argument only active for the penalized likelihood approach <code>method="splines"</code>.
A positive number (smoothing parameter) 
If CV=1 the value is used as a starting value 
for a cross validation search to optimize <code>kappa</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>
<p>Level of confidence pointwise confidence intervals of the survival and hazard functions, i.e.,
a value between 0 and 1, the default is <code>0.95</code>.
The default is also used when <code>conf.int=TRUE</code>.
To avoid computation of confidence intervals, set <code>conf.int</code> to FALSE or NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>maximum number of iterations. The default is 200.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>type of estimation method: "Splines" for a penalized
likelihood approach with approximation of the hazard function by
M-splines, "Weib" for a parametric approach with a Weibull
distribution on the hazard function. Default is <code>"Weib"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.iter</code></td>
<td>
<p>boolean parameter. Equals to <code>TRUE</code> to print
the likelihood during the iteration process, <code>FALSE</code>
otherwise. Default is <code>FALSE</code>. This option is not running on
Windows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>how NAs are treated. The default is first, any
na.action attribute of data, second a na.action setting of options,
and third 'na.fail' if that is unset. The 'factory-fresh' default
is na.omit. Another possible value is NULL.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The estimated parameters are obtained using the robust Marquardt algorithm
(Marquardt, 1963) which is a combination between a Newton-Raphson algorithm
and a steepest descent algorithm.
</p>


<h3>Value</h3>


<dl>
<dt>call</dt>
<dd></dd> <dt>coef</dt>
<dd>
<p>regression parameters.</p>
</dd>
<dt>loglik</dt>
<dd>
<p>vector containing the log-likelihood without and with covariate.</p>
</dd>
<dt>modelPar</dt>
<dd>
<p>Weibull parameters.</p>
</dd>
<dt>N</dt>
<dd>
<p>number of subjects.</p>
</dd>
<dt>NC</dt>
<dd>
<p>number of covariates.</p>
</dd>
<dt>nevents</dt>
<dd>
<p>number of events.</p>
</dd>
<dt>modelResponse</dt>
<dd>
<p>model response: <code>Hist</code> or <code>Surv</code> object.</p>
</dd>
<dt>converged</dt>
<dd>
<p>integer equal to 1 when the model converged, 2, 3 or 4 otherwise.</p>
</dd>
<dt>time</dt>
<dd>
<p>times for which survival and hazard functions have been evaluated for plotting.</p>
</dd>
<dt>hazard</dt>
<dd>
<p>matched values of the hazard function.</p>
</dd>
<dt>lowerHazard</dt>
<dd>
<p>lower confidence limits for hazard function.</p>
</dd>
<dt>upperHazard</dt>
<dd>
<p>upper confidence limits for hazard function.</p>
</dd>
<dt>surv</dt>
<dd>
<p>matched values of the survival function.</p>
</dd>
<dt>lowerSurv</dt>
<dd>
<p>lower confidence limits for survival function.</p>
</dd>
<dt>upperSurv</dt>
<dd>
<p>upper confidence limits for survival function.</p>
</dd>
<dt>RR</dt>
<dd>
<p>vector of relative risks.</p>
</dd>
<dt>V</dt>
<dd>
<p>variance-covariance matrix.</p>
</dd>
<dt>se</dt>
<dd>
<p>standard errors.</p>
</dd>
<dt>knots</dt>
<dd>
<p>knots of the M-splines estimate of the hazard function.</p>
</dd>
<dt>nknots</dt>
<dd>
<p>number of knots.</p>
</dd>
<dt>CV</dt>
<dd>
<p>a binary variable equals to 1 when search of the smoothing parameter
kappa by approximated cross-validation, 1 otherwise. The default is 0.</p>
</dd>
<dt>niter</dt>
<dd>
<p>number of iterations.</p>
</dd>
<dt>cv</dt>
<dd>
<p>vector containing the convergence criteria.</p>
</dd>
<dt>na.action</dt>
<dd>
<p>observations deleted if missing values.</p>
</dd>
</dl>
<h3>Author(s)</h3>

<p>R: Celia Touraine <a href="mailto:celia.touraine@icm.unicancer.fr">celia.touraine@icm.unicancer.fr</a> Fortran:
Pierre Joly <a href="mailto:Pierre.Joly@isped.u-bordeaux2.fr">Pierre.Joly@isped.u-bordeaux2.fr</a>
</p>


<h3>References</h3>

<p>D. Marquardt (1963). An algorithm for least-squares estimation
of nonlinear parameters.  <em>SIAM Journal of Applied Mathematics</em>,
431-441.
</p>


<h3>See Also</h3>

<p><code>shr</code>, <code>print.shr</code>,
<code>summary.shr</code>, <code>print.shr</code>,
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Weibull survival model
library(prodlim)
data(testdata)
fit.su &lt;- shr(Hist(time=list(l,r),id)~cov,data=testdata) 
fit.su
summary(fit.su)

shr.spline &lt;- shr(Hist(time=list(l,r),id)~cov,data=testdata,method="splines",n.knots=6)
shr.spline
shr.spline.q &lt;- shr(Hist(time=list(l,r),id)~cov,data=testdata,
                    method="splines",n.knots=6,knots="quantiles")
plot(shr.spline.q)

## manual placement of knots
shr.spline.man &lt;- shr(Hist(time=list(l,r),id)~cov,data=testdata,method="splines",knots=seq(0,7,1))

</code></pre>


</div>